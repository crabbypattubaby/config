"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[96159],{114103:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>D,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>M,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>C,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>S,RRULE_WEEKDAYS_MAP:()=>v,adjustedStartDateIfPossible:()=>w,areRecurrenceSchedulesEqual:()=>N,convertFromUnpersistedRecurrenceConfig:()=>T,convertToUnpersistedRecurrenceConfig:()=>V,getFormattedEndCondition:()=>k,getFormattedNextRecurrenceTime:()=>P,getNewEndTimestamp:()=>O,getNextDateUtc:()=>I,getRecurrenceAfter:()=>A,isRunningBetweenMidnightAnd3AM:()=>E,isValidRecurrenceInterval:()=>_,isValidRecurrenceNumberOfRuns:()=>h,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>R});n(725707),n(491955),n(403517);var o=()=>n(486826),r=()=>n(994488),i=()=>n(975392),a=()=>n(76394),s=()=>n(141666),c=()=>n(871002),d=()=>n(846581),l=()=>n(427091),u=()=>n(707781),p=()=>n(533639),m=()=>n(711659);const f=(0,n(653998).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),g={day:p().p.DAILY,week:p().p.WEEKLY,month:p().p.MONTHLY,year:p().p.YEARLY},v={MO:p().p.MO,TU:p().p.TU,WE:p().p.WE,TH:p().p.TH,FR:p().p.FR,SA:p().p.SA,SU:p().p.SU},y=99,S=999;function _(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=y}function h(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=S}function b(e){const{start_date:t,frequency:n,interval:o,weekdays:i,timezone:s,hour:d,minute:l}=e,u="week"===n&&i?i.map((e=>v[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=(0,r().o)(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return v[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new(p().p)({freq:g[n],dtstart:(0,c().eU)(t),interval:o,byweekday:u,tzid:s,byhour:d??0,byminute:l??0,bysecond:0,...m})}const C=1,M=1;function R(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=o>C,a=n.length>=M;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function w(e){var t;const{recurrence:n,afterDate:r}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=r)return n;let i=o().c9.fromMillis(n.start_date,{zone:"utc"});const a=o().c9.fromMillis(r,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,c().DH)(i.toMillis())}}function A(e){const{recurrence:t,afterDate:n}=e;if((0,m().wt)(t)){const e=(0,c().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(w({recurrence:t,afterDate:n})).after((0,c().eU)(n));if(!e)return;return(0,c().h1)(e)}}function E(e){return 0===e.hour||1===e.hour||2===e.hour}function I(e){return b(e).after((0,c().eU)((0,c().Rz)()))||void 0}function P(e){const{recurrence:t,intl:n}=e,r=I(T(t));if(!r)return;const i=E(t),a=o().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),s=(0,d().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(o().c9.TIME_SIMPLE);return t.timezone!==(0,l().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(f.dateAtTime,{date:s,time:e})}}function k(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,d().Yq)({date:o().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(f.noEndCondition)}const D=100;function V(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function O(e,t,n){return e.plus(n-t)}function B(e,t){const n=o().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(n.toJSDate())}}function T(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?B(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function N(e,t){const n=i().fN(e,(e=>void 0!==e)),o=i().fN(t,(e=>void 0!==e));return i().n4(n,o)}},248584:(e,t,n)=>{n.d(t,{Hy:()=>k,NV:()=>I,O9:()=>V,Rg:()=>D,Sm:()=>B,dK:()=>T,f7:()=>O,l8:()=>N,n$:()=>x,no:()=>U,sx:()=>P});var o=()=>n(237385),r=()=>n(556078),i=()=>n(803290),a=()=>n(762847),s=()=>n(810111),c=()=>n(21164),d=()=>n(111066),l=()=>n(67558),u=()=>n(377561),p=()=>n(210562),m=()=>n(88442),f=()=>n(502852),g=()=>n(370639),v=()=>n(400885),y=()=>n(724903),S=()=>n(622286),_=()=>n(382640),h=()=>n(485966),b=()=>n(471370),C=()=>n(836331),M=()=>n(261804),R=()=>n(346267),w=()=>n(797470),A=()=>n(141122),E=()=>n(366069);function I(e){(0,f().SQ)({event:e,context:f().y$.EditorMouseDown,callback:()=>{}})}function P(e){(0,f().SQ)({event:e,context:f().y$.EditorClick,callback:()=>{}})}function k(e){return(0,i().K8)((()=>Boolean(E().A.state.pageMap[e.id])||R().A.state.pages.has(e.id)),[e.id])}function D(e,t){const n=(0,o().v3)(),a=(0,r().S)(),s=k(e),c=(0,i().K8)((()=>{var n,o;return t===w().Rr.Frame?Boolean(null===(n=h().default.state.currentLoadingContainerStore)||void 0===n?void 0:n.state.ready):t===w().Rr.PeekView&&A().default.state.open?Boolean(null===(o=A().default.state.loadingContainerStore)||void 0===o?void 0:o.state.ready):t===w().Rr.CollectionPageView||t===w().Rr.CollectionPageViewFullScreen?e.isReady():void 0}),[t,e]),d=O(e);return(0,i().K8)((()=>{if(!c)return!1;const t=n.currentUser.isLoggedIn(),o=a&&a.publicEditModeStore.state;return Boolean(e&&e.isDefined()&&!e.isNonEditableState()&&e.canEdit()&&!e.hasContent()&&t&&(!(null!=o&&o.hasPublicPermission)||"edit"===(null==o?void 0:o.permission))&&!s&&!d&&(!(0,m().ZE)(o)||"completionPopup"!==b().default.state.type))}),[n.currentUser,d,c,a,s,e])}function V(e,t){const n=(0,o().v3)(),a=(0,r().S)(),{isTablet:s}=(0,o().Y0)(),c=(0,S().X)("tablet_refresh_template_pills_gate");return(0,i().K8)((()=>{if(t===w().Rr.SitePreview)return!1;if(n.device.isMobile&&(!s||!c))return!1;if(!n.currentUser.isLoggedIn())return!1;const o=a&&a.publicEditModeStore.state;if(null!=o&&o.hasPublicPermission&&"edit"!==(null==o?void 0:o.permission))return!1;if(e.getContentLength()>1)return!1;if(!e.canEdit()||e.isNonEditableState())return!1;const r=e.getContentStores()[0];if(r&&!r.isEmptyTextBlock())return!1;if(e.getAssociatedCollectionStore())return!1;const i=p().gZ.state,d=p().Di.state;if(i&&e.id===d)return!1;return!((0,v().L5)(t)?l().VY.state:l().u3.state)}),[n,a,e,t,s,c])}function O(e){return(0,i().K8)((()=>{if(e.isCollectionView()){const t=e.getCollectionStoreIfSingleSource();return!!t&&t.isSyncedCollection()}return e.isType(a().xd.externalObjectInstancePage)}),[e])}function B(e){return(0,i().K8)((()=>{if(!(0,g().vL)())return!1;const t=e.getParentStore();if((null==t?void 0:t.table)===c().Vl){return!!t.getFormatStore().getKeyStore("external_collection_type").getValue()}return!1}),[e])}function T(e){return(0,i().K8)((()=>{if(!(0,g().pB)())return!1;var t;return!!e.isCollectionView()&&((null===(t=e.getCollectionStore())||void 0===t?void 0:t.getFormatStore().getKeyStore("external_collection_type").getValue())??!1)}),[e])}function N(e){return(0,i().K8)((()=>{if(!C().default.checkGate({gateName:"csvimport_faster_navigate_to_page_enabled"}))return!1;var t;return!!e.isCollectionView()&&(null===(t=e.getCollectionStore())||void 0===t?void 0:t.getFormatStore().getKeyStore("static_import_collection_type").getValue())===s().IE.CsvImport}),[e])}function x(e){const t=(0,o().v3)(),{device:n,WindowSizeStore:r}=t,a=(0,i().K8)((()=>{const e=r.state.height,o=n.isMobile&&M().A.state.open?e:0;return d().C6(t)+o}),[t,r,n.isMobile]);return(0,i().K8)((()=>"home-phone"===e?_().q3:n.isTablet?380:n.isIOS?Math.max(350,a):n.isMobile?400:"side-peek"===e||"center-peek"===e?y().ln:"home"===e?_().wH:"30vh"),[n,a,e])}function U(e){const t=(0,o().v3)(),n=(0,i().K8)((()=>(0,u().dC)(t,e)),[t,e]);return(0,i().K8)((()=>n&&!e.isFullWidth()?(0,u().Zy)(t,(0,y().cq)(e),(0,y().RX)(e)):0),[t,n,e])}},708732:(e,t,n)=>{n.d(t,{A$:()=>w,JQ:()=>A,RJ:()=>E,Vn:()=>M,s4:()=>R});n(610931),n(362833),n(333225),n(494367),n(516262),n(573119),n(240480),n(950443),n(619601),n(725707),n(491955),n(771702),n(403517);var o=()=>n(502140),r=()=>n(935664),i=()=>n(891186),a=()=>n(220574),s=()=>n(145017),c=()=>n(896910),d=()=>n(76394),l=()=>n(818369),u=()=>n(927685),p=()=>n(137476),m=()=>n(170745),f=()=>n(938345),g=()=>n(469608),v=()=>n(137650),y=()=>n(273541),S=()=>n(449596),_=()=>n(836331),h=()=>n(37312),b=()=>n(708732),C=()=>n(378219);async function M(e){const{environment:t,request:n,abortSignal:o,prefetchCacheKey:r,headers:i}=e;return(0,h().updateLoadCachedPageChunkCalledAt)(),g().isConnected()||g().isConnecting()?l().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:n,abortSignal:o,prefetchCacheKey:r,headers:i}):l().callApi({eventName:"loadPageChunkV2",environment:t,data:n,abortSignal:o,prefetchCacheKey:r,headers:i})}async function R(e){const{mode:t,environment:n,request:d,isFirstChunk:l,abortSignal:g}=e,v={...d,limit:30,cursor:d.cursor||{stack:[]},baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await b().A$(n,{id:d.page.id,table:s().ev}),null!=g&&g.aborted))throw new Error("Abort signal received");const _=a().RecordMapWithRole.create(),h=[];let C=!1;const M=new Set,R=await r().T(v,i().h.fromMonomorphicFunctionUnsafe((async e=>{const o=await m().h7({environment:n,pointer:e,abortSignal:g,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=g&&g.aborted)throw new Error("Abort signal received");if(o)return _.setModelAndRole(e,o.model,o.role),o.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,c().u)(e)&&!M.has(e.id)&&l){if(void 0===S().A.state.offlinePages)return h.push(e),void(C=!0);if(void 0===S().A.state.offlinePages||!y().Bd(d.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);h.push(e)}})),((e,t,n,o)=>{f().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${n})`),null!=o&&o.suppressErrorOnClient&&M.add(t.id)}));if(C&&(await S().A.waitUntil((()=>void 0!==S().A.state.offlinePages)),!y().Bd(d.page.id))){const[e]=h;throw new Error(`Record not found: ${e.table},${e.id}`)}if(h.length>0&&(0,p().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,p().u4)({environment:n,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&o().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:d.page.id,missingRecords:h}})})),null!=g&&g.aborted)throw new Error("Abort signal received");return{recordMap:_.toJson(),cursor:R.cursorValue}}async function w(e,t){const n=e.currentUser.id;if(!n||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:n})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),v().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function A(e){if(!_().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=a().RecordMapPolymorphic.create();let n=0;const o=()=>n>=50,r=e=>{"space"!==(null==e?void 0:e.table)&&(o()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),n++))};if(e.isReady())for(const a of(0,C().E)(e))r(a);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);r(t.getModel({table:"notion_user",id:e.userId}));let n=0;for(const e of t.getPointersByTable("notion_user")){if(o()||n>=10)break;n++,r(t.getModel(e))}}const i=Array.from(t).map((e=>{let{pointer:t,value:n}=e;if(void 0!==n)return{pointer:t,version:n}})).filter(d().O9);return i.length?i:void 0}async function E(e){const{environment:t,request:n}=e;try{return await R({environment:t,mode:"inMemoryOnly",request:n,isFirstChunk:!0}),!0}catch(o){return!1}}},760813:(e,t,n)=>{n.d(t,{$L:()=>A,Fv:()=>B,HD:()=>T,V_:()=>D,bV:()=>V,jP:()=>k,nh:()=>P,w8:()=>O});n(610931),n(358848),n(91270),n(725707),n(491955);var o=()=>n(214144),r=()=>n(769884),i=()=>n(33715),a=()=>n(846287),s=()=>n(996151),c=()=>n(599666),d=()=>n(946854),l=()=>n(968410),u=()=>n(817150),p=()=>n(385531),m=()=>n(865226),f=()=>n(84543),g=()=>n(486963),v=()=>n(29869),y=()=>n(754697),S=()=>n(667801),_=()=>n(485966),h=()=>n(141122),b=()=>n(413871),C=()=>n(521972),M=()=>n(933871),R=()=>n(272690),w=()=>n(130081);function A(e){let{environment:t,transaction:n,collectionStore:o,userId:i,modules:a}=e;const c=(0,y().zP)({environment:t,spaceId:o.getSpaceId(),table:l().zx}),d=b().sk.createChildStore(o,c),{model:u,operations:[p]}=r().wfN.create({pointer:c,parent:o.pointer,createdByUserId:i,modules:a??(0,s().K5)()});f().applyOperation({transaction:n,store:d,operation:p});const m=r().BnK.setLayout(o.pointer,c);return f().applyOperation({transaction:n,store:o,operation:m}),{model:u,store:d}}function E(e){let t;return e?t=e:h().default.state.open&&h().default.state.targetStore?t=h().default.state.targetStore:_().default.state.mainEditorCurrentBlockStore&&(t=_().default.state.mainEditorCurrentBlockStore),t}function I(e){S().setUpdateExpand({environment:e,isExpanded:!1,from:"keyboard_default",saveDetailsSidebarPreference:!1}),p().VN({environment:e,from:"open_page_layout_editor",preventAnimation:!0})}function P(e){var t,n;let{environment:r,blockStore:i,collectionStore:a,collectionViewStore:s,from:c,initialSelectedModuleType:d}=e;const l=function(e){var t;let n=E(e);if(null!==(t=n)&&void 0!==t&&t.isCollectionView()){const e=(0,g().U)(n);n=e?e.resultsInViewOrder(1).at(0):void 0}return n}(i),u=window.location.href;I(r);const p=o().JW();C().g.setState({isOpen:!0,mode:"layout-editor",collectionStore:a,pageStore:l,siteRootBlockStore:void 0,sessionId:p,initialSelectedModuleId:null==l||null===(t=l.getAssociatedCollectionStore())||void 0===t||null===(t=t.getLayoutStore())||void 0===t||null===(t=t.getModel())||void 0===t||null===(t=t.firstRawModuleOfType(d??"titleWithIcon"))||void 0===t?void 0:t.id,urlOnOpen:u}),(0,R().Ko)({environment:r,from:c,context:"layout",sessionId:p,collectionId:null==a?void 0:a.id,existingLayoutId:null==a||null===(n=a.getLayoutStore())||void 0===n?void 0:n.id,collectionViewId:null==s?void 0:s.id})}function k(e){let{environment:t,store:n,siteRootBlockStore:r,from:i}=e;const a=E(n);I(t);const s=o().JW();C().g.setState({isOpen:!0,mode:"site-settings-editor",pageStore:a,siteRootBlockStore:r,sessionId:s}),(0,R().Ko)({environment:t,context:"site",from:i,sessionId:s,collectionId:void 0,existingLayoutId:void 0})}function D(e){let{slideBlockStore:t}=e;const n=t.getNavigableBlockStore(),r=o().JW();C().g.setState({isOpen:!0,mode:"presentation",pageStore:n,currentSlideStore:t,sessionId:r}),window.document.documentElement.requestFullscreen()}function V(e){let{environment:t,pageStore:n,slideBlockStore:o}=e;C().g.setState({isOpen:!1});const r=(0,v().Ay)({store:n,scrollToBlockId:o.id,pageVisitSource:void 0});m().oo({environment:t,url:r}),window.document.fullscreenElement&&window.document.exitFullscreen()}function O(e){C().g.getState().isOpen&&B(e)}function B(e){let{environment:t}=e;const n=C().g.getState();if(!n.isOpen)throw new Error("Cannot close page layout editor. Page layout editor is not open.");"layout-editor"===n.mode&&n.urlOnOpen&&window.location.href!==n.urlOnOpen&&m().aX(t),C().g.setState({isOpen:!1})}function T(e){var t;let{environment:n,transaction:o,property:r,layoutStore:s}=e;const l=C().g.getSessionId(),p=null===(t=s.getModel())||void 0===t?void 0:t.getRawModules(),m=s.getCollectionModel();if(!p||!m)return;const f=b().md.createChildStore(s,m.pointer),g=(0,a().yn)(p,(e=>"titleWithIcon"===e.type));if(g&&(0,d().Mj)(g.module)){var v;const{module:e,position:t}=g,a={...e,type:"titleWithIcon",propertyIds:null===(v=e.propertyIds)||void 0===v?void 0:v.filter((e=>e!==r))};(0,w().UQ)({environment:n,sessionId:l,transaction:o,layoutStore:s,position:{area:(0,i().Fw)(t.area),moduleId:e.id},updatedModule:(0,c().X)(a)})}const y=(0,a().LP)(p,(e=>"property"===e.type&&e.propertyId===r));for(const{module:a,position:c}of y){const e=a.id,t=(0,i().Fw)(c.area);(0,M().U)({environment:n,sessionId:l,transaction:o,layoutStore:s,position:{area:t,moduleId:e}})}const S=m.getFormat().collection_page_sections;if(S){const e=S.filter((e=>e.section!==r));u().LK({store:f,pageSectionFormats:e,transaction:o,environment:n})}}},898719:(e,t,n)=>{n.d(t,{$N:()=>P,D5:()=>k,GB:()=>A,M9:()=>R,Pt:()=>I,eW:()=>E,jo:()=>D,v7:()=>w});n(362833),n(725707),n(771702),n(403517);var o=()=>n(486826),r=()=>n(577097),i=()=>n(716605),a=()=>n(871002),s=()=>n(16456),c=()=>n(427091),d=()=>n(21164),l=()=>n(975392),u=()=>n(76394),p=()=>n(396806),m=()=>n(285714),f=()=>n(993254),g=()=>n(749879),v=()=>n(795394),y=()=>n(759625),S=()=>n(448316),_=()=>n(314164),h=()=>n(37394),b=()=>n(286555),C=()=>n(413871),M=()=>n(265516);function R(e){const{environment:t,droppedStores:n,duplicate:i,calendarBy:l,transaction:u,collectionContextStore:g,duplicateActions:y}=e,S=o().c9.fromMillis(e.startOfDay);let h=!0;for(const o of n){const t=e.collectionStore?e.collectionStore:(0,_().Dj)({store:o,collectionContextStore:g});if(o.getParentTable()===d().Vl||!t){h=!1;break}v().X$({childStore:o,parentStore:t,transaction:u})||(h=!1)}const b=(0,f().T)({environment:t,droppedStores:n,duplicate:i,transaction:u,collectionStore:e.collectionStore,duplicateActions:y});for(const o of b){const n=e.collectionStore?e.collectionStore:(0,_().Dj)({store:o,collectionContextStore:g});if(!n)continue;const i=n.getMappedProperty(l),d=o.getPropertyStore(i),f=(0,r().b)(d.getValue())||s().Ec((0,c().P)()),v=s().kW(f,(0,c().P)()),y=S.toFormat(s().tr);let b;if("date"===v.type||"datetime"===v.type)b={...v,start_date:y};else{const e=s().AA(v,(0,c().P)());if(!e.end)return;const t={...v,start_date:y},n=s().AA(t,(0,c().P)()).start.diff(e.start,"days"),o=e.end.plus(n).toFormat(s().tr);b={...v,start_date:y,end_date:o}}const C=s().kW(b,a().$K(f)||(0,c().P)());(0,m().j)({environment:t,store:o,collectionStore:n,collectionContextStore:g,shouldCoerce:!0,groupsPointer:[],transaction:u,alreadyMovedToCollection:h}),k({environment:t,type:"dateValue",propertyId:i,store:o,transaction:u,dateValue:C}),(0,p().E)({environment:t,collectionContextStore:g,block_id:o.id,property:i,property_type:"date",from:"calendar"})}}function w(e){const{calendarStore:t,direction:n,targetStore:o}=e;t.setState({...t.state,isDragging:!0,targetStore:o,direction:n,temporaryValue:void 0})}function A(e){const{calendarStore:t,x:n,y:i,calendarBy:d}=e,u=t.state;if(u.isDragging){const e=(0,r().b)(u.targetStore.getPropertyStore(d).getValue());if(!e)return;const p=s().kW(e,(0,c().P)()),m=u.temporaryValue||e,f=s().kW(m,(0,c().P)()),g=[];u.dayStoreMap.forEach(((e,t)=>{g.push({store:e,timestamp:t})}));const v=g.find((e=>{let{store:t}=e;const o=h().T.getRectFromStore(t);return Boolean(o&&b().ux(o,n,i))}));let y;if(v){const e=o().c9.fromMillis(v.timestamp),t=e.endOf("day"),n=e.toFormat(s().tr);if(p){const r=s().AA(p,(0,c().P)());if(u.direction===M().Q.Left)if(o().IX.fromDateTimes(e,t).contains(r.start))y=p;else{let e;e="datetimerange"===p.type||"daterange"===p.type?{...p,start_date:n,end_date:p.end_date}:"datetime"===p.type?{type:"datetimerange",start_date:n,start_time:p.start_time,end_date:p.start_date,end_time:p.start_time,time_zone:p.time_zone,reminder:p.reminder}:{type:"daterange",start_date:n,end_date:p.start_date,reminder:p.reminder};const t=s().AA(e,(0,c().P)());y=!r.end&&t.start>r.start||r.end&&t.start>r.end?f:e}else if(r.end?o().IX.fromDateTimes(e,t).contains(r.end):o().IX.fromDateTimes(e,t).contains(r.start))y=p;else{let e;e="date"===p.type?{...p,type:"daterange",end_date:n}:"datetime"===p.type?{...p,type:"datetimerange",end_date:n,end_time:"00:00"}:{...p,end_date:n};const t=s().AA(e,(0,c().P)());y=t.end&&t.end<t.start?f:e}}}if(y&&!l().n4(f,y)){const e=s().kW(y,a().$K(m)||(0,c().P)());t.setState({...u,temporaryValue:e})}}}function E(e){const{environment:t,calendarStore:n,calendarBy:o,transaction:r}=e,i=n.state;i.isDragging&&i.temporaryValue&&(k({type:"dateValue",environment:t,dateValue:i.temporaryValue,propertyId:o,store:i.targetStore,transaction:r}),n.setState({...n.state,isDragging:!1}))}function I(e){const{calendarStore:t}=e,n=t.state;n.isDragging&&t.setState({...n,isDragging:!1})}function P(e){const{environment:t,store:n,collectionStore:r,collectionContextStore:a,startDayOfWeek:d,transaction:l}=e,u=a.dateRangeStartStore.state,p=(0,c().P)(),f=a.normalizedQueryStore.state;if(!f||!f.calendar_by)return;const g=(null==r?void 0:r.getMappedProperty(f.calendar_by))??f.calendar_by,v=s().hp(u,d,p),S=v.startOf("month"),_=v.endOf("month"),h=o().c9.now().startOf("day");let b;return b=o().IX.fromDateTimes(S,_).contains(h)?s().p6(h.valueOf(),p):s().p6(s().iB(u,d,p).valueOf(),p),y().zv({store:n.getPropertiesStore(),data:{[g]:i().m5(b)},transaction:l}),(0,m().j)({environment:t,store:n,collectionStore:r,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:l}),n}function k(e){const{environment:t,store:n,propertyId:o,transaction:r}=e;let a;"timestamp"===e.type?a=s().p6(e.timestampMs.valueOf(),(0,c().P)()):"dateValue"===e.type?a=e.dateValue:(0,u().HB)(e);const d=n.getPropertyValue(o),l=i().m5(a);y().zv({store:n.getPropertiesStore(),data:{[o]:l},transaction:r}),g().O({environment:t,store:n,dateProperty:{id:o,oldValue:d,newValue:l}})}function D(e){const{environment:t,collectionStore:n,calendarBy:o,store:r,insertStores:i,collectionContextStore:a,transaction:s}=e,c=r.getPropertyStore(o).getValue();for(const d of i)(0,m().j)({environment:t,store:d,collectionStore:n,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:s}),S().R9({environment:t,store:d.getPropertyStore(o),value:c,transaction:s});return i.map((e=>C().Bv.createChildStore(n,e.pointer)))}}}]);