"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[37125],{82954:(e,t,o)=>{o.d(t,{A:()=>_});var n=o(242343),i=()=>o(803290),s=()=>o(502852),r=()=>o(752597),a=()=>o(384221),l=()=>o(755786),c=()=>o(126451),d=()=>o(709237),u=o(163643);function m(e){const{blockStore:t,titleStyle:o,shouldWrap:i,recordTitleRef:s,disableTooltip:m}=e,p=(0,n.useRef)({getNode:()=>s.current}),g=(0,n.useCallback)((e=>{r().default.afterNextFlush((()=>{const e=t.getBlockTitleStore();if(!e)return;const o=e.getValue(),n=o?o[0][0].length:0,i={start:{index:n,store:e},end:{index:n,store:e}};a().setMultiSelection({multiSelection:i})}))}),[t]);return(0,u.jsx)(c().A,{style:{height:l().d0+2,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:5,padding:"6px 8px 7px 8px",overflow:"hidden"},onClick:g,children:(0,u.jsx)(d().A,{store:t,underline:!0,shouldWrap:i,style:o,ref:p,disableTooltip:m})})}var p=()=>o(653998),g=()=>o(975392),h=()=>o(868199),f=()=>o(477784),x=()=>o(636045);const v=(0,p().YK)({typeTitle:{defaultMessage:"Type a title...",id:"relationToken.title.placeholder"}});function S(e){const{blockStore:t,clickTitleBehavior:o,onTitleEnter:n,onTitleEsc:s}=e,r="edit"===o,a=(0,i().K8)((()=>t.getBlockTitleStore()),[t]);return(0,u.jsx)(x().A,{store:a,disabled:!r,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:n,onEsc:s,onTab:g().D_,placeholder:f().A.formatMessage(v.typeTitle),style:{padding:"6px 8px 7px 8px",textOverflow:"none",overflow:"visible",whiteSpace:"pre"},disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:h().Os.none})}var b=()=>o(237385),C=()=>o(34662),y=()=>o(448316);const k=function(e){const{store:t,style:r,disableLinks:a,disableHover:l,isAndroid:c,externalIntegrations:d,canEdit:m,shouldWrap:g,tokenFormat:h}=e,f=(0,n.useRef)(null),x=(0,p().tz)(),v=(0,b().v3)(),S=(0,o(174114).DP)(),{isExternalIntegrationPageType:k,blockType:A,blockId:j,blockModel:w}=(0,i().K8)((()=>{const e=t.getModel();return{isExternalIntegrationPageType:Boolean(null==e?void 0:e.isType(o(762847).xd.externalObjectInstancePage)),blockType:t.getType(),blockId:t.id,blockModel:e}}),[t]),I=(0,i().K8)((()=>o(284320).A.getState()),[]),L=(0,n.useCallback)((()=>{if(!f||!f.current)return;const e=(0,C().bMp)(t.id),o=(0,C().wmz)(e);return{textValue:[o],tokenIndex:0,textToken:o,node:f.current}}),[f,t.id]),R=(0,n.useCallback)((e=>{if(l)return;const o=L(),n=t.getTitleStore();n&&o&&y().xE({environment:v,event:e,interactiveToken:o,store:n,canEdit:m})}),[l,L,t,v,m]),B=(0,n.useCallback)((e=>{const o=L(),n=t.getTitleStore();n&&o&&!l&&y().HH({environment:v,event:e,interactiveToken:o,store:n,canEdit:m})}),[L,t,l,v,m]),D=t.getRecordModel,M=j,T=(0,o(441165).FN)(v),_=o(927685).A.domainBaseUrl,E=v.currentUser.id,F=!a,U=(0,i().K8)((()=>{if(w)return(0,o(123047).gA)({blockModel:w,shouldWrap:g,index:0,style:r,disableHover:l,disableLinks:a,isAndroid:c,theme:S,getRecordModel:D,currentUserId:E,baseUrl:_,emojiType:T,externalIntegrations:d,classNames:[],intl:x,emojiData:I,stopLinkPropagation:F,tokenFormat:(0,o(250786).Ug)(h)})}),[w,g,r,l,a,c,S,D,E,_,T,d,x,I,F,h]);return M?"external_object_instance_page"!==A?null:k?(0,u.jsx)("span",{ref:f,onMouseOver:R,onMouseOut:B,onClick:F?s().kV:void 0,style:{width:"100%"},children:U}):null:null};function A(e){const{blockStore:t,shouldWrap:n,style:s,disableLinks:r,format:a}=e,l=(0,i().K8)((()=>(0,o(809811).q7)(t.getSyncedUri())),[t]),c=(0,i().O$)(o(773082).A.integrations),d=(0,b().v3)();return(0,u.jsx)(k,{shouldWrap:n,store:t,style:s,disableHover:r||!l,disableLinks:r||!l,isAndroid:d.device.isAndroid,externalIntegrations:c,canEdit:!0,tokenFormat:a})}var j=()=>o(219322);function w(e){const{format:t,showRemoveButton:n,onClickRemove:i}=e,{height:s,closeIconSize:r}=j().U[t];return n?(0,u.jsx)(c().A,{onClick:i,style:{display:"flex",alignItems:"center",justifyContent:"center",width:s,height:s,marginLeft:2,marginRight:2,flexGrow:0,flexShrink:0,borderRadius:4},children:(0,o(388732).l)({width:r,height:r,opacity:.5})}):null}var I=()=>o(712437),L=()=>o(314164),R=()=>o(749975),B=()=>o(29869),D=()=>o(485966);var M=()=>o(621641),T=()=>o(205670);const _=(0,n.forwardRef)((function(e,t){const{parentStore:s,blockId:r,shouldWrap:a,format:l,showRemoveButton:c,clickTitleBehavior:d,onClickRemove:m,titleStyle:p,onTitleEnter:g,onTitleEsc:h,index:f,noUnderline:x,disableTooltip:v,disableLinks:S}=e,b=o(413871).Bv.createChildStore(s,{table:o(145017).ev,id:r}),{style:C}=(0,j().t)(e),y=(0,n.useRef)(null),k=(0,n.useRef)(null),I="peek"===d;(0,n.useImperativeHandle)(t,(()=>b),[b]);const L=(0,i().K8)((()=>"external_object_instance_page"===b.getType()),[b]);if((0,o(731991).W)(b))return null;if(L)return(0,u.jsx)(A,{shouldWrap:a,blockStore:b,style:C,disableLinks:S,format:l});const R=(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(o(957881).w,{format:l,blockStore:b,clickTitleBehavior:d,shouldWrap:a}),(0,u.jsx)(F,{blockStore:b,recordTitleRef:y,clickTitleBehavior:d,shouldWrap:a,titleStyle:p,noUnderline:x,onTitleEnter:g,onTitleEsc:h,index:f,disableTooltip:v})]});return(0,u.jsxs)("div",{style:C,ref:k,children:[I?(0,u.jsx)(E,{blockStore:b,relationTokenStyle:C,children:R}):R,(0,u.jsx)(w,{showRemoveButton:c,onClickRemove:m,format:l})]})}));function E(e){let{blockStore:t,relationTokenStyle:r,children:a}=e;const{blockUrlPage:l,blockUrlPeek:c}=function(e){const t=(0,b().v3)(),o=(0,R().Ks)(),n=(0,i().K8)((()=>(0,B().Ay)({store:e,fullyQualified:!1,pageVisitSource:I().y8.LinkInPage})),[e]);return{blockUrlPeek:(0,i().K8)((()=>{const{mainEditorCurrentBlockStore:n}=D().default.state;return L().wy({environment:t,store:e,mainEditorCurrentBlockStore:n,collectionContextStore:o,fullyQualified:!1})}),[t,e,o]),blockUrlPage:n}}(t),d=(0,n.useMemo)((()=>({display:r.display,height:r.height,alignItems:r.alignItems})),[r]);return(0,u.jsx)(o(579494).A,{href:l,metaHref:c,onClick:s().kV,style:d,children:a})}function F(e){const{blockStore:t,clickTitleBehavior:n,onTitleEnter:s,onTitleEsc:r,index:a,recordTitleRef:l,titleStyle:c,shouldWrap:d,noUnderline:p,disableTooltip:g}=e,h=(0,o(248584).Sm)(t),f="edit"===n&&!h,x=function(e){return(0,i().K8)((()=>{var t;const o=T().default.state;return"editing"===o.mode&&(null===(t=(0,M().H7)(o.multiSelection))||void 0===t?void 0:t.store)===e.getBlockTitleStore()}),[e])}(t);return f?x&&s&&a?(0,u.jsx)(S,{blockStore:t,clickTitleBehavior:n,onTitleEnter:s,onTitleEsc:r}):(0,u.jsx)(m,{blockStore:t,recordTitleRef:l,titleStyle:c,shouldWrap:d,disableTooltip:g}):(0,u.jsx)(o(399631).Y,{blockStore:t,recordTitleRef:l,titleStyle:c,shouldWrap:d,noUnderline:p,disableTooltip:g})}},113757:(e,t,o)=>{o.r(t),o.d(t,{Comment:()=>Je,CommentFileBlock:()=>_o().A,Discussion:()=>Mt,DiscussionIndicator:()=>_t().Ay,DiscussionInput:()=>Ge().A,DiscussionReactionBar:()=>ye().tx,MOBILE_REACTION_PILL_STYLE_OVERRIDES:()=>ye().ZR,MarginCommentsSection:()=>So,NewDiscussionMenu:()=>Ro,PropertyDiscussionIndicator:()=>Kt,REACTION_PILL_STYLE:()=>ye().Of,ReactionBar:()=>ye().Ay,ReplyDiscussionMenu:()=>Mo,SuggestionContext:()=>Rt,discussionHelpers:()=>T(),discussionViewActions:()=>n,reactionActions:()=>Eo()});var n={};o.r(n),o.d(n,{isCommentUnread:()=>it});o(725707),o(491955);var i=o(242343),s=()=>o(752597),r=()=>o(237385),a=()=>o(556078),l=()=>o(158247),c=()=>o(803290),d=()=>o(174114),u=()=>o(446588),m=()=>o(34662),p=()=>o(653998),g=()=>o(31448),h=()=>o(90290),f=()=>o(145046),x=()=>o(111066),v=()=>o(384221),S=()=>o(84543),b=()=>o(889358),C=()=>o(966789),y=()=>o(611824),k=()=>o(735976),A=()=>o(874413),j=()=>o(360482),w=()=>o(873929),I=()=>o(750169),L=()=>o(983965),R=()=>o(413871),B=()=>o(317566),D=()=>o(798096),M=()=>o(990910),T=()=>o(991708);function _(e){return e.isFirstComment&&"comment_unfurl"!==e.discussionLocation&&"post_top_level_discussion"!==e.discussionLocation}var E=()=>o(227268),F=()=>o(695387),U=(o(362833),()=>o(712437)),P=()=>o(762847),z=()=>o(566581),K=()=>o(725494),N=()=>o(423162),W=()=>o(81322),H=()=>o(711361),O=()=>o(718799),V=()=>o(237185),Y=()=>o(686752),$=()=>o(745719),G=o(163643);const J=(0,o(680369).wt)("reopen",{viewBox:"0 0 14 14",svg:(0,G.jsx)("path",{d:"M1.64844 7.88477C1.64844 10.791 3.98047 13.1289 6.88086 13.1289C9.78125 13.1289 12.1133 10.791 12.1133 7.88477C12.1133 7.53906 11.873 7.29297 11.5273 7.29297C11.1934 7.29297 10.9707 7.53906 10.9707 7.88477C10.9707 10.1582 9.14844 11.9805 6.88086 11.9805C4.61328 11.9805 2.79688 10.1582 2.79688 7.88477C2.79688 5.59961 4.60156 3.78906 6.86328 3.78906C7.25 3.78906 7.60742 3.81836 7.90625 3.88281L6.3125 5.46484C6.20703 5.57617 6.1543 5.69922 6.1543 5.85156C6.1543 6.17383 6.39453 6.41992 6.71094 6.41992C6.875 6.41992 7.00977 6.36719 7.10938 6.26172L9.51758 3.83594C9.64062 3.71289 9.69922 3.57227 9.69922 3.41406C9.69922 3.26172 9.63477 3.10938 9.51758 2.99219L7.10938 0.548828C7.00977 0.4375 6.875 0.378906 6.71094 0.378906C6.39453 0.378906 6.1543 0.636719 6.1543 0.953125C6.1543 1.10547 6.20703 1.24023 6.30664 1.3457L7.72461 2.74609C7.4668 2.69336 7.16797 2.66406 6.86328 2.66406C3.96875 2.66406 1.64844 4.98438 1.64844 7.88477Z"})});var Z=()=>o(436105),X=()=>o(836693),Q=()=>o(409211),q=()=>o(975392),ee=()=>o(76394),te=()=>o(91472),oe=()=>o(535906),ne=()=>o(273520),ie=()=>o(356813),se=()=>o(935091),re=()=>o(858023),ae=()=>o(397791),le=()=>o(88271),ce=()=>o(103151),de=()=>o(797631),ue=()=>o(927685),me=()=>o(983050),pe=()=>o(640979),ge=()=>o(378219),he=()=>o(392608),fe=()=>o(622286),xe=()=>o(485966),ve=()=>o(836331),Se=()=>o(161439);o(403517);var be=()=>o(953422),Ce=()=>o(590057),ye=()=>o(466754);const ke=(0,p().YK)({addReaction:{id:"comment.actions.addReaction.label",defaultMessage:"Add reaction"},acceptButton:{id:"comment.actions.acceptButton.label",defaultMessage:"Accept"},rejectButton:{id:"comment.actions.rejectButton.label",defaultMessage:"Reject"},moreActions:{id:"comment.actions.moreActions.label",defaultMessage:"More actions"},reopenButton:{id:"comment.actions.reopenButton.label",defaultMessage:"Re-open"},resolveButton:{id:"comment.actions.resolveButton.label",defaultMessage:"Resolve"}});function Ae(e){const{discussionLocation:t,isFirstComment:o,blockStore:n,discussionStore:s}=e,l=(0,p().tz)(),d=(0,r().v3)(),m=d.device,g=(0,i.useRef)(null),f=(0,a().S)(),x=(0,c().K8)((()=>Boolean(s.getResolved())),[s]),v=(0,c().K8)((()=>e.store.isDefined()),[e.store]),b=(0,c().K8)((()=>{var e;return null===(e=xe().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),C=(0,c().K8)((()=>{const t=e.store.getCreatedById();return e.store.getCreatedByTable()===Q().oo&&b===t}),[b,e.store]),y=(0,c().K8)((()=>{var e;const t=null===(e=xe().default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&u().Km(t)}),[]),k=(0,c().K8)((()=>n.getRole()),[n]),A=(0,c().K8)((()=>{var e;return null==f||null===(e=f.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==f?void 0:f.publicEditModeStore]),{isFirstCommentOfSuggestionDiscussion:j,disableAccept:w}=(0,c().K8)((()=>{var t;const o="suggestion"===s.getType()&&s.getCommentPointers()[0].id===e.store.id,i=(null===(t=n.getNavigableBlockStore())||void 0===t?void 0:t.canEdit())??!1;return{isFirstCommentOfSuggestionDiscussion:o,disableAccept:o&&!i}}),[s,n,e.store]),I=(0,c().K8)((()=>n.pathIsDead()),[n]),L=(0,c().K8)((()=>_({isFirstComment:o,discussionLocation:t})),[o,t]),R="comment_only"===k||"comment"===A,D=(0,fe().X)("comment_sidebar_for_you"),M=(0,c().K8)((()=>s.isUnread(ve().default.getConfigKey("assume_comment_read","last_seen_at"))),[s]),T=(0,i.useCallback)((()=>S().createAndCommit({userAction:"Comment.markDiscussionRead",environment:d,canUndo:!0,perform:e=>(0,Se().U)({transaction:e,discussionStore:s})})),[d,s]),E=(0,i.useCallback)((()=>S().createAndCommit({userAction:"Comment.markDiscussionUnread",environment:d,canUndo:!0,perform:e=>function(e){const{transaction:t,discussionStore:o}=e,n=o.userId;if(!n)return;const i=o.getCommentStores().map((e=>e.getCreatedTime())),s=i.length?Math.max(...i):void 0,r=o.getUserSeenRecordStore(n);return S().applyOperation({store:r,operation:{pointer:r.pointer,path:[],command:"update",args:{user_id:n,space_id:r.pointer.spaceId,parent_id:o.id,parent_table:o.table,last_seen_at:s?s-1:void 0}},transaction:t}),o}({transaction:e,discussionStore:s})})),[d,s]);if(!v||!b)return null;const F=()=>{S().createAndCommit({userAction:"Comment.handleReopen",environment:d,canUndo:!0,perform:t=>{B().E3({environment:d,commentStore:e.store,discussionStore:s,transaction:t,discussionLocation:e.discussionLocation})}})},W=t=>{S().createAndCommit({userAction:"Comment.handleResolve",environment:d,canUndo:!0,perform:t=>{(0,be().j)({environment:d,commentStore:e.store,discussionStore:s,transaction:t,discussionLocation:e.discussionLocation})}}),h().UP(),null==t||t.stopPropagation()},H=()=>{S().createAndCommit({userAction:"Suggestion.handleAccept",environment:d,canUndo:!0,perform:t=>{Ce()._3({action:"accept",environment:d,commentStore:e.store,discussionStore:s,transaction:t,discussionLocation:e.discussionLocation,currentPageStore:ge().fA(s)})}}),h().UP()},$=()=>{S().createAndCommit({userAction:"Suggestion.handleReject",environment:d,canUndo:!0,perform:t=>{Ce()._3({action:"reject",environment:d,commentStore:e.store,discussionStore:s,transaction:t,discussionLocation:e.discussionLocation,currentPageStore:ge().fA(s)})}}),h().UP()},J=async()=>{var t,o;const n=e.store.getParentStore();if(!n||null==n||!n.isDefined())return null;let i=n.getParentStore();if(null===(t=i)||void 0===t||!t.isDefined())return null;var s;i.getType()===P().xd.tableRow&&(i=null===(s=i)||void 0===s?void 0:s.getParentBlockStore());if(null===(o=i)||void 0===o||!o.isDefined())return null;const r=i.getModel().getRenderUrl({baseUrl:ue().A.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:n.id,pageVisitSource:U().y8.CopyLink}),a=await te().R.clipboardActions.load();a.copyString({environment:d,stringValue:r,copiedMessage:a.clipboardMessages.copiedLinkToClipboard})};if(!d.currentUser.isLoggedIn())return null;const Z=k&&u().h9(k)||I;if(Z)return null;const ie=L&&!m.isMobile&&!R&&!Z,ce=[];m.isMobile&&!R&&!Z&&e.isFirstComment&&(x?ce.push("reopen"):ce.push("resolve")),!j&&C&&ce.push("edit"),o&&(ce.push("copyLink"),D&&(M?ce.push("markDiscussionRead"):ce.push("markDiscussionUnread"))),j||!C&&!y||ce.push("delete");const ke=ce.length>0;return ke||ie||e.canShowReactions?(0,G.jsx)(ne().Ay,{ref:g,popupType:m.isMobile?ne().z7.BottomSheet:ne().z7.Popup,bottomSheetInitialState:"half",buttonPopupStore:e.buttonPopupStore,placementToOrigin:ne().sx.Right,stopClickPropagation:!0,renderOrigin:o=>(0,G.jsx)(Ie,{buttonConfig:{resolve:{visible:ie&&!j,resolved:x,onResolve:W,onReopen:F},react:{visible:e.canShowReactions,onReact:()=>{var o;(0,ye().uJ)(d,l,e.store,(null===(o=g.current)||void 0===o?void 0:o.getAnchor())??null,t,e.handleReaction)}},accept:{visible:j&&!w&&!x,onAccept:H},reject:{visible:j&&!x&&(!R||C),onReject:$},moreActions:{visible:ke}},visible:e.visible,buttonPopupEvents:o,discussionLocation:e.discussionLocation,store:e.store}),render:t=>{let o;o=m.isMobile?{menuType:pe().gu.Modal,title:(0,G.jsx)(p().sA,{id:"comment.mobileCommentMenu.title",defaultMessage:"Comment"})}:{menuType:pe().gu.Popup};const n=ce.map((t=>"reopen"===t?{key:"reopen",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:z().w}),title:(0,G.jsx)(p().sA,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})}),action:F}:"resolve"===t?{key:"resolve",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:K().checkmarkIcon}),title:(0,G.jsx)(p().sA,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})}),action:()=>W()}:"edit"===t?{key:"edit",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:Y().pencilLineIcon}),title:(0,G.jsx)(p().sA,{id:"comment.editComment.button",defaultMessage:"Edit comment"})}),action:e.handleEditComment}:"delete"===t?{key:"delete",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:X().trashIcon}),title:(0,G.jsx)(p().sA,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})}),action:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:O().w}),title:(0,G.jsx)(p().sA,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})}),action:J}:"markDiscussionRead"===t?{key:"markDiscussionRead",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:N().checkmarkCircleIcon}),title:(0,G.jsx)(p().sA,{id:"comment.markDiscussionRead.button",defaultMessage:"Mark as read"})}),action:T}:"markDiscussionUnread"===t?{key:"markDiscussionUnread",render:e=>(0,G.jsx)(oe().A,{...e,icon:(0,G.jsx)(ae().I,{icon:V().C}),title:(0,G.jsx)(p().sA,{id:"comment.markDiscussionUnread.button",defaultMessage:"Mark as unread"})}),action:E}:void(0,ee().HB)(t)));return(0,G.jsx)("div",{className:me().Jb,children:(0,G.jsxs)(se().A,{...o,children:[(0,G.jsx)(re().Ay,{type:re().Oh.Vertical,initialFocus:void 0,onAccept:t.close,sections:q().oE([n.length&&{key:0,render:e=>(0,G.jsx)(le().A,{...e}),items:n}])}),!m.isMobile&&(0,G.jsx)(le().A,{topBorder:!0,disableDesktopPadding:!1,children:(0,G.jsx)(de().A,{title:(0,G.jsx)(p().sA,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,he().xS)("guides.comments"),analyticsFrom:"comments"})})]})})}}):null}function je(e){return"accept"in e}function we(e){return"resolve"in e}function Ie(e){const{buttonPopupEvents:t,buttonConfig:o}=e,n=(0,r().v3)().device,i=(0,p().tz)(),s=(0,d().IS)((t=>({addIcon:{height:21,width:21,fill:t.mediumIconColor},container:{display:"flex",boxShadow:"0px 2px 12px 0px rgba(29, 27, 22, 0.06)",borderWidth:1,borderStyle:"solid",borderColor:t.stroke.secondary,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,right:0,...n.isMobile?{borderRadius:6,top:-3}:{marginRight:0,marginTop:"updates_sidebar"===e.discussionLocation?6:0,opacity:e.visible?1:0,gap:1,borderRadius:6,transition:"opacity 100ms ease-out",zIndex:1,top:-4}}})),[n.isMobile,e.discussionLocation,e.visible]);return(0,G.jsxs)("div",{style:s.container,children:[je(o)&&o.accept.visible&&(0,G.jsx)(ce().A,{renderTooltip:()=>(0,G.jsx)(p().sA,{...ke.acceptButton}),render:e=>(0,G.jsx)(ie().A,{hasBackground:!1,showShadow:!1,icon:Z().q,onClick:o.accept.onAccept,ariaLabel:i.formatMessage(ke.acceptButton),...e})}),je(o)&&o.reject.visible&&(0,G.jsx)(ce().A,{renderTooltip:()=>(0,G.jsx)(p().sA,{...ke.rejectButton}),render:e=>(0,G.jsx)(ie().A,{hasBackground:!1,showShadow:!1,icon:W().V,onClick:o.reject.onReject,iconStyle:{height:18,width:18},ariaLabel:i.formatMessage(ke.rejectButton),...e})}),o.react.visible&&(0,G.jsx)(ce().A,{renderTooltip:()=>(0,G.jsx)(p().sA,{...ke.addReaction}),render:e=>(0,G.jsx)(ie().A,{ariaLabel:i.formatMessage(ke.addReaction),hasBackground:!1,showShadow:!1,icon:()=>(0,$().s)(s.addIcon),onClick:o.react.onReact,...e})}),we(o)&&o.resolve.visible&&(0,G.jsx)(ce().A,{renderTooltip:()=>(0,G.jsx)(p().sA,{...o.resolve.resolved?ke.reopenButton:ke.resolveButton}),render:e=>(0,G.jsx)(ie().A,{hasBackground:!1,showShadow:!1,icon:o.resolve.resolved?J:Z().q,onClick:o.resolve.resolved?o.resolve.onReopen:o.resolve.onResolve,...e,ariaLabel:i.formatMessage(o.resolve.resolved?ke.reopenButton:ke.resolveButton)})}),o.moreActions.visible&&(0,G.jsx)(ce().A,{renderTooltip:()=>(0,G.jsx)(p().sA,{...ke.moreActions}),render:e=>(0,G.jsx)(ie().A,{...t,...e,hasBackground:!1,showShadow:!1,icon:H()._,ariaLabel:i.formatMessage(ke.moreActions)})})]})}var Le=()=>o(980001),Re=()=>o(410090),Be=()=>o(265987),De=()=>o(273191),Me=()=>o(558914);const Te=3;function _e(e){let{stores:t,collapsed:o,shouldShowGrayFogInScroller:n,onRemoveBlockFromComment:i}=e;return 0===t.length?null:t.length<=Te?(0,G.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,G.jsx)(De().A,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o,onRemoveBlockFromComment:i}},e.id)))}):(0,G.jsx)(Me().A,{shouldShowGrayFog:n,children:t.map((e=>(0,G.jsx)(De().A,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o,onRemoveBlockFromComment:i}},e.id)))})}var Ee=()=>o(164186),Fe=()=>o(126451);const Ue=3,Pe=4;function ze(e){let{stores:t,embedBlockLocation:o,onRemoveContent:n}=e;const i=(0,r().v3)();if(0===t.length)return null;if(t.length<=Ue)return(0,G.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,G.jsx)(Ke,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!0},e.id)))});if(t.length<=Pe)return(0,G.jsx)("div",{style:{display:"flex",gap:4},children:t.map((e=>(0,G.jsx)(Ke,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},e.id)))});const s=t.slice(0,Pe-1),a=t[Pe-1],l=t.length-Pe+1,c=t.slice(Pe);return(0,G.jsxs)("div",{style:{display:"flex",gap:4},children:[s.map((e=>(0,G.jsx)(Ke,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},e.id))),(0,G.jsxs)("div",{children:[(0,G.jsx)(Fe().A,{style:{position:"absolute",zIndex:1,width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.4)",borderRadius:8,color:"white",fontWeight:g().Wy.bold},hoveredStyle:{background:"rgba(0, 0, 0, 0.4)"},pressedStyle:{background:"rgba(0, 0, 0, 0.4)"},onClick:()=>{Ee().iy({environment:i,blockStore:a})},children:`+${l}`}),(0,G.jsx)(Ke,{store:a,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},a.id)]}),(0,G.jsx)("div",{style:{display:"none"},children:c.map((e=>(0,G.jsx)(Ke,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},e.id)))})]})}function Ke(e){let{store:t,isLarge:o,embedBlockLocation:n,onRemoveContent:i}=e;const s=(0,d().IS)((e=>({imageShared:{border:`1px solid ${e.stroke.secondary}`,borderRadius:8,cursor:"zoom-in"}})),[]);return(0,G.jsx)(Re().Ay,{store:t,blockLocation:n,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{...s.imageShared,...o?Ne:We},disableActions:!o,onRemoveBlockFromComment:o?i:void 0},t.id)}const Ne={objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48},We={width:48,height:48,minWidth:48,minHeight:48};var He=()=>o(335157);function Oe(e){let{store:t}=e;const o=(0,c().K8)((()=>Be().default.getKeyState(Be().default.getBlockKey(t.id))),[t.id]),n=(0,p().tz)(),i=(0,d().IS)((e=>({wrapper:{height:48,width:214,display:"flex",alignItems:"center",background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"8px 10px 8px 8px",gap:8},icon:{background:e.tint.regular,borderRadius:6,width:32,minWidth:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},fileDetails:{display:"flex",flexDirection:"column"},fileName:{fontSize:14,fontWeight:g().Wy.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{color:e.text.secondary},progressText:{color:e.text.tertiary},sizeAndProgressContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"15px"}})),[]);if(!o)return(0,G.jsxs)("div",{style:i.wrapper,children:[(0,G.jsx)("div",{style:i.icon,children:(0,G.jsx)(C().A,{})}),(0,G.jsx)("div",{style:i.fileDetails,children:(0,G.jsx)("div",{style:i.fileName,children:n.formatMessage({id:"commentFilePlaceholder.loading",defaultMessage:"Loading..."})})})]});const{name:s,size:r,progressPercent:a,progressText:l}=o;return(0,G.jsxs)("div",{style:i.wrapper,children:[(0,G.jsx)("div",{style:i.icon,children:(0,G.jsx)(C().A,{})}),(0,G.jsx)("div",{style:{overflow:"hidden"},children:(0,G.jsxs)("div",{style:i.fileDetails,children:[(0,G.jsx)("div",{style:i.fileName,children:s}),(0,G.jsxs)("div",{style:i.sizeAndProgressContainer,children:[(0,G.jsx)("span",{style:i.fileSizeText,children:(0,T().formatFileSize)(r)}),(0,G.jsx)("span",{style:i.progressText,children:"—"}),(0,G.jsx)(C().A,{}),a?(0,G.jsx)(He().A,{percentage:a,style:i.progressText}):l?(0,G.jsx)("span",{children:l}):null]})]})})]})}function Ve(e){let{stores:t}=e;return 0===t.length?null:(0,G.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,G.jsx)(Oe,{store:e},e.id)))})}function Ye(e){const t=e.discussionFormat===T().DiscussionFormat.Sidebar?Le().ZO.SidebarComment:Le().ZO.PageComment,{uploading:o,images:n,embeds:i,files:s}=(0,c().K8)((()=>{const[t,o]=q().jB(e.contentStores,(e=>{const t=Boolean(Be().default.getKeyState(Be().default.getBlockKey(e.id))),o=(0,Re().x7)(e);return t||!o})),[n,i]=q().jB(o,(e=>e.getType()===P().xd.image)),[s,r]=q().jB(i,(e=>"video"===e.getType()));return{uploading:t,images:n,embeds:s,files:r}}),[e.contentStores]);return 0===o.length&&0===n.length&&0===i.length&&0===s.length?null:(0,G.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:8},children:[(0,G.jsx)(Ve,{stores:o}),(0,G.jsx)(ze,{stores:n,embedBlockLocation:t,onRemoveContent:e.onRemoveContent}),i.length>0&&(0,G.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:i.map((o=>(0,G.jsx)(Re().Ay,{store:o,blockLocation:t,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{},onRemoveBlockFromComment:e.onRemoveContent},o.id)))}),(0,G.jsx)(_e,{stores:s,collapsed:e.collapsed,shouldShowGrayFogInScroller:e.discussionHovered&&(e.discussionFormat===T().DiscussionFormat.Margin||e.discussionFormat===T().DiscussionFormat.Sidebar),onRemoveBlockFromComment:e.onRemoveContent})]})}function $e(){const e=(0,fe().X)("inbox_page_grouping_notification_style"),t=(0,d().IS)((e=>({newBarLine:{height:"0px",borderBottom:`1px solid ${e.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:e.text.secondary,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:g().Wy.semibold,display:"flex",alignItems:"center",margin:0,paddingTop:10,paddingBottom:10,paddingLeft:M().FB},newBarPill:{padding:"0 10px",whiteSpace:"nowrap"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:M().jw,height:"100%",borderRadius:2,left:M().im,top:-6}})),[]),o=(0,d().IS)((e=>({newBarLine:{height:"0px",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.tint.uiBlue,width:"100%",marginLeft:0},newBarWrapper:{color:e.text.secondary,fontSize:10,fontWeight:g().Wy.regular,display:"flex",alignItems:"center",paddingTop:10,paddingBottom:10,paddingLeft:M().FB},newBarPill:{textTransform:"uppercase",height:16,display:"flex",alignItems:"center",paddingLeft:4,paddingRight:4,whiteSpace:"nowrap",borderRadius:4,backgroundColor:e.tint.uiBlue,color:e.text.uiBluePrimary,marginLeft:12,marginRight:12},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:M().jw,height:"100%",borderRadius:2,left:M().im,top:-6}})),[]),n=e?o:t;return(0,G.jsxs)("div",{style:{position:"relative"},children:[(0,G.jsx)("div",{style:n.threadLine}),(0,G.jsxs)("div",{style:n.newBarWrapper,children:[(0,G.jsx)("div",{style:n.newBarLine}),(0,G.jsx)("div",{style:n.newBarPill,children:e?(0,G.jsx)(p().sA,{id:"comment.newBar.label",defaultMessage:"New"}):(0,G.jsx)(p().sA,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,G.jsx)("div",{style:n.newBarLine})]})]})}var Ge=()=>o(78906);const Je=function(e){const{store:t,discussionContext:n,discussionLocation:U,shouldShowThreadLine:P,discussionStore:z,blockStore:K,collapsed:N}=e,W=(0,r().v3)(),[H,O]=(0,i.useState)(!1),[V,Y]=(0,i.useState)(!1),[$,J]=(0,i.useState)(!1),[Z,X]=(0,i.useState)(!1),[Q,q]=(0,i.useState)("post_top_level_discussion"===U&&N),ee=(0,c().K8)((()=>e.store.isDefined()?new(E().A)(W,e.store.getSpaceId()):void 0),[W,e.store]),te=(0,c().K8)((()=>j().dd(e.store).filter((e=>(0,R().G_)(e,{table:o(145017).ev,id:e.id},"alive").getValue()))),[e.store]),oe=(0,c().K8)((()=>z.getResolved()),[z]),ne=(0,c().K8)((()=>null==ee?void 0:ee.state.files),[ee]),ie=(0,c().K8)((()=>null==ee?void 0:ee.state.textStore),[ee]),se=(0,i.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,o(152058).p)(t)&&Y(!0)}),[]),re=(0,i.useCallback)((()=>{Y(!1)}),[]),ae=(0,i.useCallback)((()=>{L().A.state||J(!0)}),[]),le=(0,i.useCallback)((()=>{J(!1)}),[]),ce=(0,a().S)(),de=(0,c().uB)(void 0,o(962373).A),ue=(0,c().K8)((()=>de.state.open),[de]),me=(0,o(248584).Sm)(K),pe=(0,c().K8)((()=>(0,o(439146).o7)(e.store.id)),[e.store.id]),ge=(0,c().K8)((()=>{const t=e.discussionStore.getComments();return Boolean(t&&t[0]===e.store.id)}),[e.discussionStore,e.store.id]),he=(0,c().K8)((()=>{var t;const o=K.getRole(),n=_({isFirstComment:ge,discussionLocation:U}),i=K.pathIsDead(),s=o&&u().h9(o)||i,{device:r}=W,a="comment_only"===o||ce&&"comment"===(null===(t=ce.publicEditModeStore.state)||void 0===t?void 0:t.permission),l=n&&!r.isMobile&&!a&&!s;return $||V||e.hoveringDiscussion&&n||ue||r.isMobile||e.showResolveButtonByDefaultIfPossible&&l}),[K,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,ge,U,W,ce,$,V,ue]),fe=(0,i.useContext)(o(817181).R),xe=(0,c().K8)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:t.getLastEditedTime(),createdTime:t.getCreatedTime(),text:t.getText(),reactions:R().Lk.getUserVisibleReactions(t)}:null}),[t]),ve=(0,c().K8)((()=>xe?R().sk.createChildStore(t,xe.createdByPointer):null),[xe,t]),Se=function(e){const{discussionLocation:t,isCommentCollapsed:o,isDiscussionCollapsed:n,maxLines:i}=e;if("post_top_level_discussion"===t)return o?i:void 0;return n?i:void 0}({discussionLocation:U,isCommentCollapsed:Q,isDiscussionCollapsed:N,maxLines:e.maxLines}),be=(0,i.useCallback)((()=>{S().createAndCommit({userAction:"Comment.deleteComment",environment:W,canUndo:!0,perform:t=>{B().Tu({environment:W,commentStore:e.store,transaction:t,discussionLocation:U})},skipUpdatingEditedMetadata:!0})}),[W,e.store,U]),Ce=(0,i.useCallback)((async()=>{const{accept:e}=await f().Gh({message:(0,G.jsx)(p().sA,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:(0,G.jsx)(p().sA,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})});e&&(be(),h().UP(),F().A.state.overlapsExistingDiscussionMenu&&!I().A.state.open&&F().A.setState({...F().A.state,overlapsExistingDiscussionMenu:!1}),D().jS(W))}),[be,W]),ke=(0,i.useCallback)((async t=>{const o=j().gp(e.store).getValue(),n=j().dd(e.store).filter((e=>e.id!==t.id)),i=o&&o.length>0,s=0===n.length;!i&&s?(await Ce(),O(!1)):S().createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:W,canUndo:!0,perform:o=>{B().L6({commentStore:e.store,fileBlocks:[t],transaction:o})}})}),[W,Ce,e.store]),je=(0,i.useCallback)((()=>{X(!0)}),[]),we=(0,i.useCallback)((async()=>{if(!ee)return;const t=j().gp(e.store).getValue()||[],n=ee.state.textStore;S().createAndCommit({userAction:"Comment.handleEditComment",environment:W,canUndo:!0,perform:e=>{o(448316).R9({environment:W,store:n,value:t,transaction:e})}}),O(!0),await s().default.afterNextFlush(),await s().default.afterNextFlush(),v().setSelectionAtEnd({store:n})}),[ee,W,e.store]),Ie=(0,i.useCallback)((async()=>{if(!ee)return!1;if(!(0,T().hasCommentChanged)(ee,e.store))return O(!1),!0;{const{accept:e}=await f().Gh({message:(0,G.jsx)(p().sA,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:(0,G.jsx)(p().sA,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})});if(e)return O(!1),!0}return!1}),[ee,e.store]),Le=(0,i.useCallback)((async()=>{const t=null==ie?void 0:ie.getValue();t&&t.length>0||ne&&ne.length>0?S().createAndCommit({userAction:"Comment.handleSubmitEdit",environment:W,canUndo:!0,perform:o=>{B().QA({environment:W,store:e.store,text:t||[],transaction:o,discussionLocation:U,files:ne||[],property_id:z.getPropertyId(),blockStore:K})}}):await Ce(),O(!1)}),[ie,ne,W,e.store,U,z,K,Ce]),Re=(0,i.useCallback)((()=>{"post_top_level_discussion"===U&&q(!1)}),[U]),Be=(0,i.useRef)(null),De=(0,i.useRef)(null);(0,l().b)(w().A,(()=>({edit:we,handleCancelEdit:Ie,getNode:()=>Be.current,isEditing:()=>H,discussionLocation:U,commentId:e.store.id})),[we,Ie,H,U,e.store.id]);const Me=null==xe?void 0:xe.text,Te=void 0!==Me&&Me.length>0&&m().AhH(Me)>0,_e=Te&&(0,T().isCommentAllEmojis)(Me),Ee=function(e){let{discussionLocation:t,isAllEmojis:o}=e;return(0,d().IS)((e=>({container:{flexGrow:"comment_unfurl"===t?1:void 0,paddingTop:"comment_unfurl"===t?M().ds:M().e4,paddingRight:"margin_comments"===t?12:16,paddingBottom:M().Wv,paddingLeft:M().SM(t)},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:M().FB},discussionInputContainer:{width:"calc(100% + 8px)"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,borderRadius:2,width:M().jw,height:M().k2,left:M().im,top:M().uG},unfurlMoreWrapper:{color:e.text.tertiary,fontWeight:"comment_unfurl"===t?g().Wy.medium:void 0,display:"block",marginBottom:-1.5,pointerEvents:"auto"},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,lineHeight:"20px",paddingTop:4,...o?{fontSize:32,lineHeight:"32px"}:{}},attachmentContainer:{display:"flex",alignItems:"center"},commentAttachment:{},authorRowContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},unreadStatusDot:{display:"flex",flexDirection:"row",alignItems:"center",marginRight:4}})),[t,o])}({discussionLocation:U,isAllEmojis:_e}),Fe=(0,i.useMemo)((()=>({type:"comment_match",commentId:e.store.id})),[e.store.id]),Ue="comment_unfurl"!==U,Pe=Ue&&xe&&xe.reactions.length>0;if((0,i.useEffect)((()=>{Z&&De.current&&Pe&&(x().hT({element:De.current,environment:W,scrollerContext:fe,vertical:{reveal:"closest"},horizontal:void 0,animate:!0}),X(!1))}),[W,fe,Z,Pe]),!ee)return null;if(!xe||!ve)return null;const ze=te.length>0&&(0,G.jsx)("div",{style:Ee.commentAttachment,children:(0,G.jsx)(Ye,{contentStores:te,onRemoveContent:ke,discussionFormat:(0,T().discussionLocationToDiscussionFormat)(U),collapsed:N,discussionHovered:e.hoveringDiscussion})});return(0,G.jsxs)("div",{ref:Be,onClick:e=>H&&e.stopPropagation(),style:Ee.container,children:[e.showNewBar&&(0,G.jsx)($e,{}),(0,G.jsxs)("div",{style:Ee.comment,onFocus:se,onBlur:re,onMouseMove:ae,onMouseLeave:le,children:[(0,G.jsxs)("div",{style:Ee.authorRowContainer,children:[(0,G.jsx)(o(874512).Y,{createdTime:xe.createdTime,lastEditedTime:xe.lastEditedTime,location:U,isResolved:oe,isSuggestionComment:e.isSuggestionComment,authorStore:ve}),e.showUnreadStatusDot&&(0,G.jsx)("div",{style:Ee.unreadStatusDot,children:(0,G.jsx)(A().m,{size:b().jd})})]}),P&&(0,G.jsx)("div",{style:Ee.threadLine}),(0,G.jsxs)("div",{style:Ee.commentElementsBelowUserRow,children:[Boolean(n)&&n,H&&(0,G.jsx)("div",{style:{marginTop:4},children:(0,G.jsx)(Ge().A,{containerStyle:Ee.discussionInputContainer,showAvatar:!1,parentStore:e.store,blockStore:K,onCancel:Ie,onSubmit:Le,discussionInputStore:ee,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,T().discussionLocationToDiscussionFormat)(U),canDrop:!0})}),Te&&!H&&(0,G.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,G.jsx)(k().A,{onMore:"comment_unfurl"===U?void 0:Re,moreElement:(0,G.jsxs)(y().A,{disableUnderline:!0,style:Ee.unfurlMoreWrapper,hoverColor:"blue",children:["…"," ",(0,G.jsx)("span",{children:(0,G.jsx)(p().sA,{id:"comment.truncated.showMoreLabel",defaultMessage:"more"})})]}),maxLines:Se,children:(0,G.jsx)(o(636045).A,{style:Ee.text,store:j().gp(e.store),disabled:!0,disabledMentionTypes:{date:!0},disableEquationInteraction:!0,inPageFind:Fe})}),me&&pe&&(0,G.jsx)(C().A,{style:{alignSelf:"flex-end",marginRight:8,marginLeft:8}})]}),H||"comment_unfurl"===U?!Te&&(0,G.jsxs)("div",{style:Ee.attachmentContainer,children:[(0,G.jsx)("div",{style:{marginRight:5},children:(0,o(219530).j)(Ee.attachIcon)}),(0,G.jsx)(p().sA,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:te.length},id:"comment.unfurl.attachments.title"})]}):ze,Pe&&(0,G.jsx)("div",{ref:De,style:{marginTop:8},children:(0,G.jsx)(ye().Ay,{parentStore:e.store,discussionLocation:U})})]}),"comment_unfurl"!==U&&!H&&!me&&(0,G.jsx)(Ae,{store:e.store,discussionStore:e.discussionStore,blockStore:K,discussionLocation:U,visible:he,isFirstComment:ge,buttonPopupStore:de,canShowReactions:Ue,handleEditComment:we,handleDeleteComment:Ce,handleReaction:je})]})]})};o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(500234);var Ze=()=>o(590110),Xe=()=>o(496580),Qe=()=>o(400885),qe=()=>o(96297),et=()=>o(564837),tt=()=>o(37394),ot=()=>o(979537),nt=()=>o(977853);function it(e){var t;let{discussionStore:o,commentStore:n}=e;if(!n.isDefined())return!1;const i=null===(t=xe().default.state.currentUserStore)||void 0===t?void 0:t.id;const s=nt().A.state.lastInteractionTimes[o.id];if(n.getCreatedById()===i)return!1;const r=function(){if(!o.isDefined()||!i)return 0;const{pageVisitStore:e}=xe().default.state,{lastViewTime:t,lastExitTime:n}=e.state;return n||t}();if(void 0===r)return!1;const a=(0,T().getAndSortCommentStoresByTime)(o).filter((e=>e.getCreatedById()===i)).reverse()[0],l=n.getCreatedTime();return!l||!(a&&l<a.getCreatedTime())&&(!(s&&l<s)&&l>r)}var st=()=>o(1476),rt=()=>o(284594),at=()=>o(723361),lt=()=>o(579494),ct=()=>o(501578);const dt="https://notion.notion.site/AI-Conflict-Detection-158efdeead058037b57efc2b77ad9c21";function ut(e){let{origin:t}=e;const n=(0,d().IS)((e=>({learnMoreLink:{color:e.text.contrastPrimary}})),[]);return(0,G.jsx)(o(290656).B,{origin:t,placementToOrigin:"bottom",tutorialId:"ai-comment-onboarding",tutorialStepId:"ai-comment-onboarding-tooltip",hideActions:!0,hideInsteadOfFlip:!0,header:(0,G.jsx)(p().sA,{id:"AiCommentOnboardingTooltip.header",defaultMessage:"Check for conflicts with Notion AI"}),content:(0,G.jsx)(p().sA,{id:"AiCommentOnboardingTooltip.content",defaultMessage:"Notion AI searches across your workspace and connected apps for conflicting information, using only sources that all members can access. {learnMoreLink}",values:{learnMoreLink:(0,G.jsx)(o(155347).o,{href:dt,style:n.learnMoreLink})}})})}function mt(e){const{discussionLocation:t,commentStore:o}=e,n=(0,c().K8)((()=>{if(!o)return!1;const e=o.getCreatedByPointer();return!!e&&e.id===st().px.id}),[o]),i=(0,r().Y0)(),s=(0,d().IS)((e=>({container:{display:"flex",flexDirection:"row",gap:6,width:"100%",color:e.text.tertiary,fontSize:i.isMobile?g().J.UISmall.mobile:g().J.UISmall.desktop,paddingTop:M().e4,paddingLeft:M().SM(t)+M().eQ-8},warningIcon:{width:10,height:10,alignSelf:"center",display:"inline-block",verticalAlign:"text-bottom"},helpIcon:{color:e.text.tertiary,flexDirection:"row-reverse",gap:6,width:14,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto"},text:{maxWidth:200}})),[i,t]);return n?(0,G.jsxs)("div",{style:s.container,children:[(0,at().Q)(s.warningIcon),(0,G.jsx)(ct().j,{style:s.text,children:(0,G.jsx)(p().sA,{id:"aiCommentHeader.conflictingContent.label",defaultMessage:"Notion AI found potential conflicts"})}),(0,G.jsx)(lt().A,{href:dt,external:!0,style:s.helpIcon,children:(0,rt().$)({width:14,marginRight:4})})]}):null}var pt=()=>o(729932),gt=()=>o(109642),ht=()=>o(252295),ft=()=>o(809324),xt=()=>o(615386);var vt=()=>o(393728),St=()=>o(477784);const bt=(0,p().YK)({helpful:{id:"assistant.commentFeedback.helpful",defaultMessage:"Helpful"},notHelpful:{id:"assistant.commentFeedback.notHelpful",defaultMessage:"Not helpful"}});function Ct(e){const{blockStore:t}=e,n=t.id,i=function(e){const t=(0,r().v3)(),o=(0,c().K8)((()=>{const o=e.getNavigableBlockStore();if(o)return new(R().Gd)(t,{table:ft().bw,id:o.id,spaceId:o.getSpaceId()})}),[t,e]);return(0,c().K8)((()=>{if(!o)return;const t=e.id,n=o.getRelatedContent().find((e=>e.targetId===t));return n?{feedback:xt().A.state[n.inferenceId],inferenceId:n.inferenceId}:void 0}),[o,e.id])}(t),s=null==i?void 0:i.feedback,a=null==i?void 0:i.inferenceId,l=(0,r().v3)(),u=(0,o(863969).O)(),m=(0,d().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12,width:"100%"},buttonRow:{display:"flex",flexDirection:"row",gap:8}})),[]);return a?(0,G.jsx)(vt().hP,{surface:vt().wy.conflictingContentComment,children:(0,G.jsx)("div",{style:m.container,children:(0,G.jsxs)("div",{style:m.buttonRow,children:[(0,G.jsx)(ht().Ay,{title:St().A.formatMessage(bt.helpful),variant:"tinted",icon:"thumbs_up"===s?o(815500).x:o(411928).x,onClick:()=>{if(!u||!a)return;const e=t.getNavigableBlockStore();e&&(0,gt().H8)({environment:l,pageId:e.id,blockId:n,spaceId:u,inferenceId:a,thumbsUpOrDown:"up"})}}),(0,G.jsx)(ht().Ay,{title:St().A.formatMessage(bt.notHelpful),variant:"tinted",icon:"thumbs_down"===s?o(61153).a:o(122041).Q,onClick:()=>{if(!u||!a)return;const e=t.getNavigableBlockStore();e&&(0,gt().H8)({environment:l,pageId:e.id,blockId:n,spaceId:u,inferenceId:a,thumbsUpOrDown:"down"})}})]})})}):null}const yt={block_menu:"8px 16px 0px",page_discussion:"8px 0px 0px",updates_sidebar:"4px 16px 12px",margin_comments:"8px 12px 6px",comment_unfurl:"0",post_top_level_discussion:"8px 16px 0px",updates_menu_mentions_comments:"4px 16px 12px",updates_menu_all_updates:"4px 16px 12px",updates_menu_archive:"4px 16px 12px",reply_menu_mentions_comments:"8px 16px 0px",reply_menu_all_updates:"8px 16px 0px",reply_menu_archive:"8px 16px 0px",reply_menu_updates_sidebar:"8px 16px 0px",ai_reject_all_suggestions:"0"},kt=i.forwardRef((function(e,t){const n=(0,r().v3)(),{format:s,role:a,showMoreCommentsButton:l,onMoreCommentsClick:m,inputVisible:p,blockStore:g,store:h}=e,f=(0,o(838517).i0)(g),x=a&&u().h9(a)||f,v=n.currentUser.isLoggedIn(),S=(0,i.useRef)(null),b=(0,d().IS)((t=>({container:{position:"relative",padding:0,...s===T().DiscussionFormat.Page?{marginLeft:16,marginRight:16}:{}},discussionInputContainer:{padding:yt[e.discussionLocation]},aiFeedbackContainer:{display:"flex",flexDirection:"row",gap:8,marginLeft:"page_discussion"===e.discussionLocation?32:24,padding:yt[e.discussionLocation]}})),[s,e.discussionLocation]),C=(0,c().K8)((()=>{const e=h.getCommentStores()[0];if(!e)return!1;const t=e.getCreatedByPointer();return!!t&&t.id===st().px.id}),[h]);return v&&!x&&(l||p)?(0,G.jsxs)("div",{style:b.container,children:[l&&(0,G.jsx)(o(525779).d,{enableIcon:!0,onClick:m}),p&&(C?(0,G.jsxs)("div",{style:b.aiFeedbackContainer,ref:S,children:[(0,G.jsx)(Ct,{blockStore:g,location:e.discussionLocation}),(0,G.jsx)(ut,{origin:S})]}):(0,G.jsx)(Ge().A,{autoFocus:!0,showAvatar:!0,containerStyle:b.discussionInputContainer,parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded}))]}):null}));var At=()=>o(209684);function jt(e){const t=(0,d().IS)((t=>{const o=M().SM(e.discussionLocation)+M().eQ;return{moreCommentsWrapper:{color:t.text.tertiary,fontSize:14,flexGrow:1,display:"flex",alignItems:"center",paddingLeft:8},button:{borderRadius:6,fontSize:14,color:t.text.secondary,justifyContent:"space-between",padding:"14px 0",margin:`0 0 0 ${o}px`,width:`calc(100% - ${o}px - 16px)`},buttonHovered:{background:t.focusDiscussionInputBackground},threadLine:{position:"absolute",backgroundColor:t.stroke.secondary,width:M().jw,height:"100%",top:M().e4-M().Yz,left:M().SM(e.discussionLocation)+M().im,borderRadius:2}}}),[e.discussionLocation]);return e.count<=0?null:(0,G.jsxs)("div",{style:{position:"relative"},children:[(0,G.jsx)("div",{style:t.threadLine}),(0,G.jsx)(At().p,{isGray:!0,size:"xs",style:t.button,onClick:e.onClick,hoveredStyle:t.buttonHovered,children:(0,G.jsx)("div",{className:"discussion-show-all-button",style:t.moreCommentsWrapper,children:(0,G.jsx)(p().sA,{defaultMessage:"Show {moreCommentsNumber, plural, one {{moreCommentsNumber} reply} other {{moreCommentsNumber} replies}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})})},"show")]})}var wt=()=>o(882746),It=()=>o(441165),Lt=()=>o(654548);function Rt(e){const{discussionStore:t}=e,o=(0,p().tz)(),n=(0,c().K8)((()=>t.isSuggestionDiscussion()),[t]),i=(0,c().K8)((()=>{const t=e.discussionStore.getContext();return(t?(0,Ze().Qe)({discussionContextData:t,discussionId:e.discussionStore.id,discussionType:(0,Xe().o9)(e.discussionStore.getType()),intl:o}):[])??[]}),[e.discussionStore,o]),s=(0,d().IS)((e=>({container:{marginTop:2},label:{color:e.text.uiBlueSecondary,fontSize:14,lineHeight:"18px"},labelDeleteColor:{color:e.text.tertiary},text:{color:e.text.uiBluePrimary,fontSize:14,lineHeight:1.29},textDeleteColor:{color:e.text.secondary},suggestionContextItem:{display:"block",marginBottom:4,whiteSpace:"pre-wrap",wordBreak:"break-word"},unfurlMoreWrapper:{color:e.text.tertiary,fontWeight:g().Wy.medium,display:"block",marginBottom:-1.5,pointerEvents:"auto"}})),[]),r=(0,wt().RX)(o).title;return n&&r&&0!==i.length?(0,G.jsx)("div",{style:s.container,children:(0,G.jsx)(k().A,{maxLines:e.collapsed?1:void 0,clampOverride:{lineHeight:1.29,fontSize:14},moreElement:(0,G.jsxs)(y().A,{disableUnderline:!0,style:s.unfurlMoreWrapper,hoverColor:"blue",children:["…"," ",(0,G.jsx)("span",{children:(0,G.jsx)(p().sA,{id:"suggestion.truncated.showMoreLabel",defaultMessage:"more"})})]}),children:i.map(((e,o)=>{let{label:n,value:i,shouldUseDeleteColor:r,removeQuotationMarks:a}=e;return(0,G.jsxs)("div",{style:s.suggestionContextItem,children:[(0,G.jsxs)("span",{style:{...s.label,...r&&s.labelDeleteColor},children:[n,": "]}),(0,G.jsxs)("span",{style:{...s.text,...r&&s.textDeleteColor},children:[a?null:"“",(0,G.jsx)(Bt,{value:i,discussionStore:t}),a?null:"”"]})]},o)}))})}):null}function Bt(e){let{value:t,discussionStore:o}=e;const n=(0,r().v3)(),i=(0,d().DP)(),s=(0,c().K8)((()=>(0,Lt().S5)({environment:n,textValue:{value:t,spaceId:o.pointer.spaceId},parentStore:o,disableHover:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!0,disabled:!0,theme:i,emojiType:(0,It().FN)(n),katex:n.KatexStore.getKatex(),formulaValueTypes:[]})),[n,t,o,i]);return(0,G.jsx)("span",{children:s})}function Dt(e){const{onDismiss:t}=e,n=(0,i.useRef)(null),a=(0,p().tz)(),u=(0,r().v3)(),g=(0,c().K8)((()=>"suggestion"===e.store.getType()),[e.store]),h=(0,c().K8)((()=>j().wc(e.store)),[e.store]),b=(0,c().K8)((()=>h.filter((e=>e.isDefined())).filter((e=>Boolean(e.getAlive())))),[h]),C="page_discussion"===e.discussionLocation?3:5;(0,i.useEffect)((()=>{b.length===C&&P(!0)}),[b,C]);const y=(0,i.useRef)(e.discussionInputStore||new(E().A)(u,e.store.pointer.spaceId)).current,k=(0,c().K8)((()=>(0,T().inputIsEmpty)(y)),[y]),I=(0,c().K8)((()=>(0,Qe().fc)(e.blockStore)&&!(0,Qe().Cg)(e.blockStore)),[e.blockStore]),D=(0,c().K8)((()=>e.store.getResolved()),[e.store]),[_,F]=(0,i.useState)(!1),[U,P]=(0,i.useState)(void 0!==e.collapsed&&!e.collapsed),[z,K]=(0,i.useState)(!0),N=(0,c().uB)(void 0,o(580257).A),W=(0,c().K8)((()=>N.state.clientRect),[N]),H=e.format===T().DiscussionFormat.Sidebar,O=e.format===T().DiscussionFormat.Margin,V=(0,i.useRef)(null);(0,l().b)(o(156282).A,(()=>({isSidebarFormat:()=>H,isMarginFormat:()=>O,getStore:()=>e.store,getInputStore:()=>y,getNode:()=>V.current,getMarginDiscussionScrollContainer:()=>n.current})),[H,O,e.store,y]);const Y=(0,c().K8)((()=>{if(!H)return;return(0,T().getAndSortCommentStoresByTime)(e.store).find((t=>it({discussionStore:e.store,commentStore:t})))}),[H,e.store]),$=(0,i.useRef)(Y),J=(0,fe().X)("comment_sidebar_for_you"),Z=(0,c().K8)((()=>J&&function(e){const{discussionStore:t,navigableBlockStore:o}=e;if(!o)return!1;const n=t.userId,i=o.getSpaceId();return Boolean(n&&i&&(0,et().R)({userId:n,blockStore:o,discussionStores:[t],groupIdsUserIsIn:ot()._.getSpacePermissionGroupIds({userId:n,spaceId:i})}).length)}({discussionStore:e.store,navigableBlockStore:e.blockStore.getNavigableBlockStore()})),[J,e.store,e.blockStore]),X=(0,c().K8)((()=>J&&(Z||e.store.hasEverBeenRead())&&Boolean(e.store.isUnread(ve().default.getConfigKey("assume_comment_read","last_seen_at")))),[J,Z,e.store]),Q=(0,c().K8)((()=>{if(!J)return void 0===$.current?Y:$.current;if(!e.store.getSpaceId())return;const t=e.store.getUserSeenRecordStore();if(!t)return;const o=t.getLastSeenAt();if(!o)return Y;const n=b.find((e=>e.getCreatedTime()>o));return n||void 0}),[J,Y,$,b,e.store]),te=(0,i.useCallback)((()=>{var t;if(U||b.length<=C||"block_menu"===e.discussionLocation)return b;if("page_discussion"===e.discussionLocation)return q().O6(b,1);const o=[e.showAllRepliesAfterTimestamp,null===(t=$.current)||void 0===t?void 0:t.getCreatedTime(),null==Y?void 0:Y.getCreatedTime()].filter(ee().O9),n=o.length>0?Math.min(...o):void 0;if(n){const e=b.filter((e=>(e.getCreatedTime()||0)>n)),t=b.filter((e=>(e.getCreatedTime()||0)<=n));return t.length<=5?b:[...q().O6(t,2),...e]}return q().O6(b,2)}),[b,Y,C,e.discussionLocation,e.showAllRepliesAfterTimestamp,U]),oe=(0,c().K8)((()=>{const t=te(),o=new Set(t.map((e=>e.id))),n=b.filter((e=>!o.has(e.id)));return{commentStores:b,commentsToShow:t,commentsToCollapse:n,reactionsToShow:R().Lk.getUserVisibleReactions(e.store)}}),[b,te,e.store],{useDeepEqual:!0}),ne=(0,i.useCallback)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;const o=(0,Ze().l8)({discussionContextData:t,discussionType:(0,Xe().o9)(e.store.getType()),discussionId:e.store.id,intl:a});return m().JJ$(o,(t=>!m().iQL(t)||m().Orm(t)===e.store.id))}),[e.store,a]),ie=(0,c().K8)((()=>{if(!H)return;return(0,T().getAndSortCommentStoresByTime)(e.store).find((t=>it({discussionStore:e.store,commentStore:t})))}),[H,e.store]),se=(0,i.useRef)(null),re=(0,i.useRef)(e.blockStore.clone()).current,ae=(0,d().IS)((t=>({discussionWrapper:{...e.format===T().DiscussionFormat.Page&&{margin:`0px ${M().Ql}px 16px`,..."post_top_level_discussion"===e.discussionLocation&&{marginLeft:-16,marginBottom:oe.reactionsToShow.length>0?0:12}},...e.format===T().DiscussionFormat.Menu&&{padding:"6px 0 12px",marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===T().DiscussionFormat.Margin&&{padding:"4px 0",borderRadius:8}},reactionBarWrapper:{paddingLeft:16,paddingRight:16,..."post_top_level_discussion"===e.discussionLocation&&{display:"flex",justifyContent:"space-between"}}})),[oe.reactionsToShow.length,e.discussionLocation,e.format,e.isFirst]);(0,i.useEffect)((()=>{u.KatexStore.loadIfNeeded(ne)}),[u.KatexStore,ne]);const le=(0,i.useCallback)((t=>{const{device:n}=u;if(!n.isMobile)return;if(!e.store.isDefined())return;t.stopPropagation(),t.preventDefault(),o(218746).A.setState({open:!1});const i=q().oE(tt().T.findSelectablesFromIds([e.store.getParentId()])),s=null==i?void 0:i[0];s&&x().pb({environment:u,handle:s,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[e.store,u]),ce=(0,i.useCallback)((e=>{O||(e.stopPropagation(),P(!0))}),[O]),de=(0,i.useMemo)((()=>{const{commentStores:t,commentsToShow:i,commentsToCollapse:s}=oe;if(O){const i=(0,T().lineClampForCommentCount)(t.length);if(!e.collapsed)return(0,G.jsx)(o(142708).H,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll"},ref:n,type:o(98508).A.Y,store:N,children:t.map(((o,n)=>{const s=g&&0===n;return(0,G.jsx)(Je,{store:o,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:_,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:i,shouldShowThreadLine:n!==t.length-1,discussionContext:s?(0,G.jsx)(Rt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,showNewBar:o.id===(null==Q?void 0:Q.id)&&0!==n,isSuggestionComment:s,showUnreadStatusDot:0===n&&X},o.id)}))});const s=t[0]&&(0,G.jsx)(Je,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:_,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:i,collapsed:e.collapsed,shouldShowThreadLine:1!==t.length,discussionContext:g?(0,G.jsx)(Rt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:g,showUnreadStatusDot:X},t[0].id),r=t.length>1&&t[t.length-1]&&(0,G.jsx)(Je,{store:t[t.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:_,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:i,collapsed:e.collapsed,shouldShowThreadLine:!1,showUnreadStatusDot:!1},t[t.length-1].id),a=t.length-2;return(0,G.jsxs)(G.Fragment,{children:[s,(0,G.jsx)(jt,{insetButton:!O,count:a,onClick:ce,discussionLocation:e.discussionLocation}),r]})}const r=s.length>0,a=i.map(((t,o)=>{const n=g&&0===o,s=0===o&&!r,a=n?(0,G.jsx)(Rt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):s&&(e.format===T().DiscussionFormat.Menu||e.format===T().DiscussionFormat.Sidebar)&&(0,G.jsx)(pt().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:le}),l="post_top_level_discussion"===e.discussionLocation?(0,T().lineClampForCommentCount)(i.length):void 0;return(0,G.jsx)(Je,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:_,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:a,isSuggestionComment:n,showNewBar:t.id===(null==Q?void 0:Q.id)&&0!==o,shouldShowThreadLine:o!==i.length-1,maxLines:l,showUnreadStatusDot:s&&X},t.id)})),l=g,c=l?(0,G.jsx)(Rt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):(e.format===T().DiscussionFormat.Menu||e.format===T().DiscussionFormat.Sidebar)&&(0,G.jsx)(pt().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:le});return(0,G.jsxs)("div",{style:{position:"relative"},children:[!J&&H&&ie&&(0,G.jsx)(A().m,{style:Tt}),r&&(0,G.jsx)(Je,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:_,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:c,shouldShowThreadLine:1!==t.length,isSuggestionComment:l,collapsed:e.collapsed,maxLines:"post_top_level_discussion"===e.discussionLocation&&e.collapsed?(0,T().lineClampForCommentCount)(t.length):void 0,showUnreadStatusDot:X},t[0].id),(0,G.jsx)(jt,{insetButton:!O,count:s.length-1,onClick:ce,discussionLocation:e.discussionLocation}),a]})}),[oe,O,g,e.store,e.collapsed,e.format,e.discussionLocation,e.blockStore,e.showResolveButtonByDefaultIfPossible,le,H,ie,_,X,ce,N,null==Q?void 0:Q.id,J]),ue=(0,c().K8)((()=>e.blockStore.getRole()),[e.blockStore]),[me,pe]=(0,i.useState)(!0);(0,i.useEffect)((()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.getNode();if(t){function o(){t&&pe(qe().wU(t))}return t.addEventListener("scroll",o),()=>t.removeEventListener("scroll",o)}}),[n]);const ge=z&&!e.collapsed&&O&&W&&!me,he=(0,i.useCallback)((()=>{const e=tt().T.findSelectableFromStore(re);e&&x().pb({environment:u,handle:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[re,u]),xe=(0,i.useCallback)((()=>{y.reset()}),[y]),be=(0,i.useCallback)((()=>{const t=u.currentUser.id;if(!t)return;const o=j().wc(e.store).filter((e=>e.getCreatedById()===t)),n=q().HV(o);if(!n)return;if(g&&1===o.length)return;const i=w().A.find((t=>t.commentId===n.id&&t.discussionLocation===e.discussionLocation));i&&(v().clear({environment:u}),i.edit())}),[e.discussionLocation,g,e.store,u]),Ce=(0,i.useCallback)((async()=>{if((0,T().hasCommentChanged)(y)){const{accept:e}=await f().Gh({message:(0,G.jsx)(p().sA,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:(0,G.jsx)(p().sA,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})});e?(xe(),t&&t()):(await s().default.afterNextFlush(),v().setSelectionAtEnd({store:y.state.textStore}))}else xe(),t&&t()}),[t,y,xe]),ke=(0,i.useCallback)((()=>{s().default.afterNextFlush((()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.getNode();t&&qe().VG({element:t,environment:u,options:{top:t.scrollHeight,behavior:"smooth"}})}))}),[n,u]),Ae=q().sg((()=>{setTimeout((()=>K(!0)),50)}),50),je=(0,i.useCallback)((async()=>{K(!1);const{device:t}=u;S().createAndCommit({userAction:"Discussion.handleSubmitReply",environment:u,canUndo:!0,perform:t=>{B().lV({environment:u,discussionStore:e.store,textValue:y.state.textStore.getValue()||[],transaction:t,discussionLocation:e.discussionLocation,files:y.state.files,property_id:e.store.getPropertyId(),blockStore:e.blockStore}),ve().default.checkGate({gateName:"comment_sidebar_for_you"})&&(0,Se().U)({transaction:t,discussionStore:e.store})}}),xe(),v().clear({environment:u}),ke(),Ae(),t.isMobile||(await s().default.afterNextFlush(),v().setSelectionAtStart({store:y.state.textStore}))}),[y,Ae,e.blockStore,e.store,e.discussionLocation,ke,u,xe]),we=(0,i.useCallback)((()=>{L().A.state||F(!0)}),[]),Ie=(0,i.useCallback)((()=>{F(!1)}),[]);return 0===oe.commentsToShow.length&&oe.reactionsToShow.length>0||"post_top_level_discussion"===e.discussionLocation&&0===oe.commentsToShow.length&&oe.reactionsToShow.length>0?(0,G.jsxs)("div",{ref:V,style:{...ae.discussionWrapper,...ae.reactionBarWrapper},onMouseMove:we,onMouseLeave:Ie,children:[(0,G.jsx)(ye().tx,{focused:!0,disableShadow:!0,parentStore:e.store,discussionLocation:e.discussionLocation}),"post_top_level_discussion"===e.discussionLocation&&e.pageVisitStore&&e.presenceStore&&(0,G.jsx)(o(907933).hJ,{pageVisitStore:e.pageVisitStore,presenceStore:e.presenceStore,rootStore:e.blockStore,maxUsers:5,isShowingInPostFeed:!0})]}):(0,G.jsx)(o(367859).A,{store:re,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;se.current&&await se.current.uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:(0,G.jsxs)("div",{ref:V,style:ae.discussionWrapper,onMouseMove:we,onMouseLeave:Ie,children:[!e.collapsed&&(0,G.jsx)(mt,{commentStore:h[0],discussionLocation:e.discussionLocation}),de,D?(0,G.jsx)("div",{style:{height:8}}):(0,G.jsx)(kt,{ref:se,showMoreCommentsButton:Boolean(ge),onMoreCommentsClick:ke,inputVisible:!(I||e.collapsed&&k&&"post_top_level_discussion"!==e.discussionLocation),store:e.store,blockStore:re,format:e.format,discussionInputStore:y,discussionLocation:e.discussionLocation,onCancel:Ce,onSubmit:je,onEditPreviousComment:be,showCtaButtons:!!O||void 0,onFileUploaded:he,role:ue})]})})}const Mt=i.memo(Dt),Tt={marginRight:4,position:"absolute",right:16,top:14};var _t=()=>o(500350),Et=()=>o(610271),Ft=()=>o(48913),Ut=()=>o(377561);const Pt=(0,p().YK)({commentsAriaLabel:{defaultMessage:"{count, plural, one {1 comment} other {{count} comments}}",id:"comments.components.discussionindicator.commentAriaLabel"},suggestionsAriaLabel:{defaultMessage:"{count, plural, one {1 suggestion} other {{count} suggestions}}",id:"comments.components.discussionindicator.suggestionAriaLabel"},reactionsAriaLabel:{defaultMessage:"{count, plural, one {1 reaction} other {{count} reactions}}",id:"comments.components.discussionindicator.reactionsAriaLabel"}});function zt(e){const t=(0,p().tz)(),{store:n,propertyId:i,style:s}=e,{showIndicator:a,formattedReactionCount:l,onlySuggestions:u,icon:m,showReactionsIcon:h,onlyHasDraftIndicator:f,formattedCommentCount:x,handleClick:v,discussionIsSelected:S,commentsCount:b,shouldShowDraftIndicator:C}=(0,o(286395).A)({store:n,recursivelyLoadAllDiscussions:!1,onlyCountBlockLevelDiscussions:!1,propertyId:i}),y=(0,d().IS)((e=>({iconButton:{background:S?e.selectLightGray[100]:void 0,gap:2},icon:{width:14,color:e.text.tertiary},commentCaptionStyle:{fontWeight:g().Wy.semibold,...C?{color:e.icon.tertiary}:{color:e.text.tertiary,marginBottom:1}},reactionCaptionStyle:{fontWeight:g().Wy.semibold,color:e.text.tertiary}})),[S,C]),k=(0,r().v3)(),A=(0,c().K8)((()=>(0,Ft().me)(k)),[k]),j=(0,c().K8)((()=>(0,Ut().dC)(k,n)),[k,n]),{isPropertyInPageDetails:w}=(0,o(604284)._1)({store:n,propertyId:i});return!a||!w&&(A||j)?null:(0,G.jsxs)(Et().Ye,{style:s,children:[(b>0||f)&&(0,G.jsxs)(Et().Ye,{style:{position:"relative"},children:[(0,G.jsx)(ie().A,{ariaLabel:u?t.formatMessage(Pt.suggestionsAriaLabel,{count:x}):t.formatMessage(Pt.commentsAriaLabel,{count:x}),icon:m,style:y.iconButton,iconStyle:y.icon,onClick:v,caption:x,captionStyle:y.commentCaptionStyle}),C&&(0,G.jsx)(o(55299).h,{customTop:3,customLeft:16,onlyShowDraftDot:!0})]}),h&&(0,G.jsx)(ie().A,{ariaLabel:t.formatMessage(Pt.reactionsAriaLabel,{count:l}),icon:o(34362).l,style:y.iconButton,iconStyle:y.icon,onClick:v,captionStyle:y.reactionCaptionStyle,caption:l})]})}const Kt=i.memo(zt);var Nt=()=>o(615917),Wt=()=>o(724903),Ht=()=>o(496985),Ot=()=>o(123047),Vt=()=>o(610546),Yt=()=>o(747459),$t=(o(324989),o(113085),()=>o(214263)),Gt=()=>o(225349),Jt=()=>o(35462),Zt=()=>o(709356),Xt=()=>o(289113),Qt=()=>o(924806),qt=()=>o(416956);function eo(e){let{discussionData:{groupedDiscussionsData:t,newDiscussionData:o,id:n},onClick:s}=e;const[a,l]=(0,i.useState)(!1),u=(0,r().v3)(),m=u.currentUser.id,h=(0,i.useCallback)((()=>{l(!0)}),[]),f=(0,i.useCallback)((()=>{l(!1)}),[]),x=o,v=(0,i.useCallback)((async e=>{if(x){const e=xe().default.state.mainEditorCurrentBlockStore;F().A.setActiveWithSource("margin_comments"),await(0,Qt().x)({currentBlockStore:e,discussionInputStore:o.discussionInputStore,environment:u})}else if(t.length>0){const o=t[0].discussionStore;await s(e,o)}}),[x,t,null==o?void 0:o.discussionInputStore,u,s]),{commentStores:S,reactionStores:C}=(0,c().K8)((()=>{if(t){return{commentStores:t.flatMap((e=>(0,j().wc)(e.discussionStore))),reactionStores:t.flatMap((e=>R().Lk.getUserVisibleReactions(e.discussionStore)))}}return{commentStores:[],reactionStores:[]}}),[t]),y=(0,c().K8)((()=>{let e;if(x&&(e=o.parentBlockStore),t.length>0&&(e=t[0].parentBlockStore),!e)return;const n=S.map((e=>e.getCreatedById())).filter(ee().O9),i=C.map((e=>e.getActorPointers().map((e=>e.id)))).flat().filter(ee().O9);return Array.from(new Set([...n,...i,...x&&m?[m]:[]])).map((t=>R().LU.createChildStore(e,{table:Q().oo,id:t}))).slice(0,5)}),[t,x,S,C,m,null==o?void 0:o.parentBlockStore]),k=(0,c().K8)((()=>{const e=S.map((e=>e.getLastEditedTime())),t=C.map((e=>e.getCreatedTime()));return Math.max(...e,...t)}),[S,C]),w=(0,fe().X)("inbox_page_grouping_notification_style"),I=(0,c().K8)((()=>{if(!w)return!1;const e=t.map((e=>e.discussionStore)),o=ve().default.getConfigKey("assume_comment_read","last_seen_at");return e.some((e=>e.isUnread(o)))}),[t,w]),L=(0,d().IS)((e=>({discussion:{background:a?e.hoveredMarginDiscussionBackground:e.contentBackground,width:Ut().JC,display:"flex",cursor:"pointer",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,padding:"12px",alignItems:"center",gap:6},userAvatarsContainer:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row-reverse",marginRight:8},lastEditedTime:{margin:"1px 0px 0px 0px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",color:e.text.tertiary,fontSize:12,lineHeight:"15px"},commentAuthorAvatarStyle:{borderRadius:20,position:"relative",userSelect:"none",WebkitUserSelect:"none",width:24,height:24,boxShadow:e.avatarBoxShadow,marginRight:-6},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:g().J.UISmall.desktop,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",marginLeft:0,marginTop:0,color:e.text.tertiary},expandIcon:{width:g().J.UISmall.desktop,height:g().J.UISmall.desktop,fill:e.text.tertiary,marginTop:1},expandDiv:{display:"flex",justifyContent:"center",alignItems:"center",marginLeft:0},unreadStatusDot:{display:"flex",alignItems:"center",marginRight:4,marginLeft:"auto"}})),[a]),B=(0,G.jsx)("div",{style:L.secondaryLabel,children:(0,G.jsx)(p().sA,{defaultMessage:"Draft",id:"marginComments.collapsed.draft.label"})}),D=(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:L.expandDiv,children:(0,Gt().e)(L.expandIcon)}),x?B:(0,G.jsx)("div",{style:L.secondaryLabel,children:(0,G.jsx)(p().sA,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"})})]}),M=x?B:k&&(0,G.jsx)(Jt().A,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:L.lastEditedTime,children:(0,G.jsx)(Zt().A,{text:(0,Xt().nl)(k,{useUltraCompactFormat:!0}),tooltipText:(0,Xt().x$)(k),icon:$t().k})});return(0,G.jsxs)("div",{style:L.discussion,onMouseEnter:h,onMouseLeave:f,onClick:v,className:me().OO1,children:[(0,G.jsx)("div",{style:L.userAvatarsContainer,children:null==y?void 0:y.map((e=>(0,G.jsx)(qt().E,{authorStore:e,avatarSize:24,avatarStyle:L.commentAuthorAvatarStyle,placeholderStyle:L.commentAuthorPlaceholderStyle},e.id)))}),(0,G.jsx)(to,{reactionCount:C.length,commentCount:S.length+(x?1:0)}),a?D:M,I&&(0,G.jsx)("div",{style:L.unreadStatusDot,children:(0,G.jsx)(A().m,{size:b().jd})})]})}function to(e){const t=(0,d().IS)((e=>({commentCount:{fontSize:14,whiteSpace:"normal",marginLeft:0,color:e.text.primary,fontWeight:g().Wy.medium,lineHeight:"18px"},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:4,marginLeft:4}})),[]);return e.commentCount>0?(0,G.jsx)("div",{style:t.commentCount,children:(0,G.jsx)(p().sA,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:e.commentCount}})}):e.reactionCount>0?(0,G.jsx)("div",{style:t.commentCount,children:(0,G.jsx)(p().sA,{defaultMessage:"{numReactions, plural, one {{numReactions} reaction} other {{numReactions} reactions}}",id:"marginComments.collapsed.numReactions.count",values:{numReactions:e.reactionCount}})}):(0,G.jsx)("div",{style:t.textPlaceholder})}var oo=()=>o(711723),no=()=>o(73631),io=()=>o(56576);function so(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:n}=e;const s=(0,i.useRef)(null),a=(0,r().v3)(),l=(0,i.useCallback)((async()=>{const e=await no().T.formulas.load();io().i5({environment:a,allowActionsWhileCommenting:!0,formulasModule:e})}),[a]),u=(0,c().K8)((()=>o.isEmpty()),[o]),m=(0,i.useCallback)((()=>{F().A.setActiveWithSource("margin_comments")}),[]),p=(0,i.useCallback)((()=>{F().A.resetActiveSource("margin_comments")}),[]),g=(0,i.useCallback)((()=>{u&&Yt().A.reset(),F().A.resetEditorActiveSources()}),[u]),h=(0,i.useCallback)((()=>{F().A.setHoverWithSource("margin_comments")}),[]),f=(0,i.useCallback)((()=>{F().A.resetHoverSource("margin_comments")}),[]),x=(0,i.useMemo)((()=>[`.${me().MUV}`]),[]),v=(0,c().K8)((()=>F().A.state.isActivelyComposing),[]),S=(0,c().K8)((()=>F().A.state.isHovered&&!F().A.state.isActivelyComposing),[]),b=Boolean(v||u);(0,oo().L)({active:n&&b,closeHandler:g,ref:s,excludedSelectors:x,ignoreKeydown:!0});const C=(0,d().IS)((e=>({discussion:{borderRadius:10,...v?{boxShadow:e.shadowSM}:{border:`1px solid ${e.lightDividerColor}`},width:Ut().JC,background:e.selectedMarginDiscussionBackground,willChange:"transform",transition:"transform 200ms ease",transform:v?"translateX(-20px)":S?"translateX(-5px)":void 0},discussionInputContainer:{borderRadius:6,padding:"8px 0px 4px 12px",backgroundColor:S?e.hoveredMarginDiscussionBackground:void 0}})),[v,S]);return(0,G.jsx)("div",{style:C.discussion,ref:s,className:me().OO1,onMouseEnter:h,onMouseLeave:f,children:(0,G.jsx)(Ge().A,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:T().DiscussionFormat.Margin,onSubmit:l,onCancel:g,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:C.discussionInputContainer,showCtaButtons:!0,onFocus:m,onBlur:p})})}var ro=()=>o(755002),ao=()=>o(881984);function lo(e){let{discussionData:{discussionStore:t,parentBlockStore:o},timeMounted:n,onClick:s,isVisible:a,isDiscussionSelected:l,isDiscussionHovered:u}=e;const m=(0,i.useRef)(null),p=(0,r().v3)(),[g,f]=(0,i.useState)((()=>new(E().A)(p,t.pointer.spaceId))),x=(0,fe().X)("block_reactions"),v=t.id,S=(0,c().K8)((()=>t.getCommentStores().length>0),[t]),b=(0,c().K8)((()=>t.getReactionStores().length>0),[t]),C=(0,i.useMemo)((()=>[`.${(0,ro().wV)({discussionId:v})}`,`.${me().MUV}`,`.${me().OO1}`]),[v]),y=(0,i.useCallback)((async()=>{const e=w().A.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}h().xl()}),[]);(0,oo().L)({active:a&&l,closeHandler:y,ref:m,excludedSelectors:C,ignoreKeydown:!0});const k=(0,i.useCallback)((async e=>{var o;l||(ao().E9(p,{discussion_id:t.id,discussion_type:t.getType(),from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(o=t.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels()}),await s(e,t))}),[s,t,l,p]),A=(0,d().IS)((e=>({discussion:{border:l?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:10,padding:l?"1px":void 0,background:l?e.selectedMarginDiscussionBackground:u?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:l?e.shadowSM:void 0,width:Ut().JC,cursor:l?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:l?"translateX(-20px)":u?"translateX(-5px)":void 0}})),[u,l]);return(0,G.jsxs)("div",{className:me().OO1,ref:m,style:A.wrapper,onClick:k,children:[b&&x&&(0,G.jsx)("div",{style:{width:Ut().JC},children:(0,G.jsx)(ye().tx,{focused:l,parentStore:t,discussionLocation:"margin_comments"})}),S&&(0,G.jsx)("div",{style:A.discussion,children:(0,G.jsx)(Mt,{store:t,blockStore:o,format:T().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:n,discussionInputStore:g,collapsed:!l})})]})}const co=i.memo(lo);o(771702);var uo=()=>o(290882);function mo(e){let{discussionData:{discussionStore:t,parentBlockStore:n},timeMounted:s,onClick:a,isVisible:l,isDiscussionSelected:u,isDiscussionHovered:m,onMouseEnter:g,onMouseLeave:f}=e;const x=(0,i.useRef)(null),v=(0,r().v3)(),b=(0,p().tz)(),[C,y]=(0,i.useState)((()=>new(E().A)(v,t.pointer.spaceId))),k=(0,fe().X)("block_reactions"),A=(0,fe().X)("margin_comments_stepper"),j=t.id,L=(0,c().K8)((()=>t.getCommentStores().length>0),[t]),R=(0,c().K8)((()=>t.getReactionStores().length>0),[t]),B=(0,i.useMemo)((()=>[`.${(0,ro().wV)({discussionId:j})}`,`.${me().MUV}`,`.${me().OO1}`]),[j]),D=(0,i.useCallback)((async()=>{const e=w().A.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}h().xl()}),[]);(0,oo().L)({active:l&&u,closeHandler:D,ref:x,excludedSelectors:B,ignoreKeydown:!0});const M=(0,i.useCallback)((async e=>{var o;u||(ao().E9(v,{discussion_id:t.id,discussion_type:t.getType(),from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(o=t.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels()}),await a(e,t))}),[a,t,u,v]),_=(0,c().K8)((()=>(0,o(782422).ao)()),[]),F=(0,o(280696).k)({navigableBlockStore:_}),{pageSortedDiscussions:U,pageSortedUnreadDiscussions:P}=(0,c().K8)((()=>{const e=Array.from(F).sort(((e,t)=>{var o,n;const i=null===(o=document.getElementsByClassName((0,ro().wV)({discussionId:e.id}))[0])||void 0===o?void 0:o.getBoundingClientRect(),s=null===(n=document.getElementsByClassName((0,ro().wV)({discussionId:t.id}))[0])||void 0===n?void 0:n.getBoundingClientRect();return i&&s?i.top-s.top:0}));return{pageSortedDiscussions:e,pageSortedUnreadDiscussions:e.filter((e=>e.isUnread(void 0)))}}),[F]),z=(0,c().K8)((()=>P.length),[P]),K=(0,c().K8)((()=>P.findIndex((e=>e.id===t.id))+1),[t,P]),N=(0,c().K8)((()=>I().A.getFramePageFirstSelectedDiscussionId()),[]),W=(0,c().K8)((()=>(1===K&&void 0===N||u)&&P.length>0),[K,N,u,P]),H=(0,d().IS)((e=>({discussion:{border:u?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:10,padding:u?"1px":void 0,background:u?e.selectedMarginDiscussionBackground:m?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:u?e.shadowSM:void 0,width:Ut().JC,cursor:u?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:u?"translateX(-20px)":m?"translateX(-5px)":void 0},stepper:{display:"flex",justifyContent:"end",gap:4,opacity:W?1:0,transition:"opacity 250ms ease-in"},markAllAsRead:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:e.text.secondary,borderRadius:6,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},discussionCount:{marginRight:"auto",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:e.text.secondary,paddingLeft:6,paddingRight:6},discussionItemAndStepperContainer:{display:"flex",flexDirection:"column",gap:10}})),[m,u,W]),O=(0,i.useCallback)((()=>{S().createAndCommit({userAction:"MarginCommentsStepper.markAllAsRead",environment:v,canUndo:!0,perform:e=>P.forEach((t=>(0,Se().U)({transaction:e,discussionStore:t})))})}),[v,P]),V=(0,i.useCallback)((async()=>{const e=U.findIndex((e=>e.id===t.id));if(-1===e)return;const o=U.slice(e+1).find((e=>e.isUnread(void 0)))||U.slice(0,e).find((e=>e.isUnread(void 0)));o&&((0,uo().b)({discussionId:o.id,blockId:n.id,environment:v,animate:!0}),await h().B4({environment:v,blockStore:n,discussionIds:[o.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}),[t,v,n,U]),Y=(0,i.useCallback)((async()=>{const e=U.findIndex((e=>e.id===t.id));if(-1===e)return;const o=U.slice(0,e).reverse().find((e=>e.isUnread(void 0)))||U.slice(e+1).reverse().find((e=>e.isUnread(void 0)));o&&((0,uo().b)({discussionId:o.id,blockId:n.id,environment:v,animate:!0}),await h().B4({environment:v,blockStore:n,discussionIds:[o.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}),[t,v,n,U]);return A?(0,G.jsxs)("div",{style:H.discussionItemAndStepperContainer,children:[W&&(0,G.jsxs)("div",{style:H.stepper,children:[(0,G.jsx)("div",{style:H.discussionCount,children:`${K} of ${z}`}),(0,G.jsx)(Fe().A,{style:H.markAllAsRead,onClick:O,children:"Mark all as read"}),(0,G.jsx)(ie().A,{icon:o(699442).E,ariaLabel:b.formatMessage({id:"discussion.stepper.previousUnread",defaultMessage:"Previous unread discussion"}),onClick:Y}),(0,G.jsx)(ie().A,{icon:o(267521).arrowChevronSingleDownFillIcon,ariaLabel:b.formatMessage({id:"discussion.stepper.nextUnread",defaultMessage:"Next unread discussion"}),onClick:V})]}),(0,G.jsxs)("div",{ref:x,className:me().OO1,style:H.wrapper,onMouseEnter:g,onMouseLeave:f,onClick:M,role:"button",tabIndex:0,children:[R&&k&&(0,G.jsx)("div",{style:{width:Ut().JC},children:(0,G.jsx)(ye().tx,{focused:u,parentStore:t,discussionLocation:"margin_comments"})}),L&&(0,G.jsx)("div",{style:H.discussion,children:(0,G.jsx)(Mt,{store:t,blockStore:n,format:T().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:s,discussionInputStore:C,collapsed:!u})})]})]}):(0,G.jsxs)("div",{className:me().OO1,ref:x,style:H.wrapper,onClick:M,role:"button",tabIndex:0,children:[R&&k&&(0,G.jsx)("div",{style:{width:Ut().JC},children:(0,G.jsx)(ye().tx,{focused:u,parentStore:t,discussionLocation:"margin_comments"})}),L&&(0,G.jsx)("div",{style:H.discussion,children:(0,G.jsx)(Mt,{store:t,blockStore:n,format:T().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:s,discussionInputStore:C,collapsed:!u})})]})}const po=i.memo(mo);function go(e){const{discussionData:t,isLastItem:o,isDiscussionSelected:n,discussionItemElementMap:s}=e,a=(0,d().IS)((()=>({discussionContainer:{transition:t.hide?void 0:"opacity 200ms ease-in-out",top:t.offsetTop,position:"absolute",paddingBottom:o?Ut().t_:Ut().kH,zIndex:n?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,n,o]);let l;const u=t.type,m=(0,r().v3)(),p=(0,c().K8)((()=>(0,Ut().$N)(m,t.parentBlockStore)),[m,t.parentBlockStore]),g=(0,fe().X)("margin_comments_stepper"),h=(0,i.useCallback)((()=>{Vt().A.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),f=(0,i.useCallback)((()=>{Vt().A.setState({discussionIds:[]})}),[]),x=(0,i.useCallback)((e=>{s.set(t.id,e)}),[t.id,s]);p?"existing"===u?l=g?(0,G.jsx)(po,{...e,onMouseEnter:h,onMouseLeave:f,discussionData:t}):(0,G.jsx)(co,{...e,discussionData:t}):"new"===u?l=(0,G.jsx)(so,{...e,discussionData:t}):"grouped"===u?l=(0,G.jsx)(eo,{...e,discussionData:t}):(0,ee().HB)(u):l=null;return g&&"existing"===u?(0,G.jsx)("div",{style:a.discussionContainer,ref:x,children:l}):(0,G.jsx)("div",{style:a.discussionContainer,onMouseEnter:h,onMouseLeave:f,ref:x,children:l})}const ho=i.memo(go),fo=`.${Ot().iU}, .${Ot().F0}`;function xo(e){let{pageBlockStore:t,timeMounted:n,isVisible:s,animating:a,pageViewBlockAccessor:l,width:u,context:m}=e;const p=(0,r().v3)(),g=(0,i.useRef)(null),h=(0,i.useRef)(new Map),f=(0,i.useRef)(new Map),x=(0,c().K8)((()=>Vt().A.getFirstSelectedDiscussionId()),[]),v=(0,i.useCallback)((async(e,n)=>{(0,o(917717).Zm)()||e.target instanceof Element&&e.target.closest(fo)||await B().DZ({discussionStore:n,currentBlockStore:t,environment:p,analyticsFrom:"margin_comments",currentEl:g.current})}),[t,p]),[S,b]=(0,i.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[C,y]=(0,i.useState)(!1),{WindowSizeStore:k}=p,A=o(129808).ek(p.device.isElectronMac);(0,i.useEffect)((()=>{if(!s)return;const e=new(Ht().default)((()=>({selectableRectMap:o(105157).default.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:o(370557).Ay.state.isAnimating,windowHeight:k.state.height})),{debugName:"effectDataStore"}),n=new(Ht().default)((()=>Ut().Ob.state),{debugName:"discussionStoresStore"}),i=new(Ht().default)((()=>{const e=Yt().A.state,t=Yt().A.getBlockStore(),n=Yt().A.getClosestBlockStore();if(e.open&&e.rect&&"comment"===e.content&&(t||n)&&(!t||o(191759).A.isBlockInFrame(t)&&!e.property_id))return{recomputeFocus:F().A.state.isActivelyComposing,blockStore:t??e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),r=new(Ht().default)((()=>{if(!F().A.state.isActivelyComposing)return I().A.getFramePageFirstSelectedDiscussionId();I().A.reset()}),{debugName:"selectedDiscussionIdStore"});let c=!1;const d=(0,q().sg)((()=>{const{selectableRectMap:o,pageContentStores:s,sidebarIsAnimating:d,windowHeight:u}=e.state,x=n.state,v=i.state,k=r.state;if(a||d)return;const j=l();if(!(j&&g.current&&o&&o.size))return;(0,Ut().cY)({discussionStores:x,pageContentStores:s,marginDiscussionItemRefs:h.current,selectedDiscussionId:k,newMarginDiscussionArgs:v,marginContainerElement:g.current,pageViewBlockElement:j,onComputeComplete:(e,t)=>{c||(f.current=t,C||y(!0),b(e))},computedOnce:C,topbarHeight:A,windowHeight:u,isFullWidth:(0,Qe().Ck)(t,m,p),prevSelectedDiscussionId:S.selectedDiscussion,previousDiscussionElements:f.current})}),5);return e.addListener(d),n.addListener(d),r.addListener(d),i.addListener(d),()=>{c=!0,e.removeListener(d),n.removeListener(d),r.removeListener(d),i.removeListener(d)}}),[s,a,l,C,t,S.selectedDiscussion,k,A,p,m]);const j=(0,d().IS)((()=>({marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:8,paddingLeft:Ut().JR,paddingRight:Ut().JR,width:u-2*Ut().JR,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:1}})),[u]);return(0,G.jsx)("div",{style:j.marginCommentsContainer,ref:g,children:S.data.map(((e,t)=>(0,G.jsx)(ho,{discussionData:e,timeMounted:n,onClick:v,isVisible:s,discussionItemElementMap:h.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===x,isLastItem:t===S.data.length-1},`margin-discussion-${e.id}`)))})}const vo=i.memo(xo);function So(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:n,context:s,isCollapsedAnchor:a}=e;const[l,u]=(0,i.useState)(!1),m=(0,r().v3)(),p=(0,i.useMemo)((()=>(new Date).getTime()),[]),g=(0,c().K8)((()=>{const e=(0,Qe().Ck)(t,s,m);return a?{paddingLeft:e?96:16,height:0}:e?void 0:{position:"absolute",right:(0,Ut().gg)(m,(0,Wt().cq)(t),(0,Wt().RX)(t))}}),[t,s,m,a]),h=(0,i.useCallback)((()=>{u(!0)}),[]),f=(0,i.useCallback)((()=>{u(!1)}),[]),x=(0,d().IS)((()=>({marginCommentsSection:{display:o||l?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?Ut().Qb:0,...g}})),[o,l,g]);return(0,G.jsx)(Nt().A,{animate:{opacity:o?1:0},onAnimationStart:h,onAnimationEnd:f,style:x.marginCommentsSection,children:(0,G.jsx)(vo,{pageBlockStore:t,timeMounted:p,isVisible:o,animating:l,pageViewBlockAccessor:n,width:Ut().Qb,context:s})})}var bo=()=>o(435819),Co=()=>o(443252),yo=()=>o(365060);const ko=function(e){const{capture:t,children:n}=e,s=(0,i.useRef)(null);return(0,l().b)(o(502063).A,(()=>({getNode:()=>s.current,isCaptured:()=>t})),[t]),(0,G.jsx)("div",{ref:s,children:i.Children.only(n)})};var Ao=()=>o(245313),jo=()=>o(907721),wo=()=>o(466321),Io=()=>o(367111);function Lo(e){let{blockStore:t,discussionInputStore:o,handleDismiss:n}=e;const s=(0,r().v3)(),{device:a,WindowSizeStore:l}=s,u=(0,i.useCallback)((async()=>{const e=await no().T.formulas.load();io().i5({environment:s,allowActionsWhileCommenting:!0,formulasModule:e})}),[s]),m=(0,c().K8)((()=>Io().A.keyboardHeight()>0),[]),p=(0,c().K8)((()=>{const e=a.isAndroid?12:8;return{paddingLeft:l.getSafePaddingLeftCSS(12),paddingRight:l.getSafePaddingRightCSS(8),paddingBottom:m?e:l.getSafePaddingBottomCSS(e)}}),[l,m,a.isAndroid]),g=(0,d().IS)((()=>({inputWrapper:{width:a.isMobileNative?"100%":470,maxWidth:a.isMobileBrowser?"90vw":"100%",paddingTop:9,paddingLeft:p.paddingLeft,paddingRight:p.paddingRight,paddingBottom:p.paddingBottom}})),[a,p]);return(0,Ao().A)({shouldPreserveTextSelection:!0,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0}),(0,G.jsx)(bo().A,{capture:!0,allowOpenLinkMenu:!0,render:()=>(0,G.jsx)(yo().A,{store:t,droppable:!0,render:()=>(0,G.jsx)(ko,{capture:!0,children:(0,G.jsx)("div",{style:g.inputWrapper,children:(0,G.jsx)(Ge().A,{showAvatar:!0,parentStore:t,onCancel:n,onSubmit:u,discussionInputStore:o,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:T().DiscussionFormat.Page,blockStore:t,canDrop:!0})})})},t.id)})}const Ro=function(){const e=(0,r().v3)(),t=(0,r().WS)(),n=(0,c().K8)((()=>Yt().A.state.rect),[]),s=(0,c().K8)((()=>{if(Yt().A.state.open&&"comment"===Yt().A.state.content){const{discussionInputStore:o}=Yt().A.state;if((0,Ft().me)(e))return null;if(Yt().A.updateRect(),F().A.state.isActivelyComposing){"comments_pane"===F().A.state.clickEntryPoint&&F().A.setActiveWithSource("popover_comments");const n=Yt().A.getBlockStore();var t;if(n)return{blockStore:n,discussionInputStore:o,canMarginCommentsRender:!(null!==(t=Yt().A.state)&&void 0!==t&&t.property_id)&&(0,Ut().$N)(e,n)}}}return null}),[e]),a=(0,i.useCallback)((()=>{const t=null==s?void 0:s.discussionInputStore;t&&(0,o(627091).M)({discussionInputStore:t,environment:e})}),[e,null==s?void 0:s.discussionInputStore]),l=(0,i.useCallback)((()=>{Yt().A.hasContent()?F().A.resetEditorActiveSources():s&&(0,o(906305).c)(e)}),[e,s]);(0,i.useEffect)((()=>{function t(t){const n=Yt().A.state,i=n.open&&"comment"===n.content&&n.discussionInputStore||void 0;i&&((0,o(556518).HR)({discussionInputStore:i,environment:e,discussionHelpers:T()}),t.preventDefault())}return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e]);const d=(0,c().K8)((()=>o(779921).A.state.isOpen),[]);return(0,c().K8)((()=>F().A.state.overlapsExistingDiscussionMenu),[])?null:(0,G.jsx)(Co().Ay,{popupType:t?wo().n.SlideUp:wo().n.Popup,keepFocus:!0,open:null!==s&&(!s.canMarginCommentsRender||d),originRect:n,placementToOrigin:jo().W.Bottom,alignmentToOrigin:jo().C.Center,originGap:4,onDismiss:l,render:()=>s?(0,G.jsx)(Lo,{blockStore:s.blockStore,discussionInputStore:s.discussionInputStore,handleDismiss:l}):null,onAnimationEnd:a})};var Bo=()=>o(73876),Do=()=>o(313141);const Mo=function(){const e=(0,r().v3)(),t=(0,r().Y0)(),{open:o,rect:n,discussionLocation:i}=(0,c().K8)((()=>{const{open:e,rect:t}=Do().A.state;return{open:e,rect:t,discussionLocation:Do().A.state.open?Do().A.state.discussionLocation:Do().A.state.prevDiscussionLocation}}),[]),s=(0,fe().X)("comment_sidebar_for_you"),{popupType:a,bottomSheetInitialState:l}=function(e){if(!e.device.isPhone)return{popupType:wo().n.Popup,bottomSheetInitialState:void 0};if(e.enableForYouCommentSidebar||"post_top_level_discussion"===e.discussionLocation)return{popupType:wo().n.BottomSheet,bottomSheetInitialState:"full"};return{popupType:wo().n.SlideUp,bottomSheetInitialState:void 0}}({device:t,enableForYouCommentSidebar:s,discussionLocation:i});return(0,G.jsx)(Co().Ay,{popupType:a,bottomSheetInitialState:l,open:o,originRect:n,placementToOrigin:jo().W.Bottom,alignmentToOrigin:jo().C.Center,originGap:4,onDismiss:()=>D().oU(e),render:()=>(0,G.jsx)(To,{}),trapFocus:!0})};function To(){const e=(0,r().v3)(),{device:t}=e,o=(0,c().O$)(Do().A),n=(0,c().K8)((()=>Do().A.state.open?Do().A.state.discussionInputStore.state.textStore.getValue():null),[]);if((0,i.useEffect)((()=>{var e;if(o.open&&"post_top_level_discussion"===o.discussionLocation)return;const t=null===(e=Bo().A.MenuScroller)||void 0===e?void 0:e.getNode();null==t||t.scrollTo({top:t.scrollHeight})}),[n,o]),o.open){const{discussionStore:n,discussionInputStore:i,blockStore:s,discussionLocation:r}=o;let a;return a=t.isMobile?{menuType:pe().gu.Modal,title:(0,G.jsx)(p().sA,{defaultMessage:"Comments",id:"discussion.mobileReplyMenu.title"}),right:(0,G.jsx)(p().sA,{defaultMessage:"Done",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>D().oU(e),whiteBackground:!0}:{menuType:pe().gu.Popup,width:420,minHeight:"100px",maxHeight:"50vh",maxWidth:"100%"},(0,G.jsx)(se().A,{className:me()._qG,...a,children:(0,G.jsx)(bo().A,{capture:!0,allowMobileAutoScroll:!0,render:()=>(0,G.jsx)(Mt,{store:n,discussionInputStore:i,onDismiss:()=>D().oU(e),format:T().DiscussionFormat.Menu,isFirst:!0,isOnly:!0,showResolveButtonByDefaultIfPossible:!0,blockStore:s,collapsed:!1,..."post_top_level_discussion"===r?{pageVisitStore:void 0,presenceStore:void 0,discussionLocation:"post_top_level_discussion"}:{discussionLocation:r}})})})}return null}var _o=()=>o(986303),Eo=()=>o(289816)},151258:(e,t,o)=>{o.d(t,{Ay:()=>p,mI:()=>u,vb:()=>m});o(242343);var n=()=>o(174114),i=()=>o(752903),s=()=>o(388732),r=()=>o(653998),a=()=>o(31448),l=()=>o(126451),c=o(163643);const d=(0,r().YK)({removeTokenLabel:{defaultMessage:"Remove {title}",id:"uiGenericToken.removeTokenLabel"},removeTokenLabelGeneric:{defaultMessage:"Remove Item",id:"uiGenericToken.removeTokenLabelGeneric"}}),u=i().NY,m={[i().NY.ExtremeSmall]:{height:12,fontSize:10,margin:"0 4px 0 0",marginEditState:"0 6px 0 0",closeIconSize:8,avatarSize:14},[i().NY.ExtraSmall]:{height:14,fontSize:12,margin:"0 6px 0 0",marginEditState:"0 6px 0 0",closeIconSize:8,avatarSize:14},[i().NY.Small]:{height:18,fontSize:12,margin:"0 6px 6px 0",marginEditState:"0 6px 6px 0",closeIconSize:8,avatarSize:16},[i().NY.CompactEssential]:{height:20,fontSize:14,margin:"0 10px 6px 0",marginEditState:"0 6px 6px 0",closeIconSize:8,avatarSize:20},[i().NY.Medium]:{height:20,fontSize:14,margin:"0 10px 6px 0",marginEditState:"0 6px 6px 0",closeIconSize:8,avatarSize:20},[i().NY.Inline]:{height:20,fontSize:14,closeIconSize:8,avatarSize:20,margin:"0 -5px 0 0",marginEditState:"0 6px 0 0"},[i().NY.Large]:{height:24,fontSize:16,margin:"0 8px 8px 0",marginEditState:"0 8px 8px 0",closeIconSize:10,avatarSize:20}};function p(e){let{avatarSize:t,format:o,isSingle:i,onClickRemove:u,renderAvatar:p,showRemoveButton:g,shouldShrink:h,style:f,title:x}=e;const v=(0,r().tz)(),{height:S,fontSize:b,margin:C,marginEditState:y,closeIconSize:k,avatarSize:A}=m[o],j=t??A,w=(0,n().IS)((()=>({root:{display:"flex",alignItems:"center",flexShrink:h?1:0,minWidth:0,height:S,borderRadius:6,fontSize:b,lineHeight:"120%",margin:i?0:g?y:C,...f}})),[b,S,i,C,y,h,g,f]);return(0,c.jsxs)("div",{style:w.root,children:[null==p?void 0:p(j),(0,c.jsx)("div",{className:"notranslate",style:{...a().RC},children:x}),g?(0,c.jsx)(l().A,{ariaLabel:void 0!==x?v.formatMessage(d.removeTokenLabel,{title:x}):v.formatMessage(d.removeTokenLabelGeneric),onClick:u,style:{display:"flex",alignItems:"center",justifyContent:"center",width:S,height:S,marginLeft:2,marginRight:2,flexGrow:0,flexShrink:0,borderRadius:6},children:(0,s().l)({width:k,height:k,opacity:.5})}):null]})}},151602:(e,t,o)=>{o.d(t,{A:()=>s});class n extends(()=>o(129044))().default{getInitialState(){return{}}}const i=new n;o(996094).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const s=i},155347:(e,t,o)=>{o.d(t,{o:()=>a});o(242343);var n=()=>o(174114),i=()=>o(284594),s=()=>o(653998),r=o(163643);function a(e){const{href:t,style:o}=e,a=(0,n().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.text.secondary}})),[]);return(0,r.jsxs)("a",{href:t,target:"_blank",style:{...a.default,...o},children:[(0,i().$)({width:14,marginRight:4}),(0,r.jsx)(s().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},219322:(e,t,o)=>{o.d(t,{U:()=>a,t:()=>l});var n=()=>o(174114),i=()=>o(752903),s=()=>o(31448),r=()=>o(755786);const a={[i().NY.ExtremeSmall]:{height:16,fontSize:12,margin:"0 4px 0 0",recordIconMarginRight:3,pageIconSize:13,closeIconSize:8},[i().NY.ExtraSmall]:{height:16,fontSize:12,margin:"0 4px 0 0",recordIconMarginRight:3,pageIconSize:13,closeIconSize:8},[i().NY.Small]:{height:18,fontSize:12,margin:"0 6px 6px 0",recordIconMarginRight:3,pageIconSize:16,closeIconSize:8},[i().NY.CompactEssential]:{height:20,fontSize:14,margin:"0 12px 6px 0",recordIconMarginRight:4,pageIconSize:20,closeIconSize:8},[i().NY.Medium]:{height:20,fontSize:14,margin:"0 12px 6px 0",recordIconMarginRight:4,pageIconSize:20,closeIconSize:8},[i().NY.Inline]:{height:20,fontSize:14,margin:"0 12px 0 0",recordIconMarginRight:4,pageIconSize:20,closeIconSize:8},[i().NY.Large]:{height:24,fontSize:16,margin:"0 8px 8px 0",recordIconMarginRight:4,pageIconSize:24,closeIconSize:10}};function l(e){let{format:t,shouldShrink:o,shouldWrap:l,isSingle:d,style:u,clickTitleBehavior:m}=e;const p="edit"===m;return(0,n().IS)((()=>{const{fontSize:e,margin:n}=a[t],m=p?r().d0:a[t].height;return{style:{...l?{display:"inline",lineHeight:1.5,borderRadius:4}:c({height:m}),fontSize:e,fontWeight:s().Wy.medium,minWidth:o?0:"auto",margin:d?0:n,...t===i().NY.Inline&&{overflow:"hidden"},...u}}}),[t,o,l,d,p,u])}function c(e){let{height:t}=e;return{display:"flex",alignItems:"center",lineHeight:1.2,height:t}}},263873:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,plusSmallIcon:()=>i});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M8 2.74a.66.66 0 0 1 .66.66v3.94h3.94a.66.66 0 0 1 0 1.32H8.66v3.94a.66.66 0 0 1-1.32 0V8.66H3.4a.66.66 0 0 1 0-1.32h3.94V3.4A.66.66 0 0 1 8 2.74"})},i=(0,o(680369).wt)("plusSmall",n)},290656:(e,t,o)=>{o.d(t,{B:()=>p});var n=o(242343),i=()=>o(237385),s=()=>o(803290),r=()=>o(612408),a=()=>o(586588),l=()=>o(433364);const c=new Map;var d=()=>o(485966),u=()=>o(822493),m=o(163643);function p(e){let{tutorialId:t,tutorialStepId:o,onPrimaryButtonClick:p,displayStore:g,...h}=e;const f=(0,i().v3)(),x=function(e){const t=!c.get(e),o=(0,n.useRef)(t);return o.current&&c.set(e,!0),(0,n.useEffect)((()=>()=>{o.current&&c.set(e,!1)}),[e]),o.current}(`${t}.${o}`),{currentStep:v,isLoading:S}=(0,s().K8)((()=>{var e;return{isLoading:!(null!==(e=d().default.state.currentUserSettingsStore)&&void 0!==e&&e.getSettings()),currentStep:(0,l().gt)(d().default.state.currentUserSettingsStore,t)}}),[t]);if((0,n.useEffect)((()=>{S||v!==o||!x?null==g||g.setState(!1):null==g||g.setState(!0)}),[S,v,o,x,g]),S||v!==o||!x)return null;const b=r().c$[t],C=b.steps.findIndex((e=>e.id===o)),y=b.steps.length;return(0,m.jsx)(u().k,{onCloseClick:()=>{a().dismissTutorial(f,t)},onPrimaryButtonClick:e=>{a().tutorialGoToNextStep(f,t),null==p||p(e)},onBackButtonClick:()=>{a().tutorialGoToPrevStep(f,t)},numSteps:y,currStepIndex:C,...h})}},326259:(e,t,o)=>{o.d(t,{OH:()=>a,T2:()=>l,do:()=>c});var n=()=>o(871002),i=()=>o(846581),s=()=>o(16456),r=()=>o(427091);function a(e){const{dateTime:t,intl:o,shortenDateAndRange:n}=e,r=s().C6.toPersistedDate(t.valueOf());return i().ZF({value:r,allowRelativeDates:!0,intl:o,shortenDateAndRange:n,displayInUserTimezone:!0})}function l(e){const{dateTime:t,intl:o,userTimeZone:n,displayInUserTimezone:r,alwaysIncludeTimezone:a}=e,l=s().C6.toPersistedDateTime(t.valueOf(),t.zoneName);return i().ZF({value:l,allowRelativeDates:!0,intl:o,userTimeZone:n,displayInUserTimezone:r,alwaysIncludeTimezone:a})}function c(e){const{luxonRange:t,intl:o}=e,a=s().C6.toPersistedDateRange(t),l=i().ZF({value:a,allowRelativeDates:!1,shortenDateAndRange:!0,intl:o,displayInUserTimezone:!0}),c=t.end.setZone((0,r().P)()),d=i().fU({start_time:c.toFormat(n().GE),humanReadable:!1,intl:o});return o.formatMessage({id:"verification.timeRange",defaultMessage:"{formattedDateRange} at {formattedEndTime}"},{formattedDateRange:l,formattedEndTime:d})}},367950:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},388732:(e,t,o)=>{o.d(t,{l:()=>i});o(242343);var n=o(163643);const i=(0,o(680369).wt)("closeThick",{viewBox:"0 0 8 8",svg:(0,n.jsx)("polygon",{points:"8 1.01818182 6.98181818 0 4 2.98181818 1.01818182 0 0 1.01818182 2.98181818 4 0 6.98181818 1.01818182 8 4 5.01818182 6.98181818 8 8 6.98181818 5.01818182 4"})})},399631:(e,t,o)=>{o.d(t,{Y:()=>r});var n=o(242343),i=()=>o(709237),s=o(163643);function r(e){const{blockStore:t,shouldWrap:o,titleStyle:r,recordTitleRef:a,noUnderline:l,disableTooltip:c}=e,d=(0,n.useRef)({getNode:()=>a.current});return(0,s.jsx)(i().A,{store:t,underline:!l,shouldWrap:o,style:r,ref:d,enableHover:!0,showTooltipWhenTruncated:!0,disableTooltip:c})}},415806:(e,t,o)=>{o.d(t,{Ay:()=>x,t_:()=>v,v7:()=>S});o(242343);var n=()=>o(237385),i=()=>o(803290),s=()=>o(950635),r=()=>o(752903),a=()=>o(76394),l=()=>o(413871),c=()=>o(888575),d=()=>o(951156),u=()=>o(151258),m=()=>o(732165),p=()=>o(482570),g=o(163643);function h(e){const t=(0,n().v3)(),{actor:o,format:s,hasTooltip:h,tooltipHeader:x}=e,v=(0,i().K8)((()=>{const e=o.asActor;return e&&l().sk.createUniqueRootStore(t,e.pointer)}),[o,t]);return(0,g.jsx)(u().Ay,{...e,renderAvatar:e=>{if(v)return v instanceof l().vK?s===r().NY.Inline?(0,g.jsx)(d().A,{botStore:v,size:e,style:f}):(0,g.jsx)(c().A,{botStore:v,avatarSize:e,inline:!0,style:f}):v instanceof l().LU?s===r().NY.Inline?(0,g.jsx)(p().A,{userStore:v,size:e,avatarShouldShowShadow:!0,hasTooltip:h??!0,style:f,tooltipHeader:x}):(0,g.jsx)(m().A,{userStore:v,avatarSize:e,inline:!0,hasTooltip:h,style:f,tooltipHeader:x}):void(v instanceof l().pH||(0,a().HB)(v))}})}const f={minWidth:0};h.Format=r().NY;const x=h;function v(e){const{userValue:t,...o}=e;return(0,g.jsx)(h,{actor:(0,s().MR)(t),...o})}function S(e){const{botValue:t,...o}=e;return(0,g.jsx)(h,{actor:(0,s().oC)(t),...o})}v.Format=u().mI,S.Format=u().mI},423162:(e,t,o)=>{o.r(t),o.d(t,{checkmarkCircleIcon:()=>s,iconDefinition:()=>i});o(242343);var n=o(163643);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M12.876 7.982a.625.625 0 1 0-1.072-.644L9.25 11.595 7.815 9.92a.625.625 0 0 0-.95.813l2 2.334a.625.625 0 0 0 1.01-.085z"}),(0,n.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0"})]})},s=(0,o(680369).wt)("checkmarkCircle",i)},501578:(e,t,o)=>{o.d(t,{j:()=>d});var n=o(242343),i=()=>o(237385),s=()=>o(174114),r=()=>o(31448),a=()=>o(103151);var l=()=>o(907721),c=o(163643);function d(e){let{children:t,style:o,tooltipStyle:d,placement:u=l().W.Bottom}=e;const{isSafari:m}=(0,i().Y0)(),p=(0,n.useRef)(null),g=function(e){const[t,o]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const{current:t}=e;if(!t)return void o(!1);const n="ResizeObserver"in window?new ResizeObserver((e=>{let[t]=e;o(t.target.scrollWidth>t.target.clientWidth)})):void 0;return null==n||n.observe(t),()=>null==n?void 0:n.unobserve(t)}),[]),t}(p),h=(0,s().IS)((()=>({overflowText:{...r().RC,...o}})),[o]);return(0,c.jsx)(a().A,{delayThreshold:500,placement:u,textWrap:!0,style:d,forceVisibleState:!(m||!g)&&void 0,renderTooltip:()=>g?t:void 0,render:e=>(0,c.jsx)("div",{ref:p,style:h.overflowText,...e,children:t})})}},502063:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(151255))().A{}const i=new n},699773:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(242343),i=()=>o(846581),s=()=>o(16456),r=()=>o(427091),a=o(163643);const l=function(e){const t=(0,o(653998).tz)(),l=(0,o(174114).DP)(),u=(0,o(221573).I)(),m=(0,n.useRef)(),p=(0,n.useCallback)((()=>{const t=e.value;if(!t)return;const n=s().q8(t,(0,r().P)());if(!n)return;const i=n.valueOf(),a=i-Date.now();a<0||a>o(141666).nD||m.current&&m.current.timestamp===i||(m.current&&clearTimeout(m.current.timer),m.current={timestamp:i,timer:setTimeout((()=>u("DateBox","DateBox/createReminderTimer")),a)})}),[u,e.value]),g=(0,n.useCallback)((()=>{m.current&&(clearTimeout(m.current.timer),m.current=void 0)}),[]);(0,n.useEffect)((()=>{p()}),[p]),(0,n.useEffect)((()=>()=>{g()}),[g]);const{value:h,withComma:f}=e,x=(0,o(803290).K8)((()=>h?(0,i().ZF)({value:h,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,r().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:e.shortenDateAndRange,displayInUserTimezone:e.displayInUserTimezone,getToday:o(533975).x1}):void 0),[t,e.dateFormat,e.displayInUserTimezone,e.shortenDateAndRange,e.timeFormat,h]);if(!h)return null;const v=s().AA(h,(0,r().P)(),o(16791).locale);let S;if(h.reminder){const e=s().Zs(h,(0,r().P)());S=e?{color:l.errorText}:{color:o(220413).Ay.blue}}const b=(0,a.jsxs)(a.Fragment,{children:[x,h.reminder&&(0,o(508024).P)({display:"inline-block",width:"1em",marginLeft:6,marginRight:2,paddingBottom:4,verticalAlign:"middle"}),f?", ":null]});return e.disableTooltip?(0,a.jsx)("div",{className:e.className,style:{...e.style,...S},children:b}):(0,a.jsx)(o(103151).A,{renderTooltip:()=>(0,a.jsxs)(a.Fragment,{children:[e.tooltipHeader,(0,a.jsxs)("div",{style:d(l,e.tooltipHeader),children:[c(v.start),v.end?` → ${c(v.end)}`:""]})]}),render:t=>(0,a.jsx)("div",{className:e.className,style:{...e.style,...S},...t,children:b}),placement:e.tooltipPlacement})};function c(e){return(0,i().eV)({value:e,preset:"medium"})}function d(e,t){return t?{color:e.text.contrastSecondary}:{}}},731991:(e,t,o)=>{o.d(t,{W:()=>s,X:()=>i});var n=()=>o(803290);function i(e){return e.isReady()&&!e.isDefined()&&"none"!==e.getRole()}function s(e){return(0,n().K8)((()=>i(e)),[e])}},745719:(e,t,o)=>{o.d(t,{s:()=>i});o(242343);var n=o(163643);const i=(0,o(680369).wt)("reactionAdd",{viewBox:"0 0 20 20",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M12 14.3516C12 14.1875 12.0573 14.0482 12.1719 13.9336C12.2891 13.8164 12.4297 13.7578 12.5938 13.7578H14.7617V11.5938C14.7617 11.4297 14.819 11.2904 14.9336 11.1758C15.0482 11.0586 15.1875 11 15.3516 11C15.5156 11 15.6549 11.0586 15.7695 11.1758C15.8867 11.2904 15.9453 11.4297 15.9453 11.5938V13.7578H18.1133C18.2747 13.7578 18.4128 13.8164 18.5273 13.9336C18.6445 14.0482 18.7031 14.1875 18.7031 14.3516C18.7031 14.5156 18.6445 14.6562 18.5273 14.7734C18.4128 14.888 18.2747 14.9453 18.1133 14.9453H15.9453V17.1133C15.9453 17.2747 15.8867 17.4128 15.7695 17.5273C15.6549 17.6445 15.5156 17.7031 15.3516 17.7031C15.1875 17.7031 15.0482 17.6445 14.9336 17.5273C14.819 17.4128 14.7617 17.2747 14.7617 17.1133V14.9453H12.5938C12.4297 14.9453 12.2891 14.888 12.1719 14.7734C12.0573 14.6562 12 14.5156 12 14.3516Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.0615 17.123C9.09538 17.123 8.1862 16.9385 7.33398 16.5693C6.48177 16.2048 5.72982 15.6966 5.07812 15.0449C4.43099 14.3932 3.92285 13.6413 3.55371 12.7891C3.18457 11.9368 3 11.0277 3 10.0615C3 9.09538 3.18457 8.1862 3.55371 7.33398C3.92285 6.48177 4.43099 5.7321 5.07812 5.08496C5.72982 4.43327 6.47949 3.92285 7.32715 3.55371C8.17936 3.18457 9.08854 3 10.0547 3C11.0254 3 11.9368 3.18457 12.7891 3.55371C13.6413 3.92285 14.3932 4.43327 15.0449 5.08496C15.6966 5.7321 16.207 6.48177 16.5762 7.33398C16.9453 8.1862 17.1299 9.09538 17.1299 10.0615C17.1299 10.6193 17.0684 11.1581 16.9453 11.678V11.5938C16.9453 11.1646 16.7813 10.7706 16.4767 10.4687C16.2657 10.2558 16.0099 10.1116 15.7285 10.0441C15.7263 9.26677 15.5805 8.53887 15.291 7.86035C14.9993 7.1722 14.5938 6.56836 14.0742 6.04883C13.5547 5.5293 12.9508 5.1237 12.2627 4.83203C11.5791 4.54036 10.8431 4.39453 10.0547 4.39453C9.27083 4.39453 8.53483 4.54036 7.84668 4.83203C7.16309 5.1237 6.5638 5.5293 6.04883 6.04883C5.53385 6.56836 5.13053 7.1722 4.83887 7.86035C4.5472 8.54395 4.40137 9.27767 4.40137 10.0615C4.40137 10.8499 4.5472 11.5859 4.83887 12.2695C5.13053 12.9531 5.53385 13.5547 6.04883 14.0742C6.56836 14.5938 7.16992 14.9993 7.85352 15.291C8.54167 15.5827 9.27767 15.7285 10.0615 15.7285C10.5739 15.7285 11.0641 15.6669 11.5321 15.5438C11.8272 15.8056 12.1958 15.9453 12.5938 15.9453H13.7617V16.0641C13.4535 16.2554 13.1293 16.4238 12.7891 16.5693C11.9368 16.9385 11.0277 17.123 10.0615 17.123ZM10.0547 13.4248C9.58073 13.4248 9.16146 13.3405 8.79688 13.1719C8.43685 12.9987 8.15658 12.8005 7.95605 12.5771C7.76009 12.3538 7.66211 12.167 7.66211 12.0166C7.66211 11.9346 7.69401 11.8776 7.75781 11.8457C7.82617 11.8092 7.89909 11.8092 7.97656 11.8457C8.22721 11.9779 8.51204 12.1055 8.83105 12.2285C9.15006 12.3516 9.55794 12.4131 10.0547 12.4131C10.5514 12.4131 10.9593 12.3516 11.2783 12.2285C11.6019 12.1055 11.8867 11.9779 12.1328 11.8457C12.2103 11.8092 12.2832 11.8092 12.3516 11.8457C12.4199 11.8776 12.4541 11.9346 12.4541 12.0166C12.4541 12.167 12.3538 12.3538 12.1533 12.5771C11.9528 12.8005 11.6725 12.9987 11.3125 13.1719C10.9525 13.3405 10.5332 13.4248 10.0547 13.4248ZM8.03809 9.44629C7.82389 9.44629 7.63704 9.3597 7.47754 9.18652C7.32259 9.01335 7.24512 8.79004 7.24512 8.5166C7.24512 8.24772 7.32259 8.02669 7.47754 7.85352C7.63704 7.67578 7.82389 7.58691 8.03809 7.58691C8.25228 7.58691 8.44141 7.67578 8.60547 7.85352C8.76953 8.02669 8.85156 8.24772 8.85156 8.5166C8.85156 8.79004 8.76953 9.01335 8.60547 9.18652C8.44141 9.3597 8.25228 9.44629 8.03809 9.44629ZM12.0713 9.44629C11.8571 9.44629 11.6702 9.3597 11.5107 9.18652C11.3558 9.01335 11.2783 8.79004 11.2783 8.5166C11.2783 8.24772 11.3558 8.02669 11.5107 7.85352C11.6702 7.67578 11.8571 7.58691 12.0713 7.58691C12.2855 7.58691 12.4746 7.67578 12.6387 7.85352C12.8027 8.02669 12.8848 8.24772 12.8848 8.5166C12.8848 8.79004 12.8027 9.01335 12.6387 9.18652C12.4746 9.3597 12.2855 9.44629 12.0713 9.44629Z"})]})})},773498:(e,t,o)=>{o.d(t,{rU:()=>m,QB:()=>s,hR:()=>c,pT:()=>l,JN:()=>u,i8:()=>r,Wt:()=>d,Sx:()=>a});var n=()=>o(129978);const i=new(n().O2)("notifications",(()=>Promise.all([o.e(96159),o.e(75134),o.e(43380),o.e(96346),o.e(36192),o.e(55373),o.e(62475),o.e(3151),o.e(44711),o.e(98629),o.e(53321),o.e(58550),o.e(16471),o.e(90825),o.e(37353),o.e(29151),o.e(16908),o.e(49889),o.e(97727),o.e(36209),o.e(92845),o.e(71718),o.e(48486),o.e(83324),o.e(63077),o.e(41870),o.e(90966),o.e(88552),o.e(90214),o.e(74562),o.e(8184),o.e(28271),o.e(17254),o.e(18895),o.e(78708),o.e(28721),o.e(4422),o.e(28866),o.e(67435),o.e(17989),o.e(48632),o.e(90625),o.e(76181),o.e(59794),o.e(72832),o.e(90280),o.e(26483),o.e(33813),o.e(81768),o.e(71104),o.e(2804),o.e(82850),o.e(84778),o.e(69914),o.e(11341),o.e(92011),o.e(19361),o.e(63327),o.e(26090),o.e(38482),o.e(12341),o.e(50984),o.e(47864),o.e(40828),o.e(76007),o.e(5023),o.e(90978),o.e(65554),o.e(53571),o.e(66885),o.e(21194),o.e(60499),o.e(78917),o.e(36141),o.e(42601),o.e(41864),o.e(19632),o.e(6893)]).then(o.bind(o,855022)))),s=(0,n()._h)(i,(e=>e.GetNotifiedFor)),r=(0,n()._h)(i,(e=>e.TopbarUpdatesMenu)),a=(0,n()._h)(i,(e=>e.UpdateSidebar)),l=(0,n()._h)(i,(e=>e.MobileInboxPopup)),c=(0,n()._h)(i,(e=>e.InboxActionsMenu)),d=((0,n()._h)(i,(e=>e.InboxNotificationSettingsButton)),(0,n()._h)(i,(e=>e.UnreadMentionsBadge))),u=(0,n()._h)(i,(e=>e.NotificationInboxPanelContent)),m=(0,n()._h)(i,(e=>e.AnimatedEmojiBadge))},888575:(e,t,o)=>{o.d(t,{A:()=>i});o(242343);var n=o(163643);const i=function(e){const{botStore:t,avatarSize:i,shouldShowBadge:s,style:r,inline:a}=e,l=(0,o(653998).tz)(),c=(0,o(237385).Y0)(),d=(0,o(803290).K8)((()=>null==t?void 0:t.getDisplayName(l)),[t,l]),{outerStyle:u,avatarWrapStyle:m,badgeStyle:p}=(0,o(174114).IS)((e=>({outerStyle:{display:"flex",alignItems:"center",minWidth:0,...r},avatarWrapStyle:a?{width:"none",minHeight:"none",marginRight:6}:{marginRight:6},badgeStyle:{padding:"2px 6px",borderRadius:4,color:e.text.secondary,background:e.legacyDefaultSelectColor,fontSize:c.isMobile?11:9,lineHeight:c.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",marginLeft:8,marginTop:1}})),[r,a,c]);return(0,n.jsxs)("div",{style:u,children:[(0,n.jsx)("div",{style:m,children:(0,n.jsx)(o(951156).A,{botStore:t,size:i})}),(0,n.jsx)("div",{style:{...o(31448).RC},children:d}),s&&(0,n.jsx)("div",{style:p,children:"Bot"})]})}},957881:(e,t,o)=>{o.d(t,{w:()=>p});var n=o(242343),i=()=>o(237385),s=()=>o(803290),r=()=>o(174114),a=()=>o(791976),l=()=>o(759625),c=()=>o(84543),d=()=>o(28210),u=()=>o(219322),m=o(163643);function p(e){const{clickTitleBehavior:t,blockStore:o,format:a,shouldWrap:p}=e,h="edit"===t,f=(0,i().v3)(),[x,v,S]=(0,s().K8)((()=>[o.getIcon(),o.isEmptyPage(),o.isReady()&&"none"===o.getRole()]),[o]),{style:b}=(0,r().IS)((()=>({style:{flexShrink:0,marginRight:h?0:u().U[a].recordIconMarginRight,justifyContent:"flex-start",...p&&{display:"inline-block",verticalAlign:"text-top",marginBottom:-1}}})),[h,a,p]),C=(0,n.useCallback)((e=>{const t=o.getIconStore();t&&c().createAndCommit({userAction:"RelationToken.handleRecordIconChange",environment:f,canUndo:!0,perform:o=>{l().KY({store:t,value:e,transaction:o})}})}),[o,f]),y={icon:x,size:u().U[a].pageIconSize,isEmptyPage:v,style:b};return S?(0,m.jsx)(g,{...y}):h?(0,m.jsx)(d().B,{...y,disabled:!1,onChange:C,bucket:"public"}):(0,m.jsx)(d().B,{...y,disabled:!0})}function g(e){const t=(0,r().DP)();return(0,a().T)({...e.style,width:e.size,height:e.size,fill:t.icon.secondary,verticalAlign:"top",marginTop:1})}}}]);