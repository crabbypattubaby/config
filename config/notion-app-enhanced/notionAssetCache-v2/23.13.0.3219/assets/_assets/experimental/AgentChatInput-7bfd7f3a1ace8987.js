"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[90068],{980758:(e,t,n)=>{n.r(t),n.d(t,{AgentChatInput:()=>ne});var a=n(242343),o=()=>n(752597),i=()=>n(237385),r=()=>n(803290),s=()=>n(174114),l=()=>n(353509),c=()=>n(404354);const d=(0,n(680369).xh)("sliders",{default:{loader:()=>n.e(95717).then(n.bind(n,954397))},small:{loader:()=>n.e(95717).then(n.bind(n,148071))},fill:{loader:()=>n.e(95717).then(n.bind(n,134711))},fillSmall:{loader:()=>n.e(95717).then(n.bind(n,802033))}},["slider","adjust","control","settings","knob"]);var p=()=>n(197821),u=()=>n(34662),h=()=>n(653998),g=()=>n(76394),f=()=>n(375589),m=()=>n(357247),S=()=>n(448316),x=()=>n(384221),A=()=>n(84543),y=()=>n(373040),b=()=>n(209684),C=()=>n(273520),v=()=>n(356813),w=()=>n(206799),I=()=>n(636045),k=()=>n(8519),j=()=>n(137476),M=()=>n(983050),T=()=>n(868199),_=()=>n(621641),P=()=>n(622286),G=()=>n(339190),K=()=>n(485966),O=()=>n(205670),B=()=>n(477557),F=()=>n(308265),V=()=>n(165786),D=()=>n(45524),E=()=>n(503691),N=()=>n(895644),R=()=>n(168163),$=()=>n(935091),W=()=>n(858023),Y=()=>n(88271),q=()=>n(725599),z=()=>n(640979),H=()=>n(615705),L=()=>n(403870),U=n(163643);function Q(e){const{clientStore:t,threadStore:n}=e;return(0,U.jsx)($().A,{menuType:z().gu.Popup,children:(0,U.jsx)(W().Ay,{type:W().Oh.Vertical,initialFocus:void 0,sections:[{key:"agent_chat_settings",render:e=>(0,U.jsx)(Y().A,{...e}),items:[{key:"persist_strategy_selection",render:e=>(0,U.jsx)(X,{clientStore:t,threadStore:n}),action:()=>{}},{key:"model_picker",render:e=>(0,U.jsx)(f().rm,{clientStore:t}),action:()=>{}}]}]})})}function X(e){const{clientStore:t,threadStore:n}=e,o=(0,i().v3)(),s=(0,r().O$)(K().default),l=(0,r().K8)((()=>{var e;return"auto_accept"===(null===(e=s.currentSpaceViewStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.agent_perist_strategy)}),[s.currentSpaceViewStore]),c=(0,a.useCallback)((()=>{s.currentSpaceViewStore&&(0,L().K)({environment:o,spaceViewStore:s.currentSpaceViewStore})}),[s.currentSpaceViewStore,o]),d=(0,r().K8)((()=>(0,H().Uu)({threadStore:n,clientStore:t})),[n,t]);return(0,U.jsx)(q().A,{focused:!1,title:(0,U.jsx)(h().sA,{id:"AgentChatSettingsMenu.PersistStrategy.AutoAcceptChangesButtonTitle",defaultMessage:"Auto-accept changes"}),icon:(0,U.jsx)(w().Q,{iconGroup:R().b,variantName:"small",colorName:"lightGrayPrimary"}),on:l,onClick:c,disabled:d.length>0})}var J=()=>n(339496),Z=()=>n(999360),ee=()=>n(222652);const te=(0,h().YK)({placeholder:{id:"aiInferenceTranscript.placeholder",defaultMessage:"Ask AI anything..."}});function ne(e){const t=(0,h().tz)(),{store:n,onSubmit:R,clientStore:$,threadStore:W,showInitialModePicker:Y,aiChatFeatureController:q,config:z,loadAttachmentData:H}=e,L=(0,i().v3)(),[X,ne]=a.useState(!1),re=(0,r().K8)((()=>0===(0,u().AhH)(n.getValue()||[])),[n]),se=(0,r().K8)((()=>n.getValue()),[n]),le=(0,r().K8)((()=>Boolean(void 0!==(null==W?void 0:W.getCurrentInferenceId())||(null==W?void 0:W.id)&&$.getOrCreateClientAIChatThreadStore(W.id).state.loading)),[W,$]),ce=(0,a.useCallback)((()=>{if(!W)return;const{serverCommitResult:e}=A().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:L,canUndo:!0,perform:e=>{(0,V().GS)({threadStore:W,transaction:e,clientStore:$})}}),t=$.getOrCreateClientAIChatThreadStore(W.id);t.setState({...t.state,stopInferencePromise:e})}),[L,W,$]),de=(0,a.useCallback)((async()=>{const{dictationActions:e}=await k().$O.load(),t=(0,u().q4_)(n.getValue()||[]);await e.StreamingDictationManager.start({environment:L,onTranscription:e=>{const a=t?`${t}\n${e}`:e;A().createAndCommit({userAction:"AIChatInput.handleDictation",environment:L,canUndo:!0,perform:e=>{S().R9({environment:L,store:n,value:(0,u().x9d)(a),transaction:e})}})}}),ne(!0)}),[L,n]),pe=(0,a.useCallback)((async()=>{const{dictationActions:e}=await k().$O.load();await e.StreamingDictationManager.stop(),ne(!1)}),[]);(0,a.useEffect)((()=>()=>{pe()}),[pe]);const ue=(0,r().O$)(K().AppStoreCurrentSpaceStore),he=(0,r().K8)((()=>(0,D().ak)({spaceStore:ue})),[ue]),ge=Y&&q.supportsModePicker,fe=(0,P().X)("workflows_use_agent")&&z&&"workflow"===z.type;(0,E().M)({textValue:se,isEnabled:q.supportsAutoRouting,clientStore:$,configs:he});const me=(0,s().IS)((e=>({stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1,borderRadius:12},wrap:{display:"flex",fontSize:12,alignItems:"center",flexWrap:"wrap",boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.surface.elevated:e.contentBackground,borderRadius:12,overflow:"inherit",position:"relative"},textContainer:{flexGrow:1,padding:"8px 12px 12px 12px",minHeight:56,maxHeight:240,overflow:"auto",fontSize:14},placeholder:{opacity:1,cursor:"text",minHeight:56},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 10px",gap:4},leftGutter:{display:"flex",alignItems:"flex-end",justifyContent:"flex-start",padding:"0 0 6px 6px"},sendButtonIcon:{width:28,height:28,padding:"0 0 0 4px"},sendButton:{width:28,height:28},microphoneIcon:{width:28},stopIcon:{width:28,height:28},inputActionsRow:{display:"flex",width:"100%",justifyContent:"space-between",overflow:"hidden",height:40}})),[]),Se=(0,a.useCallback)((async()=>{const e=O().default.state;"editing"===e.mode&&(0,_().KP)(e.multiSelection)&&e.multiSelection.start.store===n||(x().setSelectionAtEnd({store:n}),await o().default.afterNextFlush())}),[n]),xe=(0,r().K8)((()=>!W||W.canEdit()),[W]),Ae=(0,a.useCallback)((()=>{xe&&!le&&(null==R||R(n.getValue()),requestAnimationFrame((()=>{const e=G().n.findNodeFromStore(n);e&&e.focus()})))}),[R,n,le,xe]),ye=(0,r().K8)((()=>$.state.configForNewTranscripts),[$]),be=(0,a.useMemo)((()=>function(e){const{config:t,threadStore:n,intl:a}=e;if(n){const e=ie[t.type];if(e)return a.formatMessage(e);const n=oe[t.type];return n?a.formatMessage(n):a.formatMessage(te.placeholder)}if("markdown-chat"===t.type){const e=t.model;if(e){const t=(0,g().O)(ae,e)?ae[e]:void 0;if(t)return a.formatMessage(t)}}const o=oe[t.type];if(o)return a.formatMessage(o);return a.formatMessage(te.placeholder)}({config:ye,threadStore:W,intl:t})),[ye,W,t]),Ce=(0,r().K8)((()=>(0,F().aj)()),[]),ve=q.supportsTranscription;return(0,U.jsxs)("div",{style:me.stagingAndInputWrap,tabIndex:0,children:[Ce&&(0,U.jsx)(N()._,{clientStore:$}),(0,U.jsxs)("div",{className:M().CCX,style:me.wrap,children:[(0,U.jsx)(I().A,{style:me.textContainer,placeholder:be,disabled:!1,store:n,placeholderStyle:me.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:Ae,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:T().Os.none,usePopupForMentionOnMobile:!0,disableMentions:!q.shouldAllowMentions,disabledMentionTypes:B().md,onPasteFiles:null==H?void 0:H.onPasteFiles}),q.shouldSupportAttachments(ye.type)&&H&&(0,U.jsx)(J().Yo,{clientStore:$,loadAttachmentsData:H}),(0,U.jsxs)("div",{style:me.inputActionsRow,children:[ge&&(0,U.jsx)("div",{style:me.leftGutter,children:(0,U.jsx)(f()._,{clientStore:$,configs:he,threadStore:W})}),fe&&(0,U.jsx)("div",{style:me.leftGutter,children:(0,U.jsx)(C().Ay,{popupType:C().z7.Popup,placementToOrigin:C().sx.Bottom,alignmentToOrigin:C().yP.Center,originGap:4,renderOrigin:e=>(0,U.jsx)(b().p,{...e,children:(0,U.jsx)(w().Q,{iconGroup:d,variantName:"small",colorName:"lightGrayPrimary"})}),render:e=>(0,U.jsx)(Q,{clientStore:$,threadStore:W})})}),(0,U.jsx)("div",{style:{flexGrow:1}}),(0,U.jsxs)("div",{style:me.rightGutter,children:[q.supportsWebSearch(ye.type)&&(0,U.jsx)(ee().l,{clientStore:$}),q.supportsSearchScopePopup(ye.type)&&(0,U.jsx)(Z().d,{clientStore:$,threadStore:W}),q.shouldSupportAttachments(ye.type)&&H&&(0,U.jsx)(J().Wn,{loadAttachmentsData:H,clientStore:$}),q.shouldAllowMentions&&(0,U.jsx)(y().q,{onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){await Se(),await o().default.afterNextFlush(),m().Gf({environment:L,mentionTypes:B().Ap,usePopupOnMobile:!0}),(0,j().u4)({environment:L,event:{eventName:"clicked_ai_chat_at_mention_button",eventProperties:{mode:ye.type}}})}()}}),X?(0,U.jsx)(v().A,{icon:p().m,onClick:pe,iconStyle:me.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopRecording",defaultMessage:"Stop recording"})},"stop-recording"):le?(0,U.jsx)(v().A,{icon:p().m,onClick:ce,iconStyle:me.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopInference",defaultMessage:"Stop AI message"})},"stop-inference"):(0,U.jsxs)(U.Fragment,{children:[!X&&ve&&(0,U.jsx)(v().A,{icon:l().E,onClick:de,iconStyle:me.microphoneIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.startRecording",defaultMessage:"Start recording"})},"start-recording"),(0,U.jsx)(v().A,{icon:c().b,onClick:Ae,style:me.sendButton,iconStyle:me.sendButtonIcon,isDarkIconColor:!re,disabled:re,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.submitAiMessage",defaultMessage:"Submit AI message"})},"send-message")]})]})]})]})]})}const ae=(0,h().YK)({"anthropic-sonnet-3.7":{id:"AIChatInput.placeholder.anthropicSonnet3Point7",defaultMessage:"Ask Claude 3.7 Sonnet…"},"openai-gpt-4.1":{id:"AIChatInput.placeholder.openaiGpt4Point1",defaultMessage:"Ask GPT-4.1…"}}),oe=(0,h().YK)({search:{id:"AIChatInput.placeholder.agent",defaultMessage:"Send a message…"}}),ie=(0,h().YK)({researcher:{id:"aiInferenceTranscript.research_mode_placeholder",defaultMessage:"Ask a follow up question..."}})}}]);