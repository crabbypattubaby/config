"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[32413],{107310:(e,t,o)=>{o.d(t,{E:()=>w});o(242343);var n=()=>o(237385),i=()=>o(803290),l=()=>o(174114),r=()=>o(555919),c=()=>o(653998),a=()=>o(191756),s=()=>o(209684),d=()=>o(28210),u=()=>o(709237),p=()=>o(163182),h=o(163643);function w(e){const{collectionStore:t,pageVisitSource:o,size:w}=e,f=(0,n().v3)(),S=(0,c().tz)(),v=(0,i().K8)((()=>{var e;return null==t||null===(e=t.getParentBlockStore())||void 0===e?void 0:e.getNavigableBlockStore()}),[t]),m=(0,i().K8)((()=>null==t?void 0:t.getIcon()),[t]),x=function(e){return(0,l().IS)((t=>({button:{display:"inline-flex",alignItems:"center",color:t.text.primary,paddingLeft:4,paddingRight:4,marginRight:2,height:24,flex:"1 1 auto",gap:4,fontSize:e}})),[e])}(w);return(0,h.jsxs)(s().p,{style:x.button,onClick:e=>{v&&(a().uK({environment:f,store:v,pageVisitSource:o}),p().S.close(),e.stopPropagation(),e.preventDefault())},children:[(0,h.jsx)(d().B,{disabled:!0,icon:m,isEmptyPage:!1,size:w,useInvertedColors:!1}),t?(0,h.jsx)(u().A,{store:t}):(0,r().L)(S)]})}},246132:(e,t,o)=>{o.d(t,{S:()=>h,f:()=>w});o(362833);var n=o(242343),i=()=>o(237385),l=()=>o(803290),r=()=>o(502140),c=(o(610931),()=>o(73751)),a=()=>o(413871),s=()=>o(84543);var d=()=>o(838572),u=()=>o(166632),p=()=>o(303862);function h(e,t){let{canUndo:o,shouldPersistOperation:h}=t;const w=(0,i().v3)(),f=(0,n.useRef)([]).current,S=(0,n.useCallback)((e=>{f.push(...e)}),[f]),v=(0,n.useCallback)((e=>{h&&!h(e)||S([e])}),[S,h]),m=(0,p().l)(e,{cacheFallback:w.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0,onOperationCallback:v});(0,n.useEffect)((()=>{d().A.initializeCache(e,m)}),[e,m]);const x=(0,n.useCallback)((()=>{u().default.reset(),d().A.clearCache(e)}),[e]);(0,n.useEffect)((()=>(u().default.reset(),()=>{u().default.reset(),d().A.expire(e)})),[e]);const y=(0,l().K8)((()=>u().default.state.undoStack.length>0),[]);(0,n.useEffect)((()=>{d().A.updateUnsavedCacheState(e,y)}),[e,y]);const C=(0,n.useCallback)((async e=>{if(0===f.length)return void 0;m.assertUnexpired(),function(e){for(const t of u().default.state.undoStack)for(const o of t.transactions)for(const t of o.stores)if(t.inMemoryRecordCache!==e&&!t.inMemoryRecordCache.isMockTextStore){const n=o.getUserActionForAnalyticsPurposesOnly(),i=t.inMemoryRecordCache.name,l=e.name,c=`Undoable user action "${n}" was applied to cache "${i}", but only operations in the cache "${l}" should be in the undo stack!`;(0,r().log)({from:"useLocalDraft",type:"invalidStoreInRevisionStack",level:"error",data:{message:c,miscDataToConvertToString:{userAction:n,inMemoryRecordCacheName:i,expectedInMemoryRecordCacheName:l}}})}}(m);const{serverCommitResult:t}=s().createAndCommit({environment:w,userAction:e,perform(e){!function(e){let{environment:t,transaction:o,operationsWithStores:n}=e;for(const{operation:i,store:l}of n){if(!(l instanceof a().pm))continue;const e=l.clone(t.defaultRecordCache.inMemoryRecordCache);(0,c().ph)(i)?s().applyCrdtTextOperation({store:l,operation:i,transaction:o,invertedOperation:void 0}):s().applyOperation({transaction:o,store:e,operation:i})}}({environment:w,transaction:e,operationsWithStores:f}),e.postSubmitCallbacks.push((e=>{e||(m.expire(),u().default.reset())}))},canUndo:o});return t}),[e,o,w,f,m]);return(0,n.useMemo)((()=>({cache:m,hasChanges:y,persist:C,reset:x})),[y,C,x,m])}function w(e,t){return(0,l().K8)((()=>t.clone(e.cache)),[t,e.cache])}},532623:(e,t,o)=>{o.r(t),o.d(t,{ModalOverlayCollectionView:()=>F});o(610931);var n=o(242343),i=()=>o(237385),l=()=>o(269280),r=()=>o(803290),c=()=>o(174114),a=()=>o(712437),s=()=>o(162901),d=()=>o(793746),u=()=>o(740520),p=()=>o(289765),h=()=>o(653998),w=()=>o(76394),f=()=>o(31448),S=()=>o(75187),v=()=>o(759625),m=()=>o(84543),x=()=>o(64713),y=()=>o(435819),C=()=>o(966789),g=()=>o(922172),V=()=>o(286404),k=()=>o(951540),b=()=>o(983050),I=()=>o(468933),j=()=>o(392608),B=()=>o(622286),A=()=>o(246132),M=()=>o(485966),R=()=>o(595922),O=()=>o(838572),z=()=>o(413871),D=()=>o(871856),W=()=>o(163182),_=()=>o(107310),E=o(163643);const P=600,U=800,T={display:"flex",justifyContent:"center",alignItems:"center",height:o(596717).PN+o(333212).nh+40},H=["search","saveOrOpenOverflow","closeCollectionViewInModal"];function F(){const e=(0,r().K8)((()=>W().S.state),[]);return e.isOpen?"chart_drilldown"===e.type&&e.collectionViewBlockStore&&e.collectionViewValue?(0,E.jsx)(K,{collectionViewBlockStore:e.collectionViewBlockStore,collectionViewValue:e.collectionViewValue,viewsModuleContext:e.viewsModuleContext,title:e.title}):"ai_ephemeral_view"===e.type&&e.collectionViewBlockId&&e.collectionViewId?(0,E.jsx)(N,{render:()=>(0,E.jsx)(L,{collectionViewBlockId:e.collectionViewBlockId,collectionViewId:e.collectionViewId,type:e.type})}):null:null}function K(e){const{collectionViewBlockStore:t,collectionViewValue:o,viewsModuleContext:r,title:c}=e,[a,s]=(0,n.useState)(),d=(0,i().v3)(),u=(0,B().X)("charts_drilldown"),p=(0,A().S)(I().oW,{canUndo:!1}),h=(0,A().f)(p,t);return(0,l().w)((()=>{if(!u)return;const e=m().createAndCommit({environment:d,perform(e){var t;v().zv({store:h.getFormatStore(),data:{block_locked:!0,block_locked_by:null===(t=d.currentUser)||void 0===t?void 0:t.id},transaction:e});return(0,D().i)({environment:d,collectionViewBlockStore:h,collectionView:o,transaction:e,isEphemeral:!0}).id},userAction:"CollectionChartView.onDrilldownClick",canUndo:!1});s(e.performResult)})),a?(0,E.jsx)(N,{render:()=>(0,E.jsx)(L,{collectionViewBlockId:t.id,collectionViewId:a,type:"chart_drilldown",title:c,viewsModuleContext:r})}):null}function N(e){const{render:t}=e,{isPhone:o}=(0,i().Y0)(),l=(0,h().tz)(),r=(0,c().IS)((e=>({modalInnerStyle:{background:e.surface.page,borderRadius:12,minHeight:250,maxHeight:P,width:U},phoneModalInnerStyle:{background:e.surface.page,borderRadius:"12px 12px 0 0",height:"66.66vh",width:"100%",position:"absolute",bottom:0}})),[]),a=(0,n.useCallback)((()=>W().S.close()),[]);return(0,E.jsx)(g().a,{className:b().HA4,open:!0,preventHideChildrenWhileOpening:!0,onDismiss:a,innerStyle:o?r.phoneModalInnerStyle:r.modalInnerStyle,showCloseIcon:o,render:()=>(0,E.jsx)(y().A,{capture:!0,allowEsc:!0,render:t}),ariaLabel:l.formatMessage({defaultMessage:"Table data preview",id:"ModalOverlayCollectionView.ariaLabel"})})}function L(e){const{collectionViewBlockId:t,collectionViewId:o,type:l,title:a,viewsModuleContext:d}=e,u=(0,i().v3)(),{isPhone:h}=(0,i().Y0)(),f=(0,r().K8)((()=>(0,j().w6)(u)),[u]),S=function(e){const{collectionViewBlockId:t,collectionViewId:o}=e,n=(0,r().K8)((()=>{if(M().default.state.currentSpaceStore)return M().default.state.currentSpaceStore;const e=M().default.state.mainEditorCurrentBlockStore;return null!=e&&e.getSpaceStore()?e.getSpaceStore():void 0}),[]),[{value:i}]=(0,s().Yb)((async()=>{var e;if(!n)return{type:"loading"};let i=z().Bv.createChildStore(n,{table:"block",id:t});const l=null===(e=O().A.state.caches[I().oW])||void 0===e?void 0:e.inMemoryRecordCache;if(l&&(i=i.clone(l)),await i.load(),!i.isCollectionView())throw new Error("expected collection view");const r=z().pS.createChildStore(i,{table:p().Gy,id:o});await r.load();const c=r.getCollectionStore();return await(null==c?void 0:c.load()),{collectionViewBlockStore:i,collectionViewStore:r,collectionStore:c}}),[t,o,n]);return i&&"loading"!==i.type&&i.collectionViewBlockStore?{type:"loaded",value:{collectionViewBlockStore:i.collectionViewBlockStore,collectionViewStore:i.collectionViewStore,collectionStore:i.collectionStore}}:{type:"loading"}}({collectionViewBlockId:t,collectionViewId:o}),v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const[t,o]=(0,n.useState)(!1),i=(0,n.useRef)(Date.now());return(0,n.useEffect)((()=>{let t;const n=requestAnimationFrame((()=>t=requestAnimationFrame((()=>{const t=Date.now()-i.current;t>e?o(!0):setTimeout((()=>{o(!0)}),e-t)}))));return()=>{cancelAnimationFrame(n),t&&cancelAnimationFrame(t)}}),[]),t}(150),m=(0,c().IS)((()=>({phoneContainer:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},phoneCollectionViewBlockContainer:{overflow:"hidden"}})),[]);if(!v)return(0,E.jsx)("div",{style:T,children:(0,E.jsx)(C().A,{})});switch(S.type){case"loading":return(0,E.jsx)("div",{style:T,children:(0,E.jsx)(C().A,{})});case"loaded":{const{collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n}=S.value,i=h&&n&&!f;let r;"ai_ephemeral_view"!==l&&a?"chart_drilldown"===l&&(r=(0,E.jsx)(q,{title:a})):r=(0,E.jsx)(G,{collectionStore:n});const c=(0,E.jsx)(x().dN,{headerText:r,headerActionsBehavior:"always_show",headerAllowedActions:H,hideViewTabBar:!0,isUnlistedView:!0,store:e,isFullScreen:!1,productUseCase:l,disabled:!0,viewId:o,overridePaddingLeft:0,overridePaddingRight:0,additionalCollectionViewInnerHorizontalPadding:16,viewsModuleContext:d,maxHeight:h?void 0:P-72,setCollectionContextStore:o=>{o.setContext({type:"collectionView",collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n,pageVisitSourceOverride:void 0}),h?o.filtersBarOpenStore.setState(!1):o.filtersBarOpenStore.setState(!0)}});return h?(0,E.jsxs)("div",{style:m.phoneContainer,children:[(0,E.jsx)("div",{style:m.phoneCollectionViewBlockContainer,children:c}),i&&(0,E.jsx)(Y,{environment:u,collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n,isChartDrilldown:"chart_drilldown"===l})]}):c}default:(0,w().HB)(S)}}function q(e){const{title:t}=e,{isPhone:o}=(0,i().Y0)(),n=(0,c().IS)((e=>({headerWrapper:{display:"flex",alignItems:"center",flexGrow:1,gap:6,...o?{justifyContent:"center"}:{justifyContent:"flex-start"}},textWrapper:{color:e.text.primary,fontSize:17,fontWeight:f().Wy.bold,display:"flex",alignItems:"center"}})),[o]);return(0,E.jsx)("div",{style:n.headerWrapper,children:(0,E.jsx)("div",{style:n.textWrapper,children:t})})}function G(e){const{collectionStore:t}=e,o=(0,c().IS)((e=>({textWrapper:{color:e.primaryBlack,fontSize:17,fontWeight:f().Wy.medium,display:"flex",alignItems:"center"}})),[]);return(0,E.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexGrow:1},children:(0,E.jsx)("div",{style:o.textWrapper,children:(0,E.jsx)(h().sA,{defaultMessage:"Results in {databaseName}",id:"AssistantEphemeralViewHeader.resultsIn",values:{databaseName:(0,E.jsx)(_().E,{collectionStore:t,pageVisitSource:a().y8.AIEphemeralView,size:17})}})})})}function Y(e){const{environment:t,collectionViewBlockStore:o,collectionViewStore:i,collectionStore:l,isChartDrilldown:r}=e,s=(0,h().tz)(),p=(0,n.useRef)(null),w=(0,c().IS)((()=>({container:{padding:"32px 16px 48px",display:"flex",justifyContent:"space-between",gap:10},button:{width:"100%",flexShrink:1,height:44,borderRadius:12,fontSize:17},buttonIcon:{width:24,height:24}})),[]),f=(0,n.useCallback)((()=>{S().B({environment:t,blockStore:o,pageVisitSource:r?a().y8.ChartsDrilldown:a().y8.AIEphemeralView})}),[t,o,r]),v=(0,n.useCallback)((()=>{var e;const n=new(R().A)(t);n.setContext({type:"collectionView",collectionViewBlockStore:o,collectionViewStore:i,collectionStore:l,pageVisitSourceOverride:void 0}),S().G({collectionContextStore:n,environment:t,originRect:null===(e=p.current)||void 0===e?void 0:e.getBoundingClientRect(),isChartDrilldown:r,intl:s})}),[o,i,l,t,r,s,p]);return(0,E.jsxs)("div",{style:w.container,children:[(0,E.jsx)(V().A,{style:w.button,icon:u().arrowDiagonalUpRightIcon,iconStyle:w.buttonIcon,onClick:f,children:(0,E.jsx)(h().sA,{defaultMessage:"Open source",id:"ModalOverlayCollectionView.phoneButtons.openSource"})}),(0,E.jsx)(k().A,{ref:p,style:w.button,icon:d().addSquareRoundedIcon,iconStyle:w.buttonIcon,onClick:v,children:(0,E.jsx)(h().sA,{defaultMessage:"Save view",id:"ModalOverlayCollectionView.phoneButtons.saveView"})})]})}},793746:(e,t,o)=>{o.r(t),o.d(t,{addSquareRoundedIcon:()=>l,iconDefinition:()=>i});o(242343);var n=o(163643);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 6.375c.345 0 .625.28.625.625v2.375H13a.625.625 0 1 1 0 1.25h-2.375V13a.625.625 0 1 1-1.25 0v-2.375H7a.625.625 0 1 1 0-1.25h2.375V7c0-.345.28-.625.625-.625"}),(0,n.jsx)("path",{d:"M3.125 5.25c0-1.174.951-2.125 2.125-2.125h9.5c1.174 0 2.125.951 2.125 2.125v9.5a2.125 2.125 0 0 1-2.125 2.125h-9.5a2.125 2.125 0 0 1-2.125-2.125zm2.125-.875a.875.875 0 0 0-.875.875v9.5c0 .483.392.875.875.875h9.5a.875.875 0 0 0 .875-.875v-9.5a.875.875 0 0 0-.875-.875z"})]})},l=(0,o(680369).wt)("addSquareRounded",i)}}]);