"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[91137],{35927:(e,t,o)=>{o.d(t,{S:()=>y});o(242343);var r=()=>o(237385),n=()=>o(174114),i=()=>o(267689),a=()=>o(653998),l=()=>o(126451),s=()=>o(103151),p=()=>o(663073),c=()=>o(951920),d=()=>o(907721),u=o(163643);const m=(0,a().YK)({addDescriptionTooltip:{id:"database.description.addDescriptionTooltip",defaultMessage:"Add description"},editDescriptionTooltip:{id:"database.description.editDescriptionTooltip",defaultMessage:"Edit description"}});function y(e){let{onClick:t,description:o,showTooltip:y,addDescriptionText:g,editDescriptionText:h,disabled:f}=e;const{isMobile:S}=(0,r().Y0)(),[v,x]=(0,c().B)(),b=(0,a().tz)(),C=(0,n().IS)((e=>({button:{flexShrink:0,flexGrow:0,borderRadius:S?24:20,marginLeft:4},info:{width:S?18:16,height:S?18:16,fill:x&&!f?e.regularIconColor:e.mediumIconColor}})),[x,S,f]);return(0,u.jsx)(s().A,{renderTooltip:e=>(0,u.jsx)("div",{...e,children:Boolean(null==o?void 0:o.length)?o:g??b.formatMessage(m.addDescriptionTooltip)}),disableTooltip:!y||f,style:p().Q$,placement:d().W.Top,render:e=>(0,u.jsx)(l().A,{...e,ref:v,onClick:t,"aria-label":Boolean(null==o?void 0:o.length)?g:h??b.formatMessage(m.editDescriptionTooltip),style:C.button,disabled:f,disabledFeedback:f,children:(0,i().q)(C.info)})})}},63463:(e,t,o)=>{e.exports=o.p+"edfba4a6d1ff7acd.png"},64562:(e,t,o)=>{o.d(t,{d:()=>n});o(242343);var r=o(163643);const n=(0,o(680369).wt)("eyePadded",{viewBox:"0 0 24 24",svg:(0,r.jsx)("path",{d:"M12 17.9912C17.6055 17.9912 21.3857 13.4727 21.3857 12.0713C21.3857 10.6699 17.5986 6.1582 12 6.1582C6.47656 6.1582 2.60742 10.6699 2.60742 12.0713C2.60742 13.4727 6.46973 17.9912 12 17.9912ZM12 16.6787C7.63184 16.6787 4.15918 13.0283 4.15918 12.0713C4.15918 11.2715 7.63184 7.4707 12 7.4707C16.3613 7.4707 19.8408 11.2715 19.8408 12.0713C19.8408 13.0283 16.3613 16.6787 12 16.6787ZM12 15.7559C14.0508 15.7559 15.6914 14.0811 15.6914 12.0713C15.6914 10.0137 14.0508 8.39355 12 8.39355C9.94238 8.39355 8.29492 10.0137 8.30176 12.0713C8.31543 14.0811 9.94238 15.7559 12 15.7559ZM12 13.2607C11.3369 13.2607 10.7969 12.7275 10.7969 12.0713C10.7969 11.415 11.3369 10.8818 12 10.8818C12.6631 10.8818 13.1963 11.415 13.1963 12.0713C13.1963 12.7275 12.6631 13.2607 12 13.2607Z"})})},89335:(e,t,o)=>{o.d(t,{j:()=>i});var r=()=>o(96297),n=()=>o(593745);function i(e){const{collectionContextStore:t,environment:o,fit:i}=e,a=t.collectionViewBlockStore();if(a){const e=n().K.findCollectionViewBlockFromStore(a);if(e){const t=e.getNode();t instanceof HTMLElement&&(0,r().$v)({blockAlignment:"start",element:t,environment:o,behavior:"instant",additionalPadding:{top:"filtersBar"===i?64:128},verticalVisibilityRequirement:"topVisible",horizontalVisibilityRequirement:"none"})}}}},264898:(e,t,o)=>{o.d(t,{h:()=>L});o(362833),o(725707),o(491955),o(500234),o(324989),o(403517);var r=o(242343),n=()=>o(237385),i=()=>o(803290),a=()=>o(752903),l=()=>o(916653),s=()=>o(134917),p=()=>o(836693),c=()=>o(21164),d=()=>o(653998),u=()=>o(220413),m=()=>o(975392),y=()=>o(31448),g=()=>o(696987),h=()=>o(213657),f=()=>o(378524),S=()=>o(145046),v=()=>o(35927),x=()=>o(467233),b=()=>o(637558),C=()=>o(749975),j=()=>o(876695),A=()=>o(640979),M=()=>o(622286),k=()=>o(466321),P=()=>o(724217),w=()=>o(331516),T=()=>o(401382),_=()=>o(935091),O=()=>o(858023),I=()=>o(743668),R=()=>o(443252),B=()=>o(88271),F=()=>o(278107),D=()=>o(837809),V=o(163643);const E=o(129044).default.createClass(!1,{name:"ShowSelectDescriptionStore"});function L(e){let{onClose:t,collectionId:o,propertySchema:a,property:l,onChange:s,option:p,analyticsFrom:c,statusGroup:d,origin:u,open:m,alignmentToOrigin:y}=e;const g=(0,n().v3)(),h=(0,C().ET)(),f=(0,i().uB)(void 0,E),[S,v]=(0,r.useState)(""),x=(0,r.useRef)(m);(0,r.useEffect)((()=>{!x.current&&m&&v(p.value),x.current=m}),[m,p.value]);const b=(0,r.useCallback)((()=>(0,V.jsx)(K,{collectionContextStore:h,onClose:t,collectionId:o,propertySchema:a,property:l,onChange:s,option:p,analyticsFrom:c,statusGroup:d,renameInputValue:S,setRenameInputValue:v,showSelectDescriptionStore:f})),[h,t,o,a,l,s,p,c,d,S,v,f]),j=(0,r.useCallback)((()=>function(e,t,o,r,n,i,a,l,s){o(),z(e,t,r,n,i,a,l,s)}(g,h,t,o,a,l,s,p,S)),[g,h,t,o,a,l,s,p,S]),{device:A}=g,P=(0,M().X)("db_ux_mobile");return(0,V.jsx)(R().Ay,{popupType:A.isMobile?P?k().n.BottomSheet:k().n.SlideUp:k().n.Popup,open:m,onDismiss:j,origin:u,render:b,alignmentToOrigin:y})}function K(e){let{collectionContextStore:t,onClose:o,collectionId:m,propertySchema:g,property:C,onChange:k,option:R,analyticsFrom:E,statusGroup:L,renameInputValue:K,setRenameInputValue:G,showSelectDescriptionStore:U}=e;const Y=(0,d().tz)(),W=(0,n().v3)(),q=(0,M().X)("db_ux_mobile"),H=(0,i().K8)((()=>t.collectionStore()),[t]),N=(0,r.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t(o)}(e,G)),[G]),Z=(0,r.useCallback)((()=>function(e,t,o,r,n,i,a,l,s){o(),z(e,t,r,n,i,a,l,s)}(W,t,o,m,g,C,k,R,K)),[W,t,o,m,g,C,k,R,K]),J=(0,r.useCallback)((()=>{if(H)return function(e,t,o,r,n,i,a,l,s){f().r$({environment:e,option:t,property:n,propertySchema:r,collectionStore:a,statusGroup:l}),i(),(0,h().L)(e,{...(0,j().sl)(s),property_type:r.type,action:"select_delete_option",from:o})}(W,R,E,g,C,o,H,L,t)}),[W,R,H,E,g,C,o,L,t]),{device:$}=W,Q=(0,i().O$)(U),X=[];Q&&X.push({key:"description",render:e=>(0,V.jsx)(B().A,{...e,desktopStyle:{paddingTop:0},title:$.isMobile?Y.formatMessage(x().s.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,V.jsx)(x().y,{...e,initialDescription:R.description,handleSaveDescription:e=>function(e,t,o,r,n,i,a,l){if(e===(l.description??""))return;const s={...l,description:e},p={pointer:{table:c().Vl,id:r},command:"keyedObjectListUpdate",path:["schema",n,"options"],args:{value:s}};o([p]),(0,h().L)(t,{property_type:i.type,action:"select_set_description",from:a})}(e,W,k,m,C,g,E,R),disableAutoSection:!0}),action:()=>{}}]});const ee={key:"action",render:e=>(0,V.jsx)(B().A,{...e}),items:[]};X.push(ee),ee.items.push({key:"delete",render:e=>(0,V.jsx)(w().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:p().trashIcon}),action:J}),L&&"status"===g.type&&(ee.items.push({key:"setAsDefault",render:e=>(0,V.jsx)(w().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:s().M}),action:()=>async function(e,t,o,r,n,i,a,l,s){if("status"!==o.type||!s)return;if(i.value===o.defaultOption)return;if(void 0!==o.defaultOption){const{accept:e}=await S().Gh({mode:"wide",message:(0,V.jsx)(d().sA,{defaultMessage:'Change default to "{defaultValue}"?',id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:i.value}}),description:(0,V.jsx)(d().sA,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:i.value,b:e=>(0,V.jsx)("span",{style:{fontWeight:y().Wy.semibold},children:e})}}),acceptLabel:(0,V.jsx)(d().sA,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})});if(!e)return}const p={table:c().Vl,id:e},u=[],m={pointer:p,command:"update",path:["schema",t],args:{defaultOption:i.value}};u.push(m),r(u),a(),(0,h().L)(l,{property_type:o.type,action:"status_set_default",from:n,collection_id:e})}(m,C,g,k,E,R,o,W,L)}),ee.items.push({key:"Group",render:e=>(0,V.jsx)("div",{...e,children:(0,V.jsx)(b().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:L.name,options:(g.groups??[]).map((e=>({key:e.name,type:"button",title:P().OR[e.name]??e.name}))),icon:l().i,onChange:e=>{!function(e,t,o,r,n,i,a,l,s){if("status"!==a.type||!s)return;const p={table:c().Vl,id:t},d=[],u=a.groups??[],m=u.findIndex((e=>e.id===s.id)),y=u.findIndex((t=>t.name===e));if(m===y)return;const g={pointer:p,command:"listRemove",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}},f={pointer:p,command:"listAfter",path:["schema",r,"groups",y,"optionIds"],args:{id:o.id}};d.push(g,f);const S=a.options??[],v=u.flatMap((e=>{const t=e.optionIds??[],o=S.filter((e=>t.includes(e.id)));return o})),x={pointer:p,command:"set",path:["schema",r,"options"],args:v};d.push(x),n(d),(0,h().L)(l,{property_type:a.type,action:"status_set_default",from:i,collection_id:t})}(e,m,R,C,k,E,g,W,L)}})}),action:()=>{}}));const te=u().tS.map((e=>{const t={key:e,render:t=>(0,V.jsx)(F().A,{...t,color:e,isChecked:R.color===e}),action:()=>{!function(e,t,o,r,n,i,a,l){const s={...t,color:e},p={pointer:{table:c().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:s}};i([p]),(0,h().L)(l,{property_type:n.type,action:"select_change_color",from:a,collection_id:o})}(e,R,m,C,g,k,E,W)}};return t})),oe={key:"color",render:e=>(0,V.jsx)(B().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),topBorder:!0}),items:te};let re;return X.push(oe),re=$.isMobile?{menuType:A().gu.Modal,title:(0,V.jsx)(D().O,{format:a().NY.Large,value:R.value,color:R.color,showRemoveButton:!1,isSingle:!0}),...!q&&{right:(0,V.jsx)(I().DoneMenuText,{}),onClickRight:Z}}:{menuType:A().gu.Popup,width:220},(0,V.jsxs)(_().A,{...re,children:[(0,V.jsx)(B().A,{isInput:!0,children:(0,V.jsx)(T().Ay,{focusInitial:!0,selectAll:!$.isMobile,value:K,maxlength:180,onChange:N,onSubmit:Z,showClearButton:!1,inputRight:(0,V.jsx)(v().S,{onClick:()=>U.setState(!Q),description:R.description,showTooltip:!Q})})}),(0,V.jsx)(O().Ay,{type:O().Oh.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:X})]})}function z(e,t,o,r,n,i,a,l){const s=l,p=r.options||[],u=p.find((e=>e.id!==a.id&&e.value.trim().toLowerCase()===s.trim().toLowerCase()));if(a.value!==s)if(s)if(u)S().f1((0,V.jsx)(d().sA,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const l=p.find((e=>e.id===a.id));if(!l)return;const d=s.trim(),u={...l,value:d},y={pointer:{table:c().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",n,"options"],args:{value:u}},h="status"===r.type&&a.value===r.defaultOption?{pointer:{table:c().Vl,id:o},command:"update",path:["schema",n],args:{defaultOption:d}}:void 0;i(m().oE([y,h])),(0,g().V)({environment:e,collectionContextStore:t,property:n,from:"view_settings",action:"select_rename_option",option_value_char_count:d.length})}else S().f1((0,V.jsx)(d().sA,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}},467233:(e,t,o)=>{o.d(t,{s:()=>d,y:()=>m});var r=o(242343),n=()=>o(237385),i=()=>o(174114),a=()=>o(653998),l=()=>o(401382),s=()=>o(88271),p=()=>o(663073),c=o(163643);const d=(0,a().YK)({descriptionHeader:{id:"database.viewSettings.propertyTab.description.title",defaultMessage:"Description"},addDescription:{id:"database.viewSettings.propertyTab.description.addDescription",defaultMessage:"Add a description..."}}),u=60;function m(e){let{initialDescription:t,handleSaveDescription:o,disableAutoSection:m}=e;const[y,g]=(0,r.useState)(t??""),h=(0,r.useRef)(y),{isMobile:f}=(0,n().Y0)(),S=(0,a().tz)(),v=(0,i().IS)((e=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default",color:e.text.secondary},descriptionInput:{lineHeight:"20px",fontSize:f?14:13}})),[f]),x=(0,r.useCallback)((()=>o(h.current)),[o]);(0,r.useEffect)((()=>()=>x()),[x]);const b=(0,r.useMemo)((()=>(0,c.jsx)(l().Ay,{value:y,onChange:e=>{g(e.target.value),h.current=e.target.value},onBlur:x,onSubmit:x,placeholder:S.formatMessage(d.addDescription),focusInitial:!0,disabled:!1,inputOuterStyle:v.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:p().fy,autosize:!0,autosizeMaxHeight:u,showClearButton:!1})),[y,S,x,v.descriptionInput]);return f&&!m?(0,c.jsx)(s().A,{topBorder:!0,isInput:!0,title:(0,c.jsx)("span",{style:v.title,children:S.formatMessage(d.descriptionHeader)}),children:b}):b}},619789:(e,t,o)=>{o.d(t,{C:()=>_,A:()=>O});var r=o(242343),n=()=>o(237385),i=()=>o(803290),a=()=>o(120082),l=()=>o(564134),s=()=>o(198654),p=()=>o(653998),c=()=>o(137476);var d=()=>o(44405),u=()=>o(749975),m=()=>o(86607),y=()=>o(876695),g=()=>o(640979),h=()=>o(906230),f=()=>o(962373),S=()=>o(413871),v=()=>o(535906),x=()=>o(273520),b=()=>o(858023),C=()=>o(443252),j=()=>o(88271),A=()=>o(103151),M=()=>o(224281),k=()=>o(808532),P=()=>o(395705),w=()=>o(493264),T=o(163643);let _=function(e){return e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings",e}({});const O=function(e){let{context:t,schema:r,property:a,parentStore:l,onDismiss:s,disabled:c,analyticsFrom:u,onChange:m}=e;const y=(0,o(174114).DP)(),S=(0,n().v3)(),v=(0,i().uB)(void 0,f().A),j=(0,i().uB)(void 0,f().A),k=(0,i().uB)(void 0,f().A),P=(0,n().Y0)(),w=(0,i().K8)((()=>I(r,a,l)),[r,a,l]),O=Boolean(null==w?void 0:w.propertySchema.relation_property),D=Boolean((null==w?void 0:w.propertySchema.relation_property)&&(null==w?void 0:w.propertySchema.target_property)),V=(0,i().K8)((()=>o(975392).oE([W(S,y,c,r,a,l,u,k,m),q(O,S,y,c,r,a,l,u,j,m),H(D,S,y,c,r,a,l,u,v,m)])),[O,D,S,y,c,r,a,l,u,m,v,k,j]),E=(0,i().K8)((()=>v.state.open),[v]),L=(0,i().K8)((()=>k.state.open),[k]),K=(0,i().K8)((()=>j.state.open),[j]);if(!w)return null;if(t===_.BlockPropertyOverlay){let e;return e=P.isMobile?{menuType:g().gu.Modal,title:w.propertySchema.name,right:(0,T.jsx)(o(743668).DoneMenuText,{}),onClickRight:s}:{menuType:g().gu.Popup},(0,T.jsx)(o(935091).A,{...e,children:(0,T.jsx)(b().Ay,{type:b().Oh.Vertical,initialFocus:void 0,sections:V})})}return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(x().Ay,{popupType:P.isMobile?C().nl.SlideUp:C().nl.Popup,alignmentToOrigin:x().yP.End,renderOrigin:e=>(0,T.jsx)(d().A,{title:(0,T.jsx)(p().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:c,showChevron:!0,rotateChevron:L,right:w.relationPropertySchema?(0,T.jsx)(M().mA,{propertySchema:w.relationPropertySchema,showIcon:!0}):(0,T.jsx)(p().sA,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,T.jsx)(G,{parent:e,analyticsFrom:u,schema:r,property:a,parentStore:l,onChange:m}),buttonPopupStore:k}),(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(B,{}),disableTooltip:O,render:e=>(0,T.jsx)(x().Ay,{popupType:P.isMobile?C().nl.SlideUp:C().nl.Popup,alignmentToOrigin:x().yP.End,renderOrigin:t=>(0,T.jsx)(d().A,{title:(0,T.jsx)("span",{style:{...!D&&{color:y.text.secondary}},children:(0,T.jsx)(p().sA,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})}),disabled:!O||c,showChevron:!0,rotateChevron:K,right:O&&(w.targetPropertySchema?(0,T.jsx)(M().mA,{propertySchema:w.targetPropertySchema,showIcon:!0}):(0,T.jsx)(p().sA,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"})),...(0,h().A)(e,t)}),render:e=>(0,T.jsx)(U,{parent:e,analyticsFrom:u,schema:r,property:a,parentStore:l,onChange:m}),buttonPopupStore:j})}),(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(F,{}),disableTooltip:D,render:e=>(0,T.jsx)(x().Ay,{popupType:P.isMobile?C().nl.SlideUp:C().nl.Popup,alignmentToOrigin:x().yP.End,renderOrigin:t=>(0,T.jsx)(d().A,{disabled:!D||c,title:(0,T.jsx)("span",{style:{...!D&&{color:y.text.secondary}},children:(0,T.jsx)(p().sA,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:E,right:D&&(0,T.jsx)(R,{schema:r,property:a,parentStore:l}),...(0,h().A)(e,t)}),render:e=>(0,T.jsx)(Y,{parent:e,analyticsFrom:u,schema:r,property:a,parentStore:l,onChange:m}),buttonPopupStore:v})})]})};function I(e,t,o){var r;const n=e[t];if(!n)return;let i,a;if(n.relation_property){const t=e[n.relation_property];t&&"relation"===t.type&&(i=t)}if(i){const e=l().Nv(i);a=e?S().md.createChildStore(o,e):void 0}const s=null===(r=a)||void 0===r?void 0:r.getValue(),p=s?l().Dp(s):{};let c;if(s&&n.target_property){var d;c=p[(null===(d=a)||void 0===d?void 0:d.getMappedProperty(n.target_property))??n.target_property]}return{propertySchema:n,relationPropertySchema:i,relatedCollectionValue:s,relatedCollectionSchema:p,targetPropertySchema:c}}function R(e){let{schema:t,property:o,parentStore:r}=e;const n=(0,i().K8)((()=>I(t,o,r)),[r,o,t]);return n?n.propertySchema.aggregation?(0,T.jsx)(T.Fragment,{children:m().zY[(0,a().ZP)(n.propertySchema.aggregation)]}):(0,T.jsx)(p().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function B(){return(0,T.jsx)(p().sA,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function F(){return(0,T.jsx)(p().sA,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function D(e,t){return e?void 0:(0,s().b)({width:11,fill:t.mediumIconColor})}function V(e){return"relation"===e.type}function E(e){return"rollup"!==e.type&&!(0,l().rK)(e.type)}function L(e,t,o,r,n,i,a,l){const s=I(r,n,i);if(!s)return;const p={...s.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==a||a({propertySchema:p}),function(e,t){c().vd(e,"configure_rollup_relation",t)}(t,{...(0,y().sl)(l),from:o})}function K(e,t,o,r,n,i,a,l){const s=I(r,n,i);if(!s||!s.relatedCollectionValue||!s.relatedCollectionSchema)return;const p=s.relatedCollectionSchema[e];if(!p)return;const d={...s.propertySchema,target_property:e,target_property_type:p.type,aggregation:void 0};null==a||a({propertySchema:d}),function(e,t){c().vd(e,"configure_rollup_target_property",t)}(t,{...(0,y().sl)(l),from:o,property_type:p.type})}function z(e,t,o,r,n,i,l,s){const p=I(r,n,i);if(!p)return;const d={...p.propertySchema,aggregation:e,show_as:void 0};null==l||l({propertySchema:d});const u=e?(0,a().ZP)(e):void 0;!function(e,t){c().vd(e,"configure_rollup_aggregation",t)}(t,{...(0,y().sl)(s),from:o,aggregation:u})}function G(e){let{parent:t,analyticsFrom:o,schema:i,property:a,parentStore:l,onChange:s}=e;const p=(0,n().v3)(),c=(0,u().ET)(),d=(0,r.useCallback)((e=>L(e,p,o,i,a,l,s,c)),[p,o,i,a,l,s,c]);return(0,T.jsx)(w().A,{schema:i,isRelationProperty:!0,onAccept:d,onClose:t.close,allowProperty:V})}function U(e){let{parent:t,analyticsFrom:o,schema:a,property:l,parentStore:s,onChange:p}=e;const c=(0,n().v3)(),d=(0,u().ET)(),m=(0,r.useCallback)((e=>K(e,c,o,a,l,s,p,d)),[c,o,a,l,s,p,d]),y=(0,i().K8)((()=>I(a,l,s)),[s,l,a]);return y?(0,T.jsx)(w().A,{isRelationProperty:!1,schema:y.relatedCollectionSchema,onAccept:m,allowProperty:E,onClose:t.close}):null}function Y(e){let{parent:t,analyticsFrom:o,schema:a,property:l,parentStore:s,onChange:c}=e;const d=(0,n().v3)(),m=(0,u().ET)(),y=(0,r.useCallback)((e=>z(e,d,o,a,l,s,c,m)),[d,o,a,l,s,c,m]),g=(0,i().K8)((()=>I(a,l,s)),[s,l,a]);return g&&g.propertySchema.target_property?(0,T.jsx)(k().A,{property:g.propertySchema.target_property,schema:g.relatedCollectionSchema,currentAggregation:g.propertySchema.aggregation?{aggregator:g.propertySchema.aggregation,property:g.propertySchema.target_property}:void 0,onChange:y,onClose:t.close,noneText:(0,T.jsx)(p().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"}):null}function W(e,t,o,r,n,i,a,l,s){const{device:c}=e,d=I(r,n,i);if(d)return{key:0,render:e=>(0,T.jsx)(j().A,{...e,title:(0,T.jsx)(p().sA,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"})}),items:[{key:0,render:e=>(0,T.jsx)(x().Ay,{popupType:c.isMobile?C().nl.SlideUp:C().nl.Popup,renderOrigin:r=>d.relationPropertySchema?(0,T.jsx)(P().G,{...(0,h().A)(e,r),propertySchema:d.relationPropertySchema,format:P().e.Name,right:D(o,t),disabled:o}):(0,T.jsx)(v().A,{...(0,h().A)(e,r),title:(0,T.jsx)(p().sA,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:D(o,t),style:{color:t.text.secondary},disabled:o}),render:e=>(0,T.jsx)(G,{parent:e,analyticsFrom:a,schema:r,property:n,parentStore:i,onChange:s}),buttonPopupStore:l},e.key),action:()=>{l.setState({open:!0})}}]}}function q(e,t,o,r,n,i,a,l,s,c){const{device:d}=t,u=I(n,i,a);if(u)return{key:1,render:e=>(0,T.jsx)(j().A,{...e,title:(0,T.jsx)(p().sA,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0}),items:[{key:0,render:t=>(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(B,{}),disableTooltip:e,render:m=>(0,T.jsx)(x().Ay,{popupType:d.isMobile?C().nl.SlideUp:C().nl.Popup,renderOrigin:n=>u.targetPropertySchema?(0,T.jsx)(P().G,{...(0,h().A)(t,n),propertySchema:u.targetPropertySchema,format:P().e.Name,right:D(r,o),disabled:r}):(0,T.jsx)(v().A,{...(0,h().A)(t,m),title:(0,T.jsx)(p().sA,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to display…"}),right:D(!e||r,o),disabled:!e||r,disabledFeedback:!0}),render:e=>(0,T.jsx)(U,{parent:e,analyticsFrom:l,schema:n,property:i,parentStore:a,onChange:c}),buttonPopupStore:s})},t.key),action:()=>{s.setState({open:!0})}}]}}function H(e,t,o,r,n,i,a,l,s,c){const{device:d}=t;if(I(n,i,a))return{key:2,render:e=>(0,T.jsx)(j().A,{...e,title:(0,T.jsx)(p().sA,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0}),items:[{key:0,render:t=>(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(F,{}),disableTooltip:e,render:u=>e?(0,T.jsx)(x().Ay,{popupType:d.isMobile?C().nl.SlideUp:C().nl.Popup,renderOrigin:e=>(0,T.jsx)(v().A,{...(0,h().A)(t,e),title:(0,T.jsx)(R,{schema:n,property:i,parentStore:a}),right:D(r,o),disabled:r}),render:e=>(0,T.jsx)(Y,{parent:e,analyticsFrom:l,schema:n,property:i,parentStore:a,onChange:c}),buttonPopupStore:s}):(0,T.jsx)(v().A,{...(0,h().A)(t,u),title:(0,T.jsx)(p().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:D(r,o),disabled:!0,disabledFeedback:!0})},t.key),action:()=>{s.setState({open:!0})}}]}}},637558:(e,t,o)=>{o.d(t,{A:()=>u});o(725707),o(500234),o(403517);var r=o(242343),n=()=>o(803290),i=()=>o(975392),a=()=>o(273520),l=()=>o(858023),s=()=>o(443252),p=()=>o(88271),c=()=>o(640979),d=o(163643);const u=function(e){let{icon:t,iconStyle:u,title:m,selectedKey:y,onChange:g,onClick:h,popupStyle:f,menuItemOptionsStyle:S,menuStyle:v,disabled:x,collectionContextStore:b,openButtonPopup:C,hideCheck:j,children:A,disableParentClose:M,inputPlaceholder:k,...P}=e;const w=(0,o(237385).Y0)(),T="options"in P?P.options:i().Bq(P.sections),_=T.find((e=>i().n4(e.key,y))),O=(0,n().uB)(void 0,o(962373).A),I=(0,n().O$)(O);return(0,r.useEffect)((()=>{b&&C&&(O.setState({...O.state,open:C}),b.settingsStore.setState({...b.settingsStore.state,openButtonPopup:void 0})),_||o(502140).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(450475).convertErrorToLog)("Selected key is invalid.")})})),(0,d.jsx)(a().Ay,{popupType:w.isMobile?s().nl.SlideUp:s().nl.Popup,alignmentToOrigin:a().yP.End,placementToOrigin:a().sx.Bottom,style:f,originGap:0,buttonPopupStore:O,disabled:x,onClick:h,renderOrigin:e=>(0,d.jsx)(o(44405).A,{title:m,showChevron:!0,right:(0,d.jsx)("span",{style:o(31448).RC,children:"input"===(null==_?void 0:_.type)?_.inputValue:null==_?void 0:_.title}),rotateChevron:I.open,disabled:x,icon:t,iconStyle:u,...(0,o(906230).A)(e,P)}),render:e=>{let t;t=w.isMobile?{menuType:c().gu.ActionSheet}:{menuType:c().gu.Popup,width:250,...v};const r=(t,r)=>{if(t.hideOption)return null;let n;return n="input"===t.type?{key:r,render:r=>(0,d.jsx)(o(401382).Ay,{...r,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var r;null===(r=t.onSubmit)||void 0===r||r.call(t,t.key,e,t.inputValue),e.close()},placeholder:k,isChecked:!j&&i().n4(t.key,y)}),action:()=>{}}:{key:r,render:e=>(0,d.jsx)(o(535906).A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:S,isChecked:!j&&i().n4(t.key,y)}),action:()=>{g(t.key,e),M||e.close()}},n},n="sections"in P?P.sections.map(((e,t)=>({key:t,render:e=>(0,d.jsx)(p().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:i().oE(e.map(r))}))):[{key:0,render:e=>(0,d.jsx)(p().A,{enableActionSheetTitle:!0,...e}),items:i().oE(T.map(r))}];return(0,d.jsxs)(o(935091).A,{...t,children:[(0,d.jsx)(l().Ay,{type:l().Oh.Vertical,sections:n,initialFocus:0,resetFocusOnMouseOut:!0}),A||null]})}})}},694627:(e,t,o)=>{o.d(t,{A:()=>z});o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(403517);var r=o(242343),n=()=>o(470637),i=()=>o(237385),a=()=>o(803290),l=()=>o(174114),s=()=>o(61014),p=()=>o(753123),c=()=>o(752903),d=()=>o(807912),u=()=>o(305948),m=()=>o(465546),y=()=>o(427091),g=()=>o(951592),h=()=>o(769884),f=()=>o(653998),S=()=>o(204132),v=()=>o(31448),x=()=>o(213657),b=()=>o(749975),C=()=>o(73631),j=()=>o(654548),A=()=>o(876695),M=()=>o(213517),k=()=>o(126996),P=()=>o(477784),w=()=>o(640979),T=()=>o(569065),_=()=>o(863969),O=()=>o(129978),I=()=>o(622286),R=()=>o(907721),B=()=>o(695412),F=()=>o(836331),D=()=>o(240771),V=()=>o(935091),E=()=>o(819249),L=o(163643);const K=200;function z(e){var t,o,l,c;const{property:f,disabled:v,formulas:R,getRecordModel:D,propertySchema:z,collectionStore:U,handleSave:W,handleClose:q,blockStore:H,analyticsFrom:N}=e,Z=(0,i().v3)(),J=(0,b().ET)(),{value:$}=(0,O().fJ)(C().T.formulas),[Q,X]=(0,r.useState)(null==z||null===(t=z.formula2)||void 0===t?void 0:t.code),ee=(0,g().lW)(Q,K,Object.is),[te,oe]=(0,r.useState)(),re=(0,r.useRef)(null===(o=z.formula2)||void 0===o?void 0:o.code),ne=(0,r.useRef)(Q),ie=(0,r.useRef)(null==z||null===(l=z.formula2)||void 0===l?void 0:l.result_type),ae=(0,r.useCallback)((e=>{ne.current=e,X(e)}),[]),le=(0,r.useCallback)((e=>{ie.current=e}),[]),[se,pe]=(0,r.useState)((()=>n().A.withListenerIgnored((()=>Y.state??!1)))),[ce,de]=(0,r.useState)([]),ue=(0,i().Y0)();(0,r.useEffect)((()=>()=>{const e=re.current,t=ne.current,o=ie.current;if(t!==e||void 0!==xe){W({newValue:t,newType:(0,s().removeFunctionsFromType)(o??{type:"unknown"}),propertySchema:z,collectionStore:U,property:f});const e=(0,j().r4)(t,U);(0,x().L)(Z,{...(0,A().sl)(J),property_type:z.type,action:"formula_v2_edit",from:N,formula_char_count:e.length})}}),[]);const me=(0,a().K8)((()=>U.pointer),[U.pointer]),ye=(0,r.useMemo)((()=>{const e={type:"block",collection:me};return{kind:d().FormulaContextValueKind.ThisRow,type:e}}),[me]),ge=(0,a().K8)((()=>B().A.state.publicPageData),[]),he=(0,_().O)(),fe=(0,a().K8)((()=>(0,M().i)()),[]),Se=(0,I().X)("collections_xws"),ve=(0,r.useMemo)((()=>{if(!he)return;const e=h().h0Y.fromGetRecordModelFn(D);return{sourceProperty:f,valueTypes:[ye],handleDataRequest:(0,p().MC)({collectionFeatureGates:fe,experimentService:F().default,getRecordModel:D,loadRecordModel:e}),formulaPropertyNames:Q&&(0,m().o2)(Q),publicPageDataCollection:{id:null==ge?void 0:ge.collectionId,schema:null==ge?void 0:ge.collectionSchema},spaceId:he,restrictUnaccessibleProperties:Se?"cross_space_only":void 0,featureGates:fe}}),[he,D,f,ye,Q,null==ge?void 0:ge.collectionId,null==ge?void 0:ge.collectionSchema,fe,Se]),xe=(0,a().K8)((()=>{if("v2"!==z.version&&z.formula)return R.convertCollectionFormulaToFormula2(z.formula,me,U.getSchema())}),[me,U,R,z.formula,z.version]),be=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!xe||be.current||!ve)return;const e=await R.analyzeFormula(xe,ve);let t;t=S().Q.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},be.current=!0,ae(xe),le(t)}()}),[U,R,ae,le,f,z,xe,ve]);const Ce=(0,r.useMemo)((()=>{var e;const t="v2"===z.version?null===(e=z.formula2)||void 0===e?void 0:e.code:xe;return re.current=t,t}),[null===(c=z.formula2)||void 0===c?void 0:c.code,z.version,xe]),je=(0,T().C)(),Ae=(0,a().K8)((()=>{de([]);const e=null==H?void 0:H.getModel(),t=null==H?void 0:H.getRecordModel;if(!e||!ee||!t||k().Pe||!$)return;const o=se?$.evaluateRawCollectionFormula2({block:e,property:f,formulaCode:ee,getRecordModel:t,intl:P().A.getIntl(),userTimeZone:(0,y().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+je,resultCache:new Map,regExpCache:new Map,publicPageDataCollection:{id:null==ge?void 0:ge.collectionId,schema:null==ge?void 0:ge.collectionSchema},experimentService:F().default,collectionFeatureGates:(0,M().i)()}):$.evaluateCollectionFormula2WithoutCache({block:e,property:f,formulaCode:ee,getRecordModel:t,intl:P().A.getIntl(),userTimeZone:(0,y().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+je,resultCache:new Map,regExpCache:new Map,publicPageDataCollection:{id:null==ge?void 0:ge.collectionId,schema:null==ge?void 0:ge.collectionSchema},experimentService:F().default,collectionFeatureGates:(0,M().i)()});if(o){if(!S().Q.isFail(o))return oe(ie.current),o.value;(0,u().eJ)(o.error)&&de([o.error])}}),[H,ee,se,f,je,ge,$]);return ve&&he?(0,L.jsx)(V().A,{menuType:ue.isMobile?w().gu.Modal:w().gu.Popup,hideMobileTopbar:!0,width:ue.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,L.jsx)(E().v,{initialCode:Ce,outputFooter:void 0!==H&&(0,L.jsx)(G,{formulaResult:Ae,isAdvancedMode:se,setIsAdvancedMode:pe,formulaType:te,blockStore:H,formulaSchema:z}),formulas:R,getRecordModel:D,focus:!0,disabled:v,parentSpaceId:he,typecheckContext:ve,onCodeChange:ae,onTypeChange:le,handleClose:q,parentCollectionStore:U,evaluationErrors:ce})}):null}const G=r.memo((function(e){let{formulaResult:t,formulaType:n,blockStore:i,formulaSchema:a,isAdvancedMode:p,setIsAdvancedMode:d}=e;const u=(0,l().IS)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:v().J.UISmall.desktop,height:38,padding:10,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,overflow:"hidden"},equals:{fontSize:v().J.UIRegular.desktop,color:e.text.secondary,marginRight:6,marginLeft:2},type:{fontSize:v().J.UISmall.desktop,color:e.text.secondary,marginLeft:6},iconStyle:{height:16,width:16},iconButtonStyle:{marginLeft:"auto"}})),[]),m=(0,r.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:c().NY.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...o(342943).Cn[c().NY.Medium]}},store:i,isEmptyStore:o(129044).default.createValue(!1),canEdit:!1,disabled:!1,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,propertyFormat:void 0,propertySchema:p?void 0:a,trackEditBlockProperty:()=>{},format:"table",containerRef:null})),[i,a,p]),y=(0,r.useMemo)((()=>n?(0,s().getHumanReadableType)(n):o(86335).qY.unknown),[n]),g=(0,f().tz)(),h=p?g.formatMessage({id:"formulas.editor.toggleAdvancedModeOff",defaultMessage:"Hide details"}):g.formatMessage({id:"formulas.editor.toggleAdvancedModeOn",defaultMessage:"Show details"});return(0,L.jsx)(o(751436).L8.Provider,{value:m,children:(0,L.jsxs)("div",{style:u.output,children:[(0,L.jsx)("span",{style:u.equals,children:"="}),t&&(0,L.jsx)(U,{value:t,withComma:!1,blockStore:i,formulaSchema:a,isAdvancedMode:p,renderWrapper:!0}),p&&Boolean(t)&&(0,L.jsx)("span",{style:u.type,children:(0,L.jsx)(f().sA,{...y})}),(0,L.jsx)(o(103151).A,{renderTooltip:()=>h,placement:R().W.Top,alignment:R().C.Center,render:e=>(0,L.jsx)(o(356813).A,{icon:p?o(269556).F:o(64562).d,onClick:()=>{const e=!p;d(e),Y.setState(e)},iconStyle:u.iconStyle,style:u.iconButtonStyle,ariaLabel:h,...e})})]})})})),U=r.memo((function e(t){let{value:n,withComma:i,blockStore:s,formulaSchema:p,isAdvancedMode:c,renderWrapper:d}=t;const[u,m]=(0,a().K8)((()=>{var e;if(!n)return[[],"text"];if("undefined"===n.type&&c)return[[D().Or],"empty"];const t=(0,o(764049).O)(n,s.getRecordModel,(0,y().P)());return[t,(null===(e=t[0])||void 0===e?void 0:e.type)??"text"]}),[s.getRecordModel,c,n]),g=(0,l().IS)((e=>({rightBracket:{color:e.text.secondary,fontSize:v().J.UISmall.desktop,marginLeft:2},leftBracket:{color:e.text.secondary,fontSize:v().J.UISmall.desktop,marginRight:2},comma:{color:e.text.secondary,fontSize:v().J.UISmall.desktop,marginRight:2}})),[]);let h;if("array"===n.type)h=(0,L.jsxs)(r.Fragment,{children:[c?(0,L.jsx)("span",{style:g.leftBracket,children:"["}):null,n.values.map(((t,o)=>(0,L.jsx)(e,{value:t,withComma:o<n.values.length-1,blockStore:s,formulaSchema:p,isAdvancedMode:c,renderWrapper:!1},o))),c?(0,L.jsx)("span",{style:g.rightBracket,children:"]"}):null,i?(0,L.jsx)("span",{style:g.comma,children:", "}):""]});else{const e=i&&!c&&(0,D().GL)(m,p);h=null==u?void 0:u.map(((t,o)=>(0,L.jsxs)(r.Fragment,{children:[(0,L.jsx)(D().yZ,{token:t,targetPropertySchema:p,blockStore:s,withComma:e,numberRightAlign:!1,shouldTruncate:!1,disableLinks:!1}),c&&i?(0,L.jsx)("span",{style:g.comma,children:", "}):null]},`${t.id}-${o}`)))}return d&&!c?(0,L.jsx)(D().Ye,{propertyType:m,rootPropertySchema:p,numberRightAlign:!1,children:h}):(0,L.jsx)(r.Fragment,{children:h})})),Y=new(o(380123).R)({key:"formulas_show_details",namespace:o(146325).Bq,important:!0,trackingType:"preference"})},916653:(e,t,o)=>{o.d(t,{i:()=>i});o(242343);var r=o(163643);const n={viewBox:"0 0 20 20",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M12.876 7.982a.625.625 0 1 0-1.072-.644L9.25 11.595 7.815 9.92a.625.625 0 1 0-.95.813l2 2.334a.625.625 0 0 0 1.01-.085z"}),(0,r.jsx)("path",{d:"M5.25 3.125A2.125 2.125 0 0 0 3.125 5.25v9.5c0 1.174.951 2.125 2.125 2.125h9.5a2.125 2.125 0 0 0 2.125-2.125v-9.5a2.125 2.125 0 0 0-2.125-2.125zM4.375 5.25c0-.483.392-.875.875-.875h9.5c.483 0 .875.392.875.875v9.5a.875.875 0 0 1-.875.875h-9.5a.875.875 0 0 1-.875-.875z"})]})},i=(0,o(680369).wt)("checkmarkSquare",n)}}]);