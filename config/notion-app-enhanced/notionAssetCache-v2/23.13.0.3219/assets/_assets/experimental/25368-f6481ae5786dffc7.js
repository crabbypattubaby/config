"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[25368],{85717:(e,t,a)=>{a.d(t,{W$:()=>s,fR:()=>o,iv:()=>i});var n=()=>a(588925),r=()=>a(101132);function o(e){r().A.setState({open:!0,...e})}function i(){r().A.setState({open:!1})}function s(e){n().A.setState({open:!0,...e})}},101132:(e,t,a)=>{a.d(t,{A:()=>n});const n=a(129044).default.createValue({open:!1},{name:"TrialInfoModalStore"})},151602:(e,t,a)=>{a.d(t,{A:()=>o});class n extends(()=>a(129044))().default{getInitialState(){return{}}}const r=new n;a(996094).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const o=r},155342:(e,t,a)=>{a.r(t),a.d(t,{iconDefinition:()=>r,questionMarkCircleIcon:()=>o});a(242343);var n=a(163643);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},o=(0,a(680369).wt)("questionMarkCircle",r)},203935:(e,t,a)=>{a.r(t),a.d(t,{DO_NOT_USE_setUserPersonaRoleAndUseCases:()=>ue,checkAndApplyTrial:()=>ge,clearAllOnboardingStates:()=>me,createOrJoinSpace:()=>le,createSpaceAndSetSpaceId:()=>ie,createSpaceAsOwner:()=>se,defaultOnboardingComplete:()=>_e,handleExitOnboarding:()=>ve,handleOnboardingError:()=>we,handleUserCanNotCreateSpace:()=>be,joinSpaceAsGuestOrMember:()=>ce,joinSpaceAsGuestOrMemberWithPerformanceTracking:()=>de,onOnboardingCompletePublicAccess:()=>Se,prefillTeamWorkspaceName:()=>fe,redirectAfterContextualizedOnboardingComplete:()=>ae,setAndTrackContextualizedOnboardingComplete:()=>re,setMobileContextualizedOnboardingComplete:()=>ne,setProfileData:()=>oe,setUserAndSpaceSurveyData:()=>pe});a(610931),a(725707),a(491955),a(403517),a(242343);var n=()=>a(712437),r=()=>a(502140),o=()=>a(524118),i=()=>a(329911),s=()=>a(584215),c=()=>a(145017),d=()=>a(132793),l=()=>a(653998),p=()=>a(975392),u=()=>a(76394),g=()=>a(479292),m=()=>a(403359),_=()=>a(598995),S=()=>a(818369),v=()=>a(145046),b=()=>a(437071),f=()=>a(185639),w=()=>a(70989),I=()=>a(759625),y=()=>a(191756),D=()=>a(865226),k=()=>a(874206),O=()=>a(783759),h=()=>a(84543),C=()=>a(178594),T=()=>a(658388),A=()=>a(795610),U=()=>a(137476),N=()=>a(868325),R=()=>a(814370),P=()=>a(477784),V=()=>a(548694),E=()=>a(689248),L=()=>a(672796),x=()=>a(138121),j=()=>a(695050),M=()=>a(461201),W=()=>a(482936),F=()=>a(102522),z=()=>a(196387),J=()=>a(667801),B=()=>a(485966),H=()=>a(836331),q=()=>a(413871),X=()=>a(613313),G=()=>a(35294),$=()=>a(85717),K=()=>a(30299),Y=()=>a(503984),Q=()=>a(940445),Z=()=>a(329979),ee=()=>a(672154),te=a(163643);async function ae(e){await(0,j().navigateWithRedirectData)(e),e.environment.device.isMobile&&ne({environment:e.environment,userStore:e.onboardingData.userStore}),re({environment:e.environment,onboardingState:e.onboardingState,userStore:e.onboardingData.userStore,spaceJoinOrCreate:e.spaceJoinOrCreate,permissionLevel:e.permissionLevel})}function ne(e){const{environment:t,userStore:a}=e;h().createAndCommit({userAction:"contextualizedOnboardingActions.contextualizedOnboardingActions",environment:t,canUndo:!0,perform:e=>{x().PF({userStore:a,transaction:e})}})}function re(e){const{environment:t,onboardingState:a,userStore:n,spaceJoinOrCreate:r,permissionLevel:o}=e;t.device.isElectron&&b().quickSearchRefresh(),h().createAndCommit({userAction:"contextualizedOnboardingActions.setAndTrackContextualizedOnboardingComplete",environment:t,canUndo:!0,perform:e=>{x().LC({userStore:n,transaction:e})}}),m().IA(t,{...(0,Z().getContextualizedOnboardingAnalyticsData)({onboardingState:a,environment:t}),initial_workspace_type:r,permission_level:o}),_().Kc(t)}async function oe(e,t){const{onboardingData:a,profileName:n,profilePhoto:r,password:o,emailOptIn:i}=t;if(!a)return;const s=a.userStore;(0,U().mt)(e,{email_optin_product_updates_and_releases:i,email_optin_newsletters_and_thought_leadership:i,email_optin_user_research_and_surveys:i,email_optin_sales_outreach:i,email_optin_events_and_resources:i,email_optin_product_education_and_how_tos:i,email_optin_notion_for_startups:i}),h().createAndCommit({userAction:"onboardingHelpers.setProfileData",environment:e,canUndo:!0,perform:e=>{const t={...r&&{profile_photo:r}};t.name=n,I().zv({store:s,data:t,transaction:e})}});const c=await L().shouldCreatePassword(e)&&!function(){var e;const{currentUserSettingsStore:t}=B().default.state;return Boolean(t&&t.isReady()&&"email-password"===(null===(e=t.getSettings())||void 0===e?void 0:e.mobile_ads_signup_variant))}();o&&c&&await S().callApi({eventName:"setPassword",environment:e,data:{newPassword:o,sendEmail:!1}})}async function ie(e){var t;let{onboardingState:a,environment:n,createTemplates:r,showLoader:o=!0}=e;if(!a.onboardingData)return;const i=M().sg(a.onboardingData),{spaceStore:s,spaceViewStore:c,inviteLinkCode:d,teamStoreId:l}=await se({onboardingState:a,onboardingData:a.onboardingData,redirectData:i,planType:null===(t=a.planTypeAndSurveyInfo)||void 0===t?void 0:t.planType,environment:n,createTemplates:r,showLoader:o});ee().A.setState({...ee().A.state,spaceId:s.id,spaceViewId:c.id,inviteLinkCode:d,inviteLinkUrl:d?(0,V().X$)(n,s.id,d):void 0,teamStoreId:l})}async function se(e){var t,a,n,r;const{onboardingState:o,onboardingData:i,redirectData:s,planType:c,environment:d,createTemplates:l,showLoader:p=!0}=e,{currentSpaceStore:u,currentSpaceViewStore:g}=B().default.state;if(u&&g&&u.id===o.spaceId)return{spaceStore:u,spaceViewStore:g,teamStoreId:o.teamStoreId};p&&w().m({message:j().messages.creatingWorkspace});const m=P().A.getIntl(),_=i.userStore.getFullName(m),S=z().default.DO_NOT_USE_markLegacy("onboarding.create_space"),v=o.spaceName||M().JR(_||"",m),{spaceViewStore:b,spaceStore:f,inviteLinkCode:I,redirectData:y,teamStoreId:D}=await j().createSpaceWithTemplates({environment:d,isNewUserOnboarding:Boolean(o.isFirstTimeOnboarding),onboardingData:i,userPersona:(null===(t=o.planTypeAndSurveyInfo)||void 0===t||null===(t=t.surveyResponses)||void 0===t?void 0:t.userPersona)||"unfilled",redirectData:s,spaceName:v,spaceIcon:o.spaceIcon||null,planSelection:c,isPrivate:"team"!==c,useCases:(null===(a=o.planTypeAndSurveyInfo)||void 0===a||null===(a=a.surveyResponses)||void 0===a?void 0:a.useCases)||[],categories:(null===(n=o.planTypeAndSurveyInfo)||void 0===n||null===(n=n.surveyResponses)||void 0===n?void 0:n.categories)||[],hasTrialId:!1,selectedWorkflowTemplates:(null==o?void 0:o.selectedWorkflowTemplateIds)||[],collaborativeIntent:null===(r=o.planTypeAndSurveyInfo)||void 0===r?void 0:r.collaborativeIntent,createTemplates:l,source:o.source});return z().default.DO_NOT_USE_measureLegacy(S,{environment:d,data:{flow:o.flowName,onboarding_complete_data:{stage:(0,Z().getStageName)({flowName:o.flowName,stageIndex:o.currentStageIndex,environment:d}),redirect_data:s,is_new_user:!0,permission_level:"member",plan:c}}}),p&&w().V(),{spaceViewStore:b,spaceStore:f,inviteLinkCode:I,newRedirectData:y,teamStoreId:D}}async function ce(e){const{onboardingData:t,redirectData:a,currentUserRootStore:n,currentUserSettingsStore:r,environment:o}=e;if("guest_redirect"===a.type){const{spaceViewStore:e}=await O().DT({environment:o,spaceId:a.spaceId,userRootStore:n,analyticsFrom:"onboarding",userSettingsStore:r,navigate:!1,redirectPageId:a.pageId,isOnboarding:!0});return{spaceViewStore:e}}{const{spaceViewStore:e}=await j().joinTeamSpaceWithTemplates({environment:o,onboardingData:t,redirectData:a,spaceId:ee().A.state.spaceId,isNewUserOnboarding:Boolean(ee().A.state.isFirstTimeOnboarding)});return{spaceViewStore:e}}}async function de(e){const{onboardingState:t,onboardingData:a,redirectData:n,currentUserRootStore:r,currentUserSettingsStore:o,environment:i}=e;w().m({message:j().messages.joiningWorkspace});const s=z().default.DO_NOT_USE_markLegacy("onboarding.join_space"),{spaceViewStore:c}=await ce({onboardingData:a,redirectData:n,currentUserRootStore:r,currentUserSettingsStore:o,environment:i});return z().default.DO_NOT_USE_measureLegacy(s,{environment:i,data:{flow:t.flowName,onboarding_complete_data:{stage:(0,Z().getStageName)({flowName:t.flowName,stageIndex:t.currentStageIndex,environment:i}),redirect_data:n,is_new_user:!0,permission_level:M().S1(n)}}}),w().V(),{spaceViewStore:c}}async function le(e){const{spaceJoinOrCreate:t,onboardingState:a,onboardingData:n,currentUserRootStore:r,currentUserSettingsStore:o,planType:i,environment:s}=e,c=M().sg(n);if("create"===t){const{spaceStore:e,spaceViewStore:t,newRedirectData:r,teamStoreId:o}=await se({onboardingState:a,onboardingData:n,redirectData:c,planType:i,environment:s});return{spaceStore:e,spaceViewStore:t,newRedirectData:r,teamStoreId:o}}if("join"===t){const{spaceViewStore:e}=await de({onboardingState:a,onboardingData:n,redirectData:c,currentUserRootStore:r,currentUserSettingsStore:o,environment:s});return{spaceViewStore:e}}(0,u().HB)(t)}function pe(e){var t,a,n;const{environment:r,onboardingState:o,planSelection:i,spaceStore:s,spaceViewStore:c}=e,d=null===(t=o.planTypeAndSurveyInfo)||void 0===t?void 0:t.surveyResponses,l=null!=d&&d.educationRole&&"other"!==(null==d?void 0:d.educationRole)?d.educationRole:void 0;M().BH({environment:r,state:{onboardingExperiments:void 0,userPersona:null==d?void 0:d.userPersona,userRole:null==d?void 0:d.userRole,categories:null==d?void 0:d.categories,userEducationRole:l,userEducationLevel:null==d?void 0:d.educationLevel,notionUseFrequency:null==d?void 0:d.notionUseFrequency,companySize:null==d?void 0:d.companySize,useCases:p().sb([...(null==d?void 0:d.useCases)??[],...(null===(a=o.selectedWorkflowTemplateIds)||void 0===a?void 0:a.map((e=>{const t=(0,Q().getCollectionTemplateFromId)(e);return null!=t&&t.category?Q().useCaseByCollectionTemplateCategory[null==t?void 0:t.category]:void 0})).filter((e=>void 0!==e)))??[]]),planSelection:i,collaborativeIntent:null===(n=o.planTypeAndSurveyInfo)||void 0===n?void 0:n.collaborativeIntent},spaceStore:s,spaceViewStore:c})}function ue(e,t){var a,n,r,o;const{onboardingData:i}=t;if(!i)return;const s=null===(a=t.planTypeAndSurveyInfo)||void 0===a||null===(a=a.surveyResponses)||void 0===a?void 0:a.userPersona,c=null===(n=t.planTypeAndSurveyInfo)||void 0===n||null===(n=n.surveyResponses)||void 0===n?void 0:n.userRole,d=null===(r=t.planTypeAndSurveyInfo)||void 0===r||null===(r=r.surveyResponses)||void 0===r?void 0:r.useCases,l=null===(o=t.planTypeAndSurveyInfo)||void 0===o||null===(o=o.surveyResponses)||void 0===o?void 0:o.companySize;h().createAndCommit({userAction:"contextualizedOnboardingStateActions.DO_NOT_USE_setUserPersonaRoleAndUseCases",environment:e,canUndo:!0,perform:e=>{T().mJ({userSettingsStore:i.userSettingsStore,data:{persona:s,team_role:c,use_cases:d,company_size:l,persona_version:{version:"V4",timestamp:(new Date).getTime()}},transaction:e})}})}async function ge(e,t,a){if((0,K().Os)()&&e&&t){const n=await j().applyPerfmarkTrial(e.id,t,a);n.enableTrialInfoModal&&(0,$().fR)({openedFrom:"onboarding"}),n.enableTrialIneligibleToast&&F().A.setState({open:!0,isExistingUser:!1})}else if(e&&t&&"team"===t&&(0,X().i4)(a)){await(0,G().applyReversePlusTrial)(e,a,"onboarding")&&(0,E().UW)(a,"onboarding_reverse_trial_sidebar")}}function me(e){const{currentUserRootStore:t}=B().default.state;t&&(i().K.set({userId:t.id,key:ee().l,value:void 0}),ee().A.reset(),W().default.setState({isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id}),(0,d().$A)())}async function _e(e,t){var a;const{currentUserRootStore:n,currentUserSettingsStore:r}=B().default.state;if(!n)return;const o=ee().A.state;if(!o.onboardingData)throw new Error("onboardingData should not be undefined!");const i=(0,Z().getSpaceIntentOverride)(o)??(null===(a=o.planTypeAndSurveyInfo)||void 0===a?void 0:a.planType),{spaceStore:s,spaceViewStore:c,newRedirectData:d,teamStoreId:l}=await le({spaceJoinOrCreate:t,onboardingState:o,onboardingData:o.onboardingData,currentUserRootStore:n,currentUserSettingsStore:r,planType:i,environment:e}),p=M().sg(o.onboardingData);w().m({message:j().messages.navigatingToWorkspace}),"create"===t&&(await ge(s,i,e),!(0,Z().getOnboardingFlowCreatedSpaceWithoutPlanType)(o.flowName)&&H().default.checkGate({gateName:"enable_write_survey_data_optimization"})||(pe({environment:e,onboardingState:o,planSelection:i,spaceStore:s,spaceViewStore:c}),ue(e,o)),(0,Z().getOnboardingFlowCreatedSpaceWithoutPlanType)(o.flowName)&&O().If(e,"team"===i?"team":"personal",s)),function(e){var t,a;let{environment:n,onboardingState:r,spaceStore:o,planType:i,teamStoreId:s}=e;const c=r.planTypeAndSurveyInfo,d=r.selectedWorkflowTemplateIds,l=Boolean((null==c||null===(t=c.surveyResponses)||void 0===t?void 0:t.useCases)&&(null==c||null===(a=c.surveyResponses)||void 0===a||null===(a=a.useCases)||void 0===a?void 0:a.length)>0),p=Boolean(d&&d.length>0),u=l||p;if("team"===i&&s&&u&&(0,Z().isWorkflowTemplatesEnabledForOnboarding)(n))J().setExpand({environment:n,isExpanded:!0,from:"contextualized_onboarding_overlay",saveDetailsSidebarPreference:!1}),Y().default.setState({type:"team_workflow_templates",step:"teamspaces",initialTeamStoreId:s});else if((0,A().Mq)({environment:n,experimentId:"adoption_hide_features_v2"})){const e=H().default.getEligibleGroup({experimentId:"adoption_hide_features_v2"});"hide_all_except_templates"===e?Y().default.setState({type:"adoption_push_templates",step:"explore_templates"}):"hide_all_except_home"===e?Y().default.setState({type:"adoption_push_home",step:"home"}):"hide_all_except_ai"===e?Y().default.setState({type:"adoption_push_ai",step:"ai_assistant"}):"hide_all_except_invite"===e&&Y().default.setState({type:"adoption_push_invite",step:"invite_members"})}}({environment:e,onboardingState:o,spaceStore:s,planType:i,teamStoreId:l});const u=d??p;await ae({environment:e,onboardingData:o.onboardingData,spaceId:c.getSpaceId(),spaceViewId:c.id,spaceJoinOrCreate:t,redirectData:u,onboardingFlow:o.flowName,onboardingState:o,permissionLevel:M().S1(u)}),w().V()}function Se(e,t,a){if(!e.onboardingData)throw new Error("onboardingData not found!");re({onboardingState:e,environment:a,userStore:e.onboardingData.userStore,spaceJoinOrCreate:void 0,permissionLevel:"public"}),y().uK({environment:a,store:new(q().Bv)(a,{table:c().ev,id:t.pageId}),pageVisitSource:n().y8.Onboarding})}async function ve(e,t){if(e.isFirstTimeOnboarding){const{accept:a}=await v().Gh({message:(0,te.jsxs)("div",{style:{display:"block"},children:[(0,te.jsx)("div",{style:{fontWeight:600},children:(0,te.jsx)(l().sA,{defaultMessage:"Cancel new account setup?",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.title"})}),(0,te.jsx)("div",{children:(0,te.jsx)(l().sA,{defaultMessage:"You'll be taken back to the Notion home page.",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.subtitle"})})]}),acceptLabel:(0,te.jsx)(l().sA,{defaultMessage:"Return to home page",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.confirmCloseButton.label"}),cancelLabel:(0,te.jsx)(l().sA,{defaultMessage:"Continue setup",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.continueButton.label"})});if(!a)return;m().rG(t,(0,Z().getContextualizedOnboardingAnalyticsData)({onboardingState:e,environment:t})),await L().actuallyLogoutAndDeleteMostLocalData({environment:t,logoutOrigin:s().d.ContextualizedOnboardingExit,userId:t.currentUser.id})}else{const{accept:n}=await v().Gh({message:(0,te.jsx)(l().sA,{defaultMessage:"Cancel new workspace setup?",id:"onboardingActions.closeOnboardingDialog.existingUser.title"}),description:(0,te.jsx)(l().sA,{defaultMessage:"You'll be taken back to your previous workspace.",id:"onboardingActions.closeOnboardingDialog.existingUser.subtitle"}),acceptLabel:(0,te.jsx)(l().sA,{defaultMessage:"Back to previous workspace",id:"onboardingActions.closeOnboardingDialog.existingUser.confirmCloseButton.label"}),cancelLabel:(0,te.jsx)(l().sA,{defaultMessage:"Continue setup",id:"onboardingActions.closeOnboardingDialog.existingUser.continueButton.label"})});if(!n)return;m().rG(t,(0,Z().getContextualizedOnboardingAnalyticsData)({onboardingState:e,environment:t}));const{mainEditorCurrentBlockStore:o}=B().default.state,i=null==o?void 0:o.getSpaceId(),s=i&&(0,V().km)(i);if(s){const e=s.getSpaceStore();t.device.isMobileNative&&r().log({level:"info",from:"onboardingActions",type:"SpaceSwitchingDebug",data:{message:"onboardingActions.handleCloseOnboarding set space",spaceId:null==e?void 0:e.id}}),B().default.setState({...B().default.state,currentSpaceStore:e,currentSpaceViewStore:s})}const{url:c,userId:d}=f().v4(t);let p=t;if(d&&d!==t.currentUser.id&&(p=await C().T({environment:t,newCurrentUserId:d})),c){var a;J().close();const e=()=>{me(p)};D().oo({environment:p,url:c}),null!==(a=p.mobileNative)&&void 0!==a&&a.supportsNativeHomeOnPhone()?k().navigateToHomeTab(p,e):e()}}}function be(e,t){var a;g().FX(e,{can_user_create_space:!1,is_new_user:!0,has_joinable_spaces:!1,onboarding_stage:(0,Z().getStageName)({flowName:t.flowName,stageIndex:t.currentStageIndex,environment:e})});const n=null===(a=t.onboardingData)||void 0===a?void 0:a.userStore.getEmail();throw ee().A.setState({...t,isInvalidRedirect:!0}),new(o().Xgk)(n?P().A.formatMessage(j().messages.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:n}):P().A.formatMessage(j().messages.errorWorkspaceCreationPrevented),{newUser:!0})}function fe(e){const t=P().A.getIntl(),a=e.userStore.getFullName(t);ee().A.update((e=>({...e,spaceName:M().mi(a||"",t)})))}async function we(e,t){if(W().default.setState({...W().default.state,isLoading:!1}),r().log({level:"error",from:"onboardingActions",type:"handleOnboardingError",error:{message:`Found onboarding error: ${t.message}`,stack:String(t.stack)}}),w().V(),t instanceof R().C&&(0,o().OwV)(t.data.responseBody)&&"UnauthorizedError"===t.data.responseBody.name)return void m().bn(e,{...(0,Z().getContextualizedOnboardingAnalyticsData)({onboardingState:ee().A.state,environment:e}),errorMessage:t.message,debugMessage:"UnauthorizedError"});let a;if(t instanceof R().C){var n;const e=null==t||null===(n=t.data)||void 0===n||null===(n=n.responseBody)||void 0===n?void 0:n.clientData;e&&(a=(0,N().t4)(P().A.getIntl(),e))}m().bn(e,{...(0,Z().getContextualizedOnboardingAnalyticsData)({onboardingState:ee().A.state,environment:e}),errorMessage:t.message,debugMessage:a||"undefined"});const{accept:i}=await v().Gh({message:(0,te.jsxs)("div",{children:[(0,te.jsx)(l().sA,{defaultMessage:"Oops, something went wrong.",id:"onboardingActions.onboardingErrorDialog.message"}),(0,te.jsx)("div",{children:a??t.message})]}),acceptLabel:(0,te.jsx)(l().sA,{defaultMessage:"Start over",id:"onboardingActions.onboardingErrorDialog.startOverButton.label"}),cancelLabel:(0,te.jsx)(l().sA,{defaultMessage:"Close",id:"onboardingActions.onboardingErrorDialog.closeButton.label"})});i&&(0,x().Vh)(e,t)}},367950:(e,t,a)=>{function n(e){return`${e.table}:${e.id}`}a.d(t,{_:()=>n})},479292:(e,t,a)=>{a.d(t,{$3:()=>p,AQ:()=>d,Ae:()=>c,BL:()=>l,FL:()=>s,FX:()=>r,Vp:()=>i,XL:()=>o,nY:()=>u});var n=()=>a(137476);function r(e,t){n().vd(e,"workspace_creation_ability",t)}function o(e,t){n().vd(e,"workspace_creation_setting_updated",t)}function i(e,t){n().vd(e,"claimable_spaces_viewed",t)}function s(e,t){n().vd(e,"space_transfer_requested",t)}function c(e,t){n().vd(e,"space_transfer_completed",t)}function d(e,t){n().vd(e,"space_claim_upgrade_requested",t)}function l(e,t){n().vd(e,"space_claim_upgrade_completed",t)}function p(e,t){n().vd(e,"space_claim_deletion_started",t)}function u(e,t){n().vd(e,"space_claim_deletion_canceled",t)}},588925:(e,t,a)=>{a.d(t,{A:()=>n});const n=a(129044).default.createValue({open:!1},{name:"TrialEndModalStore"})},686752:(e,t,a)=>{a.r(t),a.d(t,{iconDefinition:()=>n,pencilLineIcon:()=>r});a(242343);const n={viewBox:"0 0 20 20",svg:(0,a(163643).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},r=(0,a(680369).wt)("pencilLine",n)},695050:(e,t,a)=>{a.r(t),a.d(t,{applyPerfmarkTrial:()=>Re,completeDesktopOnboardingForTeamPlan:()=>Pe,createSpaceWithTemplates:()=>he,getInitialState:()=>pe,getRedirectDataUpdate:()=>Ae,getWorkflowTemplateForUseCase:()=>Ee,getWorkflowTemplatesForUseCases:()=>Ve,joinTeamSpaceWithTemplates:()=>Ce,messages:()=>le,navigateWithRedirectData:()=>De,redirectAfterOnboardingComplete:()=>ye,timedTrialUpsellNextState:()=>fe,updateAndGetNextState:()=>ue,updateAndGetPreviousState:()=>ge});a(610931),a(725707),a(491955),a(403517);var n=()=>a(712437),r=()=>a(204758),o=()=>a(492435),i=()=>a(502140),s=()=>a(524118),c=()=>a(214144),d=()=>a(519423),l=()=>a(220574),p=()=>a(145017),u=()=>a(21164),g=()=>a(528762),m=()=>a(12803),_=()=>a(132793),S=()=>a(885237),v=()=>a(975392),b=()=>a(450475),f=()=>a(76394),w=()=>a(284083),I=()=>a(479292),y=()=>a(403359),D=()=>a(598995),k=()=>a(818369),O=()=>a(216268),h=()=>a(437071),C=()=>a(70989),T=()=>a(514857),A=()=>a(349947),U=()=>a(191756),N=()=>a(865226),R=()=>a(783759),P=()=>a(163875),V=()=>a(84543),E=()=>a(658388),L=()=>a(414997),x=()=>a(314164),j=()=>a(203935),M=()=>a(329979),W=()=>a(672154),F=()=>a(795610),z=()=>a(137476),J=()=>a(782422),B=()=>a(995625),H=()=>a(477784),q=()=>a(548694),X=()=>a(689248),G=()=>a(196387),$=()=>a(485966),K=()=>a(836331),Y=()=>a(990394),Q=()=>a(413871),Z=()=>a(104838),ee=()=>a(613313),te=()=>a(35294),ae=()=>a(85717),ne=()=>a(30299),re=()=>a(503984),oe=()=>a(461201),ie=()=>a(482936),se=()=>a(102522),ce=()=>a(244698),de=()=>a(138121);const le=(0,a(653998).YK)({joiningWorkspace:{id:"onboardingStateActions.joiningWorkspace.loadingMessage",defaultMessage:"Joining team…"},creatingWorkspace:{id:"onboardingStateActions.creatingWorkspace.loadingMessage",defaultMessage:"Getting ready…"},creatingWorkflowTemplate:{id:"onboardingStateActions.creatingWorkflowTemplate.loadingMessage",defaultMessage:"Getting ready…"},navigatingToWorkspace:{id:"onboardingStateActions.navigatingToWorkspace.loadingMessage",defaultMessage:"Taking you to your workspace…"},errorNoAction:{id:"onboardingStateActions.errorMessage.noActionToPerform",defaultMessage:"No action to perform for {onboardingRedirectType}"},errorWorkspaceCreationPreventedWithEmail:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPreventedWithEmail",defaultMessage:"You are signed in to {userEmailAddress} and do not have access to any workspaces. Please reach out to your IT department for access to Notion."},errorWorkspaceCreationPrevented:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPrevented",defaultMessage:"You do not have access to any workspaces. Please reach out to your IT department for access to Notion."},errorWorkspaceDoesNotExist:{id:"onboardingStateActions.errorMessage.spaceDoesNotExist",defaultMessage:"Workspace does not exist."},errorWorkspaceDidNotLoad:{id:"onboardingStateActions.errorMessage.spaceDidNotLoad",defaultMessage:"Failed to load workspace."}});async function pe(e){let{environment:t,startOnboardingArgs:a,onboardingData:n,redirectData:o}=e;const i=t.currentUser.id;if(void 0===i)throw new Error("Environment currentUserId not defined.");const{type:d,redirectUrl:l,disableRedirectUrl:p}=a,u=t.device.isMobile,{currentUserRootStore:g}=$().default.state,m=0===(g&&g.isReady()?v().sb(g.getSpaceViewStores().filter((e=>e.getJoined())).map((e=>e.getSpaceId()))).length:0),_=(0,ne().Os)()?"perfmark":void 0,S={onboardingData:n,redirectData:o,isOnboarding:!0,isLoading:!1,flowId:c().JW(),currentUserId:i,isNewUser:m,stageNumber:0,spaceId:void 0,historicalStages:void 0,onboardingExperiments:{},stageStats:{startedTimeStampMs:Date.now()},trialId:_,performanceMarketingTerm:n.performanceMarketingTerm};if("new-user"===d){const e=n.joinableSpaceData.results.length>0;let a;a=u?l&&!p?"mobile_redirect":e?"mobile_joinable_spaces":"mobile_cold_start":l&&!p?"desktop_redirect":e?"desktop_joinable_spaces":"desktop_cold_start";const o={...S,flow:a,stage:"profile",uploadingProfilePhoto:!1,profilePhoto:null,prefilled:!1,passwordErrorData:null,emailOptIn:(0,r().eh)(n.countryCode).defaultOptIn},i=oe().TV({userStore:n.userStore});return i?me({...o,...i},t):o}if("create-or-join"===d){const e=oe().md({onboardingData:n,isNewUserFlow:!1}),a=u?"mobile_join_or_create_space":"desktop_join_or_create_space";if(e.length>0)return{...S,flow:a,stage:"workspace_choose",joinableSpaces:e,prefilled:!1};if(n.canUserCreateSpace)return{...Ne(S),...S,flow:a,stage:"workspace_plan_choose",prefilled:!1,spaceJoinOrCreate:"create",useCases:[],collaborativeIntent:void 0};{I().FX(t,{can_user_create_space:!1,is_new_user:!1,has_joinable_spaces:!1,onboarding_stage:void 0});const e=n.userStore.getEmail();throw ie().default.setState({...S,flow:a,stage:"error"}),new(s().Xgk)(e?H().A.formatMessage(le.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:e}):H().A.formatMessage(le.errorWorkspaceCreationPrevented),{newUser:!1})}}if("mobile-onboarding"===d)return{...S,flow:"mobile_existing_user",stage:"mobile_editor",spaceJoinOrCreate:"join"};f().HB(d)}async function ue(e,t){if(!e.isOnboarding)return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};const a={...e,stageNumber:e.stageNumber+1};switch(oe().zX(t),a.stage){case"profile":return me(a,t);case"workspace_plan_choose":return Se(a,t);case"workspace_collaborative_intent_choose":return function(e,t){return Se({...e,stage:"workspace_plan_choose"},t,!0)}(a,t);case"workspace_choose":return async function(e,t){const{redirectData:a}=e;if("guest_redirect"===a.type)return Ue(e,a,"guest",t);if("create"===e.spaceJoinOrCreate)return{...Ne(e),planSelection:void 0,...e,stage:"workspace_plan_choose",useCases:[],collaborativeIntent:void 0};{const a=G().default.DO_NOT_USE_markLegacy("onboarding.join_space"),{spaceStore:n,spaceViewStore:r,...o}=await Oe(e,t);oe().BH({environment:t,state:{onboardingExperiments:e.onboardingExperiments,userPersona:"userPersona"in e?e.userPersona:void 0,userRole:"userRole"in e?e.userRole:void 0,companySize:void 0,useCases:void 0,planSelection:void 0,categories:void 0,userEducationRole:void 0,userEducationLevel:void 0,notionUseFrequency:void 0,collaborativeIntent:void 0},spaceStore:void 0,spaceViewStore:r});const{spaceId:i,spaceViewId:s,redirectData:c}=o,{flow:d}=e;switch(d){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_redirect":case"desktop_joinable_spaces":return await ye({environment:t,onboardingData:e.onboardingData,spaceId:i,spaceViewId:s,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:c,onboardingFlow:d,onboardingState:e}),G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:c,is_new_user:oe().ze(e),permission_level:"guest_redirect"===c.type?"guest":"member"}}}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":{const a={...e,...o};return we(e.onboardingData,a,t)}case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":{const n={...e,...o};return G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:c,is_new_user:oe().ze(e),permission_level:"guest_redirect"===c.type?"guest":"member"}}}),Ie({onboardingState:n,environment:t,flow:d})}default:return f().HB(d)}}}(a,t);case"persona_survey":return _e(a,t);case"workspace_create":return ve(a,t);case"invite":return be(a,t);case"timed_trial_upsell":return fe(a,t);case"template_optout":return function(e,t){return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}(0,t);case"workspace_setup":return async function(e,t){const{flow:a}=e;switch(a){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":return await ye({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":return we(e.onboardingData,e,t);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return N().kc(t),Ie({onboardingState:e,environment:t,flow:a});default:return f().HB(a)}}(a,t);case"mobile_editor":return function(e){return{...e,stage:"mobile_sidebar"}}(a);case"mobile_sidebar":return function(e,t){if(oe().FP(t))return{...e,stage:"mobile_app_download"};return{...e,stage:"mobile_desktop"}}(a,t);case"mobile_desktop":return function(e,t){return{...e,stage:"mobile_web_clipper"}}(a);case"mobile_web_clipper":return function(e,t){if("mobile_existing_user"===e.flow)return Te(e,t);return we(e.onboardingData,e,t)}(a,t);case"mobile_app_download":return async function(e,t){if("mobile_existing_user"===e.flow)return Te(e,t);return we(e.onboardingData,e,t)}(a,t);case"error":return function(e){return{isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id}}(t);default:f().HB(a)}}function ge(e,t){if(!e.isOnboarding)throw new Error("Trying to go back on step which is not onboarding.");const a={...e,stageNumber:e.stageNumber-1};if(!ie().onboardingStagesWithBack.includes(e.stage))throw new Error(`Trying to go back in onboarding on step where back is not supported. Stage: ${e.stage}`);switch(a.stage){case"workspace_plan_choose":return function(e){const t=oe().ze(e),a=oe().md({onboardingData:e.onboardingData,isNewUserFlow:t});if(a.length>0)return{...e,joinableSpaces:a,stage:"workspace_choose"};if(t)throw new Error("Trying to go back to profile step from plan choose for new user!");throw new Error("Trying to go back on plan choose step for existing user with no joinable spaces!")}(a);case"workspace_collaborative_intent_choose":return function(e){return{...e,stage:"workspace_plan_choose",collaborativeIntent:void 0}}(a);case"persona_survey":return function(e){return{...e,stage:"workspace_collaborative_intent_choose"}}(a);case"workspace_create":return function(e){const t=oe().ze(e);if("school"===e.planSelection||"personal"===e.planSelection)return{...e,skip:!1,prefilled:e.prefilled,previousStage:"workspace_create",userPersona:e.userPersona,spaceName:e.spaceName,stage:"persona_survey"};return t&&"team"===e.planSelection?{...e,prefilled:e.prefilled,previousStage:"workspace_create",skip:!1,userPersona:e.userPersona,spaceName:e.spaceName,stage:"persona_survey"}:{...e,stage:"workspace_collaborative_intent_choose"}}(a);case"timed_trial_upsell":return function(e){const t=oe().qg(e.onboardingData);return{...e,flow:e.flow,stage:"invite",isChecked:!0,emails:[],spaceSetupCompleted:!0,joinableUserEmailDomain:t,spaceJoinOrCreate:"create",inviteLinkUrl:e.inviteLinkUrl,shouldTriggerPostInviteAnimations:!1,isBulkInvite:!1,planSelection:e.planSelection,collaborativeIntent:e.collaborativeIntent}}(a);case"mobile_editor":return function(e){const t=oe().qg(e.onboardingData);return{...e,flow:e.flow,stage:"invite",isChecked:!0,emails:[],spaceSetupCompleted:!0,joinableUserEmailDomain:t,spaceJoinOrCreate:"create",shouldTriggerPostInviteAnimations:!1,isBulkInvite:!1,teamStoreId:e.teamStoreId,inviteLinkUrl:e.inviteLinkUrl,spaceViewId:e.spaceViewId,planSelection:e.planSelection,collaborativeIntent:e.collaborativeIntent}}(a);case"mobile_sidebar":return function(e){return{...e,stage:"mobile_editor"}}(a);case"mobile_desktop":case"mobile_app_download":return function(e){return{...e,stage:"mobile_sidebar"}}(a);case"mobile_web_clipper":return function(e,t){return{...e,stage:"mobile_desktop"}}(a);case"workspace_choose":case"invite":case"template_optout":case"workspace_setup":case"profile":case"error":return null;default:f().HB(a)}}async function me(e,t){await oe().cp(e,t);const{password:a,...r}=e,o=S().A.get(oe().Zz),{onboardingData:i,redirectData:c}=r,d=oe().md({onboardingData:i,isNewUserFlow:oe().up(r)});if("guest_redirect"===c.type)return Ue(r,c,"guest",t);if("redirect_page"===c.type||"redirect_space"===c.type)return Ue(r,c,"member",t);if("public_access_page_redirect"===c.type)return function(e,t,a){return ke({environment:a,permissionLevel:"public",onboardingState:e}),U().uK({environment:a,store:new(Q().Bv)(a,{table:p().ev,id:t.pageId}),pageVisitSource:n().y8.Onboarding}),{isOnboarding:!1,isLoading:!1,currentUserId:a.currentUser.id}}(r,c,t);if(o){const e=await k().callApi({eventName:"getPublicSpaceForInvite",environment:t,data:{type:"invite-link",inviteLinkCode:o}});if("success"===e.type){const{data:a}=e,{result:n}=a;if(n)return Ue(r,{type:"team_invite_redirect",spaceId:n.id,inviteCode:o},"member",t);throw new Error(H().A.formatMessage(le.errorWorkspaceDoesNotExist))}throw new Error(H().A.formatMessage(le.errorWorkspaceDidNotLoad))}if(d.length>0)return{...r,joinableSpaces:d,stage:"workspace_choose"};if(i.canUserCreateSpace){if(oe().OU({state:r})){return{...r,spaceJoinOrCreate:"create",userPersona:void 0,useCases:[],stage:"workspace_plan_choose",planSelection:void 0,collaborativeIntent:void 0}}return{spaceName:void 0,...r,spaceJoinOrCreate:"create",userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],categories:[],stage:"persona_survey",skip:!1,previousStage:"profile",planSelection:void 0,collaborativeIntent:void 0}}{I().FX(t,{can_user_create_space:!1,is_new_user:!0,has_joinable_spaces:!1,onboarding_stage:r.stage});const a=i.userStore.getEmail();throw ie().default.setState({...e,stage:"error"}),new(s().Xgk)(a?H().A.formatMessage(le.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:a}):H().A.formatMessage(le.errorWorkspaceCreationPrevented),{newUser:!0})}}function _e(e,t){!e.skip&&e.isNewUser&&function(e,t){const{onboardingData:a,userPersona:n,userRole:r,useCases:o,companySize:i}=t;V().createAndCommit({userAction:"onboardingStateActions.setUserPersonaRoleAndUseCases",environment:e,canUndo:!0,perform:e=>{E().mJ({userSettingsStore:a.userSettingsStore,data:{persona:n,team_role:r,use_cases:o,company_size:i,persona_version:{version:"V4",timestamp:(new Date).getTime()}},transaction:e})}})}(t,e);const{onboardingData:a}=e,n=H().A.getIntl(),r={spaceIcon:null,uploadingSpaceIcon:!1,...Ne(e),...e,spaceJoinOrCreate:"create",userPersona:e.userPersona,stage:"workspace_create"},o=a.userStore.getFullName(n);if("planSelection"in r&&["personal","school"].includes(r.planSelection||"")&&o){const e=a.userStore.getProfilePhoto();return ve({...r,userPersona:r.userPersona||"unfilled",spaceName:oe().JR(o,n),spaceIcon:e||null},t)}return r}function Se(e,t,a){const n="school"===e.planSelection||"personal"===e.planSelection,r=oe().OU({state:e}),o={userRole:void 0,companySize:void 0,spaceName:void 0,categories:[],...e,skip:!1,stage:"persona_survey",previousStage:"workspace_plan_choose"};if(!a)return{...o,collaborativeIntent:void 0,stage:"workspace_collaborative_intent_choose"};if(r||n)return"team"===e.planSelection||n?o:_e({...e,skip:!0,userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],categories:[],previousStage:"workspace_plan_choose",spaceName:void 0,stage:"persona_survey",collaborativeIntent:void 0},t);{if("team"===e.planSelection)return o;const a={userRole:void 0,companySize:void 0,...e,spaceJoinOrCreate:"create",useCases:[],categories:[],stage:"workspace_create",spaceIcon:null,uploadingSpaceIcon:!1},{onboardingData:n}=e,r=H().A.getIntl(),i=n.userStore.getFullName(r),s=n.userStore.getProfilePhoto();if("planSelection"in e&&["personal","school"].includes(e.planSelection||"")&&i){return ve({...a,userPersona:e.userPersona||"unfilled",spaceName:oe().JR(i,r),spaceIcon:s||null,useCases:e.useCases},t)}return a}}async function ve(e,t){const{flow:a,spaceJoinOrCreate:n,onboardingData:r}=e,o=G().default.DO_NOT_USE_markLegacy("onboarding.create_space"),{spaceStore:i,spaceViewStore:s,...c}=await Oe(e,t);if(oe().BH({environment:t,state:{...e,userEducationRole:void 0,userEducationLevel:void 0,notionUseFrequency:void 0},spaceStore:i,spaceViewStore:s}),"team"===e.planSelection){const a=oe().qg(e.onboardingData),{spaceId:n,inviteLinkCode:r}=c;if(G().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:e.redirectData,is_new_user:oe().ze(e),permission_level:"guest_redirect"===e.redirectData.type?"guest":"member",plan:e.planSelection}}}),e.collaborativeIntent&&"multiplayer"!==e.collaborativeIntent){return be({...e,isChecked:!1,stage:"invite",isBulkInvite:!1,spaceSetupCompleted:!0,shouldTriggerPostInviteAnimations:!1,inviteLinkUrl:void 0,emails:[],spaceViewId:s.id,joinableUserEmailDomain:void 0,teamStoreId:void 0},t)}return{...e,...c,isChecked:!0,spaceId:n,emails:[],joinableUserEmailDomain:a,inviteLinkUrl:r&&(0,q().X$)(t,n,r),stage:"invite",isBulkInvite:!1,shouldTriggerPostInviteAnimations:!1,spaceSetupCompleted:!0}}switch(a){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":const{spaceId:i,spaceViewId:d,redirectData:l}=c;if(e.collaborativeIntent&&"multiplayer"===e.collaborativeIntent){return{...e,isChecked:!1,stage:"invite",isBulkInvite:!1,spaceSetupCompleted:!0,shouldTriggerPostInviteAnimations:!1,inviteLinkUrl:void 0,emails:[],spaceViewId:s.id,joinableUserEmailDomain:void 0,teamStoreId:void 0}}return C().m({message:le.navigatingToWorkspace}),await ye({environment:t,onboardingData:r,spaceId:i,spaceViewId:d,spaceJoinOrCreate:n,redirectData:l,onboardingFlow:a,onboardingState:e}),C().V(),G().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:e.redirectData,is_new_user:oe().ze(e),permission_level:"guest_redirect"===e.redirectData.type?"guest":"member",plan:e.planSelection}}}),{...e,spaceId:i,spaceViewId:d,flow:a,stage:"template_optout"};case"mobile_join_or_create_space":return we(e.onboardingData,{...e,...c},t,o);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return Ie({onboardingState:{...e,...c},environment:t,flow:a});default:return f().HB(a)}}async function be(e,t){const a=G().default.DO_NOT_USE_markLegacy("invite_next_state");await oe().TM(e,t);const{flow:n,isNewUser:r,trialId:o}=e;switch(n){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":if("team"!==e.planSelection)return await ye({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{numInvitesSent:e.emails.length}}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};return r&&"perfmark"===o||(0,ee().i4)(t)?(await ye({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{numInvitesSent:e.emails.length}}),Pe(e,t)):{...e,stage:"timed_trial_upsell"};case"desktop_redirect":return await ye({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{numInvitesSent:e.emails.length}}),"team"===e.planSelection?Pe(e,t):{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":const i=we(e.onboardingData,e,t);return G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{mobileOnboardingState:n}}),i;case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":const s=Ie({onboardingState:e,environment:t,flow:n});return G().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{mobileOnboardingState:n}}),s;default:return f().HB(n)}}async function fe(e,t){return await ye({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),Pe(e,t)}async function we(e,t,a,n){return await ye({environment:a,onboardingData:e,spaceId:t.spaceId,spaceViewId:t.spaceViewId,spaceJoinOrCreate:t.spaceJoinOrCreate,redirectData:t.redirectData,onboardingFlow:t.flow,onboardingState:t}),n&&G().default.DO_NOT_USE_measureLegacy(n,{environment:a,data:{flow:t.flow,onboarding_complete_data:{stage:t.stage,redirect_data:t.redirectData,is_new_user:oe().ze(t),permission_level:"guest_redirect"===t.redirectData.type?"guest":"member"}}}),{isOnboarding:!1,isLoading:!1,currentUserId:a.currentUser.id}}function Ie(e){const{onboardingState:t,environment:a,flow:n}=e;if("oauth_authorization_redirect"===t.redirectData.type){const{responseType:e,integrationId:n,redirectUri:r,state:o,owner:i,userId:s,spaceId:c}=t.redirectData;T().t({environment:a,responseType:e,integrationId:n,redirectUri:r,state:o,owner:i,userId:s,spaceId:c})}return{...t,flow:n,stage:"mobile_editor"}}async function ye(e){const{environment:t,redirectData:a,spaceViewId:n,spaceId:r,onboardingData:o,spaceJoinOrCreate:i,onboardingFlow:s,onboardingState:c}=e;await De({environment:t,redirectData:a,spaceViewId:n,spaceId:r,onboardingData:o,spaceJoinOrCreate:i,onboardingFlow:s}),ke({environment:t,spaceJoinOrCreate:i,permissionLevel:"member",onboardingState:c})}async function De(e){const{environment:t,redirectData:a,spaceViewId:r,spaceId:o,onboardingData:i,spaceJoinOrCreate:s,onboardingFlow:c}=e;O().zA({bannerStore:Y().A,id:"SubscriptionEditingBlocker"}),t.device.isMobile&&V().createAndCommit({userAction:"onboardingStateActions.navigateWithRedirectData",environment:t,canUndo:!0,perform:e=>{de().PF({userStore:i.userStore,transaction:e})}});const g=r?Q().vH.createChildStore(i.userRootStore,{table:m().mu,id:r}):void 0,S=_().dw();if("fork_page"===a.type&&g)await R().tR({environment:t,spaceViewStore:g,redirectPageId:a.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"});else if(S&&!i.onboardingCompleted)_().dC(),N().oo({environment:t,url:S,redirect:!0});else if("home"===a.type&&null!=g&&g.isDefined()){const e=await k().callApi({eventName:"getUserHomePages",environment:t,data:{spaceViewId:g.id,spaceId:g.getSpaceId()},headers:(0,d().WS)({cellId:void 0,recordId:g.id,spaceId:g.getSpaceId()})}),{recordMap:a,homePageId:r}="success"===e.type?{recordMap:l().RecordMapWithRole.create(e.data.recordMap),homePageId:e.data.homePageId}:{recordMap:void 0,homePageId:void 0},o=g.pointer;a&&A().PC({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,pointer:o,model:a.getModel(o),role:a.getRole(o)||"none",updatePaths:[["settings","personal_home"]],debugSource:"onboardingStateActions.navigateWithRedirectData",force:!0}),await R().tR({environment:t,redirectPageId:r,spaceViewStore:g,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"})}else if("redirect_page"===a.type&&a.spaceId===o&&g)await A().sy({environment:t,pointer:{table:p().ev,id:a.pageId},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,userId:t.currentUser.id}),await R().tR({environment:t,spaceViewStore:g,redirectPageId:a.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("redirect_space"===a.type&&a.spaceId===o&&g)await R().tR({environment:t,spaceViewStore:g,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("mobile_native_home"===a.type&&g)await R().tR({environment:t,spaceViewStore:g,redirectPageId:void 0,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("getting_started_page"!==a.type&&"redirect_space"!==a.type&&"performance_marketing_template"!==a.type||!g)if("oauth_authorization_redirect"===a.type&&"mobile_cold_start"!==c&&"mobile_joinable_spaces"!==c&&"mobile_redirect"!==c){const{responseType:e,integrationId:n,redirectUri:r,state:o,owner:i,userId:s,spaceId:c}=a;T().t({environment:t,responseType:e,integrationId:n,redirectUri:r,state:o,owner:i,userId:s,spaceId:c})}else if(g)await R().tR({environment:t,spaceViewStore:g,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"});else{if(!i.firstSpaceView)throw new Error(H().A.formatMessage(le.errorNoAction,{onboardingRedirectType:a.type}));await R().tR({environment:t,spaceViewStore:i.firstSpaceView,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace"})}else{let e;if("getting_started_page"===a.type&&a.collectionId){const n=Q().md.createChildStore(g.getSpaceStore(),{table:u().Vl,id:a.collectionId});e=(await(0,x().VZ)({environment:t,collectionStore:n})).collectionViewBlockStore()}await R().tR({environment:t,spaceViewStore:g,redirectPageId:a.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:n().y8.Onboarding,navigationType:"joiningOrCreatingSpace",navigateToStore:e})}}function ke(e){const{environment:t,onboardingState:a}=e;if(t.device.isElectron&&h().quickSearchRefresh(),!a.isOnboarding)return;const{onboardingData:{userStore:n}}=a;V().createAndCommit({userAction:"onboardingStateActions.setAndTrackOnboardingComplete",environment:t,canUndo:!0,perform:e=>{de().LC({userStore:n,transaction:e})}}),y().IA(t,{...oe().M6(a),initial_workspace_type:"public"!==e.permissionLevel?e.spaceJoinOrCreate:void 0,permission_level:e.permissionLevel}),D().Kc(t)}async function Oe(e,t){if("join"===e.spaceJoinOrCreate){C().m({message:le.joiningWorkspace});const a=await Ce({environment:t,onboardingData:e.onboardingData,redirectData:e.redirectData,spaceId:e.spaceId||"",isNewUserOnboarding:oe().ze(e)});return C().V(),a}{C().m({message:le.creatingWorkspace});const a=await he({environment:t,isNewUserOnboarding:oe().ze(e),onboardingData:e.onboardingData,userPersona:e.userPersona,redirectData:e.redirectData,spaceName:e.spaceName,spaceIcon:e.spaceIcon,planSelection:e.planSelection,isPrivate:"team"!==e.planSelection,useCases:e.useCases,categories:e.categories,hasTrialId:Boolean(e.trialId),selectedWorkflowTemplates:[]}),n=e.isNewUser&&"perfmark"===e.trialId;if(!n&&(0,ee().i4)(t)&&"team"===e.planSelection){const e={table:g().NX,id:a.spaceId};await(0,te().applyReversePlusTrial)(new(Q().SL)(t,e),t,"onboarding")&&(0,X().UW)(t,"onboarding_reverse_trial_sidebar")}if(n&&e.planSelection&&oe().ze(e)){const n=await Re(a.spaceId,e.planSelection,t),{enableTrialInfoModal:r,enableTrialIneligibleToast:o}=n;r&&(0,ae().fR)({openedFrom:"onboarding"}),o&&se().A.setState({open:!0,isExistingUser:!1})}return C().V(),a}}async function he(e){const{environment:t,onboardingData:a,userPersona:n,redirectData:r,spaceName:i,planSelection:s,spaceIcon:c,isPrivate:d,useCases:l,categories:p,isNewUserOnboarding:u,selectedWorkflowTemplates:g,collaborativeIntent:m,source:_,createTemplates:S=!0}=e,v="team"===s?"team":"personal",b=G().default.DO_NOT_USE_markLegacy("create_space_with_templates"),{spaceStore:f,spaceViewStore:w,inviteLinkCode:I,teamStore:D}=await R().bz({environment:t,planType:v,planSelection:s,name:i,userRootStore:a.userRootStore,analyticsFrom:"onboarding",icon:c||void 0,userPersona:n,collaborativeIntent:m,source:_}),k=f.getCreatedById()===t.currentUser.id;let O;(0,F().f1)({environment:t,experimentId:"adoption_hide_features_v2",variant:[...o().Dx.adoption_hide_features_v2],isUserWorkspaceOwner:k,isDesktop:t.device.isDesktop})&&E().Mg({environment:t,experimentId:"adoption_hide_features_v2"}),ie().default.setState({...ie().default.state,spaceId:f.id}),await Z().$D({environment:t,spaceId:f.id,isNewlyCreatedSpace:!0}),!(0,M().isAiOnboardingFlow)(W().A.state.flowName)&&K().default.checkGate({gateName:"enable_write_survey_data_optimization"})&&((0,j().setUserAndSpaceSurveyData)({environment:t,onboardingState:W().A.state,planSelection:s,spaceStore:f,spaceViewStore:w}),(0,j().DO_NOT_USE_setUserPersonaRoleAndUseCases)(t,W().A.state));let h=[],C={};if(S&&oe().sr(v)&&!a.performanceMarketingTerm){let e=[],a=[],n=[];(0,M().isWorkflowTemplatesEnabledForOnboarding)(t)?(n=[...g??[],...Ve(l)],e=l.includes("wikis")?[L().wikiAppTemplateUri]:[]):(e=(0,L().getAppTemplatePresetsForUseCases)(l),a=(0,ce().getPageTemplatesForUseCases)(l,H().A.getIntl())),C={appTemplates:e,pageTemplates:a,workflowTemplates:n}}else if(S){let e=[];e=a.performanceMarketingTerm?(0,ce().getPerformanceMarketingSearchTermTemplates)(a.performanceMarketingTerm,H().A.getIntl()):ce().getStarterTemplatesForSpace({environment:t,onboardingPlanType:s,categories:p,intl:H().A.getIntl()}),e&&(h=e.map((e=>e.rootId))),C={pageTemplates:e}}O=await ce().createTemplatePagesInSpace({environment:t,redirectData:r,spaceViewStore:w,userSettingsStore:a.userSettingsStore,userRootStore:a.userRootStore,isPrivate:d,templatesToCreateInSpace:C,planType:v,spaceJoinOrCreate:"create",teamStore:D,useCases:l,userPersona:n,isNewUserOnboarding:u}),y().rn(t,{plan_selection:s,user_persona:n,initial_workspace_type:"create",space_id:f.id,onboarding_templates:h}),G().default.DO_NOT_USE_measureLegacy(b,{environment:t,data:{}});const T=Ae(r,O,t),A="pageId"in T?T.pageId:void 0;return W().A.setState({...W().A.state,onboardingData:{...a,redirectPageId:A}}),{redirectData:T,spaceId:f.id,spaceViewId:w.id,inviteLinkCode:I,spaceStore:f,spaceViewStore:w,teamStoreId:null==D?void 0:D.id}}async function Ce(e){const{environment:t,onboardingData:a,spaceId:n,redirectData:r,isNewUserOnboarding:o}=e,i="team_invite_redirect"===r.type?r.inviteCode:void 0,{spaceViewStore:s}=await R().DT({environment:t,spaceId:n,userRootStore:a.userRootStore,analyticsFrom:"onboarding",userSettingsStore:a.userSettingsStore,inviteCode:i,isOnboarding:!0});$().default.state.currentSpaceStore||$().default.setState({...$().default.state,currentSpaceStore:s.getSpaceStore()});const c=ce().getStarterTemplatesForSpace({environment:t,onboardingPlanType:"team",categories:[],isJoiner:!0,intl:H().A.getIntl()}),d=await ce().createTemplatePagesInSpace({environment:t,redirectData:r,spaceViewStore:s,isPrivate:!0,userSettingsStore:a.userSettingsStore,userRootStore:a.userRootStore,templatesToCreateInSpace:{pageTemplates:c},planType:"team",spaceJoinOrCreate:"join",useCases:[],userPersona:"unfilled",isNewUserOnboarding:o});y().xs(t,{initial_workspace_type:"join",space_id:n,onboarding_templates:null==c?void 0:c.map((e=>e.rootId))});return{redirectData:Ae(r,d,t),spaceId:n,spaceViewId:s.id,inviteLinkCode:void 0,spaceStore:void 0,spaceViewStore:s,teamStoreId:void 0}}async function Te(e,t){const a=await async function(e,t){const a="spaceId"in e.redirectData&&e.redirectData.spaceId,{onboardingData:n,redirectData:r}=e;if(a){const o=await Ce({environment:t,onboardingData:n,redirectData:r,spaceId:a,isNewUserOnboarding:oe().ze(e)});return{...e,...o,spaceId:a}}if("fork_page"===r.type){const a=J().jU(n.userRootStore);if(a.length>0){const o=a[0].getSpaceId();if(o){const i=Q().SL.createChildStore(n.userRootStore,{table:g().NX,id:o}),s=Ae(r,await P().sg({environment:t,userRootStore:n.userRootStore,isPrivate:!0,forkedPageId:r.pageId,spaceStore:i,spaceViewStore:a[0]}),t);return{...e,redirectData:s,spaceViewId:a[0].id,spaceId:o}}}}return e}(e,t);return we(e.onboardingData,a,t)}function Ae(e,t,a){if(t){if("redirect_space"===e.type)return{type:e.type,pageId:t.id,spaceId:e.spaceId};if("getting_started_page"===e.type)return oe().zX(a)?{type:"mobile_native_home"}:{type:e.type,pageId:t.id};if("fork_page"===e.type)return{type:e.type,pageId:t.id};if("performance_marketing_template"===e.type)return{type:e.type,pageId:t.id}}return e}async function Ue(e,t,a,n){const{onboardingData:r}=e,o=G().default.DO_NOT_USE_markLegacy("onboarding.join_space");if("guest"===a){if(ke({environment:n,spaceJoinOrCreate:"join",permissionLevel:a,onboardingState:e}),"team_invite_redirect"===t.type)throw new Error("Cannot invite guests to workspace from invite links.");await R().DT({environment:n,spaceId:t.spaceId,userRootStore:r.userRootStore,analyticsFrom:"onboarding",userSettingsStore:r.userSettingsStore,navigate:!0,redirectPageId:t.pageId})}else{const a=await Ce({environment:n,onboardingData:r,redirectData:t,spaceId:t.spaceId,isNewUserOnboarding:oe().ze(e)});await ye({environment:n,onboardingData:r,spaceId:a.spaceId,spaceViewId:a.spaceViewId,spaceJoinOrCreate:"join",redirectData:a.redirectData,onboardingFlow:e.flow,onboardingState:e})}return G().default.DO_NOT_USE_measureLegacy(o,{environment:n,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:t,is_new_user:oe().ze(e),permission_level:a}}}),{isOnboarding:!1,isLoading:!1,currentUserId:n.currentUser.id}}function Ne(e){let t;e.onboardingData.isEducationPlanEligible&&(t="student");const{function:a}=(0,q().p3)();return a&&(t=a),{userPersona:t}}async function Re(e,t,a){let n=!1,r=!1;const o=await k().callApi({eventName:"checkAndApplyPerfmarkTrial",environment:a,data:{spaceId:e}});if("success"===o.type){const e="success"===o.data.status;(0,z().u4)({environment:a,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"perfmark",success:e,planType:t,..."error"===o.data.status&&{reason:o.data.reason}}}}),w().D$(a,{trial_id:"perfmark",success:e,planType:t,domainType:(0,B().FX)()}),"success"===o.data.status?n=!0:r=!0}else(0,z().u4)({environment:a,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"perfmark",success:!1,planType:t,reason:o.error.name}}}),w().D$(a,{trial_id:"perfmark",success:!1,planType:t}),i().log({level:"error",from:"onboardingActions",type:"applyPerfmarkTrialError",error:(0,b().convertErrorToLog)(o.error)});return(0,ne().Q8)(),{enableTrialInfoModal:n,enableTrialIneligibleToast:r}}function Pe(e,t,a,n){return"create"===e.spaceJoinOrCreate&&e.isNewUser&&!a&&re().default.setState({type:"team_creator",step:"welcome",initialTeamStoreId:e.teamStoreId}),"modal"===a&&(0,ae().fR)({openedFrom:"onboarding"}),"sidebar"===a&&(0,X().UW)(t,"onboarding_reverse_trial_sidebar"),n&&se().A.setState({open:!0,isExistingUser:!1}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}function Ve(e){return e.map((e=>Ee(e))).filter((e=>void 0!==e))}function Ee(e){switch(e){case"docs":return"docsCollection";case"project":return"projectsCollection";case"notes":return"meetingNotesCollection";case"goals":return"goalsCollection";default:return}}}}]);