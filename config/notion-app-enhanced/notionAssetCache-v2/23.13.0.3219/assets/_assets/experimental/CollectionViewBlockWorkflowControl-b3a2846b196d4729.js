"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72535],{44250:(e,t,n)=>{function o(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function s(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>r,K$:()=>o,j6:()=>s})},516525:(e,t,n)=>{n.r(t),n.d(t,{CollectionViewBlockWorkflowControl:()=>W});n(362833),n(403517);var o=n(242343),r=()=>n(237385),s=()=>n(803290),a=()=>n(174114),i=()=>n(712437),c=n(163643);const l={viewBox:"0 0 20 20",svg:(0,c.jsx)("path",{d:"M5.25 3.125A2.125 2.125 0 0 0 3.125 5.25v9.5c0 1.174.951 2.125 2.125 2.125h9.5a2.125 2.125 0 0 0 2.125-2.125v-9.5a2.125 2.125 0 0 0-2.125-2.125z"})},d=(0,n(680369).wt)("appFill",l);var p=()=>n(145017),u=()=>n(21164),m=()=>n(829629),v=()=>n(218508),w=()=>n(653998),y=()=>n(191756),g=()=>n(84543),k=()=>n(413871),f=()=>n(528762),h=()=>n(44250);const x={read_content:!0,read_comment:!0},I={...x,insert_comment:!0,insert_content:!0,update_content:!0};var A=()=>n(76394);var j=()=>n(209684),b=()=>n(535906),C=()=>n(273520),S=()=>n(966789),B=()=>n(932322),_=()=>n(858023),P=()=>n(28210),T=()=>n(709237),M=()=>n(88271),V=(n(725707),n(500234),()=>n(162901)),K=()=>n(519423),O=()=>n(446588),U=()=>n(818369);function W(e){const{store:t,style:n}=e,l=(0,r().v3)(),b=function(e){const t=(0,r().v3)(),[n,o]=(0,s().K8)((()=>[e.getSpaceId(),e.getAllSourceCollectionStores()]),[e]),[a]=(0,V().Yb)((async()=>{const e=await U().callApi({environment:t,eventName:"getWorkflowsForCollections",data:{collectionIds:o.map((e=>({id:e.id,spaceId:n})))},headers:(0,K().WS)({cellId:void 0,spaceId:n})});return"success"===e.type?e.data.workflowResults:[]}),[t,n,o]);return(0,s().K8)((()=>{const t=new Map(o.map((e=>[e.id,e])));return"resolved"!==a.status?a:{status:"resolved",value:a.value.map((n=>{const{collectionId:o,botId:r}=n,s=t.get(o);if(!s)return{...n,access:"none"};const a=[...s.getPermissionItems(),...e.getPermissionItems()].find((e=>"bot_permission"===e.type&&e.bot_id===r)),i=null==a?void 0:a.role;let c="none";return i&&(0,O().p2)(i)?c="write":i&&(0,O().Tt)(i)&&(c="read"),{...n,access:c}}))}}),[e,a,o])}(t),W=(0,a().IS)((e=>({appContainer:{maxHeight:250,overflowY:"scroll"},appItem:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"}})),[]),z=(0,s().K8)((()=>{if("resolved"!==b.status)return[];const e=new(v().G)((()=>[]));for(const t of b.value)e.get(t.collectionId).push(t);const n=Array.from(e.entries()).map((e=>{let[n,r]=e;const s=k().md.createChildStore(t,{table:u().Vl,id:n,spaceId:t.getSpaceId()});return{key:n,items:r.map((e=>{let{blockId:n,workflowId:r,access:a}=e;const d=k().Bv.createChildStore(t,{table:p().ev,id:n,spaceId:t.getSpaceId()}),u=k().NU.createChildStore(t,{table:m().C0,id:r,spaceId:t.getSpaceId()});return{key:n,render:e=>(0,o.createElement)(B().Ay,{...e,key:n,title:(0,c.jsxs)(j().p,{style:W.appItem,onClick:()=>{y().uK({environment:l,store:d,openInNew:"tab",pageVisitSource:i().y8.CollectionViewBlockWorkflowControl})},children:[(0,c.jsx)(P().B,{disabled:!0,icon:d.getIcon(),isEmptyPage:!1,size:18}),(0,c.jsx)(T().A,{store:d})]}),right:(0,c.jsx)(D,{access:a,disabled:!s.canAdmin(),onChange:async e=>{await u.load(),g().createAndCommit({environment:l,canUndo:!1,userAction:"CollectionViewBlockWorkflowControl.updateAccessScope",perform:t=>{!function(e){var t;const{workflowStore:n,collectionStore:o,newAccess:r,transaction:s}=e,a=null===(t=n.getData())||void 0===t?void 0:t.runtime_actor_pointer;if(!a)return;let i;switch(r){case"none":i="none";break;case"read":i=x;break;case"write":i=I;break;default:(0,A().HB)(r)}const c={type:"bot_permission",bot_id:a.id,role:i,parent_id:n.getSpaceId(),parent_table:f().NX};if(g().applyOperation({store:o,transaction:s,operation:{command:"setPermissionItem",pointer:o.pointer,path:["permissions"],args:c}}),n.canAdmin()){var l;const e=((null===(l=n.getData())||void 0===l?void 0:l.modules)??[]).findIndex((e=>{var t;return"database"===e.type&&(null===(t=(0,h().DK)(e.state))||void 0===t||null===(t=t.pointer)||void 0===t?void 0:t.id)===o.id}));if(-1===e)return;g().applyOperation({store:n,operation:{command:"set",path:["data","modules",e,"state","accessScope"],args:"none"===r?"read":r,pointer:n.pointer},transaction:s})}}({workflowStore:u,collectionStore:s,newAccess:e,transaction:t})}})}})}),action:()=>{}}})),render:e=>{let{children:t,...n}=e;return(0,c.jsx)(M().A,{title:(0,c.jsx)(T().A,{store:s}),...n,children:t})}}}));return n}),[l,t,b,W]);return"pending"===b.status?(0,c.jsx)(S().A,{size:"sm"}):"rejected"===b.status||"idle"===b.status||0===b.value.length?null:(0,c.jsx)(C().Ay,{popupType:C().z7.Popup,renderOrigin:e=>(0,c.jsx)(j().p,{...e,style:n,isLightGray:!0,icon:d,children:(0,c.jsx)(w().sA,{id:"collectionViewBlock.workflow.apps",defaultMessage:"{count, plural, one {1 app} other {{count} apps}}",values:{count:b.value.length}})}),render:()=>(0,c.jsx)(_().Ay,{style:W.appContainer,type:_().Oh.Vertical,sections:z,initialFocus:0})})}const z={read:(0,c.jsx)(w().sA,{id:"accessButton.read",defaultMessage:"Read"}),write:(0,c.jsx)(w().sA,{id:"accessButton.write",defaultMessage:"Write"}),remove:(0,c.jsx)(w().sA,{id:"accessButton.remove",defaultMessage:"Remove"})};function D(e){const{access:t,disabled:n,onChange:o}=e,r=(0,a().IS)((e=>({container:{width:200},redButtonMenuItem:{color:e.text.uiRedPrimary}})),[]),s=e=>{switch(e){case"read":return z.read;case"write":return z.write;case"none":return null}},i=e=>[{key:"access-scope",render:e=>(0,c.jsx)(M().A,{...e,topBorder:!1}),items:[{key:"write",render:e=>(0,c.jsx)(b().A,{...e,title:z.write}),action:()=>{o("write"),e()}},{key:"read",render:e=>(0,c.jsx)(b().A,{...e,title:z.read}),action:()=>{o("read"),e()}}]},{key:"remove-access",render:e=>(0,c.jsx)(M().A,{...e,topBorder:!0}),items:[{key:"remove",render:e=>(0,c.jsx)(b().A,{...e,style:r.redButtonMenuItem,title:z.remove}),action:()=>{o("none"),e()}}]}];return(0,c.jsx)(C().Ay,{popupType:C().z7.Popup,renderOrigin:e=>(0,c.jsx)(j().p,{...e,isLightGray:!0,disabled:n,children:s(t)}),render:e=>{let{close:n}=e;return(0,c.jsx)("div",{style:r.container,children:(0,c.jsx)(_().Ay,{type:_().Oh.Vertical,sections:i(n),initialFocus:"write"===t?0:1})})}})}}}]);