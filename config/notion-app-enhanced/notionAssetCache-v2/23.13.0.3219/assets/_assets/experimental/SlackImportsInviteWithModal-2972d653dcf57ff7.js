"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[68117],{766756:(e,t,i)=>{i.r(t),i.d(t,{SlackImportsInviteWithModal:()=>V});var n=i(242343),o=()=>i(237385),r=()=>i(803290),s=()=>i(174114),a=()=>i(83544),l=()=>i(653998),c=()=>i(726984),v=()=>i(516267),u=()=>i(433119),d=()=>i(127086),g=()=>i(60020),m=()=>i(785061),p=()=>i(226518),I=()=>i(202027);let S=function(e){return e.SearchInput="search_input",e.NoFocus="no_focus",e}({});class f extends(()=>i(129044))().default{getInitialState(){return{flowId:i(214144).JW(),modalOpen:!1,focus:S.NoFocus}}}const k=f;var y=()=>i(704082),_=()=>i(485966),h=()=>i(210466),C=(i(725707),i(491955),i(403517),i(163643));const x=function(e){const{slackImportsInviteStore:t,inviteTargetsStore:s,inviteOrigin:a,onInviteComplete:v,onInviteClick:u}=e,d=(0,o().v3)(),g=(0,l().tz)(),p=(0,m().X3)(),I=(0,r().O$)(_().AppStoreCurrentSpaceStore),f=(0,r().K8)((()=>t.state.flowId),[t]),k=(0,r().K8)((()=>s.state.inviteTargets.length),[s]),h=(0,n.useCallback)((async e=>{const{response:n,invitedUserEmails:o}=e;c().MP(d,{invite_stage:"invite_complete",invite_flow_id:f,origin:a,is_success:n.success,invited_user_count:o.length}),n.success&&t.setState({...t.state,modalOpen:!1}),null==v||v(n.success,k);(await i(998865).uf.personPropertyInviteActions.load()).showMessageForInviteComplete({success:n.success,invitedUserEmails:o})}),[a,d,f,v,t,k]),x=(0,n.useCallback)((e=>{const t=(0,y().A)(e);c().MP(d,{invite_stage:"invite_member",invited_user_count:k,invite_flow_id:f,error:t,origin:a,is_success:!1})}),[d,f,a,k]),T=(0,n.useCallback)((async()=>{const e=s.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(!I)return null;await i(449450).s({environment:d,spaceStore:I,flowId:f,intl:g,inviteTargetsStore:s,inviteOrigin:a,onInviteComplete:t=>h({response:t,invitedUserEmails:e}),onInviteClick:u,onError:x}),s.reset()}),[I,d,f,s,g,a,u,h,x]),j=(0,n.useCallback)((async()=>{t.setState({...t.state,focus:S.NoFocus}),c().yS(d,{invited_user_count:k,origin:a,inviteTargets:s.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:s.state.tokenQuery,invite_flow_id:f}),await T()}),[T,d,f,a,t,s,k]);return(0,C.jsx)("div",{style:p.footerStyle,children:(0,C.jsx)(i(951540).A,{size:"lg",style:{borderRadius:6},onClick:j,disabled:0===k,children:(0,C.jsx)(i(338054).V,{totalInviteCount:k})})})};var T=()=>i(35462);const j=function(e){const{isLoading:t}=e,n=(0,m().iO)(),o=t?(0,C.jsx)(i(966789).A,{style:{marginLeft:6}}):null;return(0,C.jsxs)("div",{style:n.topContainer,children:[(0,C.jsx)(T().A,{style:n.sendInviteLabel,children:(0,C.jsx)(l().sA,{id:"invite.slack_imports.header_title",defaultMessage:"Import from Slack"})}),o]})};var b=()=>i(528643),w=()=>i(797715);const A=function(e){const{inviteTargetsStore:t,slackImportsInviteStore:s,inviteOrigin:a}=e,c=(0,l().tz)(),v=(0,o().v3)(),{tokenQuery:u}=(0,r().K8)((()=>{const{tokenQuery:e}=t.state;return{tokenQuery:e}}),[t]),{focus:d,flowId:g}=(0,r().K8)((()=>({focus:s.state.focus===S.SearchInput,flowId:s.state.flowId})),[s]),p=(0,m().vG)({focus:d}),I=c.formatMessage({id:"invite.slack_imports.search.placeholder",defaultMessage:"Search people, emails..."}),f=(0,i(863969).O)(),k=(0,i(159448).lI)({spaceId:f}),y=(0,n.useCallback)((e=>{t.setState({...t.state,tokenQuery:e.target.value}),O({environment:v,flowId:g,billingData:k,origin:a})}),[t,g,a,v,k]);return(0,C.jsx)("div",{style:p.searchBar,children:(0,C.jsx)(w().Ay,{focus:d,onClick:()=>{s.setState({...s.state,focus:S.SearchInput})},format:w().le.Share,value:u,onChange:y,type:"email",tokens:[],autoComplete:"off",placeholder:I,onRemoveLastToken:()=>{},showBorder:!0,inputFullWidth:!0})})},O=i(975392).sg((e=>{let{environment:t,flowId:i,billingData:n,origin:o}=e;b().D2(t,{invite_flow_id:i,billingData:n,invite_origin:o})}),1e3);var L=()=>i(162901),M=()=>i(235843),K=()=>i(535906),Q=()=>i(884373),B=()=>i(858023),F=()=>i(88271),E=()=>i(657412),U=()=>i(622286),z=()=>i(764227),P=()=>i(206069),R=()=>i(367824);function N(e){const{inviteTargetsStore:t,slackImportsInviteStore:i}=e,n=(0,o().v3)(),s=(0,l().tz)(),a=(0,r().K8)((()=>t.state.tokenQuery),[t]),c=(0,r().K8)((()=>i.state.flowId),[i]),v=(0,U().X)("edge_cache_helpers"),[{value:u,status:d}]=(0,L().Yb)((async()=>M().hQ({query:a,sectionLimit:{userLimit:0,botLimit:0,groupLimit:0,importContactLimit:1e3},environment:n,intl:s,membersOnly:!1,importContactType:"slack",shouldUseEdgeCacheRollout:v})),[n,s,a,v],{debounce:40});return(0,C.jsx)(D,{...e,tokenQuery:a,ready:"pending"!==d,error:"rejected"===d,result:u,flowId:c,environment:n})}function D(e){const{inviteTargetsStore:t,slackImportsInviteStore:i,tokenQuery:n,error:o,ready:s,result:a,inviteOrigin:v,flowId:u,environment:d}=e,g=(0,m().S3)(),p=(0,r().K8)((()=>(null==a?void 0:a.importedContacts)??[]),[a]),I=(0,r().uB)(e.menuListStore,h().A),f={key:"select all",render:e=>(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(F().A,{...e,style:g.selectAllSectionStyle}),(0,C.jsx)(Q().A,{size:1,innerStyle:g.dividerInnerStyle,style:g.dividerStyle})]}),items:[{key:"select all item",render:e=>(0,C.jsx)(K().A,{...e,title:(0,C.jsxs)("div",{style:g.selectAllStyle,children:[(0,C.jsx)(l().sA,{id:"invite.slack_imports.select_all.title",defaultMessage:"Select all"}),(0,C.jsx)(T().A,{style:g.totalCountsStyle,isSmall:!0,children:`(${p.length})`})]}),right:(0,C.jsx)(P().O,{checked:(0,m().dE)({filteredImportedContacts:p,inviteTargetsStore:t})})}),action:()=>{!function(e){const{filteredImportedContacts:t,inviteTargetsStore:i,environment:n,origin:o,flowId:r,tokenQuery:s}=e;if(i.state.inviteTargets.length===t.length)return i.setState({...i.state,inviteTargets:[]}),void c().C6(n,{origin:o,invite_flow_id:r,invited_user_count:0,is_unselect:!0,invite_token_query:s});c().C6(n,{origin:o,invite_flow_id:r,invited_user_count:t.length,is_unselect:!1,invite_token_query:s}),i.setState({...i.state,inviteTargets:t})}({filteredImportedContacts:p,inviteTargetsStore:t,origin:v,flowId:u,environment:d,tokenQuery:n}),i.setState({...i.state,focus:S.NoFocus})}}]},k=(0,m().Mg)({filteredImportedContacts:p}),y=Object.keys(k).sort(((e,t)=>"#"===e?1:"#"===t?-1:e.localeCompare(t))).map((e=>function(e){const{charKey:t,importedContacts:i,inviteTargetsStore:n,slackImportsInviteStore:o,menuListStore:r,style:s,tokenQuery:a,environment:c}=e,v={key:`imported contacts with ${t}`,render:e=>(0,C.jsx)(F().A,{...e,style:s,title:(0,C.jsx)(l().sA,{id:"invite.slack_imports.grouped_section.title",defaultMessage:"{charKey}",values:{charKey:t}})}),items:i.sort(((e,t)=>(e.value.name||"").localeCompare(t.value.name||""))).map(((e,t)=>({key:e.value.email,render:t=>(0,C.jsx)($,{...t,invited:!1,inviteTarget:e,isInInviteTargets:E().P4({target:e,inviteTargetsStore:n})}),action:()=>{E().P4({target:e,inviteTargetsStore:n})?n.setState({...n.state,inviteTargets:n.state.inviteTargets.filter((t=>"newUser"!==t.type||e.value.email!==t.value.email))}):(b().kH(c,{invite_token_query:a,selected_user_token:e,selected_user_token_rank:t,from:"slack_imports_space_setting",subscription_tier:(0,z().AI)(),type:"slack"}),o.setState({...o.state,focus:S.NoFocus}),n.setState({...n.state,inviteTargets:[...n.state.inviteTargets,e]}),r.unsetFocus())}})))};return v}({charKey:e,importedContacts:k[e],inviteTargetsStore:t,slackImportsInviteStore:i,menuListStore:I,style:g.sectionMenuItem,tokenQuery:n,environment:d})));return o?(0,C.jsx)(R().V,{isLoading:!s}):(0,C.jsx)(B().Ay,{type:B().Oh.Vertical,initialFocus:n.length>0?0:void 0,sections:[f,...y],store:I})}const $=n.forwardRef((function(e,t){const{inviteTarget:i}=e;return(0,C.jsx)(q,{...e,ref:t,inviteTarget:i})})),q=n.forwardRef((function(e,t){const{inviteTarget:o,isInInviteTargets:l,...c}=e,u=(0,s().IS)((()=>({cellMemberAvatarContainer:{paddingTop:8,paddingBottom:8},iconBox:{position:"absolute",bottom:-3,right:-3},iconBoxImage:{background:"white",padding:2,borderRadius:"100%"}})),[]),d=(0,n.useMemo)((()=>({actorStore:void 0,avatar:{email:o.value.email,name:"slack"===o.source?o.value.name:void 0,avatarUrl:"slack"===o.source?o.value.avatar_url:void 0}})),[o]),g=(0,r().K8)((()=>"on"===i(836331).default.getEligibleGroup({experimentId:"contact_import_notion_account",defaultGroup:"control",parameter:"variant"})),[]);return(0,C.jsx)(K().A,{...c,ref:t,title:(0,C.jsx)(i(150957).A,{isLarge:!0,...d,containerStyle:u.cellMemberAvatarContainer,avatarBadge:(0,C.jsx)(v().A,{type:"image_url",imageURL:a().A.images.externalIntegrations.slackIconPng,size:18,style:u.iconBox,imageStyle:u.iconBoxImage}),caption:g&&o.value.user_id?(0,C.jsx)(i(797588).N,{inviteTarget:o}):null}),right:(0,C.jsx)(P().O,{checked:l})})}));const G=function(e){const{inviteTargetsStore:t,slackImportsInviteStore:s,inviteOrigin:a,onInviteComplete:l,onInviteClick:v}=e,u=(0,o().v3)(),[d,g]=(0,n.useState)(!1),m=(0,r().O$)(i(773082).A.completeSlackAuthentications),p=(0,r().O$)(_().AppStoreCurrentSpaceStore),I=(0,r().K8)((()=>s.state.flowId),[s]),S=(0,r().uB)(void 0,h().A);(0,n.useEffect)((()=>{c().sD(u,{invite_flow_id:s.state.flowId,origin:a}),async function(){if(p&&!d){for(const e of m)await i(818369).callApi({eventName:"loadContacts",environment:u,data:{botId:e.id,spaceId:p.id,integrationId:i(706788).zG,importContactType:"slack"}}).catch((e=>{const t=(0,y().A)(e);c().MP(u,{invite_stage:"load_slack_contacts",invited_user_count:0,invite_flow_id:I,error:t,origin:a,is_success:!1}),i(502140).log({level:"error",from:"SlackImportsInvite",type:"loadSlackContacts",error:(0,i(450475).convertErrorToLog)(e)})}));g(!0)}}()}),[p,m,u,d,a,s,I]);const f=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,isLoading:o}=e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(j,{isLoading:o}),(0,C.jsx)(A,{inviteTargetsStore:i,slackImportsInviteStore:t,inviteOrigin:n})]})}({inviteTargetsStore:t,slackImportsInviteStore:s,inviteOrigin:a,isLoading:!d}),k=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r}=e;return(0,C.jsx)(x,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r})}({slackImportsInviteStore:s,inviteTargetsStore:t,inviteOrigin:a,onInviteComplete:l,onInviteClick:v}),T=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:o,isLoading:r}=e;if(r)return null;return(0,C.jsx)(N,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:o})}({slackImportsInviteStore:s,inviteTargetsStore:t,inviteOrigin:a,menuListStore:S,isLoading:!d}),b={menuType:i(640979).gu.Popup,width:480,height:"60vh",header:f,footer:k,tokenInputHeader:!1,disableScroller:!1};return(0,C.jsx)(i(935091).A,{...b,className:i(983050).bFE,children:(0,C.jsx)("div",{children:T})})};function V(e){const t=(0,o().v3)(),{inviteOrigin:i,onInviteComplete:s,onInviteClick:a,buttonLabel:l,buttonStyle:v,buttonContainerStyle:S}=e,f=(0,m().Io)(v,S),y=(0,r().uB)(void 0,k),_=(0,r().uB)(void 0,g().Ay),{modalOpen:h,flowId:x}=(0,r().O$)(y),T=(0,n.useCallback)((()=>{!function(e){e.reset()}(y),c().d2(t,{origin:i,invite_flow_id:x})}),[y,i,t,x]),j=(0,n.useCallback)((()=>function(e){const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r}=e;return(0,C.jsx)(G,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r})}({inviteTargetsStore:_,slackImportsInviteStore:y,inviteOrigin:i,onInviteComplete:s,onInviteClick:a})),[_,y,i,a,s]),b=(0,p().J)();return(0,r().K8)((()=>{b&&(0,I().f)({environment:t,flowId:x,origin:i,type:"slack"})}),[b,t,x,i]),b?(0,C.jsx)(u().A,{open:h,onDismiss:T,renderContent:j,origin:(0,C.jsx)(d().Xx,{onClickAuthenticated:()=>{!function(e){e.setState({...e.state,modalOpen:!0})}(y)},title:l??(0,C.jsx)(W,{}),hideChevronIcon:!0,containerStyle:f.buttonContainer,buttonStyle:f.button,from:"space_settings",inviteOrigin:i,loadContacts:!1})}):null}function W(){const e=(0,s().IS)((e=>({slackTitle:{display:"flex",fontSize:14,color:e.text.primary},integrationIcon:{marginRight:4}})),[]);return(0,C.jsxs)("div",{style:e.slackTitle,children:[(0,C.jsx)(v().A,{type:"image_url",imageURL:a().A.images.externalIntegrations.slackIconPng,size:16,imageStyle:e.integrationIcon}),(0,C.jsx)(l().sA,{defaultMessage:"Import from Slack",id:"invite.slack_imports.button.label"})]})}}}]);