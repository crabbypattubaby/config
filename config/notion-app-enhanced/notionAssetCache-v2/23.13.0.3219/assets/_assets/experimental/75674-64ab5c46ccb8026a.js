"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[75674],{168163:(e,t,a)=>{a.d(t,{b:()=>o});const o=(0,a(680369).xh)("lightning",{default:{loader:()=>a.e(55689).then(a.bind(a,781045))},small:{loader:()=>a.e(55689).then(a.bind(a,591039))},fill:{loader:()=>a.e(55689).then(a.bind(a,752767))},fillSmall:{loader:()=>a.e(55689).then(a.bind(a,644480))}},["lightning","bolt","electricity","power","energy"])},197821:(e,t,a)=>{a.d(t,{m:()=>r});a(242343);var o=a(163643);const r=(0,a(680369).wt)("stop",{viewBox:"0 0 20 20",svg:(0,o.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 19 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("rect",{y:"0.793945",width:"18.8027",height:"18.8027",rx:"9.40137",fill:"#37352F"}),(0,o.jsx)("rect",{x:"5.91028",y:"6.7041",width:"6.98255",height:"6.98255",rx:"0.783447",fill:"white"})]})})},222652:(e,t,a)=>{a.d(t,{l:()=>m});var o=a(242343),r=()=>a(237385),n=()=>a(803290),c=()=>a(174114),i=()=>a(870122),s=()=>a(653998),p=()=>a(11639),l=()=>a(356813),d=()=>a(103151),h=()=>a(906230),u=()=>a(907721),S=a(163643);const g=(0,s().YK)({tooltipLabel:{id:"aiInferenceTranscript.webSearchButton.tooltipLabel",defaultMessage:"Search web sources"}});function m(e){const{clientStore:t,disabled:a}=e,m=(0,r().v3)(),C=(0,s().tz)(),f=(0,n().K8)((()=>t.state.configForNewTranscripts),[t]),y=(0,o.useMemo)((()=>"researcher"===f.type&&f.useWebSearch),[f]),A=(0,o.useCallback)((()=>{if("researcher"===f.type){const e=!f.useWebSearch;t.setState({...t.state,configForNewTranscripts:{...f,useWebSearch:e}}),(0,p().u)({environment:m,event:{eventName:"clicked_ai_chat_toggle_web_search_button",eventProperties:{mode:f.type,enabled_web_search:e}}})}}),[t,f,m]),v=(0,c().IS)((e=>({icon:{fill:y?e.icon.uiBluePrimary:e.icon.grayPrimary,width:20,height:20}})),[y]);return(0,S.jsx)(d().A,{placement:u().W.Bottom,alignment:u().C.Start,renderTooltip:()=>(0,S.jsx)(s().sA,{...g.tooltipLabel}),render:e=>(0,S.jsx)(l().A,{disabled:a,...(0,h().A)(e,{onClick:A}),ariaLabel:C.formatMessage(g.tooltipLabel),icon:i().globeIcon,iconStyle:v.icon})})}},339496:(e,t,a)=>{a.d(t,{PF:()=>j,Wn:()=>x,Yo:()=>M});a(403517);var o=a(242343),r=()=>a(237385),n=()=>a(803290),c=()=>a(174114),i=()=>a(228138),s=()=>a(219530),p=()=>a(905184),l=()=>a(939499),d=()=>a(653998),h=()=>a(575015),u=()=>a(11639),S=()=>a(195095),g=()=>a(823829),m=()=>a(740180),C=()=>a(918135),f=()=>a(153100),y=()=>a(356813),A=()=>a(103151),v=()=>a(754697),I=()=>a(955885),b=a(163643);function x(e){const{loadAttachmentsData:{uploadFile:t}}=e,{isMobile:a}=(0,r().Y0)(),o=(0,d().tz)(),n=(0,I().A)(!0),c=o.formatMessage({id:"assistantRichTextInput.insertAttachment.button.tooltip",defaultMessage:"Attach file"});return(0,b.jsx)(A().A,{renderTooltip:()=>c,render:e=>(0,b.jsx)(y().A,{ariaLabel:c,icon:s().j,iconStyle:{width:a?19:16,height:a?19:16},style:{marginLeft:0,marginRight:0,width:(0,C().h6)(a),height:(0,C().h6)(a)},onClick:t,...e,...n})})}function M(e){const{loadAttachmentsData:{threadStore:t},clientStore:a}=e,r=(0,c().IS)((e=>({filePreviewWrapper:{width:"100%",paddingTop:4,paddingBottom:4,marginLeft:4}})),[]),i=(0,n().K8)((()=>a.getOrCreateClientAIChatThreadStore(t.id)),[a,t.id]),s=(0,n().K8)((()=>i.getStagedAttachmentUploadStoreIfExists()),[i]),p=(0,g().Jp)(s),l=(0,o.useCallback)((e=>{s&&(s.onDeleteFileUpload(e),i.unstageAttachmentInferenceTranscriptStep({fileId:e}))}),[s,i]);return p&&0!==p.length?(0,b.jsx)("div",{style:r.filePreviewWrapper,children:p.map((e=>{const{fileName:a}=e;return(0,b.jsx)(g().kp,{uploadProgress:e,permissionRecordOverride:t.pointer,onDeleteFile:"complete"===e.status?()=>l(e.fileUrl):void 0},a)}))}):null}function j(e){const{clientAiChatStore:t,threadStore:a,spaceStore:c,config:s,aiChatFeatureController:g}=e,C=(0,r().v3)(),y=(0,n().K8)((()=>{if(a&&t)return t.getOrCreateClientAIChatThreadStore(a.id)}),[t,a]),A=(0,n().K8)((()=>null==y?void 0:y.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore),[y]),I=(0,o.useCallback)((e=>{if(!y||!c)return;const t=y.getTemporaryAttachmentStagedDataOrInstantiate(),a=(0,v().Z1)({environment:C,table:l().mS,spaceId:c.id}),o=(0,i().jx)({uploadedFileData:e,id:a});y.stageAttachmentInferenceTranscriptStep({step:o}),t.stagedAttachmentUploadStore.onFileUploadCompleted(e.uploadIdentifier,e),(0,u().u)({environment:C,event:{eventName:"assistant_attachment_upload_successful",eventProperties:{content_type:o.contentType,source:"custom_upload",framework:"inference_transcript"}}})}),[y,C,c]),b=(0,S().X)({currentSpaceId:null==c?void 0:c.id,progressOverrides:{threadPointer:a&&c?{spaceId:c.id,table:p().To,id:null==a?void 0:a.id}:void 0,onSuccess:I,progressStore:A}}),x=(0,f().z)({threadClientStore:y,config:s,clientChatStore:t,aiChatFeatureController:g}),M=(0,d().tz)(),j=(0,o.useCallback)((e=>{0!==e.files.length&&(x.canUpload?b(e.files[0]):h().D6({label:M.formatMessage(m().E[x.reason])}))}),[x,M,b]);return{uploadAttachment:b,onPasteFiles:j}}},353509:(e,t,a)=>{a.d(t,{E:()=>r});a(242343);var o=a(163643);const r=(0,a(680369).wt)("microphone",{viewBox:"0 0 17 25",svg:(0,o.jsx)("path",{d:"M0.20752 12.0743C0.20752 13.5496 0.511882 14.853 1.12061 15.9845C1.72933 17.116 2.57438 18.0219 3.65576 18.7023C4.73714 19.3826 5.98324 19.7908 7.39404 19.9269V22.129H3.45166C3.17236 22.129 2.93245 22.2257 2.73193 22.4191C2.53141 22.6196 2.43115 22.8595 2.43115 23.1388C2.43115 23.4109 2.53141 23.6437 2.73193 23.837C2.93245 24.0376 3.17236 24.1378 3.45166 24.1378H13.313C13.5923 24.1378 13.8322 24.0376 14.0327 23.837C14.2332 23.6437 14.3335 23.4109 14.3335 23.1388C14.3335 22.8595 14.2332 22.6196 14.0327 22.4191C13.8322 22.2257 13.5923 22.129 13.313 22.129H9.37061V19.9269C10.7814 19.7908 12.0239 19.3826 13.0981 18.7023C14.1795 18.0219 15.0246 17.116 15.6333 15.9845C16.242 14.853 16.5464 13.5496 16.5464 12.0743V9.94739C16.5464 9.66809 16.4461 9.43176 16.2456 9.2384C16.0522 9.04504 15.8159 8.94836 15.5366 8.94836C15.2573 8.94836 15.0174 9.04504 14.8169 9.2384C14.6164 9.43176 14.5161 9.66809 14.5161 9.94739V11.9991C14.5161 13.2166 14.2583 14.2837 13.7427 15.2003C13.2271 16.1098 12.5109 16.8152 11.5942 17.3165C10.6776 17.8178 9.60693 18.0685 8.38232 18.0685C7.16488 18.0685 6.09424 17.8178 5.17041 17.3165C4.24658 16.8152 3.52686 16.1098 3.01123 15.2003C2.50277 14.2837 2.24854 13.2166 2.24854 11.9991V9.94739C2.24854 9.66809 2.14827 9.43176 1.94775 9.2384C1.74723 9.04504 1.50374 8.94836 1.21729 8.94836C0.94515 8.94836 0.708822 9.04504 0.508301 9.2384C0.30778 9.43176 0.20752 9.66809 0.20752 9.94739V12.0743ZM8.38232 15.8448C9.10563 15.8448 9.75016 15.6766 10.3159 15.34C10.8888 14.9962 11.3364 14.5236 11.6587 13.922C11.9881 13.3204 12.1528 12.6222 12.1528 11.8273V4.59778C12.1528 3.80286 11.9881 3.10461 11.6587 2.50305C11.3364 1.90149 10.8888 1.43241 10.3159 1.09583C9.75016 0.752075 9.10563 0.5802 8.38232 0.5802C7.65902 0.5802 7.0109 0.752075 6.43799 1.09583C5.87223 1.43241 5.42464 1.90149 5.09521 2.50305C4.76579 3.10461 4.60107 3.80286 4.60107 4.59778V11.8273C4.60107 12.6222 4.76579 13.3204 5.09521 13.922C5.42464 14.5236 5.87223 14.9962 6.43799 15.34C7.0109 15.6766 7.65902 15.8448 8.38232 15.8448Z"})})},403870:(e,t,a)=>{a.d(t,{K:()=>n});var o=()=>a(13769),r=()=>a(84543);function n(e){var t;let{environment:a,spaceViewStore:n}=e;const c="manual"===(null===(t=n.getSettings())||void 0===t?void 0:t.agent_perist_strategy)?"auto_accept":"manual";r().createAndCommit({userAction:"agentPersistenceHelpers.togglePersistStrategy",environment:a,canUndo:!1,perform:e=>{o().AG(n,e,{agent_perist_strategy:c})}})}},503691:(e,t,a)=>{a.d(t,{M:()=>i});var o=a(242343),r=()=>a(237385),n=()=>a(975392),c=()=>a(119148);function i(e){const{textValue:t,isEnabled:a,clientStore:i,configs:s}=e,p=(0,r().v3)(),l=(0,o.useCallback)((()=>{a&&t&&!i.state.userSelectedConfig&&(0,c().xh)({environment:p,clientStore:i,message:t,configs:s})}),[t,i,s,p,a]),d=(0,o.useMemo)((()=>(0,n().sg)(l,200)),[l]);(0,o.useEffect)((()=>()=>{d.cancel()}),[d]),(0,o.useEffect)((()=>{a&&d()}),[t,a,d])}},536505:(e,t,a)=>{a.d(t,{l:()=>o});const o=(0,a(680369).xh)("arrowChevronSingleDown",{default:{loader:()=>a.e(95737).then(a.bind(a,633427))},small:{loader:()=>a.e(95737).then(a.bind(a,663821))},fill:{loader:()=>a.e(95737).then(a.bind(a,267521))},fillSmall:{loader:()=>a.e(95737).then(a.bind(a,166650))}},["chevron","down","arrow","direction","downward"])},895644:(e,t,a)=>{a.d(t,{_:()=>R});a(362833),a(725707),a(107652),a(324989),a(403517);var o=a(242343),r=()=>a(237385),n=()=>a(803290),c=()=>a(174114),i=()=>a(897376),s=()=>a(168163),p=()=>a(582226),l=()=>a(145017),d=()=>a(939499),h=()=>a(73751),u=()=>a(653998),S=()=>a(23371),g=()=>a(76394),m=()=>a(145046),C=()=>a(759625),f=()=>a(84543),y=()=>a(321185),A=()=>a(286270),v=()=>a(206799),I=()=>a(701270),b=()=>a(286404),x=()=>a(951540),M=()=>a(291518);a(333225),a(494367),a(516262),a(573119),a(240480),a(950443),a(619601);class j{constructor(){this.diffCache=void 0,this.appliedSteps=void 0,this.diffCache=new(a(371807).A)({name:"AgentCaches.diffCache",isTemporaryData:!0}),this.appliedSteps=new Set}ensureDefaultCacheOverride(e){const t=e.defaultRecordCache.inMemoryRecordCache;t.cacheUsingThisInstanceAsAnOverride||t.addCacheOverride(this.diffCache)}removeDefaultCacheOverride(e){this.clear();e.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.diffCache)}clear(){this.diffCache.clearCache(),this.appliedSteps.clear()}commitTransaction(e){const{transactionActions:t,environment:a,perform:o,...r}=e,n=this;t.createAndCommit({environment:a,perform(e){o(e,n.diffCache)},canUndo:!0,...r})}markStepAsApplied(e){this.appliedSteps.add(e)}isStepApplied(e){return this.appliedSteps.has(e)}}var w=()=>a(485966),P=()=>a(493065),k=()=>a(413871),T=()=>a(615705),_=()=>a(403870),N=()=>a(165786),z=()=>a(442888),B=()=>a(662861),F=a(163643);function R(e){let{clientStore:t}=e;const a=(0,c().IS)((e=>({container:{padding:"8px 8px 20px 12px",backgroundColor:"dark"===e.mode?"rgba(255, 255, 255, 0.04)":"rgba(0, 0, 0, 0.04)",borderTopLeftRadius:12,borderTopRightRadius:12,position:"relative",top:12,margin:"0 8px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",border:`1px solid ${e.stroke.secondary}`,borderBottom:"none",gap:12,minWidth:0},autoAcceptContainer:{padding:"8px 8px 20px 12px",backgroundColor:e.accentColors.uiBlue[700],borderTopLeftRadius:12,borderTopRightRadius:12,position:"relative",top:12,margin:"0 8px",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:12,minWidth:0},buttonContainer:{display:"flex",flexShrink:0,flexDirection:"row",gap:5},label:{flex:"1 1 0%",minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",userSelect:"none"},button:{height:28,borderColor:e.text.contrastPrimary}})),[]),p=(0,y().useCurrentThreadStore)(),l=(0,n().K8)((()=>null!=p&&p.id?t.getOrCreateClientAIChatThreadStore(p.id):void 0),[p,t]),h=(0,n().K8)((()=>(0,T().Uu)({threadStore:p,clientStore:t})),[p,t]),g=(0,r().v3)(),M=(0,o.useMemo)((()=>new j),[]),[R,K]=(0,o.useState)(!1),U=(0,n().O$)(w().AppStoreCurrentSpaceStore),V=(0,n().K8)((()=>w().default.state.currentUserStore),[]),E=(0,n().K8)((()=>(0,z().Ft)({threadStore:p,clientStore:t})),[p,t]),G=(0,o.useCallback)((async()=>{if(p&&U&&V){K(!0);try{const e=await async function(e,t){const a=t.flatMap((t=>((0,i().rQ)(t)??[]).map((t=>new(k().pm)({environment:e,pointer:t.pointer,path:t.path})))));return await(0,S().lX)(a,4,(e=>e.load())),a.every((e=>e.canEditCollection()))}(g,h);if(!e)return void m().f1((0,F.jsx)(u().sA,{id:"agentUnsavedChanges.saveError",defaultMessage:"You don’t have permission to save these changes"}));await P().transactionQueue.drain(),M.removeDefaultCacheOverride(g),f().createAndCommit({userAction:"AgentUnsavedChangesDockedCard.handleSave",environment:g,canUndo:!0,perform:e=>{for(const t of h){for(const o of(0,i().XS)(t)){if(o.persistOnServer)continue;const t=D(o.operation);O({environment:g,operation:t,recordCache:g.defaultRecordCache.inMemoryRecordCache,transaction:e})}const a=k().XV.createChildStore(p,{table:d().mS,id:t.id,spaceId:U.id});for(const t of a.getThreadOperationStores())C().zv({store:t,data:{userAction:"accept"},transaction:e})}(0,N().Vn)({threadStore:p,environment:g,spaceStore:U,userStore:V,addSteps:[(0,B().r6)({environment:g,spaceStore:U,userAction:"accept"})],transaction:e}),e.postSubmitCallbacks.push((()=>{null==l||l.setState({...l.state,temporarySteps:[]})}))}})}finally{K(!1)}}}),[p,U,V,M,g,h,l]),L=(0,o.useCallback)((()=>{p&&U&&V&&f().createAndCommit({userAction:"AgentUnsavedChangesDockedCard.handleCancel",environment:g,canUndo:!0,perform:e=>{for(const t of h){const a=k().XV.createChildStore(p,{table:d().mS,id:t.id,spaceId:U.id});for(const t of a.getThreadOperationStores())C().zv({store:t,data:{userAction:"reject"},transaction:e})}(0,N().Vn)({threadStore:p,environment:g,spaceStore:U,userStore:V,addSteps:[(0,B().r6)({environment:g,spaceStore:U,userAction:"reject"})],transaction:e}),e.postSubmitCallbacks.push((()=>{null==l||l.setState({...l.state,temporarySteps:[]})}))}})}),[p,h,g,U,V,l]),W=(0,n().O$)(w().default),H=(0,n().K8)((()=>{var e;return(null===(e=W.currentSpaceViewStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.agent_perist_strategy)??"manual"}),[W.currentSpaceViewStore]);(0,o.useEffect)((()=>{0!==h.length?(M.ensureDefaultCacheOverride(g),M.commitTransaction({environment:g,userAction:"AgentUnsavedChangesDockedCard.applyOperations",transactionActions:f(),perform:(e,t)=>{for(const a of h)if(!M.isStepApplied(a.id)){for(const o of(0,i().rQ)(a)??[])O({environment:g,operation:o,recordCache:t,transaction:e});M.markStepAsApplied(a.id)}}})):P().transactionQueue.drain().then((()=>{M.removeDefaultCacheOverride(g)}))}),[M,g,G,h]);const $=(0,o.useCallback)((()=>{W.currentSpaceViewStore&&(0,_().K)({environment:g,spaceViewStore:W.currentSpaceViewStore})}),[W.currentSpaceViewStore,g]);return"auto_accept"===H?(0,F.jsxs)("div",{style:a.autoAcceptContainer,children:[(0,F.jsx)(v().Q,{iconGroup:s().b,variantName:"fill",colorName:"contrast"}),(0,F.jsx)(I().D,{styleName:"UIRegular-14px/Regular",colorName:"contrastPrimary",customStyles:a.label,children:(0,F.jsx)(u().sA,{id:"agentUnsavedChanges.autoAcceptChangesCardTitle",defaultMessage:"Auto-accept all changes"})}),(0,F.jsx)("div",{style:a.buttonContainer,children:(0,F.jsx)(b().A,{style:a.button,onClick:$,size:"sm",children:(0,F.jsx)(I().D,{styleName:"UIRegular-14px/Regular",colorName:"contrastPrimary",children:(0,F.jsx)(u().sA,{id:"agentUnsavedChanges.disableAutoAccept",defaultMessage:"Disable"})})})})]}):0===h.length?null:(0,F.jsxs)("div",{style:a.container,children:[(0,F.jsx)(I().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",customStyles:a.label,children:`${h.length} unsaved ${1===h.length?"change":"changes"}`}),(0,F.jsxs)("div",{style:a.buttonContainer,children:[(0,F.jsx)(A().E,{style:a.button,onClick:L,disabled:E||R,size:"sm",children:(0,F.jsx)(u().sA,{id:"agentUnsavedChanges.discardButton",defaultMessage:"Discard"})}),(0,F.jsx)(x().A,{style:a.button,onClick:G,disabled:E||R,size:"sm",children:(0,F.jsx)(u().sA,{id:"agentUnsavedChanges.saveButton",defaultMessage:"Save"})})]})]})}function O(e){const{environment:t,operation:a,transaction:o,recordCache:r}=e;if((0,h().ph)(a))(0,M().e)({environment:t,operation:a,transaction:o,inMemoryRecordCache:r});else if(a.pointer.table===l().ev)if("set"===a.command&&0===a.path.length){const e=C().Wv({environment:t,id:a.pointer.id,type:a.args.type,properties:a.args.properties,format:a.args.format,permissions:a.args.permissions,createdById:a.args.created_by_id,createdTime:a.args.created_time,createdByTable:a.args.created_by_table,inMemoryRecordCache:r??t.defaultRecordCache.inMemoryRecordCache,spaceId:a.args.space_id,transaction:o});f().applyOperation({store:e,operation:p().op.update({pointer:e.pointer,path:[],args:{parent_table:a.args.parent_table,parent_id:a.args.parent_id,alive:!0}}),transaction:o})}else(0,M().e)({environment:t,operation:a,transaction:o,inMemoryRecordCache:r});else if((0,p().$Y)(a)||(0,p().mP)(a)){const e=new(k().pm)({environment:t,pointer:a.pointer,path:a.path,recordStoreOptions:{inMemoryRecordCache:r}});f().applyOperation({store:e,operation:a,transaction:o})}else(0,g().HB)(a)}function D(e){return e.pointer.table===l().ev&&"set"===e.command&&e.args.ignore_block_count?{...e,args:{...e.args,ignore_block_count:void 0}}:e}},999360:(e,t,a)=>{a.d(t,{d:()=>G});a(362833),a(333225),a(494367),a(516262),a(573119),a(240480),a(950443),a(619601),a(725707),a(491955),a(403517);var o=a.n(a(567012)),r=a(242343),n=()=>a(237385),c=()=>a(803290),i=()=>a(174114),s=()=>a(536505),p=()=>a(547797),l=()=>a(32194),d=()=>a(653998),h=()=>a(76394),u=()=>a(107640),S=()=>a(526927),g=()=>a(36704),m=()=>a(651429),C=()=>a(741329),f=()=>a(209684),y=()=>a(535906),A=()=>a(273520),v=()=>a(401382),I=()=>a(966789),b=()=>a(935091),x=()=>a(858023),M=()=>a(206799),j=()=>a(701513),w=()=>a(88271),P=()=>a(640979),k=()=>a(289988),T=()=>a(863969),_=()=>a(622286),N=()=>a(162339),z=()=>a(485966),B=()=>a(133926),F=()=>a(165786),R=()=>a(602690),O=a(163643);const D=250,K=325,U=(0,d().YK)({inputPlaceholder:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.inputPlaceholder",defaultMessage:"Find or use knowledge in…"}}),V=[{type:"everything"},{type:"notion"},{type:"slack"},{type:"google-drive"},{type:"github"},{type:"gmail"},{type:"jira"},{type:"sharepoint"},{type:"microsoftTeams"},{type:"linear"},{type:"helpdocs"}],E=(0,d().YK)({everything:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.everythingFuzzyName",defaultMessage:"All sources I can access everything"},notion:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.workspaceFuzzyName",defaultMessage:"{workspaceName} Notion workspace"},helpdocs:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.helpdocsFuzzyName",defaultMessage:"Notion Help Center"},slack:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.slackFuzzyName",defaultMessage:"Slack"},"google-drive":{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.googleDriveFuzzyName",defaultMessage:"Google Drive"},github:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.githubFuzzyName",defaultMessage:"GitHub"},gmail:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.gmail",defaultMessage:"Gmail"},jira:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.jiraFuzzyName",defaultMessage:"Jira"},microsoftTeams:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.microsoftTeamsFuzzyName",defaultMessage:"Microsoft Teams"},sharepoint:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.sharepointFuzzyName",defaultMessage:"SharePoint and OneDrive"},linear:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.linearFuzzyName",defaultMessage:"Linear"},teamspace:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.teamspaceFuzzyName",defaultMessage:"Teamspace"},page:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.pageFuzzyName",defaultMessage:"Page"},collection:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.collectionFuzzyName",defaultMessage:"Database"}});function G(e){const{clientStore:t,disabled:a,threadStore:o}=e,n=(0,c().K8)((()=>t.state.configForNewTranscripts),[t]),p=(0,r.useMemo)((()=>"search"===n.type?n.scopeForNextSearch:"researcher"===n.type?n.searchScope:void 0),[n]),l=(0,i().IS)((e=>({button:{color:e.text.secondary,gap:6,fontSize:12}})),[]);return(0,O.jsx)(A().Ay,{popupType:A().z7.Popup,originGap:2,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.End,renderOrigin:e=>(0,O.jsxs)(f().p,{...e,size:"sm",style:l.button,disabled:a,children:[(0,O.jsx)(L,{currentSearchScope:p}),(0,O.jsx)(H,{currentSearchScope:p}),(0,O.jsx)(M().Q,{iconGroup:s().l,variantName:"small",colorName:"lightGrayPrimary"})]}),render:e=>(0,O.jsx)($,{threadStore:o,clientStore:t,buttonPopupParent:e,currentSearchScope:p})})}function L(e){const{currentSearchScope:t}=e,a=Q(),o=(0,r.useMemo)((()=>{const e=[];if(t)if("everything"===t.type){for(const t of a)if("everything"!==t.type){const a=(0,R().vd)(t);a&&e.push(a)}}else{const a=(0,R().vd)(t);a&&e.push(a)}return(0,h().EI)(e)?e:["notion"]}),[t,a]),n=Math.min(o.length,2);return(0,O.jsx)(R().hC,{connectors:o,maxBubbles:n,iconSize:12,bubbleStyles:{width:16,height:16}})}const W=(0,d().YK)({everything:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.everythingButtonContent",defaultMessage:"All sources"},notion:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.notionButtonContent",defaultMessage:"In Notion"},helpdocs:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.helpdocsButtonContent",defaultMessage:"In Notion Help Center"},slack:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.slackButtonContent",defaultMessage:"In Slack"},"google-drive":{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.googleDriveButtonContent",defaultMessage:"In Google Drive"},gmail:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.gmailButtonContent",defaultMessage:"In Gmail"},github:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.githubButtonContent",defaultMessage:"In GitHub"},jira:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.jiraButtonContent",defaultMessage:"In Jira"},microsoftTeams:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.microsoftTeamsButtonContent",defaultMessage:"In Microsoft Teams"},sharepoint:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.sharepointButtonContent",defaultMessage:"In SharePoint"},linear:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.linearButtonContent",defaultMessage:"In Linear"},default:{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.defaultButtonContent",defaultMessage:"Notion AI"},"anthropic-sonnet-3.7":{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.anthropicSonnet37ButtonContent",defaultMessage:"Anthropic Claude 3.7"},"openai-gpt-4.1":{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.openaiGpt41ButtonContent",defaultMessage:"OpenAI GPT-4.1"}});function H(e){const{currentSearchScope:t}=e,a=(0,c().O$)(z().AppStoreCurrentSpaceStore),o=(0,d().tz)(),r=(0,n().v3)(),i=(0,c().K8)((()=>{if(!t||!a)return;const{scopeTitle:e,dontShowPrepositionalCopy:n}=(0,m().tu)({environment:r,searchScope:t,currentSpaceStore:a,intl:o});return n?(0,O.jsx)("span",{children:e}):(0,O.jsx)(d().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.otherButtonContent",defaultMessage:"In {scopeTitle}",values:{scopeTitle:e}})}),[t,a,o,r]);if(t){if((0,h().O)(W,t.type))return(0,O.jsx)(d().sA,{...W[t.type]});if(i)return i}return(0,O.jsx)(d().sA,{...W.everything})}function $(e){const{clientStore:t,buttonPopupParent:a,currentSearchScope:i,threadStore:s}=e,p=(0,d().tz)(),h=(0,n().v3)(),[u,m]=(0,r.useState)(""),C=(0,c().K8)((()=>{var e;return(null===(e=z().default.state.currentSpaceStore)||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getRenderTitle())??""}),[]),f=(0,r.useCallback)((e=>{const o=function(e){return"teamspace"===e.type?{type:"teamspace",teamId:e.teamStore.id}:"page"===e.type?{type:"page",pageId:e.pageStore.id}:"collection"===e.type?{type:"collection",pageId:e.pageStore.id,collectionId:e.collectionId}:"site"===e.type?{type:"site",siteId:e.siteStore.id}:e}(e),r="researcher"===t.state.configForNewTranscripts.type?{...t.state.configForNewTranscripts,searchScope:o}:{type:"search",scopeForNextSearch:o};t.setState({...t.state,userSelectedConfig:!0,configForNewTranscripts:r}),(0,F().kh)({threadStore:s,config:r,environment:h}),a.close()}),[t,a,s,h]),A=Q(),M=(0,r.useMemo)((()=>A.filter((e=>{const t=p.formatMessage(E[e.type],{workspaceName:C});return o().test(u,t)}))),[u,p,A,C]),j=(0,c().O$)(z().AppStoreCurrentSpaceViewStore),T=(0,c().K8)((()=>j?j.getTeamsStores().map((e=>({type:"teamspace",teamStore:e}))):[]),[j]),_=(0,c().K8)((()=>T.filter((e=>{var t;const a=(null===(t=e.teamStore.getModel())||void 0===t?void 0:t.getRenderTitle())??"",r=`${p.formatMessage(E.teamspace)} ${a}`;return o().test(u,r)}))),[u,T,p]),{results:B,isResultsLoading:R}=(0,k().W)({source:"ai_chat_search_scope_menu",query:u,limit:20,type:l().Vz.BlocksInSpace,filters:{requireEditPermissions:!1,excludeTemplates:!0},options:{disable:!u}}),V=(0,N().A)(R,400,0),G=(0,c().K8)((()=>B.map((e=>{var t;const a=e.store,o=null===(t=a.getCollectionPointer())||void 0===t?void 0:t.id;return a.isCollectionView()&&o?{type:"collection",pageStore:a,collectionId:o}:{type:"page",pageStore:a}}))),[B]),L=(0,c().K8)((()=>{const e={sections:[],addSection(e){e&&this.sections.push(e)}};return u?(e.addSection(Y({filteredEligibleSearchScopes:M,currentSearchScope:i,handleSelectScope:f})),e.addSection(function(e){const{filteredTeamSpaceScopes:t,currentSearchScope:a,handleSelectScope:o}=e;if(0===t.length)return;return{key:"teamspace-results-section",render:e=>(0,O.jsx)(w().A,{...e,title:(0,O.jsx)(d().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.teamspaceResultsSectionTitle",defaultMessage:"Teamspaces"})}),items:t.map(((e,t)=>({key:(0,g().S)(e,t),render:t=>(0,O.jsx)(X,{...t,item:e,currentSearchScope:a}),action:()=>{o(e)}})))}}({filteredTeamSpaceScopes:_,currentSearchScope:i,handleSelectScope:f})),e.addSection(function(e){const{filteredBlockScopes:t,currentSearchScope:a,handleSelectScope:o}=e;if(0===t.length)return;return{key:"block-results-section",render:e=>(0,O.jsx)(w().A,{...e,title:(0,O.jsx)(d().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.blockResultsSectionTitle",defaultMessage:"Pages"})}),items:t.map(((e,t)=>({key:(0,g().S)(e,t),render:t=>(0,O.jsx)(X,{...t,item:e,currentSearchScope:a}),action:()=>{o(e)}})))}}({filteredBlockScopes:G,currentSearchScope:i,handleSelectScope:f})),0===e.sections.length&&e.addSection({key:"no-results-section",render:e=>(0,O.jsx)(w().A,{...e}),items:[{key:"no-results-item",render:e=>(0,O.jsx)(y().A,{...e,title:(0,O.jsx)(d().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.noResultsItemTitle",defaultMessage:"No results"})}),action:()=>{}}]})):(e.addSection(Y({filteredEligibleSearchScopes:M,currentSearchScope:i,handleSelectScope:f})),e.addSection(function(e){const{filteredTeamSpaceScopes:t,currentSearchScope:a,handleSelectScope:o}=e;if(0===t.length)return;return{key:"outliner-teamspace-scopes-section",render:e=>(0,O.jsx)(w().A,{...e,title:(0,O.jsx)(d().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.outlinerTeamspaceScopesSectionTitle",defaultMessage:"Select a team or page"})}),items:t.map(((e,t)=>({key:(0,g().S)(e,t),render:()=>(0,O.jsx)(S().Q,{item:e,onClick:e=>{o(e)},showToggle:!0,currentSearchScope:a}),action:()=>{}})))}}({filteredTeamSpaceScopes:_,currentSearchScope:i,handleSelectScope:f}))),e.sections}),[u,M,_,G,i,f]);return(0,O.jsx)(b().A,{menuType:P().gu.Popup,width:D,maxHeight:K,footer:(0,O.jsx)(J,{buttonPopupParent:a}),children:(0,O.jsx)(x().Ay,{type:x().Oh.Vertical,initialFocus:void 0,sections:[{key:"input-section",render:e=>(0,O.jsx)(w().A,{...e}),items:[{key:"input",render:e=>(0,O.jsx)(v().Ay,{...e,placeholder:p.formatMessage(U.inputPlaceholder),value:u,onChange:e=>{m(e.target.value)},inputRight:V&&(0,O.jsx)(I().A,{style:{marginRight:2}})}),action:()=>{}}]},...L]})})}function Q(){const e=(0,c().K8)((()=>new Set((0,C().wd)())),[]);return(0,c().K8)((()=>V.filter((t=>"everything"===t.type||"notion"===t.type||"helpdocs"===t.type||("slack"===t.type||"github"===t.type||"jira"===t.type||"gmail"===t.type||"sharepoint"===t.type||"linear"===t.type||"microsoftTeams"===t.type?e.has(t.type):"google-drive"===t.type?e.has("google_drive"):(0,h().HB)(t))),[])),[e])}function Y(e){const{filteredEligibleSearchScopes:t,currentSearchScope:a,handleSelectScope:o}=e;if(0!==t.length)return{key:"suggested-scopes-section",render:e=>(0,O.jsx)(w().A,{...e}),items:t.map((e=>({key:e.type,render:t=>(0,O.jsx)(X,{...t,item:e,currentSearchScope:a}),action:()=>{o(e)}})))}}const X=r.forwardRef(((e,t)=>{const{item:o,currentSearchScope:n,...c}=e,i=(0,r.useMemo)((()=>!!n&&(0,m().I9)({scopeMenuItem:o,currentSearchScope:n})),[n,o]);return"page"===o.type||"collection"===o.type?(0,O.jsx)(j().A,{...c,ref:t,store:o.pageStore}):"teamspace"===o.type?(0,O.jsx)(j().A,{...c,ref:t,store:o.teamStore}):(0,O.jsx)(y().A,{...c,ref:t,icon:(0,O.jsx)(a(789915).Ay,{item:o}),title:(0,O.jsx)(a(807900).A,{item:o}),isChecked:i})}));function J(e){const{buttonPopupParent:t}=e,a=(0,n().v3)(),o=(0,T().O)(),i=(0,_().X)("notion_ai_workspace_settings"),s=(0,B()._X)({name:"ai_connectors",spaceId:o,userId:a.currentUser.id}),l=(0,c().K8)((()=>(0,C().Nr)()),[]),h=(0,r.useCallback)((()=>{(0,u().p)({environment:a,connector:"generic",analyticsFrom:"ai_chat_scoped_search_menu",connectorsFeatureAvailability:s}),t.close()}),[t,s,a]);return i&&0!==l.length?(0,O.jsx)(w().A,{topBorderExtendToEdge:!0,children:(0,O.jsx)(y().A,{focused:!1,onClick:h,icon:(0,O.jsx)(M().Q,{iconGroup:p().h,variantName:"small"}),title:(0,O.jsx)(d().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.getAiConnectorsFooterTitle",defaultMessage:"Connect apps"}),right:(0,O.jsx)(R().hC,{connectors:l,maxBubbles:2,iconSize:12,bubbleStyles:{width:16,height:16}})})}):null}X.displayName="ScopedSearchMenuItem"}}]);