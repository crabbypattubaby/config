"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[34208,90871],{44250:(e,t,a)=>{function o(e){return!(!e||"askUserToPick"in e)}function n(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}a.d(t,{DK:()=>n,K$:()=>o,j6:()=>i})},358920:(e,t,a)=>{a.d(t,{$Y:()=>u,AF:()=>s,Px:()=>m,Up:()=>d,dY:()=>p});a(725707),a(491955);var o=()=>a(16791),n=()=>a(758611),i=()=>a(809811),r=()=>a(927685),c=()=>a(561349),l=()=>a(413871);async function s(e,t){const a=await c().k.load();return e.filter((e=>{const o=e.getCopiedFromPointer();return Boolean(o&&a.isTemplate(o)&&Boolean(t&&t(o.id)))}))}function d(e){const t=window.location.href;return i().O$(t,{tg:e.templateGalleryItem})}function p(e){let t;return e instanceof l().$x?t=e.getBlockId():"type"in e?(e.type,t=e.template.rootId):t=e.rootId,t}function m(e){const t=o().locale&&"en-us"!==o().locale.toLocaleLowerCase()?`/${o().locale.toLowerCase()}`:"",a=void 0!==e?`${t}${n().JZ.templates}/${encodeURIComponent(e)}`:`${t}${n().JZ.templates}`;return`${r().A.domainBaseUrl}${a}`}function u(e){if(!e)return"";try{const a=JSON.parse(e);if("text"===a.content[0].content[0].nodeType){var t;const e=(null==a||null===(t=a.content)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.content)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.value)||"";return e.replace(/^(#{2,6})\s+/gm,"# ")}}catch(a){return""}}},533639:(e,t,a)=>{a.d(t,{p:()=>o});class o extends(()=>a(998969))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}},649334:(e,t,a)=>{a.r(t),a.d(t,{accept:()=>G,close:()=>L,createTemplateInstance:()=>K,loadAndDuplicatePageTemplate:()=>F,openWithItem:()=>$,previewItem:()=>V,setTemplateVisited:()=>J});a(610931);var o=()=>a(712437),n=()=>a(502140),i=()=>a(329911),r=()=>a(519423),c=()=>a(220574),l=()=>a(145017),s=()=>a(26907),d=()=>a(541341),p=()=>a(204132),m=()=>a(818369),u=()=>a(191756),v=()=>a(425447),g=()=>a(134549),f=()=>a(281885),_=()=>a(137476),S=()=>a(477784),b=()=>a(378219),I=()=>a(197849),T=()=>a(358920),k=()=>a(633990),y=()=>a(667801),w=()=>a(485966),h=()=>a(836331),C=()=>a(134915),P=()=>a(869537),A=()=>a(413871),M=()=>a(352211),B=()=>a(149078),E=()=>a(759625),R=()=>a(349947),U=()=>a(360378),D=()=>a(163875),N=()=>a(84543),x=()=>a(421378);const z="LastViewedTemplateId",O=(0,a(653998).YK)({clientCopyError:{defaultMessage:"Client copy could not be created.",id:"spaceActions.createGettingStartedPage.copyNotCreated.error"}});function $(e){const{environment:t,item:a,createNewPage:o,isPrivate:n,disablePointerEvents:r,isCheckout:c=!1}=e;U().IU({environment:t}),P().A.setState({open:!0,item:a,createNewPage:o,isPrivate:n,isLoading:!1,disablePointerEvents:r,isCheckout:c}),i().K.set({userId:t.currentUser.id,key:z,value:a.rootId}),M().oO(t,{template_id:(0,T().dY)(a),from:o?"sidebar":"newPage"})}function V(e){let{templateItem:t,currentUserId:a}=e;const o=P().A.state.item;P().A.setState({...P().A.state,item:t}),o!==t&&i().K.set({userId:a,key:z,value:t.rootId})}function L(e){P().A.setState({item:P().A.state.item,open:!1}),U().IU({environment:e})}async function G(e){const{acceptFrom:t,item:a,environment:n,spaceStore:i,initializeStore:r,...c}=e;P().A.state.open&&P().A.setState({...P().A.state,isLoading:!0}),h().default.checkGate({gateName:"mobile_keep_template_gallery_open"})&&C().A.state.open&&C().A.setState({open:!1});const l=r?{...{...c,item:a,environment:n,spaceStore:i},initializeStore:r,type:"inExistingStore",useMinimalTemplates:!1}:{...{...c,item:a,environment:n,spaceStore:i},type:"inSpace",useMinimalTemplates:!1,isOnboarding:!1};let s=!1;const d=Date.now();let p;try{var m;p=await K(l),s=!0;const e=null===(m=w().default.state.mainEditorCurrentBlockStore)||void 0===m?void 0:m.id;!p||e&&e===p.id||u().uK({environment:n,store:p,pageVisitSource:o().y8.Create,showMoveTo:!0}),L(n),n.device.isMobile&&(y().close(),C().A.setState({open:!1}))}finally{var v;const o=Date.now()-d,r=e.initializeStore?b().Uo(e.initializeStore):void 0,c=e.initializeStore?!r:e.isPrivate;M().BX(n,{destination:c?"private":"team",template_block_id:a.rootId,template_duplication_duration_ms:o,team_id:null==r?void 0:r.id,created_page_id:null===(v=p)||void 0===v?void 0:v.id}),M().hB(n,{from:"mobileApp",success:s,context:t,template_block_id:a.rootId,target_space_id:i.id,template_duplication_duration_ms:o,public_template_name:a.name,template_id:a.id})}}async function F(e){const{environment:t,initializeStore:a,item:o,isPrivate:n,useMinimalTemplates:i,spaceStore:l,spaceViewStore:s}=e,d=i?o.rootId:o.previewRootId,p=await m().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:d,spaceId:o.spaceId},shallow:!1},headers:(0,r().WS)({spaceId:o.spaceId})});let u;"success"===p.type&&(u=c().RecordMapWithRole.create(p.data.subtreeRecordMap));const f="pageTemplateModalActions.loadAndDuplicatePageTemplate",{performResult:b}=N().createAndCommit({userAction:f,environment:t,canUndo:!0,perform:e=>{const o=a||D().IT({environment:t,spaceStore:l,spaceViewStore:s,isPrivate:n,loading:!0,transaction:e});R()._O({environment:t,inMemoryRecordCache:o.inMemoryRecordCache,recordMap:u,debugSource:f});const i=(0,g().loadLocalSubtree)(t,{blockId:d,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0}).recordMap;if(!i)throw new Error(S().A.getIntl().formatMessage(O.clientCopyError));return v().localDuplicate({environment:t,sourceBlockId:d,targetBlockPointer:o.pointer,sourceBlockSubtree:i,targetInMemoryRecordCache:o.inMemoryRecordCache,transaction:e,options:{deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}}),o}}),I=b.getCollectionPointer();return(0,_().u4)({environment:t,event:{eventName:"create_app_templates",eventProperties:{target_page_ids:[b.id],template_label:o.name,collection_ids:I?[I.id]:[]}}}),b}async function K(e){var t;const{environment:a,item:o,useRecordCache:i,useMinimalTemplates:r,spaceStore:c,isOnboarding:u,from:v,type:g,initializeStore:_,teamStore:S,onSuccess:b,onError:T,isEmailShared:y}=e,C=i&&!r?o.previewRootId:o.rootId,P={id:C,table:l().ev,spaceId:o.spaceId},M=u?"onboarding":null!==(t=o.marketplaceTemplateMetadata)&&void 0!==t&&t.isMobileMarketplaceTemplate?"mobile_app":"homepage_team"===v?"team_home":void 0,E=await(0,f().oC)(a,C),R=M?{context:"",source:M,isListedTemplate:Boolean(E),isFirstPartyPaidTemplate:void 0!==E&&(0,d().Z1)(E),isEmailShared:y}:void 0;let U=!1,z=c;const O=new(A().Bv)(a,{table:l().ev,id:P.id,spaceId:P.spaceId});if("inExistingStore"===g&&_){if(z=_,_.isEmptyPage()){const e=_.getParentStore();e&&e.canEdit()&&("block"===e.table||"space"===e.table||"team"===e.table)&&(U=!0,z=e)}}else"inTeam"===g&&S&&(z=S);const $=h().default.checkGate({gateName:"use_initialize_page_template_api_onboarding"}),V=h().default.checkGate({gateName:"use_local_duplication_for_onboarding"}),L=h().default.checkGate({gateName:"use_duplicate_block_sync"});if("onboarding"===M&&$){const e=await async function(e){const{environment:t,item:a,spaceStore:o,teamStore:n,type:i,from:r,sourceBlock:c,onSuccess:l,onError:s}=e,d=w().default.state.currentUserRootStore,p=await(0,k().Pl)();if(!d)return;const u=(0,I().H)({spaceStore:o,userId:d.id,environment:t});if(!u)return;const{serverCommitResult:v,performResult:{pageStore:g}}=N().createAndCommit({userAction:"pageTemplateModalActions.createTemplateInstance",environment:t,canUndo:!0,perform:e=>{let c;return c="inTeam"===i&&n&&r?p({environment:t,spaceStore:o,spaceViewStore:u,teamStore:n,from:r,loading:!0,appendOrPrepend:"append",transaction:e}):D().IT({environment:t,spaceStore:o,spaceViewStore:u,isPrivate:!0,loading:!0,transaction:e}),J({item:a,spaceViewStore:u,transaction:e}),{pageStore:c}}});await v;const f=await m().callApi({eventName:"initializePageTemplate",environment:t,data:{sourceBlock:c,targetBlock:{id:g.id,table:"block",spaceId:o.id},isOnboarding:!0}});"failed"===f.type?null==s||s(g):null==l||l(g);return g}({environment:a,item:o,spaceStore:c,teamStore:S,type:"inTeam"===g?"inTeam":"inSpace",from:v,sourceBlock:P,onSuccess:b,onError:T});return e}R||n().log({level:"warning",from:"pageTemplateModalActions.createTemplateInstance",type:"templateInstallationMetadataNotSet",data:{miscDataToConvertToString:{template_id:o.id,template_block_id:o.rootId,target_space_id:c.id,public_template_name:o.name,isOnboarding:u,from:v,type:g}}});const G=h().default.checkGate({gateName:"enable_local_duplication_for_non_marketplace_templates"}),F=!(0,s().Fe)(null==R?void 0:R.source)&&G||V&&"onboarding"===M,K="onboarding"===M&&L,Y=await B().Jx({environment:a,store:O,newParentStore:z,addCopyName:!1,duplicateOnlyCollectionSchema:!1,unlockPage:!0,templateInstallationMetadata:R,shouldAttemptServerBackedLocalDuplication:F,shouldUseSynchronousDuplicationAPI:K,from:v??(u?"onboarding":void 0)});if(Y){if(p().Q.isSuccess(Y)&&Y.value.length>0){const e=Y.value[0];if(U&&_){const t=_;try{await t.waitUntil((()=>t.isDefined()));const{serverCommitResult:o}=N().createAndCommit({userAction:"pageTemplateModalActions.initializePageTemplateInPlace",environment:a,canUndo:!0,perform:e=>{x().oD({environment:a,blocks:[t],transaction:e,permanentlyDelete:!0})}});return await o,e}catch(W){n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplateInPlace",type:"transactionError",data:{miscDataToConvertToString:{error:W}}})}}return null==b||b(e),e}return null==T||T(),void n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplate",type:"duplicateTemplateError",data:{miscDataToConvertToString:{error:Y.error,template_id:o.id,template_block_id:o.rootId,target_space_id:c.id,public_template_name:o.name}}})}}function J(e){const{item:t,transaction:a,spaceViewStore:o}=e;if(o){const e=o.getVisitedTemplateIds();if(e.indexOf(t.rootId)<0){const n=e.concat([t.rootId]);E().zv({store:o,data:{visited_templates:n},transaction:a})}}}},994488:(e,t,a)=>{a.d(t,{o:()=>o});a(362833),a(403517);function o(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];if(0===a.length)return e.map((e=>[e]));const i=[];for(const r of e)i.push(...o(a[0],...a.slice(1)).map((e=>[r,...e])));return i}}}]);