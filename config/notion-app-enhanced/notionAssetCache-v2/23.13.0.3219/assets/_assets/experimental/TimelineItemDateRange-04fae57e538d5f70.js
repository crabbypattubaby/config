"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11922],{435621:(e,t,o)=>{o.r(t),o.d(t,{TimelineItemDateRange:()=>Z,propertiesWidth:()=>X,scrollArrowLeftOffset:()=>O,scrollArrowLeftOffsetAnimatePx:()=>H});o(403517);var r=o(242343),l=()=>o(237385),n=()=>o(803290),i=()=>o(174114),a=()=>o(723361),s=()=>o(653998),c=()=>o(975392),d=()=>o(31448),u=()=>o(437800),g=()=>o(360378),S=()=>o(84543),m=()=>o(314164),p=()=>o(933396),h=()=>o(599834),b=()=>o(424048),y=()=>o(519463),f=()=>o(28210),v=()=>o(709237),x=()=>o(636045),k=()=>o(983050),C=()=>o(981810),D=()=>o(868199),w=()=>o(37394),P=()=>o(836331),I=()=>o(983965),M=()=>o(546286),A=()=>o(635900),j=()=>o(627683),R=()=>o(928567),K=()=>o(96297),B=o(163643);const E=24;function T(e){const{store:t,schema:o,timelineState:a,dateValueStore:s,collectionContextStore:c,isFullScreen:d,isRootChild:u}=e,g=(0,r.useRef)(null),[m,p]=(0,r.useState)(!1),h=(0,l().v3)(),b=(0,n().K8)((()=>{const e=a.drawStateStore.state;if(e)return e.startStore===t}),[t,a.drawStateStore]),y=(0,n().K8)((()=>!b&&a.hoveredItemStore.state===t&&!I().A.state),[b,t,a.hoveredItemStore]),f=(0,n().K8)((()=>(0,A().tH)(c)),[c]),v=(0,r.useCallback)((e=>{if(e.preventDefault(),!a.scrollLeftStore.state||!g.current)return;const r=(0,K().NM)(g.current);M().vt({timelineState:a,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:c,verticalScroller:r}),p(!1)}),[c,o,t,a]),x=(0,r.useCallback)((e=>{if(!g.current)return;const t=(0,K().NM)(g.current);M().GZ({timelineState:a,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[a]),k=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,canUndo:!0,perform:e=>{M().sd({timelineState:a,environment:h,transaction:e,collectionContextStore:c,isFullScreen:d,isRootChild:u})}})}),[h,a,c,d,u]),C=(0,r.useCallback)((e=>{M().P7({timelineState:a,environment:h})}),[h,a]),D=(0,r.useCallback)((()=>{p(!0)}),[p]),w=(0,r.useCallback)((()=>{p(!1)}),[p]),P=(0,i().IS)((e=>({draggableStyle:{position:"absolute",top:0,right:-E,width:E,height:"100%",zIndex:1,isolation:"auto"},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:f?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:A().cC},svgCircleFill:{color:e.white}})),[f]),T=(0,r.useCallback)((e=>{if(!s.state)return;return(0,B.jsx)("div",{ref:g,style:P.draggableStyle,...e,children:y&&(0,B.jsx)("div",{style:P.draggableSvgStyle,children:(0,B.jsxs)("svg",{style:{width:22,height:30},onMouseMove:D,onMouseLeave:w,children:[(0,B.jsx)(j().A,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:P.svgPathStyle,showArrowHead:m}),(0,B.jsx)("circle",{cx:m?10+A().EZ:10,cy:14,r:m?A().EZ:A().w7,style:P.svgPathStyle,fill:P.svgCircleFill.color})]})})})}),[s,w,D,y,P.draggableStyle,P.draggableSvgStyle,P.svgCircleFill.color,P.svgPathStyle,m]);return(0,B.jsx)(R().A,{render:T,onDraggableDragStart:v,onDraggableDragMove:x,onDraggableDragEnd:k,onDraggableDragCancel:C})}var L=()=>o(131809);const F={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},z={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};function V(e){let{type:t,store:o,query:a,schema:c,timelineState:d,dateValueStore:u,collectionContextStore:g,isInPeekRenderer:m,isFullScreen:p,isRootChild:b}=e;const y=(0,l().v3)(),f=(0,s().tz)(),[v,x]=(0,r.useState)(!1),k=(0,n().K8)((()=>{const e=d.dragStateStore.state;return e?e.stores[0]===o&&("left"===t?e.type===A().MB.LeftResizer:e.type===A().MB.RightResizer):v&&!I().A.state}),[v,o,d,t]),C=(0,n().O$)(u),D=(0,n().O$)(d.zoomLevelStore),w=(0,i().IS)((e=>{const t={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:e.text.primary},o={fontSize:12,position:"absolute",width:200,lineHeight:`${h().V}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...t,left:Math.ceil(3.5)+1},rightDraggableIndicator:{...t,left:Math.floor(.5)},leftDraggableLabel:{...o,right:12,textAlign:"right"},rightDraggableLabel:{...o,left:12},timelineBackground:{background:m?e.peekTimelineBackground:e.timelineBackground,padding:4,borderRadius:6}}}),[m]),P=(0,r.useCallback)((()=>x(!0)),[]),j=(0,r.useCallback)((()=>x(!1)),[]),K=(0,r.useCallback)((e=>{M().GB({timelineState:d,currentX:e.currentX})}),[d]),E=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:y,canUndo:!0,perform:e=>{M().eW({timelineState:d,collectionContextStore:g,query:a,schema:c,intl:f,environment:y,transaction:e})}}),(0,L().gp)(y,{...(0,L().ZR)({environment:y,collectionContextStore:g,timelineState:d,isFullScreen:p,isRootChild:b}),type:t})}),[g,y,f,p,b,a,c,d,t]),T=(0,r.useCallback)((e=>{e.preventDefault(),M().v7({timelineState:d,store:o,startX:e.startX,type:"left"===t?A().MB.LeftResizer:A().MB.RightResizer,query:a,schema:c,intl:f,environment:y})}),[y,f,a,c,o,d,t]),V=(0,r.useCallback)((()=>{M().Pt({timelineState:d,environment:y})}),[y,d]),W=(0,r.useCallback)((e=>{const o="left"===t;if(C)return(0,B.jsx)("div",{style:o?z:F,onMouseMove:P,onMouseLeave:j,...e,children:k&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{style:o?w.leftDraggableIndicator:w.rightDraggableIndicator}),(0,B.jsx)("span",{style:o?w.leftDraggableLabel:w.rightDraggableLabel,children:(0,B.jsx)("span",{style:w.timelineBackground,children:o?(0,A()._D)(C,D):(0,A().ji)(C,D)})})]})})}),[C,D,j,P,k,w,t]);return(0,B.jsx)(R().A,{render:W,onDraggableDragStart:T,onDraggableDragMove:K,onDraggableDragEnd:E,onDraggableDragCancel:V})}const W=r.memo(V,o(21045).A),N=(0,s().YK)({typeAName:{defaultMessage:"Type a nameâ€¦",id:"timelineItem.itemName.placeholder"}}),O=21,H=48,X=800,$=400;var q=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(q||{});function U(e){const{timelineState:t,scrollerLeftOffset:a,itemPositionStore:c,store:d,query:u,schema:g,dateValueStore:p,disabled:b,isDraggingViaTimelineItemStore:y,collectionContextStore:f,isFullScreen:v,isRootChild:x,parentStore:C,toggleButton:D,isInPeekRenderer:w,handleOpenPeekPage:j,showProperties:R,clonedStore:K,blockPropertyValueOverlayStore:E,propertiesWrapElementRef:L}=e,F=(0,l().v3)(),z=(0,s().tz)(),{value:V}=(0,o(129978).fJ)(o(73631).T.formulas),N=(0,n().K8)((()=>c.state),[c]),H=(0,n().K8)((()=>{if(N){const{left:e,right:o}=N,r=o-e;if(!((0,A().zZ)(F)&&r>50))return{position:q.Absolute,left:e};{const l=t.scrollLeftStore.state;if(void 0!==l){const t=l+a-e+O;if(t<0)return{position:q.Absolute,left:e};if(t>r)return{position:q.Absolute,left:o};if(t>0)return{position:q.Sticky,left:a+O}}}}}),[F,N,a,t.scrollLeftStore]),$=(0,n().K8)((()=>{var e;const t=o(205670).default.state;if("editing"!==t.mode)return!1;const r=null===(e=(0,o(621641).H7)(t.multiSelection))||void 0===e?void 0:e.store;return d&&r&&r===d.getBlockTitleStore()}),[d]),U=(0,n().K8)((()=>(0,A().tH)(f)),[f]),Z=(0,n().K8)((()=>t.hoveredItemStore.state===d),[d,t.hoveredItemStore]),Q=(0,n().K8)((()=>{const{mainEditorCurrentBlockStore:e}=o(485966).default.state;if(d&&e)return m().wy({environment:F,store:d,mainEditorCurrentBlockStore:e,collectionContextStore:f,fullyQualified:!1})}),[F,f,d]),ee=(0,n().K8)((()=>{if(d)return(0,o(29869).Ay)({store:d,fullyQualified:!1,pageVisitSource:o(712437).y8.LinkInPage})}),[d]),te=(0,n().K8)((()=>!b&&(null==d?void 0:d.canEdit())),[b,d]),oe=(0,l().WS)(),re=(0,n().K8)((()=>"collectionTypedView"===f.contextType),[f]),le=(0,n().K8)((()=>te&&!oe&&(U||f.permissionScopesStore.state.canConfigureBlock)&&!re),[te,f.permissionScopesStore,oe,re,U]),ne=(0,n().K8)((()=>f.currentSubitemFormatStoreForUiDisplayStore.state),[f]),ie=ne?42:10,ae=N?Math.max(N.right-N.left,ie)+1:ie+1,se=(0,n().K8)((()=>y.state),[y]),ce=(0,n().K8)((()=>{const e=C,t=(0,o(128057).AU)({collectionContextStore:f,collectionStore:e,environment:F}),r=null==d?void 0:d.getModel(),l=null==d?void 0:d.getRecordModel;if(!t||!r||!l)return!0;const n=P().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,o(15552).oR)(t)({block:r,getRecordModel:l,propertyMapping:null==e?void 0:e.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+n,resultCache:new Map,regExpCache:new Map,experimentService:P().default,formulasModule:V})}),[f,F,C,d,V]),de=(0,n().K8)((()=>d&&(0,o(964968).W)(F,d.id)),[F,d]),ue=(0,n().K8)((()=>f.isInHomeWidgetStore.state),[f.isInHomeWidgetStore]),ge=(0,n().K8)((()=>!!d&&m().NM(d)),[d]),Se=(0,n().K8)((()=>{const e=t.drawStateStore.state;return e&&e.startStore!==d}),[d,t.drawStateStore]),me=(0,r.useMemo)((()=>(0,B.jsx)(_,{collectionContextStore:f,toggleButton:D,itemPositionStore:c})),[f,c,D]),pe=(0,i().IS)((e=>({linkBoxStyle:{width:"100%",height:"100%",borderRadius:6},linkBoxInnerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:6},container:{position:"absolute",left:null==N?void 0:N.left,marginTop:1,marginBottom:1,width:ae,height:h().V-2,borderRadius:6,display:"flex",...null!=N&&N.isExistingSubitemPlaceholder?void 0:{..."light"===e.mode?{background:null!=N&&N.isPlaceholder?e.buttonHoveredBackground:e.contentBackground,boxShadow:null!=N&&N.isPlaceholder?void 0:e.buttonBoxShadow}:{background:w?e.calendarItemBackground:e.popoverBackground,boxShadow:null!=N&&N.isPlaceholder?void 0:e.shadowSM}},...(null==N?void 0:N.isPlaceholder)&&{cursor:"crosshair"},...se&&{display:"none"},...!ce&&{opacity:.5},...de&&{opacity:.5},zIndex:85},halo:{...m().wh(e,ge),borderRadius:6},propertiesContainer:{width:"100%",WebkitMaskImage:null!=N&&N.maskPercent&&(null==N?void 0:N.maskPercent)<1&&Z?`linear-gradient(90deg, rgba(0,0,0,1) ${100*N.maskPercent}%, rgba(0,0,0,0.4) ${100*N.maskPercent}%)`:void 0,pointerEvents:"none",...se&&{display:"none"},zIndex:85,opacity:!ce||de?.5:1},propertiesWrapInnerStyle:{display:"flex",height:h().V-2+1,paddingLeft:ne&&me?24:6,width:X,overflow:"hidden"}})),[se,Z,w,ce,N,ge,ne,me,ae,de]),he=(0,r.useCallback)((()=>{const e=null==L?void 0:L.current,t=H;e&&t&&(e.style.position=t.position===q.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)}),[H,L]),be=(0,r.useMemo)((()=>(0,B.jsx)("div",{style:pe.propertiesContainer,children:(0,B.jsx)("div",{style:pe.propertiesWrapInnerStyle,ref:L,className:k().st6,children:R.map(((e,t)=>(0,B.jsx)(J,{showProperties:R,store:d,disabled:b,blockPropertyValueOverlayStore:E,clonedStore:K,collectionContextStore:f,parentStore:C,editingTitle:$,property:e,index:t},e)))})})),[E,K,f,b,$,C,L,R,d,pe]),ye=(0,r.useCallback)((e=>{d&&(t.dragStateStore.state||M().v7({timelineState:t,store:d,startX:e.startX,type:A().MB.ItemDrag,query:u,schema:g,intl:z,environment:F}),M().GB({timelineState:t,currentX:e.currentX}))}),[t,d,u,g,z,F]),fe=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:F,canUndo:!0,perform:e=>{M().eW({timelineState:t,collectionContextStore:f,query:u,schema:g,intl:z,environment:F,transaction:e})}})}),[t,f,u,g,z,F]),ve=(0,r.useCallback)((()=>{M().Pt({timelineState:t,environment:F})}),[t,F]),xe=(0,r.useCallback)((e=>{const o=t.dragStateStore.state;(I().A.state||o)&&!Se||F.device.isPhone||t.hoveredItemStore.setState(d)}),[t,Se,F,d]),ke=(0,r.useCallback)((()=>{const e=t.dragStateStore.state;I().A.state}),[t,Se]);return(0,r.useEffect)((()=>{he()}),[H,he]),N?!d||null!=N&&N.isPlaceholder?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{style:pe.container,className:k().KfS}),be]}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(o(367859).A,{style:pe.container,haloStyle:pe.halo,className:k().KfS,store:d,canSelect:!0,shouldShowHalo:!ue,shouldForceRenderSelectionHalo:ge,canDrag:te,analyticsName:"timeline",onDraggableDragStart:Y,onDraggableDragMove:ye,onDraggableDragEnd:fe,onDraggableDragCancel:ve,canTriggerContextMenu:te,getGhostElement:G,disableScrollToReveal:!0,onMouseMove:xe,onMouseLeave:ke,showBlockMenuInput:!0,children:[me,(0,B.jsx)(o(931085).A,{style:pe.linkBoxStyle,innerStyle:pe.linkBoxInnerStyle,onClick:j,href:ee,metaHref:Q,hovered:Z,ignoreLocalHoverState:!0,disableForOffline:de}),le&&d&&(0,B.jsx)(T,{store:d,isFullScreen:v,isRootChild:x,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:f}),te&&!oe&&(0,B.jsx)(W,{type:"left",store:d,query:u,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:f,isFullScreen:v,isInPeekRenderer:w,isRootChild:x}),te&&!oe&&(0,B.jsx)(W,{type:"right",store:d,query:u,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:f,isFullScreen:v,isInPeekRenderer:w,isRootChild:x})]}),be]}):null}const Z=r.memo(U);function _(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:r}=e;const l=(0,n().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(0,n().O$)(r);return!l||!o||null!=i&&i.isExistingSubitemPlaceholder?null:(0,B.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function Y(e){e.preventDefault()}function G(e){const t=w().T.findSelectablesFromStore(e),o=c().oE(t.map((e=>e.getNode()))),r=c().oE(o.map((e=>e.closest(`.${k().ZLF}`))))[0];if(r){const e=u().up(r),t=e.cloned.querySelector(`.${k().KfS}`),o=e.cloned.querySelector(`.${k().st6}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(u().up)}function Q(e){let{isLast:t,store:o,collectionContextStore:u,parentStore:S,editingTitle:m}=e;const p=(0,i().DP)(),h=(0,l().v3)(),k=(0,s().tz)(),w=(0,n().K8)((()=>null==o?void 0:o.getIcon()),[o]),P=(0,n().K8)((()=>null==u?void 0:u.shouldShowPageIcon()),[u]),I=(0,n().K8)((()=>null==o?void 0:o.hasError()),[o]),M=(0,n().K8)((()=>!o||o.isEmptyPage()),[o]),A=(0,n().O$)(u.currentSubitemFormatStoreForUiDisplayStore),j=(0,n().K8)((()=>{var e;return A&&S?null===(e=S.getSchema()[A.property])||void 0===e?void 0:e.name:""}),[S,A]),R=(0,n().K8)((()=>null==o?void 0:o.getBlockTitleStore()),[o]),K=(0,n().K8)((()=>o&&(0,C().xC)({collectionContextStore:u,blockStore:o})),[u,o]),E=(0,n().K8)((()=>o&&(0,C().Kk)({collectionContextStore:u,blockStore:o})),[u,o]),T=(0,r.useCallback)((()=>{o&&g().Lt({environment:h,store:o})}),[h,o]);return(0,B.jsxs)("div",{style:{display:"flex",marginRight:t?0:10,fontSize:14,fontWeight:d().Wy.medium,alignItems:"center"},children:[P&&w&&!I&&(0,B.jsx)(f().B,{disabled:!0,icon:w,isEmptyPage:M,size:20,style:{marginLeft:2,marginRight:6}}),I&&(0,a().Q)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:p.accentColors.orange[500]}),o&&!m&&(0,B.jsx)(v().A,{style:{whiteSpace:"nowrap",maxWidth:$},store:o}),m&&o&&R&&(0,B.jsx)(x().A,{store:R,style:{whiteSpace:h.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:T,onEsc:T,onTab:c().D_,placeholder:k.formatMessage(N.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:D().Os.none}),o&&K&&(0,B.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,B.jsx)(b().n,{blockStore:o,collectionContextStore:u})}),o&&E&&(0,B.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:p.text.tertiary},children:(0,B.jsx)(y().W,{blockStore:o,collectionContextStore:u})}),!o&&(0,B.jsx)("span",{children:S&&j?(0,B.jsx)(s().sA,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:j}}):(0,B.jsx)(s().sA,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}function J(e){let{property:t,index:o,showProperties:r,store:l,disabled:i,blockPropertyValueOverlayStore:a,clonedStore:s,collectionContextStore:c,parentStore:d,editingTitle:u}=e;const g=o===r.length-1,S=(0,n().K8)((()=>null==l?void 0:l.getAssociatedCollectionStore()),[l]),m=(0,n().K8)((()=>null==l?void 0:l.canEdit()),[l]),h=(0,n().K8)((()=>c.collectionViewStore()),[c]);return S?"title"===t?(0,B.jsx)(Q,{store:l,collectionContextStore:c,parentStore:d,editingTitle:u,isLast:g}):l&&s?(0,B.jsx)(p().BlockPropertyRouter,{store:s,property:t,disabled:i||!m,locked:!1,format:"timeline",tableWrap:!1,isLast:g,blockPropertyValueOverlayStore:a,enablePointerEventsForInteractiveTypes:!0,collectionStore:S,collectionViewStore:h},t):null:null}}}]);