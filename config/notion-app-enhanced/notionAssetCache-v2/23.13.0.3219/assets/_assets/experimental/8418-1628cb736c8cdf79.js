"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[8418],{82482:(t,e,n)=>{n.d(e,{J:()=>b});n(242343);var i=()=>n(16791),r=()=>n(237385),a=()=>n(174114),o=()=>n(846581),s=()=>n(423600),u=()=>n(331863),l=()=>n(653998),c=()=>n(421650),d=()=>n(421338),m=()=>n(884373),p=()=>n(517198),f=()=>n(701270),v=()=>n(231786),g=()=>n(242111),y=()=>n(847184),h=()=>n(499670),x=n(163643);function b(t){let{immediate:e,recurring:n,nextBillingDate:i,accountBalance:o,items:p,chargeType:v={chargeType:"immediate"},modalId:g,isExpanded:b,setIsExpanded:w,couponApplicationResult:I}=t;const _=(0,r().v3)(),S=(0,a().IS)((t=>({summaryContainer:{background:t.surface.wash,padding:16,borderRadius:8}})),[]),A=e.subtotal.plus(e.tax),C=new(s().W)(n.subtotal.currencyCode,0),D=(0,h().Bq)({subtotal:n.subtotal,discount:C,balance:o},n.tax),j=0!==D.amount&&0!==A.amount&&D.amount!==A.amount,[T,q,M]="immediate"===v.chargeType?[A,e.subtotal,e.tax]:[D,n.subtotal,n.tax];return(0,x.jsxs)(d().Y1,{gap:8,children:[(0,x.jsx)(y().BB,{useNewStyle:!0,isTotalLoading:e.isLoading,total:T,coupon:(0,u().RS)(null==I?void 0:I.couponOffer),couponApplicationResult:I,handleToggleExpanded:()=>{b?c().CK(_,{modalId:g}):c().wJ(_,{modalId:g}),w(!b)},isExpanded:b,discount:C,accountBalance:o,subtitle:"immediate"===v.chargeType?(0,x.jsx)(E,{recurringTotal:D,periodEnd:i,isNextBillDifferent:j,isLoading:n.isLoading||e.isLoading}):null,...v}),(0,x.jsx)(y()._z,{isExpanded:b,children:(0,x.jsxs)(d().Y1,{gap:8,style:S.summaryContainer,children:[j?(0,x.jsx)(f().D,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:(0,x.jsx)(l().sA,{id:"checkout.orderSummary.title",defaultMessage:"Prorated charge"})}):null,(0,x.jsxs)(d().Y1,{gap:12,children:[(0,x.jsx)(y().f5,{items:p,showMonthlyPricing:!1}),(0,x.jsx)(m().A,{size:1}),(0,x.jsx)(y().Qs,{subtotal:q,subtotalText:j?(0,x.jsx)(l().sA,{id:"checkout.orderSummary.subtotalProrated",defaultMessage:"Subtotal (prorated)"}):void 0,discount:C,showDiscountLine:!1,accountBalance:o,tax:M})]})]})})]})}function E(t){let{recurringTotal:e,periodEnd:n,isLoading:r,isNextBillDifferent:a}=t;return r?(0,x.jsx)(p().A,{style:{width:180,height:16,borderRadius:4}}):a?(0,x.jsxs)(d().Y1,{direction:"horizontal",gap:4,align:"center-left",children:[(0,x.jsx)(l().sA,{id:"checkout.orderSummary.estimatedBill",defaultMessage:"Estimated next bill: {price}",values:{price:(0,x.jsx)(g().v,{cost:e,trailingZeroDisplay:"stripIfInteger"})}}),(0,x.jsx)(v().W,{tooltipTitle:(0,x.jsx)(l().sA,{id:"checkout.orderSummary.estimatedBillTooltip",defaultMessage:"This is an estimate of your next charge on {date}. If you add/remove members, this amount might change",values:{date:(0,o().eV)({value:n,preset:"medium",locale:i().locale})}}),tooltipDescription:(0,x.jsx)(l().sA,{id:"checkout.orderSummary.estimatedBillTooltipDescription",defaultMessage:"Click to learn more about billing"}),buttonProps:{href:"https://www.notion.com/help/billing-and-payment-info",external:!0},tooltipWidth:240})]}):null}},784473:(t,e,n)=>{n.d(e,{Dd:()=>S,F3:()=>D,Fy:()=>C,Vq:()=>A,cP:()=>I,eO:()=>j,vF:()=>_});n(725707),n(403517),n(244387);var i=n(242343),r=()=>n(16791),a=()=>n(237385),o=()=>n(803290),s=()=>n(846581),u=()=>n(647242),l=()=>n(649074),c=()=>n(678988),d=()=>n(844081),m=()=>n(423600),p=()=>n(455831),f=()=>n(653998),v=()=>n(975392),g=()=>n(818369),y=()=>n(153642),h=()=>n(104838),x=()=>n(910200),b=()=>n(613313),E=()=>n(791022),w=n(163643);function I(t){var e;let{desiredProducts:n,desiredInterval:r,billingData:a,prices:s}=t;const d=(0,u().Ry)(a)??"USD",m=(0,i.useMemo)((()=>(0,u().lQ)(a)),[a]),f=(0,y().V)()??1,g=(null===(e=(0,u().KH)(a,"sites_custom_hostnames"))||void 0===e?void 0:e.quantity)??0,h=(0,i.useMemo)((()=>({numSeats:f,numCustomHostnames:g})),[f,g]),x=(0,o().K8)((()=>(0,b().Le)()),[]),E=(0,i.useMemo)((()=>(0,c().ef)({state:m,prices:s,quantities:h,params:{currency:d,interval:r},products:n,flags:{isMay13PackagingChangesEnabled:x}})),[m,s,h,d,r,n,x]),w=(0,l().Gf)(E),I=(0,u().AW)(a),_="upgrade"===(0,p().qR)({oldTier:I,newTier:w});(0,u().TB)(a)&&(0,u().HY)(a)&&!_&&(E.trialEnd=(0,u().i5)(a));const S=(0,i.useMemo)((()=>(0,v().Lc)(E.items,m.items,"price.externalId")),[E.items,m]);return{desiredState:E,quantities:h,newItems:S}}function _(t){const{spaceStore:e,quantities:n,desiredState:r,currencyCode:s,couponOffer:u}=t,l=(0,o().K8)((()=>e.id),[e]),c=(0,a().v3)(),[d,p]=(0,i.useState)(),[f,v]=(0,i.useState)(),[y,h]=(0,i.useState)(!1),[x,b]=(0,i.useState)(),[E,w]=(0,i.useState)(),[I,_]=(0,i.useState)();let S;return(0,i.useEffect)((()=>{!async function(){var t;h(!0);const e=await g().callApi({eventName:"getImmediateUpdateCost",environment:c,data:{spaceId:l,quantities:n,desiredState:{items:(null==r?void 0:r.items.map((t=>({id:t.id,quantity:t.quantity,priceData:{external_id:t.price.externalId,product:t.price.product,billing_interval:t.price.billingInterval,currency:t.price.unitAmount.currencyCode,unit_amount:t.price.unitAmount.amount,state:t.price.state}}))))||[],trialEnd:null===(t=r.trialEnd)||void 0===t?void 0:t.toString()},couponCampaign:null==u?void 0:u.campaign}});if(h(!1),"success"!==e.type)return;p(m().W.fromValue(e.data.total)),v(e.data.lineItems);const i=e.data.couponApplicationResult;i&&(b(m().W.fromValue(i.amountDuePreCoupon)),w(m().W.fromValue(i.amountDuePostCoupon)),_(i.couponResultLineItems))}()}),[c,null==r?void 0:r.items,n,l,null==r?void 0:r.trialEnd,u]),u&&x&&E&&I&&(S={amountDuePreCoupon:x,amountDuePostCoupon:E,couponResultLineItems:I,couponOffer:u}),{subtotal:d??new(m().W)(s,0),lineItems:f,isLoading:y,couponApplicationResult:S}}function S(t,e,n){return((null==e?void 0:e.items)??[]).reduce(((t,e)=>{const i=(0,u().q5)(e.price);return t.plus(i.getCostPerBillingInterval({quantity:e.quantity,offer:n}))}),new(m().W)(t,0))}function A(t){let{change:e,interval:n,currentPeriodEnd:i,now:r}=t;return(0,d().u7)(e)&&n?r.plus({months:"month"===n?1:12}):i}function C(t){let{environment:e,currencyCode:n,address:r,lineItems:a,taxableAmount:o,billingData:s}=t;const[u,l]=(0,i.useState)(0),[c,d]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{!async function(){if(!r||0===a.length||0===o.amount)return;d(!0);const t=await(0,x().qu)({environment:e,taxableAmount:o,lineItems:a,address:r,billingData:s});l(t??0),d(!1)}()}),[e,o,a,r,s]),{tax:new(m().W)(n,u),isLoading:c}}async function D(t){let{environment:e,spaceStore:n,desiredState:i,stripe:r,coupon:a,intl:o,postUpgradeCallback:s}=t;try{const t=await h().nV({environment:e,from:E().A.state.open?E().A.state.analyticsArgs.from:"midterm_checkout_modal",spaceStore:n,desiredState:i,inAppOffer:a,postUpgradeCallback:s});await h().XO({paymentIntentData:t,stripe:r,onSuccess:()=>h().o2({environment:e,spaceStore:n})})}catch{return{error:o.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})}}}function j(t){let{interval:e,effectiveDate:n}=t;return{title:(0,w.jsx)(f().sA,{id:"midtermIntervalChange.title",defaultMessage:"Switch to {interval, select, month {monthly} other {annual}} billing",values:{interval:e}}),subtitle:n?(0,w.jsx)(f().sA,{id:"midtermIntervalChange.subtitle.nextPeriod",defaultMessage:"Effective {periodEnd}",values:{periodEnd:(0,s().eV)({value:n,preset:"medium",locale:r().locale})}}):(0,w.jsx)(f().sA,{id:"spaceSubscriptionUpgradeModal.effectiveToday.header",defaultMessage:"Effective today"})}}},844081:(t,e,n)=>{n.d(e,{AL:()=>p,Cg:()=>v,u7:()=>f});n(610931),n(362833),n(333225),n(494367),n(516262),n(573119),n(240480),n(950443),n(619601),n(725707),n(491955),n(500234),n(403517),n(113085);var i=()=>n(486826),r=()=>n(975392),a=()=>n(3311),o=()=>n(76394),s=()=>n(141666),u=()=>n(647242),l=()=>n(649074),c=()=>n(347488),d=()=>n(216376),m=()=>n(455831);function p(t){return"trial"!==t.type&&"prorate_without_invoice"!==t.type&&"update_without_proration"!==t.type&&t.immediate.items.some((t=>t.price.unitAmount.amount>0))}function f(t){return"reset_and_invoice"===t.type}function v(t,e,n,o,s,l){const c=function(t,e,n,r,o,s){var l;const c=!e.trial&&(0,u().TB)(e);if(!(0,u().Fq)(e)||c)return;const d=e.trial;if(d&&!n.trialEnd)return;const m=(0,u().KH)({subscription:n,trial:void 0},"plan"),p=(0,u().KH)({subscription:void 0,trial:d},"plan"),f=h(p,m)?m:p,v=(0,u().i5)(e)??n.trialEnd,g=(null===(l=e.trial)||void 0===l?void 0:l.startDate)??i().c9.now();return v&&f?{externalId:(null==d?void 0:d.externalId)??(0,a().Ay)(),endDate:v,startDate:g,items:[f]}:void 0}(0,e,n),d=function(t,e,n){if(!e.trial&&t){var i;const a=(null===(i=e.subscription)||void 0===i?void 0:i.items)||[],o=(0,r().$z)(n.items,u().IE),s=(0,r().$z)(a,u().IE),l=new Set([...Object.keys(o),...Object.keys(s)]),c=[];for(const e of l)null!=t&&t.items.some((t=>(0,u().IE)(t)===e))?s[e]&&c.push(...s[e]):o[e]&&c.push(...o[e]);return{items:c,trialEnd:void 0}}return t?{...n,trialEnd:void 0}:n}(c,e,n);return{trial:c,subscription:g(t,e,d,o,s,l)}}function g(t,e,n,i,a,s){const m=(0,u().PP)(e),p=(0,c().qX)(e),f=s??function(t,e){const n=y(t,e),i=function(t,e){const n=Boolean(t.trialEnd),i=y(t,e);if(n&&!i)return!0;const r=(0,l().yw)(t),a=(0,l().yw)(e);if("month"===r&&"year"===a)return!0;if("year"===r&&"month"===a)return!1;const o=t.items.find((t=>(0,u().xp)(t))),s=e.items.find((t=>(0,u().xp)(t))),c=h(o,s),d=s&&0===s.price.unitAmount.amount;if(c&&!d)return!0;if(t.trialEnd&&x(t,e))return!0;return!1}(t,e),r=function(t,e){const n=(0,l().yw)(t),i=(0,l().yw)(e);if("month"===n&&"year"===i)return!0;const r=(0,u().HO)(t.items,e.items);return r.some((t=>{let[e,n]=t;const i=!e&&n,r=h(e,n),a=b(e,n)>0,o=n&&n.price.unitAmount.amount>0;return(i||r||a)&&o}))}(t,e);return n?"trial":i?"reset_and_invoice":r?"prorate_and_invoice":"prorate_without_invoice"}(m,n);if("reset_and_invoice"===f)return{type:"reset_and_invoice",immediate:{items:n.items.filter((t=>w(n,t)))},dunningCancellationTime:p};const v=function(t,e,n,i,r,a){const s=(0,l().yw)(n),c=(0,l().yw)(i);let m;m="trial"!==e&&"year"===s?"year":c??s;const p=E(n.items,"seats"),f=E(n.items,"public_domain_custom_hostnames"),v=(0,u().HO)(n.items,i.items),g={seats:{actual:r.numSeats,billed:p},public_domain_custom_hostnames:{actual:r.numCustomHostnames,billed:f}};return v.map((e=>{const n=function(t,e){let[n,i]=t;const r=(0,d().vK)((n??i).price.product),{actual:a,billed:o}=e[r];return Math.max(a,o??0)}(e,g),s=function(t,e,n,i){let r,[a,o]=i;r=o&&h(a,o)?o.price:(a??o).price;return function(t,e,n){if(e.billingInterval===n)return e;const i=t.find((t=>t.product===e.product&&t.unitAmount.currencyCode===e.unitAmount.currencyCode&&t.billingInterval===n));if(!i)throw new Error(`Cannot find PriceData for stripe price id: ${e.externalId} at interval ${n}`);return i}(t,r,n)}(t,0,m,e),[u,l]=e,c=function(t,e){let[n,i]=t;const r=(0,d().vK)((n??i).price.product);return function(t,e){switch(e){case"seats":return t.numSeats;case"public_domain_custom_hostnames":return t.numCustomHostnames;default:(0,o().HB)(e)}}(e,r)}(e,r),p=function(t,e,n,i){let{}=i;if(!n)return;if(!w(e,n))return;const r=n.price;if(d().As.includes(r.externalId))return function(t,e){const n=t.find((t=>t.product===e.product&&t.unitAmount.currencyCode===e.unitAmount.currencyCode&&t.billingInterval===e.billingInterval));if(!n)throw new Error(`Cannot find current PriceData for stripe price id: ${e.externalId}`);return n}(t,r);return r}(t,i,l,a);return{immediate:{price:s,quantity:n},pending:(0,o().O9)(p)&&(0,o().O9)(c)&&c>0?{price:p,quantity:c}:void 0}}))}(t,f,m,n,i,a),g={items:(0,r().oE)(v.map((t=>t.immediate)))},I={items:(0,r().oE)(v.map((t=>t.pending)))},_=n.trialEnd??m.trialEnd;if("trial"===f){if(!_)throw new Error("cannot have trial without trialEnd");return{type:"trial",trialEnd:_,immediate:g,pending:I,dunningCancellationTime:p}}return{type:f,immediate:g,pending:I,dunningCancellationTime:p}}function y(t,e){const n=t.items.find((t=>(0,u().xp)(t))),i=h(n,e.items.find((t=>(0,u().xp)(t)))),r=n&&i||x(t,e);return Boolean(e.trialEnd||t.trialEnd)&&!r}function h(t,e){const n=(0,u().xp)(t)??"free",i=(0,u().xp)(e);return!!i&&m().o3[n]<m().o3[i]}function x(t,e){var n;const i=t.items.find((t=>"sites_custom_hostnames"===(0,u().IE)(t))),r=e.items.find((t=>"sites_custom_hostnames"===(0,u().IE)(t))),a=null===(n=r??i)||void 0===n?void 0:n.price;return!(!a||0===a.unitAmount.amount)&&b(i,r)>0}function b(t,e){return null!=t&&t.price.product&&"seats"===(0,d().vK)(null==t?void 0:t.price.product)||null!=e&&e.price.product&&"seats"===(0,d().vK)(null==e?void 0:e.price.product)?0:((null==e?void 0:e.quantity)??0)-((null==t?void 0:t.quantity)??0)}function E(t,e){return(0,s().Z$)(t.filter((t=>(0,d().vK)(t.price.product)===e)).map((t=>t.quantity)),"A subscription should have a consistent quantity across all its items.")}function w(t,e){if("sites_custom_hostnames"!==(0,u().IE)(e))return!0;const n=t.items.find((t=>(0,u().xp)(t)));return(0,m().y4)((0,u().xp)(n))}}}]);