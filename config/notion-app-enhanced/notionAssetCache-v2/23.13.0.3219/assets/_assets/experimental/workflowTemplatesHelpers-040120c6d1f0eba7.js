"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[17586,71204],{126216:(e,t,n)=>{n.d(t,{Z:()=>r});class o extends(()=>n(129044))().default{getInitialState(){return{}}append(e){const t={...this.state};for(const n of e)t[n.templateId]=n;this.setState(t)}}const r=new o},151602:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(129044))().default{getInitialState(){return{}}}const r=new o;n(996094).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},367950:(e,t,n)=>{function o(e){return`${e.table}:${e.id}`}n.d(t,{_:()=>o})},381697:(e,t,n)=>{n.r(t),n.d(t,{loadWorkflowTemplateInstances:()=>l});n(362833),n(403517);var o=()=>n(711659),r=()=>n(76394),i=()=>n(413871);const c=!1;function l(e){const t=[];let n=!1;e.isDefined()||(n=!0);const l=e=>{var o;if(!e.isDefined())return void(n=!0);const r=null===(o=e.getProperties())||void 0===o?void 0:o.workflow_template_instance;r&&t.push({instancePointer:{type:"automation",id:e.id,spaceId:e.getSpaceId()},templateId:r.template_id})},a=e.getFormat().workflow_template_instance,s=e.getParentBlockStore();if(null==s||!s.isDefined())return{isLoading:!0,instances:[]};a&&t.push({instancePointer:{type:"collection",id:e.id},templateId:a.template_id});const p=s.getCollectionViewStores()??[];for(const o of p){if(!o.isDefined()){n=!0;continue}const e=o.getFormat().workflow_template_instance;e&&t.push({instancePointer:{type:"collection_view",id:o.id},templateId:e.template_id})}const d=e.getLayoutStore();if(d)if(d.isDefined()){var u;const e=null===(u=d.getFormat())||void 0===u?void 0:u.workflow_template_instance;e&&t.push({instancePointer:{type:"layout",id:d.id,spaceId:d.getSpaceId()},templateId:e.template_id})}else n=!0;const m=e.getTemplatePageStores();for(const o of m){const e=o.getModel();if(!e){n=!0;continue}if(!e.isPageBlock())continue;const r=e.getFormat().workflow_template_instance;r&&t.push({instancePointer:{type:"block",id:e.id,spaceId:e.getSpaceId()},templateId:r.template_id});const i=o.getAutomationStore();i&&l(i)}const f=e.getAutomationStores();for(const o of f)l(o);const y=e.getSpaceId(),I=e.getSchema();for(const[r,c]of Object.entries(I)){if(!c)continue;const n=c.workflow_template_instance;if(n&&t.push({instancePointer:{type:"property",id:r,collectionId:e.id},templateId:n.template_id}),"button"===c.type&&c.automation_id){l(i().dn.createChildStore(e,{id:c.automation_id,spaceId:y,table:o().yB}))}}const g=e.getFormat().compound_workflow_template_instances??[];for(const o of g)t.push({instancePointer:{type:"compound",id:o.id,collectionId:e.id,instancePointers:o.instance_pointers.map((t=>{switch(t.type){case"automation":return{type:"automation",id:t.id,spaceId:y};case"block":return{type:"block",id:t.id,spaceId:y};case"collection_view":return{type:"collection_view",id:t.id};case"layout":return{type:"layout",id:t.id,spaceId:y};case"property":return{type:"property",id:t.id,collectionId:e.id}}(0,r().HB)(t)}))},templateId:o.template_id});return c&&console.log("loadWorkflowTemplateInstances: loaded workflow template instances for collection:",e.id,"isLoading:",n,"instances:",t),{isLoading:n,instances:t}}},633144:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(129044))().default{getInitialState(){return null}}const r=new o;n(996094).exposeDebugValue("WorkflowTemplatesBuilderStore",r);const i=r},727528:(e,t,n)=>{n.d(t,{CB:()=>k,DM:()=>L,FE:()=>F,Fy:()=>O,NU:()=>B,R5:()=>z,S1:()=>W,Sl:()=>T,TE:()=>b,Xg:()=>$,Zp:()=>A,aI:()=>E,aL:()=>q,b3:()=>w,fI:()=>M,ju:()=>S,rS:()=>j,tY:()=>D,wW:()=>R});n(610931),n(362833),n(725707),n(491955),n(500234),n(324989),n(403517),n(113085);var o=()=>n(367950),r=()=>n(505966),i=()=>n(502140),c=()=>n(711659),l=()=>n(145017),a=()=>n(21164),s=()=>n(289765),p=()=>n(968410),d=()=>n(975392),u=()=>n(76394),m=()=>n(378219),f=()=>n(413871),y=()=>n(151602),I=()=>n(381697),g=()=>n(940445);const v=!1;function w(e){const t={};for(const n of e){const e=t[n.templateId]??[];e.push(n.instancePointer),t[n.templateId]=e}return t}function h(e){let t;if("collection"===e.table)t=w((0,I().loadWorkflowTemplateInstances)(e).instances);else{const n=(0,o()._)(e.pointer),r=y().A.getState();t=(null==r?void 0:r[n])??{}}const n=S(t);return v&&(console.groupCollapsed("getTemplateIdToInstancePointersMap",e.pointer),console.trace(),console.log("Raw map:",t),console.log("Map with invalid template IDs removed:",n),console.groupEnd()),n}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g().globalWorkflowTemplates;const n={},o=(0,d().Bj)((e=>{try{return t.fromId(e),!0}catch(n){return!1}}));for(const[r,i]of Object.entries(e))o(r)&&(n[r]=i);return n}function T(e){let{environment:t,collectionStore:n}=e;const o=h(n),r=[];for(const[i,c]of Object.entries(o))for(const e of c)E({environment:t,instancePointer:e,inMemoryRecordCache:n.inMemoryRecordCache})&&r.push({instancePointer:e,templateId:i});return r}const P="dependency_";function b(e){return e.startsWith(P)}function k(e){let{collectionStore:t,sourceTemplateType:n,sourcePrimitiveId:o,dependencyMap:r}=e;const i=_({sourceTemplateType:n,sourcePrimitiveId:o,dependencyMap:r});if(!i)return o;const c=C(t,i);if(0===c.length)return`${P}${i}`;return c[c.length-1].id}function M(e){let{collectionStore:t,sourceTemplateType:n,sourcePrimitiveId:o,dependencyMap:r}=e;const i=_({sourceTemplateType:n,sourcePrimitiveId:o,dependencyMap:r});if(!i)return;const c=C(t,i);if(0===c.length)return;return c[c.length-1].id}function _(e){let{sourceTemplateType:t,sourcePrimitiveId:n,dependencyMap:o}=e;if(b(n))return n.replace(P,"");return o[(0,r().Ir)(t,n)]}function C(e,t){return h(e)[t]??[]}function R(e){let{environment:t,spaceStore:n,templateId:o}=e;return C(n,o).filter((e=>E({environment:t,instancePointer:e,inMemoryRecordCache:n.inMemoryRecordCache})))}function W(e){let{collectionStore:t,templateId:n,instancePointerType:o}=e;const r=C(t,n);if(0===r.length)return;const i=r[r.length-1];if(i.type!==o)throw new Error(`Expect to find instance pointer type ${o} for template ID ${n} but found ${i.type} instead`);return i}function B(e){let{environment:t,collectionStore:n,templateId:o}=e;return Boolean(A({environment:t,scopeStore:n,templateId:o}))}function A(e){let{environment:t,scopeStore:n,templateId:o}=e;const r=n.pointer,c=C(n,o).filter((e=>E({environment:t,instancePointer:e,inMemoryRecordCache:n.inMemoryRecordCache}))),l=(0,d().hS)(c,(e=>e.id));if(l.length!==c.length){const e=c.map((e=>e.id));i().log({level:"warning",from:"workflowTemplatesInstanceHelpers",type:"duplicateAliveInstancePointers",data:{miscDataToConvertToString:{templateId:o,instanceIds:e}}})}return 0===l.length?void 0:l.length>1?(i().log({level:"warning",from:"workflowTemplatesInstanceHelpers",type:"moreThanOneAliveInstancePointer",data:{miscDataToConvertToString:{templateId:o,scope:r,uniqueAliveInstancePointers:l}}}),l[0]):l[0]}function E(e){let{environment:t,instancePointer:n,inMemoryRecordCache:o}=e;if("property"===n.type){const e=new(f().md)(t,{table:a().Vl,id:n.collectionId},{inMemoryRecordCache:o});return Boolean(e.getSchema()[n.id])}if("collection_view"===n.type){const e=new(f().pS)(t,{table:s().Gy,id:n.id},{inMemoryRecordCache:o});return Boolean(e.getAlive())}if("collection"===n.type){const e=new(f().md)(t,{table:a().Vl,id:n.id},{inMemoryRecordCache:o});return!(0,m().ze)(e)}if("layout"===n.type){const e=new(f().rN)(t,{table:p().zx,id:n.id,spaceId:n.spaceId},{inMemoryRecordCache:o});return!(0,m().ze)(e)}if("compound"===n.type)return function(e){let{environment:t,instancePointer:n,inMemoryRecordCache:o}=e;return n.instancePointers.some((e=>E({environment:t,instancePointer:e,inMemoryRecordCache:o})))}({environment:t,instancePointer:n,inMemoryRecordCache:o});if("block"===n.type){const e=new(f().Bv)(t,{table:l().ev,id:n.id,spaceId:n.spaceId},{inMemoryRecordCache:o});return!(0,m().ze)(e)}if("automation"===n.type){const e=new(f().dn)(t,{table:c().yB,id:n.id,spaceId:n.spaceId},{inMemoryRecordCache:o});return!(0,m().ze)(e)}(0,u().HB)(n)}function $(e,t){const n=h(t);return Object.keys(n).filter((n=>B({environment:e,collectionStore:t,templateId:n}))).map((e=>g().globalWorkflowTemplates.fromId(e)))}function j(e,t){const n=[],o=h(e);for(const r of Object.values(o))n.push(...r.filter((e=>e.type===t)));return n}function D(e){let{environment:t,collectionStore:n}=e;if(!n)return;const o=T({environment:t,collectionStore:n}).filter((e=>{let{instancePointer:t}=e;return"collection"===t.type&&t.id===n.id}));if(0!==o.length){if(o.length>1)throw new Error(`More than one collection preset templates found for collection ${n.id}`);return g().globalWorkflowTemplates.fromIdOfType({templateId:o[0].templateId,type:"collection"})}}function L(e){const{type:t}=e;return"collection_view"===t||"property"===t||"layout"===t||"compound"===t||"block"===t||"automation"===t}function F(e){let{environment:t,collectionStore:n}=e;return T({environment:t,collectionStore:n}).filter((e=>"compound"===e.instancePointer.type))}function O(e){let{environment:t,collectionStore:n,instancePointerId:o}=e;const r=T({environment:t,collectionStore:n}).find((e=>e.instancePointer.id===o));if(r)return g().globalWorkflowTemplates.featureFromId(r.templateId)}function x(e){let{environment:t,collectionStore:n,propertyId:o}=e;const r=function(e){let{environment:t,collectionStore:n,propertyId:o}=e;return T({environment:t,collectionStore:n}).filter((e=>"property"===e.instancePointer.type&&e.instancePointer.id===o))}({collectionStore:n,environment:t,propertyId:o}),i=F({environment:t,collectionStore:n}).filter((e=>{let{instancePointer:t}=e;return r.some((e=>t.instancePointers.some((t=>t.id===e.instancePointer.id))))}));return{propertyTemplateInstances:r,compoundTemplateInstances:i}}function z(e){let{collectionStore:t,environment:n,propertyId:o}=e;const{propertyTemplateInstances:i,compoundTemplateInstances:c}=x({environment:n,collectionStore:t,propertyId:o}),l=i.map((e=>{let{templateId:t}=e;return g().globalWorkflowTemplates.fromId(t)})).filter((e=>(0,r().Xq)(e,"property")));return c.filter((e=>{let{templateId:t}=e;const n=g().globalWorkflowTemplates.fromId(t);if((0,r().Xq)(n,"compound"))return l.some((e=>n.value.templateItems.some((t=>t.pointer===e.templateId&&"required"===t.optionality))))}))}function q(e){let{environment:t,collectionStore:n,compoundTemplateInstancesToDelete:o}=e;const r=o.flatMap((e=>e.instancePointer.instancePointers)),i=o.map((e=>e.instancePointer.id)),c=F({environment:t,collectionStore:n}),l=[];for(const a of c)if(!i.includes(a.instancePointer.id))for(const e of a.instancePointer.instancePointers)r.some((t=>t.id===e.id))&&l.push(e);return r.filter((e=>!l.some((t=>t.id===e.id))))}},940445:(e,t,n)=>{n.r(t),n.d(t,{TRUNCATE_COLLECTION_TEMPLATE_ITEMS_AT:()=>W,WorkflowTemplateLogger:()=>w,getChildCollectionStoreByTemplateId:()=>_,getCollectionTemplateFromId:()=>$,getIsSetupGeneratorEnabled:()=>B,getPropertyTemplates:()=>R,getSelectedFeatureTemplateIds:()=>M,getTemplatesInCompoundTemplate:()=>C,getWorkflowTemplateItemsCaption:()=>b,getWorkflowTemplateName:()=>k,globalWorkflowTemplates:()=>S,remapPropertyIds:()=>T,shouldShowInSuggestedProperties:()=>A,useCaseByCollectionTemplateCategory:()=>E});n(610931),n(362833),n(725707),n(107652),n(491955),n(500234),n(403517);var o=()=>n(505966),r=()=>n(839999),i=()=>n(310206),c=()=>n(220574),l=()=>n(293665),a=()=>n(21164),s=()=>n(528762),p=()=>n(34662),d=()=>n(975392),u=()=>n(76394),m=()=>n(91338),f=()=>n(88442),y=()=>n(477784),I=()=>n(413871),g=()=>n(727528);const v=(0,n(653998).YK)({untitled:{id:"workflowTemplates.untitled",defaultMessage:"Untitled"}});class w{log(e){0}warn(e){0}debug(e){false}}const h=new(n(496985).default)((()=>{var e;const t=y().A.getIntl();return(0,n(435084).IC)({},t,(null===(e=n(633144).A.state)||void 0===e?void 0:e.templatesWithRowIds.map((e=>e.template)))??[],{shouldFakeLocalization:"pseudo"===t.locale,strict:!1})}),{debugName:"localizedDynamicBuilderTemplatesStore"}),S=new(o().GH)((e=>{const t=y().A.getIntl(),o=[...h.state,...(0,n(994966).Cb)(t,{localizeTemplates:!0,stage:(0,n(527392).M)()}),...Object.values(n(126216).Z.state)].find((t=>t.templateId===e));if(!o)throw new Error(`Template not found for ${e}`);return o}));function T(e){let{collectionStore:t,dependencyMap:n,object:r}=e;(0,o().$G)({object:r,callback:e=>function(e){let{collectionStore:t,dependencyMap:n,objectWithProperty:o}=e;const r=o.property,i=(0,g().CB)({collectionStore:t,sourceTemplateType:"property",sourcePrimitiveId:r,dependencyMap:n});o.property=i}({collectionStore:t,dependencyMap:n,objectWithProperty:e})})}const P=3;function b(e){if(0===e.length)return;const t=e.slice(0,P),n=e.length-t.length,o=t.join(", ");return n>0?`${o}, ${n}+`:o}function k(e){const{type:t}=e;switch(t){case"collection_view":return e.value.name??y().A.formatMessage(m().X[e.value.type]);case"property":return e.value.name;case"collection":return e.value.targetCollection.name;case"layout":case"compound":return e.name;case"block":const n=c().RecordMap.create(e.value.recordMap),o=n.getModel(e.value.blockPointer);return o?(0,p().q4_)(o.getRenderTitleTextValue({getRecordModel:i().b.fromRecordMap(n)})):y().A.formatMessage(v.untitled);case"automation":return e.value.name??(0,r().PK)(y().A.getIntl());default:(0,u().HB)(t)}}function M(e){return e.featureTemplateSelections.filter((e=>e.selected)).map((e=>e.template.templateId))}function _(e){let{environment:t,parentStore:n,collectionTemplateId:o}=e;const r=n.getSpaceId();if(!r)throw new Error(`Space ID not found for ${n}`);const i=new(I().SL)(t,{table:s().NX,id:r}),c=(0,g().wW)({environment:t,spaceStore:i,templateId:o});for(const s of c){var p;const e=new(I().md)(t,{table:a().Vl,id:s.id}),o=null===(p=e.getParentBlockStore())||void 0===p?void 0:p.getParentPointer();if(o&&l().L3.isEqual(o,n.pointer))return e}}function C(e){const t=e.value.templateItems.map((e=>S.fromId(e.pointer))),n=[];for(const r of t){if(!(0,o().$K)(r))throw new Error(`Invalid template "${r.templateId}" in compound template "${e.templateId}"`);n.push(r)}return n}function R(e){const t=[];for(const n of e)"property"===n.type?t.push(n):"compound"===n.type&&t.push(...C(n).filter((e=>(0,o().Xq)(e,"property"))));return d().hS(t,(e=>e.templateId))}const W=3;function B(e){return(0,f().ZE)(e)}function A(e){return"property"===e.type||"compound"===e.type&&C(e).every((e=>"property"===e.type))}const E={goals:"goals",projects:"project",tasks:"other",docs:"docs",meetings:"notes"};function $(e){try{return S.fromIdOfType({templateId:e,type:"collection"})}catch(t){return}}}}]);