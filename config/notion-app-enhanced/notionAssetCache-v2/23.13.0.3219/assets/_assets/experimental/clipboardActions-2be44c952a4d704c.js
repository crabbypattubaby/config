"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[5834,69184,90871,99171],{41429:(e,t,o)=>{o.r(t),o.d(t,{maybeTurnCollectionViewIntoCollectionViewPage:()=>x,transformBlocks:()=>I,transformIntoColumnList:()=>T});o(403517);var n=()=>o(752597),i=()=>o(762847),r=()=>o(145017),a=()=>o(975392),s=()=>o(551102),l=()=>o(795394),c=()=>o(900635),d=()=>o(759625),u=()=>o(164186),p=()=>o(360378),m=()=>o(384221),f=()=>o(84543),g=()=>o(868068),b=()=>o(189170),v=()=>o(754697),k=()=>o(360482),S=()=>o(836331),h=()=>o(413871),y=()=>o(837694);function I(e){const{environment:t,blocks:o,blockType:y,transaction:I}=e;if(y!==i().xd.transclusionContainer)if(y===i().xd.callout&&S().default.checkGate({gateName:"create_v2_callouts"}))!function(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,k().iU)(s))return;const u=s.getRecordStoreUIParent();if(!(u&&u instanceof h().Bv))return;const f=(0,v().Z1)({environment:t,table:r().ev,spaceId:u.getSpaceId()}),g=d().Wv({environment:t,id:f,type:i().xd.callout,inMemoryRecordCache:s.inMemoryRecordCache,transaction:n,spaceId:u.getSpaceId(),format:{callout_version:2}});l().NI({parentStore:s,childStore:g,after:a.id,transaction:n});C({newParentStore:g.getContentStore(),blocks:o,transaction:n}),c().s4({store:g,transaction:n}),m().clear({environment:t}),p().IU({environment:t}),p().td({environment:t,stores:[g]})}({environment:t,blocks:o,transaction:I});else if(y!==i().xd.columnList)if(y!==i().xd.slide)if((0,i().ZK)(y)){const e=parseInt(y.replace("column","").replace("block","")),i=a().oE(a().Hn(e-1,(()=>b().insertTextBelow({environment:t,blocks:o,transaction:I})))),r=[...o,...i],s=T({environment:t,blocks:r,transaction:I});n().default.afterNextFlush((()=>{m().setSelectionAtStart({store:s[0].getBlockTitleStore()})}))}else for(const i of o)if(i.isCalloutV2()){const e=i.getParentBlockStore();if(e){const r=i.getContentStores();f().applyOperation({store:e,operation:{pointer:e.pointer,path:["content"],command:"insertChildrenAfter",args:{ids:r.map((e=>e.id)),after:i.id}},transaction:I}),l().zz({parentStore:e.getContentStore(),childStore:i,transaction:I});for(const e of r)g().pd({environment:t,block:e,blockType:y,transaction:I,isMultiBlockTransformation:o.length>1});n().default.afterNextFlush((()=>{u().dL(t,r.map((e=>e.id)))}))}}else g().pd({environment:t,block:i,blockType:y,transaction:I,isMultiBlockTransformation:o.length>1});else!function(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,k().iU)(s))return;const c=s.getRecordStoreUIParent();if(!(c&&c instanceof h().Bv))return;const u=(0,v().Z1)({environment:t,table:r().ev,spaceId:c.getSpaceId()}),f=d().Wv({environment:t,id:u,type:i().xd.slide,inMemoryRecordCache:s.inMemoryRecordCache,transaction:n,spaceId:c.getSpaceId()});l().NI({parentStore:s,childStore:f,after:a.id,transaction:n});C({newParentStore:f.getContentStore(),blocks:o,transaction:n}),m().clear({environment:t}),p().IU({environment:t}),p().td({environment:t,stores:[f]})}({environment:t,blocks:o,transaction:I});else T({environment:t,blocks:o,transaction:I});else!function(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return;const l=a.getRecordStoreUIParent();if(!l||!(0,k().iU)(l))return;const c=l.getRecordStoreUIParent();if(!c||!(0,k()._p)(c))return;if(!c.isDefined())return;const u=(0,v().Z1)({environment:t,table:r().ev,spaceId:c.getSpaceId()}),f=d().Wv({environment:t,id:u,type:i().xd.transclusionContainer,inMemoryRecordCache:l.inMemoryRecordCache,transaction:n,spaceId:c.getSpaceId()});s().WH({parentStore:l,insertStore:f,afterStore:a,transaction:n});C({newParentStore:f.getContentStore(),blocks:o,transaction:n}),m().clear({environment:t}),p().IU({environment:t}),p().td({environment:t,stores:[f]})}({environment:t,blocks:o,transaction:I})}function x(e){let{environment:t,blocks:o,transaction:n}=e;(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(o)&&I({environment:t,blocks:o,blockType:"collection_view_page",transaction:n})}function T(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return[];const l=a.recordStoreUIParentStore;if(null==l||!l.valueIs(y()._))return[];const c=(0,v().Z1)({environment:t,table:r().ev,spaceId:a.getSpaceId()}),u=d().Wv({environment:t,id:c,type:i().xd.columnList,inMemoryRecordCache:a.inMemoryRecordCache,transaction:n,spaceId:a.getSpaceId()}),{childStore:p}=s().nc({parentStore:l,insertStore:u,beforeStore:a,transaction:n});return o.map((e=>{const o=(0,v().Z1)({environment:t,table:r().ev,spaceId:a.getSpaceId()}),c=d().Wv({environment:t,id:o,type:i().xd.column,inMemoryRecordCache:a.inMemoryRecordCache,transaction:n,spaceId:a.getSpaceId()}),{childStore:u}=s().TF({parentStore:l,childToRemoveStore:e,transaction:n}),{childStore:m}=s().WH({parentStore:p.getContentStore(),insertStore:c,transaction:n}),{childStore:f}=s().WH({parentStore:m.getContentStore(),insertStore:u,transaction:n});return f}))}function C(e){const{newParentStore:t,blocks:o,transaction:n}=e;for(const i of o){const e=i.getRecordStoreUIParent();null!=e&&e.valueIs(y()._)&&(s().TF({parentStore:e,childToRemoveStore:i,transaction:n}),s().BC({parentStore:t,appendStore:i,transaction:n}))}}},44250:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function i(e){if(!e||!("askUserToPick"in e))return e}function r(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>i,K$:()=>n,j6:()=>r})},151172:(e,t,o)=>{o.d(t,{O8:()=>F,Yf:()=>R,fS:()=>P});var n=()=>o(371807),i=()=>o(496985),r=()=>o(762847),a=()=>o(769884),s=()=>o(545250),l=()=>o(145017),c=()=>o(759260),d=()=>o(66460),u=()=>o(34662),p=()=>o(76394),m=()=>o(759625),f=()=>o(360378),g=()=>o(384221),b=()=>o(927685),v=()=>o(196005),k=()=>o(360482),S=()=>o(729522),h=()=>o(773552),y=()=>o(217013),I=()=>o(18377),x=()=>o(214227),T=()=>o(261804),C=()=>o(413871),M=()=>o(761436),w=()=>o(653224),_=()=>o(551102),A=()=>o(349947),D=()=>o(448316),B=()=>o(84543);function R(e){const{environment:t,textStore:o,blockStore:r,url:a,oldTextValue:u,urlSelection:p}=e;if(h().A.state.open||v().A.state.open||T().A.state.open||I().A.state.open)return!1;const m=S().get();if(!m)return!1;const f=S().getRect(m);if(!f)return!1;const g=(0,s().parseRoute)({url:a,baseUrl:b().A.domainBaseUrl,publicDomainName:b().A.publicDomainName,isMobile:t.device.isMobile,protocol:b().A.protocol,currentUrl:window.location.href});if("page"===g.name&&Boolean(g.discussionId)&&g.discussionId){const e=g.discussionId,s=g.blockId;if(!s)return!1;const m=r.getParentBlockStore();if(!m)return!1;const b=(0,C().Oo)(m,{table:l().ev,id:s,spaceId:(0,d().e)(m.pointer.spaceId)}),v=(0,C().Oo)(b,{table:c().$Y,id:e,spaceId:(0,d().e)(r.pointer.spaceId)});if("none"===v.getRole())return!1;const S=new(i().default)((()=>k().wc(v)[0]),{debugName:"firstCommentStore"}),h=new(n().A)({name:"internalUnfurlingMenuActions.activate",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(h);const I=r.clone(h),T=o.clone(h),M=m.clone(h);return x().A.setState({args:{commentStore:S},stores:{blockStore:r,textStore:o,parentStore:m},temporaryStores:{blockStore:I,textStore:T,parentStore:M},temporaryRecordCache:h,focusedIndex:y().A.Preview,selectionRect:f,oldTextValue:u,open:!0,url:a,urlSelection:p}),w().wQ(t,{url:a}),!0}return!1}function P(e){const{actionType:t,environment:o,commentStore:n,useTempStores:i}=e,r=x().A.state;if(!r.open)return;const{oldTextValue:s}=r,l=i?r.temporaryStores:r.stores,{textStore:c,blockStore:m,parentStore:b}=l,v=o.currentUser.id;if(v){if(i){r.temporaryRecordCache.clearCache();for(const e in r.temporaryStores){const t=r.temporaryStores[e],n={userId:v,pointer:t.pointer},i=o.defaultRecordCache.inMemoryRecordCache.getRecord(n);i?A().PC({environment:o,inMemoryRecordCache:r.temporaryRecordCache,pointer:t.pointer,model:a().Bj6.fromValue(t.pointer.table,i.value),role:i.role,updatePaths:[[]],userId:v,force:!0,debugSource:"setUnfurlType"}):A().oX({environment:o,inMemoryRecordCache:r.temporaryRecordCache,persistedRecordCache:void 0,pointer:t.pointer,userId:v})}}else o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(r.temporaryRecordCache);switch(t){case y().A.Link:f().hc({environment:o,store:r.stores.blockStore}),g().setSelection({store:r.stores.textStore,selection:{startIndex:r.urlSelection.endIndex,endIndex:r.urlSelection.endIndex}}),x().A.setState({...r,focusedIndex:y().A.Link});break;case y().A.Mention:if(!n)return;const e=(0,d().e)(c.pointer.spaceId);if(!e)return;const i=n.id;B().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.mention",canUndo:!0,perform:t=>{D().R9({environment:o,store:c,value:s,transaction:t}),D().Gf({environment:o,editorMode:"default",store:c,selection:{startIndex:r.urlSelection.startIndex,endIndex:r.urlSelection.startIndex},annotation:u().hiQ(i,e),transaction:t,analyticsFrom:"block"})}}),x().A.setState({...r,focusedIndex:y().A.Mention});break;case y().A.Preview:if(!n)return;B().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.preview",canUndo:!0,perform:e=>{D().R9({environment:o,store:c,value:s,transaction:e});const t=k().eK(n);if(!t)return;if(!k().No(t)||!b||!t.getParentId())return;const i=M().s({environment:o,parentBlockStore:b,targetStore:n,transaction:e});if(_().WH({parentStore:b.getContentStore(),insertStore:i,afterStore:m,transaction:e}),0===u().q4_(r.oldTextValue).trim().length){const t=C().Bv.createChildStore(b.getContentStore(),r.stores.blockStore.pointer);_().TF({parentStore:b.getContentStore(),childToRemoveStore:t,transaction:e})}}}),x().A.setState({...r,focusedIndex:y().A.Preview});break;default:throw(0,p().HB)(t)}i||x().A.setState({open:!1})}}function F(e){var t,o;const{blockStore:n,transaction:i}=e,a=n.getType(),s=n.getFormat(),l=n.getSpaceId();if(!n.isDefined()||a!==r().xd.alias||null==s||null===(t=s.alias_pointer)||void 0===t||!t.id)return;const c=[u().wmz(u().hiQ(null==s||null===(o=s.alias_pointer)||void 0===o?void 0:o.id,l))];m().zv({store:n,data:{type:r().xd.text},transaction:i}),m().zv({store:n.getFormatStore(),data:{alias_pointer:null},transaction:i}),D().R9({environment:n.environment,store:n.getBlockTitleStore(),value:c,transaction:i})}},189170:(e,t,o)=>{o.r(t),o.d(t,{duplicateBlocks:()=>w,duplicateBlocksWithMaybeConfirmation:()=>M,insertBlockAbove:()=>A,insertBlockAndEdit:()=>D,insertBlockBelow:()=>_,insertTextAbove:()=>R,insertTextBelow:()=>B});o(358848),o(362833),o(91270);var n=()=>o(752597),i=()=>o(214144),r=()=>o(66460),a=()=>o(975392),s=()=>o(303298),l=()=>o(577701),c=()=>o(983048),d=()=>o(415029),u=()=>o(145046),p=()=>o(111066),m=()=>o(164186),f=()=>o(84543),g=()=>o(732491),b=()=>o(190717),v=()=>o(486963),k=()=>o(590057),S=()=>o(981810),h=()=>o(459742),y=()=>o(816763),I=()=>o(112892),x=()=>o(615661),T=()=>o(182613),C=()=>o(937968);async function M(e){const{environment:t,blocks:o,duplicateOnlyCollectionSchema:i,callback:r}=e;if(!(0,C().EF)(t))return;const a=await s().VI.duplicateActions.load();let l=o;if(1===o.length){const e=await b().rW({environment:t,block:o[0],action:"duplicate"});if("user_canceled"===e)return void(null==r||r());l=e}const d=l.at(0);if(!d)return;const u=(0,v().U)(d);if(u&&(0,S().ls)(d,u))await c().un({blocks:l,environment:t,analyticsFrom:"subitem_duplication",callback:r,collectionContextStore:u});else{const{serverCommitResult:e}=f().createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:t,canUndo:!0,perform:e=>{w({environment:t,blocks:l,transaction:e,preferDuplicateLocation:"local",duplicateOnlyCollectionSchema:i,duplicateActions:a})},transactionTooBigFallback:e=>{w({environment:t,blocks:l,transaction:e,preferDuplicateLocation:"server",duplicateOnlyCollectionSchema:i,duplicateActions:a})}});e.then(r)}n().default.afterNextFlush((()=>{p().BM({environment:t})}))}function w(e){const{environment:t,blocks:o,transaction:n,preferDuplicateLocation:i,lastTopLevelBlockStore:s,preventSetSelection:c,duplicateOnlyCollectionSchema:d,duplicateActions:p}=e,f=a().$z(o,(e=>e.getFormat().app_id??e.id)),g=[];return a().jJ(f,(e=>{const o=e[0],a=!o.isTransclusionType(),{blockStores:s,onComplete:c}=p.duplicateBlock({environment:t,stores:e,transaction:n,targetSpaceId:(0,r().e)(o.pointer.spaceId),preferDuplicateLocation:i,options:{addCopyName:(0,y().A)(o),deepCopyTransclusionContainers:a,resolveTemplateVariables:!(o.isInsideTemplate()||o.isInsideFactoryOrDuplicateBlocksAction()),duplicateOnlyCollectionSchema:d}});g.push(...s),c.then((e=>{if("error"===e.status){const o=e.error;l().Rk(o)?l().UK(t,{product:o.clientData.metadata.product}):u().f1(e.errorMessage)}}))})),m().LE({blocksToInsert:g,target:s?[s]:o,environment:t,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:c}),g}function _(e){const{environment:t,createBlockItem:o,selection:n,transaction:i,analyticsFrom:r,preventSetSelection:a}=e,s=T().default.getCurrentRecordCache(),l=new(g().UF)({environment:t,userFlow:"page"===(null==o?void 0:o.blockType)?"user_flow_create_page":"user_flow_create_block",succeedOnEnqueue:!0});let c;if((0,C().EF)(t)&&o&&s){const e=d().w({environment:t,createBlockItem:o,transaction:i,inMemoryRecordCache:s,from:r,selection:n});l.track(e.pointer,i),c=m().LE({environment:t,blocksToInsert:[e],target:n,transaction:i,replaceEmptyTextBlock:!1,preventSetSelection:a})[0]}else l.fail("invalid_state");return c}function A(e){const{environment:t,createBlockItem:o,selection:n,transaction:i,analyticsFrom:r,preventSetSelection:a}=e,s=T().default.getCurrentRecordCache();let l;if((0,C().EF)(t)&&o&&s){const e=d().w({environment:t,createBlockItem:o,transaction:i,inMemoryRecordCache:s,from:r,selection:n});l=m().t1({environment:t,blocks:[e],selection:n,transaction:i,preventSetSelection:a})[0]}return l}function D(e){const{environment:t,selection:o,transaction:n}=e,r=_({...e,preventSetSelection:!0});if(r){var a;m().x5({environment:t,insertedStores:[r],isCreated:!0});const e=x().Uv.getMode(r);if("suggest"===e){const e=k().RR(t,n,r);k().tM(n,r,{id:i().JW(),type:"insert",discussionId:e.id}),k().c3({environment:t,transaction:n,discussionStore:e,addModifiedBlockIdsAfter:[r.id]})}"suggest"===e&&null!==(a=r.getNavigableBlockStore({skipCurrent:!0}))&&void 0!==a&&a.isCommentOnly()||m().um({transaction:n,blocks:o})}return r}function B(e){const{blocks:t,transaction:o,environment:i,skipAnalytics:r}=e,a=r?void 0:"text_insert_below",s=_({environment:i,selection:t,createBlockItem:h().ry.text,analyticsFrom:a,transaction:o});return s&&n().default.afterNextFlush((()=>{I().zz({environment:i,blockStore:s,insertedTextBlockLocation:"below"})})),s}function R(e){const{blocks:t,transaction:o,environment:i,skipAnalytics:r}=e,a=r?void 0:"text_insert_below",s=A({environment:i,selection:t,createBlockItem:h().ry.text,analyticsFrom:a,transaction:o});return s&&n().default.afterNextFlush((()=>{I().zz({environment:i,blockStore:s,insertedTextBlockLocation:"above"})})),s}},217013:(e,t,o)=>{o.d(t,{A:()=>i});var n=function(e){return e[e.Preview=0]="Preview",e[e.Mention=1]="Mention",e[e.Link=2]="Link",e}(n||{});const i=n},273711:(e,t,o)=>{o.r(t),o.d(t,{clipboardMessages:()=>Lt,copy:()=>go,copyDirectLinkToContent:()=>Zo,copyFormattedLinkToBlock:()=>jo,copyHtml:()=>Go,copyLinkToBlock:()=>Ho,copyLinksToBlocks:()=>$o,copyString:()=>zo,copyWithToast:()=>Ko,createSelectedMultiColumnBlockSubtree:()=>ao,cutWithMaybeConfirmation:()=>fo,getFormulaEditorInformation:()=>Ro,getInlineTextValueFromClipboardData:()=>Xo,getInlineTitleValueFromClipboardTextHtml:()=>To,getNotionSelectionClipboardData:()=>no,htmlToMultiTextSelectionClipboardData:()=>xo,insertOrTransformToCodeBlock:()=>Uo,markdownToBlocks:()=>Yo,multiTextSelectionToMarkdown:()=>Qo,paste:()=>Oo,pasteFilesForBlocks:()=>bo,pasteMarkdown:()=>yo,serializeMultiTextSelectionToClipboardData:()=>co,serializePagePropertiesAsText:()=>so,triggerBrowserCopy:()=>qo});var n={};o.r(n),o.d(n,{clipboardMessages:()=>Lt,copy:()=>go,copyDirectLinkToContent:()=>Zo,copyFormattedLinkToBlock:()=>jo,copyHtml:()=>Go,copyLinkToBlock:()=>Ho,copyLinksToBlocks:()=>$o,copyString:()=>zo,copyWithToast:()=>Ko,createSelectedMultiColumnBlockSubtree:()=>ao,cutWithMaybeConfirmation:()=>fo,getFormulaEditorInformation:()=>Ro,getInlineTextValueFromClipboardData:()=>Xo,getInlineTitleValueFromClipboardTextHtml:()=>To,getNotionSelectionClipboardData:()=>no,htmlToMultiTextSelectionClipboardData:()=>xo,insertOrTransformToCodeBlock:()=>Uo,markdownToBlocks:()=>Yo,multiTextSelectionToMarkdown:()=>Qo,paste:()=>Oo,pasteFilesForBlocks:()=>bo,pasteMarkdown:()=>yo,serializeMultiTextSelectionToClipboardData:()=>co,serializePagePropertiesAsText:()=>so,triggerBrowserCopy:()=>qo});o(362833),o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(725707),o(107652),o(491955),o(324989),o(771702),o(403517),o(244387),o(113085);var i=o.n(o(569029)),r=()=>o(503683),a=()=>o(371807),s=()=>o(752597),l=()=>o(950635),c=()=>o(712437),d=()=>o(762847),u=()=>o(564134),p=()=>o(220959),m=()=>o(193135),f=()=>o(829090),g=()=>o(992910),b=()=>o(240896),v=()=>o(860330),k=()=>o(185912),S=()=>o(539032),h=()=>o(465546),y=()=>o(502140),I=()=>o(103265),x=()=>o(427091),T=()=>o(327689),C=()=>o(214144),M=()=>o(7356),w=()=>o(694225),_=()=>o(830226),A=()=>o(465170),D=()=>o(769884),B=()=>o(582226),R=()=>o(58815),P=()=>o(298028),F=()=>o(220574),V=()=>o(293665),L=()=>o(632627),E=()=>o(545250),O=()=>o(145017),U=()=>o(21164),W=()=>o(890449),N=()=>o(66460),H=()=>o(885237),j=()=>o(34662),$=()=>o(73751),Z=()=>o(123047),G=()=>o(247200),z=()=>o(217741),J=()=>o(149467),q=()=>o(653998),K=()=>o(220413),Q=()=>o(975392),Y=()=>o(3311),X=()=>o(728373),ee=()=>o(76394),te=()=>o(809811),oe=()=>o(577701),ne=()=>o(721778),ie=()=>o(198653),re=()=>o(862384),ae=()=>o(590057),se=()=>o(927685),le=()=>o(236907),ce=()=>o(425447),de=()=>o(134549),ue=()=>o(41429),pe=()=>o(284320),me=()=>o(782422),fe=()=>o(435794),ge=()=>o(213517),be=()=>o(885110),ve=()=>o(29869),ke=()=>o(754697),Se=()=>o(336844),he=()=>o(477784),ye=()=>o(621641),Ie=()=>o(733158),xe=()=>o(360482),Te=()=>o(280630),Ce=()=>o(816763),Me=()=>o(729522),we=()=>o(486881),_e=()=>o(747324),Ae=()=>o(593745),De=()=>o(339190),Be=()=>o(113269),Re=()=>o(873617),Pe=()=>o(112907),Fe=()=>o(158294),Ve=()=>o(485966),Le=()=>o(344393),Ee=()=>o(802955),Oe=()=>o(615661),Ue=()=>o(836331),We=()=>o(773082),Ne=()=>o(13889),He=()=>o(413871),je=()=>o(182613),$e=()=>o(205670),Ze=()=>o(937968),Ge=()=>o(505381),ze=()=>o(336519),Je=()=>o(773253),qe=()=>o(658388),Ke=()=>o(995625),Qe=()=>o(793824);function Ye(e){var t;const{originalHtmlContentSize:o,environment:n}=e;if(o<500)return;const i=(0,Ke().R$)(n),r=null==i||null===(t=i.getSettings())||void 0===t?void 0:t.adoption_entry_points,a=r?r.import_nudge_on_large_paste:void 0;if(a){const e=Ue().default.getConfigKey("adoption_entry_point_time_delta","import_nudge_on_large_paste"),t=a[a.length-1];if(!(Date.now()-t>e.view_delta))return}"nudge_on_large_paste"===Ue().default.getEligibleGroup({experimentId:"adoption_import_entry_point",defaultGroup:"control"})&&((0,Qe().t)({environment:n,action:"view",from:"import_nudge_on_paste"}),Je().Iz({message:he().A.formatMessage(Xe.triggerNudgeOnPasteDescription),presentationType:"persistent",id:"nudge-on-paste",title:he().A.formatMessage(Xe.triggerNudgeOnPasteTitle),onUserDismiss:()=>{(0,Qe().t)({environment:n,action:"dismiss",from:"import_nudge_on_paste"})},onDismiss:()=>{qe().pr(n,{entryPoint:"import_nudge_on_large_paste"})},actions:{primary:{title:he().A.formatMessage(Xe.triggerNudgeOnPastePrimaryAction),onAction:()=>{(0,Qe().t)({environment:n,action:"click",from:"import_nudge_on_paste"}),Ge().kY(n,{from:"import_nudge_on_paste"}),Je().UW("nudge-on-paste"),ze().Ow({currentTab:"imports",openedFrom:"import_nudge_on_paste"})}}}}))}const Xe=(0,q().YK)({triggerNudgeOnPasteTitle:{id:"adoption.nudgeOnPaste.title",defaultMessage:"Import content directly"},triggerNudgeOnPasteDescription:{id:"adoption.nudgeOnPaste.description",defaultMessage:"Get all your content into Notion with a click"},triggerNudgeOnPastePrimaryAction:{id:"adoption.nudgeOnPaste.primaryAction",defaultMessage:"Import now"}});var et=()=>o(197881),tt=()=>o(137476),ot=()=>o(275338);var nt=()=>o(782023),it=(o(610931),o(500234),()=>o(559422)),rt=()=>o(547958),at=()=>o(496580),st=()=>o(795394),lt=()=>o(874337),ct=()=>o(378219),dt=()=>o(250338),ut=()=>o(37394),pt=()=>o(347931),mt=()=>o(448316),ft=()=>o(384221);function gt(e){var t;const{environment:o,clipboardData:n,transaction:i,allowPasteIntoHeaderWithoutChildren:r,selectAll:a,preventLegacyTransclusions:l}=e;if($e().default.isEditingComment()||(0,we().X4)())return!1;if(function(e,t){return e.blockSelection.blocks.some((e=>{var o;if(!e.blockSubtree)return!0;const n=null===(o=e.blockSubtree.getModel({id:e.blockId,table:O().ev}))||void 0===o?void 0:o.spaceId;return!!(n&&t&&oe().Lw({sourceSpaceId:n,targetSpaceId:t,sourceBlockSubtree:e.blockSubtree}))||void 0}))}(n,null===(t=Ve().default.state.currentSpaceStore)||void 0===t?void 0:t.id))return!1;const c=$e().default.state;if("editing"!==c.mode)return!1;const u=c.multiSelection.start.store;if(!u.isTable(O().ev))return!1;const p=(0,Te().T)(u);if(!p)return!1;if(u!==p.getBlockTitleStore())return!1;const m=p.getType(),f=p.getFormat();if(!m)return!1;if(!((0,d().IU)(m,f)||r&&(0,d().CN)(m)))return!1;if(r&&(0,d().CN)(m)){const e=n.blockSelection.blocks[0],t=null==e?void 0:e.blockId,o=null==e?void 0:e.blockSubtree,i=t&&o?o.getModel({id:t,table:"block"}):void 0;if(Boolean(null==i?void 0:i.getContentLength()))return!1}const g=(0,dt().Ag)({includeNonSelectableListContainer:!0});if(!g)return!1;const b=(0,dt().Xs)(p,[g]);if(!b)return!1;let v=0;for(let s=b.length-1;s>=0;s--){const e=b[s].value.store,t=ut().T.findSelectableFromStore(e),o=e.getModel();if(null!=o&&o.isType(d().U6)||t&&!t.props.canSelect){v=s;break}}const k=b.slice(v);if(0===k.length)return!1;const S=k[0].value.store,h=S.pointer.spaceId,y=S.isInsideTemplate()||S.isInsideFactoryOrDuplicateBlocksAction();i.logDebugMessage("pasteMultiTextSelection: pasting",k,{spaceId:h,pastingIntoTemplate:y,insertionPathRootStore:S});const I=n.blockSelection.blocks.map((e=>{var t;let{blockId:n,blockSubtree:r}=e;if(!r)throw new Error("Missing data for local duplicate block during paste");const a=(null===(t=r.getModel({table:O().ev,id:n}))||void 0===t?void 0:t.getType())===d().xd.factory,s=!(y||a),c=He().Bv.createChildStore(S,{table:O().ev,id:n}),u=ce().localDuplicate({environment:o,sourceBlockId:n,targetBlockPointer:(0,ke().zP)({environment:o,table:O().ev,spaceId:h}),sourceBlockSubtree:r,targetInMemoryRecordCache:S.inMemoryRecordCache,transaction:i,options:{addCopyName:(0,Ce().A)(c),deepCopyTransclusionContainers:!1,preventLegacyTransclusions:l,resolveTemplateVariables:s}}),m=u.targetBlockStore.getType();return m&&et().v(o,{from:"paste",type:m,new_page_id:"page"===m?u.targetBlockStore.id:void 0,creating_block_id:u.targetBlockStore.id,parent_collection_id:p.getParentCollectionIdUpToTwoLevels()}),u})),x=n.multiTextSelection.start.pointerPath,T=n.multiTextSelection.end.pointerPath,C=[],M=[],w=Math.max(x.length,T.length),_=(k[k.length-w]||k[0]).value.store,A=(0,z().v)({node:n.tree,recordStoreParent:_},(e=>{let{node:t,recordStoreParent:o}=e;const n=((e,t)=>{let o;for(const{originalToDuplicate:n}of I)if(o=n.get(t),o)break;if(o)return He().Bv.createChildStore(e,o)})(o,t.value),i=C.length<x.length?x[C.length]:void 0,r=M.length<T.length?T[M.length]:void 0;let a=!1;if((null==i?void 0:i.id)===t.value.id&&(a=!0,C.push(n)),(null==r?void 0:r.id)===t.value.id&&(a=!0,M.push(n)),!a)return{value:{store:n}};const s=(null==n?void 0:n.getContentStore())||S;return{value:{store:n},children:t.children.map((e=>({node:e,recordStoreParent:s})))}}));if(C.length!==x.length||0===C.length)throw new Error(`Failed to hydrate start path during paste (found ${C.length} of ${x.length})`);if(M.length!==T.length||0===M.length)throw new Error(`Failed to hydrate end path during paste (found ${M.length} of ${T.length})`);const D=C[C.length-1],B=M[M.length-1];if(!D||!B)throw new Error(`Failed to hydrate position during paste (${D?"":"missing start"} ${B?"":"missing end"})`);const R=(0,z().Qe)([A],(e=>e.value.store===D)),P=(0,z().Qe)([A],(e=>e.value.store===B)),F=R&&P&&rt().W.fromNearestCommonAncestor(R,P);if(!F)throw new Error(`Failed to build range for paths: ${R?"":"missing start"} ${P?"":"missing end"}`);mt().f0({environment:o,multiSelection:c.multiSelection,transaction:i});const V=$e().default.state,L="editing"===V.mode?V.multiSelection:c.multiSelection;if((0,xe().P4)(p)&&0===n.multiTextSelection.start.textIndex){const e=D.getType();e&&(0,d().aO)(e)&&ue().transformBlocks({environment:o,blocks:[p],blockType:e,transaction:i})}let E;return S.useCrdt()?(vt({transaction:i,clipboardData:n,startBlockStore:p,duplicateStartStore:D,range:F,insertionPath:k,duplicates:I,insertionPathRootStore:S}),E=bt({environment:o,transaction:i,clipboardData:n,insertionPoint:L,textSelectionState:c,duplicateEndStore:B,pastingIntoTemplate:y}).newSelectionIndex):(E=bt({environment:o,transaction:i,clipboardData:n,insertionPoint:L,textSelectionState:c,duplicateEndStore:B,pastingIntoTemplate:y}).newSelectionIndex,vt({transaction:i,clipboardData:n,startBlockStore:p,duplicateStartStore:D,range:F,insertionPath:k,duplicates:I,insertionPathRootStore:S})),s().default.afterNextFlush((()=>{const e=(0,dt().PY)({rootStore:S,root:g,target:F.end}),t=e&&(0,Te().aI)(e[e.length-1]);if(!t)return;const o={start:{index:a?L.start.index:E,store:a?L.start.store:t},end:{index:E,store:t}};ft().setMultiSelection({multiSelection:o})})),!0}function bt(e){const{insertionPoint:t,duplicateEndStore:o,pastingIntoTemplate:n,environment:i,transaction:r,clipboardData:a}=e;let s=0;const l=t.end.store,c=t.end.index,d=(0,Te().aI)(o);if(d){s=j().qAZ(d.getValue()).length;const e=(0,at().o9)((0,Te().T)(l)),t=(0,at().o9)((0,Te().T)(d));le().Le({store:l,blockStore:e})&&le().Le({store:d,blockStore:t})?(lt().X0({sourceBlockStore:e,targetBlockStore:t,splitAtGraphemeIndex:c,transaction:r,moveIntoNewBlock:!1}),r.logDebugMessage("(CRDT) pasted suffix into end",d)):(mt().jN({environment:i,sourceStore:l,sourceIndex:c,targetStore:d,targetIndex:s,transaction:r}),r.logDebugMessage("pasted suffix into end",d))}else mt().jQ({environment:i,transaction:r,store:l,selection:{startIndex:c,endIndex:1/0}}),r.logDebugMessage("no end title store to paste text into");let u=j().Uee(a.multiTextSelection.start.copiedText,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0});return n||(u=(0,G().f$)(u,{currentUserId:i.currentUser.id,currentTimeZone:(0,x().P)()})),mt().yr({environment:i,index:t.start.index,store:t.start.store,tokens:u,transaction:r}),{newSelectionIndex:s}}function vt(e){const{transaction:t,clipboardData:o,startBlockStore:n,duplicateStartStore:i,insertionPath:r,insertionPathRootStore:a,duplicates:s,range:l}=e,c=Ue().default.checkGate({gateName:"prefer_high_level_operations"});for(const p of l.iterateInsertionAt(r))(0,dt().eM)({transaction:t,treeOperation:p,deleteFrom:"tree-parent",preferHighLevelOperations:c}),it().O.applyMutable(p);if(o.blockSelection.wasContiguousSelection&&o.blockSelection.blocks.length>0&&!n.hasContent())for(const p of i.getContentStores())st().NI({parentStore:n.getContentStore(),childStore:p,transaction:t});const d=new Set;for(const{originalToDuplicate:p}of s){const e=p.getByTable(O().ev);for(const{value:o}of e){var u;if(!o||d.has(o.id))continue;d.add(o.id);const e=He().Bv.createChildStore(i,o),n=(0,ct().g7)(e),r="transclusion_reference"===a.getType()?null===(u=a.getTransclusionReferenceTargetStore())||void 0===u?void 0:u.id:a.id;n.find((e=>e.id===r))||(t.logDebugMessage("disposing of unwanted duplicated block",e,e.id===i.id),pt().bn({childStore:e,parentStore:a,alive:!1,transaction:t}))}}}var kt=()=>o(318605),St=()=>o(145046),ht=()=>o(437071),yt=()=>o(980001),It=()=>o(46406),xt=()=>o(151172),Tt=()=>o(551102),Ct=()=>o(759625),Mt=()=>o(164186),wt=()=>o(360378),_t=()=>o(575015),At=()=>o(196916),Dt=()=>o(869684),Bt=()=>o(84543),Rt=()=>o(271674);const Pt=!1;function Ft(){if(Pt){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];console.log("clipboardActions:",...t)}}const Vt=(0,q().YK)({offlineError:{id:"clipboardActions.offlineError.message",defaultMessage:"Please go online to copy this block."},untitled:{defaultMessage:"Untitled",id:"clipboardActions.untitledMessage"}}),Lt=(0,q().YK)({copiedQnAMessageToClipboard:{id:"action.copiedQnAMessageToClipboard",defaultMessage:"Copied response to clipboard"},copiedHumanMessageToClipboard:{id:"action.copiedHumanMessageToClipboard",defaultMessage:"Copied your message to clipboard"},copiedEmailToClipboard:{id:"action.copiedEmailToClipboard.snackBarMessage",defaultMessage:"Copied email to clipboard"},copiedUserIdToClipboard:{id:"action.copiedUserIdToClipboard.snackBarMessage",defaultMessage:"Copied user ID to clipboard"},copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedPageLinkToClipboard:{id:"action.copiedPageLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedFormLinkToClipboard:{id:"action.copiedFormLinkToClipboard.snackBarMessage",defaultMessage:"Copied form link to clipboard"},copiedTeamHomeLinkToClipboard:{id:"action.copiedTeamHomeLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedBlockLinkToClipboard:{id:"action.copiedBlockLinkToClipboard.snackBarMessage",defaultMessage:"Copied block link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard"},copiedImageToClipboard:{id:"action.copiedImageToClipboard.snackBarMessage",defaultMessage:"Copied image to clipboard"},copyImageError:{id:"action.copyImageError.snackBarMessage",defaultMessage:"Failed to copy image to clipboard"},copiedPageToClipboard:{id:"action.copiedPageToClipboard.snackBarMessage",defaultMessage:"Copied page to clipboard"}}),Et={...o(541017).q,dockerfile:"Docker",javascriptreact:"JavaScript",jsonc:"JSON","objective-c":"Objective-C",proto:"Protobuf",shellscript:"Shell",typescriptreact:"TypeScript",vb:"Visual Basic"},Ot="text/_notion-blocks-v3-production",Ut="text/_notion-text-production",Wt="text/_notion-multi-text-production",Nt="text/_notion-page-source-production",Ht="vscode-editor-data",jt=[Ot,Ut,Wt,Nt],$t=new Set(jt);const Zt={fromJson:e=>e,toJson:e=>e},Gt=Zt,zt=Zt,Jt=Zt,qt={fromJson(e){const t=(0,z().v)(e.tree,(e=>e)),o=Kt.fromJson(e.blockSelection);return{...e,tree:t,blockSelection:o}},toJson(e){const t=Kt.toJson(e.blockSelection);return{...e,blockSelection:t}}},Kt={fromJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?F().RecordMap.create(e.blockSubtree):void 0})))}),toJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?e.blockSubtree.toJson():void 0})))})},Qt="VirtualClipboard:production";let Yt;function Xt(e){return e.isAndroid}function eo(e,t){if(!Xt(t))return e;const o=(0,fe().n8)(e.getData("text/html"));if(o){Yt||(Yt=H().A.get(Qt));const t=Yt;if(o===(null==t?void 0:t.id)){const o=e.types.concat(Object.keys(t.mimeTypes));return{getData(o){const n=e.getData(o);return!n&&function(e){return $t.has(e)}(o)?t.mimeTypes[o]||"":n},types:[...new Set(o)].filter((o=>{const n=t.mimeTypes[o];return""!==e.getData(o)||n&&""!==n})),items:e.items}}}return e}function to(e,t,o,n){if(!e.clipboardData)return;const i=o.toJson(n),r=JSON.stringify(i);e.clipboardData.setData(t,r)}function oo(e,t,o){try{const n=e.getData(t),i=JSON.parse(n);return o.fromJson(i)}catch(n){return}}function no(e){const{clipboardData:t}=e,{text:o,html:n,isFromMicrosoftOffice:i,isHtmlTable:a}=function(e){const{clipboardData:t,tinyMceMicrosoftWordPasteFilter:o}=e,n=t.getData("text/uri-list"),i=t.getData("text/plain").replace(Lo,"\n")||n;let a=t.getData("text/html");for(const d of Eo){const e=t.getData(d);if(e){const{ops:t}=JSON.parse(e);t&&(a=new(r().Ss)(t,{}).convert())}}const s=Ao(a),{isHtmlTable:l,htmlContainsRichFormatting:c}=function(e){var t;const o=document.createElement("div");o.innerHTML=Do(e);const n=Boolean("table"===(null===(t=o.firstElementChild)||void 0===t?void 0:t.nodeName.toLowerCase()));return{htmlContainsRichFormatting:T().HZ({node:o,window,emojiData:pe().A.state}),isHtmlTable:n}}({html:a,tinyMceMicrosoftWordPasteFilter:o});if(!c&&!function(e,t){return Vo.test(e)&&Vo.test(t)}(a,i))return{text:i,isFromMicrosoftOffice:s,isHtmlTable:l};return{text:i,html:a,isFromMicrosoftOffice:s,isHtmlTable:l}}(e);return{text:o,html:n,multiTextSelectionData:oo(t,Wt,qt),textSelectionData:oo(t,Ut,Gt),blockSelectionData:oo(t,Ot,Kt),isFromMicrosoftOffice:i,isHtmlTable:a}}function io(e){const{blocks:t,action:o,environment:n}=e;if(0===t.length)return{action:o,blocks:[],wasContiguousSelection:!1};const i=t[0],r=i.inMemoryRecordCache,a=Q().sb(Q().oE(t.map((e=>e.id)))),s=i.getParentBlockStore(),l=s?s.getRenderableContentIds():[],c=l.indexOf(i.id),d=Boolean(s&&t.every(((e,t)=>l.indexOf(e.id)===c+t)));if(r.isTemplatePreview){return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,de().loadLocalSubtree)(n,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap}))),action:o,wasContiguousSelection:d}}if(r.snapshotData){!function(e,t){tt().vd(e,"history_copy",{ageMs:(0,ot().S)(t)})}(n,r.snapshotData);return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,de().loadLocalSubtree)(n,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!0,requireFullSubtree:!0,skipNavigableChildren:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap}))),action:o,wasContiguousSelection:d,wasSelectionFromSnapshot:!0}}{const e=(0,fe().x4)(t),i=e&&ao({environment:n,inMemoryRecordCache:r,multiColumnPasteInfo:e});if(e&&i){let t=!1;const s=[];for(const o of a)e.blockIds.has(o)?t||(s.push({blockId:e.columnListId,blockSubtree:i}),t=!0):s.push({blockId:o,blockSubtree:(0,de().loadLocalSubtree)(n,{blockId:o,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap});return{blocks:s,action:o,wasContiguousSelection:d}}return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,de().loadLocalSubtree)(n,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap}))),action:o,wasContiguousSelection:d}}}function ro(e){const{markdown:t,markdownOptions:o,markdownLinkifyIt:n}=e;if(n)return A().uY({...n,markdown:t,plugin:null==o?void 0:o.plugin})}function ao(e){var t;const{environment:o,multiColumnPasteInfo:n,inMemoryRecordCache:i}=e,{columnListId:r,columnIds:a,spaceId:s}=n,l=F().RecordMap.create(),c=null===(t=i.getEntry({pointer:{table:O().ev,id:r,spaceId:s},userId:o.currentUser.id}))||void 0===t?void 0:t.value.value;if("column_list"!==(null==c?void 0:c.type))return;const d={...c,content:(c.content||[]).filter((e=>a.has(e)))};l.setValue({table:O().ev,id:r,spaceId:s},d);for(const m of a){var u;const e=null===(u=i.getEntry({pointer:{table:O().ev,id:m,spaceId:s},userId:o.currentUser.id}))||void 0===u?void 0:u.value.value;if("column"!==(null==e?void 0:e.type))return;const t={...e,content:(e.content||[]).filter((e=>n.blockIds.has(e)))};l.setValue({table:O().ev,id:m,spaceId:s},t)}const p=[l];for(const m of n.blockIds){const e=(0,de().loadLocalSubtree)(o,{blockId:m,inMemoryRecordCache:i,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap;if(!e)return;p.push(e)}return F().RecordMap.merge(p)}function so(e){const{rootBlock:t,getRecordValue:o}=e,n=o(t);if(!n)return;const i=(0,I().zN)({block:n,getRecordValue:o});if(!i)return;const r=(0,fe().M9)({rootBlock:t,getRecordValue:o,formulasModule:S()}),a=(0,u().Dp)(i),s=Object.keys(a),l=Q().Ul(s,(e=>{const t=a[e];return t&&t.name||""}));let c="";for(const d of l){const e=a[d];if(e&&"title"!==d){const t=(0,b().sL)({property:d,schema:a,block:n,exportArgs:r,renderers:g().z});t&&(c+=`${e.name}: ${t}\n`)}}return c||void 0}function lo(e){const{treePath:t,textPosition:o,endpoint:n}=e,{store:i,index:r}=o,a=t.map((e=>e.value.store.pointer)),s=le().SL(o.store)?["properties","title"]:o.store.path,l=j().AI5(i.getValue(),r,r);return{copiedText:"end"===n?l.tokensBeforeRange:l.tokensAfterRange,textIndex:r,attributePath:s,pointerPath:a}}function co(e){var t;const{multiSelection:o,action:n,environment:i}=e;(0,ye().KP)(o)&&console.warn("Warning, serializeMultiTextSelectionToClipboardData() was called with a single-store text selection! This function should only be  called with a multi-selection that spans multiple blocks.");const r=null===(t=(0,Ie().ZS)({filterCommonAncestors:!0,multiSelection:o,focus:void 0}))||void 0===t?void 0:t.stores;if(!r)return;const a=o.start.store.inMemoryRecordCache,s=io({action:n,blocks:r,environment:i});if(0===s.blocks.length)return;const l=(0,Ie().Tp)({multiSelection:o,includeNonSelectable:!1});if(!l)return;const{treeRange:c}=l,d=[],u=new Map,p=(e,t)=>{t.forEach((e=>p(e,[])));const o=u.get(e),n=o&&o.length>t.length?o:t;u.set(e,n)},m=Ue().default.checkGate({gateName:"prefer_high_level_operations"});for(const{start:S,end:h}of c.iterateAnalogousNodes()){if(S){const e=S.childrenBeforeRange.slice(-1).concat(S.childrenInsideRange);p(S.parent,e)}if(h)if(p(h.parent,h.childrenInsideRange),m)for(const e of h.childrenAfterRange)d.push({command:"removeChild",path:["content"],pointer:h.parent.value.store.pointer,args:{id:e.value.store.id}});else d.push(B().op.set({pointer:h.parent.value.store.pointer,path:["content"],args:h.childrenInsideRange.map((e=>e.value.store.id))}))}const f=lo({textPosition:o.start,endpoint:"start",treePath:c.startPath}),g=lo({textPosition:o.end,endpoint:"end",treePath:c.endPath});d.push(...(0,fe().Qr)(f),...(0,fe().Qr)(g));for(const S of[null===(b=s.blocks[0])||void 0===b?void 0:b.blockSubtree,null===(v=s.blocks[s.blocks.length-1])||void 0===v?void 0:v.blockSubtree]){var b,v;S&&((0,R().applyOperationsToRecordMap)({recordMap:S,operations:d,updateOnly:!0}),m&&uo(i,a,S))}const k=(0,z().v)(c.commonAncestor,(e=>{const t=u.get(e);if(t)return{value:e.value.store.pointer,children:t}}));if(k)return{blockSelection:s,tree:k,multiTextSelection:{start:f,end:g},action:n};Ft("unexpected: trimming tree produced undefined")}function uo(e,t,o){const n=[];for(const{model:i}of o)if(i instanceof D().zgg&&!i.alive){n.push(i.pointer);const o=(0,de().loadLocalSubtree)(e,{blockId:i.pointer.id,inMemoryRecordCache:t,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap;if(o)for(const{pointer:e}of o)n.push(e)}for(const i of n)o.delete(i)}function po(e){const{environment:t,event:o}=e,n=C().JW();!function(e){const{environment:t,event:o,markdownLinkifyIt:n}=e;if(!o.clipboardData)return;const i=je().default.state.stores,r=$e().default.isEditingComment(),a=Fe().A.state.open,s=Re().wg(),l="empty"!==$e().default.state.mode&&$e().default.state.multiSelection,c=t.currentUser.id,u="copy"===o.type?"copy":"cut",p=me().ZO();p&&(0,V().Yt)(p.pointer,O().ev)&&to(o,Nt,zt,p.pointer);const m=l&&(0,ye().H7)(l);if(m&&m.selection.startIndex!==m.selection.endIndex){const e=he().A.getIntl(),{store:n,selection:i}=m,r=n.inMemoryRecordCache,a=n.getValue();if(Ft("copy: copying single-store text selection"),o.preventDefault(),a&&!Ro()){const e=n.table===O().ev?(0,Te().T)(n):void 0,t=e&&Q().n4(n.path,e.getBlockTitleStore().path)?e.getType():void 0,r=t&&(0,d().aO)(t)?t:void 0,s=a.filter((e=>!j().Br(e)));to(o,Ut,Gt,{blockType:r,editing:s,selection:i,action:u})}const s=j().Ffo(a,i.startIndex,i.endIndex),l=D().b4_.fromGetRecordValueFn(r.makeGetRecordValueFn(c)),p=r.makeGetRecordRoleFn(c),f=(0,L().r4)({intl:e,textValue:s,getRecordModel:l,userTimeZone:(0,x().P)(),externalIntegrations:We().A.integrations.state});o.clipboardData.setData("text/plain",(0,fe().Df)(t.device.isWindows,f));const g=Z().$e({textValue:s&&{value:s,spaceId:(0,N().e)(n.pointer.spaceId)},getRecordModel:l,getRecordRole:p,userTimeZone:(0,x().P)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:se().A.domainBaseUrl,publicDomainName:se().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,K().x0)(),intl:e,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:ve().QN,externalIntegrations:We().A.integrations.state,formulaValueTypes:[],emojiData:pe().A.state,isMobileNative:!1});return void o.clipboardData.setData("text/html",(0,fe().Df)(t.device.isWindows,g))}if(l&&!(0,ye().kM)(l)&&!r&&l.start.store.table===O().ev&&l.end.store.table===O().ev){const e=co({environment:t,multiSelection:l,action:u});if(e){Ft("copy: copying multi-text selection"),o.preventDefault(),to(o,Wt,qt,e);const{markdown:i,html:r}=(0,fe().Ij)({clipboardData:e,multiSelection:l,currentUserId:c,isWindows:t.device.isWindows,markdownLinkifyIt:n,markdownSerializationOptions:{transformBlockMapping:{image:Ue().default.checkGate({gateName:"docs_clipboard_imagedata"})?mo:void 0}},formulasModule:S()});return i&&o.clipboardData.setData("text/plain",i),void(r&&o.clipboardData.setData("text/html",r))}}if(l&&!(0,ye().kM)(l)&&!r&&l.start.store.table===W().SN&&l.end.store.table===W().SN){Ft("copy: copying comment multi-text selection"),o.preventDefault();const e=(0,Ie().$W)(l),n=he().A.getIntl(),i=e.map((e=>{let{store:o,selection:i}=e;if(i.startIndex===i.endIndex)return;const r=o.inMemoryRecordCache,a=D().b4_.fromGetRecordValueFn(r.makeGetRecordValueFn(c)),s=r.makeGetRecordRoleFn(c),l=j().Ffo(o.getValue(),i.startIndex,i.endIndex);return{plainText:(0,L().r4)({intl:n,textValue:l,getRecordModel:a,userTimeZone:(0,x().P)(),externalIntegrations:We().A.integrations.state}),htmlContent:Z().$e({textValue:l&&{value:l,spaceId:(0,N().e)(o.pointer.spaceId)},getRecordModel:a,getRecordRole:s,userTimeZone:(0,x().P)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:se().A.domainBaseUrl,publicDomainName:se().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,K().x0)(),intl:n,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:Pe().SN(t),externalIntegrations:We().A.integrations.state,formulaValueTypes:[],emojiData:pe().A.state,isMobileNative:!1}),textValue:l}})).filter(ee().O9),r=i.map((e=>e.plainText)).join("\n\n"),a=`<div>${i.map((e=>e.htmlContent)).join("</div><div>")}</div>`;return o.clipboardData.setData("text/plain",(0,fe().Df)(t.device.isWindows,r)),void o.clipboardData.setData("text/html",(0,fe().Df)(t.device.isWindows,a))}if(i.length>0&&!r&&!s&&!a){Ft("copy: copying block selection"),o.preventDefault();const e=i[0],r=e.inMemoryRecordCache,a=io({blocks:i,environment:t,action:u});if(to(o,Ot,Kt,a),!e.isDefined())return;const s=Q().oE(i.map((e=>e.computeWithRecordValues((t=>{let{getRecordValueAndSubscribe:o}=t;return o(e)}))))),l=r.makeGetRecordValueFn(c),{markdown:d,html:p}=(0,fe().ZI)({rootBlock:{id:e.id,table:O().ev,spaceId:e.getSpaceId()},blockValues:s,getRecordValue:l,isWindows:t.device.isWindows,markdownLinkifyIt:n,formulasModule:S()});return d&&o.clipboardData.setData("text/plain",d),void(p&&o.clipboardData.setData("text/html",p))}Ft("copy: doing nothing")}(e),(0,fe().dk)(o,n),function(e){let{event:t,device:o,customEventId:n}=e;if(!t.clipboardData||!Xt(o))return;const i={};for(const s of jt)i[s]=t.clipboardData.getData(s);const r=t.clipboardData.getData("text/html");t.clipboardData.setData("text/html",`${r}${(0,fe().uE)(n)}`),Yt={id:n,mimeTypes:i};try{H().A.set(Qt,Yt)}catch(a){y().log({level:"error",from:"clipboardActions",type:"setVirtualClipboardData",error:{message:"Unable to persistently store virtual clipboard data."}})}}({event:o,device:t.device,customEventId:n})}function mo(e){const{block:t,exportArgs:o}=e,{getExportedRenderAsset:n}=o,{source:i}=D().Bj6.fromBlock(t).getProperties(),r=j().q4_(i),a=function(e){if(!e.file_ids)return;const t=Ae().K.findBlockFromId(e.id);if(!t)return;const o=t.getNode();if(!(o instanceof Element))return;const n=o.querySelector("img");if(!n)return;const i=document.createElement("canvas");i.width=n.width,i.height=n.height;const r=i.getContext("2d");if(!r)return;return r.drawImage(n,0,0,n.width,n.height),i.toDataURL()}(t)??n({fromBlockId:o.blockId,toFileURI:r}),s=A().qh(e)||A().Qw({block:t,exportArgs:o})||a;return{text:(0,m().rS)({url:r})?`![${s}](${a})`:`[${s}](${a})`,breakLines:!0,children:A().q5(e)}}async function fo(e){const{event:t,environment:o,markdownLinkifyIt:n}=e;ft().syncTextSelection();const i=je().default.state.stores,r=$e().default.isEditingComment(),a=me().fI(),s="editing"===$e().default.state.mode&&$e().default.state.multiSelection,{phase:l}=je().default.state;if(go({environment:o,event:t,disableSyncTextSelection:!0,markdownLinkifyIt:n}),s&&!(0,ye().kM)(s)){const e=s.start.store.getAncestorBlockStoreAtRootPath(),t=e?Oe().Uv.getMode(e):"default";Bt().createAndCommit({userAction:"clipboardActions.cutWithMaybeConfirmation",environment:o,canUndo:!0,perform:n=>{if("suggest"===t){const t=ae().RR(o,n,e);ae().rY({environment:o,multiSelection:s,transaction:n,discussionStore:t})}else mt().f0({environment:o,multiSelection:s,transaction:n})}})}else(l===je().SelectionPhase.Selected||s)&&i.length>0&&!r&&!a&&await Mt().Af({environment:o,blocks:i,shouldCheckSuggestEdit:!0});Ne().A.setKeyboardMode(!0)}function go(e){const{environment:t,event:o,disableSyncTextSelection:n,markdownLinkifyIt:i}=e;n||ft().syncTextSelection(),po({environment:t,event:o,markdownLinkifyIt:i}),Ne().A.setKeyboardMode(!0)}function bo(e){var t;const{environment:o,files:n,transaction:i,insertBelowBlockStore:r}=e,a=je().default.getCurrentRecordCache(),s=me().y0(o);if(!a)return;const l=je().default.state.stores,c=yt().$C({environment:o,files:n,inMemoryRecordCache:a,transaction:i,pageWidth:s,spaceId:0!==l.length?l[0].pointer.spaceId:null===(t=me().ZO())||void 0===t?void 0:t.pointer.spaceId});c.forEach((e=>{const t=e.getType();t&&et().v(o,{from:"paste",type:t,creating_block_id:e.id})})),So({environment:o,blocks:c,transaction:i,replaceEmptyTextBlock:!0,insertBelowBlockStore:r})}function vo(e){const{environment:t,store:o,tokens:n,index:i,transaction:r,multiTextSelection:a,disableEmbedMenu:l,selectAll:c}=e,d=(0,ye().H7)(a),u=d?{value:d.store.getValue()}:void 0,p=o.getAncestorBlockStoreAtRootPath(),m=p?Oe().Uv.getMode(p):"default";let g=n;($e().default.isEditingComment()||$e().default.isEditingCaption())&&(g=function(e){const{environment:t,tokens:o}=e,n=ko(o);if(n&&n.url===n.text){const e=(0,E().parseRoute)({url:n.url,baseUrl:se().A.domainBaseUrl,publicDomainName:se().A.publicDomainName,isMobile:t.device.isMobile,protocol:se().A.protocol,currentUrl:window.location.href});if("page"===e.name&&e.blockId){const t=j().ld4(e.scrollToBlockId??e.blockId,void 0);return[j().wmz(t),j().Ey_(" ")]}}return o}({environment:t,tokens:n})),mt().yr({environment:t,store:o,tokens:g,index:i,transaction:r,selectAll:c,editorMode:m});const b=ko(g);!l&&u&&b&&"suggest"!==m&&function(e){const{environment:t,hyperlink:o,oldTextValue:n}=e,i="editing"===$e().default.state.mode&&(0,ye().H7)($e().default.state.multiSelection),r=je().default.state;if(i&&r.stores.length>0){const e=i.store.getValue(),r=j().q4_(e),a=f().PE(r.substring(0,r.indexOf(o.text))).length,l=a+f().PE(o.text).length;if(i.store.isTable(O().ev)||i.store.isTable(W().SN)){if(Rt().p6({environment:t,blockStore:je().default.state.stores[0],textStore:i.store,textValueBeforePaste:n,url:o.url,urlSelection:{startIndex:a,endIndex:l}}))return;if(xt().Yf({environment:t,textStore:i.store,blockStore:je().default.state.stores[0],oldTextValue:n,url:o.url,urlSelection:{startIndex:a,endIndex:l}}))return}s().default.afterNextFlush((()=>{const e=o.url;It().p6({environment:t,textStore:i.store,oldTextValue:n,url:e,urlSelection:{startIndex:a,endIndex:l}})}))}}({environment:t,hyperlink:b,oldTextValue:u.value,transaction:r})}function ko(e){if(1!==e.length)return;const t=e[0];if(!j().BEe(t))return;const[o,n]=t;if(1!==n.length)return;const i=n[0];if(!j().sh$(i))return;return{text:o,url:j().cQR(i)}}function So(e){const{environment:t,blocks:o,transaction:n,replaceEmptyTextBlock:i,insertBelowBlockStore:r}=e,a=je().default.state.stores;if(1===a.length){const e=a[0];if(e.getType()&&e.isType(d().KK)&&function(e){if("editing"!==$e().default.state.mode||!$e().default.state.multiSelection)return!1;const t=(0,ye().H7)($e().default.state.multiSelection);if(!t)return!1;return t.store===e.getTitleStore()}(e)){const i=e.getContentStore(),r=Q().o8(o).reverse().map((e=>Tt().Hs({parentStore:i,prependStore:e,transaction:n}).childStore));return wt().td({environment:t,stores:r}),r}}return Mt().LE({environment:t,blocksToInsert:o,target:r?[r]:a,transaction:n,replaceEmptyTextBlock:i})}function ho(e,t,o,n){const i=(0,me().ZO)();if(!i)return;const r=je().default.state.stores,a=0!==r.length?r[0].pointer.spaceId:i.pointer.spaceId,l="suggest"===Oe().Uv.getMode(i,!0);let c=function(e,t){if("cut"!==t.action||!Ue().default.checkGate({gateName:"convert_cut_paste_to_move"}))return;const o="suggest"===Oe().Uv.getMode(e,!0),n=[];for(const i of t.blocks){const t=He().Bv.createChildStore(e,{table:O().ev,id:i.blockId});if(!t.isReady())return;const r=t.getModel();if(!r)return;if(r.getSpaceId()!==e.getSpaceId())return;if(!1!==r.alive)return;o&&!d().ei[r.getType()]||n.push(t)}return n}(i,t);if(!c){const o=JSON.stringify(t).length>_e().vs;c=t.blocks.reduce(((r,s)=>{var c,u,p,m,f,g;let{blockId:b,blockSubtree:v}=s;const k=He().Bv.createChildStore(i,{table:O().ev,id:b});let S;if(k.isDefined())S=k.getModel();else{const e=null==v?void 0:v.getValue({table:O().ev,id:b});S=e&&D().Bj6.fromBlock(e)}if(l&&S&&!d().ei[S.getType()])return r;if(null!==(c=S)&&void 0!==c&&c.isCollectionView()&&(null===(u=S)||void 0===u||!u.getCollectionPointer())&&(null===(p=S)||void 0===p?void 0:p.getSpaceId())!==a&&Ue().default.checkGate({gateName:"collections_xws"})){const t=Ct().Wv({environment:e,type:d().xd.text,inMemoryRecordCache:k.inMemoryRecordCache,transaction:n,spaceId:a});return mt().yr({environment:e,store:t.getBlockTitleStore(),tokens:[j().wmz(j().ld4(b,S.getSpaceId()))],index:0,transaction:n}),r.push(t),r}const h=!(i.isInsideTemplate()||Po()||i.isInsideFactoryOrDuplicateBlocksAction()||null!==(m=S)&&void 0!==m&&m.isTemplateVariableContainerBlock()),I=v&&a&&(null===(f=S)||void 0===f?void 0:f.getSpaceId())&&oe().Lw({sourceSpaceId:S.getSpaceId(),targetSpaceId:a,sourceBlockSubtree:v});if(v&&!o&&!I){const o=ce().localDuplicate({environment:e,sourceBlockId:b,targetBlockPointer:(0,ke().zP)({environment:e,table:O().ev,spaceId:a}),sourceBlockSubtree:v,targetInMemoryRecordCache:k.inMemoryRecordCache,options:{addCopyName:(0,Ce().A)(k),deepCopyTransclusionContainers:!1,resolveTemplateVariables:h,preventLegacyTransclusions:(0,Se().$J)()},transaction:n,shallowCopyNavigableBlock:!!t.wasSelectionFromSnapshot&&Ue().default.checkGate({gateName:"duplicate_snapshot_navigable_blocks_by_reference"})}).targetBlockStore,i=o.getType();return i&&et().v(e,{from:"paste",type:i,new_page_id:"page"===i?o.id:void 0,creating_block_id:o.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()}),r.push(o),r}if(t.wasSelectionFromSnapshot)return y().log({level:"warning",from:"clipboardActions",type:"pasteBlockSelection",data:{message:"Unable to locally duplicate pasted block selection from snapshot",miscDataToConvertToString:{blockId:b,blockType:k.getType(),blockSelectionTooBig:o,missingBlockSubtree:!v}}}),r;Ee().A.state.online||St().f1(he().A.formatMessage(Vt.offlineError));const{blockStores:x,onComplete:T}=ce().serverDuplicate({environment:e,sourceBlocks:[{id:b,spaceId:(0,N().e)(null===(g=S)||void 0===g?void 0:g.getSpaceId())}],targetInMemoryRecordCache:k.inMemoryRecordCache,transaction:n,options:{addCopyName:(0,Ce().A)(k),deepCopyTransclusionContainers:!1,resolveTemplateVariables:h,convertExternalObjectInstancesToPlaceholders:!1},targetSpaceId:(0,N().e)(a),userActionSuffix:v&&o?" (forceServerSideCopy)":void 0}),C=x[0],M=C.getType();return T.then((o=>{if("error"===o.status){const n=o.error;oe().Rk(n)?t.blocks.length>1?oe().UK(e,{product:n.clientData.metadata.product}):oe().yj({product:n.clientData.metadata.product}):St().f1(o.errorMessage)}else M&&et().v(e,{from:"paste",type:M,new_page_id:"page"===M?C.id:void 0,creating_block_id:C.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()})})),r.push(C),r}),[])}if(l){const t=ae().RR(e,n,c[0]),o=[];c.forEach((e=>{const i={type:"insert",id:C().JW(),discussionId:t.id};ae().tM(n,e,i),o.push(e.id)})),n.preEnqueueActions.push((()=>{ae().c3({environment:e,transaction:n,discussionStore:t,addModifiedBlockIdsAfter:o})})),Dt().Ug({environment:e,blocks:c,annotation:[j().Ifu.SuggestionInsertText,t.id],transaction:n})}So({environment:e,blocks:c,transaction:n,replaceEmptyTextBlock:!0});const u=je().default.state.stores,p=u.length>0?u:[i],m=t.blocks.map((e=>{const t=p.length>0?p[0]:function(e){return e.isCollectionView()?e.getCollectionStore()||e:e.getContentStore()}(i);return He().Bv.createChildStore(t,{table:O().ev,id:e.blockId})}));s().default.afterNextFlush((async()=>{await Promise.all(p.map((e=>e.waitUntil((()=>{const t=e.getType();return Boolean(t&&t!==d().xd.copyIndicator)}))))),await Promise.all(m.map((e=>e.load()))),o&&nt().ei({environment:e,blocks:p,pageSource:o,copiedStores:m,action:t.action,wasContiguousSelection:t.wasContiguousSelection,rootStore:i})&&nt().gi({environment:e,copiedStores:m,blocks:p,pageSource:o})}))}function yo(e){const{environment:t,disableEmbedMenu:o,transaction:n,overwrite:i,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,text:l,tinyMceMicrosoftWordPasteFilter:c}=e,d=l.includes("\n"),u=$e().default.state,p=Bo(u);d&&"inline"!==p||"editing"!==u.mode?i?(n.logDebugMessage("paste: pasting as markdown overwrite"),function(e){const{environment:t,text:o,transaction:n,selectAll:i,markdownOptions:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s}=e,l=ro({markdown:o,markdownOptions:r,markdownLinkifyIt:a});if(!l)return;let c=xo({environment:t,html:l,wrapInEmptyBlocks:!1,tinyMceMicrosoftWordPasteFilter:s});c||(c=xo({environment:t,html:l,wrapInEmptyBlocks:!0,tinyMceMicrosoftWordPasteFilter:s}));if(!c)return;gt({environment:t,clipboardData:c,transaction:n,allowPasteIntoHeaderWithoutChildren:!0,selectAll:i,preventLegacyTransclusions:(0,Se().$J)()})}({environment:t,text:l,transaction:n,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})):l&&(n.logDebugMessage("paste: pasting as markdown append"),function(e){const{environment:t,text:o,transaction:n,markdownOptions:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=ro({markdown:o,markdownOptions:i,markdownLinkifyIt:r});if(s)Mo({environment:t,html:s,transaction:n,tinyMceMicrosoftWordPasteFilter:a})}({environment:t,text:l,transaction:n,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})):(n.logDebugMessage("paste: pasting as inline markdown"),function(e){const{environment:t,text:o,disableEmbedMenu:n,transaction:i,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l}=e,c="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(c){const e=(0,ye().H7)(c);if(e&&function(e){const t=$e().default.state;return"editing"===t.mode&&!(0,ye().kM)(t.multiSelection)&&(0,ye().KP)(t.multiSelection)&&_().t(e,"url")}(o))Fo({environment:t,text:o,transaction:i,editingSelection:e,selectAll:r});else if((0,we().B1)("c")){const e=(0,Te().T)(c.start.store);mt().$D({environment:t,editorMode:e?Oe().Uv.getMode(e):"default",multiSelection:c,string:o,disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:i,selectAll:r})}else{const e=s&&A().Z4({...s,markdown:o,plugin:null==a?void 0:a.plugin});if(!e)return;Co({environment:t,html:e,transaction:i,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:n,selectAll:r,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})}}}({environment:t,text:l,disableEmbedMenu:o,transaction:n,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c}))}function Io(e,t){const o=e.getValue({table:O().ev,id:t});if(!o)return;const n={table:O().ev,id:t,spaceId:o.space_id},i=(o.content??[]).map((t=>Io(e,t))).filter(ee().O9);return new(z().PH)(n,i)}function xo(e){var t,o,n,i;const r=me().ZO(),{html:s,wrapInEmptyBlocks:l,tinyMceMicrosoftWordPasteFilter:c,environment:d}=e,u=_o({environment:d,html:s,tinyMceMicrosoftWordPasteFilter:c,useCrdt:!1});if(!u)return;const{currentUserStore:p}=Ve().default.state;if(!p)return;let{allOperations:m,rootContentIds:f}=u;if(l){const e=wo(d),t=wo(d);if(!e||!t)return;m=[e.operation,...m,t.operation],f=[e.id,...f,t.id]}const g=F().RecordMap.create();(0,R().applyOperationsToRecordMap)({recordMap:g,operations:m,updateOnly:!1});const b=[],v=function(e){const{name:t,userId:o,recordMap:n}=e,i=F().RecordMapWithRole.create();for(const{pointer:r,model:a}of n)i.setModelAndRole(r,a,"reader");return new(a().A)({name:t,data:new(J().b)({[o]:i})})}({name:"htmlToMultiTextSelectionClipboardData",userId:p.id,recordMap:g});for(const a of f){const e=(0,de().loadLocalSubtree)(d,{blockId:a,inMemoryRecordCache:v,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap;b.push({blockId:a,blockSubtree:e})}const k=new(z().PH)({...(0,ke().zP)({environment:d,table:O().ev,spaceId:null==r?void 0:r.pointer.spaceId})},f.map((e=>Io(g,e))).filter(ee().O9));if(0===k.children.length)return;const S=k.children[0],h=null===(t=(0,z().Qe)([k],(e=>e===S)))||void 0===t?void 0:t.map((e=>e.value)),y=null===(o=g.getValue(S.value))||void 0===o||null===(o=o.properties)||void 0===o?void 0:o.title,I=(0,z().wI)(k),x=null===(n=(0,z().Qe)([k],(e=>e===I)))||void 0===n?void 0:n.map((e=>e.value)),T=null===(i=g.getValue(I.value))||void 0===i||null===(i=i.properties)||void 0===i?void 0:i.title,C=T?j().q4_(T).length:0;return y&&h&&T&&x?{blockSelection:{blocks:b,wasContiguousSelection:!0,action:"copy"},tree:k,multiTextSelection:{start:{textIndex:0,copiedText:y,attributePath:["properties","title"],pointerPath:h},end:{textIndex:C,copiedText:T,attributePath:["properties","title"],pointerPath:x}},action:"copy"}:void 0}function To(e){const{text:t,html:o,stripText:n,stripSurroundingWhitespace:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=o||(t?ro({markdown:t,markdownLinkifyIt:r}):void 0);if(!s)return;if(Ue().default.checkGate({gateName:"paste_links_as_mentions"})){const e=(0,fe().Lj)(s);if(e)return[j().wmz(j().ld4(e.id,e.spaceId),[])]}const l=document.createElement("div");return l.innerHTML=Do({html:s,tinyMceMicrosoftWordPasteFilter:a}),T().Hw({node:l,window,stripText:n,stripSurroundingWhitespace:i,emojiData:pe().A.state})}function Co(e){const{environment:t,html:o,transaction:n,stripText:i,stripSurroundingWhitespace:r,disableEmbedMenu:a,selectAll:s,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c}=e,d="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(d){const e=To({html:o,stripText:i,stripSurroundingWhitespace:r,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c});if(!e)return;const u=(0,Te().T)(d.start.store),p=1===e.length;if(p){if(p&&(!e[0][1]||0===e[0][1].length)){n.logDebugMessage("pasteInlineHtml: insertString");const o=e[0][0];return void mt().$D({environment:t,editorMode:u?Oe().Uv.getMode(u):"default",multiSelection:d,string:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:n,selectAll:s})}const o=(0,ye().H7)(d);if(o&&!(0,ye().kM)(d)){const[,i]=e[0],r=i&&j().VtW(i);if(r){n.logDebugMessage("pasteInlineHtml: pasteLinkOverText");return void Fo({environment:t,text:j().cQR(r),transaction:n,editingSelection:o,selectAll:s})}}}n.logDebugMessage("pasteInlineHtml: delete selection and insert"),mt().f0({environment:t,multiSelection:d,transaction:n}),vo({environment:t,store:d.start.store,tokens:e,index:d.start.index,transaction:n,disableEmbedMenu:a,multiTextSelection:d,selectAll:s})}}function Mo(e){const{environment:t,html:o,transaction:n,tinyMceMicrosoftWordPasteFilter:i}=e,r=me().ZO();if(!r)return;const a=_o({environment:t,html:o,tinyMceMicrosoftWordPasteFilter:i,useCrdt:r.useCrdt()});if(!a)return;const{allOperations:l,rootContentIds:c}=a;for(const s of l)if((0,$().ph)(s)){const e=He().Bv.createChildStore(r,s.pointer);Bt().applyCrdtTextOperation({store:e,operation:s,invertedOperation:void 0,transaction:n})}else if((0,B().$Y)(s)){const e=(0,He().Oo)(r,s.pointer);Bt().applyOperation({store:e,operation:s,transaction:n})}else(0,ee().HB)(s);const u=c.map((e=>He().Bv.createChildStore(r,{table:O().ev,id:e})));u.forEach((e=>{const o=e.getType();o&&et().v(t,{from:"paste",type:o,creating_block_id:e.id,parent_collection_id:e.getParentCollectionIdUpToTwoLevels()})}));const p=So({environment:t,blocks:u,transaction:n,replaceEmptyTextBlock:!0}).slice().reverse();return s().default.afterNextFlush((()=>{const e=p.map((e=>{if(e.getType()!==d().xd.text)return;const o=ko(e.getTitleValue());if(!o)return;const n=(0,E().parseRoute)({url:o.url,baseUrl:se().A.domainBaseUrl,publicDomainName:se().A.publicDomainName,isMobile:t.device.isMobile,protocol:se().A.protocol,currentUrl:window.location.href});return"page"===n.name?n:void 0})).filter(ee().O9);nt().T_({environment:t,rootStore:r,blocks:p,copiedLinks:e})||nt().Tw({environment:t,blocks:p})})),u}function wo(e){const{currentUserStore:t}=Ve().default.state,o=me().ZO();if(!t||!o)return;const n=t.id;if(!n)return;const i=o.id,r=o.pointer.spaceId,a=(0,ke().Z1)({environment:e,table:O().ev,spaceId:r});return{operation:{pointer:{table:"block",id:a,spaceId:r},command:"set",path:[],args:{id:a,version:1,type:"text",properties:{title:[[""]]},parent_id:i,parent_table:"block",space_id:r,created_by_table:"notion_user",created_by_id:n,created_time:Date.now(),last_edited_by_table:"notion_user",last_edited_by_id:n,last_edited_time:Date.now(),alive:!0}},id:a}}function _o(e){const{environment:t,useCrdt:o,...n}=e,i=document.createElement("div");i.innerHTML=Do(n);const{currentUserStore:r}=Ve().default.state,a=me().ZO();if(!r||!a)return;const s=r.getValue();if(!s)return;const c=a.getSpaceId(),d=(0,ke().Gx)({environment:t,spaceId:c}),u=t.idCreator.getSpaceShortIdCreator(c,d);return T().aH({actor:(0,l().A7)(s),parent:{id:a.id,table:O().ev,spaceId:c},rootNode:i,deps:{importFileMap:{},window,intl:he().A.getIntl(),randomID:Y().Ay,spaceIdCreator:u,randomShortID:X().Ay,isPhoneNumber:P().W,emojiData:pe().A.state},options:{useCrdt:o,ignoreBlockCount:!1}})}function Ao(e){return/schemas-microsoft-com:office/.test(e)||/xmlns:m="http:\/\/schemas.microsoft.com\/office\/2004\/12\/omml"/.test(e)}function Do(e){const{html:t,tinyMceMicrosoftWordPasteFilter:o}=e;return i().sanitize(o&&Ao(t)?o(t):t)}function Bo(e){const t="editing"===e.mode&&e.multiSelection;if(!t)return;const o=De().n.findEditableWithStore(t.start.store),n=null==o?void 0:o.props;return n&&!n.disabled?n.pasteBehavior:void 0}function Ro(){var e;if("editing"!==$e().default.state.mode)return;const t=$e().default.state.multiSelection.start,o=t.store.path;if("formula"!==o[o.length-1])return;const n=t.store.getRecordStoreAtRootPath();if((null==n?void 0:n.table)!==O().ev)return;const i=null==n||null===(e=n.getPropertiesStore())||void 0===e||null===(e=e.getValue())||void 0===e||null===(e=e.collection_id)||void 0===e||null===(e=e[0])||void 0===e?void 0:e[0];if(!i)return;const r={table:U().Vl,id:i,spaceId:n.getSpaceId()},a=n.getRecordModel(r);return a?{parentCollection:a,start:t,getRecordModel:n.getRecordModel}:void 0}function Po(){const e=je().default.state.stores;if("editing"!==$e().default.state.mode)return e.length>0&&e[0].isInsideFactoryOrDuplicateBlocksAction();if(0===e.length)return!1;const{multiSelection:t}=$e().default.state,o=t.start.store;if(!o.isTable(O().ev))return!1;const n=be().E(o);return Boolean(n)}function Fo(e){const{text:t,transaction:o,environment:n,editingSelection:i,selectAll:r}=e,a=(0,E().parseRoute)({url:t,baseUrl:se().A.domainBaseUrl,publicDomainName:se().A.publicDomainName,isMobile:n.device.isMobile,protocol:se().A.protocol,currentUrl:window.location.href}),s="page"===a.name&&a.blockId?(0,M().wv)({pageId:a.blockId,peekViewBlockId:a.peekViewBlockId,peekMode:a.peekMode,discussionId:a.discussionId,scrollToBlockId:a.scrollToBlockId,collectionViewId:a.collectionViewId}):t,l=mt().di({environment:n,store:i.store,selection:i.selection,transaction:o});mt().gw({environment:n,store:i.store,selection:l,annotationKey:"a",transaction:o,updateSelection:!1}),Dt().Mw({environment:n,store:i.store,selection:l,annotation:["a",s],transaction:o}),ft().setSelection({store:i.store,selection:{startIndex:r?l.startIndex:l.endIndex,endIndex:l.endIndex}})}const Vo=/\<\!-- wp:/;const Lo=/\u2028/g,Eo=["slack/texty"];function Oo(e){var t;let{environment:o,event:i,disableEmbedMenu:r,transaction:a,onPasteFiles:s,formulasModule:l,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u}=e;const p=Ue().default.checkGate({gateName:"allow_cut_copy_comment"});if(i.preventDefault(),ft().syncTextSelection(),!i.clipboardData)return;const m=eo(i.clipboardData,o.device),g=Array.from(Array((null===(t=m.items)||void 0===t?void 0:t.length)??0).keys()).flatMap((e=>{var t;const o=m.items[e];if("file"!==o.kind)return[];const n=null===(t=o.getAsFile())||void 0===t||null===(t=t.name.match(/\.[^.]+$/))||void 0===t?void 0:t[0];return n?[n]:[]})),b=m.getData("text/html"),v=null==b?void 0:b.length;!function(e,t){let{source:o,types:n,fileExtensions:i,htmlContent:r}=t;const a=[...n];a.sort();const s=i.map((e=>e.toLowerCase()));tt().vd(e,"paste",{source:o,types:a,file_extensions:s,original_html_content_size:r.length})}(o,{source:"editor",types:m.types||[],fileExtensions:g,htmlContent:b});const{text:k,html:S,multiTextSelectionData:y,textSelectionData:I,blockSelectionData:T,isFromMicrosoftOffice:C,isHtmlTable:M}=no({clipboardData:m,tinyMceMicrosoftWordPasteFilter:u}),w=oo(m,Nt,zt),_=function(e){return e.clipboardData?e.clipboardData.items?Q().oE(Array.from(e.clipboardData.items).map((e=>{const t=e.getAsFile();if(t&&t.size>0)return new File([t],t.name??he().A.formatMessage(Vt.untitled),{type:e.type})}))):f().PE(e.clipboardData.files):[]}(i),A=Bo($e().default.state),D=(null==T?void 0:T.action)||(null==y?void 0:y.action)||(null==I?void 0:I.action);a.annotateWithUserAction("cut"===D?"paste.from_cut":fe().Vz);const B=k.includes("\n"),R="body"===(0,we().X4)()&&!I;if((_.length>0||T||B&&!R)&&!(0,Ze().EF)(o))return;const P=function(e){const t=oo(e,Ht,Jt),o=null==t?void 0:t.mode;if(!o)return;return Et[o]||"Plain Text"}(m),F=B&&P&&"inline"!==A&&!(0,we().X4)()?Uo({codeLanguage:P,environment:o,transaction:a}):void 0;Ge().oF(o,{pastedText:k,source:"editor_paste"});const V=Re().wg(),L=Re().KR(),E=i.clipboardData.getData(ie().sE),O=Ro();if(_.length>0&&!C&&!M)a.logDebugMessage("paste: file/image detected -> onPasteFiles"),s({environment:o,files:_,transaction:a});else if(R)a.logDebugMessage("paste: editing code block contents with no Notion text selection -> pasteRawText"),Wo(o,k,a);else if(F)a.logDebugMessage("paste: pasting code in existing empty text block with no selection or new code block after selection  -> pasteRawText"),Wo(o,k,a);else if(O){a.logDebugMessage("paste: formulaInformation detected, attempting to paste as formula");const{parentCollection:e,start:t}=O,n=[[k]],i=e;if(!i||!l)return void Wo(o,k,a);const r=$e().default.state;"multiSelection"in r&&mt().f0({environment:o,multiSelection:r.multiSelection,transaction:a});const s=(0,h().K5)({formulasModule:l,getRecordModel:O.getRecordModel,sourceCollection:i,textValue:n,featureGates:(0,ge().i)()});mt().yr({environment:o,tokens:s,store:t.store,index:t.index,transaction:a})}else if("plaintext"===A)a.logDebugMessage("paste: plaintext paste behavior detected, pasting as inline html"),Co({environment:o,html:k,transaction:a,stripText:!0,stripSurroundingWhitespace:!0,disableEmbedMenu:r,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u}),Ye({environment:o,type:"plaintext",originalHtmlContentSize:v});else if(y){a.logDebugMessage("paste: multiTextSelectionData detected, attempting to paste as textselection");const e=function(e){const{environment:t,transaction:o,multiTextSelectionData:n,disableEmbedMenu:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=e.pasteBehavior||"inline",l=e.html||ro({markdown:e.text,markdownLinkifyIt:r});if("editing"===$e().default.state.mode)switch(s){case"inline":return!!l&&(Co({environment:t,html:l,transaction:o,stripText:!1,stripSurroundingWhitespace:!0,disableEmbedMenu:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}),!0);case"block":return gt({environment:t,clipboardData:n,transaction:o,preventLegacyTransclusions:(0,Se().$J)()});default:(0,ee().HB)(s)}}({multiTextSelectionData:y,environment:o,html:S,text:k,transaction:a,disableEmbedMenu:r,pasteBehavior:A,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u});e||(a.logDebugMessage("paste: could not paste as textSelection -> paste as blockSelection"),ho(o,y.blockSelection,w,a))}else if(I&&I.editing){a.logDebugMessage("paste: textSelectionData detected, pasting text selection");const e=(0,ne().dr)(),t=(null==w?void 0:w.id)!==(null==e?void 0:e.id);!function(e){const{environment:t,textSelectionData:o,transaction:n,disableEmbedMenu:i,removeDiscussions:r}=e,a=je().default.getCurrentRecordCache(),{editing:s,selection:l}=o;let{tokensInsideRange:c}=j().AI5(s,l.startIndex,l.endIndex);c=j().Uee(c,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:r??!0});const u=(0,me().ZO)();if(u&&!(u.isInsideTemplate()||Po()||u.isInsideFactoryOrDuplicateBlocksAction())&&(c=(0,G().f$)(c,{currentUserId:t.currentUser.id,currentTimeZone:(0,x().P)()})),"body"===(0,we().X4)()){const e=j().Cc8(c);e&&(c=e)}const p="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(p){if(!(0,ye().kM)(p)){const t=(0,ye().H7)(p);if(t){const n=j().Ffo(o.editing,o.selection.startIndex,o.selection.endIndex);if(1===n.length){const[o,i]=n[0],r=i&&j().VtW(i);if(r){const n=j().cQR(r);if([o,`http://${o}`,`https://${o}`].includes(n))return void Fo({environment:e.environment,text:n,transaction:e.transaction,editingSelection:t})}}}}const r=(0,Te().T)(p.start.store),a=r?Oe().Uv.getMode(r):"default";if("suggest"===a){const e=ae().RR(t,n,p);ae().rY({environment:t,multiSelection:p,transaction:n,discussionStore:e}),c=j().Mwp({textValue:c,selection:{startIndex:0,endIndex:1/0},annotation:[j().Ifu.SuggestionInsertText,e.id]})}else"default"===a&&mt().f0({environment:t,multiSelection:p,transaction:n});const s=$e().default.state;if("editing"===s.mode){const e=s.multiSelection;if(o.blockType&&0===l.startIndex){const i=(0,Te().T)(e.start.store);i&&"page"!==o.blockType&&(0,xe().P4)(i)&&ue().transformBlocks({environment:t,blocks:[i],blockType:o.blockType,transaction:n})}vo({environment:t,store:e.end.store,tokens:c,index:e.end.index,transaction:n,disableEmbedMenu:"suggest"===a||i,multiTextSelection:p})}}else if(a){var m;const e=je().default.state.stores,o=Ct().Wv({environment:t,type:d().xd.text,inMemoryRecordCache:a,transaction:n,spaceId:0!==e.length?e[e.length-1].pointer.spaceId:null===(m=me().ZO())||void 0===m?void 0:m.pointer.spaceId}),i=o.getTitleStore();i&&mt().yr({environment:t,store:i,tokens:c,index:0,transaction:n}),So({environment:t,blocks:[o],transaction:n,replaceEmptyTextBlock:!1}),et().v(t,{from:"paste",type:d().xd.text,creating_block_id:o.id,parent_collection_id:o.getParentCollectionIdUpToTwoLevels()})}}({environment:o,textSelectionData:I,transaction:a,disableEmbedMenu:r,removeDiscussions:!p||("copy"===D||t)})}else if(T&&T.blocks.length>0&&"inline"!==A)a.logDebugMessage("paste: blockSelectionData detected, pasting block selection"),ho(o,T,w,a);else if(V&&L&&E){const{simpleTableStore:e}=V.getProps(),{selection:t}=L,r=Re().$O(e);t&&r&&At().GZ({clipboardActions:n,environment:o,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:r,event:i,transaction:a,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u})}else if(S)if(V&&L){const{simpleTableStore:e}=V.getProps(),{selection:t}=L,r=Re().$O(e);t&&r&&(a.logDebugMessage("paste: pasting selection into simple table"),At().GZ({clipboardActions:n,environment:o,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:r,event:i,transaction:a,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u}))}else(B||M)&&"inline"!==A?(a.logDebugMessage("paste: pasting as html"),Mo({environment:o,html:S,transaction:a,tinyMceMicrosoftWordPasteFilter:u}),Ye({environment:o,type:"html",originalHtmlContentSize:v})):(a.logDebugMessage("paste: pasting as inline html"),Co({environment:o,html:S,transaction:a,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:r,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u}),Ye({environment:o,type:"inline_html",originalHtmlContentSize:v}));else a.logDebugMessage("paste: pasting as markdown"),yo({environment:o,text:k,disableEmbedMenu:r,transaction:a,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:u}),Ye({environment:o,type:"markdown",originalHtmlContentSize:v});Ne().A.setKeyboardMode(!0)}function Uo(e){const{codeLanguage:t,environment:o,transaction:n}=e,i=$e().default.state,r="editing"===i.mode&&i.multiSelection,a=je().default.state.stores;if(!r&&0===a.length)return;let s,l,c;if(r?(s=r.start.store,l=r.end.store,c=(0,Te().T)(l)):(s=a[0],l=a[a.length-1],c=l),!c)return;let u=c;if((0,xe().P4)(c))!function(e){const{blockStore:t,environment:o,transaction:n,codeLanguage:i}=e;ue().transformBlocks({environment:o,blocks:[t],blockType:"code",transaction:n}),kt().IA({blocks:[t],language:i,transaction:n})}({blockStore:c,environment:o,transaction:n,codeLanguage:t});else{const e=(0,Te().T)(c);if(!e)return;const t=s.inMemoryRecordCache;if(!t)return;u=Ct().Wv({environment:o,type:d().xd.code,inMemoryRecordCache:t,transaction:n,spaceId:e.pointer.spaceId}),Tt().WH({parentStore:e.getContentStore(),afterStore:l,insertStore:u,transaction:n})}Me().clear(o);const p=(0,Te().aI)(u);return p&&ft().setSelectionAtStart({store:p}),u}function Wo(e,t,o){const n="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(n){const i=(0,Te().T)(n.start.store);mt().$D({environment:e,editorMode:i?Oe().Uv.getMode(i):"default",multiSelection:n,string:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:o})}}function No(e){const t=e.getNavigableBlockStore();if(t)return(0,ve().J8)({store:t,scrollToBlockId:t.id===e.id?void 0:e.id,fullyQualified:!0,pageVisitSource:c().y8.CopyLink,embedded:!1})}function Ho(e){const{environment:t,blocks:o,callback:n}=e,i=o[0];(0,re().y)(),Be().wr();const r=No(i);if(r){zo({environment:t,stringValue:r,copiedMessage:i.isPageBlock()||i.isFormBlock()?Lt.copiedLinkToClipboard:Lt.copiedBlockLinkToClipboard}).then(n)}}function jo(e){const{environment:t,blocks:o,callback:n}=e,i=o[0];(0,re().y)(),Be().wr();const r=No(i),a=function(e,t){var o;const n=No(t);if(!n)return;const i=e.currentUser.id,r=(0,b()._z)({blockId:t.id,intl:he().A.getIntl(),getRecordValue:t.inMemoryRecordCache.makeGetRecordValueFn(i),userTimeZone:(0,x().P)()}),a=null===(o=t.getBlockIconStore())||void 0===o?void 0:o.getValue(),s=[(0,w().A)(a)?a:void 0,r].filter(ee().O9).join(" ");if(!s)return n;let l=`<a href="${n}"><span>${s}</span></a>`;return Ue().default.checkGate({gateName:"paste_links_as_mentions"})&&(l+=(0,fe().a0)({id:t.id,spaceId:t.getSpaceId()})),l}(t,i);if(r&&a){Go({environment:t,stringValue:r,htmlValue:a,copiedMessage:i.isPageBlock()?Lt.copiedPageLinkToClipboard:i.isFormBlock()?Lt.copiedFormLinkToClipboard:Lt.copiedBlockLinkToClipboard}).then(n)}}function $o(e){const{environment:t,blocks:o,callback:n}=e;if(o.length<2)return Ho(e);(0,re().y)(),Be().wr();const i=o.map(No).filter(ee().O9);if(i.some(Boolean)){const e=i.length>1?Lt.copiedLinksToClipboard:Lt.copiedLinkToClipboard;zo({environment:t,stringValue:i.join("\n\n"),copiedMessage:e}).then(n)}}function Zo(e){const{environment:t,blocks:o,callback:n}=e,i=o[0];if(!i.isDefined())return;const r=i.getModel(),a=i.getProperties(),s=i.getFormat();let l;if(i.isType(d().xd.bookmark))l=j().q4_(a.link);else if((0,d().ie)(r.type))l=j().q4_(a.source);else if(i.isType(d().xd.externalObjectInstance)||i.isType(d().xd.externalObjectInstancePage))l=(null==s?void 0:s.original_url)||(null==s?void 0:s.uri);else if(i.isType(d().xd.collectionView)){var c;const e=null===(c=i.getCollectionStore())||void 0===c?void 0:c.getValue();var u;if(e&&(0,v().ek)(e))l=null===(u=e.format)||void 0===u?void 0:u.original_url}else{if(!i.isType(d().xd.alias))return;l=null==s?void 0:s.comment_alias_url}if(!l)return;if(k()._J(l))return void y().log({level:"error",from:"clipboardActions",type:"copyDirectLinkToContent",error:{message:"Attempted to copy a direct signed url for S3-housed content."}});if(l=te().q7(l),!l)return;(0,re().y)(),Be().wr();zo({environment:t,stringValue:l,copiedMessage:Lt.copiedLinkToClipboard}).then(n)}function Go(e){return Jo(e)}function zo(e){return Jo(e)}async function Jo(e){const{environment:t,htmlValue:o,stringValue:n,copiedMessage:i,showCopyModal:r}=e;function a(){wt().IU({environment:t}),Le().A.setState({...Le().A.state,active:!0,stringValue:n})}if(r)a();else try{var s;if(t.device.isElectron&&null!==(s=ht().electronApi)&&void 0!==s&&null!==(s=s.clipboard)&&void 0!==s&&s.write){const e={text:n};o&&(e.html=o),await ht().electronApi.clipboard.write(e)}else if("undefined"==typeof ClipboardItem)await navigator.clipboard.writeText(n);else{const e={"text/plain":new Blob([n],{type:"text/plain"})};o&&(e["text/html"]=new Blob([o],{type:"text/html"}));const t=new ClipboardItem(e);await navigator.clipboard.write([t])}i&&_t().D6({label:he().A.formatMessage(i)})}catch{a()}}function qo(){document.queryCommandSupported("copy")&&document.execCommand("copy")}async function Ko(e,t){let o;o="string"==typeof t?t:JSON.stringify(t),o&&await zo({environment:e,stringValue:o,copiedMessage:Lt.copiedToClipboard})}function Qo(e){const{environment:t,textSelection:o,markdownSerializationOptions:n,markdownLinkifyIt:i}=e,r=(0,ye().H7)(o);if(r&&r.selection.startIndex!==r.selection.endIndex)return function(e){const{environment:t,singleStoreTextSelection:o,markdownSerializationOptions:n}=e,{store:i,selection:r}=o,a=t.currentUser.id,s=i.inMemoryRecordCache,l=he().A.getIntl(),d=i.getValue(),u=j().Ffo(d,r.startIndex,r.endIndex),m=i.getRecordStoreUIRoot().getValue();if(!m)return;const f={id:m.id,table:O().ev,spaceId:m.space_id},g=s.makeGetRecordValueFn(a);return A().ZR({textValue:u,exportArgs:{root:f,navigableBlockId:f.id,renderParentBlockId:void 0,blockId:f.id,userTimeZone:(0,x().P)(),intl:l,getRecordValue:g,getRecordModel:D().b4_.fromGetRecordValueFn(g),numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,p().A)({pageId:t,pageValue:g({table:O().ev,id:t}),baseUrl:se().A.domainBaseUrl,pageVisitSource:c().y8.Export})},baseUrl:se().A.domainBaseUrl,publicDomainName:se().A.publicDomainName,transformAnnotation:null==n?void 0:n.transformAnnotation,transformBlockMapping:null==n?void 0:n.transformBlockMapping,resultCache:new Map,regExpCache:new Map,experimentService:Ue().default,collectionFeatureGates:(0,ge().i)(),formulasModule:S()}})}({environment:t,singleStoreTextSelection:r,markdownSerializationOptions:n});const a=co({environment:t,multiSelection:o,action:"copy"});if(!a)return;const{markdown:s}=(0,fe().Ij)({clipboardData:a,multiSelection:o,currentUserId:t.currentUser.id,isWindows:t.device.isWindows,markdownSerializationOptions:n,markdownLinkifyIt:i,formulasModule:S()});return s}function Yo(e){const{environment:t,inMemoryRecordCache:o,text:n,transaction:i,markdownOptions:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s,parentPointer:c}=e,d=ro({markdown:n,markdownOptions:r,markdownLinkifyIt:a});if(!d)return;const u=document.createElement("div");u.innerHTML=Do({html:d,tinyMceMicrosoftWordPasteFilter:s});const{currentUserStore:p,currentSpaceStore:m}=Ve().default.state;if(!p||!m)return;const f=p.getValue();if(!f)return;const g=(me().ZO()??m).id,b=m.id,v=(0,ke().Gx)({environment:t,spaceId:b}),k=t.idCreator.getSpaceShortIdCreator(b,v),{allOperations:S,rootContentIds:h}=T().aH({actor:(0,l().A7)(f),parent:c??{id:g,table:O().ev,spaceId:m.id},rootNode:u,deps:{importFileMap:{},window,intl:he().A.getIntl(),randomID:Y().Ay,spaceIdCreator:k,randomShortID:X().Ay,isPhoneNumber:P().W,emojiData:pe().A.state},options:{useCrdt:(0,le().D8)(m),ignoreBlockCount:!1}});for(const l of S)if((0,$().ph)(l)){const e=new(He().Bv)(t,l.pointer,{inMemoryRecordCache:o,userId:f.id});Bt().applyCrdtTextOperation({store:e,operation:l,invertedOperation:void 0,transaction:i})}else if((0,B().$Y)(l)){const e=new(He().pm)({environment:t,pointer:l.pointer,recordStoreOptions:{inMemoryRecordCache:o,userId:f.id}});Bt().applyOperation({store:e,operation:l,transaction:i})}else(0,ee().HB)(l);return h.map((e=>new(He().Bv)(t,{table:O().ev,id:e},{inMemoryRecordCache:o})))}function Xo(e){const{event:t,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}=e;if(!t.clipboardData)return;const{text:i,html:r,multiTextSelectionData:a,textSelectionData:s,blockSelectionData:l}=no({clipboardData:t.clipboardData,tinyMceMicrosoftWordPasteFilter:n});if(a)return To({text:i,html:r,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n});if(s){const{editing:e,selection:t}=s;return j().Uee(j().AI5(e,t.startIndex,t.endIndex).tokensInsideRange,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0})}return r||i?function(e){const{text:t,html:o,blockSelectionData:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e,a=t.includes("\n");return a||n&&n.blocks.length>0?j().x9d(t):To({text:t,html:o,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r})}({text:i,html:r,blockSelectionData:l,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}):void 0}},275338:(e,t,o)=>{function n(e){return Date.now()-parseInt(e.timestamp)}o.d(t,{S:()=>n})},298028:(e,t,o)=>{function n(e){return/^(\+\d{1,2}[\s.-])?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}function i(e){return/^[0-9 .()\-\+]{7,}$/.test(e)}o.d(t,{W:()=>n,e:()=>i})},344393:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(129044))().default{getInitialState(){return{active:!1,stringValue:""}}}const i=new n},489844:(e,t,o)=>{o.d(t,{W:()=>r});var n=()=>o(564134),i=()=>o(361308);function r(e){let{intl:t,propertySchema:o,value:r}=e,a=i().C4;return o&&(0,n().AM)(o)&&(a=o.number_format??i().C4),i().ZV(r,a,t)}},533639:(e,t,o)=>{o.d(t,{p:()=>n});class n extends(()=>o(998969))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}},992910:(e,t,o)=>{o.d(t,{z:()=>y});o(362833),o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(403517);var n=()=>o(950635),i=()=>o(716605),r=()=>o(846581),a=()=>o(16456),s=()=>o(489844),l=()=>o(240896),c=()=>o(465170),d=()=>o(769884),u=()=>o(673447),p=()=>o(145017),m=()=>o(34662),f=()=>o(86280);const g=r().ZF;function b(e){return(0,l().vy)({...e,fromString:e=>e}).join("")}function v(e){const{textValue:t}=e;if(t){const o=[];for(const n of t)m().bHQ(n)||o.push(b({...e,textValue:[n]}));return o.join(", ")}return""}const k={[m().Ifu.Page]:e=>{let{annotation:t,exportArgs:o}=e;const{getExportedPathToPage:n}=o,i=m().v55(t),r=(0,l()._z)({intl:o.intl,blockId:i,getRecordValue:o.getRecordValue,userTimeZone:o.userTimeZone}),a=n({toPageId:i});if(r&&a)return`${r} (${a})`},[m().Ifu.SlackSpecialMention]:e=>{let{annotation:t,exportArgs:o}=e;return`@${m().p5C(t)}`},[m().Ifu.CustomEmoji]:e=>{let{annotation:t,exportArgs:o}=e;const{getRecordValue:n}=o,i=m().qS0(t);if(!i)return;const r=d().b4_.fromGetRecordValueFn(n)(i);return r?r.getRenderTitle():void 0},[m().Ifu.Comment]:e=>{let{annotation:t,exportArgs:n}=e;const{getRecordValue:i,baseUrl:r}=n,a=d().b4_.fromGetRecordValueFn(i),s=m().MdE(t);if(!s)return;const l=a(s);if(!l)return;const c=l.getParentId(),p=l.getParentPointer(),f=(0,u().NJ)((0,u().Yn)(p,i));if(!f)return;const g=a(p);let b;if(g){const e=a(g.getParentPointer());b=e&&"table_row"===e.getType()?e.getParentId():g.getParentId()}return(0,o(220959).A)({pageId:f.id,scrollToBlockId:b,pageValue:f,baseUrl:r,discussionId:c,pageVisitSource:o(712437).y8.Export})},[m().Ifu.Link]:e=>{let{annotation:t,exportArgs:n}=e;const{getExportedPathToFile:i,getExportedPathToPage:r,navigableBlockId:a,baseUrl:s,publicDomainName:l}=n,c=m().cQR(t),d=(0,o(7356).lX)({url:c,baseUrl:s,publicDomainName:l});return d?r({toPageId:d}):i({fromBlockId:a,toFileURI:c})},[m().Ifu.User]:e=>{let{annotation:t,exportArgs:n}=e;const{intl:i}=n,r=m().NcG(t),a=n.getRecordValue({table:o(409211).oo,id:r});if(a)return`@${(0,o(14931).c6)(i,a)}`},[m().Ifu.Bot]:e=>{let{annotation:t,exportArgs:n}=e;const i=m().vjW(t),r=n.getRecordValue({table:o(518797).GP,id:i});if(r)return`@${(0,o(466003).Hg)(r)}`},[m().Ifu.Group]:e=>{let{annotation:t,exportArgs:o}=e;const n=(0,l().Pf)({annotation:t,exportArgs:o});if(n)return n},[m().Ifu.Team]:e=>{let{annotation:t,exportArgs:o}=e;const n=(0,l().nZ)({annotation:t,exportArgs:o});if(n)return n},[m().Ifu.ExternalObjectInstance]:e=>{var t;let{annotation:o,exportArgs:n}=e;const i=m().T$c(o);return null===(t=n.getRecordValue({table:p().ev,id:i,spaceId:n.root.spaceId}))||void 0===t||null===(t=t.format)||void 0===t?void 0:t.original_url},[m().Ifu.LinkMention]:e=>{let{annotation:t,exportArgs:o}=e;const{href:n}=m().q1R(t);return n},[m().Ifu.Date]:e=>{let{annotation:t,exportArgs:o}=e;const{date_format:n,time_format:i,...a}=m().K7D(t);return`@${(0,r().ZF)({value:a,date_format:n,time_format:i,userTimeZone:o.userTimeZone,allowRelativeDates:!1,intl:o.intl})}`},[m().Ifu.Equation]:e=>{let{annotation:t,exportArgs:o}=e;const n=(0,c().TG)(t),i=(0,c().oV)(t,o.getExportedPathToPage,o);return`${n}${m().U35(t)}${i}`},[m().Ifu.Bold]:l().if,[m().Ifu.Italic]:l().if,[m().Ifu.Strike]:l().if,[m().Ifu.Code]:l().if,[m().Ifu.Highlight]:l().if,[m().Ifu.Discussion]:l().if,[m().Ifu.Underline]:l().if,[m().Ifu.Inserted]:l().if,[m().Ifu.Deleted]:l().if,[m().Ifu.TemporaryComment]:l().if,[m().Ifu.TemporaryCursor]:l().if,[m().Ifu.TemporaryEquation]:l().if,[m().Ifu.TemporaryPage]:l().if,[m().Ifu.TemporaryInput]:l().if,[m().Ifu.TemporarySelection]:l().if,[m().Ifu.TemporaryFindHighlight]:l().if,[m().Ifu.TemporarySelectedFindHighlight]:l().if,[m().Ifu.TemplateVariable]:l().if,[m().Ifu.FormulaPageProperty]:l().if,[m().Ifu.FormulaContextValue]:l().if,[m().Ifu.FormulaError]:l().if,[m().Ifu.Citation]:l().if,[m().Ifu.SuggestionInsertText]:l().if,[m().Ifu.SuggestionRemoveText]:l().if,[m().Ifu.SuggestionAnnotate]:l().if,[m().Ifu.SuggestionUnannotate]:l().if,[m().Ifu.TemporaryNativeMABFilter]:l().if,[m().Ifu.TemporaryDictation]:l().if,[m().Ifu.TemporaryHighlight]:l().if,[m().Ifu.AssistantInstructionsCollection]:l().if,[m().Ifu.TemporaryCommentHighlight]:l().if,[m().Ifu.TemporarySuggestionUnderline]:l().if,[m().Ifu.GeoPoint]:l().if};function S(){}function h(){return Promise.resolve(void 0)}const y={blockRenderers:{text:S,encrypted_text:S,header:S,sub_header:S,sub_sub_header:S,quote:S,bulleted_list:S,toggle:S,to_do:S,numbered_list:S,code:S,page:S,image:S,video:S,embed:S,bookmark:S,file:S,tweet:S,maps:S,gist:S,framer:S,invision:S,mixpanel:S,drive:S,figma:S,loom:S,pdf:S,typeform:S,codepen:S,audio:S,divider:S,equation:S,collection_view:S,collection_view_page:S,column_list:S,column:S,factory:S,copy_indicator:S,breadcrumb:S,link_to_collection:S,link_to_page:S,table_of_contents:S,callout:S,whimsical:S,miro:S,abstract:S,sketch:S,excalidraw:S,replit:S,alias:S,transclusion_container:S,transclusion_reference:S,external_object_instance:S,table:S,table_row:S,tab:S,hex:S,deepnote:S,external_object_instance_page:S,button:S,ai_block:S,drawing:S,slide:S,personal_home_page:S,form:S,post:S,workflow:S,transcription:S,person_profile:S},asyncBlockRenderers:{text:h,encrypted_text:h,header:h,sub_header:h,sub_sub_header:h,quote:h,bulleted_list:h,toggle:h,to_do:h,numbered_list:h,code:h,page:h,image:h,video:h,embed:h,bookmark:h,file:h,tweet:h,maps:h,gist:h,framer:h,invision:h,mixpanel:h,drive:h,figma:h,loom:h,pdf:h,typeform:h,codepen:h,audio:h,divider:h,equation:h,collection_view:h,collection_view_page:h,column_list:h,column:h,factory:h,copy_indicator:h,breadcrumb:h,link_to_collection:h,link_to_page:h,table_of_contents:h,callout:h,whimsical:h,miro:h,abstract:h,sketch:h,excalidraw:h,replit:h,alias:h,transclusion_container:h,transclusion_reference:h,external_object_instance:h,table:h,table_row:h,tab:h,hex:h,deepnote:h,external_object_instance_page:h,button:h,ai_block:h,drawing:h,slide:h,personal_home_page:h,form:h,post:h,workflow:h,transcription:h,person_profile:h},annotationRenderers:k,propertyRenderers:{title:e=>b(e),text:b,select:e=>{const{textValue:t,propertySchema:o}=e,n=o.options||[];return i().L3(t,n)},multi_select:e=>{const{textValue:t,propertySchema:o}=e,n=o.options||[],r=i().o2(t,n);return r.sort(),r.join(", ")},status:e=>{const{textValue:t,propertySchema:o}=e;return i().RZ(t,o)},relation:e=>{const{textValue:t,propertySchema:o,exportArgs:n}=e;if("relation"!==o.type)return;const r=i().bG({relationValue:i().n(t),getRecordModel:d().b4_.fromGetRecordValueFn(n.getRecordValue),propertySchema:o,includeNoAccess:!0}),a=i().Ap(r);return v({...e,textValue:a})},rollup:e=>{const t=e.exportArgs.getRecordValue,n=e.exportArgs.formulasModule,i=d().Bj6.fromValue(p().ev,e.block),r=d().b4_.fromGetRecordValueFn(t);return o(351892).I({...e,block:i,getRecordModel:r,collectionRequestContext:{userId:void 0,userTimeZone:e.exportArgs.userTimeZone,depth:0,intl:e.exportArgs.intl,visitedProperties:new Set,resultCache:e.exportArgs.resultCache,regExpCache:e.exportArgs.regExpCache,experimentService:e.exportArgs.experimentService,collectionFeatureGates:e.exportArgs.collectionFeatureGates},formulasModule:n})},url:e=>{let{textValue:t}=e;return m().k4p(t)},email:e=>{let{textValue:t}=e;return m().k4p(t)},phone_number:e=>{let{textValue:t}=e;return m().k4p(t)},checkbox:e=>{let{textValue:t}=e;return i().wu(t)?"Yes":"No"},person:e=>{let{textValue:t,exportArgs:n,propertySchema:r,block:a}=e;const{intl:s}=n,l=d().Bj6.fromBlock(a),c=i().e5({textValue:t,propertySchema:r,blockCreatorPointer:l.getCreatedByPointer()});return o(975392).oE(c.map((e=>{const t=n.getRecordValue(e),o=t&&d().Bj6.fromValue(e.table,t);return null==o?void 0:o.getDisplayName(s)}))).join(", ")},number:e=>{let{exportArgs:t,property:n,schema:r,textValue:a}=e;const l=r[n],c=i().Me(a);if(!(0,o(76394).O9)(c))return;let d=!0;var u;l&&(0,o(564134).AM)(l)&&(d=(null===(u=l.show_as)||void 0===u?void 0:u.showValue)??!0);return d?(0,s().W)({intl:t.intl,propertySchema:l,value:c}):void 0},date:e=>{let{textValue:t,propertySchema:n,...i}=e;const a=i.exportArgs.userTimeZone,s=(0,o(577097).b)(t),{date_format:l,time_format:c}=n;if(s)return(0,r().ZF)({allowRelativeDates:!1,value:s,date_format:l,time_format:c,userTimeZone:a,intl:i.exportArgs.intl,displayInUserTimezone:i.exportArgs.displayInUserTimezone??!1,alwaysIncludeTimezone:!0})},file:v,formula:e=>{const{property:t,schema:n,block:i,exportArgs:r}=e,{userTimeZone:a,getRecordValue:l,intl:c,resultCache:u,regExpCache:p,formulasModule:m}=r;if(!m)return;const f=n[t],b=m.primitiveFormulaValueFromPropertySchema({schema:n,property:t,blockModel:d().Bj6.fromBlock(i),getRecordModel:d().b4_.fromGetRecordValueFn(l),intl:c,userTimeZone:a,depth:0,resultCache:u,regExpCache:p,experimentService:r.experimentService,collectionFeatureGates:r.collectionFeatureGates});return"boolean"==typeof b?b?"Yes":"No":(0,o(141666).Et)(b)?(0,s().W)({intl:r.intl,propertySchema:f,value:b}):(0,o(871002).kC)(b)?g({value:b,userTimeZone:a,allowRelativeDates:!1,intl:r.intl}):b},created_time:e=>{const{block:t,exportArgs:o}=e,{userTimeZone:n}=o;if(t.created_time)return g({allowRelativeDates:!1,value:(0,a().KQ)(t.created_time,n),userTimeZone:n,intl:o.intl})},last_edited_time:e=>{const{block:t,exportArgs:o}=e,{userTimeZone:n}=o;if(t.last_edited_time)return g({allowRelativeDates:!1,value:(0,a().KQ)(t.last_edited_time,n),userTimeZone:n,intl:o.intl})},created_by:e=>{const{block:t,exportArgs:o}=e,{getRecordValue:i,intl:r}=o;if(t.created_by_table&&t.created_by_id){const e=(0,n().xC)({getRecordValue:i,pointer:{table:t.created_by_table,id:t.created_by_id,spaceId:t.space_id}});if(e.asActor)return(0,n().lR)(r,e)}},last_edited_by:e=>{const{block:t,exportArgs:o}=e,{getRecordValue:i,intl:r}=o;if(t.last_edited_by_table&&t.last_edited_by_id){const e=(0,n().xC)({getRecordValue:i,pointer:{table:t.last_edited_by_table,id:t.last_edited_by_id,spaceId:t.space_id}});if(e.asActor)return(0,n().lR)(r,e)}},button:e=>"",auto_increment_id:e=>{let{textValue:t,block:n,exportArgs:r}=e;const a=i().On(t),{getRecordValue:s}=r;if(void 0!==a){const e=d().Bj6.fromBlock(n),t=e.getParentTable();if(t!==o(21164).Vl)return;const i=s((0,o(185968).aZ)({spaceId:e.getSpaceId(),parentTable:t,parentId:e.getParentId()}));return(0,o(819851).H4)(null==i?void 0:i.record_key,a)}},last_visited_time:e=>"",location:e=>"",verification:e=>{let{textValue:t,exportArgs:o}=e;const n=f().U1(t);if(!n)return"";const i=f().B2(n);return o.intl.formatMessage(f().D6(i.type))},geo_point:()=>""}}},994488:(e,t,o)=>{o.d(t,{o:()=>n});o(362833),o(403517);function n(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];if(0===o.length)return e.map((e=>[e]));const r=[];for(const a of e)r.push(...n(o[0],...o.slice(1)).map((e=>[a,...e])));return r}}}]);