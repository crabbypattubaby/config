"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53250],{521108:(e,n,t)=>{t.r(n),t.d(n,{BroadcastChannel:()=>Q,OPEN_BROADCAST_CHANNELS:()=>O,beLeader:()=>X,clearNodeFolder:()=>R,createLeaderElection:()=>$,enforceOptions:()=>j});var r=Promise.resolve(!1),o=Promise.resolve(!0),i=Promise.resolve();function a(e,n){return e||(e=0),new Promise((function(t){return setTimeout((function(){return t(n)}),e)}))}function s(){return Math.random().toString(36).substring(2)}var u=0;function c(){var e=1e3*Date.now();return e<=u&&(e=u+1),u=e,e}var l={create:function(e){var n={time:c(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return n.bc.onmessage=function(e){n.messagesCallback&&n.messagesCallback(e.data)},n},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,n){e.messagesCallback=n},postMessage:function(e,n){try{return e.bc.postMessage(n,!1),i}catch(t){return Promise.reject(t)}},canBeUsed:function(){if("undefined"!=typeof globalThis&&globalThis.Deno&&globalThis.Deno.args)return!0;if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:c};class d{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,f()),this._to||(this._to=!0,setTimeout((()=>{this._to=!1,function(e){const n=f()-e.ttl,t=e.map[Symbol.iterator]();for(;;){const r=t.next().value;if(!r)return;const o=r[0];if(!(r[1]<n))return;e.map.delete(o)}}(this)}),0))}clear(){this.map.clear()}}function f(){return Date.now()}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=JSON.parse(JSON.stringify(e));return void 0===n.webWorkerSupport&&(n.webWorkerSupport=!0),n.idb||(n.idb={}),n.idb.ttl||(n.idb.ttl=45e3),n.idb.fallbackInterval||(n.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(n.idb.onclose=e.idb.onclose),n.localstorage||(n.localstorage={}),n.localstorage.removeTimeout||(n.localstorage.removeTimeout=6e4),e.methods&&(n.methods=e.methods),n.node||(n.node={}),n.node.ttl||(n.node.ttl=12e4),n.node.maxParallelWrites||(n.node.maxParallelWrites=2048),void 0===n.node.useFastPath&&(n.node.useFastPath=!0),n}var p="pubkey.broadcast-channel-0-",m="messages",v={durability:"relaxed"};function _(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function w(e){e.commit&&e.commit()}function b(e,n){var t=e.transaction(m,"readonly",v),r=t.objectStore(m),o=[],i=IDBKeyRange.bound(n+1,1/0);if(r.getAll){var a=r.getAll(i);return new Promise((function(e,n){a.onerror=function(e){return n(e)},a.onsuccess=function(n){e(n.target.result)}}))}return new Promise((function(e,a){var s=function(){try{return i=IDBKeyRange.bound(n+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();s.onerror=function(e){return a(e)},s.onsuccess=function(r){var i=r.target.result;i?i.value.id<n+1?i.continue(n+1):(o.push(i.value),i.continue()):(w(t),e(o))}}))}function g(e){return(n=e.db,t=e.options.idb.ttl,r=Date.now()-t,o=n.transaction(m,"readonly",v),i=o.objectStore(m),a=[],new Promise((function(e){i.openCursor().onsuccess=function(n){var t=n.target.result;if(t){var i=t.value;i.time<r?(a.push(i),t.continue()):(w(o),e(a))}else e(a)}}))).then((function(n){return function(e,n){if(e.closed)return Promise.resolve([]);var t=e.db.transaction(m,"readwrite",v).objectStore(m);return Promise.all(n.map((function(e){var n=t.delete(e);return new Promise((function(e){n.onsuccess=function(){return e()}}))})))}(e,n.map((function(e){return e.id})))}));var n,t,r,o,i,a}function L(e){e.closed||C(e).then((function(){return a(e.options.idb.fallbackInterval)})).then((function(){return L(e)}))}function C(e){return e.closed?i:e.messagesCallback?b(e.db,e.lastCursorId).then((function(n){var t=n.filter((function(e){return!!e})).map((function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n})).filter((function(n){return function(e,n){return!(e.uuid===n.uuid||n.eMIs.has(e.id)||e.data.time<n.messagesCallbackTime)}(n,e)})).sort((function(e,n){return e.time-n.time}));return t.forEach((function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))})),i})):i}var y={create:function(e,n){return n=h(n),function(e){var n=_(),t=p+e,r=n.open(t);return r.onupgradeneeded=function(e){e.target.result.createObjectStore(m,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,n){r.onerror=function(e){return n(e)},r.onsuccess=function(){e(r.result)}}))}(e).then((function(t){var r={closed:!1,lastCursorId:0,channelName:e,options:n,uuid:s(),eMIs:new d(2*n.idb.ttl),writeBlockPromise:i,messagesCallback:null,readQueuePromises:[],db:t};return t.onclose=function(){r.closed=!0,n.idb.onclose&&n.idb.onclose()},L(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,n,t){e.messagesCallbackTime=t,e.messagesCallback=n,C(e)},postMessage:function(e,n){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,n,t){var r={uuid:n,time:Date.now(),data:t},o=e.transaction([m],"readwrite",v);return new Promise((function(e,n){o.oncomplete=function(){return e()},o.onerror=function(e){return n(e)},o.objectStore(m).add(r),w(o)}))}(e.db,e.uuid,n)})).then((function(){var n,t;0===(n=0,t=10,Math.floor(Math.random()*(t-n+1)+n))&&g(e)})),e.writeBlockPromise},canBeUsed:function(){return!!_()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:c},k="pubkey.broadcastChannel-";function P(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(n){}return e}function E(e){return k+e}function M(){var e=P();if(!e)return!1;try{var n="__broadcastchannel_check";e.setItem(n,"works"),e.removeItem(n)}catch(t){return!1}return!0}var S={create:function(e,n){if(n=h(n),!M())throw new Error("BroadcastChannel: localstorage cannot be used");var t=s(),r=new d(n.localstorage.removeTimeout),o={channelName:e,uuid:t,eMIs:r};return o.listener=function(e,n){var t=E(e),r=function(e){e.key===t&&n(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}(e,(function(e){o.messagesCallback&&e.uuid!==t&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(r.add(e.token),o.messagesCallback(e.data)))})),o},close:function(e){var n;n=e.listener,window.removeEventListener("storage",n)},onMessage:function(e,n,t){e.messagesCallbackTime=t,e.messagesCallback=n},postMessage:function(e,n){return new Promise((function(t){a().then((function(){var r=E(e.channelName),o={token:s(),time:Date.now(),data:n,uuid:e.uuid},i=JSON.stringify(o);P().setItem(r,i);var a=document.createEvent("Event");a.initEvent("storage",!0,!0),a.key=r,a.newValue=i,window.dispatchEvent(a),t()}))}))},canBeUsed:M,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:c},I=c,B=new Set;var x={create:function(e){var n={time:I(),name:e,messagesCallback:null};return B.add(n),n},close:function(e){B.delete(e)},onMessage:function(e,n){e.messagesCallback=n},postMessage:function(e,n){return new Promise((function(t){return setTimeout((function(){Array.from(B).forEach((function(t){t.name===e.name&&t!==e&&t.messagesCallback&&t.time<n.time&&t.messagesCallback(n)})),t()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:I},T=[l,y,S];function D(e){var n=[].concat(e.methods,T).filter(Boolean);if(e.type){if("simulate"===e.type)return x;var t=n.find((function(n){return n.type===e.type}));if(t)return t;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(n=n.filter((function(e){return"idb"!==e.type})));var r=n.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(T.map((function(e){return e.type}))))}var N,O=new Set,K=0,Q=function(e,n){var t,r,o;this.id=K++,O.add(this),this.name=e,N&&(n=N),this.options=h(n),this.method=D(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,r=(t=this).method.create(t.name,t.options),(o=r)&&"function"==typeof o.then?(t._prepP=r,r.then((function(e){t._state=e}))):t._state=r};function R(e){var n=D(e=h(e));return"node"===n.type?n.clearNodeFolder().then((function(){return!0})):r}function j(e){N=e}function A(e,n,t){var r={time:e.method.microSeconds(),type:n,data:t};return(e._prepP?e._prepP:i).then((function(){var n=e.method.postMessage(e._state,r);return e._uMP.add(n),n.catch().then((function(){return e._uMP.delete(n)})),n}))}function J(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function W(e,n,t){e._addEL[n].push(t),function(e){if(!e._iL&&J(e)){var n=function(n){e._addEL[n.type].forEach((function(e){n.time>=e.time&&e.fn(n.data)}))},t=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,n,t)})):(e._iL=!0,e.method.onMessage(e._state,n,t))}}(e)}function F(e,n,t){e._addEL[n]=e._addEL[n].filter((function(e){return e!==t})),function(e){if(e._iL&&!J(e)){e._iL=!1;var n=e.method.microSeconds();e.method.onMessage(e._state,null,n)}}(e)}Q._pubkey=!0,Q.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return A(this,"message",e)},postInternal:function(e){return A(this,"internal",e)},set onmessage(e){var n={time:this.method.microSeconds(),fn:e};F(this,"message",this._onML),e&&"function"==typeof e?(this._onML=n,W(this,"message",n)):this._onML=null},addEventListener:function(e,n){W(this,e,{time:this.method.microSeconds(),fn:n})},removeEventListener:function(e,n){F(this,e,this._addEL[e].find((function(e){return e.fn===n})))},close:function(){var e=this;if(!this.closed){O.delete(this),this.closed=!0;var n=this._prepP?this._prepP:i;return this._onML=null,this._addEL.message=[],n.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var U="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(e){process.on("exit",(function(){return e()})),process.on("beforeExit",(function(){return e().then((function(){return process.exit()}))})),process.on("SIGINT",(function(){return e().then((function(){return process.exit()}))})),process.on("uncaughtException",(function(n){return e().then((function(){console.trace(n),process.exit(101)}))}))}:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var n=self.close.bind(self);self.close=function(){return e(),n()}}else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}},q=new Set,G=!1;function z(e){if(G||(G=!0,U(V)),"function"!=typeof e)throw new Error("Listener is no function");return q.add(e),{remove:function(){return q.delete(e)},run:function(){return q.delete(e),e()}}}function V(){var e=[];return q.forEach((function(n){e.push(n()),q.delete(n)})),Promise.all(e)}function H(e,n){var t={context:"leader",action:n,token:e.token};return e.broadcastChannel.postInternal(t)}function X(e){e.isLeader=!0,e._hasLeader=!0;var n=z((function(){return e.die()}));e._unl.push(n);var t=function(n){"leader"===n.context&&"apply"===n.action&&H(e,"tell"),"leader"!==n.context||"tell"!==n.action||e._dpLC||(e._dpLC=!0,e._dpL(),H(e,"tell"))};return e.broadcastChannel.addEventListener("internal",t),e._lstns.push(t),H(e,"tell")}var Y=function(e,n){var t=this;this.broadcastChannel=e,e._befC.push((function(){return t.die()})),this._options=n,this.isLeader=!1,this.isDead=!1,this.token=s(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+e.method.type+"||"+e.name};Y.prototype={hasLeader:function(){var e=this;return navigator.locks.query().then((function(n){var t=n.held?n.held.filter((function(n){return n.name===e.lN})):[];return!!(t&&t.length>0)}))},awaitLeadership:function(){var e=this;if(!this._wLMP){this._wKMC.c=new AbortController;var n=new Promise((function(n,t){e._wKMC.res=n,e._wKMC.rej=t}));this._wLMP=new Promise((function(t){navigator.locks.request(e.lN,{signal:e._wKMC.c.signal},(function(){return e._wKMC.c=void 0,X(e),t(),n})).catch((function(){}))}))}return this._wLMP},set onduplicate(e){},die:function(){var e=this;return this._lstns.forEach((function(n){return e.broadcastChannel.removeEventListener("internal",n)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),H(this,"death")}};var Z=function(e,n){var t=this;this.broadcastChannel=e,this._options=n,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=s(),this._aplQ=i,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var r=function(e){"leader"===e.context&&("death"===e.action&&(t._hasLeader=!1),"tell"===e.action&&(t._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};function $(e,n){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");n=function(e,n){return e||(e={}),(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=n.method.averageResponseTime(n.options)),e}(n,e);var t="undefined"!=typeof navigator&&void 0!==navigator.locks&&"function"==typeof navigator.locks.request?new Y(e,n):new Z(e,n);return e._befC.push((function(){return t.die()})),e._leaderElector=t,t}Z.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(e){var n=this;if(this.isLeader)return a(0,!0);if(this.isDead)return a(0,!1);if(this._aplQC>1)return this._aplQ;return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(n.isLeader)return o;var t,r=!1,i=new Promise((function(e){t=function(){r=!0,e()}})),s=function(e){"leader"===e.context&&e.token!=n.token&&("apply"===e.action&&e.token>n.token&&t(),"tell"===e.action&&(t(),n._hasLeader=!0))};n.broadcastChannel.addEventListener("internal",s);var u=e?4*n._options.responseTime:n._options.responseTime;return H(n,"apply").then((function(){return Promise.race([a(u),i.then((function(){return Promise.reject(new Error)}))])})).then((function(){return H(n,"apply")})).then((function(){return Promise.race([a(u),i.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return n.broadcastChannel.removeEventListener("internal",s),!r&&X(n).then((function(){return!0}))}))}()})).then((function(){n._aplQC=n._aplQC-1})),this._aplQ.then((function(){return n.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(e){if(e.isLeader)return i;return new Promise((function(n){var t=!1;function r(){t||(t=!0,e.broadcastChannel.removeEventListener("internal",o),n(!0))}e.applyOnce().then((function(){e.isLeader&&r()})),function n(){return a(e._options.fallbackInterval).then((function(){if(!e.isDead&&!t)return e.isLeader?void r():e.applyOnce(!0).then((function(){e.isLeader?r():n()}))}))}();var o=function(n){"leader"===n.context&&"death"===n.action&&(e._hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&r()})))};e.broadcastChannel.addEventListener("internal",o),e._lstns.push(o)}))}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(n){return e.broadcastChannel.removeEventListener("internal",n)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,H(this,"death")}}},753081:(e,n,t)=>{var r=t(535370);n.createRoot=r.createRoot,n.hydrateRoot=r.hydrateRoot}}]);