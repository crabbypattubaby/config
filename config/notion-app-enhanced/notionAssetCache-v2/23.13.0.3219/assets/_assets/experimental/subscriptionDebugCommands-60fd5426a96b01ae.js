"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[99355],{827053:(e,t,n)=>{n.r(t),n.d(t,{SubscriptionDebugCommands:()=>E});n(610931),n(725707),n(500234),n(113085);var a=n(242343),r=()=>n(497420),i=()=>n(237385),o=()=>n(803290),s=()=>n(996094),c=()=>n(519423),u=()=>n(647242),d=()=>n(649074),l=()=>n(678988),m=()=>n(405317),p=()=>n(975392),S=()=>n(818369),f=()=>n(795394),g=()=>n(759625),v=()=>n(84543),b=()=>n(658388),h=()=>n(183219),y=()=>n(863969),_=()=>n(485966),A=()=>n(320168),I=()=>n(782817),k=()=>n(298520),w=()=>n(262230),C=()=>n(670682),U=()=>n(613313),D=()=>n(111826),B=()=>n(396154),x=()=>n(305043);function E(){const e=(0,i().v3)(),t=(0,y().O)(),n=(0,o().O$)(_().AppStoreCurrentSpaceStore),[r,c]=(0,a.useState)(!1);return(0,s().exposeDebugValue)("subscriptions",{updateSubscription:async function(){var t;let{billingInterval:a="month",products:i=["plus"],cancelImmediately:o=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!n)return;if(r)return;const s=await(0,k().p_)({environment:e,spaceId:n.id}),m=await(0,C().OD)({environment:e,spaceId:n.id});if(!m||"admin"!==m.type)return;const S="subscription_debug_commands",f=i[0],g=(0,u().lQ)(m),v=(0,d().j8)(g)??"USD",b=(null===(t=(0,u().KH)(m,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,h=(0,d().GB)({spaceId:n.id,logFunction:()=>{},subscriptionState:g}),y=(0,u().yB)({spaceId:n.id,logFunction:()=>{},billingData:m}),_=h??y??1;let A;if("free"===f)A=(0,l().gL)(g,"plan");else{if(!v||!a)throw new Error("Trying to update plan on a subscription with no items");{const e=(0,U().Le)();A=(0,l().ef)({state:g,prices:s,quantities:{numSeats:_,numCustomHostnames:b},params:{currency:v,interval:a},products:[f],flags:{isMay13PackagingChangesEnabled:e}})}}if(!p().n4(g,A)){c(!0);try{if((0,l().V5)(g,A)&&o&&await(0,w().cancelSubscription)({environment:e,spaceStore:n,from:S,cancelImmediately:o}),"free"===f)return;await(0,w().updateSubscription)({environment:e,spaceStore:n,desiredState:A,from:S,paymentData:{type:"paymentMethodId",value:"pm_card_visa"}})}finally{c(!1)}}},getAiUsage:()=>{const e=B().A.state;if(!e)throw Error("AI usage store not found");return{spaceUsage:e.spaceUsage,spaceUsageLimit:e.spaceLimit,userUsage:e.userUsage,userUsageLimit:e.userLimit}},getBlockUsage:()=>{const n=x().subscriptionDataStoreInstance.state;if(!n||!t)throw Error("Subscription data store not found");return{blockLimitCount:(0,D().hr)(e,n,t)}},resetDeleteBlocksModal:()=>{const t=_().default.state.currentSpaceViewStore;t&&v().createAndCommit({userAction:"DeleteBlocksModal.showDeleteBlocksModal",environment:e,canUndo:!0,perform:e=>{v().applyOperation({store:t,operation:{pointer:t.pointer,path:["settings"],command:"update",args:{...t.getSettings(),seen_delete_blocks_modal:!1}},transaction:e})}})},resetStudentAiPopup:()=>{const t=_().default.state.currentUserSettingsStore;v().createAndCommit({userAction:"dismissedStudentAiPopup.reset",environment:e,canUndo:!0,perform:e=>{b().mJ({transaction:e,userSettingsStore:t,data:{dismissed_student_ai_popup:!1}})}})},resetReverseTrialSidebarAlert:()=>{const t=_().default.state.currentUserSettingsStore;v().createAndCommit({userAction:"ReverseTrialSidebarAlert.resetDismissal",environment:e,canUndo:!0,perform:e=>{b().mJ({transaction:e,userSettingsStore:t,data:{reverse_trial_sidebar_alert_dismissed_at:void 0}})}})},sendMemberRequestForAddOn:()=>{const t=_().default.state.currentSpaceStore;t&&I().jB({environment:e,spaceStore:t,from:"ai_qna_limit_in_app"})},recordAIUsage:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n=_().default.state.currentSpaceStore;n&&(await S().callApi({eventName:"recordAIUsage",environment:e,data:{spaceId:n.id,usage:t}}),await(0,h().maybeUpdateAiEligibility)(e,n.id,!0))},recordBlockUsage:e=>{x().subscriptionDataStoreInstance.update((t=>t&&"blockUsage"in t?{...t,blockUsage:e}:t))},resetReachBlockLimitTime:()=>{const t=_().default.state.currentSpaceStore;t&&v().createAndCommit({userAction:"SubscriptionDebugCommands.resetReachBlockLimitTime",environment:e,canUndo:!0,perform:e=>{g().zv({store:t,data:{settings:{...t.getSettings(),reach_block_limit_time:void 0}},transaction:e})}})}}),null}function P(e,t,a,r){v().createAndCommit({userAction:"SubscriptionDebugCommands.addBlocksToPage",environment:a,canUndo:!0,perform:i=>{p().Hn(e,(()=>{const e=g().Wv({environment:a,type:"text",inMemoryRecordCache:t.inMemoryRecordCache,transaction:i,properties:{title:[[r||"money team is the best team"]]}});f().NI({parentStore:t.getContentStore(),childStore:n(413871).Bv.createChildStore(t.getContentStore(),e.pointer),transaction:i})}))}})}function L(e,t,n){const a=t.getContentStores().slice(-e);v().createAndCommit({userAction:"SubscriptionDebugCommands.removeBlocksFromPage",environment:n,canUndo:!0,perform:e=>{for(const n of a)f().zz({parentStore:t.getContentStore(),childStore:n,transaction:e})}})}(0,r().exposeDebugEnvironmentValue)("getStripeLinks",(e=>function(){var t,a;let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=null===(t=_().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!i)return"No space id found";const o=n(436622).A.getData(e,{spaceId:i});if(!o)return"No billing data found";const s=r?"https://dashboard.stripe.com/test":"https://dashboard.stripe.com";return{customer:o.externalId?`${s}/customers/${o.externalId}`:"No customer id found",subscription:null!==(a=o.subscription)&&void 0!==a&&a.externalId?`${s}/subscriptions/${o.subscription.externalId}`:"No subscription id found"}})),(0,r().exposeDebugEnvironmentValue)("addBlocksToPage",(e=>(t,n)=>{const a=_().default.state.currentSpaceStore,r=_().default.state.mainEditorCurrentBlockStore;a&&r&&(t<100?P(t,r,e,n):p().Hn(t/100,(()=>{P(100,r,e,n)})))})),(0,r().exposeDebugEnvironmentValue)("removeBlocksFromPage",(e=>t=>{const n=_().default.state.currentSpaceStore,a=_().default.state.mainEditorCurrentBlockStore;n&&a&&(t<100?L(t,a,e):p().Hn(t/100,(()=>{L(100,a,e)})))})),(0,r().exposeDebugEnvironmentValue)("testPremiumFeatureAvailability",(e=>async t=>{const n=_().default.state.currentSpaceStore;if(!n)return"No active space";const a=m().R0[t];if(!a)return`Unknown feature: ${t}`;let r;r="check"===a.type?"true":"unlimited",await(0,w().cancelSubscription)({environment:e,spaceStore:n,from:"subscription_debug_commands",cancelImmediately:!0});const i=n.id,o=await S().callApi({eventName:"overridePremiumFeatureAvailability",environment:e,data:{spaceId:i,feature:t,featureValue:r},headers:(0,c().WS)({cellId:void 0,spaceId:i})});return await A().A.resetData(e,{spaceId:i}),"success"===o.type?`Successfully enabled premium feature: ${t}`:"Something went wrong"})),(0,r().exposeDebugEnvironmentValue)("testPremiumFeatureUnavailability",(e=>async t=>{const n=_().default.state.currentSpaceStore;if(!n)return"No active space";const a=m().R0[t];if(!a)return`Unknown feature: ${t}`;let r;r="check"===a.type?"false":"0";const i=await(0,k().p_)({environment:e,spaceId:n.id}),o=["enterprise","ai"].map((e=>({quantity:1,price:i.find((t=>t.product===e&&"month"===t.billingInterval))})));if(o.some((e=>!e.price)))return"Could not find prices for all items";await(0,w().updateSubscription)({environment:e,spaceStore:n,desiredState:{items:o,trialEnd:void 0},from:"subscription_debug_commands",paymentData:{type:"paymentMethodId",value:"pm_card_visa"}});const s=n.id,u=await S().callApi({eventName:"overridePremiumFeatureAvailability",environment:e,data:{spaceId:s,feature:t,featureValue:r},headers:(0,c().WS)({cellId:void 0,spaceId:s})});return await A().A.resetData(e,{spaceId:s}),"success"===u.type?`Successfully disabled premium feature: ${t}`:"Something went wrong"}))}}]);