"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[943,90871],{5612:(e,t,o)=>{o.d(t,{K:()=>r});var n=()=>o(137476);function r(e){n().vd(e,"inline_collection_load_more_click")}},8383:(e,t,o)=>{o.d(t,{$u:()=>p,Dp:()=>s,Gd:()=>c,Hh:()=>h,Hl:()=>d,RT:()=>m,Xw:()=>S,Yg:()=>g,yA:()=>u});o(725707),o(500234),o(403517);var n=()=>o(314164),r=()=>o(983050),i=()=>o(981810),l=()=>o(37394),a=()=>o(596717);let s=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function c(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function d(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function u(e,t){const o=t?[t]:[];return(0,i().v2)(o[0],e)}function p(e,t){return(0,n().f5)({environment:t,collectionContextStore:e})?a().Fh:0}function m(e){let t=e;for(;null!==t&&!t.classList.contains(r().WvK);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function g(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function S(e,t){if(!t)return;const o=l().T.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function h(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}},20643:(e,t,o)=>{o.r(t),o.d(t,{arrowExpandDiagonalBottomLeftToTopRightSmallIcon:()=>r,iconDefinition:()=>n});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M8.912 2.463a.625.625 0 1 0 0 1.25h2.491L8.358 6.758a.625.625 0 1 0 .884.884l3.045-3.045v2.49a.625.625 0 1 0 1.25 0v-4a.625.625 0 0 0-.625-.624zM7.64 8.36a.625.625 0 0 0-.885 0l-3.042 3.043V8.912a.625.625 0 1 0-1.25 0v4c0 .345.28.625.625.625h4a.625.625 0 0 0 0-1.25H4.597l3.042-3.043a.625.625 0 0 0 0-.883"})},r=(0,o(680369).wt)("arrowExpandDiagonalBottomLeftToTopRightSmall",n)},23082:(e,t,o)=>{o.d(t,{A:()=>r});o(242343);var n=o(163643);const r=function(){return(0,n.jsx)(o(932322).Ay,{title:(0,n.jsx)(o(966789).A,{})})}},44250:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>r,K$:()=>n,j6:()=>i})},73771:(e,t,o)=>{o.d(t,{A:()=>F});var n=o(242343),r=()=>o(237385),i=()=>o(803290),l=()=>o(174114),a=()=>o(748267),s=()=>o(439500),c=()=>o(680369),d=o(163643);const u=(0,c().wt)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,d.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),p=(0,c().wt)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,d.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})});var m=()=>o(686752);const g=(0,c().wt)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,d.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var S=()=>o(409211),h=()=>o(14931),f=()=>o(653998),y=()=>o(137476);function v(e,t){y().vd(e,"edit_lock_toggle",t)}var x=()=>o(927999),b=()=>o(84543),C=()=>o(640979),w=()=>o(466321),k=()=>o(433226),I=()=>o(141122),A=()=>o(413871),j=()=>o(331516),R=()=>o(126451),T=()=>o(273520),M=()=>o(935091),_=()=>o(858023),P=()=>o(88271),B=()=>o(103151),V=()=>o(438203);const F=function(e){let{store:t,disableTooltip:o,hideText:n,isInlineCollection:i,buttonStyle:l}=e;const{isMobile:a}=(0,r().Y0)();return a?(0,d.jsx)(W,{store:t,hideText:n}):(0,d.jsx)(H,{store:t,disableTooltip:o,hideText:n,isMobile:a,isInlineCollection:i,buttonStyle:l})};function L(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function O(e,t,o,n,r){return{...L(e,n,r),color:o.text.tertiary,fill:o.lightIconColor}}function E(e,t,o,n,r){return{...L(e,n,r),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function D(e){let{store:t}=e;const o=(0,l().DP)(),n=(0,i().K8)((()=>t.getFormat().block_locked_by),[t]),r=(0,f().tz)(),a=(0,i().K8)((()=>n&&(0,h().c6)(r,A().sk.createChildStore(t,{table:S().oo,id:n}).getModel())),[n,r,t]);return n?(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,d.jsx)("b",{children:a}),br:(0,d.jsx)("br",{}),prompttext:e=>(0,d.jsx)("span",{style:{color:o.text.contrastSecondary},children:e})}})}):null}function z(e,t){k().$.relockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!0,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}function K(e){let{store:t,close:o}=e;const i=(0,r().v3)(),l=(0,n.useCallback)((()=>{!function(e,t){k().$.temporarilyUnlockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!1,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}(i,t),o()}),[i,t,o]),a=(0,n.useCallback)((()=>{!function(e,t){b().createAndCommit({userAction:"PageLockTopbarIndicator.handlePermanentUnlockClick",environment:e,canUndo:!0,perform:o=>{x()._l({environment:e,store:t,isLocked:!1,transaction:o})}});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!1,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}(i,t),o()}),[i,t,o]),c=[{key:"temp_unlock",render:e=>(0,d.jsx)(j().A,{...e,svg:m().pencilLineIcon,title:(0,d.jsx)(f().sA,{defaultMessage:"Unlock for me",id:"pageLockIndicator.temporaryUnlockOption.label"})}),action:()=>{l()}},{key:"perm_unlock",render:e=>(0,d.jsx)(j().A,{...e,svg:s().p,title:(0,d.jsx)(f().sA,{defaultMessage:"Unlock for everyone",id:"pageLockIndicator.permanentUnlockOption.label"})}),action:()=>{a()}}];return(0,d.jsx)(M().A,{menuType:C().gu.Popup,children:(0,d.jsx)(_().Ay,{type:_().Oh.Vertical,onAccept:o,sections:[{key:"unlock_options",render:e=>(0,d.jsx)(P().A,{...e}),items:c}],initialFocus:void 0})})}function H(e){let{store:t,disableTooltip:o,hideText:s,isMobile:c,isInlineCollection:u,buttonStyle:p}=e;const m=(0,l().DP)(),S=(0,r().v3)(),h=(0,n.useCallback)((()=>z(S,t)),[S,t]),y=(0,i().K8)((()=>t.isLockedForAllUsers()),[t]),v=(0,i().K8)((()=>k().$.isTemporarilyUnlocked({userId:t.userId,blockId:t.id})),[t.id,t.userId]),x=(0,i().K8)((()=>I().default.state.open&&I().default.state.targetStore.id===t.id),[t.id]);return y?v?(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[x&&(0,d.jsx)(V().A,{}),(0,d.jsxs)(R().A,{style:E(c,0,m,u,p),onClick:h,hoveredStyle:{background:m.outlineBlueButtonHoveredBackground},pressedStyle:{background:m.outlineBlueButtonPressedBackground},children:[g({width:16,marginRight:s?void 0:4}),!s&&(0,d.jsx)("div",{style:{lineHeight:1},children:(0,d.jsx)(f().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):(0,d.jsx)(B().A,{renderTooltip:()=>(0,d.jsx)(D,{store:t}),disableTooltip:o,render:e=>(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[x&&(0,d.jsx)(V().A,{}),(0,d.jsx)(T().Ay,{popupType:w().n.Popup,renderOrigin:t=>{let{onClick:o}=t;return(0,d.jsxs)(R().A,{style:O(c,0,m,u,p),onClick:o,...e,children:[(0,a().g)({width:16,marginRight:s?void 0:4}),!s&&(0,d.jsx)("div",{style:{lineHeight:1},children:(0,d.jsx)(f().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})},render:e=>{let{close:o}=e;return(0,d.jsx)(K,{store:t,close:o})}})]})}):null}function W(e){let{store:t,hideText:o}=e;const a=(0,l().DP)(),s=(0,r().v3)(),c=(0,n.useCallback)((()=>z(s,t)),[s,t]),m=(0,i().K8)((()=>t.isLockedForAllUsers()),[t]),g=(0,i().K8)((()=>k().$.isTemporarilyUnlocked({userId:t.userId,blockId:t.id})),[t.id,t.userId]),{WindowSizeStore:S}=s,h=(0,i().K8)((()=>S.getSafePaddingLeftCSS(10)),[S]),y=(0,i().K8)((()=>S.getSafePaddingRightCSS(14)),[S]);return m?g?(0,d.jsxs)(R().A,{onClick:c,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:h,paddingRight:y,color:a.blueColor,fill:a.blueColor},children:[p({width:20,height:16,marginRight:6}),!o&&(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):(0,d.jsx)(T().Ay,{popupType:w().n.Popup,renderOrigin:e=>{let{onClick:t}=e;return(0,d.jsxs)(R().A,{onClick:t,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:h,paddingRight:y},children:[u({width:20,marginRight:6}),!o&&(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]})},render:e=>{let{close:o}=e;return(0,d.jsx)(K,{store:t,close:o})}}):null}},89414:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineSmallIcon:()=>r});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M11.243 3.457a.803.803 0 0 0-1.13 0l-.554.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .107 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.02-1.11m-2.246 1.22a.075.075 0 0 0-.106 0l-6.336 6.326a1.1 1.1 0 0 0-.237.393l-.27.87v.002c-.062.232.153.466.389.383l.863-.267q.221-.061.397-.239l6.332-6.331a.075.075 0 0 0 0-.106zm-3.355 6.898a.08.08 0 0 0-.053.022l-1.1 1.1a.075.075 0 0 0 .053.128h9.06a.625.625 0 1 0 0-1.25z"})},r=(0,o(680369).wt)("pencilLineSmall",n)},99949:(e,t,o)=>{o.d(t,{e:()=>i});o(242343);var n=o(163643);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"m4.897 3.086-.122-.143a.625.625 0 0 0-.95.814l1.347 1.57c-1.762.91-3.195 2.304-4.083 3.997a1.47 1.47 0 0 0 0 1.362c1.61 3.07 5.011 5.155 8.911 5.155 1.282 0 2.51-.225 3.637-.637l1.588 1.853a.625.625 0 0 0 1.042-.67L4.989 3.229a.6.6 0 0 1-.093-.143M2.194 9.905c.807-1.538 2.15-2.807 3.816-3.599L7.4 7.928a3.326 3.326 0 0 0 4.252 4.961l1.107 1.292a9.4 9.4 0 0 1-2.76.41c-3.459 0-6.42-1.848-7.805-4.486a.22.22 0 0 1 0-.2m6.696.097q0-.151.039-.29l1.194 1.393q-.06.007-.124.007a1.11 1.11 0 0 1-1.109-1.11m7.012 4.038a9.4 9.4 0 0 0 3.01-3.354 1.47 1.47 0 0 0 0-1.362C17.302 6.254 13.9 4.169 10 4.169c-.805 0-1.588.089-2.339.257l.94 1.096a9.5 9.5 0 0 1 1.4-.103c3.458 0 6.42 1.848 7.804 4.486a.22.22 0 0 1 0 .2 8.14 8.14 0 0 1-2.722 2.98z"}),(0,n.jsx)("path",{d:"M13.205 10.893a3.33 3.33 0 0 0-3.596-4.194z"})]})},i=(0,o(680369).wt)("eyeSlash",r)},125978:(e,t,o)=>{o.d(t,{w:()=>C});o(403517),o(242343);var n=()=>o(237385),r=()=>o(810111),i=()=>o(711361),l=()=>o(653998),a=()=>o(975392),s=()=>o(236339),c=()=>o(927999),d=()=>o(84543),u=()=>o(640979),p=()=>o(535906),m=()=>o(273520),g=()=>o(356813),S=()=>o(935091),h=()=>o(858023),f=()=>o(443252),y=()=>o(88271),v=o(163643);const x=(0,l().j4)((function(e){const{limit:t}=e;return(0,v.jsx)(l().sA,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})})),b=(0,l().YK)({firstLoadLimitActionButtonAriaLabel:{defaultMessage:"Load limit settings menu",id:"database.firstLoadLimitActionButton.ariaLabel"}});function C(e){let{format:t,collectionContextStore:o}=e;const r=(0,n().v3)(),{device:a}=r,u=(0,l().tz)();return a.isMobile?null:(0,v.jsx)(m().Ay,{popupType:f().nl.Popup,renderOrigin:e=>(0,v.jsx)(g().A,{icon:i()._,style:{marginLeft:4,marginRight:4},ariaLabel:u.formatMessage(b.firstLoadLimitActionButtonAriaLabel),...e}),alignmentToOrigin:m().yP.End,placementToOrigin:m().sx.Bottom,originGap:8,render:e=>(0,v.jsx)(k,{currentLimit:w(t),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;if(!n.getType())return;d().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{c().zA({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),(0,s().X)({environment:o,collectionContextStore:t,action:"set_first_load_limit"})}(e,o,r),onClose:e.close,showTitle:!0})})}function w(e){return(0,r().i3)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function k(e){const t=(0,n().v3)(),{device:o}=t,{currentLimit:i,onAccept:s,onClose:c,showTitle:d}=e,m=(0,a().oE)(r().X9.map(((e,t)=>{const o={key:t,render:t=>(0,v.jsx)(p().A,{...t,disabled:!1,title:(0,v.jsx)(x,{limit:e}),isChecked:(0,a().n4)(i,e)}),action:()=>s(e)};return o}))),g=[{key:0,render:e=>(0,v.jsx)(y().A,{enableActionSheetTitle:!0,title:d&&(0,v.jsx)(l().sA,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:m}];let f;return f=o.isMobile?{menuType:u().gu.ActionSheet}:{menuType:u().gu.Popup,width:200},(0,v.jsx)(S().A,{...f,children:(0,v.jsx)(h().Ay,{type:h().Oh.Vertical,sections:g,onAccept:c,initialFocus:void 0})})}},137696:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>l,x2:()=>r});var n=()=>o(76394);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function l(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},153258:(e,t,o)=>{o.d(t,{b:()=>l});var n=()=>o(876695),r=()=>o(137476);var i=()=>o(545313);function l(e){const{environment:t,collectionContextStore:o,view_type:l,view_config_uri:a,from:s,...c}=e;!function(e,t){r().vd(e,"create_view",t)}(t,{...(0,n().sl)(o)||{},...c,view_type:l,view_config_uri:a,from:s}),(0,i().f)({collectionContextStore:o,action:"create_view",from:s,property_type:void 0})}},155347:(e,t,o)=>{o.d(t,{o:()=>a});o(242343);var n=()=>o(174114),r=()=>o(284594),i=()=>o(653998),l=o(163643);function a(e){const{href:t,style:o}=e,a=(0,n().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.text.secondary}})),[]);return(0,l.jsxs)("a",{href:t,target:"_blank",style:{...a.default,...o},children:[(0,r().$)({width:14,marginRight:4}),(0,l.jsx)(i().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},164045:(e,t,o)=>{o.d(t,{j:()=>r,y:()=>i});var n=()=>o(31448);function r(e){const{theme:t,isInHomeWidget:o,isFeedbackButton:r}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...r?{height:o?24:28,color:t.text.tertiary,fill:t.lightIconColor}:o?{height:24,width:24,color:t.text.tertiary,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:n().Wy.regular,lineHeight:1,borderRadius:6}}function i(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:n().Wy.regular,lineHeight:1,borderRadius:6}}},178063:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,plusIcon:()=>r});o(242343);const n={viewBox:"0 0 20 20",svg:(0,o(163643).jsx)("path",{d:"M10 3.59a.66.66 0 0 1 .66.66v5.09h5.09a.66.66 0 0 1 0 1.32h-5.09v5.09a.66.66 0 0 1-1.32 0v-5.09H4.25a.66.66 0 0 1 0-1.32h5.09V4.25a.66.66 0 0 1 .66-.66"})},r=(0,o(680369).wt)("plus",n)},200524:(e,t,o)=>{function n(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}o.d(t,{_:()=>n})},202193:(e,t,o)=>{o.d(t,{Qo:()=>a,hu:()=>s,k9:()=>i,nE:()=>l});var n=()=>o(555919),r=()=>o(654548);const i=(0,o(653998).YK)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"},newTitlePlaceholder:{defaultMessage:"New database",id:"database.source.newTitlePlaceholder"},actionsButtonAriaLabel:{defaultMessage:"Collection actions",id:"database.source.actionsButtonAriaLabel"}});function l(e){let{intl:t,isDBUXChromeEnabled:o,isWorkflowsAppContainerEnabled:n,collectionStore:r}=e;var l;return n?t.formatMessage(o?i.newTitlePlaceholder:i.titlePlaceholder):(null==r||null===(l=r.getModel())||void 0===l?void 0:l.getEmptyTitlePlaceholder({intl:t,isWorkflowsAppContainerEnabled:n}))||t.formatMessage(i.titlePlaceholder)}function a(e){let{collectionStore:t,intl:o,isDBUXChromeEnabled:n,isWorkflowsAppContainerEnabled:r}=e;return t.getName()??[[l({intl:o,isDBUXChromeEnabled:n,isWorkflowsAppContainerEnabled:r,collectionStore:t})]]}function s(e){let{collectionStore:t,intl:o,isDBUXChromeEnabled:i,isWorkflowsAppContainerEnabled:a}=e;return null!=t&&t.isDefined()?(0,r().r4)(t.getName(),t)||l({intl:o,isDBUXChromeEnabled:i,isWorkflowsAppContainerEnabled:a,collectionStore:t}):(0,n().L)(o)}},210290:(e,t,o)=>{o.d(t,{S:()=>c,q:()=>s});o(725707),o(500234);var n=()=>o(236339),r=()=>o(865226),i=()=>o(302376),l=()=>o(29869),a=()=>o(314164);function s(e){const{environment:t,collectionContextStore:o,event:l,buttonPopupParent:s}=e,c=(0,a().t2)(o);if(!c)return null;const d=i().Vr(l);r().oo({environment:t,url:c,openInNew:d}),d||null==s||s.close(),(0,n().X)({environment:t,collectionContextStore:o,action:"click_source_view"})}function c(e){var t;let{environment:o,collectionStore:n,pageVisitSource:a,event:s}=e;const c=n.getParentBlockStore();if(!c)return;const d=null===(t=c.getCollectionViewStores())||void 0===t?void 0:t.find((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===n.id})),u=(0,l().J8)({store:c,fullyQualified:!1,pageVisitSource:a,collectionViewId:null==d?void 0:d.id});r().oo({environment:o,url:u,openInNew:i().Vr(s)})}},229419:(e,t,o)=>{o.d(t,{C8:()=>p,Dz:()=>s,GC:()=>g,GL:()=>S,YY:()=>m,dM:()=>d,h9:()=>c,jX:()=>a,oF:()=>u,uj:()=>l});var n=()=>o(129978);const r={JiraSyncInfoPopup:new(n().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([o.e(75134),o.e(68744)]).then(o.bind(o,917262)))),ImproveJiraSyncPopup:new(n().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([o.e(75134),o.e(2686)]).then(o.bind(o,800444)))),JiraDCAuthModal:new(n().O2)("JiraDCAuthModal",(async()=>await o.e(28763).then(o.bind(o,114124)))),ExternalImportAndSyncIndicator:new(n().O2)("ExternalImportAndSyncIndicator",(async()=>await o.e(98288).then(o.bind(o,988714)))),JiraSyncedAllProjectsTooltip:new(n().O2)("JiraSyncedAllProjectsTooltip",(async()=>await o.e(21446).then(o.bind(o,374415)))),JiraSyncedAllIssuesTooltip:new(n().O2)("JiraSyncedAllIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,374415)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await o.e(21446).then(o.bind(o,374415)))),JiraSyncSourceTooltip:new(n().O2)("JiraSyncSourceTooltip",(async()=>await o.e(21446).then(o.bind(o,374415)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,374415))))},i={JiraSyncTeamSpaceModal:new(n().O2)("JiraSyncTeamSpaceModal",(async()=>Promise.all([o.e(96159),o.e(56188)]).then(o.bind(o,35705))))},l=(0,n()._h)(i.JiraSyncTeamSpaceModal,(e=>e.default)),a=(0,n()._h)(r.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),s=(0,n()._h)(r.JiraDCAuthModal,(e=>e.default)),c=(0,n()._h)(r.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,n()._h)(r.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,n()._h)(r.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n()._h)(r.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),m=(0,n()._h)(r.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),g=(0,n()._h)(r.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),S=(0,n()._h)(r.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,o(680369).xh)("jira",{default:{loader:()=>o.e(60677).then(o.bind(o,832398)),size:20},small:{loader:()=>o.e(60677).then(o.bind(o,832398)),size:16},mini:{loader:()=>o.e(60677).then(o.bind(o,832398)),size:14},large:{loader:()=>o.e(60677).then(o.bind(o,832398)),size:24}})},229895:(e,t,o)=>{o.d(t,{Ay:()=>d,P6:()=>c,l1:()=>s});o(242343);var n=()=>o(174114),r=()=>o(31448),i=()=>o(126451),l=()=>o(286404),a=o(163643);const s=16;function c(e){const t=(0,n().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,a.jsx)(i().A,{style:t.button,onClick:e.onClick,children:e.children})}const d=function(e){const{title:t,description:i,icon:c,style:d,titleStyle:u,buttonText:p,buttonOnClick:m,secondaryButtonText:g,secondaryButtonOnClick:S}=e,h=(0,o(162339).A)(!0,300,0),f=(0,n().IS)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:s,...d},title:{fontSize:17,fontWeight:r().Wy.medium,color:e.text.tertiary,textAlign:"center",marginBottom:-2,...u},description:{margin:"0 auto",fontSize:14,color:e.text.tertiary},button:{marginTop:12,fontSize:14,fontWeight:r().Wy.medium,color:e.text.primary}})),[d,u]);return h?(0,a.jsxs)("div",{style:f.wrapper,children:[c,(0,a.jsx)("div",{style:f.title,children:t}),i?(0,a.jsx)("div",{style:f.description,children:i}):void 0,p?(0,a.jsx)(l().A,{size:"lg",onClick:m,style:f.button,children:p}):void 0,g?(0,a.jsx)(l().A,{size:"lg",onClick:S,style:f.button,children:g}):void 0]}):null}},237894:(e,t,o)=>{o.d(t,{O:()=>c});var n=o(242343),r=()=>o(237385),i=()=>o(497808),l=()=>o(273520),a=()=>o(907721),s=o(163643);function c(e){const{collectionContextStore:t,groupFormat:o,renderLinkButton:c,onAddOrLink:d,...u}=e,p=(0,r().Y0)(),m=(0,n.useCallback)((e=>(0,s.jsx)(i().l7,{collectionContextStore:t,groupFormat:o,onClose:()=>e.close(),onAddOrLink:d})),[t,o,d]);return(0,s.jsx)(l().Ay,{popupType:p.isMobile?l().z7.BottomSheet:l().z7.Popup,alignmentToOrigin:a().C.Start,disableFlippingPlacement:!0,...u,renderOrigin:c,render:m})}},262400:(e,t,o)=>{o.d(t,{X:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},265516:(e,t,o)=>{o.d(t,{Q:()=>n,a:()=>r});let n=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}({});class r extends(()=>o(129044))().default{getInitialState(){return{dayStoreMap:new Map,isDragging:!1,startingMonth:0}}}},268974:(e,t,o)=>{o.d(t,{B:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},271142:(e,t,o)=>{o.d(t,{EC:()=>C,To:()=>b,YC:()=>w,or:()=>x,u:()=>v});o(610931);var n=o(242343),r=()=>o(237385),i=()=>o(803290),l=()=>o(496985),a=()=>o(232312),s=()=>o(653998),c=()=>o(76394),d=()=>o(337658),u=()=>o(73631),p=()=>o(137696),m=()=>o(129978),g=()=>o(113800),S=()=>o(830925),h=o(163643);const f=new WeakMap,y=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});y.displayName="AutomationContext";function v(e){const{automationStore:t,children:o,contextType:n}=e,v=(0,r().v3)(),x=(0,s().tz)(),{value:b}=(0,m().fJ)(u().T.formulas),{value:C}=(0,m().fJ)(d().QV.automationTypecheck),w=(0,S().n)(t),k=(0,i().K8)((()=>{if(!b)return{error:new(a().N9)("Missing formulas dependency")};if(!C)return{error:new(a().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:a,isSubscribed:s}=e,d=f.get(o);if(d)return d;{const e=new(l().default)((()=>{const e=o.getTriggerType();let l=r;return(0,c().O9)(e)&&(0,p().x2)(e)&&(l=(0,p().H8)(e)),(0,g().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:l,formulasModule:i,intl:a,isSubscribed:s})}),{debugName:"automationContextTypecheckResultCachedStore"});return f.set(o,e),e}}({environment:v,automationStore:t,automationTypecheckModule:C,contextType:n,formulasModule:b,intl:x,isSubscribed:w});return e.state}),[v,t,C,n,b,x,w]);return(0,h.jsx)(y.Provider,{value:{automationStore:t,typecheckResult:k,contextType:n,defined:!0},children:o})}function x(e){const{automationStore:t,children:o}=e,n=(0,i().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,h.jsx)(v,{automationStore:t,contextType:(0,p().H8)(n??"event"),children:o})}function b(e){var t;return null===(t=f.get(e))||void 0===t?void 0:t.state}function C(){const e=n.useContext(y);if(!1===e.defined)throw new Error("No automation context found!");return e}function w(){return n.useContext(y)}},276647:(e,t,o)=>{o.d(t,{o:()=>i});var n=o(242343),r=o(163643);const i=n.forwardRef((function(e,t){let{color:n="primary",...i}=e;const l=(0,o(174114).IS)((e=>{const t="blue"===n?o(220413).Ay.blue:"secondary"===n?e.text.secondary:e.text.primary;return{title:{color:t,fill:t},buttonMenuItem:{...i.style,...i.disabled?{cursor:"not-allowed"}:{}}}}),[i.disabled,n,i.style]);return(0,r.jsx)(o(535906).A,{ref:t,...i,title:(0,r.jsx)("div",{style:l.title,children:i.title}),icon:(0,r.jsx)(o(397791).I,{icon:o(178063).plusIcon,style:{fill:n}}),style:l.buttonMenuItem})}))},279150:(e,t,o)=>{o.d(t,{A:()=>r});o(242343);var n=o(163643);function r(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,n.jsx)("div",{style:t})}},280704:(e,t,o)=>{o.d(t,{b:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("plusThick",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})},282074:(e,t,o)=>{o.d(t,{c:()=>c});o(403517),o(242343);var n=()=>o(803290),r=()=>o(975392),i=()=>o(283820),l=()=>o(749975),a=()=>o(162339),s=o(163643);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().Ks)(),m=(0,n().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,a().A)(!0,0,100))return null;let g=1;void 0!==u?g=u:o||c||d||(g=t?10:3);const S=g>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().Hn(g).map((e=>(0,s.jsx)(i().J,{isInHomeWidget:m,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:m?8:3},children:h})}},283820:(e,t,o)=>{o.d(t,{J:()=>l});o(242343);var n=()=>o(174114),r=()=>o(517198),i=o(163643);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().IS)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().A,{style:l.circleShimmer}),(0,i.jsx)(r().A,{style:l.rowShimmer})]})})}},308439:(e,t,o)=>{o.r(t),o.d(t,{exclamationMarkTriangleIcon:()=>i,iconDefinition:()=>r});o(242343);var n=o(163643);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.875 6.75c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625m0 7.375a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,n.jsx)("path",{d:"M8.16 3.563c.818-1.417 2.863-1.417 3.68 0l5.846 10.125c.818 1.416-.204 3.187-1.84 3.187H4.155c-1.636 0-2.659-1.77-1.84-3.187zm2.598.624a.875.875 0 0 0-1.516 0L3.397 14.313a.875.875 0 0 0 .758 1.313h11.69a.875.875 0 0 0 .759-1.312z"})]})},i=(0,o(680369).wt)("exclamationMarkTriangle",r)},312430:(e,t,o)=>{o.r(t),o.d(t,{arrowDiagonalUpRightSmallIcon:()=>r,iconDefinition:()=>n});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M5.603 3.663a.625.625 0 1 0 0 1.25h4.6l-6.371 6.371a.615.615 0 0 0 .014.87.616.616 0 0 0 .87.014l6.371-6.372v4.601a.625.625 0 1 0 1.25 0v-6.11a.625.625 0 0 0-.625-.624z"})},r=(0,o(680369).wt)("arrowDiagonalUpRightSmall",n)},317278:(e,t,o)=>{o.d(t,{g:()=>r});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M8 2.125a.61.61 0 0 0-.625.599v9.017L4.122 8.488a.625.625 0 1 0-.884.884l4.32 4.32c.244.244.64.244.884 0l4.32-4.32a.625.625 0 0 0-.884-.884l-3.253 3.253V2.724A.61.61 0 0 0 8 2.125"})},r=(0,o(680369).wt)("arrowStraightDownSmall",n)},363913:(e,t,o)=>{o.d(t,{i:()=>i});var n=()=>o(129978);const r={ConfigureViewsMainModuleAddViewButton:new(n().O2)("ConfigureViewsMainModuleAddViewButton",(async()=>await Promise.all([o.e(96159),o.e(75134),o.e(43380),o.e(96346),o.e(36192),o.e(55373),o.e(62475),o.e(3151),o.e(44711),o.e(98629),o.e(53321),o.e(58550),o.e(90825),o.e(22900),o.e(36209),o.e(92845),o.e(71718),o.e(48486),o.e(83324),o.e(63077),o.e(41870),o.e(90966),o.e(88552),o.e(90214),o.e(74562),o.e(8184),o.e(28271),o.e(17254),o.e(18895),o.e(78708),o.e(28721),o.e(4422),o.e(28866),o.e(67435),o.e(17989),o.e(76181),o.e(59794),o.e(72832),o.e(90280),o.e(26483),o.e(33813),o.e(2804),o.e(84778),o.e(69914),o.e(26090),o.e(12341),o.e(47864),o.e(90978),o.e(87598),o.e(84341),o.e(6463),o.e(25368),o.e(80759),o.e(68455),o.e(28773),o.e(72883),o.e(1440),o.e(45986),o.e(91137),o.e(92924),o.e(19167),o.e(55717),o.e(10152),o.e(73738),o.e(70584),o.e(97074),o.e(88208)]).then(o.bind(o,470440))))},i=(0,n()._h)(r.ConfigureViewsMainModuleAddViewButton,(e=>e.ConfigureViewsMainModuleAddViewButton))},377963:(e,t,o)=>{o.d(t,{I:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},387013:(e,t,o)=>{o.d(t,{T:()=>r});var n=()=>o(716605);function r(e){const{block:t,property:o,schema:r,getRecordModel:i,userId:l,userTimeZone:a,intl:s,experimentService:c,collectionFeatureGates:d,formulasModule:u}=e;if(!t)return!1;if("title"===o)return!1;const p=r[o];return!(!p||"checkbox"!==p.type)||(!(!p||"button"!==p.type)||(!(!p||"status"!==p.type)||!n().r8({property:o,schema:r,block:t,getRecordModel:i,userId:l,userTimeZone:a,intl:s,experimentService:c,collectionFeatureGates:d,formulasModule:u})))}},420111:(e,t,o)=>{o.d(t,{O:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},434626:(e,t,o)=>{o.r(t),o.d(t,{eyeIcon:()=>i,iconDefinition:()=>r});o(242343);var n=o(163643);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_9098_13290)",children:[(0,n.jsx)("path",{d:"M10 13.504a3.5 3.5 0 1 0-.001-7.002A3.5 3.5 0 0 0 10 13.504m1.167-3.502a1.168 1.168 0 1 1-2.335.002 1.168 1.168 0 0 1 2.335-.002"}),(0,n.jsx)("path",{d:"M10 3.895c-4.093 0-7.662 2.189-9.351 5.408-.231.44-.231.964 0 1.404 1.689 3.22 5.258 5.408 9.351 5.408s7.662-2.189 9.351-5.408c.231-.44.231-.964 0-1.404-1.689-3.22-5.258-5.408-9.351-5.408m-8.245 5.99C3.218 7.096 6.347 5.144 10 5.144s6.782 1.952 8.245 4.74a.26.26 0 0 1 0 .24c-1.463 2.788-4.592 4.74-8.245 4.74s-6.782-1.952-8.245-4.74a.26.26 0 0 1 0-.24"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_9098_13290",children:(0,n.jsx)("path",{d:"M0 0h20v20H0z"})})})]})},i=(0,o(680369).wt)("eye",r)},438203:(e,t,o)=>{o.d(t,{A:()=>r});o(242343);var n=o(163643);const r=function(){const e=(0,o(174114).IS)((e=>({separator:{height:14,width:1,marginLeft:6,marginRight:6,background:e.darkDividerColor}})),[]);return(0,n.jsx)("div",{style:e.separator})}},439500:(e,t,o)=>{o.d(t,{p:()=>i});o(242343);var n=o(163643);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,n.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},i=(0,o(680369).wt)("lockOpen",r)},469118:(e,t,o)=>{o.d(t,{C:()=>r});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M9.372 3.238a.625.625 0 1 0-.884.884l3.253 3.253H2.75a.625.625 0 0 0 0 1.25h8.991l-3.253 3.253a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})},r=(0,o(680369).wt)("arrowStraightRightSmall",n)},471745:(e,t,o)=>{o.d(t,{A:()=>r});o(725707),o(500234);class n extends(()=>o(151255))().A{findTableHeaderCell(e,t){return this.find((o=>o.collectionContextStore===e&&o.property===t))}}const r=new n},476894:(e,t,o)=>{o.d(t,{y:()=>W});o(362833),o(725707),o(324989),o(403517),o(113085);var n=o(242343),r=()=>o(237385),i=()=>o(803290),l=()=>o(740520),a=()=>o(625491),s=()=>o(507190),c=()=>o(434626),d=()=>o(918305),u=()=>o(718799),p=()=>o(954397),m=()=>o(836693),g=()=>o(653998),S=()=>o(975392),h=()=>o(236339),f=()=>o(521325),y=()=>o(927999),v=()=>o(84543),x=()=>o(283759),b=()=>o(535906),C=()=>o(935091),w=()=>o(858023),k=()=>o(397791),I=()=>o(88271),A=()=>o(103151),j=()=>o(390263),R=()=>o(782422),T=()=>o(654548),M=()=>o(202193),_=()=>o(640979),P=()=>o(906230),B=()=>o(392608),V=()=>o(622286),F=()=>o(760813),L=()=>o(598808),O=()=>o(520969),E=()=>o(907721),D=()=>o(308265),z=()=>o(259897),K=()=>o(210290),H=o(163643);function W(e){let{collectionViewStore:t,collectionContextStore:o,onClose:T}=e;const M=(0,r().v3)(),D=(0,r().Y0)(),W=(0,g().tz)(),N=(0,j().Zp)(),$=(0,V().X)("db_ux_chrome"),U=(0,i().K8)((()=>function(e){var t;let{collectionViewStore:o,collectionContextStore:n,onClose:r,environment:i,intl:S,previewContext:C,isDBUXChromeEnabled:w}=e;const I=n.permissionScopesStore.state,j=n.collectionViewStore(),T=n.collectionViewBlockStore();if(!j||!T)return[];const M=(0,O().Nh)(T.id),_=(0,R().sj)(T.id),V=(0,B().J9)(i);if("feed"===o.getType()&&(M||V))return[];const D=j.id===o.id,W=o.getAppConfigUri(),N=!W||(0,x().$h)(W),$=n.collectionStore(),U=Boolean((null==$||null===(t=$.getParentBlockStore())||void 0===t?void 0:t.id)===T.id),q=void 0!==$||"page"===o.getType(),X=U&&n.isFullScreenStore.state,Y=o.getType(),Q=n.viewsModuleContextStore,Z=void 0!==Q.state,J=I.canConfigureBlock&&q&&!Z,ee=!_&&"form_editor"!==Y&&"page"!==Y&&q&&I.canConfigureBlock,te=T.getCollectionViewIds().length>1,oe=n.isEditableHomeCollectionStore.state,ne=!_&&(te||oe)&&"page"!==Y&&I.canConfigureBlock,re=$&&!X&&!Z&&!(null!=C&&C.disablePageLinks),ie=!Z&&q&&!(null!=C&&C.disablePageLinks),le=Q.currentPageStore(),ae=null==le?void 0:le.getAssociatedCollectionStore(),se=le&&!Q.isInLayoutBuilder()&&(0,L().Y)({environment:i,blockStore:le,from:"viewsModule"}),ce=n.isFullScreenStore.state,de=Boolean(T.getCollectionPointerIfSingleSource()),ue=!M&&I.canConfigureBlock&&(!ce||!de)&&!(null!=C&&C.hideViewBlockSource)&&!("page"===Y&&void 0===o.getFormat().page_pointer),pe=[];pe.push([]),se&&le&&ae&&pe[0].push({key:"configure_layout",render:e=>(0,H.jsx)(b().A,{...e,title:(0,H.jsx)(g().sA,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,H.jsx)(k().I,{icon:d()._})}),action:()=>{ae&&le&&(0,F().nh)({environment:i,blockStore:le,collectionStore:ae,from:"collection_view_action_menu",initialSelectedModuleType:"viewsMain"})}});if(J){if(pe[0].push({key:"rename",render:e=>(0,H.jsx)(A().A,{placement:E().W.Left,disableTooltip:N,render:t=>(0,H.jsx)(b().A,{...e,disabled:!N,disabledFeedback:!0,title:(0,H.jsx)(g().sA,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,H.jsx)(k().I,{icon:a().M}),...t}),renderTooltip:()=>(0,H.jsx)(g().sA,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{(0,h().X)({environment:i,collectionContextStore:n,action:"view_action_menu_rename"}),null==r||r(!0),D||(0,z().t)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:ce,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),f().Ow({collectionContextStore:n,collectionSettingsStore:n.settingsStore,selectViewNameInitial:!0})}}),"page"===Y)return pe;pe[0].push({key:"edit",render:e=>(0,H.jsx)(b().A,{...e,title:(0,H.jsx)(g().sA,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,H.jsx)(k().I,{icon:p().slidersIcon})}),action:()=>{(0,h().X)({environment:i,collectionContextStore:n,action:"view_action_menu_edit"}),null==r||r(!0),D||(0,z().t)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:n.isFullScreenStore.state,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),f().Ow({collectionContextStore:n,collectionSettingsStore:n.settingsStore})}})}pe.push([]),ie&&pe[1].push({key:"copyLink",render:e=>(0,H.jsx)(b().A,{...e,title:(0,H.jsx)(g().sA,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,H.jsx)(k().I,{icon:u().w})}),action:async()=>{(0,h().X)({environment:i,collectionContextStore:n,action:"view_action_menu_copy_link"}),await f().GH({environment:i,collectionContextStore:n,collectionViewStore:o}),null==r||r(!1)}});re&&pe[1].push({key:"openSourceDb",render:e=>(0,H.jsx)(A().A,{placement:E().W.Right,render:t=>(0,H.jsx)(b().A,{title:U?(0,H.jsx)(g().sA,{defaultMessage:"Open as full page",id:"database.viewSettings.viewActionMenu.openAsFullPage"}):(0,H.jsx)(g().sA,{defaultMessage:"Open source database",id:"database.viewSettings.viewActionMenu.openSourceDb"}),icon:(0,H.jsx)(k().I,{icon:l().arrowDiagonalUpRightIcon}),...(0,P().A)(e,t)}),renderTooltip:()=>(0,H.jsx)(G,{collectionStore:$})}),action:e=>{(0,K().q)({environment:i,collectionContextStore:n,event:e.event})}});if(ue){const e=(()=>{if(w){const e=T.getFormatStore().getKeyValue("hide_inline_collection_name");return void 0===e?T.getCollectionViewStores().some((e=>e.getFormatStore().getKeyValue("hide_linked_collection_name"))):e}return n.normalizedFormatStore.state.hide_linked_collection_name})();pe[1].push({key:"showDatabaseTitle",render:t=>(0,H.jsx)(b().A,{...t,title:e?(0,H.jsx)(g().sA,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}):(0,H.jsx)(g().sA,{defaultMessage:"Hide database title",id:"database.viewSettings.viewActionMenu.hideDatabaseTitle"}),icon:(0,H.jsx)(k().I,{icon:c().eyeIcon})}),action:()=>{const t=!e;(0,h().X)({environment:i,collectionContextStore:n,action:t?"click_source_hide_title":"click_source_show_title"}),v().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,canUndo:!0,perform:e=>{y().zA({stores:[o],update:{hide_linked_collection_name:t},transaction:e})}}),w&&v().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,canUndo:!0,perform:e=>{y().zA({stores:[T],update:{hide_inline_collection_name:t},transaction:e})}}),null==r||r(!1)}})}pe.push([]),ee&&pe[2].push({key:"duplicate",render:e=>(0,H.jsx)(b().A,{...e,title:(0,H.jsx)(g().sA,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,H.jsx)(k().I,{icon:s().V})}),action:()=>{(0,h().X)({environment:i,collectionContextStore:n,action:"view_action_menu_duplicate"}),f().vr({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,intl:S,from:"view_action_menu_duplicate"}),null==r||r(!0)}});ne&&pe[2].push({key:"delete",render:e=>(0,H.jsx)(b().A,{...e,title:(0,H.jsx)(g().sA,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,H.jsx)(k().I,{icon:m().trashIcon}),isRedOnHover:!0}),action:async()=>{(0,h().X)({environment:i,collectionContextStore:n,action:"view_action_menu_delete"});const e="form_editor"===(null==o?void 0:o.getType())?o.getFormBlockStore():void 0;await f().nl({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,additionalBlocksToDelete:e?[e]:void 0,from:"view_action_menu"})&&(null==r||r(!1))}});return pe}({collectionViewStore:t,collectionContextStore:o,onClose:T,environment:M,intl:W,previewContext:N,isDBUXChromeEnabled:$})),[o,t,M,W,T,N,$]),q=U.flatMap((e=>e)).length>0;return{renderMenu:(0,n.useCallback)((()=>{if(!q)return null;const e=D.isMobile?{menuType:_().gu.Modal,title:(0,H.jsx)(g().sA,{defaultMessage:"View options",id:"database.viewSettings.viewActionMenu.title"})}:{menuType:_().gu.Popup,width:220};return(0,H.jsx)(C().A,{...e,children:(0,H.jsx)(w().Ay,{type:w().Oh.Vertical,initialFocus:void 0,sections:S().oE(U.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,H.jsx)(I().A,{...e,topBorder:0!==t}),items:e}})))})})}),[q,D.isMobile,U]),hasMenuItems:q}}function G(e){const{collectionStore:t}=e,o=(0,g().tz)(),n=(0,V().X)("db_ux_chrome"),r=(0,D().BG)(),l=(0,i().K8)((()=>{const e=t.getNameStore();return(0,T().r4)(e.getValue(),e)||(0,M().nE)({intl:o,isDBUXChromeEnabled:n,isWorkflowsAppContainerEnabled:r,collectionStore:t})}),[t,r,o,n]);return(0,H.jsx)(g().sA,{id:"database.viewSettings.viewActionMenu.openDbTooltip",defaultMessage:"Opens “{dbName}”",values:{dbName:l}})}},493738:(e,t,o)=>{o.d(t,{u:()=>r});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M7.1 1.975a5.125 5.125 0 1 0 3.155 9.164l3.107 3.107a.625.625 0 1 0 .884-.884l-3.107-3.107A5.125 5.125 0 0 0 7.1 1.975M3.225 7.1a3.875 3.875 0 1 1 7.75 0 3.875 3.875 0 0 1-7.75 0"})},r=(0,o(680369).wt)("magnifyingGlassSmall",n)},497808:(e,t,o)=>{o.d(t,{DV:()=>s,W5:()=>l,l7:()=>a,y7:()=>i});var n=()=>o(129978);const r={CollectionNewViewsPopupComponent:new(n().O2)("CollectionNewViewsPopupComponent",(async()=>await Promise.all([o.e(96159),o.e(96346),o.e(36192),o.e(55373),o.e(36209),o.e(92845),o.e(71718),o.e(48486),o.e(83324),o.e(63077),o.e(41870),o.e(90966),o.e(88552),o.e(90214),o.e(74562),o.e(8184),o.e(28271),o.e(17254),o.e(78708),o.e(67435),o.e(62620)]).then(o.bind(o,464342)))),CollectionViewSelect:new(n().O2)("CollectionViewSelect",(async()=>await o.e(35756).then(o.bind(o,230274)))),CollectionLinkExistingModal:new(n().O2)("CollectionLinkExistingModal",(async()=>await Promise.all([o.e(96159),o.e(96346),o.e(36192),o.e(55373),o.e(44711),o.e(53321),o.e(90825),o.e(36209),o.e(92845),o.e(71718),o.e(48486),o.e(83324),o.e(63077),o.e(41870),o.e(90966),o.e(88552),o.e(90214),o.e(74562),o.e(8184),o.e(28271),o.e(17254),o.e(18895),o.e(78708),o.e(4422),o.e(67435),o.e(76181),o.e(72832),o.e(90280),o.e(84778),o.e(26090),o.e(12341),o.e(47864),o.e(90978),o.e(5287)]).then(o.bind(o,407049)))),ModalOverlayCollectionView:new(n().O2)("ModalOverlayCollectionView",(async()=>await Promise.all([o.e(96159),o.e(96346),o.e(36209),o.e(92845),o.e(71718),o.e(48486),o.e(83324),o.e(73361),o.e(32413)]).then(o.bind(o,532623))))},i=(0,n()._h)(r.CollectionNewViewsPopupComponent,(e=>e.CollectionNewViewsPopupComponent)),l=(0,n()._h)(r.CollectionViewSelect,(e=>e.CollectionViewSelect)),a=(0,n()._h)(r.CollectionLinkExistingModal,(e=>e.CollectionLinkExistingModal)),s=(0,n()._h)(r.ModalOverlayCollectionView,(e=>e.ModalOverlayCollectionView))},502622:(e,t,o)=>{o.d(t,{X:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("arrowsUpDown",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M4.11 2.385a.61.61 0 01.48-.211c.191 0 .353.07.486.21L8.03 5.409a.66.66 0 01.2.475c0 .191-.061.347-.182.469a.627.627 0 01-.463.181.59.59 0 01-.451-.187L5.926 5.098l-.72-.844.04 1.219v7.242a.624.624 0 01-.187.469.624.624 0 01-.47.187.636.636 0 01-.468-.187.635.635 0 01-.182-.47V5.474l.041-1.22-.726.845-1.201 1.248a.61.61 0 01-.457.187.627.627 0 01-.463-.181.634.634 0 01-.182-.47.66.66 0 01.2-.474l2.958-3.023zm7.786 10.781a.636.636 0 01-.486.205.665.665 0 01-.486-.205l-2.947-3.035a.64.64 0 01-.206-.475c0-.191.061-.345.182-.463a.634.634 0 01.469-.181c.18 0 .33.06.451.181l1.201 1.248.727.85-.041-1.219V2.824c0-.187.06-.342.181-.463a.636.636 0 01.47-.187.627.627 0 01.65.65v7.248l-.041 1.219.726-.85 1.207-1.248a.6.6 0 01.451-.181c.188 0 .342.06.463.181a.615.615 0 01.182.463.648.648 0 01-.2.475l-2.953 3.035z"})})},533639:(e,t,o)=>{o.d(t,{p:()=>n});class n extends(()=>o(998969))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}},533666:(e,t,o)=>{o.d(t,{Y:()=>r});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M3.2 6.725a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55"})},r=(0,o(680369).wt)("ellipsisSmall",n)},534891:(e,t,o)=>{o.d(t,{a:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})},559181:(e,t,o)=>{o.d(t,{A:()=>i});o(242343);var n=()=>o(653998),r=o(163643);const i=function(e){let{collectionViewName:t,collectionViewType:i}=e;return t?(0,r.jsx)(o(826033).A,{children:t}):"page"===i?(0,r.jsx)(n().sA,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,r.jsx)(n().sA,{...o(91338).X[i]})}},591039:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,lightningSmallIcon:()=>r});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"M9.332 1.38a.575.575 0 0 0-.662.204l-4.936 6.84a.575.575 0 0 0 .466.911h2.398l-.315 4.32a.575.575 0 0 0 1.039.378l4.944-6.832a.575.575 0 0 0-.466-.912H9.401l.309-4.328a.575.575 0 0 0-.378-.582M7.216 8.185H5.324l3.095-4.289-.209 2.927a.575.575 0 0 0 .574.616h1.89l-3.097 4.28.212-2.917a.575.575 0 0 0-.573-.617"})},r=(0,o(680369).wt)("lightningSmall",n)},614234:(e,t,o)=>{o.d(t,{H:()=>r});var n=()=>o(137476);function r(e){const{collectionContextStore:t,environment:o,incrementLimitArgs:r}=e;t.groupsStore.incrementLimit(e.incrementLimitArgs),t.loadingDetailsStore.setState({type:"load_more_blocks",group:r.groupsPointer}),n().vd(o,"collection_load_more_blocks")}},631152:(e,t,o)=>{o.d(t,{LA:()=>C,jJ:()=>w});o(242343);var n=()=>o(237385),r=()=>o(803290),i=()=>o(174114),l=()=>o(712437),a=()=>o(317278),s=()=>o(680369),c=()=>o(653998),d=()=>o(5612),u=()=>o(614234),p=()=>o(191756),m=()=>o(360378),g=()=>o(782422),S=()=>o(48092),h=()=>o(502852),f=()=>o(126451),y=()=>o(966789),v=()=>o(125978),x=o(163643);const b=30,C=33;function w(e){const{style:t,iconStyle:o,store:C,format:w,collectionContextStore:k,groupsPointer:I,incrementLimitsInRelatedGroups:A,isFullScreen:j}=e,R=(0,n().v3)(),T=(0,r().K8)((()=>k.groupsStore.getGroupState(I)),[k,I]),M=(0,r().K8)((()=>(0,S().Kk)({collectionContextStore:k,groupsPointer:I})),[k,I]),_=(0,r().O$)(k.isInHomeWidgetStore),P=(0,i().IS)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:b,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,..._?{textAlign:"center",width:"fit-content",marginLeft:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginLeft:8,marginRight:8},icon:{width:s().Ev.sm,height:s().Ev.sm,marginRight:6,fill:e.icon.tertiary,...o},text:{color:e.text.tertiary,width:"100%",fontSize:_?14:void 0},hoveredStyle:{...M?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}}})),[_,t,M,o]),B=(0,r().K8)((()=>C.canEdit()),[C]);return T?_?(0,x.jsx)("div",{style:P.homeContainer,children:(0,x.jsx)(f().A,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,r=(0,g().sj)(o.id)?l().y8.PersonalHomeTileTasks:l().y8.PersonalHomeTileCustomDb;p().uK({environment:t,store:o,pageVisitSource:r,openInNew:n})}(e,R,C),onMouseDown:h().tr,style:P.button,children:(0,x.jsx)("div",{style:P.text,children:(0,x.jsx)(c().sA,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,x.jsxs)(f().A,{onClick:e=>function(e,t,o,n,r,i){const l=o.groupsStore.getGroupState(n);if(!l)return;const a=l.reducerResultStore.state;(0,h().kV)(e),m().IU({environment:t}),a&&(0,u().H)({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:a.blockIds.length,groupsPointer:l.groupsPointer,incrementLimitsInRelatedGroups:r}});(0,d().K)(t)}(e,R,k,I,A,j),onMouseDown:h().tr,disabled:M,hoveredStyle:P.hoveredStyle,style:P.button,children:[(0,a().g)(P.icon),(0,x.jsx)("div",{style:P.text,children:(0,x.jsx)(c().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),M?(0,x.jsx)("div",{style:P.loadingContainer,children:(0,x.jsx)(y().A,{size:"sm"})}):B&&(0,x.jsx)(v().w,{collectionContextStore:k,format:w})]}):null}},662505:(e,t,o)=>{o.d(t,{A:()=>c});o(242343);var n=()=>o(237385),r=()=>o(174114),i=()=>o(198654),l=()=>o(126451),a=()=>o(622286),s=o(163643);function c(e){const{icon:t,title:o,on:c,disabled:d,hasDiff:u,wrapStyle:p,innerStyle:m,hideChevron:g}=e,{isMobile:S}=(0,n().Y0)(),h=(0,a().X)("db_ux_chrome"),f=(0,r().IS)((e=>({container:{borderRadius:14,marginRight:6,display:"inline-flex",...u&&{position:"relative"},...p},filterPill:{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:S?28:24,lineHeight:S?"28px":"24px",padding:"0 8px",...!h&&{border:`1px solid ${e.outlineButtonBorder}`},color:e.text.secondary,...c&&{color:e.text.uiBluePrimary,borderColor:e.filterPillBorder,background:e.tint.uiBlue},...d&&{color:e.text.uiBlueTertiary,borderColor:e.text.uiBlueTertiary,background:e.tint.uiBlue},...m},hovered:c?{background:e.tint.uiBlueHover}:{},pressed:c?{background:e.tint.uiBluePressed}:{},chevron:{width:10,marginLeft:4,marginTop:1,fill:d?e.text.uiBlueTertiary:c?e.blueColor:e.lightIconColor},diffDot:{position:"absolute",top:-2,right:-2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[u,p,S,h,c,d,m]);return(0,s.jsxs)("div",{style:f.container,children:[(0,s.jsxs)(l().A,{disabled:d,style:f.filterPill,hoveredStyle:f.hovered,pressedStyle:f.pressed,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,!g&&(0,i().b)(f.chevron)]}),u&&(0,s.jsx)("div",{style:f.diffDot})]})}},663821:(e,t,o)=>{o.r(t),o.d(t,{arrowChevronSingleDownSmallIcon:()=>r,iconDefinition:()=>n});o(242343);const n={viewBox:"0 0 16 16",svg:(0,o(163643).jsx)("path",{d:"m12.76 6.52-4.32 4.32a.62.62 0 0 1-.44.18.62.62 0 0 1-.44-.18L3.24 6.52a.63.63 0 0 1 0-.88c.24-.24.64-.24.88 0L8 9.52l3.88-3.88c.24-.24.64-.24.88 0s.24.64 0 .88"})},r=(0,o(680369).wt)("arrowChevronSingleDownSmall",n)},679426:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>af,CollectionViewBlockWithErrorBoundary:()=>sf});var n=o(242343),r=(o(725707),o(403517),o(244387),o(113085),()=>o(486826)),i=()=>o(470637),l=()=>o(752597),a=()=>o(237385),s=()=>o(269280),c=()=>o(551919),d=()=>o(803290),u=()=>o(174114),p=()=>o(129044),m=()=>o(860330),g=()=>o(329911),S=()=>o(201430),h=()=>o(199001),f=()=>o(975392),y=()=>o(76394),v=()=>o(236339),x=()=>o(521325),b=()=>o(373122),C=()=>o(385531),w=()=>o(932196),k=()=>o(360378),I=()=>o(384221),A=()=>o(84543),j=()=>o(198653),R=()=>o(466417),T=(o(500234),()=>o(934807)),M=()=>o(314164),_=()=>o(861334);var P=()=>o(229419),B=()=>o(400885),V=()=>o(724903),F=()=>o(96297),L=()=>o(622286),O=()=>o(141122),E=o(163643);const D=n.memo((function(e){const{store:t,collectionContextStore:r,isFullScreen:i,canEdit:l,showHoverActionsStore:s,paddingLeft:c,addViewButton:p}=e,m=(0,L().X)("db_ux_chrome"),g=(0,a().v3)(),[S,h]=(0,n.useState)(!1),f=(0,d().K8)((()=>{const e=O().default.state;return(0,V().RX)(t)||!(0,V().cq)(t)&&e.open&&e.isClosing}),[t]),y=(0,d().K8)((()=>r.collectionStore()),[r]),v=(0,d().K8)((()=>r.collectionViewBlockStore()),[r]),x=(0,d().K8)((()=>Boolean(null==y?void 0:y.isSyncedCollection())),[y]),b=(0,d().K8)((()=>Math.min(B().x6,g.WindowSizeStore.state.width)),[g.WindowSizeStore]),C=(0,u().IS)((()=>{const e={display:"flex",alignItems:"center",justifyContent:"space-between",width:f?b:"100%",boxSizing:f?"content-box":void 0,...(i||f)&&(0,F().z4)(g)&&{position:"sticky",left:0}},t={flexGrow:m?1:void 0};return m?e.padding=`4px 0 4px ${i?c??0:0}px`:e.paddingTop=8,{containerHoverArea:t,container:e,flex:{display:"flex"},button:{margin:0},syncedContainer:{paddingLeft:4}}}),[g,i,f,m,b,c]),w=(0,n.useCallback)((()=>{h(!0)}),[]),k=(0,n.useCallback)((()=>{h(!1)}),[]);return y&&v?(0,E.jsxs)("div",{onMouseEnter:w,onMouseLeave:k,style:C.containerHoverArea,children:[(0,E.jsxs)("div",{style:C.container,children:[(0,E.jsx)(o(801204).D,{collectionContextStore:r,showHoverActionsStore:s,addViewButton:p,isHovered:S}),x&&(0,E.jsx)("div",{style:C.flex,children:(0,E.jsx)(o(546057).A,{canEdit:l,store:v,buttonStyle:C.button})})]}),(0,E.jsxs)("div",{style:C.syncedContainer,children:[(0,E.jsx)(o(517722).A,{collectionStore:y,collectionContextStore:r}),(0,E.jsx)(P().GL,{store:y})]})]}):null}));o(358848),o(91270),o(771702);var z=()=>o(145017),K=()=>o(870099),H=()=>o(220574),W=()=>o(435794);const G=new(o(380123).R)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function N(e,t){let{lastActionWasCut:o,valuePromise:n}=t;const r=(0,W().hB)(e);G.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const i=await n;if(!i)return void G.setState({});const{recordMaps:l,...a}=i;G.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...a,recordMapsJson:q(l)}})}function $(e){const t=G.getState(),o=(0,W().hB)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{G.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:a}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:a||!1,value:{...l,recordMaps:U(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:U(r.recordMapsJson)}}):Promise.resolve(void 0)}function U(e){return new Map(e.map((e=>{let[t,o]=e;return[t,H().RecordMap.create(o)]})))}function q(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson()]}))}var X=()=>o(91472),Y=()=>o(983048),Q=()=>o(564230),Z=()=>o(164186),J=()=>o(655830),ee=()=>o(749975),te=()=>o(117041),oe=()=>o(190217),ne=()=>o(303298),re=()=>o(981810),ie=()=>o(370639),le=()=>o(129978),ae=()=>o(413871),se=()=>o(182613),ce=()=>o(205670);const de=n.memo((function(){const e=(0,a().v3)(),t=(0,ee().ET)(),{value:r}=(0,le().fJ)(te().g),{value:i}=(0,le().fJ)(oe().S),s=(0,d().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),c=(0,d().K8)((()=>{if(ce().default.isEditingStore.state)return!1;const e=se().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,re().oC)(e))return!1;const n=(0,o(103265).zN)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===s}),[s]),u=n.useCallback((async o=>{(await X().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=se().default.state.stores;N(o,{lastActionWasCut:!1,valuePromise:ue(e).then((o=>{const{result:r,status:i}=o;if("failed"===i)return;for(const n of r){var l;(0,K().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const a=r.length>0;for(const c of n){var s;(0,K().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:a,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return pe({environment:e,subitems:r})}))})}),[t,e,r]),p=n.useCallback((async o=>{(await X().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=t.collectionStore();if(null!=n&&n.isExternallyImportedAndSyncedCollection()&&(0,ie().pB)())return;const i=se().default.state.stores,l=ue(e),a=ue(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)(0,K().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:s});const r=o.length>0;for(const l of i)(0,K().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:r,collection_id:s});return pe({environment:e,subitems:o})}));await N(o,{lastActionWasCut:!0,valuePromise:a});const c=se().default.getState().stores,d=(await l).result;await Y().vX({blocks:c,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,s,e,r]),m=n.useCallback((async o=>{var n,a,c,d;const u=await X().R.clipboardActions.load(),p=await $(o),m=await ne().VI.loadLocalSubtree.load(),g=await ne().VI.duplicateActions.load();if(G.setState({...G.getState(),lastActionWasCut:!1}),!p){A().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{u.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:t,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}});const t=se().default.state.stores[0];if(void 0===t)return;return void(0,K().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:s})}const S=t.collectionViewBlockStore();if(!S)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,ie().pB)())return;const{recordMaps:f,subitemFormat:y,childRelationSchema:v,parentRelationSchema:x}=p.value;if(!(f&&y&&v&&x))return;const b=[...f.entries()].map((e=>{let[t]=e;return ae().Bv.createChildStore(h,{table:z().ev,id:t})}));await Promise.all(b.map((e=>e.load())));const C=se().default.getState().stores,w=!(p.lastActionWasCut&&function(e,t){const o=t.map((t=>ae().Bv.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,b));let I=[],j=re().n9(t),R=null===(n=j)||void 0===n?void 0:n.parentRelationProperty,T=null===(a=j)||void 0===a?void 0:a.childRelationSchema,M=null===(c=j)||void 0===c?void 0:c.parentRelationSchema,_=null===(d=j)||void 0===d?void 0:d.subitemFormat;const P=t.permissionScopesStore.state.canConfigureCollection;for(const t of b)(0,K().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:p.value.isBulk,collection_id:s});if(A().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:n=>{if(!_&&P){Y().VI({transaction:n,collectionContextStore:t,environment:e})&&(j=re().n9(t),j&&(R=j.parentRelationProperty,T=j.childRelationSchema,M=j.parentRelationSchema,_=j.subitemFormat))}if(!(R&&T&&M&&_))return void u.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:n,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i});const l=w?Y().B2({blocks:b,environment:e,transaction:n,recordMaps:f,migrateSubitemFormat:{from:y,to:_},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:v,parentRelationSchema:x},analyticsFrom:p.lastActionWasCut?"cut":"copy",loadLocalSubtreeModule:m,duplicateActionsModule:g}):Y().fA({blocks:b,transaction:n,from:y,to:_,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:n,subitemFormat:r,collectionContextStore:i,transaction:l}=e,a=i.collectionStore();if(!a)return;const s=o.at(-1),c=re().Px(n,r);if(0===c.length)return;if(s){const e=re().W5(i,s),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof ae().Bv&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),s);c.forEach((e=>{Y().VT({environment:t,blockStore:e,collectionStore:a,subitemFormat:r,transaction:l}),o&&Q().j$({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:l,position:{type:"after"}})}))}else c.forEach((e=>{Y().VT({environment:t,blockStore:e,collectionStore:a,subitemFormat:r,transaction:l})}))}({environment:e,selectedBlocks:C,blocksToInsert:l,subitemFormat:_,collectionContextStore:t,transaction:n}),Z().LE({environment:e,blocksToInsert:l,target:C,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),I=l}}),!(R&&T&&M&&_))return;const B=re().BK({blocks:I,parentRelationProperty:R,parentRelationSchema:M,collectionViewBlockStore:S});l().default.afterNextFlush((()=>{l().default.afterNextFlush((()=>{k().td({environment:e,stores:B})}))}))}),[t,s,e,r,i]);return(0,E.jsx)(J().A,{debugName:`CollectionViewKeyboardArea-${s}`,capture:!0,priority:c?0:-1,onCopy:u,onCut:p,onPaste:m})}));function ue(e){const t=se().default.getState().stores;return Y().zM({environment:e,blocks:t})}function pe(e){let{subitems:t,environment:n}=e;const r=se().default.getState().stores,i=r.at(0);if(!i)return;const l=(0,re().oC)(i);if(!l)return;const a=[...r,...t],s=f().oE(a.map((e=>{const t=(0,o(134549).loadLocalSubtree)(n,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}).recordMap;return t&&[e.id,t]}))),c=new Map(s),{subitemFormat:d,childRelationSchema:u,parentRelationSchema:p}=l;return{recordMaps:c,subitemFormat:d,childRelationSchema:u,parentRelationSchema:p,isBulk:t.length>0}}var me=()=>o(86979);const ge=new(le().O2)("lazyCreateHasSchemaChangedForQueryStore",(async()=>await o.e(42050).then(o.bind(o,322469))));function Se(e){const{collectionContextStore:t,previewContext:o,isPlaceholderExternalCollection:n}=e;return(0,d().K8)((()=>{var e,r,i;return Boolean(!n&&!(null!=o&&o.hideViewBlockSource)&&t.shouldShowSourceStore.state&&!t.isUnlistedViewStore.state&&(null===(e=t.collectionStore())||void 0===e?void 0:e.canRead())&&"custom"!==(null===(r=t.collectionViewStore())||void 0===r?void 0:r.getType())&&"chat"!==(null===(i=t.collectionViewStore())||void 0===i?void 0:i.getType()))}),[t,o,n])}var he=()=>o(377561),fe=()=>o(390263),ye=()=>o(817181),ve=()=>o(73631),xe=()=>o(137476);async function be(e){const t=await ve().T.formulas.load();t.setFormulaParsingInstrumentation((()=>{class n extends t.FormulaParsingInstrumentation{constructor(){super(...arguments),this.pendingMetricsMap={},this.throttledFlushMetrics=f().nF((()=>{this.flushMetrics()}),15*o(643553).TD,{trailing:!0})}flushMetrics(){0!==Object.keys(this.pendingMetricsMap).length&&((0,xe().u4)({environment:e,event:{eventName:"collections_formula_parsing_cache_stats",eventProperties:(0,o(141666).MU)((0,y().WP)(this.pendingMetricsMap).map((e=>{let[t,o]=e;return[n.metricNameToEventProperty[t],o??0]})))}}),this.pendingMetricsMap={})}incrMetricImpl(e){this.pendingMetricsMap[e]=(this.pendingMetricsMap[e]??0)+1,this.throttledFlushMetrics()}}return n.metricNameToEventProperty={"formulas.parsing.weak_map_cache.hit":"weak_map_cache_hit","formulas.parsing.weak_map_cache.miss":"weak_map_cache_miss"},new n}))}var Ce=()=>o(782422),we=()=>o(983050),ke=()=>o(876695),Ie=()=>o(475923),Ae=()=>o(333212),je=()=>o(155297),Re=()=>o(302376),Te=()=>o(502852),Me=()=>o(37312),_e=()=>o(917717),Pe=()=>o(211923),Be=()=>o(838517),Ve=()=>o(196387),Fe=()=>o(573643),Le=()=>o(382640),Oe=()=>o(48913),Ee=()=>o(907721),De=()=>o(962373),ze=()=>o(595922),Ke=()=>o(802955),He=()=>o(983965),We=()=>o(172470),Ge=()=>o(963768),Ne=()=>o(230557),$e=()=>o(551455),Ue=()=>o(825634),qe=()=>o(603769),Xe=()=>o(937968),Ye=()=>o(547124),Qe=()=>o(970709),Ze=()=>o(44658),Je=()=>o(349947);async function et(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,y().WP)(t).map((async t=>{let[o,n]=t;return Je().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:z().ev,id:o},userId:e.currentUser.id,minimumVersion:n})})))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}var tt=()=>o(627618);const ot=tt().union([tt().isUndefined(),tt().object({required:{blockIdToVersion:tt().record(tt().string(),tt().number())},optional:{hasMore:tt().boolean()}})]);class nt{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.handleCollectionSchemaChange=e=>{if(!this.collectionContextStore.isClientModeEnabledStore.state&&e.state){var t,o;const e=`${null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.id}:${null===(o=this.collectionContextStore.collectionStore())||void 0===o||null===(o=o.getModel())||void 0===o?void 0:o.getVersion()}`;this.throttledRefetch({src:"change_schema",trigger:e})}},this.isServerQueryCollectionRequiredForCollectionEmit=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,Ze().Xj)(ot,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,y().WP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Ze().Xj)(ot,e)&&!e.hasMore)},this.throttledRefetch=(0,o(531367).A)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,y().uv)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await et({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,R().M)(this.environment,this.collectionContextStore,e),(0,o(23371).wR)(t)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,Ze().Xj)(ot,o)&&null!=o&&o.blockIdToVersion&&(0,y().WP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequiredForCollectionEmit(o,r),!n)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}subscribeToSchemaChanges(e){e.addListener(this.handleCollectionSchemaChange)}unsubscribeFromSchemaChanges(){var e;null===(e=this.collectionContextStore.hasSchemaChangedForQueryStore)||void 0===e||e.removeListener(this.handleCollectionSchemaChange)}}var rt=()=>o(388615),it=()=>o(435819),lt=()=>o(367859),at=()=>o(753030),st=(o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(491955),()=>o(65866)),ct=()=>o(691641),dt=()=>o(716605),ut=()=>o(52531),pt=()=>o(653998),mt=()=>o(32901),gt=()=>o(624153),St=()=>o(795394),ht=()=>o(579275),ft=()=>o(116586),yt=()=>o(206183);o(362833);function vt(e){let{collectionContextStore:t,property:o,blockStores:n}=e;const r=t.normalizedFormatStore.state.collection_group_by;if((null==r?void 0:r.property)!==o)return;const i=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,f().E$)(e,se().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(n,t),l=[];for(const[a,s]of i.entries())s.state.includes(a)||l.push(a);l.length&&k().DN({stores:(0,f().R9)(se().default.state.stores,l)})}var xt=()=>o(477784),bt=()=>o(485966),Ct=()=>o(34662);class wt extends p().default{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===Ct().q4_(o)}))}}var kt=()=>o(615917),It=()=>o(126451),At=()=>o(356813),jt=()=>o(103151),Rt=()=>o(224281);const Tt=32;function Mt(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const _t=(0,pt().YK)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Pt(e){const{marginLeft:t}=e,r=(0,a().v3)(),i=(0,n.useRef)(null),l=(0,n.useRef)(void 0),s=(0,ee().ET)(),c=(0,d().K8)((()=>s.collectionViewBlockStore()),[s]),p=(0,d().uB)(void 0,wt),[m,g]=(0,n.useState)(!1),{selectedItems:S,selectedItemCount:h}=(0,d().K8)((()=>{const e=se().default.state.stores;return{selectedItems:e,selectedItemCount:e.length}}),[]),f=(0,d().K8)((()=>p.getNumberOfTextStoresBeingEdited()),[p]),y=(0,d().K8)((()=>{var e;return!!(0,M().f5)({environment:r,collectionContextStore:s})&&(!S.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(f>0||S.length>=1&&(0,M().Rd)(S,null===(e=s.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[s,r,f,S]);(0,d().K8)((()=>{const e=Ce().jQ().state;e.isOpen?l.current=e.property:l.current&&vt({collectionContextStore:s,property:l.current,blockStores:S})}),[s,S],{debugName:"cleanUpSelection"});const v=(0,d().K8)((()=>c&&"suggest"!==o(615661).Uv.getMode(c)),[c]),x=(0,n.useCallback)((e=>{e||g(!1)}),[]),b=(0,u().IS)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.shadowSM,height:Tt},outer:{position:"sticky",top:1,left:t??0,zIndex:999,visibility:m?"visible":"hidden"},outerLayoutAdjust:{marginBottom:-Tt},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.text.primary},trashButton:{borderRadius:0,height:"100%",border:0,...Mt(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[m,t]);return(0,E.jsx)(ht().A,{capture:y,render:e=>(0,E.jsxs)(kt().A,{visible:y,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:x,ref:i,...e,style:b.outer,children:[(0,E.jsx)(rt().s,{allowSelectionWithin:!1,children:(0,E.jsxs)("div",{style:b.inner,children:[(0,E.jsx)(Bt,{selectedItemCount:h,numTextStoresBeingEdited:f}),(0,E.jsx)(zt,{collectionsBulkActionsToolbarStore:p,selectedItems:S,marginLeft:t,setIsReadyToRender:g,outerContainerRef:i}),v&&(0,E.jsx)(jt().A,{renderTooltip:()=>(0,E.jsx)("div",{children:xt().A.formatMessage(_t.delete)}),render:e=>(0,E.jsx)(At().A,{...e,ariaLabel:xt().A.formatMessage(_t.delete),icon:()=>(0,ut().I)(b.trashButtonIcon),style:b.trashButton,hoveredStyle:b.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;(0,K().N)(r,{analyticsName:mt().AY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=s.collectionStore())||void 0===e?void 0:e.id}),await Z().Af({environment:r,blocks:S,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,t)=>{var o,n;(null===(o=e.getAssociatedCollectionStore())||void 0===o?void 0:o.id)===(null===(n=s.collectionStore())||void 0===n?void 0:n.id)&&St().by({childStore:e,transaction:t})}})}}),placement:Ee().W.Top}),(0,E.jsx)(o(872386).A,{store:S[0],fadeIn:!1,style:b.blockActionMenuButton,hoveredStyle:b.blockActionMenuButton,iconStyle:b.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,E.jsx)("div",{style:b.outerLayoutAdjust})]})})}function Bt(e){const{selectedItemCount:t,numTextStoresBeingEdited:o}=e,r=(0,a().v3)(),i=(0,n.useMemo)((()=>o>0?o:Math.max(1,t)),[o,t]),l=(0,n.useCallback)((()=>k().IU({environment:r})),[r]),s=(0,u().IS)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Mt(e)}})),[]);return(0,E.jsx)(It().A,{style:s.button,onClick:l,children:(0,E.jsx)(pt().sA,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const Vt=6,Ft=450,Lt=2,Ot=32,Et=150,Dt=new Set(["title","rollup","formula","button"]);function zt(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:l}=e,a=(0,ee().ET)(),s=(0,n.useRef)(null),c=(0,n.useRef)([]),p=(0,d().O$)(a.normalizedSchemaStore),m=(0,d().K8)((()=>a.databaseType===st().TC&&r.some((e=>e.getPropertyValue(ct().y.MeetingNoteToCalendarEventRelation)))),[a,r]),g=(0,d().K8)((()=>{var e;const t=a.normalizedFormatStore.state;return((null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=a.collectionStore(),{property:o,visible:n}=e;if((0,dt()._f)(null==t?void 0:t.getModel(),o))return!m;const i=p[o];return n&&i&&!Dt.has(i.type)&&(0,yt().g2)({propertySchema:i,property:o,blockStores:r,collectionSchema:p,collectionStore:t,spaceStore:bt().default.state.currentSpaceStore})})))??[]).slice(0,Vt)}),[a,p,r,m]),[S,h]=(0,n.useState)(Vt),[y,v]=(0,n.useState)(!1);(0,n.useEffect)((()=>{c.current.length>0&&c.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[c]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:l,setShowIconsOnly:a,setHiddenButtonsIndex:s}=e;(0,n.useEffect)((()=>{const e=f().sg((()=>{var e,n,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-Et;let g=r.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:Vt;let S=r.current.findIndex(((e,t)=>p+t*Ot>m));S=-1!==S?S:Vt;const h=g<Lt||u<=Ft;a(h),s(h?S:g),l(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,s,l,a])}({propertyButtonsContainerRef:s,propertyButtonRefs:c,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:h,setShowIconsOnly:v});const x=(0,u().IS)((()=>({container:{display:"flex"}})),[]);return(0,E.jsx)("div",{ref:s,style:x.container,children:g.map(((e,t)=>{var r;let i=null===(r=c.current[t])||void 0===r?void 0:r.element;if(!i){const e=n.createRef();c.current[t]={element:e,rightEdge:0},i=e}const l=t>=S;return(0,E.jsx)("div",{ref:i,children:(0,E.jsx)(Kt,{collectionsBulkActionsToolbarStore:o,schema:p,property:e.property,isHidden:l,showIconsOnly:y},e.property)},e.property)}))})}function Kt(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:i,showIconsOnly:l}=e,s=(0,L().X)("db_ux_mobile"),c=(0,a().v3)(),p=(0,ee().ET)(),m=(0,n.useRef)(null),g=(0,d().uB)(void 0,ft().A),S=o[t],h=(0,d().K8)((()=>!(p.permissionScopesStore.state.canEditContent||"collectionTypedView"===p.contextType)),[p]),f=(0,u().IS)((e=>({button:{display:i?"none":"flex",paddingLeft:8,paddingRight:8,height:Tt,alignItems:"center",...Mt(e)},property:{maxWidth:"250px",textOverflow:"ellipsis"},icon:{fill:e.text.primary}})),[i]),y=(0,n.useCallback)((async e=>{var o,n;if(!m.current)return;const i=se().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=m.current)||void 0===o?void 0:o.getBoundingClientRect();if(i.length<1)return;const a=i[0].getAssociatedCollectionStore();p&&l&&a&&await gt().V({environment:c,store:i[0],additionalStores:i.slice(1),property:t,rect:l,format:"table",collectionStore:a,blockPropertyValueOverlayStore:Ce().jQ(),collectionContextStore:p,statusSetCheckbox:"checkbox"===(null===(n=p.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:g,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r,isDBUXMobileEnabled:s})}),[m,p,c,t,g,r,s]),v=(0,n.useCallback)((()=>null==S?void 0:S.name),[S]),x=(0,n.useCallback)((e=>S?(0,E.jsx)(It().A,{...e,ariaLabel:S.name,ref:m,style:f.button,disabled:h,onClick:y,children:(0,E.jsx)(Rt().mA,{style:f.property,propertySchema:S,hideName:l,showIcon:!0,property:t,iconStyle:f.icon})}):null),[y,h,t,S,l,f.button,f.icon,f.property]);return S?(0,E.jsx)(jt().A,{renderTooltip:v,render:x,disableTooltip:!l,placement:Ee().W.Top}):null}const Ht=n.memo((function(e){const{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e,i=(0,a().v3)(),l=(0,ee().ET)(),s=(0,d().K8)((()=>(0,M().f5)({environment:i,collectionContextStore:l,overrideViewType:r})),[i,l,r]),c=(0,d().K8)((()=>{var e;if(!s)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)-2}),[s,n,o,t]);return s?(0,E.jsx)(Pt,{marginLeft:c}):null}));var Wt=()=>o(755648),Gt=()=>o(339189);const Nt=new(le().O2)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(1440),o.e(47536)]).then(o.bind(o,243899)))),$t=(0,le()._h)(Nt,(e=>e.CollectionTasksEmptyStateModal));var Ut=()=>o(29393),qt=()=>o(619262),Xt=()=>o(780942),Yt=()=>o(279150);const Qt="noWritableDbs";function Zt(e){const{collectionContextStore:t,onAddTaskClick:r,from:i}=e,l=(0,a().v3)(),s=(0,n.useRef)(null),c=(0,d().O$)(t.isInHomeWidgetStore),p=(0,d().K8)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),m=(0,d().K8)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),g=(0,d().K8)((()=>(0,M().h6)(t)),[t]),S=(0,d().K8)((()=>!t.isFullScreenStore.state),[t]),h=(0,n.useCallback)((e=>{x().Ub({environment:l,handleAddItemClick:r,buttonRef:s,event:e})}),[l,r,s]),f=(0,u().IS)((e=>({container:{width:"100%",height:S?"calc(100% - 4px)":void 0,paddingTop:S?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.text.tertiary},icon:(0,Le().Xx)(e)})),[S]),y=(0,n.useMemo)((()=>p?(0,E.jsx)(jt().A,{disableTooltip:m,placement:Ee().W.Bottom,renderTooltip:()=>(0,E.jsx)(pt().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,E.jsx)("br",{})}}),render:e=>(0,E.jsx)(Xt().p,{...e,isBlue:!0,ref:s,disabled:!m,disabledFeedback:!m,onClick:e=>{(0,Ut().bS)({environment:l,from:i}),h(e)},icon:e=>(0,Gt().W)(e),children:g})}):(0,E.jsx)(Xt().p,{isBlue:!0,onClick:()=>{(0,Ut().bS)({environment:l,from:i}),qt().A.setState(!0)},children:(0,E.jsx)(pt().sA,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[p,m,g,l,i,h]);return c&&!p?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)($t,{from:i}),(0,E.jsx)(Fe().Ww,{feature:"tasks",onSetup:()=>{(0,Ut().bS)({environment:l,from:i}),qt().A.setState(!0)}})]}):(0,E.jsxs)("div",{style:f.container,children:[(0,E.jsx)($t,{from:i}),(0,o(158082).p)(f.icon),(0,E.jsx)(Yt().A,{size:16}),m?(0,E.jsx)(pt().sA,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,E.jsx)(pt().sA,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,E.jsx)(Yt().A,{size:16}),y]})}var Jt=()=>o(880195),eo=()=>o(393342),to=()=>o(517198);function oo(e){let t,{store:o,collectionViewStore:n,collectionContextStore:r}=e,i=n.getFormat().page_pointer;const l=r.viewsModuleContextStore;if(!i&&"viewsMain"===(null==l?void 0:l.getViewModuleType())){const e=l.currentPageStore();e&&(i=e.pointer,t=e)}if(i)return t??=o.id===i.id?o:ae().Bv.createChildStore(o,{table:i.table,id:i.id,spaceId:i.spaceId}),t.isPageBlock()||t.isCollectionView()?t:void 0}var no=()=>o(743456),ro=()=>o(248584);const io=new(le().O2)("views-main-builder-modules",(()=>Promise.all([o.e(44711),o.e(53321),o.e(36209),o.e(92845),o.e(71718),o.e(63077),o.e(90966),o.e(28271),o.e(17254),o.e(72883),o.e(40186),o.e(61660),o.e(70605)]).then(o.bind(o,142189)))),lo=(0,le()._h)(io,(e=>e.ViewsMainBuilderModules));var ao=()=>o(946854),so=()=>o(797470),co=()=>o(587912),uo=()=>o(144451);const po=n.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:s,pageLayoutRef:c,collectionContextStore:u,editorContentContainerRef:p}=e,m=(0,a().v3)(),g=(0,d().K8)((()=>r.getSchema()),[r]),S=(0,d().K8)((()=>(0,o(506181).A)({environment:m,store:n,pageViewBlockStore:void 0})),[m,n]),h=(0,E.jsx)(E.Fragment,{children:t.map((e=>(0,E.jsx)(mo,{module:e,store:n,context:i,disabled:l,collectionSchema:g,collectionStore:r,modules:t,templatePickerMenuListStore:s,pageLayoutRef:c,pageDiscussionsRenderState:S,editorContentContainerRef:p},e.id)))});return u?(0,E.jsx)(ee().RI,{value:u,children:h}):h}));function mo(e){let{module:t,store:r,context:i,disabled:l,collectionSchema:s,collectionStore:c,modules:u,templatePickerMenuListStore:p,pageLayoutRef:m,pageDiscussionsRenderState:g,editorContentContainerRef:S}=e;const h=(0,a().v3)(),f=(0,uo().Br)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:s,collectionStore:c,pageMainModules:u,showDetailsPanelToggleButtonBelowTitle:!1}),v=(0,uo().Jh)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:s,collectionStore:c,showDetailsPanelToggleButtonBelowTitle:!1,modules:u}),x=(0,d().K8)((()=>!(0,o(230849).g)({environment:h,layoutArea:"views_main_tab_modules",moduleType:t.type,pageViewBlockContext:i})),[h,t.type,i]);return(0,o(611758).p)(t,"views_main_tab_modules")?(0,ao().gx)(t)?(0,E.jsx)(o(92627).v,{context:i,disabled:l,propertyId:t.propertyId,store:r,pageModule:t,wrapper:v,stackPropertyLabelAndValue:x},`${t.id}-${r.id}`):(0,ao().i_)(t)?(0,E.jsx)(n.Fragment,{children:(0,E.jsx)(o(991649).h,{context:i,disabled:l,store:r,wrapper:v,layoutModule:t,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:x,disableContainerPadding:!0,disableLastRowBottomPadding:x},showDefaultTitle:!0})},`${t.id}-${r.id}`):"editor"===t.type?(0,E.jsx)(co().p,{context:i,disabled:l,handlePlaceholderWrapClick:e=>no().YB(e,r,h),pageBlockStore:r,pathToBlockId:t.pathToBlockId,templatePickerMenuListStore:p,pageViewBlockAccessor:()=>(null==m?void 0:m.current)??null,editorWrapper:i===so().Rr.DraftPostInInlineComposer?void 0:v,ref:S}):"relationsGroup"===t.type?(0,E.jsx)(o(851861).z,{pageStore:r,wrapper:v,disabled:l,context:i,showDefaultTitle:f}):"deleted_property"===t.type?null:"discussions"===t.type?(0,E.jsx)(o(521869).d,{store:r,wrapper:v,showDefaultTitle:f,discussionLocation:"page_discussion",pageDiscussionsRenderState:g}):void(0,y().HB)(t):null}var go=()=>o(116485),So=()=>o(639659);const ho=n.memo((function(e){const{store:t,canEdit:r,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:s,isFullScreen:c,editorContentContainerRef:u}=e,p=(0,a().v3)(),m=(0,n.useRef)(null),g=(0,d().K8)((()=>t.isNonEditableState()),[t]),S=(0,So().a)(),h=(0,ee().ET)(),f=(0,o(710548).sS)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:y,viewsMainTabId:v}=(0,d().K8)((()=>{const e=null==f?void 0:f.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==s?void 0:s.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[s,f]),x=(0,ro().n$)(),b=(0,d().K8)((()=>(0,V().cq)(t)?so().Rr.PeekView:h.isFullScreenStore.state?so().Rr.CollectionPageViewFullScreen:so().Rr.CollectionPageView),[h,t]),C=(0,Be().VE)(t),w=(0,d().K8)((()=>{const e=o(593745).K.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),k=(0,d().K8)((()=>(0,o(518471).NS)(C,t,b,p)),[C,t,b,p]),I=!r||g||S,A=S&&v?(0,E.jsx)("div",{style:{paddingTop:24,paddingRight:4},children:(0,E.jsx)(lo,{viewsMainTabId:v,pageLayoutType:k})}):y&&l?(0,E.jsx)(go().Mx,{ref:m,type:k,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?x:void 0},children:(0,E.jsx)(po,{context:b,modules:y,store:t,disabled:I,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:m,collectionContextStore:w,editorContentContainerRef:u})}):(0,E.jsx)(go().Mx,{ref:m,type:k,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?x:void 0},children:(0,E.jsx)(co().p,{context:b,disabled:I,handlePlaceholderWrapClick:e=>no().YB(e,t,p),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>m.current,ref:u})});return(0,E.jsx)(Jt().A,{name:"PageView",children:A})})),fo=n.memo(n.forwardRef((function(e,t){let{store:o,collectionViewStore:n,style:r,isFullScreen:i,editorContentContainerRef:l,templatePickerMenuListStore:a,isViewsModule:s}=e;const c=(0,ee().ET)(),u=(0,d().K8)((()=>c.collectionStore()),[c]),p=(0,d().K8)((()=>"collectionSystemView"===c.contextType),[c]),m=(0,d().K8)((()=>oo({store:o,collectionViewStore:n,collectionContextStore:c})),[o,n,c]),g=!(0,Be().bx)(m,p);return s?m?(0,E.jsx)("div",{style:r,children:(0,E.jsx)(ho,{canEdit:!g,disabled:g,store:m,collectionViewStore:n,templatePickerMenuListStore:a,collectionStore:u,isFullScreen:i,editorContentContainerRef:l})}):null:(0,E.jsx)(eo().c,{disabled:!1,displayName:"CollectionPagePageContent",ref:t,style:r,children:(0,E.jsx)(Jt().A,{name:"CollectionPageView",children:m?(0,E.jsx)(ho,{canEdit:!g,disabled:g,store:m,collectionViewStore:n,templatePickerMenuListStore:a,collectionStore:u,isFullScreen:i,editorContentContainerRef:l}):null})})})));var yo=()=>o(3364),vo=()=>o(596717),xo=()=>o(635900),bo=()=>o(392608),Co=()=>o(98508),wo=()=>o(142708);function ko(e){const{style:t,children:o}=e,n=(0,u().IS)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,E.jsx)(wo().H,{type:Co().A.Y,style:n.scroller,children:o})}function Io(e){let{store:t,children:r,isFullScreen:i,currentViewType:l,isInPeek:s,isInHomeWidget:c,handleEditorClick:u,isRootOrDirectChild:p,leftRightPaddingStore:m,paddingBottom:g,viewSettingsPlacementStore:S,paddingLeft:h,format:f,isMyTasksEmpty:v,isHomeCustomDbEmpty:x,isInFrameWhenSidePeekOpen:b,handleHorizontalScrollerMount:C,handleEditorMouseDown:w,isUnlistedView:k,isPreviewing:I}=e;const A=(0,ee().ET)(),R=(0,a().v3)(),{isPhone:T}=(0,a().Y0)(),M=(0,L().X)("disable_rectangular_selection_for_database_horizontal_scroll"),_=(0,d().K8)((()=>(0,bo().w6)(R)),[R]),P=(0,d().K8)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isPreviewing:r,isUnlistedView:i,isSettingsView:l,collectionViewType:a}=e;if(r)return Co().A.None;if("page"===a||"feed"===a)return Co().A.None;if(i)return Co().A.All;if(n)return Co().A.X;if(l)return Co().A.X;if(!o||!(0,F().z4)(t))return Co().A.X;return Co().A.None}({environment:R,isFullScreen:i,isPreviewing:I,isInPeek:s,isUnlistedView:Boolean(k),isSettingsView:"collectionSettings"===A.contextType,collectionViewType:l})),[k,R,i,I,s,A,l]),B=(0,d().K8)((()=>!("collectionSystemView"===A.contextType)&&c&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"chat":return!0;case"calendar":case"map":case"feed":case"custom":return!1;default:return(0,y().HB)(e)}}(l)),[A,c,l]),V=(0,d().K8)((()=>j().B2({blockStore:t,isFullScreen:i,environment:R,collectionContextStore:A})),[t,i,R,A]),O=(0,d().K8)((()=>{const e=m.state,o=A.settingsStore.state.open,n=A.isInHomeWidgetStore.state&&A.isEditableHomeCollectionStore.state;let r={};return k&&(r=T?{height:_?vo().gK:vo().NH,width:void 0}:{height:vo().PN,width:void 0}),{flexGrow:1,flexShrink:0,...t.isNonEditableState()&&{cursor:"default"},..."timeline"===l&&A.collectionStore()&&!i&&!(0,xo().Od)({environment:R,format:f,isFullScreen:i,isRootChild:p})&&e&&{marginLeft:e.paddingLeft,marginRight:e.paddingRight,marginBottom:g},...o&&!i&&"sidebar"===S.state&&{minHeight:yo().iZ},...n?{paddingRight:8,paddingLeft:"list"===l?8:16}:{},...c&&!B?{maxHeight:"inherit"}:{},...v||x||!B?{height:"100%"}:{},...!b||"timeline"===l||c||k?{}:{position:"sticky",left:0,paddingLeft:h,width:(0,Oe().Uh)(R)},..."chart"===l&&b&&!c?{paddingLeft:h}:{},..."page"===l?{zIndex:86}:{},...V&&{marginLeft:-vo().Fh},...r,..."custom"===l&&{height:"100%"}}}),[m,A,p,t,l,i,R,f,g,S,c,B,v,x,b,h,V,k,T,_]),D=(0,So().a)(),z=(0,d().K8)((()=>D&&"page"===l?Co().A.All:s||c?Co().A.None:o(111066).u5(R)),[R,s,c,D,l]),K=(0,n.useCallback)((e=>{u(e,l)}),[u,l]),H=(0,E.jsx)(wo().H,{type:P,className:we().ohG,onMouseDown:M?void 0:w,preventType:z,onClick:K,style:O,ref:C,children:r});return B?(0,E.jsx)(ko,{style:{..."list"===l?{paddingBottom:8}:"timeline"===l?{paddingBottom:0}:{paddingBottom:16},...c&&"feed"!==l?{paddingTop:12}:{}},children:H}):H}var Ao=()=>o(680369);const jo=(0,Ao().wt)("formBuilderDisabled",{viewBox:"0 0 72 72",svg:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.77344 41.6953V17.2031H53.4922V22.6875H57.2656V13.2656C57.2656 10.8594 56.6562 9.04688 55.4375 7.82812C54.2188 6.60938 52.375 6 49.9062 6H9.35938C6.90625 6 5.0625 6.60938 3.82812 7.82812C2.60938 9.03125 2 10.8438 2 13.2656V41.9062C2 44.3125 2.60938 46.1172 3.82812 47.3203C5.0625 48.5391 6.90625 49.1484 9.35938 49.1484H40.4062V45.375H9.40625C8.23438 45.375 7.33594 45.0703 6.71094 44.4609C6.08594 43.8359 5.77344 42.9141 5.77344 41.6953ZM53.4922 13.4766V13.8984H5.77344V13.4766C5.77344 12.2578 6.08594 11.3359 6.71094 10.7109C7.33594 10.0859 8.23438 9.77344 9.40625 9.77344H49.8594C51.0156 9.77344 51.9062 10.0859 52.5312 10.7109C53.1719 11.3359 53.4922 12.2578 53.4922 13.4766Z"}),(0,E.jsx)("path",{d:"M14.1641 34.0781H40.4062V41.6719H14.1641C13.5391 41.6719 13.0312 41.4844 12.6406 41.1094C12.2656 40.7344 12.0781 40.2422 12.0781 39.6328V36.1172C12.0781 35.5078 12.2656 35.0156 12.6406 34.6406C13.0312 34.2656 13.5391 34.0781 14.1641 34.0781Z"}),(0,E.jsx)("path",{d:"M63.5781 34.5C63.8594 34.5 64.0938 34.5938 64.2812 34.7812C64.4792 34.9688 64.5781 35.2031 64.5781 35.4844C64.5781 35.776 64.4792 36.0208 64.2812 36.2188C64.0938 36.4167 63.8594 36.5156 63.5781 36.5156H52.4375C52.1458 36.5156 51.901 36.4167 51.7031 36.2188C51.5156 36.0208 51.4219 35.776 51.4219 35.4844C51.4219 35.2031 51.5156 34.9688 51.7031 34.7812C51.901 34.5938 52.1458 34.5 52.4375 34.5H63.5781Z"}),(0,E.jsx)("path",{d:"M63.5781 39.75C63.8594 39.75 64.0938 39.849 64.2812 40.0469C64.4792 40.2344 64.5781 40.4688 64.5781 40.75C64.5781 41.0417 64.4792 41.2865 64.2812 41.4844C64.0938 41.6823 63.8594 41.7812 63.5781 41.7812H52.4375C52.1458 41.7812 51.901 41.6823 51.7031 41.4844C51.5156 41.2865 51.4219 41.0417 51.4219 40.75C51.4219 40.4688 51.5156 40.2344 51.7031 40.0469C51.901 39.849 52.1458 39.75 52.4375 39.75H63.5781Z"}),(0,E.jsx)("path",{d:"M51.875 45.173C52.0377 45.0681 52.2252 45.0156 52.4375 45.0156H57.9062C58.1979 45.0156 58.4375 45.1146 58.625 45.3125C58.8229 45.5104 58.9219 45.7552 58.9219 46.0469C58.9219 46.3177 58.8229 46.5521 58.625 46.75C58.4375 46.9375 58.1979 47.0312 57.9062 47.0312H55.244C55.2387 47.0458 55.2332 47.0605 55.2276 47.0751C55.2093 47.1229 55.1899 47.1699 55.1695 47.216C55.1592 47.1922 55.1491 47.168 55.1392 47.1437C55.124 47.106 55.1097 47.0685 55.0963 47.0312H52.4375C52.2252 47.0312 52.0377 46.9816 51.875 46.8822C51.8142 46.845 51.757 46.801 51.7031 46.75C51.5156 46.5521 51.4219 46.3177 51.4219 46.0469C51.4219 45.9193 51.4398 45.8008 51.4756 45.6912C51.5218 45.5501 51.5976 45.4239 51.7031 45.3125C51.757 45.2587 51.8142 45.2122 51.875 45.173Z"}),(0,E.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.4062 31.9844C44.4062 30.2656 44.849 28.9531 45.7344 28.0469C46.6302 27.1406 47.9375 26.6875 49.6562 26.6875H66.3438C68.0521 26.6875 69.3542 27.1406 70.25 28.0469C71.1458 28.9531 71.5938 30.2656 71.5938 31.9844V55.4688C71.5938 57.1979 71.1458 58.5104 70.25 59.4062C69.3542 60.3021 68.0521 60.75 66.3438 60.75H49.6562C47.9375 60.75 46.6302 60.3021 45.7344 59.4062C44.849 58.5104 44.4062 57.1979 44.4062 55.4688V31.9844ZM47.875 55.1719C47.875 55.8594 48.0521 56.3802 48.4062 56.7344C48.7604 57.099 49.2969 57.2812 50.0156 57.2812H65.9844C66.7031 57.2812 67.2344 57.099 67.5781 56.7344C67.9323 56.3802 68.1094 55.8594 68.1094 55.1719V32.2812C68.1094 31.6042 67.9323 31.0833 67.5781 30.7188C67.2344 30.3542 66.7031 30.1719 65.9844 30.1719H50.0156C49.2969 30.1719 48.7604 30.3542 48.4062 30.7188C48.0521 31.0833 47.875 31.6042 47.875 32.2812V55.1719Z"})]})});var Ro=()=>o(31448),To=()=>o(712437),Mo=()=>o(572589),_o=()=>o(99949),Po=()=>o(728373),Bo=()=>o(128057),Vo=()=>o(401857),Fo=()=>o(836331),Lo=()=>o(304047);function Oo(e){const{environment:t,groupsFormatKey:n,collectionContextStore:r,currentGroups:i}=e;if(Fo().default.checkGate({gateName:"collection_group_reducer_visible"}))return;const l=r.normalizedFormatStore.state;if(""!==r.searchQueryStore.state)return;if((0,Bo().I6)(r))return;const a=l[n]||[];if(!r.permissionScopesStore.state.canConfigureBlock)return;if(0===i.length)return;const s=i.slice(0,Vo()._9),c=a.slice(0,Vo()._9);f().n4(s,c)||A().createAndCommit({userAction:"collectionGroupActions.persistFormatGroups",environment:t,canUndo:!1,perform:e=>{(0,Lo().o)({collectionContextStore:r,newGroups:i,groupsFormatKey:n,transaction:e}),e.postSubmitCallbacks.push((()=>{(0,o(649782).a)({environment:t,collectionContextStore:r,request_reason:"persist_format_groups"})}))}})}var Eo=()=>o(927999),Do=()=>o(759625),zo=()=>o(191756),Ko=()=>o(981927),Ho=()=>o(745859),Wo=()=>o(564134),Go=()=>o(214144),No=()=>o(21045);function $o(e,t){xe().vd(e,"board_item_delete_newly_created",t)}var Uo=()=>o(614234),qo=()=>o(631152),Xo=()=>o(414930),Yo=()=>o(768022),Qo=()=>o(427091),Zo=(o(107652),o(324989),()=>o(223276)),Jo=()=>o(21164),en=()=>o(217741),tn=()=>o(213517),on=()=>o(799220),nn=()=>o(716826),rn=()=>o(551102),ln=()=>o(586588),an=()=>o(285714),sn=()=>o(993254),cn=()=>o(306323),dn=()=>o(53214),un=()=>o(752230);function pn(e){var t;const{store:o,groupsPointer:n,environment:r,collectionContextStore:i,transaction:l}=e;if(!o.isDefined())return;const a=i.normalizedSchemaStore.state,s=i.relativeVariableStore.state,c=null===(t=i.viewsModuleContextStore.currentPageStore())||void 0===t?void 0:t.id,d=new Map,u=new Map;for(const p of n){const e=Yo().jV({block:o.getModel(),schema:a,propertyMapping:void 0,userFilterContext:{userId:r.currentUser.id,userTimeZone:(0,Qo().P)(),userStartOfWeek:Ce().XX.state},group:p,groupBy:i.getGroupByAndGroupFormats().groupBy,getRecordModel:o.getRecordModel,intl:xt().A.getIntl(),relativeVariableResult:s,currentPageInRelatedCollection:c,resultCache:d,regExpCache:u,experimentService:Fo().default});(0,un().l)({environment:r,blockStore:o,properties:e,transaction:l})}}var mn=()=>o(333474),gn=()=>o(256203);function Sn(e){const{groupsPointer:t,collectionContextStore:o,blocks:n,formulasModule:r}=e,i=[];return t.forEach((e=>{var t,l;const a=null==o||null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[e.property],s=null==o||null===(l=o.collectionStore())||void 0===l?void 0:l.getSchema(),c=new Map,d=new Map,u=n.flatMap((t=>{const o=t.getModel();if(a&&s&&o)return(0,Zo().W)({property:e.property,schema:s,block:o,getRecordModel:t.getRecordModel,collectionRequestContext:{userId:void 0,userTimeZone:(0,Qo().P)(),depth:0,intl:xt().A.getIntl(),visitedProperties:new Set,resultCache:c,regExpCache:d,experimentService:Fo().default,collectionFeatureGates:(0,tn().i)()},exportedFilePaths:!1,formulasModule:r})})).filter((e=>!f().b0(e)));i.push(...u)})),f().Mp(i,f().n4)}function hn(e){var t,o,n,r;const{environment:i,collectionStore:l,targetStore:a,droppedDirection:s,droppedStores:c,transaction:d,duplicate:u,collectionContextStore:p,groupsPointer:m,subitemPath:g,formulasModule:S,duplicateActions:h}=e;if(!p.permissionScopesStore.state.canEditContent)return;if(c.some((e=>(0,on().pQ)(e.id))))return;if(c.some((e=>{const t=e.getDiscussionStores();for(const o of t)if(o.isSuggestionDiscussion())return!0})))return;if(e.collapsedGroup&&function(e){var t;const{environment:o,droppedStores:n,duplicate:r,collectionContextStore:i,groupsPointer:l,transaction:a,duplicateActions:s}=e,c=i.collectionStore(),d=i.collectionViewStore(),u=null===(t=n[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),p=u&&u.id===(null==c?void 0:c.id),m=i.hasSingleCollection()&&r,g=(0,sn().T)({environment:o,droppedStores:n,duplicate:m,transaction:a,collectionStore:c,duplicateActions:s});for(const S of g){const e=c??S.getAssociatedCollectionStore();e&&(0,an().j)({environment:o,store:S,collectionStore:e,collectionContextStore:i,groupsPointer:l,shouldCoerce:!0,transaction:a})}d&&(0,mn().z)({resultIds:g.map((e=>e.id)),collectionViewStore:d,collectionContextStore:i,transaction:a}),a.postSubmitCallbacks.push((async e=>{!e&&c&&(p||await Y().Bz({droppedStores:n,createdStores:g,collectionStore:c,environment:o,collectionContextStore:i,groupsPointer:l,shouldDuplicate:r}))}))}({environment:i,collectionContextStore:p,groupsPointer:m,droppedStores:c,duplicate:u,transaction:d,duplicateActions:h}),!a)return;const y=p.collectionViewStore();if(!y)return;const v=null===(t=c[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),x=v&&v.id===(null==l?void 0:l.id),b=null===(o=p.groupsStore.getGroupState(m))||void 0===o?void 0:o.groupUiParentStore;if(!b)return;const C=Sn({groupsPointer:m,collectionContextStore:p,blocks:c,formulasModule:S}),w=(null===(n=p.groupsStore.getGroupState(m))||void 0===n?void 0:n.resultsStore.state)||[],I=c.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(null!=l&&l.isSyncedCollection()&&(null===(r=c[0])||void 0===r?void 0:r.getParentId())===(null==l?void 0:l.id)),A=p.hasSingleCollection()&&(I||u);if(s===nn().bH.Onto){k().IU({environment:i});const e=a.getContentStore(),t=(0,sn().T)({environment:i,droppedStores:c,duplicate:A,transaction:d,collectionStore:l,duplicateActions:h});for(const o of t)rn().BC({parentStore:e,appendStore:o,transaction:d});return[]}let j=!1,R=[];if(!A&&l){const e=function(e){const{environment:t,droppedStores:o,collectionStore:n,transaction:r}=e;if(!o.length)return;const i=(0,gn().K)({environment:t,stores:o,spaceId:n.getSpaceId(),transaction:r});for(const l of i){if(l.getParentTable()===Jo().Vl||l.getAssociatedCollectionStore())return;if(!St().X$({childStore:l,parentStore:n,transaction:r}))return}return i}({environment:i,droppedStores:c,collectionStore:l,transaction:d});j=void 0!==e,R=e??[]}const T=(0,re().kY)([...(null==g?void 0:g.map((e=>e.value.store.pointer)))??[]]),M=p.subitemExpandedStore.state.get(T),_=g&&g.length>1||(null==M?void 0:M.isExpanded)&&s===nn().bH.Below,P=p.groupsStore.getAllGroupStates();c.forEach((e=>{const t=P.find((t=>t.resultsStore.state.includes(e)));t&&!_&&pn({environment:i,store:e,collectionContextStore:p,groupsPointer:t.groupsPointer,transaction:d})}));const B=(0,sn().T)({environment:i,droppedStores:c,duplicate:A,transaction:d,collectionStore:l,duplicateActions:h});j||(R=(0,gn().K)({environment:i,stores:B,spaceId:a.getSpaceId(),transaction:d})),d.postSubmitCallbacks.push((async e=>{!e&&l&&(x||await Y().Bz({droppedStores:c,createdStores:B,collectionStore:l,environment:i,collectionContextStore:p,groupsPointer:m,alreadyMovedToCollection:j,shouldDuplicate:A}))}));for(const f of R){const e=l??f.getAssociatedCollectionStore();e&&(0,an().j)({environment:i,store:f,collectionStore:e,collectionContextStore:p,groupsPointer:Boolean(_)?[]:m,shouldCoerce:!0,transaction:d,alreadyMovedToCollection:j})}l&&function(e){var t,o,n;const{environment:r,isInsertingAsSubitem:i,shouldDuplicate:l,collectionContextStore:a,collectionStore:s,droppedStores:c,wrappedStores:d,targetSubitemExpandedState:u,subitemPath:p,targetStore:m,transaction:g}=e,S=a.currentSubitemFormatStoreForCollectionStore.state,h=null==S?void 0:S.inverse,f=h&&a.normalizedSchemaStore.state[h],y=null==S?void 0:S.property,v=y&&a.normalizedSchemaStore.state[y],x=null===(t=a.collectionViewStore())||void 0===t?void 0:t.getType(),b=null===(o=a.collectionViewStore())||void 0===o?void 0:o.getFormat();if(null!==(n=a.collectionViewStore())&&void 0!==n&&null!==(n=n.getCollectionStore())&&void 0!==n&&n.isExternallyImportedAndSyncedCollection()&&(0,ie().pB)())return;const C=(null==b?void 0:b.subitem_display_mode)??"show",w=S&&x&&(0,re().qS)(x)&&f&&(0,Wo().nC)(f)&&"flattened"!==C&&"disabled"!==C,k=(0,re().oC)(c[0]);null!=k&&k.subitemFormat&&S&&v&&(0,Wo().nC)(v)&&Y().Ch({blocksToDuplicate:[...c],duplicatedBlocks:[...d],environment:r,shouldDuplicate:l,originSubitemFormat:k.subitemFormat,destinationSubitemFormat:S,transaction:g,subitemRelationSchema:v,relationPropertyCollectionId:s.id});const I=S?(0,re().Ku)(d,S):void 0,A=I?d.filter(((e,t)=>I.includes(t))):[];for(const j of A){if(w){const e=(0,re().eO)({store:j,subitemFormat:S,propertySchema:f});for(const t of e){const e=ae().Bv.createChildStore(j,t);Q().c3({environment:r,sourceStore:e,destStore:j,propertyWithInverse:S,transaction:g})}}if(i){const e=null!=u&&u.isExpanded?"into":"below";(0,cn().i)({environment:r,collectionContextStore:a,collectionStore:s,subitemPath:p&&(null==p?void 0:p.length)>0?p:[new(en().PH)((0,re().f5)(m),[])],store:m,before:"into"===e,insertBlockStore:j,insertDirection:e,transaction:g})}}}({environment:i,isInsertingAsSubitem:Boolean(_),shouldDuplicate:A,collectionContextStore:p,collectionStore:l,droppedStores:c,wrappedStores:R,targetSubitemExpandedState:M,subitemPath:g,targetStore:a,transaction:d});const V=w.filter((e=>!B.includes(e))),F=V.indexOf(a),L=s===nn().bH.Above||s===nn().bH.Left?F:F+1,O=[...V.slice(0,L),...R,...V.slice(L)];(0,mn().z)({resultIds:O.map((e=>e.id)),collectionViewStore:y,collectionContextStore:p,transaction:d});const E=Sn({groupsPointer:m,collectionContextStore:p,blocks:B,formulasModule:S}),D=f().n4(C.sort(),E.sort());Fo().default.checkGate({gateName:"intelligent_collections_sort_modal"})?x&&D&&(0,dn().f)({environment:i,collectionContextStore:p}):(0,dn().f)({environment:i,collectionContextStore:p});if(!p.collectionViewBlockStore())return;const K=_?a:b,H=R.map((e=>ae().Bv.createChildStore(K,{table:z().ev,id:e.id})));return k().td({environment:i,stores:H}),function(e,t){var o,n;(null===(o=e.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri)===st().Lu&&"sprint_board"===(null===(n=bt().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch)&&ln().tutorialAdvanceToStepAfter(t,"sprints-onboarding","sprint-task-tooltip")}(p,d),H}var fn=()=>o(185912),yn=()=>o(980001);function vn(e){const{environment:t,collectionStore:o,targetStore:n,droppedDirection:r,files:i,transaction:l,collectionContextStore:a,groupsPointer:s,formulasModule:c,duplicateActions:d}=e,u=a.collectionViewStore(),p=Ce().y0(t);if(!u)return;const m=o.inMemoryRecordCache,g=yn().$C({environment:t,files:i,inMemoryRecordCache:m,pageWidth:p,transaction:l,spaceId:o.pointer.spaceId}).map(((e,n)=>{const r=i[n],a=Do().Wv({environment:t,type:"page",inMemoryRecordCache:m,properties:{title:(0,Ct().x9d)(fn().v5(r.name))},transaction:l,spaceId:o.pointer.spaceId});return rn().BC({parentStore:a.getContentStore(),appendStore:e,transaction:l}),a}));hn({environment:t,collectionStore:o,targetStore:n,droppedDirection:r,collectionContextStore:a,groupsPointer:s,droppedStores:g,duplicate:!1,transaction:l,collapsedGroup:!1,formulasModule:c,duplicateActions:d})}var xn=()=>o(145046),bn=()=>o(585958);var Cn=()=>o(162901),wn=()=>o(317278);var kn=()=>o(964968),In=()=>o(426681),An=()=>o(197881),jn=()=>o(780965),Rn=()=>o(665865),Tn=()=>o(464798),Mn=()=>o(64841),_n=()=>o(137490),Pn=()=>o(684092);function Bn(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:i,canDrag:l,canDrop:s,getItemSelectableStyle:c,belowDropZoneMargin:p,analyticsName:m,disabled:g,direction:S,onSelectableEnter:h,disableScrollToRevealHorizontal:f,touchDragOnly:y,isLast:v,groupsPointer:x,toggleButton:b,subitemPath:w,disableSelectable:k,itemSelectableHaloStyle:I,passesFilter:j,onSelectableInsertRow:R,blockPropertyValueOverlayStore:T,dropzoneGap:_}=e,P=(0,a().v3)(),B=(0,fe().Zp)(),V=(0,d().K8)((()=>(0,kn().W)(P,t.id)),[t,P]),F=(0,d().K8)((()=>t.canEdit()),[t]),L=(0,d().K8)((()=>t.getAssociatedCollectionStore()),[t]),O=(0,d().K8)((()=>"collectionTypedView"===i.contextType),[i]),D=(0,d().K8)((()=>{const e=i.groupsStore.getGroupState(x);return null==e?void 0:e.resultsStore}),[i,x]),z=(0,d().K8)((()=>M().NM(t)),[t]),K=(0,d().K8)((()=>M().f5({environment:P,collectionContextStore:i})?60:void 0),[i,P]),H=(0,d().K8)((()=>{const e=Pn().A.state;return e.isActive&&e.store===t}),[t]),W=!g&&F&&!V,G=e.shouldShowHoverMenu&&W,N=S!==zn.Vertical&&s,$=S!==zn.Vertical&&s,U=S===zn.Vertical&&s,q=(0,d().K8)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),X=(0,u().IS)((e=>({haloStyle:{...M().wh(e,z),...("board"===q||"gallery"===q)&&{borderRadius:wa},...I}})),[q,I,z]),Y=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return L?(0,Tn().D)({environment:P,collectionStore:L,collectionContextStore:i,groupsPointer:x,insertStores:o,store:t,before:!1,transaction:n}):[]}),[L,i,P,x,t]),Q=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return L?(0,Tn().D)({environment:P,collectionStore:L,collectionContextStore:i,groupsPointer:x,insertStores:o,store:t,before:!0,transaction:n}):[]}),[L,i,P,x,t]),{value:Z}=(0,le().fJ)(ne().VI.duplicateActions),J=(0,n.useCallback)((async e=>{const{droppedDirection:o,duplicate:n}=e;if(!L)return[];const r=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:P,getData:()=>ke().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})});const l=o!==nn().bH.Onto?(0,Vo().f0)({stores:e.droppedStores,collectionContextStore:i}):e.droppedStores;if(0===l.length&&O)return void xn().f1((0,E.jsx)(pt().sA,{...Vo().K0.unsupportedGroupAction}));const a=await ve().T.formulas.load();A().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:P,canUndo:!0,perform:e=>{!hn({environment:P,collectionStore:O?void 0:L,targetStore:t,droppedDirection:o,collectionContextStore:i,groupsPointer:x,droppedStores:l,duplicate:n,transaction:e,subitemPath:w,collapsedGroup:!1,formulasModule:a,duplicateActions:Z})&&O&&xn().f1((0,E.jsx)(pt().sA,{...Vo().K0.unsupportedGroupAction}))}})}),[L,i,Z,P,x,O,t,w]),ee=(0,n.useCallback)((async e=>{const{files:o,droppedDirection:n}=e;if(!L)return[];const r=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:P,getData:()=>ke().tv({collectionContextStore:i,is_native_drop:!0,is_empty:!1})});const l=await ve().T.formulas.load();A().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:P,canUndo:!0,perform:e=>{vn({environment:P,collectionStore:L,targetStore:t,droppedDirection:n,collectionContextStore:i,groupsPointer:x,files:o,transaction:e,formulasModule:l,duplicateActions:Z})}})}),[L,i,Z,P,x,t]),te=(0,n.useCallback)((e=>o=>{let{transaction:n}=o;if(!L)return[];const r=(0,Mn().u)({environment:P,collectionContextStore:i,groupsPointer:x,store:t,before:"above"===e,collectionStore:L,transaction:n,subitemPath:w,subitemInsertDirection:"below"});if(An().v(P,{...ke().sl(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==r?void 0:r.id,creating_block_id:null==r?void 0:r.id}),r&&R&&R(t,r),r&&T){const e=()=>{Rn().ho({isNewBlock:!0,environment:P,blockPropertyValueOverlayStore:T,store:r,property:"title",format:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(r,e)}}),[L,T,i,P,x,R,t,w]),oe=e.handleOpenPeekPage,re=(0,n.useCallback)((()=>{const e=i.collectionViewStore();Ve().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),oe&&oe(),C().Ey({collectionContextStore:i,resultsStore:D});const t=null==e?void 0:e.getType();if(t){const e=i.normalizedFormatStore.state.collection_peek_mode,o=e||_n().C9[t];jn().bn(P,{is_peek:!0,from:t,peek_mode:o})}}),[i,P,oe,D]),ie=(0,d().K8)((()=>c?c(v):void 0),[c,v]);(0,n.useEffect)((()=>{i.onItemMount(t)}),[t,i]);const ae=n.createElement(r,{handleOpenPeekPage:re,collectionContextStore:i,...o,...V?{disabled:!0}:{},store:t,key:t.id,isLast:v,toggleButton:b,subitemPath:w,passesFilter:j});return k?ae:(0,E.jsx)(lt().A,{style:ie,store:t,canSelect:W,shouldShowHalo:!(H||null!=B&&B.isPreviewing),shouldForceRenderSelectionHalo:z,haloStyle:X.haloStyle,canDrag:l,canDropBelow:U,canDropLeft:N,canDropRight:$,canNativeDropBelow:U&&!O,canNativeDropLeft:N&&!O,canNativeDropRight:$&&!O,canDropOnto:s,canTriggerContextMenu:W,isLastItem:v,showBlockMenuInput:!0,shouldShowHoverMenu:G,shouldShowCommentMenu:!1,onSelectableDrop:J,onNativeDrop:ee,onInsertBelow:Y,onInsertAbove:Q,onRemove:e=>function(e,t,o,n,r){const{transaction:i}=e;r.length>0&&pn({store:o,transaction:i,groupsPointer:r,collectionContextStore:n,environment:t});St().by({childStore:o,transaction:i})}(e,P,t,i,x),canInsertAbove:s,canInsertBelow:s,onInsertRowBelow:te("below"),onInsertRowAbove:te("above"),belowDropZoneMargin:p,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:m,shouldShowDropZone:s,dropzoneGap:_,onEnter:h,className:we().E4t,disableScrollToRevealHorizontal:f,touchDragOnly:y,groupsPointer:x,verticalDropZoneExtraLeftEdgeOffset:K,children:ae})}const Vn=n.memo(Bn,No().A);var Fn=()=>o(579031);function Ln(e){const{store:t,collectionContextStore:r,subitemPath:i,titleColumnIndex:l,nestedCreateSubitemButton:s,getItemSelectableStyle:c}=e,p=(0,a().v3)(),{isMobile:m}=(0,a().Y0)(),g=(0,u().DP)(),{currentSubitemFormatStoreForUiDisplayStore:S,subitemExpandedStore:h,subitemTreeStore:y}=r,v=(0,d().K8)((()=>M().Dj({store:t,collectionContextStore:r})),[r,t]),x=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),{value:b}=(0,le().fJ)(ve().T.formulas),C=(0,d().K8)((()=>i&&i.length>0?i:(0,en().Qe)(y.state.children,(e=>e.value.store===t))),[i,y,t],{useDeepEqual:!0}),w=(0,n.useMemo)((()=>C?(0,re().kY)(C.map((e=>e.value.store))):""),[C]),I=(0,d().K8)((()=>h.state.get(w)),[h,w]),A=Boolean(null==I?void 0:I.isExpanded),j=(0,d().O$)(S),R=(0,d().K8)((()=>{if(!v||!j)return;const e=v.getSchema()[j.property];return void 0!==e&&(0,Wo().nC)(e)?e:void 0}),[v,j]),T=(0,d().K8)((()=>{var e;return R&&"relation"===R.type&&(0,Wo().zO)(R)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&R.property}),[r,R]),_=(0,d().K8)((()=>{const e=!T||x&&(0,re().qS)(x)?void 0:{property:T,filter:{operator:"is_empty"}};return!(!j||!v)&&(0,re().Ch)({store:t,collectionStore:v,subitemFormat:j,subitemPathKey:w,collectionContextStore:r,propertyFilters:[...e&&T?[{id:T,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:p.currentUser.id,resultCache:new Map,regExpCache:new Map,formulasModule:b}).length>0}),[r,x,p.currentUser.id,T,v,w,t,j,b]),P=(0,d().K8)((()=>!(!v||!j)&&(_||A||m||"timeline"===x)),[v,j,_,A,m,x]),B=(0,d().K8)((()=>!(!v||!j)&&In().A.getState().hoveredStore===t),[v,t,j]),V=(0,d().K8)((()=>{const e=(0,Bo().AU)({collectionContextStore:r,collectionStore:v,environment:p});if(e)return(0,o(15552).oR)(e)}),[r,v,p]),F=(0,n.useCallback)((()=>{const e=h.state;if(A){e.delete(w);const o=se().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&k().DN({stores:(0,f().R9)(se().default.state.stores,o)}),function(e,t){xe().vd(e,"subitem_toggle_block_close",t)}(p,{...(0,ke().sl)(r),depth:(null==C?void 0:C.length)||0}),h.emit()}else e.set(w,{isExpanded:!0,limit:20}),function(e,t){xe().vd(e,"subitem_toggle_block_open",t)}(p,{...(0,ke().sl)(r),depth:(null==C?void 0:C.length)||0}),V&&e&&R&&j?(0,re().eI)({blockStore:t,subitemExpandedStore:h,subitemFormat:j,propertySchema:R,compiledFilter:V,pathKey:w,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}).then((()=>{h.emit()})):h.emit()}),[h,A,w,p,r,null==C?void 0:C.length,t,V,R,j]),L=(0,d().K8)((()=>{const o=y.state;return o&&C&&o.children.length>0?(0,re().ag)(o).value.store===t:e.isLast}),[y,e.isLast,t,C]),O=(0,o(569065).C)(),D=(0,d().K8)((()=>{var e;const o=t.getModel();if(!V||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return V({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+O,resultCache:new Map,regExpCache:new Map,experimentService:Fo().default,formulasModule:b})}),[t,V,O,b]),z=(0,d().K8)((()=>(0,kn().W)(p,t.id)),[p,t]),K=(0,d().K8)((()=>c&&!D||z?()=>({...c?c(L):{},...D?{}:{opacity:.5},...z?{opacity:.5}:{}}):c),[c,D,L,z]);(0,Cn().Yb)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!P||!e||!V||!R||!o||!j||D)return;(0,re().eO)({store:t,subitemFormat:j,propertySchema:R}).length>0||(await(0,re().eI)({blockStore:t,subitemExpandedStore:h,subitemFormat:j,propertySchema:R,compiledFilter:V,pathKey:w,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}),h.emit())}),[P,V,D,w,t,h,j,R]);const H=(0,E.jsx)(Vn,{...e,passesFilter:D,isLast:L,getItemSelectableStyle:K,subitemPath:C,toggleButton:P||B?(0,E.jsx)(Fn().A,{isSidebar:!1,open:A,fill:!0,onClick:F,color:_||A?g.regularIconColor:g.mediumIconColor,disabled:C&&C.length>=re().x2}):void 0});if(!A||!C||0===C.length||C.length>=re().x2)return H;const W=C[C.length-1].children;return(0,E.jsxs)(E.Fragment,{children:[H,W.map((t=>{const o=t.value.store;return(0,n.createElement)(En,{...e,key:o.id,store:o,subitemPath:[...C,t]})})),v&&s&&s({store:t,parentStore:v,subitemPath:C,indentLevel:C.length,titleColumnIndex:l}),I&&W.length>0&&W.length===I.limit&&(0,E.jsx)(On,{collectionContextStore:e.collectionContextStore,pathKey:w,titleColumnIndex:l,limit:I.limit,indentLevel:C.length})]})}const On=n.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:l}=e,a=(0,n.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),s=(0,d().K8)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),c=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,j().si)({columnIndex:0,titleColumnIndex:r,indentLevel:l,isSubitemToggleOnTitleColumn:s}),fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},buttonHovered:{background:e.tableRowHoveredBackground},icon:{width:Ao().Ev.sm,height:Ao().Ev.sm,marginRight:6,fill:e.icon.tertiary},label:{color:e.text.tertiary}})),[r,l,s]);return(0,E.jsxs)(It().A,{onClick:a,onMouseDown:Te().tr,style:c.button,hoveredStyle:c.buttonHovered,children:[(0,wn().g)(c.icon),(0,E.jsx)("span",{style:c.label,children:(0,E.jsx)(pt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})})]})})),En=n.memo(Ln),Dn=n.createContext(null);Dn.displayName="CollectionGroupContainerContext";let zn=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function Kn(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,disableRequest:l,onSelectableEnter:s,canDrop:c,canDrag:u,groupsPointer:p,loadContentCover:m,emptyDroppableSize:g,emptyDroppableStyle:S,virtualizeResults:h}=e,y=(0,a().v3)(),v=(0,L().X)("drag_respects_relation_limits"),x=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),b=(0,n.useMemo)((()=>{if(x)return new(ae().Bv)(y,x.pointer)}),[x,y]),{groupState:C,reducer:w}=(0,d().K8)((()=>{const e=t.groupsStore.getGroupState(p);if(!e)return{groupState:void 0,reducer:void 0};const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=f().oE(p.map((e=>(0,Yo().K8)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,Qo().P)()}))));return{groupState:e,reducer:{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:m}}}),[t,p,m]),k=(0,d().K8)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(p);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,p]),I=(0,d().K8)((()=>"collectionTypedView"===t.contextType?void 0:t.collectionStore()),[t]),A=(0,d().K8)((()=>{if(!v)return!1;const e=t.normalizedSchemaStore.state;return p.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,p,v]),j=i===zn.Vertical;var R;k.length>0&&(null===(R=t.databaseItemsVisibleTracker)||void 0===R||R.handleItemsRenderStart());(0,n.useEffect)((()=>t.renderEmitter.emit()));const T=g||void 0;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:{...j?{height:T}:{width:T},...S},children:(0,E.jsx)(Wn,{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,canDrop:c,groupsPointer:p,instanceCollectionViewBlockStore:b,resultStores:k,droppedIntoCollectionStore:I,onSelectableEnter:s})}),h?(0,E.jsx)(Nn,{collectionContextStore:t,groupsPointer:p,resultComponentProps:e,canDrag:u&&!A,groupState:C,resultStores:k}):k.map(((t,o,n)=>(0,E.jsx)(Un,{store:t,isLast:o===n.length-1,...e,canDrag:u&&!A},t.id))),(0,E.jsx)(qn,{collectionContextStore:t,groupsPointer:p,disableRequest:l,resultsReducer:w})]})}const Hn=n.memo(Kn);function Wn(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,onSelectableEnter:l,canDrop:s,groupsPointer:c,instanceCollectionViewBlockStore:u,resultStores:p,droppedIntoCollectionStore:m}=e,g=(0,a().v3)(),S=(0,d().K8)((()=>"collectionTypedView"===t.contextType),[t]),h=(0,d().O$)(t.isInHomeWidgetStore),f=(0,d().K8)((()=>M().f5({environment:g,collectionContextStore:t})?60:void 0),[t,g]),{value:y}=(0,le().fJ)(ne().VI.duplicateActions),v=(0,n.useCallback)((async e=>{const o=await ve().T.formulas.load();return function(e,t,o,n,r,i,l){const{droppedDirection:a,duplicate:s}=e,c=o.collectionViewBlockStore();if(!c)return;const d=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const u="collectionTypedView"===o.contextType,p=(0,Vo().f0)({stores:e.droppedStores,collectionContextStore:o});if(0===p.length&&u)return void xn().f1(xt().A.formatMessage(Vo().K0.unsupportedGroupAction));A().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!hn({environment:t,collectionStore:l,targetStore:c,droppedDirection:a,collectionContextStore:o,groupsPointer:n,droppedStores:p,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})&&u&&xn().f1(xt().A.formatMessage(Vo().K0.unsupportedGroupAction))}})}(e,g,t,c,o,y,m)}),[t,m,y,g,c]),x=(0,n.useCallback)((async t=>{const o=await ve().T.formulas.load();return function(e,t,o,n,r,i,l){const{files:a,droppedDirection:s}=e;if(!l)return;const c=o.collectionViewBlockStore();if(!c)return;const d=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),A().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{vn({environment:t,collectionStore:l,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n,files:a,transaction:e,formulasModule:r,duplicateActions:i})}})}(t,g,e.collectionContextStore,e.groupsPointer,o,y,m)}),[m,y,g,e.collectionContextStore,e.groupsPointer]);if(!u)return null;const b=i!==zn.Vertical&&(!o&&0===p.length),C=i===zn.Vertical&&!o;return(0,E.jsx)(lt().A,{store:u,canSelect:!1,canEditText:!1,shouldShowHalo:!h,canDrag:!1,canDropLeft:s&&b,canNativeDropLeft:s&&b&&!S,canDropBelow:s&&C,canNativeDropBelow:s&&C&&!S,canTriggerContextMenu:!1,isLastItem:0===p.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:v,onNativeDrop:x,analyticsName:r,shouldShowDropZone:s,onEnter:l,groupsPointer:c,verticalDropZoneExtraLeftEdgeOffset:f,style:i===zn.Vertical?void 0:{width:"100%",height:"100%"}})}function Gn(e){let{collectionContextStore:t,groupsPointer:o,resultComponentProps:r,canDrag:i,groupState:l,resultStores:s}=e;const c=0!==o.length,u=c,[p,m]=(0,n.useState)(!u),[g,S]=(0,n.useState)(0),h=(0,n.useContext)(ye().R),f=(0,n.useRef)(null),y=(0,n.useRef)(null),v=s.length<=0,x=(0,n.useContext)(Dn);(0,n.useEffect)((()=>{if(!c)return;const e=new ResizeObserver((()=>{var e;null===(e=y.current)||void 0===e||e.call(y)}));if(null!=x&&x.current)return e.observe(x.current),()=>e.disconnect();console.error("Missing block to observer resizes on, this will result in a broken virtualizer")}),[x,c]);const b=(0,d().K8)((()=>{var e;return null==h||null===(e=h.verticalScroller)||void 0===e?void 0:e.getStore().state.element}),[null==h?void 0:h.verticalScroller]);(0,n.useEffect)((()=>{if(f.current&&u&&!p&&!v){if(null==b||!b.deref())return;const e=new IntersectionObserver((e=>{e[0].isIntersecting&&m(!0)}),{root:b.deref(),rootMargin:"300px 0px 300px 0px"});return e.observe(f.current),()=>e.disconnect()}}),[p,v,b,u]);const C=(0,n.useCallback)((e=>{if(f.current=e,null==b||!b.deref())return;const t=()=>{let t=e,o=0;for(;t&&t!==document.body&&t!==b.deref();)o+=t.offsetTop,t=t.offsetParent;S(o)};t(),y.current=t}),[b]),w=(0,n.useCallback)((e=>s[e].id),[s]),k=(0,Xo().Te)({count:s.length,estimateSize:()=>34,scrollMargin:g,getScrollElement:()=>(null==b?void 0:b.deref())??null,getItemKey:w,overscan:p?10:1});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:i}=e;const l=(0,n.useRef)({fetching:!1,previousTotal:0}),s=(0,a().v3)(),c=t.getVirtualItems(),u=o.length+1,p=(0,d().K8)((()=>{var e;return(null==i||null===(e=i.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==i?void 0:i.reducerResultStore]);(0,n.useEffect)((()=>{if(null!=i&&i.groupsPointer.length)return;const{fetching:e,previousTotal:t}=l.current;e&&t!==u&&(l.current={fetching:!1,previousTotal:0})}),[null==i?void 0:i.groupsPointer.length,u]),(0,n.useEffect)((()=>{if(!p||null==i||!i.groupsPointer||i.groupsPointer.length>0||l.current.fetching)return;const[e]=c.slice(-1);!e||u<=0||e.index-t.options.overscan>.67*u&&(l.current={fetching:!0,previousTotal:u},r.infiniteScrollLongTaskObserver.observe(),(0,Uo().H)({collectionContextStore:r,environment:s,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==i?void 0:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,s,null==i?void 0:i.groupsPointer,p,o.length,u,c,t.options.overscan])}({virtualizer:k,resultsStores:s,collectionContextStore:t,groupState:l}),(0,n.useEffect)((()=>{t.virtualizedModule.setRowVirtualizer({virtualizer:k,groupsPointer:o})}),[t,k,o]),v?null:(0,E.jsx)("div",{ref:C,style:{height:k.getTotalSize(),width:"100%",position:"relative"},children:k.getVirtualItems().map((e=>{const t=s[e.index],o=s.length-1===e.index;return(0,E.jsx)("div",{"data-index":e.index,ref:k.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-k.options.scrollMargin}px)`},children:(0,E.jsx)(Un,{store:t,isLast:o,...r,canDrag:i},t.id)},e.key.toString())}))})}const Nn=n.memo(Gn,No().A);function $n(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:l,groupsPointer:a,shouldShowHoverMenu:s,canDrag:c,disabled:u,format:p,getItemSelectableStyle:m,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:h,direction:f,onSelectableEnter:y,canDrop:v,disableScrollToRevealHorizontal:x,touchDragOnly:b,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:I,nestedCreateSubitemButton:A,itemSelectableHaloStyle:j}=e,R=(0,d().K8)((()=>M().Dj({store:e.store,collectionContextStore:o})),[o,e.store]),T=(0,n.useMemo)((()=>[]),[]);return R?(0,E.jsx)(En,{getItemSelectableStyle:m,itemSelectableHaloStyle:j,store:e.store,canDrag:c,resultProps:i,resultComponent:l,collectionContextStore:o,groupsPointer:a,shouldShowHoverMenu:s,canDrop:v&&!u,format:p,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:h,disabled:u,direction:f,dropzoneGap:r,onSelectableEnter:y,disableScrollToRevealHorizontal:x,touchDragOnly:b,isLast:t,subitemPath:T,titleColumnIndex:I,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:A}):null}const Un=n.memo($n,No().A);function qn(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:n,resultsReducer:r}=e;const i=(0,L().X)("collection_group_reducer_visible"),l=(0,d().K8)((()=>t.groupsStore.getGroupState(o)),[t,o]),a=(0,d().K8)((()=>Fo().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),s=i&&o.length>0;return n||!r||!l||s?null:(0,E.jsx)(bn().A,{id:o.length>0?`results:${(0,Mo().Hm)(o)}`:"collection_group_results",reducer:r,groupsPointer:o,collectionContextStore:t,resultStore:l.reducerResultStore,debounceWait:a})}var Xn=()=>o(168980),Yn=()=>o(48092),Qn=()=>o(102659),Zn=()=>o(261200),Jn=()=>o(86416);function er(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:a,from:s,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,Jn().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=(0,Qn().Q)({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:s},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(n.device.isMobile)zo().uK({environment:n,store:m,pageVisitSource:To().y8.Create});else if(p){const e=m.getBlockTitleStore();k().hc({environment:n,store:m}),I().setSelectionAtEnd({store:e}),(0,Zn().C)({store:m,transient:c})}else{const e="collectionTypedView"===r.contextType;Ko().VU({environment:n,store:m,peekMode:(0,M().hH)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:To().y8.Create})}An().v(n,{from:s,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,ke().sl)(r)})}var tr=()=>o(263873),or=()=>o(220413),nr=()=>o(604657);function rr(e){const{collectionContextStore:t}=e,o=(0,pt().tz)(),n=(0,d().K8)((()=>{var e;return t.databaseType?(0,nr().Mw)(o,t.databaseType):(0,nr()._o)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,E.jsx)(E.Fragment,{children:n})}var ir=()=>o(387013);const lr={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:Ro().Wy.medium,width:"auto"},ar={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:Ro().Wy.medium,width:"auto"};function sr(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,yt().Wp)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==Wo().rn||(0,ir().T)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Qo().P)(),intl:xt().A.getIntl(),experimentService:Fo().default,collectionFeatureGates:(0,tn().i)(),formulasModule:r})))}function cr(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,yt().qI)(o,t)}return!1}var dr=()=>o(209684),ur=()=>o(966789);const pr=n.memo((function(e){const{collectionContextStore:t,color:o,groupsPointer:r,isFullScreen:i,shouldShowSpinner:l}=e,s=(0,a().v3)(),{isMobile:c}=(0,a().Y0)(),d=(0,u().IS)((e=>{const t=o||e.text.tertiary,n=c?ar.fontSize:lr.fontSize;return{addItemButton:{width:"100%",color:t,borderRadius:wa,boxShadow:"dark"===e.mode?`${or().Ay.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:"12px 16px 12px 16px",minHeight:(0,M().rU)({isMobile:c}),fontSize:n},plusIcon:{width:n,height:n,fill:t},spinner:{margin:"0 0 0 auto"}}}),[o,c]),p=(0,n.useCallback)((()=>{(0,Xe().EF)(s)?A().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:s,canUndo:!0,perform:e=>{er({transaction:e,environment:s,collectionContextStore:t,isFullScreen:i,groupsPointer:r,from:"board_group_add_item_bottom",transient:!1})}}):(0,Xe().QY)(s)}),[t,s,r,i]);return(0,E.jsxs)(dr().p,{icon:tr().plusSmallIcon,iconStyle:d.plusIcon,isLightGray:!0,size:"lg",style:d.addItemButton,onClick:p,onMouseDown:Te().tr,children:[(0,E.jsx)(rr,{collectionContextStore:t}),l?(0,E.jsx)("div",{style:d.spinner,children:(0,E.jsx)(ur().A,{size:"sm"})}):null]})}));var mr=()=>o(740520),gr=()=>o(237894);function Sr(e){let{color:t,collectionContextStore:o,groupFormat:n,isHovered:r}=e;const{isMobile:i}=(0,a().Y0)(),l=(0,u().IS)((e=>{const o=t||e.text.tertiary,n=i?ar.fontSize:lr.fontSize;return{linkButton:{visibility:r?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:wa,padding:"12px 16px 12px 16px",fontSize:n},icon:{width:n,height:n,fill:o}}}),[t,i,r]);return(0,E.jsx)(gr().O,{collectionContextStore:o,groupFormat:n,renderLinkButton:e=>(0,E.jsx)(dr().p,{icon:mr().arrowDiagonalUpRightIcon,iconStyle:l.icon,isLightGray:!0,size:"lg",style:l.linkButton,...e,children:(0,E.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})})}var hr=()=>o(660714),fr=()=>o(973055),yr=()=>o(865226),vr=()=>o(675921),xr=()=>o(947520),br=()=>o(424048),Cr=()=>o(519463),wr=()=>o(931085),kr=()=>o(29869),Ir=()=>o(621641),Ar=()=>o(496519),jr=()=>o(396806),Rr=()=>o(514858),Tr=()=>o(361837);function Mr(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,yt().yT)(t);k().hc({environment:e,store:t}),I().setSelectionAtEnd({store:l}),(0,Zn().C)({store:t}),r&&(0,Rr().u)(e,"board_item_edit_mode_enter",{...(0,ke().sl)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function _r(e,t,o,n,r,i,a,s){const c=r.normalizedSchemaStore.state,d=n.state;if(!d.isOpen)return;const u=sr(t,o,r,a,s).map((e=>e.property)),p=u.findIndex((e=>e===d.property));let m;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,Tr().B2)(c[e])))||u.find(((e,t)=>!a&&(0,Tr().B2)(c[e])));m=e}else{const e=f().Uk(u,((e,t)=>t<p&&(0,Tr().B2)(c[e])))||f().Uk(u,((e,t)=>!a&&(0,Tr().B2)(c[e])));m=e}m?l().default.afterNextFlush((()=>{Rn().ho({environment:t,blockPropertyValueOverlayStore:n,store:o,property:m,format:"page",collectionContextStore:r})})):a&&l().default.afterNextFlush((()=>{Mr(t,o,r,i)})),Rn().VN({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function Pr(e,t,o,n,r,i,l,a){const s=n.normalizedSchemaStore.state,c=sr(t,o,n,l,a).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=f().Uk(c,((e,t)=>{const o=s[e];return(0,Tr().B2)(o)}))}d&&Rn().ho({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,format:"page",collectionContextStore:n}),i.preventEmptyDelete()}class Br extends p().default{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),Pn().A.state.isActive&&Pn().A.setState({...Pn().A.state,transient:!1}))}}const Vr=Br;var Fr=()=>o(533666),Lr=()=>o(397791),Or=()=>o(410090);function Er(e){const t=(0,a().v3)(),n=(0,a().Y0)(),{value:r}=(0,le().fJ)(ve().T.formulas),i=(0,d().K8)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),l=(0,d().K8)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),s=(0,d().K8)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),c=(0,d().K8)((()=>Pn().A.state.isActive&&Pn().A.state.store===e.store),[e.store]),u=(0,d().K8)((()=>s.canEditContent&&e.store.canEdit()),[s.canEditContent,e.store]),p=(0,d().K8)((()=>O().default.state.open&&O().default.state.targetStore.id===e.store.id),[e.store.id]),m=(0,d().K8)((()=>{const t=(0,M().hH)(e.collectionContextStore);return(0,Tr().lA)(t,!1)}),[e.collectionContextStore]),g=(0,d().K8)((()=>(0,M().wy)({environment:t,store:e.store,mainEditorCurrentBlockStore:bt().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[t,e.store,e.collectionContextStore]),S=(0,d().K8)((()=>cr(e.collectionContextStore)),[e.collectionContextStore]),h=(0,d().K8)((()=>{const o=l?(0,yt().Wp)({viewType:l,format:i,visible:!0}):[],n=sr(t,e.store,e.collectionContextStore,c,r);return o.length>0&&o.length!==n.length}),[t,i,c,e.collectionContextStore,e.store,l,r]),f=(0,d().K8)((()=>{var t;const o=ce().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,Ir().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,yt().yT)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),y=(0,d().K8)((()=>!(s.isLocked||!s.canEditContent||s.isSyncedCollection||s.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[s.canEditContent,s.isExternallyImportedAndSyncedCollection,s.isLocked,s.isSyncedCollection,e.collectionContextStore,e.store]),v=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,x=y&&!c&&!f&&(S||h),b=c&&!p&&!e.disablePeekButton,C=!e.controlArgs.isRepositioning&&!e.disableMoreButton;return n.isMobile?null:(0,E.jsxs)(o(470414).A,{isVisible:e.controlArgs.isVisible,position:"top",children:[v&&!e.controlArgs.isRepositioning&&(0,E.jsx)(It().A,{style:Or().k,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,E.jsx)(pt().sA,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),v&&e.controlArgs.isRepositioning&&(0,E.jsx)(It().A,{style:Or().k,onClick:e.controlArgs.handleSavePositionClick,children:(0,E.jsx)(pt().sA,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),v&&e.controlArgs.isRepositioning&&(0,E.jsx)(It().A,{style:Or().k,onClick:e.controlArgs.handleCancelClick,children:(0,E.jsx)(pt().sA,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),x&&(0,E.jsx)(jt().A,{renderTooltip:()=>(0,E.jsx)(pt().sA,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:n=>(0,E.jsx)(It().A,{style:Or().k,onClick:()=>{Mr(t,e.store,e.collectionContextStore,e.editModeStore,"click")},...n,children:(0,E.jsx)(Lr().I,{icon:o(89414).pencilLineSmallIcon,size:"sm"})})}),b&&(0,E.jsx)(jt().A,{renderTooltip:()=>m.tooltip,render:o=>(0,E.jsx)(It().A,{style:Or().k,onClick:()=>{g&&(yr().oo({environment:t,url:g}),e.editModeStore.preventEmptyDelete())},...o,children:(0,E.jsx)(Lr().I,{icon:m.icon,size:"sm"})})}),C&&(0,E.jsx)(jt().A,{renderTooltip:()=>(0,E.jsx)(pt().sA,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:n=>(0,E.jsx)(It().A,{style:Or().k,onClick:n=>{k().Lt({environment:t,store:e.store}),o(883674).it({environment:t,stores:se().default.state.stores,left:n.clientX,top:n.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...n,children:(0,E.jsx)(Lr().I,{icon:Fr().Y,size:"sm"})})})]})}const Dr=n.memo(Er);var zr=()=>o(933396);function Kr(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,collectionContextStore:i,disabled:l,editModeStore:s,isCardSelected:c}=e;const u=(0,a().v3)(),{value:p}=(0,le().fJ)(ve().T.formulas),{collectionStore:m,canEdit:g}=(0,d().K8)((()=>({collectionStore:o.getAssociatedCollectionStore(),canEdit:o.canEdit()})),[o]),{viewType:S,collectionViewStore:h,isTableWrapped:f}=(0,d().K8)((()=>({viewType:i.getViewType(),collectionViewStore:i.collectionViewStore(),isTableWrapped:Boolean(i.normalizedFormatStore.state.table_wrap)})),[i]),y=(0,d().K8)((()=>i.permissionScopesStore.state.isLocked||!i.permissionScopesStore.state.canEditContent),[i.permissionScopesStore]),v=(0,n.useCallback)((()=>_r("tab",u,o,r,i,s,c,p)),[u,o,r,i,s,c,p]),x=(0,n.useCallback)((()=>_r("untab",u,o,r,i,s,c,p)),[u,o,r,i,s,c,p]),b=(0,n.useCallback)((()=>function(e,t,o,n){Rn().VN({environment:e,blockPropertyValueOverlayStore:t}),k().Lt({environment:e,store:o}),n.preventEmptyDelete()}(u,r,o,s)),[u,r,o,s]);if(!m)return null;const C="gallery"===S?"gallery":"board";return(0,E.jsx)(zr().BlockPropertyRouter,{store:o,property:t.property,disabled:l||!g,locked:y,format:C,tableWrap:f||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:m,showIfEmpty:c,onEnter:b,onEsc:b,onBgClick:b,onTab:v,onUntab:x,collectionViewStore:h},t.property)}const Hr=n.memo(Kr);var Wr=()=>o(723361),Gr=()=>o(28210),Nr=()=>o(308265);const $r=(0,pt().YK)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});function Ur(e){const{store:t,collectionContextStore:r,editModeStore:i,onTextEsc:l,onTextEnter:s,blockPropertyValueOverlayStore:c,isCardSelected:p}=e,m=(0,a().v3)(),g=(0,a().Y0)().isMobile,S=(0,pt().tz)(),h=(0,Nr().BG)(),{value:f}=(0,le().fJ)(ve().T.formulas),{collectionViewBlockId:y,collectionViewId:v,viewType:x}=(0,d().K8)((()=>{var t,o;return{collectionViewId:null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.id,collectionViewBlockId:null===(o=e.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.id,viewType:e.collectionContextStore.getViewType()}}),[e.collectionContextStore]),b=(0,d().K8)((()=>sr(m,t,r,p,f)),[m,t,r,p,f]),C=(0,d().K8)((()=>(0,re().Kk)({collectionContextStore:r,blockStore:t})),[t,r]),{titleStore:w,icon:j,isEmptyPage:R,hasError:T}=(0,d().K8)((()=>({titleStore:(0,yt().yT)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),M=(0,d().K8)((()=>(Boolean(t.getIcon())||!t.isEmptyPage())&&r.shouldShowPageIcon()),[t,r]),_=(0,d().K8)((()=>{var e;return p?S.formatMessage($r.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Qo().P)(),intl:S,isWorkflowsAppContainerEnabled:h}))||S.formatMessage($r.untitledBlock)}),[p,S,t,h]),P=(0,d().K8)((()=>t.canEdit()&&r.permissionScopesStore.state.canEditContent),[t,r]),B=(0,n.useCallback)((()=>{Pr("tab",m,t,r,c,i,p,f)}),[m,t,r,i,c,p,f]),V=(0,n.useCallback)((()=>{Pr("untab",m,t,r,c,i,p,f)}),[m,t,r,i,c,p,f]),F=(0,n.useCallback)((()=>{(0,Ar().x)(),I().clear({environment:m});t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):"new"===i.state?s(t):k().Lt({environment:m,store:t}),i.preventEmptyDelete())}),[m,t,r.permissionScopesStore,i,l,s]),L=(0,n.useCallback)((()=>{(0,Ar().x)();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):k().Lt({environment:m,store:t}),i.preventEmptyDelete())}),[t,r.permissionScopesStore,i,l,m]),O=(0,n.useCallback)((()=>{!function(e,t,o,n){const r=t.getViewType();"board"!==r&&"gallery"!==r||((0,jr().E)({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:r}),n.preventEmptyDelete())}(m,r,t,i)}),[m,t,r,i]),D=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&A().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:m,canUndo:!0,perform:t=>{Do().KY({store:o,value:e,transaction:t})}})}),[m,t]),z=(0,u().IS)((e=>{const t=b.length>0;return{titleWrap:{position:"relative",width:"gallery"===x?"100%":"auto",display:"flex",paddingLeft:10,paddingRight:10,paddingBottom:t?6:g?12:8,paddingTop:C?4:g?12:8},recordIcon:{float:"left",borderRadius:5,width:24,height:24,marginLeft:-2,...g?{marginTop:0,marginRight:4}:{marginTop:2,marginRight:4}},warningIcon:{fill:e.accentColors.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...g?{width:20,marginLeft:2,marginRight:4}:{width:16,marginLeft:4,marginRight:6}},text:{pointerEvents:p?void 0:"none",cursor:p?"text":void 0,flexGrow:1,padding:"2px 1px",whiteSpace:"pre-wrap",...g?ar:lr}}}),[p,g,C,b.length,x]),K=(0,n.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:v,collectionViewBlockId:y})),[y,v]),H=(M||p)&&!T;return(0,E.jsxs)("div",{style:z.titleWrap,children:[H&&(0,E.jsx)(Gr().B,{disabled:!1,bucket:"secure",style:z.recordIcon,progressContainerStyle:z.recordIcon,icon:j,store:t,size:g?24:P?20:18,isEmptyPage:R,onChange:D}),T&&(0,Wr().Q)(z.warningIcon),(0,E.jsx)(o(636045).A,{store:w,disabled:!p,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:F,onEsc:L,onTab:B,onUntab:V,onChange:O,placeholder:_,style:z.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:K})]})}const qr=n.memo(Ur);function Xr(e,t){const{store:o,onTextEsc:r,onTextEnter:i,onShiftEnter:l,handleOpenPeekPage:c,collectionContextStore:u,blockPropertyValueOverlayStore:p}=e,m=(0,a().v3)(),g=(0,n.useRef)(null),{value:S}=(0,le().fJ)(ve().T.formulas),h=(0,d().uB)(void 0,ft().A),f=(0,d().uB)(void 0,Vr),y=(0,d().r6)((()=>{const t=Pn().A.state;return t.isActive&&t.store===e.store}),[e.store]),v=(0,d().O$)(y),x=(0,d().K8)((()=>se().default.state.stores.includes(o)),[o]),b=(0,d().K8)((()=>{var e,t,n;return!(o.getSpaceId()!==(null===(e=bt().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=u.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===st().Lu&&o.getFormat().app_config_uri===st().e4&&"sprint_board"===(null===(n=bt().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch))}),[o,u]),C=(0,d().K8)((()=>{const e=bt().default.state.mainEditorCurrentBlockStore;return(0,M().wy)({environment:m,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:u,fullyQualified:!1})}),[m,u,o]),w=(0,n.useCallback)((()=>{Mr(m,o,u,f,"space")}),[m,o,u,f]),k=(0,n.useCallback)((()=>{(0,Ar().x)(),f.preventEmptyDelete()}),[f]),I=(0,n.useCallback)((()=>{i(o)}),[i,o]),j=(0,n.useCallback)((()=>{_r("tab",m,o,p,u,f,v,S)}),[m,o,p,u,f,v,S]),R=(0,n.useCallback)((()=>{_r("untab",m,o,p,u,f,v,S)}),[m,o,p,u,f,v,S]),T=(0,n.useCallback)((()=>{A().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:m,canUndo:!0,perform:e=>{l({blocks:se().default.state.stores,transaction:e})}})}),[m,l]),_=(0,n.useCallback)((()=>{"new_empty"!==f.state||v||u.defaultPageTemplateStore.state||(r(o),y.removeListener(_))}),[u.defaultPageTemplateStore,f,v,y,r,o]);return(0,s().l)((()=>{var t;const o=ce().default.state,n=Pn().A.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,Ir().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,yt().yT)(e.store);i&&r?f.setState("new_empty"):i?f.setState("new"):f.setState("existing")})),(0,n.useEffect)((()=>(y.state&&"new_empty"===f.state&&y.addListener(_),()=>{y.removeListener(_)})),[f,y,_]),(0,Be().NW)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>g.current,activate:()=>{C&&(c(),yr().oo({environment:m,url:C}))}})),[m,c,C,o]),(0,E.jsx)(J().A,{debugName:"CollectionViewCardItem",capture:v,onEsc:k,onEnter:I,onSpace:w,onTab:j,onUntab:R,children:(0,E.jsxs)(J().A,{debugName:"CollectionViewCardItem",capture:x,onShiftEnter:T,children:[(0,E.jsx)(Qr,{...e,ref:g,mouseStore:h,editModeStore:f,isCardSelected:v,peekUrl:C}),b&&(0,E.jsx)(xr().Ni,{origin:g})]})}))}const Yr=n.memo(n.forwardRef(Xr)),Qr=n.memo(n.forwardRef((function(e,t){const{store:r,disabled:i,peekUrl:l,editModeStore:s,handleOpenPeekPage:c,collectionContextStore:p,blockPropertyValueOverlayStore:m,mouseStore:g,isCardSelected:S,coverFormat:h,coverAspectFormat:f,colorStyle:y,coverSizeFormat:v,coverWidth:x,coverHeight:b}=e,C=(0,a().v3)(),w=(0,a().Y0)().isMobile,k=(0,fe().Zp)(),{value:I}=(0,le().fJ)(ve().T.formulas),[j,R]=(0,n.useState)(void 0),T=(0,d().K8)((()=>(0,kn().W)(C,r.id)),[C,r]),M=(0,d().K8)((()=>g.state.mouseEntered),[g]),{viewType:_,isInHomeWidget:P}=(0,d().K8)((()=>({viewType:p.getViewType(),isInHomeWidget:p.isInHomeWidgetStore.state})),[p]),B=(0,d().K8)((()=>(0,kr().Ay)({store:r,fullyQualified:!1,pageVisitSource:To().y8.LinkInPage})),[r]),V=(0,d().K8)((()=>cr(p)),[p]),F=(0,d().K8)((()=>sr(C,r,p,S,I)),[C,r,p,S,I]),L=(0,d().K8)((()=>(0,re().xC)({collectionContextStore:p,blockStore:r})),[p,r]),O=(0,d().K8)((()=>(0,re().Kk)({collectionContextStore:p,blockStore:r})),[p,r]),D=(0,d().K8)((()=>(0,o(360482).oC)(r,{recursivelyLoadAllDiscussions:!1})>0),[r]),z=(0,n.useCallback)((e=>{R(e)}),[R]),K=(0,n.useCallback)((e=>{c(),s.preventEmptyDelete()}),[s,c]),H=(0,n.useCallback)((()=>{He().A.state||g.setState({...g.state,mouseEntered:!0})}),[g]),W=(0,fr().d)(H,100),G=(0,n.useCallback)((()=>{g.setState({...g.state,mouseEntered:!1})}),[g]),N=(0,hr().Y)(G,100),$=(0,n.useCallback)((e=>{A().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:C,canUndo:!0,perform:t=>{Eo().G8({store:r,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[C,r]),U=(0,n.useCallback)((e=>T||null!=k&&k.disableAllPointerEvents?null:(0,E.jsx)(Dr,{store:r,collectionContextStore:p,blockPropertyValueOverlayStore:m,coverFormat:h,coverAspectFormat:f,lastProxiedUrl:j,editModeStore:s,controlArgs:e,disablePeekButton:null==k?void 0:k.disablePageLinks,disableMoreButton:null==k?void 0:k.disablePageLinks})),[m,p,k,f,h,s,j,r,T]),q=(0,u().IS)((e=>{const t="board"===_?(null==y?void 0:y.cardBackgroundColor)||e.boardItemDefaultBackground:e.collectionGalleryPreviewCardBackground,o={background:t,boxShadow:e.homeShadow.card.base};return{linkBox:{borderRadius:wa,position:M?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===_?{marginBottom:w?10:8}:{height:"100%"},...P?{boxShadow:e.homeShadow.card.base}:{boxShadow:e.shadowXS}},linkBoxInner:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===_?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHovered:P?o:{background:(null==y?void 0:y.cardHoveredBackgroundColor)||e.cardHoveredBackground},linkBoxPressed:P?o:{background:(null==y?void 0:y.cardPressedBackgroundColor)||e.cardPressedBackground},propertiesWrapper:{paddingTop:V?0:8,lineHeight:1.5,display:"flex",flexDirection:"column",..."board"===_?{paddingBottom:6}:{paddingBottom:8,...P&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingRight:10,paddingBottom:D?4:8,paddingLeft:!D||O||V?10:4,paddingTop:"gallery"===_&&0===F.length?8:0,marginTop:"board"===_&&D?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.text.tertiary,fill:e.text.tertiary,fontWeight:Ro().Wy.medium,fontSize:12}}}),[_,y,M,w,P,S,D,O,V,F.length]);return"board"!==_&&"gallery"!==_?null:(0,E.jsxs)(wr().A,{ref:t,href:B,metaHref:w?B:l,onMouseEnter:W,onMouseMove:W,onMouseLeave:N,onClick:K,style:q.linkBox,innerStyle:q.linkBoxInner,hoveredStyle:S?{background:q.linkBox.background}:q.linkBoxHovered,pressedStyle:S?{background:q.linkBox.background}:q.linkBoxPressed,disableForOffline:T,children:[(0,E.jsx)(o(982717).A,{store:r,source:_,mouseStore:g,renderControl:U,small:"small"===v,onFlushTemporaryPosition:$,render:e=>{let{imagePosition:t}=e;return h&&(0,E.jsx)(o(78245).z,{variant:"gallery",store:r,coverWidth:x,coverHeight:b,coverFormat:h,coverAspectFormat:f,coverSizeFormat:v,coverPosition:t,showEmptyGalleryCover:"gallery"===_,onLoadProxiedImage:z,isInHomeWidget:p.isInHomeWidgetStore.state})}}),L&&(0,E.jsx)("div",{style:{paddingRight:6,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},children:(0,E.jsx)(br().n,{blockStore:r,collectionContextStore:p})}),V&&(0,E.jsx)(qr,{collectionContextStore:p,store:r,blockPropertyValueOverlayStore:m,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}),F.length>0&&(0,E.jsx)("div",{style:q.propertiesWrapper,children:F.map((e=>(0,E.jsx)(Hr,{store:r,disabled:i,blockPropertyValueOverlayStore:m,collectionContextStore:p,editModeStore:s,isCardSelected:S,propertyFormat:e},e.property)))}),(D||O)&&(0,E.jsxs)("div",{style:q.iconsWrapper,children:[O&&(0,E.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,E.jsx)(Cr().W,{blockStore:r,collectionContextStore:p})}),(0,E.jsx)(vr().g,{store:r,iconStyle:q.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginLeft:O?-3:0}})]})]})})));const Zr=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,colorStyle:f,onTextEnter:y,onTextEsc:v,onShiftEnter:x,blockPropertyValueOverlayStore:b,handleOpenPeekPage:C,collectionContextStore:w}=e;return(0,E.jsx)(Yr,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:void 0,coverWidth:void 0,colorStyle:f,onTextEnter:y,onTextEsc:v,onShiftEnter:x,blockPropertyValueOverlayStore:b,handleOpenPeekPage:C,collectionContextStore:w})};var Jr=()=>o(162339),ei=()=>o(244563);class ti extends p().default{getInitialState(){return{}}}const oi=ti;var ni=()=>o(178063),ri=()=>o(282131);const ii=n.memo(n.forwardRef((function(e,t){const{groupsPointer:o,groupFormat:r,collectionContextStore:i,isSingleColumn:l,isButtonOnOwnRow:s,coverHeight:c,hasVisibleProperties:p,isFullScreen:m}=e,g=(0,a().v3)(),{isMobile:S}=(0,a().Y0)(),h=(0,pt().tz)(),f=(0,n.useContext)(ri().n),y=(0,d().K8)((()=>M().fG({collectionContextStore:i,environment:g,intl:h})),[i,g,h]),v=(0,n.useCallback)((e=>{f?f(e):yr().oo({environment:g,url:e})}),[g,f]),x=(0,n.useCallback)((()=>{if(!(0,Xe().EF)(g))return void(0,Xe().QY)(g);const e=i.groupsStore.getGroupState(o);e&&A().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:g,canUndo:!0,perform:t=>{const{mainEditorCurrentBlockStore:n}=bt().default.state,r=(0,Qn().Q)({environment:g,collectionContextStore:i,groupsPointer:o,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"gallery"},inMemoryRecordCache:g.defaultRecordCache.inMemoryRecordCache});if(!r)return;const l=M().wy({environment:g,store:r.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:i})??(0,kr().Ay)({store:r.newStore,pageVisitSource:To().y8.Create});v(l),C().Ey({collectionContextStore:i,resultsStore:e.resultsStore}),An().v(g,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:r.newStore.id,creating_block_id:r.newStore.id,...(0,ke().sl)(i)})}})}),[g,i,o,v]),b=(0,u().IS)((e=>{const t=S?ar.fontSize:lr.fontSize,o=M().rU({isMobile:S}),n=c>0&&m&&!l&&!s,r=n&&p?c+o:n?c:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:S?ar.fontSize:lr.fontSize,borderRadius:wa,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:S?"12px 14px 12px 14px":"9px 14px 8px",minHeight:r,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:S?ar.fontSize:lr.fontSize,borderRadius:wa,padding:S?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginLeft:-6,color:e.lightIconColor},buttonIcon:{width:t,height:t,marginLeft:l?void 0:-1,marginRight:6,fill:e.lightIconColor}}}),[S,c,m,l,s,p]),w=(0,n.useCallback)((e=>(0,E.jsx)(It().A,{style:b.linkExistingButton,...e,children:(0,E.jsxs)("div",{style:b.buttonContent,children:[(0,mr().arrowDiagonalUpRightIcon)(b.buttonIcon),(0,E.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})),[b]);return(0,E.jsxs)("div",{ref:t,style:b.wrapper,children:[(0,E.jsx)(It().A,{onClick:x,onMouseDown:Te().tr,style:b.addItemButton,children:(0,E.jsxs)("div",{style:b.buttonContent,children:[(0,ni().plusIcon)(b.buttonIcon),(0,E.jsx)(rr,{collectionContextStore:i})]})}),y?(0,E.jsx)(gr().O,{collectionContextStore:i,groupFormat:r,renderLinkButton:w}):null]})})));var li=()=>o(847058);const ai=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,E.jsx)(li().c,{store:t,step:"demo_collection_record",children:(0,E.jsx)(Yr,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,colorStyle:void 0,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k})})};function si(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:i,disabled:l,store:s,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:u,isSingleColumn:p}=e;const m=(0,a().v3)(),g=(0,n.useMemo)((()=>o?[o]:[]),[o]),S=(0,d().O$)(t.permissionScopesStore),h=(0,d().K8)((()=>s.canEdit()&&("collectionTypedView"===t.contextType||S.canEditContent)),[t,S.canEditContent,s]),f=(0,n.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();k().hc({environment:m,store:e}),I().setSelectionAtEnd({store:o}),(0,Zn().C)({store:e})}}),[m]),y=(0,n.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;Ct().q4_(n.getValue())?k().Lt({environment:m,store:e}):o&&A().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:m,canUndo:!0,perform:t=>{St().by({childStore:e,transaction:t})}})}),[t,m]),v=(0,n.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:x,gallery_cover_aspect:b,gallery_cover_size:C}=r,w=!l&&h&&!S.isSyncedCollection,{coverHeight:j,coverWidth:R}=(0,d().K8)((()=>{const{coverHeight:e,coverWidth:t}=u.state;return{coverHeight:e,coverWidth:t}}),[u]),T=(0,n.useMemo)((()=>({format:r,schema:i,onTextEnter:y,onTextEsc:y,onShiftEnter:f,disabled:l,coverFormat:x,coverAspectFormat:b,coverSizeFormat:C,coverHeight:j,coverWidth:R,blockPropertyValueOverlayStore:c,collectionContextStore:t})),[c,t,j,R,b,x,C,l,r,f,y,i]);return(0,E.jsx)(Hn,{collectionContextStore:t,groupsPointer:g,format:r,canDrag:w,onSelectableEnter:f,resultProps:T,resultComponent:ai,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:p?zn.Vertical:zn.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:v,loadContentCover:x&&"page_content"===x.type})}const ci=n.memo(si);function di(e){const t=e.minHeight||fa,o=(0,u().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,E.jsx)(to().A,{style:o.card})}function ui(e){const{hasPartialResults:t}=e;if(!(0,Jr().A)(!0,0,100))return null;const n=e.coverHeight??o(551116).A.card.desktop.medium.height,r=t?void 0:n+40,i=t?1:3,l=f().Hn(i,(e=>(0,E.jsx)(di,{minHeight:r},e)));return(0,E.jsx)(E.Fragment,{children:l})}const pi=n.memo((function(e){var t;const{groupFormat:o,store:r,format:i,disabled:l,collectionContextStore:s,schema:c,blockPropertyValueOverlayStore:p,isFullScreen:m,collectionGalleryViewStore:g,headerWidth:S}=e,{isMobile:h}=(0,a().Y0)(),f=(0,n.useRef)(null),y=(0,n.useRef)(null),[v,x]=(0,n.useState)(!1),b=(0,n.useMemo)((()=>o?[o]:[]),[o]),C=S<=ha,w=(0,d().K8)((()=>s.groupsStore.anyGroupHasResults()),[s]),k=(0,d().K8)((()=>s.groupsStore.getGroupState(b)),[s,b]),{coverHeight:I}=(0,d().O$)(g),{reducerResult:A,hasPartialResults:j}=(0,d().K8)((()=>{const e=null==k?void 0:k.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[k]),R=(0,d().K8)((()=>(0,Yn().iv)({collectionContextStore:s,groupsPointer:b,hasPartialResults:j})),[s,b,j]),T=(0,d().K8)((()=>M().XQ({collectionContextStore:s,reducerResult:A,isFullScreen:m})),[s,A,m]),{canEditContent:_,isSyncedCollection:P}=(0,d().O$)(s.permissionScopesStore),B=(0,d().K8)((()=>r.isSystemBlock()),[r]),V=(0,d().K8)((()=>r.canEdit()&&("collectionTypedView"===s.contextType||_)),[r,s,_]),F=(0,d().O$)(s.isInHomeWidgetStore);(0,n.useEffect)((()=>y.current&&f.current?x(y.current.offsetTop>f.current.offsetTop):x(!1)),[y,f,null==A?void 0:A.blockIds]);const L=(0,u().IS)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,r=h?ar.fontSize:lr.fontSize;return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${C?"100%":`${M().rq(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...F?{paddingLeft:8,paddingRight:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,F,h,C]);if(!k)return null;const O=void 0!==o,D=!F&&w&&!l&&V&&!P&&(j||!R)&&!B,z=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,E.jsxs)("div",{style:L.container,children:[(0,E.jsxs)("div",{style:L.resultsWrapper,children:[(0,E.jsx)(ci,{collectionContextStore:s,groupFormat:o,format:i,schema:c,disabled:l,store:r,blockPropertyValueOverlayStore:p,collectionGalleryViewStore:g,isSingleColumn:C}),(0,E.jsx)("div",{ref:f,style:{display:"none"}}),R?(0,E.jsx)(ui,{hasGroups:O,hasPartialResults:j,coverHeight:I}):null,D?(0,E.jsx)(ii,{ref:y,collectionContextStore:s,groupsPointer:b,groupFormat:o,isSingleColumn:C,isButtonOnOwnRow:v,coverHeight:i.gallery_cover&&I?I:0,hasVisibleProperties:z,isFullScreen:m}):null]}),T?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:L.renderLoadMoreButtonDivider}),(0,E.jsx)(qo().jJ,{groupsPointer:b,store:r,collectionContextStore:s,format:i,isFullScreen:m,incrementLimitsInRelatedGroups:!1,style:L.loadMoreButton,iconStyle:L.loadMoreButtonIcon})]}):null]})}));var mi=()=>o(873895),gi=()=>o(711361),Si=()=>o(361972),hi=()=>o(46877);function fi(e){const{environment:t,collectionContextStore:o,groupFormat:n,newGroupFormat:r,groupsFormatKey:i,currentGroups:l,transaction:a}=e,s=o.collectionStore();!(0,Mo().OF)(n.value,r.value)&&s&&(0,hi().a)({environment:t,collectionStore:s,property:n.property,oldValue:n.value,newValue:r.value,preventPublishAppEventsForBlockUpdates:!1,transaction:a});const c=l.map((e=>(0,Mo().OF)(n.value,e.value)?r:e));(0,Lo().o)({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:a})}function yi(e){const{newGroupValue:t,groupFormat:o,schema:n,collectionContextStore:r,currentGroups:i,groupsFormatKey:l,collectionStore:a,environment:s}=e,c=n[o.property];if(!c)return;if(!(0,Mo().Eg)(c))return;const d=o.value;if((0,Wo().lx)(c)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(void 0===t.value)return;const e=c.options||[],u=t.value,p=e.map((e=>e.value===d.value?{...e,value:u}:e)),m={...c,options:p},g={...n,[o.property]:m},S={...o,value:{...d,value:u}};A().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:e=>{fi({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:S,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,Si().I)({environment:s,collectionStore:a,update:{schema:g},transaction:e})}})}else if("person"!==c.type)if((0,Mo().Vs)(c.type)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};A().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:t=>{fi({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}else"status"===c.type||(0,Mo()._o)(c.type)||"created_by"===c.type||"last_edited_by"===c.type||"number"===c.type||"checkbox"===c.type||"formula"===c.type||"relation"===c.type||"location"===c.type||(0,y().HB)(c.type);else{if(d.type!==c.type)return;if(t.type!==c.type)return;const e={...o,value:t};A().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:t=>{fi({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}}var vi=()=>o(434626),xi=()=>o(836693),bi=()=>o(66460);const Ci=(0,o(851552).Dv)("deleteGroup");var wi=()=>o(839618);var ki=()=>o(83497),Ii=()=>o(107805),Ai=()=>o(432175),ji=()=>o(640979),Ri=()=>o(331516),Ti=()=>o(935091),Mi=()=>o(858023),_i=()=>o(743668),Pi=()=>o(88271),Bi=()=>o(278107);const Vi="color";const Fi=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:s,currentGroups:c,groupsLimitStore:u,schema:p}=e;const m=(0,a().v3)(),g=(0,pt().tz)(),{device:S}=m,h=(0,L().X)("collection_group_reducer_visible"),y=(0,d().O$)(Ke().e),v=(0,d().K8)((()=>f().oE([Ei({environment:m,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:s,currentGroups:c,groupsLimitStore:u,isGroupsReducerV2:h,intl:g,isOnline:y}),Oi(m,p,o,r)])),[m,o,r,i,l,s,c,u,h,g,p,y]),x=(0,n.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(Vi)||t.close()}),[t]);let b;return b=S.isMobile?{menuType:ji().gu.Modal,title:(0,E.jsx)(pt().sA,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:t.close}:{menuType:ji().gu.Popup},(0,E.jsx)(Ti().A,{...b,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:0,sections:v,onAccept:x})})};async function Li(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const a=n.value;if("relation"===a.type&&(0,Mo().WO)(a.value)){const e=ae().Bv.createChildStore(l,{id:a.value.id,table:z().ev});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}A().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:a=>{!function(e){const{environment:t,collectionStore:o,groupsFormatKey:n,property:r,groupFormat:i,currentGroups:l,collectionContextStore:a,transaction:s,intl:c}=e,d=o.getSchema(),u=d[i.property],p=l.filter((e=>!(0,Mo().OF)(i.value,e.value)));(0,Lo().o)({collectionContextStore:a,newGroups:p,groupsFormatKey:n,transaction:s});const m=i.value;if(u&&(0,Wo().lx)(u)&&m.type===u.type&&o){const e=(u.options||[]).filter((e=>e.value!==m.value)),n={...u,options:e},r={...d,[i.property]:n};(0,Si().I)({environment:t,collectionStore:o,update:{schema:r},transaction:s})}const g=t.currentUser.id,S=new Map,h=new Map;o.inMemoryRecordCache.forEachRecord(g,(async e=>{let{model:n}=e;if(n.table!==z().ev)return;const i=ae().Bv.createChildStore(o,n.pointer);if(Yo().xw({block:n,groupBy:a.getGroupByAndGroupFormats().groupBy,schema:d,property:r,value:m,intl:c,timeZone:(0,Qo().P)(),getRecordModel:o.getRecordModel,resultCache:S,regExpCache:h,experimentService:Fo().default,collectionFeatureGates:(0,tn().i)()}))if(n.parent_id===o.id)St().by({childStore:i,transaction:s});else{const e=i.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===i.getType()||"collection_view_page"===i.getType()&&!i.isCollectionViewPageWithContent())&&await Z().Af({environment:t,blocks:[i],shouldCheckSuggestEdit:!0})}})),o.isDefaultRecordCache()&&s.postSubmitCallbacks.push((async e=>{const n=await wi().UT(t,Ci,{collection:{id:o.id,spaceId:(0,bi().e)(o.pointer.spaceId)},property:r,value:m}).next();if(n.value.error)throw n.value.error}))}({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:a,intl:i})}}),(0,v().X)({environment:e,collectionContextStore:t,action:"delete_group"})}function Oi(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const a=or().tS.map((r=>{const i={key:`${Vi}_${r}`,render:e=>(0,E.jsx)(Bi().A,{...e,color:r,isChecked:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!Wo().lx(i))return;const l=r.collectionStore();if(!l)return;const a=o.value;if(a.type!==i.type)return;const s=(i.options||[]).map((t=>t.value===a.value?{...t,color:e}:t)),c={...i,options:s},d={...n,[o.property]:c};A().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,Si().I)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),(0,v().X)({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,E.jsx)(Pi().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:a}}function Ei(e){const{environment:t,groupFormat:o,collectionContextStore:n,groupsFormatKey:r,format:i,query:l,currentGroups:a,groupsLimitStore:s,isGroupsReducerV2:c,intl:d,isOnline:u}=e,p=[],m=o.value,g=n.permissionScopesStore.state,S="board_columns"===r?void 0===l.aggregations:void 0===i.collection_group_aggregation;u&&(S?p.push({key:"addAggregation",render:e=>(0,E.jsx)(Ri().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:vi().eyeIcon}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[Mo().VR]};A().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Ii().F)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else A().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{Eo().zA({stores:[r],update:{collection_group_aggregation:Mo().VR},transaction:e})}})}(t,r,l,n)}):p.push({key:"removeAggregation",render:e=>(0,E.jsx)(Ri().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:_o().e}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:void 0};A().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Ai().f)({collectionViewStore:r,update:t,transaction:e})}})}else A().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{Eo().zA({stores:[r],update:{collection_group_aggregation:void 0},transaction:e})}})}(t,r,l,n)})),(0,Mo().tx)(o)?p.push({key:"show",render:e=>(0,E.jsx)(Ri().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:vi().eyeIcon}),action:()=>{c?(0,ki().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:a}):function(e,t,o,n,r,i){const l={...t,hidden:!1},a=(0,Vo().DF)(r,l,i.state);A().createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,canUndo:!0,perform:e=>{(0,Lo().o)({collectionContextStore:o,newGroups:a,groupsFormatKey:n,transaction:e})}}),(0,v().X)({environment:e,collectionContextStore:o,action:"show_group"})}(t,o,n,r,a,s)}}):p.push({key:"hide",render:e=>(0,E.jsx)(Ri().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:_o().e}),action:()=>{c?(0,ki().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:a}):function(e,t,o,n,r){const i={...t,hidden:!0},l=(0,Vo().LS)(r,i);A().createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,canUndo:!0,perform:e=>{(0,Lo().o)({collectionContextStore:o,newGroups:l,groupsFormatKey:n,transaction:e})}}),(0,v().X)({environment:e,collectionContextStore:o,action:"hide_group"})}(t,o,n,r,a)}}),void 0===m.value||!g.canEditContent||g.isSyncedCollection||"collectionTypedView"===n.contextType||g.isExternallyImportedAndSyncedCollection||p.push({key:"delete",render:e=>(0,E.jsx)(Ri().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:xi().trashIcon}),action:()=>function(e,t,o,n,r,i){xn().ui({message:(0,E.jsx)(pt().sA,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>Li(e,t,o,n,r,i)}]})}(t,n,a,o,r,d)});const h={key:"collection group",render:e=>(0,E.jsx)(Pi().A,{...e}),items:p};return h}var Di=()=>o(120082),zi=()=>o(995331),Ki=()=>o(86607),Hi=()=>o(906230);function Wi(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,f().n4)(t,n):o}function Gi(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:i,changingType:l}=(0,d().K8)((()=>({isCalculating:Wi(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),a=function(e,t){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,i);return i?l?(0,E.jsx)(ur().A,{}):(0,E.jsx)("span",{style:{opacity:.5},children:a??r}):(0,E.jsx)(E.Fragment,{children:r})}var Ni=()=>o(464335);const $i=(0,pt().YK)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var Ui=()=>o(535906),qi=()=>o(273520),Xi=()=>o(350208);function Yi(e){let{schema:t,groupFormat:o,format:n,groupAggregationKey:r,collectionContextStore:i,disabled:l,groupsResultStore:s}=e;const c=(0,a().Y0)(),p=(0,L().X)("collection_group_reducer_visible"),m=(0,d().K8)((()=>n[r]||{aggregator:"count"}),[n,r]),g=(0,d().K8)((()=>({type:"aggregation",filter:(0,Yo().Yy)({schema:t,group:o,groupBy:i.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,Qo().P)(),experimentService:Fo().default}),aggregation:m})),[i,t,o,m]),S=(0,u().IS)((e=>({button:{fontWeight:Ro().Wy.medium,color:e.text.tertiary,height:24}})),[]);return(0,E.jsx)(jt().A,{renderTooltip:()=>(0,E.jsx)(ll,{schema:t,collectionContextStore:i,aggregation:m}),render:e=>(0,E.jsx)(qi().Ay,{popupType:c.isMobile?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:n=>(0,E.jsx)(dr().p,{disabled:l,style:S.button,...(0,Hi().A)((0,Hi().A)(e,n),{onClick:Te().kV}),children:p?(0,E.jsx)(il,{collectionContextStore:i,schema:t,aggregation:m,groupFormat:o,groupsResultStore:s}):(0,E.jsx)(rl,{schema:t,collectionContextStore:i,groupFormat:o,aggregation:m,reducer:g})}),disabled:l,render:e=>(0,E.jsx)(nl,{aggregation:m,parent:e,collectionContextStore:i,format:n,groupAggregationKey:r,schema:t})})})}function Qi(e){let{aggregationType:t,isSelected:o,label:n,props:r}=e;const i=Ki().cx[t];return(0,E.jsx)(jt().A,{placement:Ee().W.Right,delayThreshold:0,render:e=>(0,E.jsx)(Ui().A,{title:n,isChecked:o,...(0,Hi().A)(e,r)}),renderTooltip:()=>(0,E.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,E.jsx)("img",{src:(0,zi().L)(i),style:{borderRadius:6,width:140,marginTop:4}}),Ki().fp[t]]})},r.key)}function Zi(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),A().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,Ii().F)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),(0,v().X)({environment:t,collectionContextStore:o,action:"change_aggregation"})}function Ji(e,t,o,n,r,i,l){const a=Ki().zY[o];return{key:o,render:t=>(0,E.jsx)(Qi,{isSelected:e,aggregationType:o,label:a,props:t}),action:()=>{Zi({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function el(e,t,o,n,r){const i=e.enforceMaxAggregationLimit??!1,l={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,E.jsx)(Ni().A,{on:i,menuListItemProps:e}),action:()=>Zi(l,t,o,n,r)}}function tl(e,t,o,n,r,i,l,a){const{device:s}=n,c=Ki().zY[t],d=f().oE(o.map((o=>function(e,t,o,n,r,i,l,a,s){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,E.jsx)(Qi,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{Zi({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,a,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,n,r,i,l,a)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,E.jsx)(Xi().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,E.jsx)(Ui().A,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=s.isMobile?{menuType:ji().gu.Modal,title:c,right:s.isPhone?(0,E.jsx)(_i().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:ji().gu.Popup,width:200,...e},(0,E.jsx)(Ti().A,{...n,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,E.jsx)(Pi().A,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function ol(e,t,o,n,r,i){const l={};for(const u of Di().VD)l[u]=Ji(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().wG)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(a.length>0)for(const u of Di().CG)"show_unique"!==u&&(l[u]=tl(e,u,a,t,i,o,n,r));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().OC)(o)}))}(i);if(s.length>0)for(const u of Di().Sn)l[u]=tl(e,u,s,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().fo)(o)}))}(i);if(c.length>0)for(const u of Di().zE)l[u]=tl(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().s_)(o)}))}(i);if(d.length>0)for(const u of Di().QO)l[u]=tl(e,u,d,t,i,o,n,r);return l}function nl(e){let{aggregation:t,parent:o,collectionContextStore:n,format:r,groupAggregationKey:i,schema:l}=e;const s=(0,a().v3)(),{device:c}=s,{actions:d,initialFocus:u}=function(e,t,o,n,r,i){const{device:l}=t,a=[];let s=0,c=0;const d=ol(e,t,o,n,r,i);let u=0;return Object.entries(Di().Kn).forEach((i=>{let[p,m]=i;const g=[];for(const t of m)d[t]&&(g.push(d[t]),e.aggregator===t&&(s=u,c=g.length-1));const S=[];if("count_aggregations"===p&&S.push({key:"limitToggleSection",render:e=>(0,E.jsx)(Pi().A,{...e}),items:[el(e,t,o,n,r)]}),S.push({key:"aggregations",render:e=>(0,E.jsx)(Pi().A,{topBorder:!0,...e}),items:g}),g.length>0){u++;const e=Ki().jA[p],t={key:e,render:(t,o)=>(0,E.jsx)(Xi().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,E.jsx)(Ui().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l.isMobile?{menuType:ji().gu.Modal,title:e,right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:ji().gu.Popup,width:250,...t},(0,E.jsx)(Ti().A,{...r,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:c,sections:S,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};a.push(t)}})),{actions:a,initialFocus:s}}(t,s,n,r,i,l);let p;return p=c.isMobile?{menuType:ji().gu.Modal,title:(0,E.jsx)(pt().sA,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:o.close}:{menuType:ji().gu.Popup,width:200},(0,E.jsx)(Ti().A,{...p,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,E.jsx)(Pi().A,{...e}),items:d}],onAccept:o.close})})}function rl(e){let{schema:t,collectionContextStore:o,groupFormat:n,aggregation:r,reducer:i}=e;return i?(0,E.jsx)(bn().A,{id:`group_aggregation:${(0,Mo().Ix)(n)}`,collectionContextStore:o,reducer:i,groupsPointer:[n],render:e=>{const n=e.state;let i,l;if((0,Di().G9)(r)){const e=t[r.property];!e||"formula"!==e.type&&"number"!==e.type||(i=e.number_format),e&&"date"===e.type&&(l=e.date_format)}return(0,E.jsx)(Gi,{aggregation:r,collectionContextStore:o,children:n?(0,Ki().rv)({numberFormat:i,dateFormat:l,aggregation:r,userTimeZone:(0,Qo().P)(),value:n.aggregationResult,numberPrecision:void 0}):"–"})}}):null}function il(e){const t=(0,d().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,Mo().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,Di().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,E.jsx)(Gi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,Ki().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,Qo().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}function ll(e){let{schema:t,collectionContextStore:o,aggregation:n}=e;const r=(0,pt().tz)(),i=Ki().zY[(0,Di().V1)(n)],l=(0,d().K8)((()=>Wi(o,n)),[o,n]);if((0,Di().G9)(n)){const e=t[n.property];if(e){const t=e.name;return(0,E.jsx)(E.Fragment,{children:r.formatMessage($i.propertyAggregation,{aggregationType:i,propertyName:t,calculating:l})})}}return(0,E.jsx)(E.Fragment,{children:r.formatMessage($i.aggregationType,{aggregationType:i,calculating:l})})}var al=()=>o(114530),sl=()=>o(138045);function cl(e){const{onMount:t,isInPeekRenderer:r,style:i,paddingTop:s,disabled:c,stickyStyle:p,transitionStickyStyle:m,groupFormat:g,collectionContextStore:S,format:h,groupAggregationKey:f,stickyWrapStyle:y}=e,[v,x]=(0,n.useState)(void 0),b=(0,a().v3)(),C=(0,fe().Zp)(),w=(0,n.useRef)(null);(0,n.useEffect)((()=>{null==t||t()}),[t]),(0,n.useEffect)((()=>{const e=S.collectionViewBlockStore();e&&x(new(ae().Bv)(b,{table:z().ev,id:e.id}))}),[S,b]);const I=(0,d().K8)((()=>S.groupsStore.getGroupState(g)),[S.groupsStore,g]),j=(0,n.useMemo)((()=>{if((0,Mo().D1)(g.value)&&(0,Mo().WO)(g.value.value))return new(ae().Bv)(b,g.value.value)}),[b,g.value]),R=(0,d().K8)((()=>Boolean((null==j?void 0:j.isReady())&&!(null!=j&&j.canRead()))),[j]),T=(0,d().K8)((()=>null==I?void 0:I.toggleStateStore.state),[I]),_=(0,d().O$)(S.permissionScopesStore),P=(0,d().K8)((()=>!c&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!R),[S,c,R]),B=(0,d().O$)(S.isInHomeWidgetStore),V=(0,d().K8)((()=>void 0!==h[f]&&!(null!=C&&C.isPreviewing)),[h,f,C]),L=(0,M().Oz)(S),O=(0,d().K8)((()=>B?"transparent":(null==L?void 0:L.background)||void 0),[L,B]),D=(0,d().O$)(S.isUnlistedViewStore),K=(0,u().IS)((t=>{const o=D?t.surface.elevated:r?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:87,width:"100%",background:void 0===O?o:O,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...i},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:s,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!T&&{marginBottom:e.toggleClosedMarginBottom},...y}}}),[O,r,T,s,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,i,y,D]),H=(0,d().K8)((()=>b.WindowSizeStore.state.height),[b.WindowSizeStore]),W=(0,n.useCallback)((()=>{if(!I)return;k().IU({environment:b});const e=!T;if((0,o(696718).J)({environment:b,groupFormat:g,toggleStateStore:I.toggleStateStore,newValue:e,collectionContextStore:S}),!e){const e=w.current,t=null==e?void 0:e.parentElement;t&&l().default.afterNextFlush((()=>{(0,F().uf)({environment:b,el:t,windowHeight:H,minEdgeDist:50}),S.renderEmitter.emit()}))}}),[S,b,g,I,T,H]),G=(0,n.useCallback)((()=>(0,E.jsx)(Fn().A,{isSidebar:!1,open:T??!1,fill:!0,onClick:W,onMouseDown:Te().tr,style:{flexShrink:0}})),[W,T]),{value:N}=(0,le().fJ)(ne().VI.duplicateActions),$=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=w.current;if(!(n&&n instanceof Element))return;const r=await ve().T.formulas.load();A().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:b,canUndo:!0,perform:e=>hn({environment:b,collectionContextStore:S,groupsPointer:[g],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r,duplicateActions:N})})}),[S,N,b,g]),U=(0,n.useMemo)((()=>({...p,paddingLeft:e.paddingLeft-2})),[p,e.paddingLeft]);return I&&v?(0,E.jsx)(sl().g,{stickyAttachPoint:B?"no-stick":"ceiling",stickyStyle:U,transitionStickyStyle:m,nodeRef:w,children:(0,E.jsxs)("div",{style:K.topLevelDiv,ref:w,children:[(0,E.jsx)("div",{style:K.stickyWrapStyle,children:(0,E.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,E.jsxs)(lt().A,{store:v,canDropOnto:!c&&!T,onSelectableDrop:$,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[g],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[G(),(0,E.jsx)(ml,{collectionGroupHeaderProps:e}),V&&(0,E.jsx)(ul,{groupsResultStore:e.groupsResultStore,disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!c&&_.canConfigureBlock&&(0,E.jsx)(pl,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),P&&(0,E.jsx)(gl,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}const dl=n.memo(cl);function ul(e){let{disabled:t,format:o,schema:n,collectionContextStore:r,groupFormat:i,groupsResultStore:l,groupAggregationKey:a}=e;const s=!(0,d().O$)(Ke().e),c=(0,d().K8)((()=>r.permissionScopesStore.state.canConfigureBlock),[r]);return s?null:(0,E.jsx)(Yi,{groupsResultStore:l,groupFormat:i,disabled:t||!c,groupAggregationKey:a,format:o,schema:n,collectionContextStore:r})}function pl(e){let{groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:s,isGroupHoveredStore:c}=e;const p=(0,pt().tz)(),m=(0,a().Y0)(),g=(0,d().K8)((()=>l.groupsLimitStore),[l]),S=(0,d().O$)(c),[h,f]=(0,mi().A)(),y=(0,u().IS)((()=>({button:{transition:m.isMobile?void 0:"opacity 100ms ease-in-out",opacity:m.isMobile?void 0:S||f?1:0}})),[m.isMobile,f,S]);return(0,E.jsx)(qi().Ay,{popupType:m.isMobile?qi().z7.SlideUp:qi().z7.Popup,renderOrigin:e=>(0,E.jsx)(At().A,{ariaLabel:p.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:h,icon:gi()._,style:y.button,...e}),onClick:Te().kV,render:e=>(0,E.jsx)(Fi,{parent:e,groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:s,groupsLimitStore:g})})}function ml(e){let{collectionGroupHeaderProps:t}=e;const o=(0,a().v3)(),{groupFormat:n,schema:r,disabled:i,currentGroups:l,groupBy:s,collectionContextStore:c}=t,u=(0,d().O$)(c.permissionScopesStore);return(0,E.jsx)(al().d,{groupBy:s,groupFormat:n,currentGroups:l,schema:r,disabled:i||!u.canConfigureCollection||u.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(yi({...e,environment:t,collectionStore:r,...o}),(0,v().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:c})}function gl(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const n=(0,pt().tz)(),r=(0,a().Y0)(),i=(0,a().v3)(),l=(0,d().O$)(o),[s,c]=(0,mi().A)(),p=(0,u().IS)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:l||c?1:0}})),[r.isMobile,c,l]);return(0,E.jsx)(jt().A,{renderTooltip:()=>(0,E.jsx)(pt().sA,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,E.jsx)(At().A,{ariaLabel:n.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:s,icon:tr().plusSmallIcon,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,Xe().EF)(e)&&(n.searchQueryStore.state&&(0,Jn().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),A().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=(0,Qn().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),An().v(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,ke().sl)(n)}))}}))}(i,t),style:p.button,...e})})}var Sl=()=>o(762847),hl=()=>o(786944);async function fl(e){const{update:t,collectionContextStore:o,groupsFormatKey:n,collectionStore:r,environment:i,schema:l,groupBy:a}=e,s=l[a.property];if(!s)return;const c="relation"===s.type&&(0,Wo().zO)(s),d=c&&new(ae().md)(i,{table:Jo().Vl,id:c});d&&await d.load(),A().createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:i,canUndo:!0,perform:e=>{if(t.newGroups&&((0,Lo().o)({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:n,transaction:e}),hl().RZ({transaction:e,newGroups:t.newGroups,collectionContextStore:o,environment:i})),t.newSchema&&(0,Si().I)({environment:i,collectionStore:r,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===s.type&&d){const o=(0,Ct().x9d)(t.newPage.name),n=Do().Wv({environment:i,id:t.newPage.id,type:Sl().xd.page,spaceId:t.newPage.spaceId,properties:{title:o},inMemoryRecordCache:r.inMemoryRecordCache,transaction:e});St().X$({parentStore:d,childStore:n,transaction:e});const l=d.getDefaultTemplatePageStore();l&&b().n5({title:{text:o},environment:i,store:ae().Bv.createChildStore(d,n.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}var yl=()=>o(199892),vl=()=>o(684244);class xl extends p().default{getInitialState(){return!1}}const bl=xl;class Cl extends p().default{getInitialState(){}}const wl=Cl;var kl=()=>o(691695);var Il=()=>o(3311),Al=()=>o(18434),jl=()=>o(967454),Rl=()=>o(632475),Tl=()=>o(239025),Ml=()=>o(421427);const _l=0;function Pl(e){let{nodeRef:t,width:o,isFirst:r,children:i,clipLeftExtra:l}=e;const a=(0,n.useMemo)(Il().Ay,[]),[s,c]=(0,n.useState)(0),[u,p]=(0,n.useState)(0),{ceiling:m,floor:g,stickyHorizontally:S}=(0,n.useContext)(Ml().m),h=(0,n.useContext)(Rl().e),f=(0,n.useContext)(Tl().j8),y=(0,n.useRef)(null),v=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,n.useRef)(null),[C,w]=(0,n.useState)("in"),[k,I]=(0,n.useState)("in"),A=(0,n.useCallback)((e=>{for(const t of e)if(t.target===y.current||t.target===b.current){(t.target===y.current?w:I)((e=>{var o;return t.isIntersecting?"in":t.boundingClientRect.y<((null===(o=t.rootBounds)||void 0===o?void 0:o.y)||0)?"above":"below"}))}}),[y]);(0,n.useEffect)((()=>{if(!f.current||!y.current||!b.current)return;const e=new IntersectionObserver(A,{root:f.current,threshold:[0,1],rootMargin:`${-1*((null==h?void 0:h.stickyCeilingPortalsHeight)||0)}px 0px ${-1*(u+_l)}px 0px`});e.observe(y.current);const t=new IntersectionObserver(A,{root:f.current,threshold:[0,1],rootMargin:-1*(s+_l+((null==h?void 0:h.stickyCeilingPortalsHeight)||0))+"px 0px 0px 0px"});return t.observe(b.current),()=>{e.disconnect(),t.disconnect()}}),[A,null==h?void 0:h.stickyCeilingPortalsHeight,f,s,u]);const j="above"===(r&&h?h.topMarkerState:C)&&"above"!==k,R="below"!==C&&"below"===k,T=!j&&"above"===(r&&h?h.topMarkerState:C),M=!R&&"below"===k,_=(0,n.useCallback)(((e,t)=>{("ceiling"===e?c:p)((e=>e+t))}),[]),P=(0,n.useRef)([]),B=(0,n.useRef)([]),V=(0,n.useCallback)(((e,t)=>{const o="ceiling"===e?P:B;return o.current.push(t),()=>{o.current.splice(o.current.indexOf(t),1)}}),[]),F=(0,n.useMemo)((()=>({id:a,ceilingIsSticky:j,ceilingIsTransitioning:T,containerNode:t,floorIsSticky:R,floorIsTransitioning:M,topMarkerState:C,provideHeight:_,ceilingTransitionRef:v,floorTransitionRef:x,stickyCeilingPortalsHeight:s,registerPortal:V})),[a,j,T,R,t,_,C,v,x,M,s,V]),L=-1*(0,n.useContext)(Al().X),{horizontalScroller:O}=(0,n.useContext)(ye().R)||{},D=(0,d().K8)((()=>null==O?void 0:O.getStore().state.elementRef),[O]),z=(0,jl().Xg)(D??{current:null}),K=D?`${z}px`:"100%";return(0,n.useEffect)((()=>{if(!m||!g||!t.current||S)return;const e=P.current;for(let t=0;t<e.length;t++)e[t].parentElement.style.width=j?K:"initial";const o=B.current;for(let t=0;t<o.length;t++)o[t].parentElement.style.width=R?K:"initial"}),[j,m,a,R,g,t,K,S]),(0,n.useEffect)((()=>{if(!t.current||!f.current||S)return;const e=t.current.closest(`.${we().XGs}.${we().Dkd}`),o=t.current.closest(`.${we().XGs}.${we().RYy}`);if(!e||!o)return;const n=e.closest(".layout");let r=null;const i=e=>{e.target===n&&a(e)},a=function(){r||(r=requestAnimationFrame((()=>{r=null;const t=e.scrollLeft,n=e.getBoundingClientRect(),i=o.getBoundingClientRect(),a=n.x-i.x,s=t-a;if(j&&m){const e=P.current,o=void 0===l||0===l?0:l-a;for(let r=0;r<e.length;r++)e[r].style.marginLeft=-1*s+"px",e[r].style.marginRight=`${s}px`,e[r].style.clipPath=`rect(-100px ${t+n.width}px calc(100% + 100px) ${t+o}px)`,e[r].style.setProperty("--sticky-horizontal-offset",(0===o?-1*a:0)+"px")}else{const e=P.current;for(let t=0;t<e.length;t++)e[t].style.marginLeft="",e[t].style.marginRight="",e[t].style.clipPath="",e[t].style.removeProperty("--sticky-horizontal-offset")}if(R&&g){const e=B.current;for(let o=0;o<e.length;o++)e[o].style.marginLeft=-1*s+"px",e[o].style.marginRight=`${s}px`,e[o].style.clipPath=`rect(-10px ${t+n.width}px calc(100% + 10px) ${t}px)`}else{const e=B.current;for(let t=0;t<e.length;t++)e[t].style.marginLeft="",e[t].style.marginRight="",e[t].style.clipPath=""}})))};a(),e.addEventListener("scroll",a,{passive:!0});const s=new ResizeObserver(a);return s.observe(f.current),s.observe(e),s.observe(o),null==n||n.addEventListener("transitionend",i),()=>{e.removeEventListener("scroll",a),r&&cancelAnimationFrame(r),null==n||n.removeEventListener("transitionend",i),s.disconnect()}}),[a,j,R,t,f,T,m,g,S,l,L]),(0,E.jsxs)(Rl().e.Provider,{value:F,children:[(0,E.jsx)("div",{ref:x,style:{position:"absolute",zIndex:999,width:"100%"}}),(0,E.jsx)("div",{ref:y,style:{height:_l,marginTop:-1*_l,pointerEvents:"none",width:o}}),i,(0,E.jsx)("div",{ref:b,style:{height:_l,marginTop:-1*_l,pointerEvents:"none",width:o,clear:"both",transform:`translateY(${_l}px)`}}),(0,E.jsx)("div",{ref:v,style:{position:"absolute",zIndex:999,width:"100%",transform:`translateY(-${s}px)`}})]})}const Bl=p().default.createClass(!1,{name:"IsGroupHoveredStore"});function Vl(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:i,groupsFormatKey:l,groupAggregationKey:s,groupsResultStore:c,format:p,schema:m,query:S,collectionContextStore:h,onGroupHeaderAddItem:f,renderHeader:y,getGroupStyle:v,stickyLeft:x,paddingLeft:b,isFullScreen:C,index:w,isRootChild:k,isInPeekRenderer:I,groupBy:A,isLast:j}=e;const R=(0,a().v3)(),T=(0,n.useRef)(null),M=(0,d().uB)(void 0,Bl),[_,P,B,V,F]=(0,d().K8)((()=>{const e=h.groupsStore.getGroupState(o),n=e?e.toggleStateStore:null,a=!!n&&n.state?t(o):null,d={groupFormat:o,currentGroups:r.currentGroups,disabled:i,groupsFormatKey:l,groupAggregationKey:s,groupsResultStore:c,format:p,schema:m,query:S,collectionContextStore:h,isFullScreen:C,isInPeekRenderer:I,onGroupHeaderAddItem:f,stickyLeft:x,index:w,paddingLeft:b,isRootChild:k,groupBy:A,isGroupHoveredStore:M},u=y?y(d):(0,E.jsx)(dl,{...d});return[e,n,v&&n?v({groupFormat:o,index:w,isLast:j,toggleStateStore:n,isFullScreen:C,groupsDisplayState:r}):void 0,a,u]}),[h,o,t,r,i,l,s,c,p,m,S,C,I,f,x,w,b,k,A,M,y,v,j]);(0,n.useEffect)((()=>{!function(e){const{environment:t,groupFormat:o,collectionContextStore:n}=e,r=n.collectionViewStore();if(!r)return;const i=n.groupsStore.getGroupState(o);if(!i)return;const l=g().K.get({userId:t.currentUser.id,key:(0,kl().i)(r.id,o)});i.toggleStateStore.setState(l??!0)}({environment:R,collectionContextStore:h,groupFormat:o})}),[]);const L=(0,n.useCallback)((()=>{M.setState(!0)}),[M]),O=(0,n.useCallback)((()=>{M.setState(!1)}),[M]),D=(0,u().IS)((()=>({container:{width:"100%",position:"relative",...B}})),[B]);return _&&P?(0,E.jsx)("div",{style:D.container,onMouseEnter:L,onMouseLeave:O,ref:T,children:(0,E.jsxs)(Pl,{nodeRef:T,isFirst:0===w,children:[F,V]})}):null}function Fl(e){return(0,M().rq)(e.board_cover_size)}var Ll=()=>o(198654);const Ol=30,El=4,Dl=10;function zl(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,d().O$)(t);return(0,E.jsx)(dr().p,{onClick:function(){t.setState(!t.state)},onMouseDown:Te().tr,style:{height:Ol,marginBottom:El,...e.style},icon:e=>(0,Ll().b)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,E.jsx)(pt().sA,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function Kl(e){const{format:t,columnsDisplayState:o}=e,n=(0,d().K8)((()=>o.visibleGroups.length*(Fl(t)+2*ka+2*Ca)),[o.visibleGroups,t]),r=(0,u().IS)((()=>({container:{display:"flex",minWidth:n}})),[n]);return(0,E.jsx)("div",{style:r.container,children:(0,E.jsx)(zl,{...e})})}const Hl=30,Wl=4,Gl=n.memo((function(e){let{type:t,groupsDisplayState:o,groupsLimitStore:n,schema:r,collectionContextStore:i,style:l}=e;const s=(0,a().v3)(),c=(0,u().DP)(),p=(0,d().O$)(i.normalizedFormatStore),m=(0,d().K8)((()=>(0,Yn().Mw)({collectionContextStore:i,isForColumnGroups:"board"===t})),[i,t]),g=(0,d().K8)((()=>"board"===t?(0,Vo().$e)({environment:s,groupFormat:void 0,schema:r,format:p,theme:c}):void 0),[s,p,r,c,t]),S="v2"===o.version?void 0:Math.min(Vo().B2,o.total-o.hiddenGroups.length-o.visibleGroups.length),h=(0,u().IS)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.text.secondary,marginLeft:void 0===S?8:4,marginTop:1,..."default"===t?{marginRight:8}:{}},button:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2,paddingRight:8,color:e.text.secondary,fontWeight:Ro().Wy.medium,..."board"===t?{background:null==g?void 0:g.backgroundColor,paddingLeft:8,height:"100%",marginRight:2*Ca,borderRadius:wa,width:void 0===S?"fit-content":90,...l}:{paddingLeft:2,borderRadius:4,height:Hl,marginTop:Wl,marginBottom:Wl}}})),[null==g?void 0:g.backgroundColor,S,l,t]);return"default"===t?(0,E.jsxs)(dr().p,{onClick:()=>function(e,t,o){o.setState(o.state+Vo().B2),t.loadingDetailsStore.setState({type:"load_more_groups"}),Nl(e)}(s,i,n),onMouseDown:Te().tr,disabled:m,hoveredStyle:m?h.hovered:{},style:{...h.button,...l},children:[(0,gi()._)(h.dots),void 0===S?(0,E.jsx)(pt().sA,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more groups"}):(0,E.jsx)(pt().sA,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:S}}),m&&(0,E.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,E.jsx)(ur().A,{size:"sm"})})]}):(0,E.jsxs)(dr().p,{onClick:()=>function(e,t,o){o.setState(o.state+Vo().B2),t.loadingDetailsStore.setState({type:"load_more_columns"}),Nl(e)}(s,i,n),onMouseDown:Te().tr,disabled:m,hoveredStyle:m?h.hovered:{},style:h.button,children:[(0,E.jsx)("span",{style:{flexGrow:1},children:void 0===S?(0,E.jsx)(pt().sA,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"More"}):(0,E.jsx)(pt().sA,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:S}})}),m?(0,E.jsx)("div",{style:{marginLeft:4},children:(0,E.jsx)(ur().A,{size:"sm"})}):(0,gi()._)(h.dots)]})}),No().A);function Nl(e){xe().vd(e,"collection_load_more_groups")}function $l(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,a().v3)(),l=(0,d().K8)((()=>(0,xo().iw)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),s=(0,d().K8)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),c=(0,d().K8)((()=>(0,xo().Od)({environment:i,isRootChild:r,isFullScreen:o,format:t})?xo().HV:n),[i,t,o,r,n]);return l||s?null:(0,E.jsx)("div",{style:{width:"100%",height:La+Ea+Oa,display:"flex"},children:(0,E.jsx)(za,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?c:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Ul(e){const{format:t,isFullScreen:o,isRootChild:n,paddingLeft:r,hiddenGroups:i,hiddenGroupsVisibleStore:l,style:s}=e,c=(0,a().v3)(),u=(0,d().K8)((()=>(0,xo().iw)({environment:c,format:t,isFullScreen:o,isRootChild:n})),[c,t,o,n]),p=(0,d().K8)((()=>(0,xo().Od)({environment:c,isRootChild:n,isFullScreen:o,format:t})?xo().HV:r),[c,t,o,n,r]);return u?null:(0,E.jsx)("div",{style:{width:"100%",height:Ol+El+Dl,display:"flex"},children:(0,E.jsx)(zl,{hiddenGroupsVisibleStore:l,hiddenGroups:i,style:{position:"sticky",left:o?p:3,width:"max-content",paddingLeft:4,paddingRight:8,...s}})})}function ql(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,a().v3)(),i=(0,d().K8)((()=>(0,xo().iw)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,d().K8)((()=>(0,xo().Od)({environment:r,isRootChild:n,isFullScreen:o,format:t})?xo().HV:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,E.jsx)("div",{style:{width:"100%",height:Hl+2*Wl,display:"flex"},children:(0,E.jsx)(Gl,{type:"default",groupsDisplayState:e.groupsDisplayState,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}var Xl=()=>o(286404);const Yl=n.memo((function(e){const{title:t,icon:o,onClick:n,className:r}=e,{isPhone:i}=(0,a().Y0)(),l=(0,u().IS)((e=>({wrapper:{display:"flex",alignItems:"center",justifyContent:"center",height:144},phoneButton:{fontSize:16,color:e.text.tertiary,height:i?36:void 0},phoneIcon:{width:18,height:18,fill:e.icon.tertiary},iconStyle:{width:16,height:16}})),[i]);return(0,E.jsx)("div",{style:l.wrapper,className:r,children:i?(0,E.jsx)(Xl().A,{onClick:n,size:"lg",style:l.phoneButton,icon:o,iconStyle:l.phoneIcon,children:t}):(0,E.jsx)(dr().p,{onClick:n,isLightGray:!0,icon:o,iconStyle:l.iconStyle,children:t})})})),Ql=(0,Ao().wt)("collectionGroupAccordion",{svg:(0,E.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});function Zl(e){const{width:t}=e,o=(0,a().v3)(),n=(0,d().K8)((()=>o.WindowSizeStore.state.width<=ha),[o]),r=(0,u().IS)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,E.jsxs)("div",{style:r.container,children:[(0,E.jsxs)("div",{style:r.groupContainer,children:[(0,E.jsx)("div",{style:r.iconContainer,children:Ql(r.icon)}),(0,E.jsx)(to().A,{style:r.groupShimmer})]}),(0,E.jsxs)("div",{style:r.itemsContainer,children:[(0,E.jsx)(di,{}),(0,E.jsx)(di,{}),(0,E.jsx)(di,{})]})]})}function Jl(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,M().rq)(o),i=f().Hn(n,(e=>(0,E.jsx)(Zl,{width:r},e)));return(0,E.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function ea(){const e=(0,u().IS)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,E.jsxs)("div",{style:e.container,children:[(0,E.jsxs)("div",{style:e.groupContainer,children:[(0,E.jsx)("div",{style:e.iconContainer,children:Ql(e.icon)}),(0,E.jsx)(to().A,{style:e.groupShimmer})]}),(0,E.jsxs)("div",{style:e.rowsContainer,children:[(0,E.jsxs)("div",{style:e.rowContainer,children:[(0,E.jsxs)("div",{style:e.firstColumn,children:[(0,E.jsx)(to().A,{style:e.circleShimmer}),(0,E.jsx)(to().A,{style:e.rowShimmerShort})]}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmerShort})}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmerShort})}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmerShort})})]}),(0,E.jsxs)("div",{style:e.rowContainer,children:[(0,E.jsxs)("div",{style:e.firstColumn,children:[(0,E.jsx)(to().A,{style:e.circleShimmer}),(0,E.jsx)(to().A,{style:e.rowShimmerLong})]}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmer})}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmer})}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmer})})]}),(0,E.jsxs)("div",{style:e.lastRowContainer,children:[(0,E.jsxs)("div",{style:e.firstColumn,children:[(0,E.jsx)(to().A,{style:e.circleShimmer}),(0,E.jsx)(to().A,{style:e.rowShimmerLong})]}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmer})}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmer})}),(0,E.jsx)("div",{style:e.column,children:(0,E.jsx)(to().A,{style:e.rowShimmer})})]})]})]})}function ta(e){const{isFullScreen:t}=e,o=t?2:1,n=f().Hn(o,(e=>(0,E.jsx)(ea,{},e)));return(0,E.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function oa(){const e=(0,u().IS)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,E.jsxs)("div",{style:e.rowsContainer,children:[(0,E.jsx)("div",{style:e.rowContainer,children:(0,E.jsx)(to().A,{style:e.rowShimmerShort})}),(0,E.jsx)("div",{style:e.rowContainer,children:(0,E.jsx)(to().A,{style:e.rowShimmer})})]})}var na=()=>o(283820);function ra(){const e=(0,u().IS)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,ee().Ks)(),o=(0,d().K8)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,E.jsx)(na().J,{widthPercentage:e,isInHomeWidget:o},t)));return(0,E.jsxs)("div",{style:e.container,children:[(0,E.jsxs)("div",{style:e.groupContainer,children:[(0,E.jsx)("div",{style:e.iconContainer,children:Ql(e.icon)}),(0,E.jsx)(to().A,{style:e.groupShimmer})]}),(0,E.jsx)("div",{style:e.rowsContainer,children:n})]})}function ia(e){const{isFullScreen:t}=e,o=t?2:1,n=f().Hn(o,(e=>(0,E.jsx)(ra,{},e)));return(0,E.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function la(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,Jr().A)(!0,0,100))return null;switch(t){case"table":return(0,E.jsx)(ta,{isFullScreen:o});case"list":return(0,E.jsx)(ia,{isFullScreen:o});case"gallery":return(0,E.jsx)(Jl,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,E.jsx)(oa,{});default:return null}}const aa=new Set(["dropzone","table"]),sa=new Set(["item","table"]),ca=n.memo((function(e){const{onClickEmptyStateButton:t,collectionContextStore:r,timelineProps:i}=e,l=(0,a().v3)(),s=(0,a().Y0)().isMobile,c=(0,L().X)("collection_group_reducer_visible"),u=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),p=(0,d().O$)(r.permissionScopesStore),m=(0,d().O$)(r.normalizedFormatStore),g=null==m?void 0:m.collection_group_by,S=null==m?void 0:m.board_columns_by,h=(0,d().O$)(r.groupsLimitStore),y=(0,d().O$)(r.normalizedSchemaStore),v=(0,d().K8)((()=>r.normalizedQueryStore.state??{}),[r.normalizedQueryStore]),x=(0,d().K8)((()=>{if(c&&"board"===u&&g&&S)return;if(!g||!m)return;if(null!=i&&i.type&&aa.has(null==i?void 0:i.type))return;const e=(0,yl().m)({collectionContextStore:r,isMobile:s,groupBy:g});return(0,yl().p)({groupBy:g,schema:y,format:m,groupsFormatKey:Mo().V1,limit:h,aggregation:m.collection_group_aggregation,blockResults:e})}),[c,u,g,S,m,null==i?void 0:i.type,r,s,y,h]),b=(0,d().uB)(e.groupsResultStore,wl),C=(0,d().O$)(b),w=(0,d().uB)(null==i?void 0:i.hiddenGroupsVisibleStore,bl),k=(0,d().O$)(w),[I,A]=(0,vl().d)({collectionContextStore:r,groupBy:g,groupsFormatKey:Mo().V1,reducerResult:C,groupsLimit:h}),[j]=(0,vl().d)({collectionContextStore:r,groupBy:S,groupsFormatKey:"board_columns",reducerResult:C,groupsLimit:h}),[R]=(0,vl().d)({collectionContextStore:r,groupBy:"board"===u?void 0:g,subGroupBy:"board"===u?g:void 0,groupsFormatKey:Mo().V1,reducerResult:C,groupsLimit:h}),T=c?R:I,_=n.useCallback((()=>{Oo({environment:l,groupsFormatKey:Mo().V1,collectionContextStore:r,currentGroups:A.state.currentGroups})}),[r,l,A]),P=(0,hr().U)(_,5e3);(0,n.useEffect)((()=>{if(null==i||!i.type||!aa.has(null==i?void 0:i.type))return A.addListener(P),()=>{A.removeListener(P),P.cancel()}}),[A,P,i]);const B=(0,d().K8)((()=>A.state.hiddenGroups.slice(0,Vo().RP)),[A]),V=(0,d().K8)((()=>!((null==i?void 0:i.type)&&sa.has(null==i?void 0:i.type))&&(0,Yn().c_)({collectionContextStore:r,displayState:T})),[r,T,i]),F=(0,d().K8)((()=>{const{visibleGroups:e}=T;return 0===e.length&&!r.shouldShowSpinnerStore.state||e.length>0}),[r,T]),O=(0,d().K8)((()=>(0,Vo().Zl)(T,e.collectionContextStore,!1)),[T,e.collectionContextStore]),D=(0,d().K8)((()=>!e.disabled&&!p.isLocked&&p.canConfigureBlock&&!V&&g&&(0,Mo().pP)(g,p.canConfigureCollection)&&"collectionTypedView"!==r.contextType&&!(0,o(594876).u)(g.property)&&F),[F,r,p.canConfigureBlock,p.canConfigureCollection,p.isLocked,e.disabled,g,V]),z=(0,d().K8)((()=>Fo().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),K=u?(0,M().JK)(u):void 0,H=(0,L().X)("db_ux_empty_states");if(!m)return null;const W="board"!==u&&"timeline"!==u&&H&&!V&&"v2"===T.version&&0===T.visibleGroups.length&&0===T.pinnedGroups.groups.length?(0,E.jsx)(Yl,{className:K,onClick:t??f().D_,icon:_o().e,title:(0,E.jsx)(pt().sA,{id:"board.emptyState.button",defaultMessage:"All groups are hidden"})}):(0,E.jsxs)("div",{style:{position:"relative"},children:[(0,E.jsx)(da,{groups:T.visibleGroups,groupBy:g,groupsDisplayState:T,groupsResultStore:b,format:m,schema:y,query:v,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderHeader:e.renderHeader,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,onGroupHeaderAddItem:e.onGroupHeaderAddItem}),V&&(0,E.jsx)(la,{viewType:u,isFullScreen:e.isFullScreen,galleryCoverSize:m.gallery_cover_size}),O&&(0,E.jsx)(ua,{timelineType:null==i?void 0:i.type,collectionContextStore:e.collectionContextStore,schema:y,format:m,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:T}),B.length>0&&!c&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ma,{reducerId:e.reducerId,timelineType:null==i?void 0:i.type,format:m,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:j,hiddenGroups:B,hiddenGroupsVisibleStore:w}),k&&(0,E.jsx)(da,{groups:B,groupBy:g,groupsDisplayState:T,groupsResultStore:b,format:m,schema:y,query:v,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderHeader:e.renderHeader,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,onGroupHeaderAddItem:e.onGroupHeaderAddItem})]}),D&&!c&&(0,E.jsx)(pa,{timelineType:null==i?void 0:i.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:y,format:m,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:T,groupBy:g})]});return x?(0,E.jsx)(bn().A,{id:e.reducerId,reducer:x,collectionContextStore:e.collectionContextStore,resultStore:b,render:()=>W,debounceWait:z}):W}),No().A),da=n.memo((function(e){const{groups:t,groupBy:o,groupsDisplayState:n,groupsResultStore:r,format:i,schema:l,query:a,collectionContextStore:s,disabled:c,isFullScreen:u,isRootChild:p,paddingLeft:m,stickyLeft:g,renderGroup:S,getGroupStyle:h,renderHeader:f,onGroupHeaderAddItem:y}=e,v=(0,d().O$)(s.isInPeekRendererStore),x=s.groupsStore.getGroupState;return(0,E.jsx)(E.Fragment,{children:t.map(((e,d)=>x&&o?(0,E.jsx)(Vl,{collectionContextStore:s,groupsDisplayState:n,groupFormat:e,groupBy:o,groupsResultStore:r,disabled:c,groupsFormatKey:Mo().V1,groupAggregationKey:Mo().FJ,format:i,schema:l,query:a,isInPeekRenderer:v,isFullScreen:u,isRootChild:p,paddingLeft:m,stickyLeft:g,renderGroup:S,renderHeader:f,onGroupHeaderAddItem:y,getGroupStyle:h,index:d,isLast:d===t.length-1},(0,Mo().Ix)(e)):null))})}));function ua(e){return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,E.jsx)(ql,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,E.jsx)("div",{style:{display:"flex"},children:(0,E.jsx)(Gl,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function pa(e){const t=(0,a().v3)(),o=(0,d().K8)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=n.useCallback(((e,t,o,n,r)=>{const i=o.collectionStore();i&&fl({update:e,collectionContextStore:o,groupsFormatKey:Mo().V1,collectionStore:i,environment:t,groupBy:n,schema:r})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,E.jsx)($l,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,E.jsx)(za,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function ma(e){return"board_collection_groups"===e.reducerId?(0,E.jsx)(Kl,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,E.jsx)(Ul,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,style:{marginTop:Dl}}):(0,E.jsx)("div",{style:{display:"flex"},children:(0,E.jsx)(zl,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:Dl,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}const ga=n.memo((function(e){const{collectionContextStore:t,store:o,format:r,disabled:i,schema:l,blockPropertyValueOverlayStore:s,isFullScreen:c,paddingLeft:d,isRootChild:p,headerWidth:m,collectionGalleryViewStore:g}=e,S=(0,L().X)("db_ux_chrome"),h=(0,u().DP)(),f=(0,a().v3)(),{isMobile:y}=(0,a().Y0)(),v=(0,n.useCallback)((e=>(0,E.jsx)(Sa,{args:e})),[]),b=(0,n.useCallback)((e=>{if(y)zo().uK({environment:f,store:e,pageVisitSource:To().y8.Create});else{const o="collectionTypedView"===t.contextType;Ko().VU({environment:f,store:e,peekMode:M().hH(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:To().y8.Create})}}),[t,f,y]),C=(0,n.useCallback)((e=>(0,E.jsx)(pi,{store:o,format:r,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:s,isFullScreen:c,collectionGalleryViewStore:g,groupFormat:e,headerWidth:m})),[o,r,i,t,l,s,c,g,m]),w=(0,n.useCallback)((e=>S||0===e.index?{}:{borderTop:`1px solid ${h.tableDividerColor}`}),[S,h.tableDividerColor]),k=(0,n.useCallback)((()=>{x().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Mo().V1}})}),[t]);return(0,E.jsx)(ca,{reducerId:"gallery_groups",store:o,collectionContextStore:t,disabled:i,isFullScreen:c,isRootChild:p,paddingLeft:d,stickyLeft:!1,renderHeader:v,onGroupHeaderAddItem:b,renderGroup:C,getGroupStyle:w,onClickEmptyStateButton:k})}));function Sa(e){let{args:t}=e;const o=(0,d().O$)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,E.jsx)(dl,{...t,height:o?yt().ag:48,stickyStyle:n})}const ha=480,fa=40;function ya(e){const{store:t,format:o,collectionContextStore:r,isFullScreen:i,isPreviewing:l,isRootChild:s,blockPropertyValueOverlayStore:c,disabled:p,schema:m,paddingBottom:g,paddingLeft:S,paddingRight:h,minWidth:f,headerWidth:y}=e,v=(0,a().v3)(),{isMobile:x}=(0,a().Y0)(),b=(0,n.useRef)(null),C=(0,d().uB)(void 0,oi);(0,d().O$)(C);const{coverWidth:w,coverHeight:k}=(0,d().O$)(C),I=(0,d().K8)((()=>M().mM(r,i)),[r,i]),A=(0,d().O$)(r.isInHomeWidgetStore),j=(0,d().K8)((()=>Boolean(r.viewsModuleContextStore.getViewModuleType())),[r]),R=(0,n.useCallback)((()=>{if(b.current){const e=b.current.getNode();if(e){const t=e.querySelector(`.${we().E4t}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return M().rq(o.gallery_cover_size)}),[o.gallery_cover_size]),T=(0,n.useCallback)((e=>{C.setState({coverHeight:k,coverWidth:e||R()})}),[C,k,R]),_=(0,n.useCallback)((()=>R()*(9/16)),[R]),P=(0,n.useCallback)((e=>{C.setState({coverWidth:w,coverHeight:e||_()})}),[C,w,_]),B=(0,n.useCallback)((e=>{var t;const o=r.isLoadingStore.state,n=null===(t=r.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<ze().A.incrementScrollOffset&&n&&!o&&null!=n&&n.hasMore&&(0,Uo().H)({collectionContextStore:r,environment:v,incrementLimitArgs:{isFullScreen:i,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[r,v,i]),V=(0,n.useCallback)((()=>{const e=_(),t=R();k!==e&&P(e),w!==t&&T(t)}),[_,R,k,w,P,T]),F=(0,hr().Y)(V,100),L=(0,fr().d)(V,100);(0,n.useEffect)((()=>{T(R()),P()}),[R,P,T,null==o?void 0:o.gallery_cover_size]),(0,n.useEffect)((()=>((0,Re().P4)(window,"resize",L),x&&(0,Re().P4)(window,"orientationchange",F),()=>{(0,Re().Ol)(window,"resize",L),x&&(0,Re().Ol)(window,"orientationchange",F)})),[F,L,x]);const O=(0,u().IS)((()=>({container:{paddingBottom:g,paddingLeft:S,paddingRight:h,minWidth:f}})),[f,g,S,h]),D=o.collection_group_by,z=(0,fe().Zp)();return(0,ei().A)((e=>(0,E.jsxs)("div",{style:O.container,className:we().wx0,children:[(0,E.jsx)(lt().A,{store:t,shouldShowHalo:!i&&!A&&!l,canSelect:!i&&!j,disablePointerEvents:null==z?void 0:z.disableAllPointerEvents,analyticsName:"gallery",...e,ref:b,children:D?(0,E.jsx)(ga,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:C,disabled:p,format:o,isFullScreen:i,isRootChild:s,paddingLeft:S,headerWidth:y-2*S,schema:m,store:t}):(0,E.jsx)(pi,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:C,disabled:p,format:o,groupFormat:void 0,isFullScreen:i,headerWidth:y-2*S,schema:m,store:t})}),!I&&(0,E.jsx)(Xn().A,{onChange:B})]})))}const va=n.memo(ya);function xa(e){const t=e.minHeight||fa,o=(0,u().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:wa,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,E.jsx)(to().A,{style:o.card})}function ba(){return(0,Jr().A)(!0,0,100)?(0,E.jsx)(xa,{}):null}const Ca=5,wa=10,ka=7,Ia=ka+32;function Aa(e,t){return t?0:e?8:12}const ja=function(e){let{groupsPointer:t,schema:o,format:n,collectionContextStore:r,store:i,disabled:l,blockPropertyValueOverlayStore:s,isFullScreen:c,anyGroupHasResults:p,isInPeekRenderer:m,hoveredGroupStore:g}=e;const S=(0,u().DP)(),h=(0,a().v3)(),y=(0,pt().tz)(),{isMobile:v}=(0,a().Y0)(),x=(0,d().K8)((()=>{const e=f().HV(t);return(0,Vo().$e)({environment:h,groupFormat:e,schema:o,format:n,theme:S})}),[t,o,n,h,S]),b=(0,d().K8)((()=>{const e=r.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,r]),C=(0,d().K8)((()=>r.groupsStore.getGroupState(t)),[r,t]),k=(0,d().K8)((()=>(0,M().mM)(r,c)),[r,c]),I=(0,d().K8)((()=>null==C?void 0:C.reducerResultStore.state),[C]),j=(0,d().O$)(r.permissionScopesStore),R=(0,d().O$)(r.isInHomeWidgetStore),T=(0,d().K8)((()=>!l&&b&&r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!R})),[l,b,r,R]),_=(0,d().K8)((()=>(0,M().XQ)({reducerResult:I,collectionContextStore:r,isFullScreen:c})),[I,r,c]),P=(0,d().K8)((()=>(0,Yn().iv)({collectionContextStore:r,groupsPointer:t,hasPartialResults:p})),[r,t,p]),B=(0,d().K8)((()=>p&&r.shouldShowSpinnerStore.state&&"load_general"===r.loadingDetailsStore.state.type),[r,p]),V=(0,d().K8)((()=>(0,M().fG)({collectionContextStore:r,environment:h,intl:y})),[h,r,y]),F=(0,d().K8)((()=>h.device.isMobile||(0,Mo().Mn)(g.state,f().HV(t))),[g,t,h]),L=(0,u().IS)((e=>({loadMoreButton:{borderRadius:wa,fontSize:v?16:14,padding:"5px 4px 5px 11px",height:void 0},loadMoreButtonIcon:{width:v?16:14,height:v?16:14}})),[v]);if(!C)return null;const O=function(e){return e?e.board_cover:void 0}(n),D=!l&&!j.isSyncedCollection,z=Boolean(n.collection_group_by),K=!p&&z&&P;return(0,E.jsxs)("div",{style:Fa(n,b,x),onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&n instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),w().jD({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,h),onClick:Pa,className:we().mVR,onMouseMove:()=>function(e,t){const o=f().HV(e);o&&t.state!==o&&t.setState(o)}(t,g),children:[(0,E.jsx)(Hn,{collectionContextStore:r,groupsPointer:t,format:n,canDrag:D,onSelectableEnter:e=>Ba(e,t,r,c,h),resultProps:{format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,Xe().EF)(i)||!o.collectionStore())return Va(e,o,r,t,i);const l=_a(t,o);if(!l)return;const a=l.state.findIndex((t=>t===e))+1;A().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{er({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a,from:"board_group_enter_add_item",transient:!0})}})}(e,t,r,c,i,h),onShiftEnter:e=>Ba(e,t,r,c,h),coverFormat:O,coverAspectFormat:Ra(n),coverSizeFormat:Ta(n),colorStyle:x,onTextEsc:e=>Va(e,r,i,t,h),disabled:l,blockPropertyValueOverlayStore:s,collectionContextStore:r},canDrop:!0,resultComponent:Zr,disabled:l,direction:zn.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:z?ka:3,analyticsName:"board",loadContentCover:O&&"page_content"===O.type}),K&&(0,E.jsx)(ba,{}),_&&(0,E.jsx)(qo().jJ,{groupsPointer:t,store:i,collectionContextStore:r,format:n,isFullScreen:c,incrementLimitsInRelatedGroups:!0,style:L.loadMoreButton,iconStyle:L.loadMoreButtonIcon}),T&&(0,E.jsxs)(E.Fragment,{children:[_&&(0,E.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${S.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,E.jsx)(pr,{groupsPointer:t,collectionContextStore:r,isFullScreen:c,color:null==x?void 0:x.textColor,shouldShowSpinner:B})]}),V&&(0,E.jsx)(Sr,{groupFormat:f().HV(t),collectionContextStore:r,color:null==x?void 0:x.textColor,isHovered:F}),!k&&(0,E.jsx)(Xn().A,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),a=null==l?void 0:l.reducerResultStore.state;e<ze().A.incrementScrollOffset&&!i&&a&&a.hasMore&&((0,Uo().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:a.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,r,c,t,h)})]})};function Ra(e){return e?e.board_cover_aspect:void 0}function Ta(e){return e?e.board_cover_size:void 0}function Ma(e){const t=e.board_cover_size;return(0,M().rq)(t)}function _a(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function Pa(e){(0,Te().SQ)({event:e,context:Te().y$.EditorClick,callback:()=>{}})}function Ba(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const a=i[0];if(!(0,Xe().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const s=_a(t,o);if(!s)return;er({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s.state.findIndex((e=>e===a))+1,from:"board_group_enter_add_item",transient:!0})}function Va(e,t,o,n,r){const i=t.collectionStore(),l=e.getTitleStore();if(!l)return;if(Ct().q4_(l.getValue()))k().Lt({environment:r,store:e});else if(i){const i=_a(n,t);if(!i)return;const l=i.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),s=t.collectionViewBlockStore();if(a&&s&&$o(r,{...(0,ke().sl)(t),block_id:o.id}),A().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{St().by({childStore:e,transaction:t})}}),l>=0){const e=i.state[l];k().Lt({environment:r,store:e})}}}function Fa(e,t,o){const n=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:ka,paddingRight:ka,paddingBottom:ka,marginRight:2*Ca,boxSizing:"content-box",width:Ma(e),height:n?void 0:"max-content",...o&&t&&{backgroundColor:o.backgroundColor,...n?{borderRadius:wa}:{borderBottomLeftRadius:wa,borderBottomRightRadius:wa}}}}const La=28,Oa=12,Ea=4,Da=(0,pt().YK)({addGroup:{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"}}),za=n.memo((function(e){let{type:t,style:r,groupBy:i,currentGroups:l,schema:s,groupsLimitStore:c,collectionContextStore:p,parentStore:m,onAccept:g,paddingLeft:S,stickyLeft:h,disabled:f}=e;const x=(0,a().v3)(),b=(0,u().DP)(),C=(0,pt().tz)(),w=(0,d().uB)(void 0,De().A),k=s[i.property],I=(0,d().K8)((()=>(0,Vo().$e)({environment:x,groupFormat:void 0,schema:s,format:p.normalizedFormatStore.state,theme:b})),[p,x,s,b]),A=(0,u().IS)((e=>({plusIcon:{fill:e.text.secondary},iconButton:{width:35,background:null==I?void 0:I.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:ka,paddingBottom:ka,marginRight:Ca,borderRadius:wa,height:"100%",...r}})),[I,r]),j=(0,n.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:a,buttonPopupStore:s,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=r.state;if(!u||!(0,Mo().Eg)(u))return;if((0,v().X)({environment:a,collectionContextStore:i,action:"board_add_group"}),s.reset(),Wo().lx(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],r={id:Go().JW(),value:d.value,color:(0,Wo().Zd)(e)},i=[...e,r],a={...u,options:i},s={...t,[o.property]:a},c={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Vo().DF)(n,c,p),newSchema:s})}if("person"===u.type||"relation"===u.type||(0,Mo().Vs)(u.type)){const e={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Vo().DF)(n,e,p),newPage:c.newPage})}if((0,Mo()._o)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,y().HB)(u.type)}({schema:s,groupBy:i,currentGroups:l,groupsLimitStore:c,collectionContextStore:p,onAccept:g,environment:x,buttonPopupStore:w,update:e})}),[w,p,l,x,i,c,g,s]),R=(0,n.useCallback)((()=>{!function(e){e.reset()}(w)}),[w]),T=(0,n.useCallback)((()=>(0,E.jsx)(o(436230).p,{groupFormat:void 0,groupBy:i,currentGroups:l,schema:s,onChange:j,onClose:R,parentStore:m})),[l,i,j,R,m,s]);return k&&(0,Mo().Eg)(k)?(0,E.jsx)(qi().Ay,{render:T,buttonPopupStore:w,popupType:x.device.isMobile?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:e=>"board"===t?(0,E.jsx)(At().A,{ariaLabel:C.formatMessage(Da.addGroup),icon:e=>(0,Gt().W)({...e,...A.plusIcon}),style:A.iconButton,disabled:f,...e}):(0,E.jsx)(dr().p,{isLightGray:!0,icon:Gt().W,style:{display:"flex",height:La,marginTop:Oa,marginBottom:Ea,width:"max-content",position:h?"sticky":void 0,left:h&&S?S:0,...r},disabled:f,...e,children:C.formatMessage(Da.addGroup)})}):null}),No().A);var Ka=()=>o(97787);const Ha=n.memo((function(e){let{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,E.jsx)(bn().A,{id:"board_columns",reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,E.jsx)(E.Fragment,{children:t()})}));var Wa=()=>o(229895);const Ga=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e,a=(0,d().O$)(t.permissionScopesStore),s=t.settingsStore,c=(0,n.useCallback)((()=>{x().Ow({collectionContextStore:t,collectionSettingsStore:s}),x().a2({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})}),[t,s]);return(0,E.jsx)(Wa().Ay,{title:(0,E.jsx)(pt().sA,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:a.canConfigureBlock?(0,E.jsx)(pt().sA,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,E.jsx)(Wa().P6,{onClick:c,children:e})}}):(0,E.jsx)(pt().sA,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l}})}));function Na(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r}=e,i=e.numBoardColumns||3,l=function(e){const t=2*ka;return(0,M().rq)(e)+t}(o),a=(0,u().IS)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:12},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%",opacity:n?1:0},group:{marginTop:r?20:12,marginRight:10,width:"100%",minWidth:l}})),[r,n,l]),s=f().Hn(i,(e=>(0,E.jsxs)("div",{style:a.group,children:[(0,E.jsx)(to().A,{style:a.groupHeader}),(0,E.jsx)(xa,{minHeight:t})]},e)));return(0,E.jsx)("div",{style:a.container,children:s})}var $a=()=>o(34982);const Ua=n.memo((function(e){let{format:t,schema:o,collectionContextStore:n,store:r,columnsDisplayStateForCurrentGroups:i,disabled:l}=e;const s=(0,a().v3)(),c=(0,d().K8)((()=>n.contextType),[n]);return t.board_columns_by?"collectionTypedView"===c?null:(0,E.jsx)(za,{groupBy:t.board_columns_by,schema:o,currentGroups:i,onAccept:e=>function(e,t,o,n,r){const i=t.collectionStore();if(!i)return;const l=n.board_columns_by;if(!l)return;fl({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:l,environment:r})}(e,n,o,t,s),groupsLimitStore:n.boardColumnsLimitStore,parentStore:r,type:"board",collectionContextStore:n}):null}));var qa=()=>o(312430),Xa=()=>o(982415);const Ya=n.memo((function(e){const{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:l}=e,s=(0,a().v3)(),{isMobile:c}=(0,a().Y0)(),d=c?{menuType:ji().gu.Modal,title:(0,E.jsx)(pt().sA,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:o.close}:{menuType:ji().gu.Popup,width:200},{sections:u,initialFocus:p}=(0,n.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let a=0,s=0;const c=function(e,t,o,n,r){const i={};for(const a of Di().VD)i[a]=ts(e.aggregator===a,e.enforceMaxAggregationLimit??!1,a,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,Di().wG)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const a of Di().CG)"show_unique"!==a&&(i[a]=es(e,a,l,t,r,o,n));return Za.forEach((l=>{let{supportCheck:a,aggregationTypes:s}=l;const c=Object.keys(r).filter((e=>{const t=r[e];return t&&a(t)}));if(c.length>0)for(const d of s)i[d]=es(e,d,c,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(Di().Kn).forEach((t=>{let[n,r]=t;const u=[];for(const o of r)c[o]&&(u.push(c[o]),e.aggregator===o&&(a=d,s=u.length-1));const p=[];if("count_aggregations"===n&&p.push({key:"limitToggleSection",render:e=>(0,E.jsx)(Pi().A,{...e}),items:[Ja(e,o)]}),p.push({key:"aggregations",render:e=>(0,E.jsx)(Pi().A,{topBorder:!0,...e}),items:u}),u.length>0){d++;const e=Ki().jA[n],t={key:e,render:(t,o)=>(0,E.jsx)(Xi().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,E.jsx)(Ui().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:ji().gu.Modal,title:e,right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:ji().gu.Popup,width:250,...t},(0,E.jsx)(Ti().A,{...r,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:s,sections:p,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:a}}(t,s,r,i,l);return{sections:[{key:"aggregation section",render:e=>(0,E.jsx)(Pi().A,{...e}),items:e}],initialFocus:o}}),[i,s,r,l,t]);return(0,E.jsx)(Ti().A,{...d,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:p,sections:u,onAccept:o.close})})})),Qa=n.memo((function(e){const{aggregationType:t,isSelected:o,label:r,innerProps:i}=e,l=Ki().cx[t],a=(0,u().IS)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),s=(0,n.useCallback)((e=>(0,E.jsx)(Ui().A,{title:r,isChecked:o,...(0,Hi().A)(e,i)})),[o,i,r]),c=(0,n.useCallback)((()=>(0,E.jsxs)("div",{style:a.container,children:[l&&(0,E.jsx)("img",{src:(0,zi().L)(l),style:a.image}),Ki().fp[t]]})),[l,a.container,a.image,t]);return(0,E.jsx)(jt().A,{placement:Ee().W.Right,delayThreshold:0,render:s,renderTooltip:c})}));const Za=[{supportCheck:Di().OC,aggregationTypes:Di().Sn},{supportCheck:Di().fo,aggregationTypes:Di().zE},{supportCheck:Di().s_,aggregationTypes:Di().QO}];function Ja(e,t){const o=e.enforceMaxAggregationLimit??!1,n={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,E.jsx)(Ni().A,{on:o,menuListItemProps:e}),action:()=>{t(n)}}}function es(e,t,o,n,r,i,l){const{device:a}=n,s=Ki().zY[t],c=f().oE(o.map((o=>function(e,t,o,n,r,i,l,a){const s=r[t];if(!s)return;const c=s.name;return{key:`${t}${o}`,render:t=>(0,E.jsx)(Qa,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{os({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${s}`,render:(e,t)=>(0,E.jsx)(Xi().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,E.jsx)(Ui().A,{...e,ref:t,title:s}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:ji().gu.Modal,title:s,right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:ji().gu.Popup,width:200,...e},(0,E.jsx)(Ti().A,{...n,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,E.jsx)(Pi().A,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function ts(e,t,o,n,r,i){const l=Ki().zY[o];return{key:o,render:t=>(0,E.jsx)(Qa,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{os({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function os(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),(0,v().X)({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const ns=n.memo((function(e){const{aggregation:t,schema:o,groupFormat:r,groupsResultStore:i,collectionContextStore:l,disabled:s,color:c,onChange:p}=e,{isMobile:m}=(0,a().Y0)(),g=(0,L().X)("collection_group_reducer_visible"),S=!(0,d().O$)(Ke().e),h=(0,u().IS)((e=>({button:{fontWeight:Ro().Wy.regular,color:c||e.text.tertiary,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}})),[c]),f=(0,n.useCallback)((()=>(0,E.jsx)(rs,{aggregation:t,schema:o,collectionContextStore:l})),[t,l,o]),y=(0,n.useCallback)((e=>(0,E.jsx)(qi().Ay,{popupType:m?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:n=>(0,E.jsx)(dr().p,{disabled:s,style:h.button,...(0,Hi().A)(e,n),children:g?(0,E.jsx)(ls,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r,groupsResultStore:i}):(0,E.jsx)(is,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r})}),disabled:s,render:e=>(0,E.jsx)(Ya,{parent:e,selectedAggregation:t,onChange:p,collectionContextStore:l,schema:o})})),[m,s,h.button,g,o,t,l,r,i,p]);return S?null:(0,E.jsx)(jt().A,{renderTooltip:f,render:y})}));function rs(e){let{aggregation:t,schema:o,collectionContextStore:n}=e;const r=(0,d().K8)((()=>!!Boolean(t)&&Wi(n,t)),[n,t]);if(t){const e=Ki().zY[(0,Di().V1)(t)];if((0,Di().G9)(t)){const n=o[t.property];if(n){const t=n.name;return(0,E.jsx)(E.Fragment,{children:xt().A.formatMessage($i.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,E.jsx)(E.Fragment,{children:xt().A.formatMessage($i.aggregationType,{aggregationType:e,calculating:r})})}return(0,E.jsx)(pt().sA,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function is(e){const{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e,l=(0,d().K8)((()=>({type:"aggregation",filter:(0,Yo().Yy)({schema:t,group:i,groupBy:r.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,Qo().P)(),experimentService:Fo().default}),aggregation:o})),[r,o,t,i]),{numberFormat:a,numberPrecision:s}=(0,n.useMemo)((()=>{if(!(0,Di().G9)(o))return{};const e=t[o.property];if(e&&("formula"===e.type||"number"===e.type)){const t=e.number_format,n=e.number_precision;return{numberFormat:t,numberPrecision:(0,Di().FM)(o)?n:void 0}}return{}}),[o,t]),c=(0,n.useMemo)((()=>{if(!(0,Di().G9)(o))return;const e=t[o.property];return e&&"date"===e.type?e.date_format:void 0}),[o,t]),u=(0,n.useCallback)((e=>{const t=e.state;return(0,E.jsx)(Gi,{aggregation:o,collectionContextStore:r,children:t?(0,Ki().rv)({numberFormat:a,dateFormat:c,aggregation:o,userTimeZone:(0,Qo().P)(),value:t.aggregationResult,numberPrecision:s}):"-"})}),[o,r,c,a,s]);return l?(0,E.jsx)(bn().A,{id:`board:${(0,Mo().Ix)(i)}`,collectionContextStore:r,reducer:l,groupsPointer:[i],render:u}):null}function ls(e){const t=(0,d().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,Mo().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,Di().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,E.jsx)(Gi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,Ki().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,Qo().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}const as=n.memo((function(e){const{hoveredGroupStore:t,groupFormat:o,schema:r,format:i,groupsResultStore:l,collectionContextStore:s,disabled:c,hidden:p,isPopup:m,query:g,currentGroups:S,isFullScreen:h}=e,f=(0,u().DP)(),y=(0,a().v3)(),{isMobile:v}=(0,a().Y0)(),x=(0,pt().tz)(),b=(0,fe().Zp)(),C=(0,d().K8)((()=>!!v||(0,Mo().Mn)(t.state,o)),[v,t,o]),w=(0,d().K8)((()=>(0,Vo().$e)({environment:y,groupFormat:o,schema:r,format:i,theme:f})),[o,r,i,y,f]),k=(0,d().O$)(s.permissionScopesStore),I=(0,n.useMemo)((()=>{if((0,Mo().D1)(o.value)&&(0,Mo().WO)(o.value.value))return new(ae().Bv)(y,o.value.value)}),[y,o.value]),A=(0,d().K8)((()=>Boolean((null==I?void 0:I.isReady())&&!(null!=I&&I.canRead()))),[I]),j=(0,d().K8)((()=>s.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!A),[s,A]),R=(0,d().K8)((()=>(0,M().fG)({collectionContextStore:s,environment:y,intl:x})),[s,y,x]),T=(0,d().K8)((()=>{const e=s.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==b||!b.isPreviewing)&&(g.aggregations&&g.aggregations.length>0)}),[s,g,b]),_=(0,n.useCallback)((()=>{t.state!==o&&t.setState(o)}),[o,t]),P=(0,u().IS)((()=>{const e=Fl(i),t=Boolean(i.collection_group_by);return{container:{display:"flex",alignItems:"center",fontSize:14,width:e,paddingLeft:ka,paddingRight:ka,marginRight:2*Ca,marginBottom:p?4:0,boxSizing:"content-box",flexShrink:0,...m&&{padding:v?"6px 16px":"8px 12px 4px",width:"none",minWidth:e},...w&&!p&&{backgroundColor:w.backgroundColor,...t?{borderRadius:wa}:{borderTopLeftRadius:wa,borderTopRightRadius:wa}}},spacer:{flexGrow:1}}}),[w,i,p,v,m]);return(0,E.jsxs)("div",{style:P.container,onMouseMove:_,children:[(0,E.jsx)(ss,{boardGroupHeaderProps:e}),T?(0,E.jsx)(cs,{groupsResultStore:l,disabled:c,query:g,schema:r,collectionContextStore:s,groupFormat:o,hidden:p,boardSelectStyle:w}):null,(0,E.jsx)("div",{style:P.spacer}),!c&&k.canConfigureBlock?(0,E.jsx)(ds,{hidden:p,groupFormat:o,currentGroups:S,format:i,schema:r,query:g,collectionContextStore:s,boardSelectStyle:w,isHovered:C}):null,j?(0,E.jsx)(us,{format:i,groupFormat:o,collectionContextStore:s,isFullScreen:h,hidden:p,isHovered:C,boardSelectStyle:w}):null,R?(0,E.jsx)(ps,{groupFormat:o,collectionContextStore:s,hidden:p,isHovered:C,boardSelectStyle:w}):null]})}));function ss(e){const{boardGroupHeaderProps:t}=e,{groupFormat:o,schema:r,disabled:i,currentGroups:l,format:s,groupBy:c,collectionContextStore:p}=t,m=(0,a().v3)(),g=(0,d().O$)(p.permissionScopesStore),S=(0,d().K8)((()=>p.groupsStore.getGroupState(o)),[p,o]),h=(0,n.useCallback)((e=>{const o=p.collectionStore();o&&(yi({...e,environment:m,groupsFormatKey:"board_columns",collectionStore:o,...t}),(0,v().X)({environment:m,collectionContextStore:p,action:"rename_group"}))}),[t,p,m]),f=(0,u().IS)((()=>({container:{maxWidth:Fl(s)-70}})),[s]);return S?(0,E.jsx)(al().d,{groupBy:c,groupFormat:o,currentGroups:l,schema:r,disabled:i||!g.canConfigureBlock,isHiddenGroup:!1,onChange:h,style:f.container,collectionContextStore:p}):null}function cs(e){const{disabled:t,query:o,schema:r,collectionContextStore:i,groupFormat:l,hidden:s,boardSelectStyle:c,groupsResultStore:p}=e,m=(0,a().v3)(),g=(0,d().O$)(i.permissionScopesStore),S=(0,n.useCallback)((e=>{const t=i.collectionViewStore();if(!t)return;const n=e?[e]:[],r={...o,aggregations:n};A().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:m,canUndo:!0,perform:e=>{(0,Ii().F)({collectionViewStore:t,update:{query2:r},transaction:e})}})}),[i,m,o]),h=(0,u().IS)((e=>({container:{color:ms({theme:e,hidden:s,boardSelectStyle:c})}})),[s,c]),f=o.aggregations?o.aggregations[0]:void 0;return f?(0,E.jsx)(ns,{groupFormat:l,groupsResultStore:p,disabled:t||!g.canConfigureBlock,aggregation:f,schema:r,collectionContextStore:i,color:h.container.color,onChange:S}):null}function ds(e){const{hidden:t,groupFormat:o,currentGroups:r,format:i,schema:l,query:s,collectionContextStore:c,boardSelectStyle:d,isHovered:p}=e,{isMobile:m}=(0,a().Y0)(),g=(0,pt().tz)(),S=(0,u().IS)((e=>{const o=ms({theme:e,hidden:t,boardSelectStyle:d});return{button:gs({hidden:t,isHovered:p}),icon:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:o}}}),[t,d,p]),h=(0,n.useCallback)((e=>(0,E.jsx)(At().A,{style:S.button,icon:Fr().Y,iconStyle:S.icon,ariaLabel:g.formatMessage({defaultMessage:"More group options",id:"database.boardGroupHeader.actions.moreGroupOptions.tooltip"}),...e})),[g,S.button,S.icon]),f=(0,n.useCallback)((e=>(0,E.jsx)(Fi,{parent:e,groupFormat:o,currentGroups:r,format:i,query:s,schema:l,collectionContextStore:c,groupsFormatKey:"board_columns",groupsLimitStore:c.boardColumnsLimitStore})),[c,i,o,r,l,s]);return(0,E.jsx)(qi().Ay,{popupType:m?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:h,render:f})}function us(e){const{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,hidden:l,isHovered:s,boardSelectStyle:c}=e,p=(0,a().v3)(),{isMobile:m}=(0,a().Y0)(),g=(0,pt().tz)(),S=(0,n.useContext)(ri().n),h=(0,n.useCallback)((()=>{if(!(0,Xe().EF)(p))return;const e="collectionTypedView"===r.contextType,n=Boolean(t.collection_group_by);r.searchQueryStore.state&&(0,Jn().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const l=r.groupsStore.getGroupState(o);if(!l)return;const a=l.resultsStore;A().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:p,canUndo:!0,perform:t=>{const i=(0,Qn().Q)({environment:p,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"board_group_header"},inMemoryRecordCache:p.defaultRecordCache.inMemoryRecordCache});if(!i)return;const l=i.coercionSucceeded,s=i.newStore;if(m){!function(e,t,o){o?o(e):yr().oo({environment:t,url:e})}((0,kr().Ay)({store:s,pageVisitSource:To().y8.Create}),p,S)}else if(l&&!n){const e=s.getBlockTitleStore();k().hc({environment:p,store:s}),I().setSelectionAtEnd({store:e}),(0,Zn().C)({store:s})}else Ko().VU({environment:p,store:s,peekMode:(0,M().hH)(r),showMoveTo:e,resultsStore:a,collectionContextStore:r,pageVisitSource:To().y8.Create});An().v(p,{from:"board_group_add_item_top",type:"page",new_page_id:s.id,creating_block_id:s.id,...(0,ke().sl)(r)})}})}),[p,r,t.collection_group_by,o,i,m,S]),f=(0,d().K8)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),y=(0,n.useMemo)((()=>{const e=(0,Xa().$O)(f);return g.formatMessage({defaultMessage:"Create new {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:e})}),[f,g]),v=(0,u().IS)((e=>{const t=ms({theme:e,hidden:l,boardSelectStyle:c});return{button:gs({hidden:l,isHovered:s}),icon:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:t}}}),[c,l,s]),x=(0,n.useCallback)((()=>y),[y]),b=(0,n.useCallback)((e=>(0,E.jsx)(At().A,{icon:tr().plusSmallIcon,onClick:h,style:v.button,iconStyle:v.icon,ariaLabel:y,...e})),[h,y,v.button,v.icon]);return(0,E.jsx)(jt().A,{renderTooltip:x,render:b})}function ps(e){const{groupFormat:t,collectionContextStore:o,hidden:r,isHovered:i,boardSelectStyle:l}=e,a=(0,pt().tz)(),s=(0,d().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),c=(0,n.useMemo)((()=>{const e=(0,Xa().$O)(s);return a.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:e})}),[s,a]),p=(0,u().IS)((e=>{const t=ms({theme:e,hidden:r,boardSelectStyle:l});return{button:gs({hidden:r,isHovered:i}),icon:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:t}}}),[l,r,i]),m=(0,n.useCallback)((()=>c),[c]),g=(0,n.useCallback)(((e,t)=>(0,E.jsx)(At().A,{icon:qa().arrowDiagonalUpRightSmallIcon,style:p.button,iconStyle:p.icon,...e,...t,ariaLabel:c})),[c,p.button,p.icon]);return(0,E.jsx)(gr().O,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,E.jsx)(jt().A,{renderTooltip:m,render:t=>g(t,e)})})}function ms(e){const{theme:t,hidden:o,boardSelectStyle:n}=e;return!o&&n?n.textColor:t.text.tertiary}function gs(e){const{hidden:t,isHovered:o}=e;return t?{}:{transition:"opacity 100ms ease-in-out",opacity:o?1:0}}function Ss(e,t,o){const{visibleGroups:n}=e,r=t.board_columns_by;if(!r)return!1;if(0===n.length)return!1;const i=o.permissionScopesStore.state;return i.canConfigureBlock&&!i.isSyncedCollection&&(0,Mo().pP)(r,i.canConfigureCollection)}function hs(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}function fs(e,t){const o=e.isInHomeWidgetStore.state;return{width:220,flexShrink:0,marginTop:Ia+Aa(t,o),marginLeft:12}}const ys=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,groupsResultStore:r,currentGroups:i,disableBoardColorColumns:l,disabled:s,format:c,headerPlaceholderHeight:p,hiddenGroups:m,hiddenGroupsHeaderRef:g,hoveredGroupStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y,paddingLeft:v,paddingRight:x,query:b,schema:C,store:w,visibleGroups:k,shouldShowShimmer:I}=e,A=(0,a().v3)(),j=(0,u().DP)(),R=(0,n.useRef)(null),T=(0,d().O$)(t.shouldShowSpinnerStore),_=(0,d().K8)((()=>(0,Vo().K3)({device:A.device,isFullScreen:h,isRootChild:y})),[A.device,h,y]),P=function(e,t,o,n){const r=(0,M().Oz)(t);return(0,d().K8)((()=>{const i=t.isInHomeWidgetStore.state,l=i?"transparent":(null==r?void 0:r.background)||(o?e.cardContentBackground:e.contentBackground),a=Aa(n,i);return{position:"absolute",background:l,height:Ia+a,paddingTop:a,zIndex:85,display:"flex",boxShadow:`-3px 0 0 ${l}`,minWidth:"100%"}}),[t,null==r?void 0:r.background,o,e.cardContentBackground,e.contentBackground,n])}(j,t,f,l),B=(0,u().IS)((e=>({stickyHeader:{paddingLeft:v,paddingRight:x},stickyHeaderTransition:{paddingLeft:v},hiddenGroupsTitle:{display:"flex",alignItems:"center",width:220,flexShrink:0,fontSize:14,color:e.text.tertiary,marginLeft:20}})),[v,x]),V=(0,d().O$)(t.permissionScopesStore),F=(0,d().K8)((()=>{const e=t.normalizedFormatStore.state.board_columns_by;if(!e)return!1;const o=(0,Mo().Nf)(e);return V.canConfigureBlock&&o.includes("manual")}),[t.normalizedFormatStore,V.canConfigureBlock]),L=(0,d().O$)(t.isInHomeWidgetStore),O=(0,n.useCallback)(((e,o)=>(0,E.jsx)(xs,{schema:C,collectionContextStore:t,format:c,query:b,disabled:s,isFullScreen:h,hoveredGroupStore:S,groupFormat:k[o],currentGroups:i,groupsResultStore:r})),[t,i,s,c,S,h,b,r,C,k]),D=(0,n.useCallback)((e=>{"v2"!==o.version?(0,$a().r)({environment:A,collectionContextStore:t,isHidden:!1,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:i,newGroupIds:e}):(0,$a().V)({environment:A,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:o.currentGroups,containsAllGroups:!1})}),[t,o.version,o.currentGroups,i,A]),z=(0,d().K8)((()=>(0,Vo().Zl)(o,t,!0)),[t,o]),K=(0,d().K8)((()=>Ss(o,c,t)),[t,o,c]),H=(0,n.useMemo)((()=>I?null:"v2"===o.version?o.pinnedGroups.groups.length>0?(0,E.jsxs)("div",{style:B.hiddenGroupsTitle,ref:g,children:[(0,E.jsx)(pt().sA,{...Vo().K0.pinnedGroups}),(0,E.jsx)(Yt().A,{size:4}),(0,E.jsx)(vs,{collectionContextStore:t})]}):null:m.length>0?(0,E.jsx)("div",{style:B.hiddenGroupsTitle,ref:g,children:(0,E.jsx)(pt().sA,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})}):null),[t,o,m.length,g,I,B.hiddenGroupsTitle]);if(0===k.length&&0===m.length&&"v2"===o.version&&0===o.pinnedGroups.groups.length)return null;const W=k.map((e=>(0,Mo().Ix)(e)));return c.board_columns_by?(0,E.jsx)(sl().g,{stickyAttachPoint:L?"no-stick":"ceiling",absoluteHeight:p,nodeRef:R,stickyStyle:B.stickyHeader,transitionStickyStyle:B.stickyHeaderTransition,children:(0,E.jsxs)("div",{style:P,ref:R,children:[_&&(0,E.jsx)("div",{style:hs(f,j,L)}),F?(0,E.jsx)(Ka().Ay,{direction:"horizontal",keys:W,renderKey:O,onDrop:D}):W.map(((e,o)=>(0,E.jsx)(xs,{schema:C,collectionContextStore:t,format:c,query:b,disabled:s,isFullScreen:h,hoveredGroupStore:S,groupFormat:k[o],currentGroups:i,groupsResultStore:r},(0,Mo().Ix)(k[o])))),z&&(0,E.jsx)(Gl,{groupsDisplayState:o,groupsLimitStore:t.boardColumnsLimitStore,type:"board",schema:C,collectionContextStore:t}),K&&(0,E.jsx)(Ua,{format:c,schema:C,collectionContextStore:t,store:w,columnsDisplayStateForCurrentGroups:i,disabled:T}),H]})}):null}));function vs(e){const t=(0,pt().tz)();return(0,E.jsx)(At().A,{icon:gi()._,ariaLabel:t.formatMessage(Vo().K0.pinnedGroups),onClick:()=>{const t=e.collectionContextStore.settingsStore;x().R8({collectionSettingsStore:t,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}})}const xs=n.memo((function(e){let{groupFormat:t,currentGroups:o,schema:n,collectionContextStore:r,format:i,query:l,disabled:a,isFullScreen:s,hoveredGroupStore:c,groupsResultStore:u}=e;return(0,d().K8)((()=>r.groupsStore.getGroupState([t])),[r,t])&&i.board_columns_by?(0,E.jsx)(as,{currentGroups:o,groupFormat:t,query:l,schema:n,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:c,disabled:a,hidden:!1,isPopup:!1,isFullScreen:s,groupsResultStore:u}):null}));class bs extends p().default{constructor(){super("groupsReducerResultStore")}getInitialState(){}}var Cs=()=>o(401382),ws=()=>o(975515),ks=()=>o(443252);class Is extends p().default{getInitialState(){return{searchQuery:"",limit:Is.defaultLimit}}}Is.defaultLimit=20,Is.loadMoreScrollOffset=200,Is.loadMoreIncrement=20;const As=Is,js=(0,pt().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}}),Rs={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:6},Ts=n.memo((function(e){const{device:t}=(0,a().v3)(),r=(0,a().v3)(),i=(0,u().DP)(),{groupBy:l,groupFormat:s,disabled:c,format:p,query:m,schema:g,currentGroups:S,collectionContextStore:h,blockPropertyValueOverlayStore:f,isFullScreen:y,hoveredGroupStore:v}=e,x=(0,d().uB)(void 0,bs),b=(0,d().uB)(void 0,De().A),C=(0,d().uB)(void 0,As),w=n.useRef(null),k=(0,d().K8)((()=>{var e;return null===(e=m.aggregations)||void 0===e?void 0:e[0]}),[m]),I=(0,d().O$)(h.isInHomeWidgetStore),j=(0,d().K8)((()=>h.collectionViewBlockStore()),[h]),R=(0,n.useMemo)((()=>j?new(ae().Bv)(r,{table:z().ev,id:j.id}):null),[r,j]),T=(0,n.useCallback)((()=>(0,E.jsx)(Ks,{groupFormat:s,disabled:c,format:p,collectionContextStore:h,schema:g,blockPropertyValueOverlayStore:f,isFullScreen:y,buttonPopupStore:b})),[f,b,h,c,p,s,y,g]),{searchQuery:_,limit:P}=(0,d().O$)(C),B=(0,d().K8)((()=>{const e=(0,Yo().Yy)({schema:g,group:s,groupBy:p.board_columns_by,propertyMapping:void 0,timeZone:(0,Qo().P)(),experimentService:Fo().default});if(!e)return;return{type:"results",filter:e,limit:P,searchQuery:_,loadContentCover:Boolean(p&&p.board_cover&&"page_content"===p.board_cover.type)}}),[s,g,p,_,P]),V=(0,n.useCallback)((e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:As.defaultLimit}),Ls(t)}(e,r,C)),[r,C]),F=(0,n.useCallback)((()=>function(e,t){t.reset(),Ls(e)}(r,C)),[r,C]),L=(0,n.useCallback)((()=>(0,E.jsxs)(n.Fragment,{children:[!t.isMobile&&(0,E.jsx)(as,{groupBy:l,currentGroups:S,groupFormat:s,query:m,schema:g,format:p,collectionContextStore:h,disabled:c||Boolean(_),hidden:!0,isPopup:!0,isFullScreen:y,hoveredGroupStore:v,groupsResultStore:x},(0,Mo().Ix)(s)),(0,E.jsx)("div",{style:{margin:t.isMobile?0:"6px 0"},children:(0,E.jsx)(ht().A,{capture:!0,render:e=>(0,E.jsx)(Cs().Ay,{value:_,placeholder:xt().A.formatMessage(js.searchPlaceholder),autoFocus:!t.isMobile,showClearButton:!0,onChange:V,onClearButtonClick:F,...e})})})]})),[h,S,t.isMobile,c,p,l,s,F,V,v,y,m,x,g,_]),O=(0,n.useCallback)((e=>function(e,t,o,n){var r;const i=n.state,l=null===(r=Vs(t,o))||void 0===r||null===(r=r.state)||void 0===r?void 0:r.blockIds,a=t.isLoadingStore.state;e<As.loadMoreScrollOffset&&!a&&l&&i.limit<=l.length&&n.setState({...i,limit:i.limit+As.loadMoreIncrement})}(e,h,s,C)),[h,s,C]),D=(0,n.useCallback)((e=>(0,E.jsx)("div",{...e,children:(0,gi()._)({width:18,height:18,color:i.text.tertiary})})),[i.text.tertiary]),K=(0,n.useCallback)((e=>(0,E.jsx)(Os,{parent:e,groupFormat:s,currentGroups:S,format:p,schema:g,query:m,collectionContextStore:h})),[s,S,p,g,m,h]),H=(0,n.useCallback)((e=>{let o,{selectableEvents:n}=e;return o=t.isMobile?{menuType:ji().gu.Modal,title:(0,E.jsx)(al().d,{groupBy:l,groupFormat:s,currentGroups:S,schema:g,disabled:!0,isHiddenGroup:!0,collectionContextStore:h}),left:(0,E.jsx)(qi().Ay,{popupType:ks().nl.BottomSheet,renderOrigin:D,render:K}),right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:()=>zs(b),header:L()}:{menuType:ji().gu.Popup,header:L(),width:(0,M().rq)(Bs(p))+20},B?(0,E.jsxs)(Ti().A,{...o,...n,children:[(0,E.jsx)(bn().A,{id:`board_hidden_group:${(0,Mo().Ix)(s)}`,reducer:B,groupsPointer:[s],collectionContextStore:h,resultStore:Vs(h,s),render:T}),(0,E.jsx)(Xn().A,{onChange:O})]}):null}),[t.isMobile,B,s,h,T,O,l,S,g,D,K,L,b,p]),W=(0,n.useCallback)((()=>{if(R)return(0,E.jsx)(o(365060).A,{store:R,isDefaultContainer:!0,droppable:!0,render:H})}),[R,H]),G=(0,n.useCallback)((()=>function(e,t){t.reset(),Ls(e)}(r,C)),[r,C]),{value:N}=(0,le().fJ)(ne().VI.duplicateActions),$=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=w.current;if(!n)return;if(!(n instanceof Element))return;const i=await ve().T.formulas.load();A().createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:r,canUndo:!0,perform:e=>hn({environment:r,collectionContextStore:h,groupsPointer:[s],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:i,duplicateActions:N})})}),[r,h,s,N]),U=(0,n.useCallback)((e=>(0,E.jsx)(Ms,{buttonPopupEvents:e,aggregation:k,schema:g,collectionContextStore:h,query:m,groupFormat:s,groupBy:l,currentGroups:S,isInHomeWidget:I,groupsResultStore:x})),[g,h,m,s,l,S,I,k,x]);return R?(0,E.jsx)("div",{ref:w,children:(0,E.jsx)(lt().A,{store:R,canDropOnto:!c,onSelectableDrop:$,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,E.jsx)(qi().Ay,{popupType:t.isMobile?ks().nl.BottomSheet:ks().nl.Popup,renderOrigin:U,render:W,buttonPopupStore:b,onClick:G})})}):null}));function Ms(e){let{query:t,aggregation:o,buttonPopupEvents:r,groupFormat:i,groupBy:l,currentGroups:s,schema:c,collectionContextStore:d,isInHomeWidget:p,groupsResultStore:m}=e;const g=(0,a().v3)(),S=(0,u().IS)((e=>({button:{...Rs,...p?{fontSize:14}:{}}})),[p]),h=(0,n.useCallback)((e=>function(e,t,o,n){const r=t.collectionViewStore(),i=e?[e]:[],l={...o,aggregations:i};r&&A().createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,Ii().F)({collectionViewStore:r,update:{query2:l},transaction:e})}})}(e,d,t,g)),[d,t,g]);return(0,E.jsxs)(It().A,{style:S.button,...r,children:[(0,E.jsx)(al().d,{groupBy:l,groupFormat:i,currentGroups:s,schema:c,disabled:!0,isHiddenGroup:!0,collectionContextStore:d}),o&&(0,E.jsx)(ns,{groupFormat:i,aggregation:o,schema:c,collectionContextStore:d,disabled:!0,onChange:h,groupsResultStore:m})]},(0,Mo().Ix)(i))}function _s(e){return e?e.board_cover:void 0}function Ps(e){return e?e.board_cover_aspect:void 0}function Bs(e){return e?e.board_cover_size:void 0}function Vs(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Fs(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Ls(e){se().default.state.stores.length>0&&k().IU({environment:e})}function Os(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a}=e;const s=(0,d().K8)((()=>a.collectionStore()),[a]),c=a.boardColumnsLimitStore;return s?(0,E.jsx)(Fi,{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a,groupsFormatKey:"board_columns",groupsLimitStore:c}):null}function Es(e,t,o,n,r){const{blocks:i,transaction:l}=e,a=o.groupsStore.getGroupState(t);if(!a)return;const s=a.resultsStore;if(i.length>0&&s.state.length>0){const e=i[0];if(!(0,Xe().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;er({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:[t],insertAtIndex:s.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0})}}function Ds(e,t,o,n){const r=t.collectionStore(),i=e.getTitleStore();if(Ct().q4_(null==i?void 0:i.getValue()))return void k().Lt({environment:n,store:e});if(!r)return;const l=Fs(t,o);if(!l)return;const a=l.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),c=t.collectionViewBlockStore();if(s&&c&&$o(n,{...(0,ke().sl)(t),block_id:e.id}),A().createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:n,canUndo:!0,perform:t=>{St().by({childStore:e,transaction:t})}}),a>=0){const e=l.state[a];k().Lt({environment:n,store:e})}}function zs(e){e.setState({open:!1})}function Ks(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:i,schema:l,blockPropertyValueOverlayStore:s,isFullScreen:c,buttonPopupStore:u}=e;const p=(0,a().v3)(),m=(0,n.useCallback)((()=>zs(u)),[u]),g=(0,n.useCallback)((e=>Es(e,t,i,c,p)),[t,i,c,p]),{device:S}=p,h=(0,d().K8)((()=>{var e;return null===(e=Vs(i,t))||void 0===e?void 0:e.state}),[i,t]),f=(0,d().K8)((()=>{var e;return null===(e=Fs(i,t))||void 0===e?void 0:e.state}),[i,t]),y=(0,d().K8)((()=>O().default.isSidePeekOpen()),[]);return h&&f?0===f.length?(0,E.jsx)(Pi().A,{children:(0,E.jsx)(ws().A,{title:(0,E.jsx)(pt().sA,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,E.jsx)("div",{style:{padding:S.isMobile?"8px 16px":"6px 14px 8px"},children:(0,E.jsx)(Hn,{collectionContextStore:i,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:g,disableRequest:!0,resultProps:{format:r,schema:l,disabled:o,coverFormat:_s(r),coverAspectFormat:Ps(r),coverSizeFormat:Bs(r),colorStyle:void 0,blockPropertyValueOverlayStore:s,onTextEnter:e=>function(e,t,o,n,r){const i=Fs(t,n);if(!i)return;if(!(0,Xe().EF)(r)||!t.collectionStore())return Ds(e,t,n,r);const l=i.state.findIndex((t=>t===e))+1;A().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,canUndo:!0,perform:e=>{er({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[n],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})}})}(e,i,c,t,p),onTextEsc:e=>Ds(e,i,t,p),onShiftEnter:e=>Es(e,t,i,c,p),collectionContextStore:i},resultComponent:Zr,handleOpenPeekPage:y?void 0:m,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:zn.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,E.jsx)(Pi().A,{children:(0,E.jsx)(ws().A,{title:(0,E.jsx)(ur().A,{})})})}const Hs=Ts,Ws=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disabled:r,disableBoardColorColumns:i,hiddenGroups:l,store:s,format:c,query:u,schema:p,isFullScreen:m,blockPropertyValueOverlayStore:g,columnsDisplayStateForCurrentGroups:S,hoveredGroupStore:h}=e,f=(0,a().v3)(),y=(0,a().Y0)(),v=(0,Be().bx)(s,r),x=(0,d().K8)((()=>v&&!y.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent),[v,o,y]),b=(0,n.useMemo)((()=>l.slice(0,Vo().RP)),[l]),C=(0,n.useMemo)((()=>b.map((e=>(0,Mo().Ix)(e)))),[b]),w=(0,d().O$)(o.permissionScopesStore),k=(0,n.useCallback)((e=>{if(c.board_columns_by)return(0,E.jsx)(Hs,{query:u,schema:p,format:c,groupFormat:e,groupBy:c.board_columns_by,currentGroups:S,collectionContextStore:o,disabled:r||!v||!w.canEditContent&&"collectionTypedView"!==o.contextType,blockPropertyValueOverlayStore:g,isFullScreen:m,hoveredGroupStore:h},(0,Mo().Ix)(e))}),[g,v,o,S,r,c,h,m,w.canEditContent,u,p]),I=(0,n.useCallback)(((e,t)=>k(b[t])),[b,k]),A=(0,n.useCallback)((e=>(0,$a().r)({environment:f,collectionContextStore:o,isHidden:!0,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:S,newGroupIds:e})),[o,S,f]),j=(0,d().K8)((()=>fs(o,i)),[o,i]);return(0,E.jsx)("div",{style:j,ref:t,children:b.length>0&&(x?(0,E.jsx)(Ka().Ay,{direction:"vertical",keys:C,renderKey:I,onDrop:A}):(0,E.jsx)("div",{children:b.map(k)}))})})));const Gs=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disableBoardColorColumns:n,columnsDisplayState:r,disabled:i}=e,l=(0,d().K8)((()=>fs(o,n)),[o,n]),a=r.pinnedGroups;return(0,E.jsx)("div",{ref:t,style:l,children:a.groups.map((e=>{const t=(0,Mo().Ix)(e),n=a.aggregations[t]??0;return(0,E.jsx)(Ns,{groupFormat:e,count:n,collectionContextStore:o,columnsDisplayState:r,disabled:i},(0,Mo().Ix)(e))}))})})));function Ns(e){const{groupFormat:t,collectionContextStore:r,columnsDisplayState:i,disabled:l}=e,s=(0,a().v3)(),c=(0,pt().tz)(),u=n.useRef(null),p=(0,d().O$)(r.normalizedFormatStore),m=(0,d().O$)(r.normalizedSchemaStore),g=(0,d().O$)(r.temporaryStateStore),[S,h]=n.useState(!1),f=(0,d().K8)((()=>{const e=r.collectionViewBlockStore();return e?new(ae().Bv)(s,{table:z().ev,id:e.id}):null}),[s,r]),{value:y}=(0,le().fJ)(ne().VI.duplicateActions),v=n.useCallback((async e=>{const{droppedStores:t,duplicate:o,groupFormat:n}=e,i=u.current;if(!i)return;if(!(i instanceof Element))return;const l=await ve().T.formulas.load();A().createAndCommit({userAction:"BoardPinnedGroup.handleDrop",environment:s,canUndo:!0,perform:e=>hn({environment:s,collectionContextStore:r,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l,duplicateActions:y})})}),[r,y,s]),x=n.useCallback((()=>{(0,ki().m)({environment:s,collectionContextStore:r,groupsFormatKey:"board_columns",groupFormat:t,currentGroups:i.currentGroups,action:"toggle_group_pin"})}),[s,r,t,i]),b=p.board_columns_by,C=n.useMemo((()=>b?(0,E.jsx)(al().d,{collectionContextStore:r,currentGroups:i.currentGroups,groupBy:b,groupFormat:t,schema:m,disabled:!0,isHiddenGroup:!1,style:{fontSize:14,cursor:"inherit"}}):null),[r,i.currentGroups,b,t,m]);if(!b)return null;if(!f)return null;const w={onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)};return(0,E.jsx)("div",{ref:u,children:(0,E.jsxs)(lt().A,{analyticsName:"board_pinned_group",store:f,canDropOnto:!l,shouldShowDropZone:!0,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,onSelectableDrop:async e=>{await v({...e,groupFormat:t})},style:{display:"flex",alignItems:"center",paddingTop:2,paddingBottom:2},children:[(0,E.jsxs)(dr().p,{onClick:()=>{(0,o(912468).d)({collectionContextStore:r,environment:s,groupFormat:t,groupBy:b,temporaryViewState:g,title:C})},hoveredStyle:{cursor:"pointer"},children:[C,(0,E.jsx)("span",{style:{opacity:.5,fontSize:14,marginLeft:8},children:(0,o(361308).ZV)(e.count,"number",c,"compact")})]}),l?null:(0,E.jsx)(jt().A,{renderTooltip:e=>(0,E.jsx)(pt().sA,{...e,...Vo().K0.unpinGroup}),render:e=>(0,E.jsx)(At().A,{...(0,Hi().A)(e,w),ariaLabel:c.formatMessage(Vo().K0.unpinGroup),icon:S?o(988360).N:o(40516).S,iconStyle:{width:16,height:16},onClick:x})})]})},(0,Mo().Ix)(t))}const $s=n.memo((function(e){let{args:t,collectionContextStore:o,isInPeekRenderer:n,format:r,setSubgroupsMounted:i,columnsDisplayStateStore:l}=e;const a=(0,d().O$)(o.isInHomeWidgetStore),s=(0,d().K8)((()=>function(e,t){return t.state.visibleGroups.length*(Fl(e)+2*ka+2*Ca)}(r,l)),[r,l]),{stickyStyle:c}=(0,u().IS)((e=>a?{stickyStyle:{}}:{stickyStyle:{background:n?e.cardContentBackground:e.contentBackground,boxShadow:`0 1px 0 ${n?e.cardContentBackground:e.contentBackground}`}}),[a,n]);return(0,E.jsx)(dl,{...t,height:a?yt().ag:36,stickyStyle:c,style:{...t.style,minWidth:s},onMount:i})})),Us=p().default.createClass(void 0,{name:"GroupsReducerResultStore"}),qs=p().default.createClass(void 0,{name:"HoveredGroupStore"}),Xs=n.memo((function(e){const{store:t,format:r,schema:i,collectionContextStore:s,isFullScreen:c,isPreviewing:p,paddingLeft:m,paddingRight:g,paddingBottom:S,disabled:h,query:y,blockPropertyValueOverlayStore:v,isInPeekRenderer:b,isRootChild:C}=e,k=(0,a().v3)(),{isMobile:I}=(0,a().Y0)(),j=(0,u().DP)(),R=(0,pt().tz)(),T=(0,L().X)("collection_group_reducer_visible"),_=(0,n.useRef)(null),P=(0,n.useRef)(null),B=(0,n.useRef)(0),V=(0,n.useRef)(null),F=(0,d().uB)(void 0,Us),O=(0,d().O$)(F),D=(0,d().uB)(void 0,qs),[z,K]=(0,n.useState)(!1),H=(0,d().r6)((()=>{var e,t;const o=s.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[s],{useDeepEqual:!0}),{collectionStore:W,collectionViewStore:G,collectionViewBlockStore:N}=(0,d().K8)((()=>({collectionStore:s.collectionStore(),collectionViewStore:s.collectionViewStore(),collectionViewBlockStore:s.collectionViewBlockStore()})),[s]),$=(0,d().K8)((()=>"collectionTypedView"===s.contextType),[s]),U=(0,d().K8)((()=>s.permissionScopesStore.state),[s]),q=(0,d().K8)((()=>{const e=r.board_columns_by;if(e)return(0,Mo().oH)({schema:i,groupBy:e})}),[r.board_columns_by,i],{useDeepEqual:!0}),X=(0,d().O$)(s.boardColumnsLimitStore),Y=(0,d().K8)((()=>!Boolean((0,Vo().$e)({environment:k,groupFormat:void 0,schema:i,format:r,theme:j}))),[k,r,i,j]),[Q,Z]=(0,vl().d)({collectionContextStore:s,groupBy:r.board_columns_by,groupsFormatKey:"board_columns",reducerResult:O,groupsLimit:X}),J=(0,d().K8)((()=>{const{visibleGroups:e}=Q,t=r.collection_group_by,o=F.state;if("v2"===(null==o?void 0:o.version))return s.groupsStore.anyGroupHasResults();const n=void 0!==N?(0,Vo().ck)({groupBy:t,schema:i,formatGroups:r.collection_groups||[],schemaGroups:q,reducerResults:null==o?void 0:o.results,getRecordModel:N.getRecordModel,getRecordRole:N.getRecordRole,relativeVariableResult:s.relativeVariableStore.state,viewAppConfigUri:null==G?void 0:G.getFormat().app_config_uri,allowedCollectionStores:s.collectionStoresStore.state}):[];if(0===n.length){if(void 0!==t)return!1;for(const t of e){const e=s.groupsStore.getGroupState(t);if(null!=e&&e.reducerResultStore.state)return!0}}else for(const r of n)for(const t of e){const e=[r,t],o=s.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}return!1}),[s,N,G,Q,r,F,i,q]),ee=(0,d().K8)((()=>{var e;const t=r.board_columns_by;if(!t)return;const o=r.collection_group_by?{groupBy:r.collection_group_by,groupsFormatKey:"collection_groups",limit:s.groupsLimitStore.state,subGroupAggregation:r.collection_group_aggregation}:void 0,n=(0,yl().m)({collectionContextStore:s,isMobile:I,groupBy:t,subGroupBy:r.collection_group_by});return(0,yl().p)({groupBy:t,schema:i,format:r,groupsFormatKey:"board_columns",limit:s.boardColumnsLimitStore.state,aggregation:null===(e=y.aggregations)||void 0===e?void 0:e.at(0),returnPinnedGroups:!0,subGroupArgs:o,blockResults:n})}),[s,r,I,y.aggregations,i]),te=(0,Be().bx)(t,h),oe=(0,n.useMemo)((()=>te&&($||U.canEditContent)),[te,U.canEditContent,$]),ne=(0,n.useCallback)((()=>{W&&W.isDefined()&&G&&U.canConfigureBlock&&A().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:k,canUndo:!0,perform:e=>{let t,o=M().In(i);if(!o&&U.canConfigureCollection){o=(0,Po().Ay)();t={[o]:{name:R.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!o)return;const n=(t||i)[o];n&&(0,Mo().Eg)(n)&&(Eo().zA({stores:[G],update:{board_columns_by:(0,Mo().V0)({property:o,propertySchema:n,isCollectionTypedView:$})},transaction:e}),Do().zv({store:G,data:{type:"board"},transaction:e}),t&&(0,Ho().F)({environment:k,collectionStore:W,update:t,transaction:e}))}})}),[W,G,k,R,$,U.canConfigureBlock,U.canConfigureCollection,i]);(0,n.useEffect)((()=>{W&&(!r.board_columns_by&&t.isDefined()&&W.isDefined()&&ne(),l().default.afterNextFlush((()=>{if(!P.current||!_.current)return;let e=0;if(_.current){const t=P.current.getBoundingClientRect().left;e=_.current.getBoundingClientRect().left-t+8}const t=e+B.current;B.current=t,P.current.style.left=`${t}px`})))}),[s,W,k,r.board_columns_by,R,i,t,ne]);const re=(0,n.useCallback)((()=>{const e=Z.state.currentGroups;Oo({environment:k,groupsFormatKey:"board_columns",collectionContextStore:s,currentGroups:e})}),[k,s,Z]),ie=(0,n.useMemo)((()=>f().sg(re,5e3)),[re]);(0,n.useEffect)((()=>(Z.addListener(ie),()=>{Z.removeListener(ie),ie.cancel()})),[Z,ie]),(0,n.useEffect)((()=>{const e=()=>K(!1);return H.addListener(e),()=>H.removeListener(e)}),[H]);const le=(0,n.useCallback)((()=>D.setState(void 0)),[D]),ae=(0,n.useCallback)((e=>{const o=Q.visibleGroups;return(0,E.jsx)("div",{style:Ka().Z0,children:o.map(((n,l)=>{const a=l===o.length-1,d=e?[e,n]:[n],u=0!==Q.hiddenGroups.length;return s.groupsStore.getGroupState(d)?(0,E.jsx)(ja,{store:t,hoveredGroupStore:D,query:y,schema:i,format:r,groupsPointer:d,collectionContextStore:s,isFullScreen:c,isInPeekRenderer:b,disabled:h||!oe,isLast:a&&!u,blockPropertyValueOverlayStore:v,anyGroupHasResults:J},(0,Mo().Hm)(d)):null}))})}),[J,v,oe,s,Q.hiddenGroups.length,Q.visibleGroups,h,r,D,c,b,y,i,t]),se=(0,n.useCallback)((()=>{K(!0)}),[K]),ce=(0,n.useCallback)((e=>(0,E.jsx)($s,{collectionContextStore:s,isInPeekRenderer:b,format:r,setSubgroupsMounted:se,columnsDisplayStateStore:Z,args:e})),[s,Z,r,b,se]),de=(0,n.useCallback)((e=>{I?zo().uK({environment:k,store:e,pageVisitSource:To().y8.Create}):Ko().VU({environment:k,store:e,peekMode:M().hH(s),showMoveTo:$,resultsStore:void 0,collectionContextStore:s,pageVisitSource:To().y8.Create})}),[s,k,$,I]),ue=J,pe=z,me=(0,d().O$)(s.shouldShowSpinnerStore)&&!pe&&!ue,ge=(0,d().O$)(s.isInHomeWidgetStore),Se=(0,d().K8)((()=>Boolean(s.viewsModuleContextStore.getViewModuleType())),[s]),{visibleGroups:he,hiddenGroups:ye}=Q,ve=(0,d().K8)((()=>"v2"===Q.version?r.board_columns||[]:Q.currentGroups),[Q.currentGroups,Q.version,r.board_columns]),xe=r.collection_group_by,be=c?480:ge?220:360,Ce=Ia+Aa(Y,ge),ke=(0,n.useMemo)((()=>me?null:"v2"===Q.version?Q.pinnedGroups.groups.length>0?(0,E.jsx)(Gs,{ref:P,collectionContextStore:s,disableBoardColorColumns:Y,columnsDisplayState:Q,disabled:h}):(0,E.jsx)(Yt().A,{size:64}):ye.length>0?(0,E.jsx)(Ws,{ref:P,collectionContextStore:s,store:t,disabled:h,hiddenGroups:ye,disableBoardColorColumns:Y,format:r,schema:i,query:y,blockPropertyValueOverlayStore:v,isFullScreen:c,columnsDisplayStateForCurrentGroups:Q.currentGroups,hoveredGroupStore:D}):null),[v,s,Q,Y,me,h,r,ye,D,c,y,i,t]),Ie=(0,fe().Zp)(),Ae=(0,n.useCallback)((e=>{const{target:t}=e;!I&&0===e.button&&t instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),w().jD({environment:k,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[k,I]),je=(0,n.useCallback)((()=>{x().R8({collectionSettingsStore:s.settingsStore,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}),[s]),Re=(0,n.useCallback)((e=>({marginTop:4,...e.isLast&&{paddingBottom:12}})),[]),Me=(0,u().IS)((()=>({container:{marginLeft:m,marginRight:g,float:"left",paddingBottom:Ce},selectable:{display:"flex",position:"relative",flexGrow:1,paddingBottom:S},spacer:{width:90,marginLeft:Ca,marginRight:Ca,pointerEvents:"none"},addGroupButtonSpacer:{width:35,marginLeft:Ca,marginRight:Ca,pointerEvents:"none"},groupsWrapper:{display:"flex",flexDirection:"column",position:"relative",top:Ce}})),[Ce,S,m,g]),_e=(0,n.useCallback)((()=>!me&&T&&"v2"===Q.version&&0===Q.visibleGroups.length&&0===Q.pinnedGroups.groups.length?(0,E.jsx)(Yl,{className:we().okd,onClick:je,icon:_o().e,title:(0,E.jsx)(pt().sA,{id:"board.emptyState.button",defaultMessage:"All groups are hidden"})}):(0,ei().A)((e=>(0,E.jsx)("div",{className:we().okd,style:Me.container,...e,ref:V,children:(0,E.jsx)(Pl,{nodeRef:V,children:(0,E.jsxs)(lt().A,{style:Me.selectable,store:t,shouldShowHalo:!c&&!ge&&!p,canSelect:!c&&!Se,disablePointerEvents:null==Ie?void 0:Ie.disableAllPointerEvents,onMouseDown:Ae,analyticsName:"board",onMouseLeave:le,children:[me&&ge?null:(0,E.jsx)(ys,{collectionContextStore:s,columnsDisplayState:Q,currentGroups:ve,disableBoardColorColumns:Y,disabled:h,groupsResultStore:F,format:r,headerPlaceholderHeight:Ce,hiddenGroups:ye,hiddenGroupsHeaderRef:P,hoveredGroupStore:D,isFullScreen:c,isInPeekRenderer:b,isRootChild:C,paddingLeft:m,paddingRight:g,query:y,schema:i,store:t,visibleGroups:he,shouldShowShimmer:me}),me?(0,E.jsx)(Na,{height:be,numBoardColumns:he.length,boardCoverSize:r.board_cover_size,areColumnsColored:!Y,showGroupHeader:0===he.length}):null,he.length>0?(0,E.jsx)("div",{style:Me.groupsWrapper,children:xe?(0,E.jsx)(ca,{reducerId:o(963016).bq,store:t,groupsResultStore:T?F:void 0,collectionContextStore:s,disabled:h,isFullScreen:c,isRootChild:C,paddingLeft:m,stickyLeft:!I,renderGroup:ae,getGroupStyle:Re,renderHeader:ce,onGroupHeaderAddItem:de,onClickEmptyStateButton:je}):ae(void 0)}):null,(0,Vo().Zl)(Q,s,!0)?(0,E.jsx)("div",{style:Me.spacer}):null,Ss(Q,r,s)?(0,E.jsx)("div",{style:Me.addGroupButtonSpacer}):null,ke]})})})))),[he,ye,ve,xe,Me.container,Me.selectable,Me.groupsWrapper,Me.spacer,Me.addGroupButtonSpacer,t,c,ge,p,Se,null==Ie?void 0:Ie.disableAllPointerEvents,Ae,le,me,s,Q,Y,h,F,r,Ce,D,b,C,m,g,y,i,be,T,I,ae,Re,ce,de,je,ke]);return r.board_columns_by?(0,E.jsx)(Ha,{collectionContextStore:s,groupsResultStore:F,groupsReducer:ee,render:_e}):(0,E.jsx)(Ga,{collectionContextStore:s,isFullScreen:c,paddingLeft:m,paddingRight:g,paddingBottom:S})}));var Ys=()=>o(16456),Qs=()=>o(791503),Zs=()=>o(286555),Js=()=>o(865011),ec=()=>o(840038),tc=()=>o(265516),oc=()=>o(871002);function nc(e){const{blockPropertyValueOverlayStore:t,calendarBy:r,calendarViewRange:i,canEditCalendar:l,collectionContextStore:a,columnIndex:s,currentlyViewedMonth:c,endOfDay:d,format:p,items:m,query:g,sortedResultsStore:S,schema:h,shouldShowShimmer:f,startOfDay:y}=e,v=(0,Ys().vY)({firstDate:y,secondDate:c}),x=(0,Ys().c_)(y),b=!v&&!x&&"week"!==i,C=(0,u().IS)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:b?e.text.tertiary:x?e.white:void 0,...x?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:or().Ay.red,marginLeft:"auto",marginRight:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}})),[x,b]),w=(0,n.useMemo)((()=>m.find((e=>(0,oc().m6)(y,d,e.start,e.end?e.end:void 0)))),[m,y,d]),k=(0,Ys().wN)(y),I=(0,n.useCallback)((e=>(0,E.jsxs)(It().A,{style:C.button,...e,children:[(0,E.jsx)("div",{style:C.dayNumber,className:f?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${s}`:"notion-shimmer-calendar-transition",children:k}),w&&(0,E.jsx)("div",{style:C.eventDot})]})),[C,f,s,k,w]),A=(0,n.useCallback)((e=>(0,E.jsx)(o(578269).iq,{collectionContextStore:a,initialStartOfDay:y,format:p,schema:h,query:g,calendarBy:r,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:S})),[a,y,p,h,g,r,l,t,S]);return(0,E.jsx)(qi().Ay,{popupType:qi().z7.SlideUp,renderOrigin:I,render:A},k.toString())}const rc=(0,n.memo)(nc);function ic(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:r,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:a,format:s,items:c,query:d,sortedResultsStore:p,schema:m,shouldShowShimmer:g,showWeekends:S,startOfWeek:h}=e,f=(0,u().IS)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),y=S?7:5,v=(0,n.useMemo)((()=>[...Array(y).keys()].map((e=>{const t=(0,Ys().K1)({date:h,daysToAdd:e});return{startOfDay:t,endOfDay:(0,Ys().P9)(t)}}))),[y,h]);return(0,E.jsx)("div",{style:f.container,children:v.map(((e,n)=>(0,E.jsx)(rc,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:n,currentlyViewedMonth:a,endOfDay:e.endOfDay,format:s,items:c,query:d,sortedResultsStore:p,schema:m,shouldShowShimmer:g,startOfDay:e.startOfDay,calendarViewRange:r},e.startOfDay.toString())))},h.toString())}const lc=(0,n.memo)(ic);var ac=()=>o(401548),sc=()=>o(898719);const cc=30,dc=(0,pt().YK)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function uc(e){const{blockStore:t,calendarStore:r,collectionContextStore:i,columnIndex:l,startOfDay:s,canEditCalendar:c,isInHomeWidget:p,isInPeekRenderer:m,isTypedMsvCollection:g,currentlyViewedMonth:S,calendarBy:h,propertySchema:f,calendarViewRange:y,shouldShowShimmer:v}=e,x=(0,a().v3)(),b=(0,pt().tz)(),w=(0,n.useContext)(ri().n),k=(0,Nr().BG)(),{mainEditorCurrentBlockStore:I}=(0,d().O$)(bt().default),j=(0,d().K8)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:R,isDragging:T,hoveredDay:_}=(0,d().K8)((()=>({dayStoreMap:r.state.dayStoreMap,isDragging:r.state.isDragging,hoveredDay:r.state.isDragging?void 0:r.state.hoveredDay})),[r]),{pointer:P,userId:B,inMemoryRecordCache:V}=(0,d().K8)((()=>t),[t]),F=(0,n.useMemo)((()=>{const e=R.get(s);if(e)return e;const t=new(o(638907).B)(x,P,{userId:B,inMemoryRecordCache:V});return R.set(s,t),t}),[R,x,V,P,s,B]),L=(0,Ys().vY)({firstDate:s,secondDate:S}),O=(0,Ys().c_)(s),D=(0,Ys().sm)(s),z="date"===f.type,K=!L&&!O&&"week"!==y,H=!T&&_===s&&(z||O)&&j&&c,W=(0,n.useMemo)((()=>1!==(0,Ys().wN)(s)||O?(0,Ys().wN)(s):`${new Intl.DateTimeFormat(b.locale,{month:"short",day:"numeric"}).format(new Date(s))} `),[b.locale,O,s]),G=(0,n.useCallback)((e=>{w?w(e):yr().oo({environment:x,url:e})}),[x,w]),N=(0,n.useCallback)((()=>{const{performResult:e}=A().createAndCommit({userAction:"Calendar.createBlockInDay",environment:x,canUndo:!0,perform:e=>{const t=(0,Qn().Q)({environment:x,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:x.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(h))??h;sc().D5({type:"timestamp",environment:x,store:t.newStore,propertyId:n,timestampMs:s,transaction:e});const r=M().wy({environment:x,store:t.newStore,mainEditorCurrentBlockStore:I,collectionContextStore:i,showMoveTo:g})??(0,kr().Ay)({store:t.newStore,pageVisitSource:To().y8.Create});return G(r),C().Ey({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[h,i,x,g,I,G,s]),$=(0,n.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(h))??h;if(sc().D5({type:"timestamp",environment:x,store:t,propertyId:i,timestampMs:s,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Qo().P)(),intl:b,isWorkflowsAppContainerEnabled:k}))||"",a=r.length>53?`${r.slice(0,50)}…`:r;o(575015).rL({item:{label:b.formatMessage(dc.linkExistingCompleteToast,{pageTitle:a,numUpdates:e})},undoFunc:()=>{}})}}),[h,x,s,b,k]),{value:U}=(0,le().fJ)(ne().VI.duplicateActions),q=(0,n.useCallback)((e=>{A().createAndCommit({userAction:"Calendar.renderDay",environment:x,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:x,getData:()=>ke().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),sc().M9({...e,environment:x,startOfDay:s,calendarBy:h,collectionStore:o,collectionContextStore:i,transaction:t,duplicateActions:U})}})}),[h,i,U,x,s]),X=(0,n.useCallback)((()=>{if(c&&(0,Xe().EF)(x)&&j){const e=N();An().v(x,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,ke().sl)(i)})}}),[c,x,j,N,i]),Y=(0,u().IS)((e=>{const t=(()=>{if(D)return p?(0,ac().X4)(e.tableHomeDividerColor,.05):m?e.cardSidebarBackground:e.surface.wash})(),o=K?e.text.tertiary:O?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...O?{right:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{right:10,textAlign:"right",transition:"color 100ms ease-out"}}}}),[p,m,O,D,K]),Q=(0,fe().Zp)();return(0,E.jsxs)(lt().A,{style:Y.selectable,store:F,canDropOnto:c&&z,onSelectableDrop:q,onDoubleClick:X,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[H&&!(null!=Q&&Q.disablePageLinks)&&(0,E.jsx)(pc,{collectionContextStore:i,createBlockFunc:N,updateBlockDayProperty:$}),(0,E.jsx)("div",{style:Y.dayNumber,className:v?`${we().yWO} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${we().yWO} notion-shimmer-calendar-transition`,children:W})]},s.toString())}function pc(e){let{collectionContextStore:t,createBlockFunc:o,updateBlockDayProperty:r}=e;const i=(0,a().v3)(),l=(0,pt().tz)(),s=(0,d().K8)((()=>M().fG({collectionContextStore:t,environment:i,intl:l})),[t,i,l]),c=(0,n.useCallback)((()=>{if((0,Xe().EF)(i)){const e=o();An().v(i,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,ke().sl)(t)})}else(0,Xe().QY)(i)}),[i,o,t]),p=(0,u().IS)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,left:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.shadowMD},iconButton:{width:20,height:20}})),[]),m=(0,n.useCallback)(((e,t)=>(0,E.jsx)(At().A,{ariaLabel:l.formatMessage(dc.addItemLabel),icon:Gt().W,style:p.iconButton,onClick:c,...(0,Hi().A)(e,{onMouseDown:Te().tr})})),[c,l,p.iconButton]);return(0,E.jsxs)("div",{style:p.iconToolbar,children:[(0,E.jsx)(jt().A,{renderTooltip:()=>l.formatMessage(dc.addItemLabel),render:m}),s?(0,E.jsx)(jt().A,{renderTooltip:()=>l.formatMessage(dc.linkExistingLabel),render:e=>(0,E.jsx)(gr().O,{collectionContextStore:t,renderLinkButton:t=>(0,E.jsx)(At().A,{ariaLabel:l.formatMessage(dc.linkExistingLabel),icon:mr().arrowDiagonalUpRightIcon,style:p.iconButton,...t,...(0,Hi().A)(e,{onMouseDown:Te().tr})}),onAddOrLink:r})}):null]})}const mc=(0,n.memo)(uc);var gc=()=>o(846581),Sc=()=>o(342943),hc=()=>o(928567),fc=()=>o(709237),yc=()=>o(708920),vc=()=>o(640862);const xc=2,bc=3;function Cc(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:i}=e,l=(0,a().v3)(),s=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=bt().default.state;return M().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:l,store:o,collectionContextStore:r});e&&(i(),yr().oo({environment:l,url:e}))}),[r,l,i,o]),u=(0,n.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>s.current,getBlockStore:()=>o,activate:c})),[c,o]);(0,d().K8)((()=>{r.onItemMount(o)}),[r,o]);const p=(0,E.jsx)("div",{ref:s,children:(0,E.jsx)(kc,{...e})});return(0,Be().NW)(o,t,u,p)}const wc=n.forwardRef(Cc);function kc(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:s,collectionContextStore:c,includeTime:u,handleOpenPeekPage:p,blockPropertyValueOverlayStore:m,calendarStore:g}=e,S=(0,a().v3)(),{value:h}=(0,le().fJ)(ve().T.formulas),y=n[l],v=(0,d().K8)((()=>!i&&"date"===(null==y?void 0:y.type)&&!c.permissionScopesStore.state.isSyncedCollection),[c.permissionScopesStore,i,null==y?void 0:y.type]),{start:x,end:b,startOfWeek:C,endOfWeek:w,startColumn:k,columnCount:I}=(0,yc().Gj)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),A=(0,d().K8)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,ir().T)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:S.currentUser.id,userTimeZone:(0,Qo().P)(),intl:xt().A.getIntl(),experimentService:Fo().default,collectionFeatureGates:(0,tn().i)(),formulasModule:h})));return o.concat(f().R9(e,o))}),[S.currentUser.id,r.calendar_properties,n,t,h]),j=(0,d().K8)((()=>(0,re().jz)({collectionContextStore:c})),[c]);if(!y||!Wo().$L(y))return null;const R=A.length+(j?1:0),T=x<C,M=void 0!==b&&b>w;return(0,E.jsxs)(Ic,{store:t,row:o,numRows:R,columnCount:I,startIsBeforeStartOfWeek:T,endIsAfterEndOfWeek:M,startColumn:k,disabled:i,isEditableDate:v,calendarBy:l,showWeekends:s,handleOpenPeekPage:p,children:[j&&(0,E.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,E.jsx)(br().n,{blockStore:t,collectionContextStore:c})}),(0,E.jsx)(Tc,{store:t,collectionContextStore:c,disabled:i,start:x,startOfWeek:C,end:b,endOfWeek:w,includeTime:u,propertySchema:y}),(0,E.jsx)(_c,{store:t,sortedProperties:A,startIsBeforeStartOfWeek:T,disabled:i,blockPropertyValueOverlayStore:m}),v&&(0,E.jsx)(Pc,{store:t,start:x,startOfWeek:C,end:b,endOfWeek:w,calendarBy:l,calendarStore:g})]})}function Ic(e){const{store:t,children:o,columnCount:r,row:i,numRows:l,startColumn:s,disabled:c,isEditableDate:p,calendarBy:m,showWeekends:g,handleOpenPeekPage:S,startIsBeforeStartOfWeek:h,endIsAfterEndOfWeek:f}=e,y=(0,a().v3)(),v=(0,ee().ET)(),x=(0,fe().Zp)(),b=(0,d().K8)((()=>M().NM(t)),[t]),C=(0,d().K8)((()=>(0,kn().W)(y,t.id)),[y,t.id]),w=Rc(l,(0,d().K8)((()=>{var e;return null===(e=v.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[v])),k=cc+w*i,I=(0,d().uB)(void 0,vc().A),A=(0,d().K8)((()=>He().A.state?!0===I.state.dragging:In().A.state.hoveredStore===t),[t,I]),j=g?7:5,R=(0,u().IS)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:h?0:6,paddingRight:f?0:6,width:f?`calc(100% / ${j} * ${r} - 1px)`:`calc(100% / ${j} * ${r})`,left:`calc(100% / ${j} * ${s})`,height:w,top:k},haloStyle:{...M().wh(e,b),borderRadius:6,marginTop:2,marginBottom:2,marginLeft:h?0:5,marginRight:f?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:6,borderTopRightRadius:6,borderBottomLeftRadius:6,borderBottomRightRadius:6,boxShadow:e.shadowSM,...f&&{borderTopRightRadius:0,borderBottomRightRadius:0},...h&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},...C&&{opacity:.5}},linkBoxHoveredStyle:{opacity:C?.5:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,f,w,j,b,s,h,k,C]),T=(0,n.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?sc().jo({environment:y,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:m,transaction:e.transaction}):[]}),[m,v,y,t]),_=(0,n.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&St().by({childStore:t,transaction:o})}),[t]),[P,B]=(0,d().K8)((()=>{const{mainEditorCurrentBlockStore:e}=bt().default.state,o=M().wy({environment:y,store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,kr().Ay)({store:t,fullyQualified:!1,pageVisitSource:To().y8.LinkInPage}),o]}),[y,v,t]),V=(0,d().O$)(v.isInHomeWidgetStore);return(0,E.jsx)(lt().A,{store:t,style:R.selectable,canSelect:!c,shouldShowHalo:!(V||null!=x&&x.isPreviewing),shouldForceRenderSelectionHalo:b,haloStyle:R.haloStyle,canTriggerContextMenu:!c,showBlockMenuInput:!0,canDrag:p,onInsertAbove:T,onInsertBelow:T,onRemove:_,canInsertAbove:p,canInsertBelow:p,analyticsName:"calendar",shouldShowDropZone:!0,className:we().E4t,draggableStore:I,children:(0,E.jsx)(wr().A,{style:R.linkBoxStyle,hoveredStyle:R.linkBoxHoveredStyle,pressedStyle:R.linkBoxHoveredStyle,innerStyle:R.linkBoxInnerStyle,onClick:S,href:P,metaHref:B,hovered:A,disableForOffline:C,children:o})},t.id)}const Ac=24,jc=36;function Rc(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?jc:Ac)+e*Sc().CL+2*xc+2*bc}function Tc(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:s,end:c,endOfWeek:p,includeTime:m,propertySchema:g}=e,S=(0,a().v3)(),h=l<s,f=c&&c>p,y=(0,d().K8)((()=>(0,re().Kk)({collectionContextStore:o,blockStore:t})),[o,t]),v="time_format"in g?g.time_format:oc().CE,[x,b,C]=(0,d().K8)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),w=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&A().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:S,canUndo:!0,perform:t=>{Do().KY({store:o,value:e,transaction:t})}})}),[S,t]),k=(0,d().K8)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),I=(0,u().IS)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...h&&{paddingLeft:12},...f&&{paddingRight:11},width:"100%",...k?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:jc,paddingTop:2}:{height:Ac,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:Ro().Wy.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:k?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:k?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:k?2:4},timeStyle:{color:e.text.secondary,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:k?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[f,h,k]),j=m&&c&&r().IX.fromDateTimes(s,p).contains(c)&&l.day!==c.day,R=(0,d().K8)((()=>o.shouldShowPageIcon()&&(void 0!==x||!b)&&!C),[o,x,b,C]);return(0,E.jsxs)("div",{style:I.titleContainer,children:[R&&(i?(0,E.jsx)(Gr().B,{disabled:!0,icon:x,isEmptyPage:b,size:14,style:I.recordIconStyle}):(0,E.jsx)(Gr().B,{disabled:!1,store:t,bucket:"secure",icon:x,isEmptyPage:b,size:14,style:I.recordIconStyle,onChange:w})),C&&(0,Wr().Q)(I.iconWarningStyle),(0,E.jsx)(Mc,{store:t,titlePropertyIsWrapped:k}),y&&(0,E.jsx)("div",{style:I.subitemCountIndicatorContainer,children:(0,E.jsx)(Cr().W,{blockStore:t,collectionContextStore:o,wrapperStyle:I.subitemsWrapperStyle})}),m&&r().IX.fromDateTimes(s,p).contains(l)&&(0,E.jsxs)("div",{style:I.timeStyle,children:[(0,gc().PS)({dateTime:l,humanReadable:!1,timeFormat:v}),j&&(0,E.jsxs)("span",{children:[" → ",(0,gc().PS)({dateTime:c,humanReadable:!1,timeFormat:v})]})]}),(0,E.jsx)(fc().A,{store:t,shouldWrap:k})]})}function Mc(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,u().IS)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.text.tertiary,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,E.jsx)(vr().g,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function _c(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,ee().ET)(),a=(0,d().K8)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[s,c]=(0,d().K8)((()=>[M().Dj({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return s?(0,E.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,E.jsx)(zr().BlockPropertyRouter,{store:t,property:e,disabled:r,locked:a,format:"calendar",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:s,collectionViewStore:c},e)))}):null}function Pc(e){const{store:t,calendarStore:o,start:r,startOfWeek:i,end:l,endOfWeek:s,calendarBy:c}=e,d=(0,a().v3)(),p=(0,u().IS)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),m=(0,n.useCallback)((e=>{sc().GB({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:c})}),[o,c]),g=(0,n.useCallback)((()=>{A().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:d,canUndo:!0,perform:e=>{sc().eW({environment:d,transaction:e,calendarStore:o,calendarBy:c})}})}),[c,o,d]),S=(0,n.useCallback)((()=>{sc().Pt({calendarStore:o})}),[o]),h=r>=i&&(0,E.jsx)(hc().A,{render:e=>(0,E.jsx)("div",{style:p.leftDragHandle,...e}),onDraggableDragStart:()=>{sc().v7({calendarStore:o,targetStore:t,direction:tc().Q.Left})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:S}),f=(!l||l&&l<s)&&(0,E.jsx)(hc().A,{render:e=>(0,E.jsx)("div",{style:p.rightDragHandle,...e}),onDraggableDragStart:e=>{sc().v7({calendarStore:o,targetStore:t,direction:tc().Q.Right})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:S});return(0,E.jsxs)(E.Fragment,{children:[h,f]})}function Bc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:r,calendarStore:i,calendarViewRange:l,canEditCalendar:s,collectionContextStore:c,collectionViewStore:p,currentlyViewedMonth:m,endOfWeek:g,format:S,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,items:v,propertySchema:x,schema:b,shouldShowShimmer:w,showWeekends:k,sortedResultsStore:I,startOfWeek:A}=e,j=(0,a().v3)(),{isDragging:R,targetStore:T,temporaryValue:M}=(0,d().K8)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:_,targetStoreCollectionStoreCalendarBy:P}=(0,d().K8)((()=>{const e=null==T?void 0:T.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(r)}}),[T,r]),B=(0,n.useCallback)((()=>{Ve().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),C().Ey({collectionContextStore:c,resultsStore:I});const e=c.normalizedFormatStore.state.collection_peek_mode,t=e||_n().C9.calendar;jn().bn(j,{is_peek:!0,from:"calendar",peek_mode:t})}),[c,j,I]),V=k?7:5,F=(0,n.useMemo)((()=>{const e=[];v.forEach((o=>{const n=ae().Bv.createChildStore(p,{table:z().ev,id:o.id});R&&T===n&&M||e.push((0,E.jsx)(Vc,{blockPropertyValueOverlayStore:t,calendarBy:r,calendarStore:i,collectionContextStore:c,endOfWeek:g,format:S,handleOpenPeekPage:B,item:o,schema:b,showWeekends:k,startOfWeek:A,store:n},o.id))}));const o=R&&M&&(0,Ys().uo)(M,(0,Qo().P)());if(R&&M&&o&&(0,oc().m6)(A,g,o.start,o.end)&&T&&null!=T&&T.id){const n=v.find((e=>e.id===T.id));e.push((0,E.jsx)(Vc,{blockPropertyValueOverlayStore:t,calendarBy:P??r,calendarStore:i,collectionContextStore:c,endOfWeek:g,format:S,handleOpenPeekPage:B,schema:_??b,showWeekends:k,startOfWeek:A,store:T,item:{id:T.id,start:o.start,end:o.end,row:n?n.row:0,includeTime:"datetime"===M.type||"datetimerange"===M.type}},T.id))}return e}),[t,r,i,c,p,g,S,B,R,v,b,k,A,T,P,_,M]),L=(0,n.useMemo)((()=>Math.max(0,...v.map((e=>e.row)))),[v]),O=(0,d().K8)((()=>(0,re().jz)({collectionContextStore:c})),[c]),D=(0,u().IS)((()=>{const e=(S.calendar_properties?S.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(O?1:0),t="week"===l?372:124,o=Rc(e,S);return{container:{position:"relative",display:"flex",height:Math.max((L+1)*o+cc+4,t)}}}),[l,S,L,O]);return(0,E.jsxs)("div",{style:D.container,children:[[...Array(V).keys()].map((e=>{const t=(0,Ys().K1)({date:A,daysToAdd:e});return(0,E.jsx)(mc,{blockStore:o,calendarStore:i,collectionContextStore:c,columnIndex:e,startOfDay:t,calendarBy:r,currentlyViewedMonth:m,canEditCalendar:s,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,propertySchema:x,calendarViewRange:l,shouldShowShimmer:w},e)})),F]},A.toString())}function Vc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:a,item:s,schema:c,showWeekends:u,startOfWeek:p,store:m}=e,{canEdit:g,collectionStore:S}=(0,d().K8)((()=>({canEdit:m.canEdit(),collectionStore:m.getAssociatedCollectionStore()})),[m]),{collectionStoreSchema:h,collectionStoreCalendarBy:f}=(0,d().K8)((()=>({collectionStoreSchema:null==S?void 0:S.getSchema(),collectionStoreCalendarBy:null==S?void 0:S.getMappedProperty(o)})),[S,o]);return S?(0,E.jsx)(wc,{collectionContextStore:r,store:m,startOfWeek:p,endOfWeek:i,showWeekends:u,start:s.start,end:s.end,row:s.row,includeTime:s.includeTime,format:l,schema:h??c,calendarBy:f??o,disabled:!g,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:a},m.id):null}const Fc=(0,n.memo)(Bc);function Lc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:s,isInHomeWidget:c,isInPeekRenderer:p,isTypedMsvCollection:m,query:g,resultStore:S,schema:h,sortedResultsStore:f,weeks:y}=e,{isPhone:v}=(0,a().Y0)(),x=(0,d().K8)((()=>{var e,t;return(void 0===(null===(e=S.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=S.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Yn().iv)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,S]),{collectionViewStore:b,calendarViewRange:C,showWeekends:w}=(0,d().K8)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var k;y&&y.length>0&&(null===(k=i.databaseItemsVisibleTracker)||void 0===k||k.handleItemsRenderStart());const I=(0,u().IS)((e=>({container:v?{}:{boxShadow:`-1px 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[v]),{calendar_by:A}=g;if(!A)return null;const j=h[A];return j&&b?(0,E.jsx)("div",{style:I.container,children:y&&y.map((e=>v?(0,E.jsx)(lc,{blockPropertyValueOverlayStore:t,calendarBy:A,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:s,items:e.items,query:g,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start):(0,E.jsx)(Fc,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:A,calendarStore:n,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,collectionViewStore:b,currentlyViewedMonth:l,endOfWeek:e.end,format:s,isInHomeWidget:c,isInPeekRenderer:p,isTypedMsvCollection:m,items:e.items,propertySchema:j,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start)))}):null}const Oc=(0,n.memo)(Lc);var Ec=()=>o(16791),Dc=()=>o(377963),zc=()=>o(855470),Kc=()=>o(181301),Hc=()=>o(682369),Wc=()=>o(570537),Gc=()=>o(689248),Nc=()=>o(266963),$c=()=>o(773082),Uc=()=>o(330358),qc=()=>o(313067),Xc=()=>o(678671),Yc=()=>o(822493);const Qc=(0,pt().YK)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function Zc(e){let{variant:t,origin:o,onCloseClick:n,onConnectCalendarClick:r}=e;const i=(0,u().IS)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.text.contrastPrimary},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,E.jsx)(Yc().k,{origin:o,placementToOrigin:"bottom",header:(0,E.jsx)(pt().sA,{..."success"===t?Qc.successTitle:Qc.defaultTitle}),content:(0,E.jsxs)("div",{style:i.contentInner,children:[(0,E.jsx)("div",{style:i.contentMessage,children:(0,E.jsx)(pt().sA,{..."success"===t?Qc.successContent:Qc.defaultContent})}),"default"===t&&(0,E.jsx)("div",{style:i.footer,children:(0,E.jsx)(It().A,{style:i.primaryButton,hoveredStyle:i.primaryButtonHover,pressedStyle:i.primaryButtonPressed,onClick:r,children:(0,E.jsx)(pt().sA,{...Qc.connectCalendarTitle})})})]}),contentStyle:i.content,onCloseClick:n,shouldDismissUponOutsideClick:!1,enableMouseCapture:!1,pointerPosition:"33%",style:{...i.tooltip}})}function Jc(e){let{collectionContextStore:t}=e;const o=(0,n.useRef)(null),[r,i]=(0,n.useState)(!1),l=(0,a().v3)(),s=(0,d().O$)(bt().AppStoreCurrentSpaceStore),c=(0,d().K8)((()=>(0,Kc().mX)()),[]),p=(0,d().K8)((()=>Nc().default.isVisible("open_in_calendar_tooltip")),[]),m=(0,d().K8)((()=>{const e=Uc().A.state.open||t.settingsStore.state.open,o=t.isFullScreenStore.state,n=O().default.state.open;return o&&!e&&!n&&$c().A.state.loaded}),[t]);(0,Hc().A)((()=>{Gc().HH(l,"open_in_calendar_tooltip")}),m);const g=(0,n.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),n=null==o?void 0:o.getParentBlockStore();e&&o&&n&&s&&(Wc().tC(l,{is_calendar_connected:c,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:n.id}),qc().Op({environment:l,collectionViewStore:e,spaceStore:s,from:"openInCalendarButton"}))}),[l,t,s,c]),S=(0,n.useCallback)((()=>{Gc().a(l,"open_in_calendar_tooltip")}),[l]),h=(0,n.useCallback)((()=>{i(!0),g()}),[g]),f=(0,u().IS)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{height:18,width:18},calendarIconSvg:{fill:e.text.primary}})),[]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Xl().A,{size:"lg",ref:o,style:f.button,iconStyle:f.calendarIconSvg,icon:e=>(0,E.jsx)(Xc().y,{style:{...e,...f.calendarIcon}}),onClick:g,children:(0,E.jsx)(pt().sA,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),p&&(0,E.jsx)(Zc,{variant:r||c?"success":"default",origin:o,onCloseClick:S,onConnectCalendarClick:h})]})}function ed(e){const t=(0,a().v3)(),o=(0,fe().Zp)();return!(0,d().K8)((()=>(0,Kc().JF)({environment:t,collectionContextType:e.collectionContextStore.contextType,spaceStore:bt().default.state.currentSpaceStore})),[t,e.collectionContextStore])||null!=o&&o.disablePageLinks?null:(0,E.jsx)(Jc,{...e})}const td=(0,pt().YK)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}}),od=n.memo((function(e){const{currentlyViewedMonth:t,calendarViewRange:o,setNewCalendarStart:r,isInHomeWidget:i,dateRangeStart:l,isInPeekRenderer:s,stickyStyle:c,collectionContextStore:p,weeks:m,userSettingsStartOfWeekStore:g}=e,S=(0,pt().tz)(),{isPhone:h,isMobile:f}=(0,a().Y0)(),y=(0,n.useRef)(null),v=(0,M().Oz)(p),x=(0,d().K8)((()=>{const e=g.state,t=p.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_show_weekends").getValue())??!0?(0,gc().zI)(e,Ec().locale):(0,gc().rj)(Ec().locale)}),[p,g]),b=(0,n.useMemo)((()=>{const e=(0,gc().W_)(t,"month_year_long",Ec().locale);if("month"===o)return e;if(!m||void 0===m[0])return"";const n=m[0];if((0,Ys().vY)({firstDate:n.start,secondDate:n.end}))return e;return`${(0,gc().W_)(n.start,(0,Ys().St)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",Ec().locale)} - ${(0,gc().W_)(n.end,"month_year_short",Ec().locale)}`}),[t,o,m]),C=(0,n.useCallback)((()=>{const e=g.state,t="month"===o?(0,Ys().mK)((0,Ys().Mw)(Date.now()),e):(0,Ys().mK)(Date.now(),e);r({newCalendarStart:t,calendarViewRange:o,startOfWeek:e})}),[o,r,g]),w=(0,n.useCallback)((e=>{const t=g.state,n=(0,Ys().to)(l,t);if("month"===o){const i="left"===e?-1:1,l=(0,Ys().mK)((0,Ys().Mw)((0,Ys().AQ)({date:n,monthsToAdd:i})),t);r({newCalendarStart:l,calendarViewRange:o,startOfWeek:t})}else{const n="left"===e?-7:7,i=(0,Ys().mK)((0,Ys().K1)({date:l,daysToAdd:n}),t);r({newCalendarStart:i,calendarViewRange:o,startOfWeek:t})}}),[g,l,o,r]),k=(0,u().IS)((e=>{const t=h?e.contentBackground:(null==v?void 0:v.background)||(s?e.cardContentBackground:e.contentBackground);return{container:i?{}:{position:"absolute",left:0,right:0,zIndex:85,background:t},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:Ro().Wy.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:h?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:h?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.text.tertiary,height:24}}}),[v,i,s,h]);return(0,E.jsx)(sl().g,{stickyAttachPoint:i?"no-stick":"ceiling",nodeRef:y,stickyStyle:c,transitionStickyStyle:c,absoluteHeight:98,children:(0,E.jsxs)("div",{style:k.container,ref:y,children:[(0,E.jsxs)("div",{style:k.monthSwitcher,children:[(0,E.jsx)("div",{style:k.monthHeader,children:b}),(0,E.jsx)("div",{style:k.spacer}),(0,E.jsx)(ed,{collectionContextStore:p}),(0,E.jsx)(At().A,{ariaLabel:S.formatMessage(td.previousMonthButtonAriaLabel),mobileFeedback:f,icon:Dc().I,onClick:()=>w("left")}),(0,E.jsx)(dr().p,{size:"sm",onClick:C,children:(0,E.jsx)(pt().sA,{...td.todayButtonLabel})}),(0,E.jsx)(At().A,{ariaLabel:S.formatMessage(td.nextMonthButtonAriaLabel),mobileFeedback:f,icon:zc().V,onClick:()=>w("right")})]}),(0,E.jsx)("div",{style:k.weekdayNamesContainer,className:we().VO,children:x.map((e=>{let[t,o]=e;return(0,E.jsx)("div",{style:k.weekdayName,children:o},t)}))})]})})})),nd=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,store:i,format:l,query:m,schema:g,isFullScreen:S,isInPeekRenderer:h,isPreviewing:y,maxHeight:v,minWidth:x,paddingBottom:b,paddingLeft:C,paddingRight:I}=e,j=(0,pt().tz)(),R=(0,a().v3)(),T=R.currentUser.id,{isPhone:_,isMobile:P}=(0,a().Y0)(),{value:B}=(0,le().fJ)(ve().T.formulas),V=(0,n.useRef)(null),L=(0,n.useRef)(null),O=(0,o(381988).A)(L,V),D=(0,d().uB)(void 0,tc().a),K=(0,d().uB)(void 0,p().default),H=(0,d().K8)((()=>r.collectionViewStore()),[r]),W=null==H?void 0:H.id,G=(0,d().K8)((()=>r.collectionStore()),[r]),N=(0,Be().bx)(i,!1),$=(0,d().O$)(He().A),U=(0,d().O$)(r.isLoadingStore),q=(0,d().K8)((()=>"collectionTypedView"===r.contextType),[r]),X=(0,d().O$)(r.isInHomeWidgetStore),Y=(0,d().K8)((()=>Boolean(r.viewsModuleContextStore.getViewModuleType())),[r]),Q=(0,d().O$)(r.dateRangeStartStore),Z=(0,d().O$)(r.dateRangeEndStore),J=(0,d().O$)(r.permissionScopesStore),ee=(0,d().O$)(D),{dayStoreMap:te,startingMonth:oe,isDragging:ne}=ee,re=ne?void 0:ee.hoveredDay,ie=(0,d().K8)((()=>N&&(J.canEditContent||q)),[N,J.canEditContent,q]),se=(0,d().K8)((()=>{var e;return(null==H||null===(e=H.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[H]),ce=(0,d().K8)((()=>S&&!P&&"month"===se),[S,P,se]),de=(0,d().K8)((()=>{const e=Ce().XX.state;return ce||!Q?oe:(0,Ys().Mw)((0,Ys().to)(Q,e))}),[ce,Q,oe]),ue=(0,d().K8)((()=>(0,Js().j2)({collectionContextStore:r})),[r],{useDeepEqual:!0}),pe=(0,d().K8)((()=>{if(!H)return[];const e=K.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>ae().Bv.createChildStore(H,{id:e,table:z().ev})))||[];return(0,Js().oq)({collectionContextStore:r,results:t,getRecordValue:i.getRecordValue,intl:j,formulasModule:B})}),[H,K,r,i.getRecordValue,j,B],{useDeepEqual:!0}),me=(0,d().r6)((()=>H&&pe&&(null==pe?void 0:pe.flatMap((e=>e.items.map((e=>ae().Bv.createChildStore(H,{table:z().ev,id:e.id}))))))||[]),[H,pe],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,d().O$)(me);const[ge,Se]=(0,n.useState)();(0,n.useEffect)((()=>{var e;null!==(e=V.current)&&void 0!==e&&e.parentElement&&Se((0,F().NM)(V.current.parentElement))}),[]);const he=(0,n.useCallback)((e=>{const{newCalendarStart:t,calendarViewRange:o,startOfWeek:n}=e,i=(0,Ys().to)(t,n);let l;"month"===o?(l=ce?(0,Ys().to)((0,Ys().AQ)({date:i,monthsToAdd:1}),n):(0,Ys().to)((0,Ys().Xf)(i),n),ge&&ce&&(ge.scrollTop=0)):l=i,(0,Qs().r)({dateRangeStart:t,dateRangeEnd:l,collectionContextStore:r}),D.update((e=>({...e,startingMonth:(0,Ys().Mw)((0,Ys().to)(t,n))}))),W&&(0,ec().LQ)({newCalendarStart:t,newCalendarEnd:l,collectionViewId:W,currentUserId:T})}),[r,D,ce,ge,W,T]),ye=(0,n.useCallback)((()=>{G&&G.isDefined()&&H&&J.canConfigureBlock&&A().createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:R,canUndo:!0,perform:e=>{let t,o=M().zv(g);if(!o&&J.canConfigureCollection){o=(0,Po().Ay)();t={[o]:{name:j.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}o&&((0,Ai().f)({collectionViewStore:H,update:{calendar_by:o},transaction:e}),Do().zv({store:H,data:{type:"calendar"},transaction:e}),t&&(0,Ho().F)({environment:R,collectionStore:G,update:t,transaction:e}))}})}),[G,H,R,j,J.canConfigureBlock,J.canConfigureCollection,g]),xe=(0,n.useCallback)((e=>{if(!H||!W)return;const t=(0,ec().dI)({collectionViewId:W,currentUserId:T}),o=e.state,n=(0,Ys().mK)(t,o),r=(0,Ys().mK)(new Date((0,Ys().to)(t,o)).getDate()>7?(0,Ys().Mw)(t):t,o),i="month"===se?r:n;D.update((e=>({...e,startingMonth:r.valueOf()}))),he({newCalendarStart:i,calendarViewRange:se,startOfWeek:o})}),[H,W,T,se,D,he]),be=(0,n.useCallback)((()=>{if(!L.current||!ce)return;const e=f().Ul(Array.from(te.entries()).map((e=>{let[t,o]=e;return{store:o,timestamp:t}})),(e=>{let{timestamp:t}=e;return t})),t=L.current.getBoundingClientRect(),n=e.find((e=>{let{store:n}=e;const r=o(37394).T.getRectFromStore(n);if(!r)return;const i=(null==ge?void 0:ge.scrollTop)??0,l=r.top<=t.top+i,a=r.bottom>=t.top+i;return l&&a}));if(n){const e=Ce().XX.state,t=(0,Ys().Mw)((0,Ys().K1)({date:(0,Ys().to)(n.timestamp,e),daysToAdd:1}));t!==oe&&D.update((e=>({...e,startingMonth:t})))}}),[D,te,ce,oe,null==ge?void 0:ge.scrollTop]),ke=(0,fr().d)(be,100),Ie=(0,n.useCallback)((e=>{if(e<ze().A.incrementScrollOffset&&!U&&ce){const e=Ce().XX.state,t=(0,Ys().to)((0,Ys().AQ)({date:Z,monthsToAdd:2}),e);(0,Qs().r)({dateRangeStart:Q,dateRangeEnd:t,collectionContextStore:r})}}),[r,Z,Q,U,ce]),Ae=(0,n.useCallback)((e=>{const{target:t}=e;!_&&t instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),w().jD({environment:R,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[R,_,i]),je=(0,n.useCallback)((e=>{if(!$&&(0,Js().kc)(ee)){const t=function(e,t){k().AP();const{selectableRectMap:n}=o(105157).default.state,r=Array.from(te.keys()),i=Array.from(te.values());for(const[o,l]of n.entries())if(l&&Zs().ux(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>te.get(e)===o.props.store))}(e.clientX,e.clientY);re!==t&&D.update((e=>({...e,hoveredDay:t})))}}),[D,ee,te,re,$]),Me=(0,fr().d)(je,100);(0,s().l)((()=>{xe(Ce().XX),Ce().XX.addListener(xe)})),(0,c().X)((()=>{Ce().XX.removeListener(xe)})),(0,n.useEffect)((()=>{$&&(0,Js().kc)(ee)&&D.update((e=>({...e,hoveredDay:void 0}))),m.calendar_by||ye()}),[D,ee,$,m.calendar_by,ye]),(0,n.useEffect)((()=>{const e=V.current,t=null==e?void 0:e.parentElement,o=ge;return t&&(Re().P4(t,"mousemove",Me),o&&Re().P4(o,"scroll",ke)),()=>{t&&Re().Ol(t,"mousemove",Me),o&&Re().Ol(o,"scroll",ke)}}),[Me,ke,ge]);const _e=(0,u().IS)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:v?v-(_?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...X?{paddingTop:12}:{}},scrollOffset:X?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingLeft:1,...X&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:b,paddingLeft:C,paddingRight:I,minWidth:x,...X&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingLeft:C,paddingRight:I,minWidth:x}})),[X,_,v,x,b,C,I]),Pe=(0,fe().Zp)(),Ve=(0,n.useCallback)((()=>(0,ei().A)((e=>(0,E.jsx)(Pl,{nodeRef:L,children:(0,E.jsx)(Xn().A,{onChange:Ie,style:_e.scrollOffset,children:(0,E.jsx)("div",{ref:O,style:_e.container,className:we().G1r,children:(0,E.jsxs)(lt().A,{store:i,onMouseDown:Ae,style:_e.selectable,shouldShowHalo:!S&&!X&&!y,canSelect:!S&&!Y,analyticsName:"calendar",disablePointerEvents:null==Pe?void 0:Pe.disableAllPointerEvents,...e,children:[!(null!=Pe&&Pe.disableAllPointerEvents)&&(0,E.jsx)(od,{collectionContextStore:r,weeks:pe,userSettingsStartOfWeekStore:Ce().XX,dateRangeStart:Q,currentlyViewedMonth:de,setNewCalendarStart:he,calendarViewRange:se,isInHomeWidget:X,isInPeekRenderer:h,stickyStyle:_e.sticky}),X?(0,E.jsx)(ko,{style:_e.scroller,children:(0,E.jsx)(Oc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:D,resultStore:K,sortedResultsStore:me,format:l,query:m,schema:g,weeks:pe,isInPeekRenderer:h,currentlyViewedMonth:de,canEditCalendar:ie,isInHomeWidget:X,isTypedMsvCollection:q})}):(0,E.jsx)(Oc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:D,resultStore:K,sortedResultsStore:me,format:l,query:m,schema:g,weeks:pe,isInPeekRenderer:h,currentlyViewedMonth:de,canEditCalendar:ie,isInHomeWidget:X,isTypedMsvCollection:q})]})})})})))),[t,i,D,se,ie,r,de,Q,l,Ae,Ie,S,X,h,y,Y,q,O,Pe,m,K,g,he,me,_e.container,_e.scrollOffset,_e.scroller,_e.selectable,_e.sticky,pe]),{calendar_by:Fe}=m;if(!Fe)return(0,E.jsx)(rd,{collectionContextStore:r,isFullScreen:S,paddingBottom:b,paddingLeft:C,paddingRight:I});const Le=g[Fe];return Le&&Wo().$L(Le)?ue?(0,E.jsx)(bn().A,{id:"calendar_results",resultStore:K,collectionContextStore:r,reducer:ue,render:Ve}):null:(0,E.jsx)(rd,{collectionContextStore:r,isFullScreen:S,paddingBottom:b,paddingLeft:C,paddingRight:I})}));function rd(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i}=e,l=t.settingsStore,a=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),s=(0,u().IS)((()=>({container:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,E.jsx)(Wa().Ay,{style:s.container,title:(0,E.jsx)(pt().sA,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:a?(0,E.jsx)(pt().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,E.jsx)(Wa().P6,{onClick:()=>{x().Ow({collectionContextStore:t,collectionSettingsStore:l}),x().a2({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,E.jsx)(pt().sA,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var id=()=>o(120445),ld=()=>o(777277);function ad(e,t){return(0,Tr().B2)(t[e])}function sd(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=bt().default.state;return M().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function cd(e,t,o,n,r,i){return t.isDefined()?n.filter((n=>{const l="title"!==n&&r;return!dt().r8({property:n,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Qo().P)(),intl:xt().A.getIntl(),experimentService:Fo().default,collectionFeatureGates:(0,tn().i)(),formulasModule:i})||l})):[]}function dd(e,t,o,n,r,i,l){const a=t.state,s=a.isOpen?a.property:"title",c=cd(e,o,n,r,i,l),d=c.findIndex((e=>e===s)),u=f().Uk(c,((e,t)=>t<d&&ad(e,n)));return u||(i?"title":function(e,t){return f().Uk(e,(e=>ad(e,t)))}(c,n))}function ud(e,t,o,n,r,i,l){const a=t.state,s=a.isOpen?a.property:"title",c=cd(e,o,n,r,i,l),d=c.findIndex((e=>e===s)),u=c.find(((e,t)=>t>d&&ad(e,n)));return u||(i?"title":function(e,t){return e.find((e=>ad(e,t)))}(c,n))}function pd(e){(0,id().P)({store:e})}function md(e,t,o,n,r){if("title"===e){Rn().VN({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();k().hc({environment:r,store:t}),(0,Zn().C)({store:t}),I().setSelectionAtEnd({store:e})}else e?(Rn().VN({environment:r,blockPropertyValueOverlayStore:o}),Rn().ho({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:"list",collectionContextStore:n})):Rn().VN({environment:r,blockPropertyValueOverlayStore:o});pd(t)}function gd(e){const{environment:t,newStore:o,previousStore:n}=e;k().hc({environment:t,store:o}),(0,Zn().C)({store:o}),ld().A.setState({store:o,editMode:"new",previousStore:n})}function Sd(e){const t=(0,a().v3)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:l,collectionStore:s,subitemPath:c,indentLevel:p,onSubitemCreate:m}=e,g=(0,d().K8)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),S=(0,d().K8)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),h=(0,ro().Sm)(o),f=(0,d().K8)((()=>(0,j().si)({columnIndex:0,titleColumnIndex:0,indentLevel:p,isSubitemToggleOnTitleColumn:S})),[p,S]),y=(0,L().X)("db_ux_chrome"),v=(0,u().IS)((t=>({newRowButtonWrapper:{...y?{display:"flex",alignItems:"center",height:36,width:"100%",paddingLeft:f,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...g&&{borderTop:"none"},...e.styles}:{display:"contents"}},newRowButton:{display:y?"inline-flex":"flex",alignItems:"center",fontSize:14,height:y?28:32,...y?{borderRadius:6,paddingLeft:6,paddingRight:8,marginLeft:22}:{width:"100%",paddingLeft:f,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...g&&{borderTop:"none"},...e.styles}},newRowButtonHovered:{...!y&&{backgroundColor:t.tableRowHoveredBackground}},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:f+8,color:t.text.tertiary},newIcon:{width:Ao().Ev.sm,height:Ao().Ev.sm,marginRight:6,fill:t.icon.tertiary},newText:{color:t.text.tertiary}})),[f,g,e.styles,y]),x=(0,d().K8)((()=>{const e=r.permissionScopesStore.state,t=s.isSyncedCollection();return!i&&e.canEditContent&&!t}),[r,i,s]),b=(0,n.useCallback)((e=>{A().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:n=>{const i=(0,Mn().u)({environment:t,collectionContextStore:r,groupsPointer:l,store:o,before:!1,collectionStore:s,transaction:n,subitemPath:c,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&m(i)}}),function(e,t){xe().vd(e,"create_subitem",t)}(t,{...(0,ke().sl)(r)})}),[r,t,l,s,o,c,m]);return!x||h?null:(0,E.jsx)("div",{style:v.newRowButtonWrapper,children:(0,E.jsx)(It().A,{onClick:b,onMouseDown:Te().tr,style:v.newRowButton,hoveredStyle:v.newRowButtonHovered,children:(0,E.jsxs)("span",{style:v.newRowContainer,children:[(0,tr().plusSmallIcon)(v.newIcon),(0,E.jsx)("span",{style:v.newText,children:(0,E.jsx)(pt().sA,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})})}const hd=n.memo((function(e){const{property:t,propertyIndex:o,showProperties:r,blockPropertyValueOverlayStore:i,store:l,schema:s,collectionContextStore:c,disabled:u,isEditing:p,mouseIsEntered:m}=e,g=(0,a().v3)(),S=(0,d().K8)((()=>M().Dj({store:l,collectionContextStore:c})),[l,c]),h=(0,d().K8)((()=>c.collectionViewStore()),[c]),f=(0,d().O$)(c.isInHomeWidgetStore),y=(0,d().O$)(c.isUnlistedViewStore),v=(0,d().O$)(c.isInlineViewStore),{isLocked:x,canEditContent:b}=(0,d().O$)(c.permissionScopesStore),C=(0,n.useMemo)((()=>{if("title"!==t)return!1;return m&&!f&&!(y&&v)}),[f,v,y,m,t]),w=(0,d().K8)((()=>l.canEdit()),[l]),I=p||f,A=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){md(dd(e,t,o,n,r,l,await ve().T.formulas.load()),o,t,i,e)}(g,i,l,s,r,c,p)),[g,i,l,s,r,c,p]),j=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){md(ud(e,t,o,n,r,l,await ve().T.formulas.load()),o,t,i,e)}(g,i,l,s,r,c,p)),[g,i,l,s,r,c,p]),R=(0,n.useCallback)((()=>function(e,t,o){Rn().VN({environment:e,blockPropertyValueOverlayStore:t}),k().Lt({environment:e,store:o}),pd(o)}(g,i,l)),[g,i,l]),T=(0,n.useCallback)((()=>pd(l)),[l]);return S?(0,E.jsx)(zr().BlockPropertyRouter,{store:l,property:t,propertyIndex:o,disabled:u||!w,locked:x||!b,format:"list",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:S,collectionViewStore:h,forceMouseEntered:C,showIfEmpty:I,onBgClick:R,onEnter:R,onEsc:R,onTab:j,onUntab:A,onClick:T},t):null}));function fd(e){let{collectionContextStore:t,toggleButton:o,subitemPath:n}=e;const r=(0,d().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(null==n?void 0:n.length)??0;if(!r)return null;const l=Math.max((i-1)*re().yy,0)+re().Pi;return o?(0,E.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,E.jsx)("div",{style:{width:l}}),o]}):(0,E.jsx)("div",{style:{minWidth:l+re().yy}})}const yd=n.memo(n.forwardRef((function(e,t){const r=(0,pt().tz)(),{store:i,schema:l,blockPropertyValueOverlayStore:s,handleOpenPeekPage:p,collectionContextStore:m,onShiftEnter:g,toggleButton:S,subitemPath:h,showProperties:f,disabled:y}=e,v=(0,a().v3)(),{isMobile:x,isPhone:b}=(0,a().Y0)(),C=(0,n.useRef)(null),w=(0,n.useRef)(null),[k,A]=(0,n.useState)(!1),[j,R]=(0,n.useState)(!1),[T,M]=(0,n.useState)(!1),[_,P]=(0,n.useState)(!1),B=(0,d().K8)((()=>{const e=Pn().A.state;return Boolean(e.isActive&&e.store.id===i.id)}),[i.id]),V=(0,d().K8)((()=>{const e=ld().A.state;return e.store&&e.store.id===i.id?e.editMode:void 0}),[i.id]),F=(0,fr().d)((()=>{He().A.state||P(!0)}),100),L=(0,hr().Y)((()=>{P(!1)}),100),O=(0,fr().d)((()=>{M(!0)}),100),D=(0,fr().d)((()=>{R(!0)}),100),z=(0,d().K8)((()=>se().default.state.stores.length>0&&se().default.state.stores[0].id===i.id),[i.id]),K=(0,n.useCallback)((()=>{const e=sd({environment:v,store:i,collectionContextStore:m});e&&(p(),yr().oo({environment:v,url:e}))}),[v,p,i,m]),H=(0,d().K8)((()=>i.getBlockTitleStore()),[i]),W=(0,d().K8)((()=>function(e){return(0,kr().Ay)({store:e,fullyQualified:!1,pageVisitSource:To().y8.LinkInPage})}(i)),[i]),G=(0,d().K8)((()=>sd({environment:v,store:i,collectionContextStore:m})),[v,i,m]),N=(0,d().K8)((()=>f.map((e=>i.getPropertyValue(e)))),[f,i]),$=(0,n.useCallback)((()=>{!function(e,t){pd(e),t()}(i,p)}),[i,p]),U=(0,n.useCallback)((()=>{w.current&&A(w.current.scrollWidth>w.current.clientWidth)}),[]),q=(0,fr().d)(U,100),X=(0,d().K8)((()=>(0,kn().W)(v,i.id)),[v,i]),Y=(0,u().IS)((e=>{return{container:{display:"flex",position:"relative"},linkBox:{position:"relative",...(t=B?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===t?{height:30}:{minHeight:30}})},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${e.tableDividerColor}`},linkBoxInner:{display:"flex",alignItems:"center",paddingLeft:4,userSelect:B?void 0:"none",WebkitUserSelect:B?void 0:"none"},mobileLinkBoxInner:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingLeft:x?0:6,paddingBottom:x?0:4},hoveredStyle:{background:B?"transparent":e.buttonHoveredBackground},pressedStyle:{background:B?"transparent":e.buttonPressedBackground},overflowButtonArea:{position:"absolute",right:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.buttonBackground,transition:"none",paddingLeft:2,paddingRight:0},overflowIcon:{width:12,height:12,fill:e.lightIconColor,marginLeft:-2}};var t}),[B,x]);(0,n.useEffect)((()=>{B&&"new"===V&&I().setSelectionAtEnd({store:H})}),[B,V,H]),(0,n.useEffect)((()=>(window.addEventListener("resize",q),()=>window.removeEventListener("resize",q))),[q]),(0,n.useEffect)((()=>{q()}),[q,N]),(0,c().X)((()=>{ld().A.reset(),Pn().A.reset()}));const Q=(0,n.useMemo)((()=>f.indexOf("title")),[f]),Z=b&&f.length>0,ee=(0,E.jsx)(fd,{collectionContextStore:m,toggleButton:S,subitemPath:h}),te=(e,t)=>(0,E.jsx)(hd,{blockPropertyValueOverlayStore:s,collectionContextStore:m,disabled:y,isEditing:B,mouseIsEntered:_,property:e,propertyIndex:t,showProperties:f,schema:l,store:i},e);let oe;if(Z){const[e,t]=[f.slice(0,Q+1),f.slice(Q+1)];oe=(0,E.jsxs)("div",{style:Y.container,dir:"ltr",ref:C,children:[ee,(0,E.jsxs)(wr().A,{ref:w,href:W,metaHref:G,external:!1,style:Y.mobileLinkBox,innerStyle:Y.mobileLinkBoxInner,disableForOffline:X,children:[(0,E.jsx)("div",{style:Y.propertiesWithTitleContainer,children:e.map(te)}),t.length>0&&(0,E.jsx)("div",{style:Y.propertiesAfterTitleContainer,children:t.map(te)})]})]})}else{const e=r.formatMessage({id:"collectionList.overflow.tooltip",defaultMessage:"See all properties"});oe=(0,E.jsx)(J().A,{debugName:"CollectionListViewItem",capture:z,onShiftEnter:g,children:(0,E.jsxs)("div",{style:Y.container,dir:"ltr",ref:C,onMouseEnter:D,onMouseLeave:()=>R(!1),children:[ee,(0,E.jsx)(wr().A,{ref:w,href:W,metaHref:G,altHref:G,onClick:$,external:!1,style:Y.linkBox,innerStyle:Y.linkBoxInner,hoveredStyle:Y.hoveredStyle,pressedStyle:Y.pressedStyle,onMouseEnter:F,onMouseMove:F,onMouseLeave:L,disableForOffline:X,children:f.map(te)}),k?(0,E.jsx)("div",{style:Y.overflowButtonArea,children:T||j?(0,E.jsx)(jt().A,{renderTooltip:()=>e,placement:Ee().W.Bottom,render:t=>(0,E.jsx)(At().A,{icon:o(469118).C,iconStyle:Y.overflowIcon,ariaLabel:e,style:Y.overflowButton,onClick:K,onMouseEnter:O,onMouseLeave:()=>M(!1),...t})}):null}):null]})})}return(0,Be().NW)(i,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>i,getNode:()=>C.current,activate:K})),[i,K]),oe)})));function vd(){return{marginTop:1,marginBottom:1}}const xd=n.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:i,collectionContextStore:l,schema:s,blockPropertyValueOverlayStore:c}=e;const u=(0,a().v3)(),p=(0,n.useMemo)((()=>t?[t]:[]),[t]),m=(0,n.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:g}=(0,d().K8)((()=>({permissionScopes:l.permissionScopesStore.state})),[l]),S=(0,d().K8)((()=>l.groupsStore.getGroupState(p)),[p,l]),h=(0,d().K8)((()=>!i&&o.canEdit()&&g.canEditContent&&!g.isSyncedCollection),[i,o,g]),f=(0,n.useCallback)((()=>{if(!S)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=se().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,en().Qe)(o.children,(e=>e.value.store===t)),r=n?(0,re().kY)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),a=Boolean(null==i?void 0:i.isExpanded);A().createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:u,canUndo:!0,perform:o=>{const r=(0,Mn().u)({environment:u,collectionContextStore:l,groupsPointer:S.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:a?"into":"below",from:"list_selection_overlay_shift_enter"});r&&gd({environment:u,newStore:r,previousStore:t})}}),(0,Rr().u)(u,"list_item_edit_mode_enter",{...(0,ke().sl)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,u,S]),y=(0,n.useCallback)(((e,t)=>{gd({environment:u,newStore:t,previousStore:e})}),[u]),v=(0,n.useMemo)((()=>({blockPropertyValueOverlayStore:c,collectionContextStore:l,disabled:i,onShiftEnter:f,schema:s,showProperties:m,collectionViewBlockStore:o})),[c,l,i,f,s,m,o]),x=(0,n.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,E.jsx)(Sd,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,Zn().C)({store:e,transient:!1}),ld().A.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,p]);return S?(0,E.jsx)(Hn,{collectionContextStore:l,groupsPointer:p,format:r,canDrag:h,resultProps:v,canDrop:!0,resultComponent:yd,disabled:i,shouldShowHoverMenu:!0,direction:zn.Vertical,analyticsName:"list",getItemSelectableStyle:vd,emptyDroppableSize:0,onSelectableInsertRow:y,nestedCreateSubitemButton:x}):null}));const bd=n.memo((function(e){const{store:t,format:o,paddingBottom:r,paddingLeft:i,paddingRight:l,isFullScreen:s,isPreviewing:c,isRootChild:p,minWidth:m,disabled:g,collectionContextStore:S}=e,h=(0,a().v3)(),{isMobile:f}=(0,a().Y0)(),y=(0,u().DP)(),v=(0,d().K8)((()=>M().mM(S,s)),[S,s]),b=(0,d().K8)((()=>null==S?void 0:S.isInHomeWidgetStore.state),[S]),C=(0,d().K8)((()=>"collectionSystemView"===(null==S?void 0:S.contextType)),[S]),w=(0,d().K8)((()=>Boolean(S.viewsModuleContextStore.getViewModuleType())),[S]),k=o.collection_group_by,I=(0,n.useCallback)((()=>{x().R8({collectionSettingsStore:S.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Mo().V1}})}),[S]),A=(0,n.useCallback)(((e,t,o)=>{if(f)zo().uK({environment:h,store:e,pageVisitSource:To().y8.Create});else if(t)gd({environment:h,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=S.groupsStore.getGroupState(n),i="collectionTypedView"===S.contextType;Ko().VU({environment:h,store:e,peekMode:M().hH(S),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:S,pageVisitSource:To().y8.Create})}}),[S,h,f]),j=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${y.tableDividerColor}`}),[y]),R=(0,n.useCallback)((o=>(0,E.jsx)(ca,{reducerId:"list_groups",store:t,collectionContextStore:S,disabled:g,isFullScreen:s,isRootChild:p,paddingLeft:i,stickyLeft:!1,renderGroup:t=>(0,E.jsx)(wd,{...e,groupFormat:t}),getGroupStyle:j,renderHeader:e=>(0,E.jsx)(Cd,{args:e}),onGroupHeaderAddItem:A,onClickEmptyStateButton:I})),[S,g,j,I,A,s,p,i,e,t]),T=(0,n.useCallback)((e=>{const t=S.isLoadingStore.state,o=S.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===S.contextType)return;const n=o.reducerResultStore.state;e<ze().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,Uo().H)({collectionContextStore:S,environment:h,incrementLimitArgs:{isFullScreen:s,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[S,h,s]),_=(0,u().IS)((()=>({container:{paddingBottom:b?0:r,paddingLeft:i,paddingRight:l,minWidth:m},selectable:{display:"flex",flexDirection:"column",paddingTop:k||b||C?void 0:4,paddingBottom:4}})),[r,i,l,m,k,b,C]),P=(0,fe().Zp)();return(0,ei().A)((o=>(0,E.jsxs)("div",{style:_.container,className:we()._OD,children:[(0,E.jsx)(lt().A,{store:t,shouldShowHalo:!s&&!b&&!c,canSelect:!s&&!w,disablePointerEvents:null==P?void 0:P.disableAllPointerEvents,analyticsName:"list",style:_.selectable,...o,children:k?R(k):(0,E.jsx)(wd,{...e,groupFormat:k})}),!v&&(0,E.jsx)(Xn().A,{onChange:T})]})))}));function Cd(e){const{args:t}=e,{collectionContextStore:o}=t,n=(0,d().O$)(o.isInHomeWidgetStore),{stickyStyle:r}=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,E.jsx)(dl,{...t,height:n?yt().ag:48,stickyStyle:r})}const wd=n.memo((function(e){const{store:t,format:r,schema:i,disabled:l,groupFormat:s,isFullScreen:c,collectionContextStore:p,blockPropertyValueOverlayStore:m}=e,{isMobile:g}=(0,a().Y0)(),S=void 0!==s,h=(0,n.useMemo)((()=>s?[s]:[]),[s]),f=(0,d().K8)((()=>p.groupsStore.getGroupState(h)),[p,h]),y=(0,d().K8)((()=>null==f?void 0:f.reducerResultStore.state),[f]),v=(0,d().K8)((()=>p.groupsStore.anyGroupHasResults()),[p]),{canEditContent:x,isSyncedCollection:b}=(0,d().K8)((()=>{const e=p.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[p]),C=(0,d().K8)((()=>"collectionTypedView"===p.contextType),[p]),w=(0,d().O$)(p.isInHomeWidgetStore),k=(0,d().K8)((()=>v&&!l&&t.canEdit()&&(x||C)&&!b),[v,l,t,x,C,b]),I=(0,d().K8)((()=>""!==p.searchQueryStore.state),[p]),A=(0,d().K8)((()=>void 0!==y&&(null==y?void 0:y.blockIds.length)>0),[y]),j=(0,d().K8)((()=>(0,Yn().iv)({collectionContextStore:p,groupsPointer:h,hasPartialResults:A})),[p,h,A]),R=(0,d().K8)((()=>M().XQ({collectionContextStore:p,reducerResult:y,isFullScreen:c})),[p,y,c]),T=(0,u().IS)((e=>({container:{paddingBottom:s?w?8:16:void 0},groupLoadMoreButton:{fontSize:16,marginTop:g?4:void 0,paddingLeft:3},groupLoadMoreIcon:{width:16,height:16,marginRight:8},spacer:{width:"100%",borderTop:s||w?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[s,w,g]);return f?(0,E.jsxs)("div",{style:T.container,children:[(0,E.jsx)(xd,{groupFormat:s,store:t,format:r,disabled:l,collectionContextStore:p,schema:i,blockPropertyValueOverlayStore:m}),j&&(0,E.jsx)(o(282074).c,{isFullScreen:c,hasGroups:S,hasPartialResults:A,hasSearchQuery:I,overrideNumShimmerRows:w&&!A?6:void 0}),k&&(0,E.jsxs)(E.Fragment,{children:[R&&(0,E.jsx)("div",{style:T.spacer}),(0,E.jsx)(kd,{collectionContextStore:p,isFullScreen:c,groupState:f,groupFormat:s})]}),R&&(0,E.jsx)(qo().jJ,{groupsPointer:h,store:t,collectionContextStore:p,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:T.groupLoadMoreButton,iconStyle:T.groupLoadMoreIcon})]}):null})),kd=n.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:r,isFullScreen:i}=e,l=(0,a().v3)(),{isMobile:s}=(0,a().Y0)(),c=(0,pt().tz)(),p=(0,d().O$)(r.isInHomeWidgetStore),m=(0,d().K8)((()=>M().fG({collectionContextStore:r,environment:l,intl:c})),[r,l,c]),g=(0,n.useCallback)((()=>{if(!(0,Xe().EF)(l))return void(0,Xe().QY)(l);const e=r.currentSubitemFormatStoreForUiDisplayStore.state;A().createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{!function(e){var t;const{transaction:o,environment:n,results:r,collectionContextStore:i,isFullScreen:l,groupsPointer:a,insertAtIndex:s,from:c}=e;i.searchQueryStore.state&&(0,Jn().S)({searchQuery:"",collectionContextStore:i,isFullScreen:l});const d=null===(t=i.groupsStore.getGroupState(a))||void 0===t?void 0:t.resultsStore;if(!d)return;let u;s>0&&(u=r[s]);const p=(0,Qn().Q)({environment:n,collectionContextStore:i,groupsPointer:a,insertAtIndex:s,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:c},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!p)return;const m=p.coercionSucceeded,g=p.newStore;n.device.isMobile?zo().uK({environment:n,store:g,pageVisitSource:To().y8.Create}):m?gd({environment:n,newStore:g,previousStore:u}):Ko().VU({environment:n,store:g,peekMode:(0,M().hH)(i),resultsStore:d,collectionContextStore:i,pageVisitSource:To().y8.Create}),An().v(n,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,ke().sl)(i)})}({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:r,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,r,i]),S=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",height:(0,j().sG)({isMobile:s}),borderRadius:6,fontSize:p?14:16,color:e.text.tertiary,paddingLeft:4,paddingRight:12},icon:{...p?{width:12,height:12,marginLeft:10,marginRight:6}:{width:16,height:16,marginLeft:3,marginRight:8},fill:e.lightIconColor},buttonContainer:{display:"flex"}})),[p,s]);return m?(0,E.jsxs)("div",{style:S.buttonContainer,children:[(0,E.jsxs)(It().A,{onClick:g,onMouseDown:Te().tr,style:S.button,children:[(0,ni().plusIcon)(S.icon),(0,E.jsx)(rr,{collectionContextStore:r})]}),(0,E.jsx)(gr().O,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,E.jsxs)(It().A,{style:S.button,...e,children:[(0,mr().arrowDiagonalUpRightIcon)(S.icon),(0,E.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,E.jsxs)(It().A,{onClick:g,onMouseDown:Te().tr,style:S.button,children:[(0,ni().plusIcon)(S.icon),(0,E.jsx)(rr,{collectionContextStore:r})]})}));class Id extends p().default{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const Ad=Id;var jd=()=>o(719395);function Rd(e){let{isPhone:t,elementWidth:o,paddingLeft:n,paddingRight:r,propertyWidths:i}=e;let l=o-n-r,a=0;for(let c=0;c<i.length;c++){if(l-=i[c]??0,a=c,l<=0)break}const s=a+1;return i.length>s+(t?2:5)}const Td=n.memo((function(e){let{collectionContextStore:t,tableProperties:r,paddingLeft:i,paddingRight:l,children:s}=e;const c=(0,a().v3)(),{isPhone:u}=(0,a().Y0)(),p=(0,n.useRef)(null),m=(0,n.useContext)(ye().R),g=(0,n.useMemo)((()=>r.filter((e=>e.visible))),[r]),S=(0,d().K8)((()=>{var e;return null==m||null===(e=m.horizontalScroller)||void 0===e?void 0:e.getStore().state.element}),[m]),h=(0,d().K8)((()=>{const e=t.frozoneStore.state.frozenIndex;return void 0===e?0:e+1}),[t]),f=(0,d().K8)((()=>g.map((e=>(0,j().oe)({environment:c,propertyFormat:e})))),[c,g]),[y,v]=(0,n.useState)((()=>{var e;return Rd({isPhone:u,elementWidth:(null==S||null===(e=S.deref())||void 0===e?void 0:e.clientWidth)??0,paddingLeft:i,paddingRight:l,propertyWidths:f})}));(0,n.useEffect)((()=>{t.virtualizedModule.setVirtualizedColumnsEnabled(y)}),[y,t]);const x=(0,n.useCallback)((e=>{O().default.state.open&&O().default.state.mode===o(86211).A||v(Rd({isPhone:u,elementWidth:e.width,paddingLeft:i,paddingRight:l,propertyWidths:f}))}),[i,l,f,u]);(0,o(892206).tK)(p,x);const b=(0,n.useCallback)((e=>e+h>f.length-1?35:f[e+h]??35),[f,h]),C=(0,Xo().Te)({enabled:y,count:g.length,estimateSize:b,scrollMargin:i,getScrollElement:()=>(null==S?void 0:S.deref())??null,getItemKey:e=>g[e].property||e,overscan:2,horizontal:!0}),w=C.getVirtualItems(),[k,I]=(0,n.useMemo)((()=>w.length>0?[w[0].start-i,C.getTotalSize()+i-w[w.length-1].end]:[0,0]),[w,C,i]),A=0===w.length?0:h+w[0].index,R=0===w.length?0:w[w.length-1].index+1,{propertiesInRange:T,propertiesInRangeIndices:M}=(0,n.useMemo)((()=>0===w.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:g.slice(A,R),propertiesInRangeIndices:Array.from({length:R-A},((e,t)=>A+t))}),[w.length,R,A,g]),_=(0,n.useMemo)((()=>({propertiesInRange:T,propertiesInRangeIndices:M,beforeWidth:k,afterWidth:I})),[I,k,T,M]);return(0,E.jsx)(jd().Pr.Provider,{value:C,children:(0,E.jsx)(jd().Z6.Provider,{value:y,children:(0,E.jsx)(jd().Wm.Provider,{value:_,children:s})})})}));var Md=()=>o(810111),_d=()=>o(5612),Pd=()=>o(125978),Bd=()=>o(280630);const Vd=Object.freeze({display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"});function Fd(e){(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{}})}function Ld(e,t){return!e&&t}var Od=()=>o(252408),Ed=()=>o(724217);const Dd=n.memo((function(e){const{disabled:t,property:r,schema:i,collectionContextStore:l,groupFormat:s,propertyFormat:c,isHovered:p,aggregation:m,onChange:g}=e,S=(0,a().v3)(),{isMobile:h}=(0,a().Y0)(),y=(0,L().X)("db_ux_empty_states"),x=(0,L().X)("db_ux_chrome"),b=(0,pt().tz)(),[C,w]=(0,n.useState)(void 0),k=(0,n.useMemo)((()=>Boolean((null==c?void 0:c.width)&&c.width<100)),[c]),I=(0,d().K8)((()=>Wi(l,m)),[l,m]),A=(0,d().K8)((()=>{if(!m)return;return{type:"aggregation",filter:s?(0,Yo().Yy)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:s,timeZone:(0,Qo().P)(),experimentService:Fo().default}):void 0,aggregation:m}}),[i,s,m,l]),R=(0,n.useCallback)(((e,t)=>{if(e){const o={aggregator:e,property:r,enforceMaxAggregationLimit:t};g(r,o),w(o),(0,v().X)({environment:S,collectionContextStore:l,action:"table_change_aggregation"})}else g(r,void 0),(0,v().X)({environment:S,collectionContextStore:l,action:"table_remove_aggregation"})}),[S,g,r,l]),T=(0,u().IS)((()=>({buttonContainer:{display:"flex",justifyContent:"flex-end",alignItems:x?"center":"flex-start",width:"100%",marginRight:y?4:0},buttonStyle:{display:"flex",alignItems:"center",...y?{justifyContent:"center",height:"75%",padding:"0px 6px",borderRadius:6}:{justifyContent:"flex-end",width:"100%",height:(0,j().sG)({isMobile:h}),paddingRight:8},overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[x,y,h]);(0,n.useEffect)((()=>{C&&!Wi(l,C)&&(0,f().n4)(m,C)&&w(void 0)}),[I,C,l,m]);const M=(0,n.useMemo)((()=>k&&null!=m&&m.aggregator?Ki().zY[(0,Di().V1)(m)]:void 0),[k,m]),_=(0,n.useMemo)((()=>{const e=null==A?void 0:A.aggregation;if(!e)return"";let t=`${e.aggregator}`;return"object"==typeof e.aggregator&&"operator"in e.aggregator&&(t=`${e.aggregator.operator}:${e.aggregator.groupName}`),`table:${(0,Mo().Ix)(s)}:${r}:${t}`}),[s,r,null==A?void 0:A.aggregation]),P=(0,n.useCallback)((e=>A?(0,E.jsx)(bn().A,{id:_,collectionContextStore:l,reducer:A,groupsPointer:s?[s]:void 0,render:o=>(0,E.jsx)(jt().A,{alignment:k?Ee().C.Center:Ee().C.End,disableTooltip:!I&&!M,renderTooltip:()=>I?b.formatMessage($i.aggregationCalculating):M,render:n=>(0,E.jsx)(It().A,{disabled:t,style:T.buttonStyle,...(0,Hi().A)(n,e),children:(0,E.jsx)(zd,{resultStore:o,aggregation:m,schema:i,property:r,hideLabelText:k})})})}):h?null:(0,E.jsx)(It().A,{disabled:t,style:T.buttonStyle,...e,children:(0,E.jsx)(Kd,{disabled:t,isHovered:p,hideLabelText:k})})),[A,_,l,h,s,t,T.buttonStyle,p,k,I,M,b,m,i,r]),B=(0,n.useCallback)((e=>{let{close:t}=e;return(0,E.jsx)(o(808532).A,{currentAggregation:m,property:r,schema:i,onChange:R,onClose:t,source:"tableAggregation"})}),[R,m,r,i]);return(0,E.jsx)("div",{style:T.buttonContainer,children:(0,E.jsx)(qi().Ay,{popupType:h?qi().z7.SlideUp:qi().z7.Popup,disabled:t,renderOrigin:P,render:B})})})),zd=n.memo((function(e){const{aggregation:t,resultStore:r,schema:i,property:l,hideLabelText:s}=e,c=(0,L().X)("db_ux_empty_states"),p=(0,ee().ET)(),{isMobile:m}=(0,a().Y0)(),g=(0,u().IS)((e=>c?{container:{display:"flex",fontSize:m?12:10,fontWeight:500},valueStyle:{color:e.text.primary,alignItems:"center",height:"100%"},aggregationTypeNameStyle:{color:e.text.tertiary,textTransform:"uppercase",letterSpacing:1,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}:{container:{display:"flex",justifyContent:"center",alignItems:"center"},valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:m?12:10,textTransform:"uppercase",letterSpacing:1,color:e.text.secondary,marginTop:m?0:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}),[c,m]),S=(0,d().O$)(r),h=(0,n.useMemo)((()=>{if(!t)return;let e=Ki().SE[(0,Di().V1)(t)];return(0,Di().ET)(t.aggregator)&&(e=t.aggregator.groupName in Ed().OR?Ed().OR[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:f,numberPrecision:y}=(0,d().K8)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,Ki().zI)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(755786).pg)(p,r),a=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),s=null==a?void 0:a[e.target_property];if("number"===(null==s?void 0:s.type)){const e=s.number_format,o=s.number_precision;return{numberFormat:e,numberPrecision:t?(0,Ki().zI)(t.aggregator,o):o}}}return{}}),[i,l,t,p]);if(!h)return null;const v=(0,E.jsx)("span",{style:g.valueStyle,children:t&&(0,E.jsx)(Gi,{aggregation:t,collectionContextStore:p,children:S?(0,Ki().rv)({numberFormat:f,dateFormat:void 0,aggregation:t,userTimeZone:(0,Qo().P)(),value:S.aggregationResult,numberPrecision:y}):void 0})},"value");return s?v:(0,E.jsxs)("div",{style:g.container,children:[(0,E.jsx)("span",{style:g.aggregationTypeNameStyle,children:h},"type"),v]})})),Kd=n.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,i=(0,L().X)("db_ux_empty_states"),{isMobile:l}=(0,a().Y0)(),s=(0,u().IS)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.text.tertiary},chevronIcon:{width:10,marginLeft:r?1:4,marginTop:1,fill:e.lightIconColor},summationIcon:{width:12,marginTop:1,fill:e.lightIconColor}})),[r]);return t||!n&&!l?null:(0,E.jsx)(kt().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:s.placeholderWrapper,children:(0,E.jsxs)("div",{style:s.placeholderWrapper,children:[r?(0,E.jsx)("span",{style:s.placeholderText,children:(0,o(418908).n)(s.summationIcon)},"placeholder"):(0,E.jsx)("span",{style:s.placeholderText,children:(0,E.jsx)(pt().sA,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),!i&&(0,Ll().b)(s.chevronIcon)]})})})),Hd=n.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:i,isInPeekRenderer:l,query:s,schema:c,showPropertyFormats:p,showRightActionsSpacer:m,pageCount:g,style:S,paddingLeft:h,paddingRight:f,onMouseEnter:y,onMouseLeave:v,disableSticky:x}=e;const b=(0,a().v3)(),{isPhone:C,isMobile:w}=(0,a().Y0)(),k=(0,L().X)("db_ux_empty_states"),I=(0,u().DP)(),[A,R]=(0,n.useState)(!1),T=(0,d().K8)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:_,frozenPropertyFormats:P,unfrozenPropertyFormats:B}=(0,d().K8)((()=>{const e=p;let t=[],o=e;const n=(0,M().qi)(T);return void 0!==T&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[T,p]),V=(0,d().O$)(t.isInHomeWidgetStore),F=(0,d().K8)((()=>{var e;return Boolean(null===(e=s.aggregations)||void 0===e?void 0:e.length)}),[s.aggregations]),O=(0,n.useMemo)((()=>g>0&&!o),[g,o]),D=(0,d().O$)(Wt().A),z=(0,M().Oz)(t),K=(0,u().IS)((e=>{const t=V?void 0:(null==z?void 0:z.background)||(l?e.cardContentBackground:e.contentBackground);return{aggregationRow:{borderTop:!k||O?`1px solid ${e.tableDividerColor}`:"none",display:"flex",background:t,zIndex:85,fontSize:14,height:(0,j().sG)({isMobile:w})+(i&&!r?D:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,boxSizing:"border-box",...S},stickyStyle:{paddingLeft:h,paddingRight:f,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingRight:!o&&m?32:0},innerContainer:{display:"flex"}}}),[V,null==z?void 0:z.background,l,k,w,i,r,D,S,h,f,o,m,O]),H=(0,d().K8)((()=>void 0!==T&&(0,j().wy)({environment:b,collectionContextStore:t,isPhone:C,theme:I})),[T,b,t,C,I]),W=(0,n.useCallback)((()=>{R(!0),null==y||y()}),[R,y]),G=(0,n.useCallback)((()=>{R(!1),null==v||v()}),[R,v]),N=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{}})}),[]),$=(0,n.useCallback)(((e,n)=>(0,E.jsx)(Wd,{propertyFormat:e,groupFormat:r,disabled:o,mouseEntered:A,collectionContextStore:t,schema:c,query:s},e.property)),[t,o,r,A,s,c]),U=!V&&(F||i),q=(0,n.useRef)(null),X=(0,E.jsx)(rt().s,{allowSelectionWithin:!1,style:K.aggregationRow,onMouseMove:W,onMouseLeave:G,onMouseDown:N,ref:q,children:(0,E.jsx)("div",{style:K.container,children:(0,E.jsxs)("div",{style:K.innerContainer,children:[void 0!==T&&(0,E.jsx)("div",{style:{...H,display:"flex"},children:P.map($)}),B.map(((e,t)=>$(e,t+_)))]})})});return!(0,d().O$)(Ke().e)?null:U?(0,E.jsx)(sl().g,{stickyAttachPoint:x?"no-stick":"floor",stickyStyle:K.stickyStyle,nodeRef:q,children:X}):X})),Wd=n.memo((function(e){var t;let{propertyFormat:r,groupFormat:i,disabled:l,mouseEntered:s,collectionContextStore:c,query:p,schema:m}=e;const g=(0,a().v3)(),[S,h]=(0,n.useState)(!1),f=(0,L().X)("db_ux_empty_states"),y=(0,u().IS)((()=>({wrapper:{display:"flex",width:r.width}})),[r.width]),v=(0,n.useCallback)(((e,t)=>{(0,o(68486).I)({environment:g,collectionContextStore:c,query:p,property:e,newAggregation:t})}),[c,p,g]),x=(0,d().K8)((()=>!l&&(f?S:!!s)),[s,l,S,f]),b=(0,n.useCallback)((()=>{h(!0)}),[h]),C=(0,n.useCallback)((()=>{h(!1)}),[h]);return(0,E.jsx)("div",{style:y.wrapper,onMouseEnter:b,onMouseLeave:C,children:(0,E.jsx)(Dd,{groupFormat:i,propertyFormat:r,disabled:l,isHovered:x,aggregation:null===(t=p.aggregations)||void 0===t?void 0:t.find((e=>e.property===r.property)),property:r.property,collectionContextStore:c,schema:m,onChange:v})})})),Gd=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,handleAddRowClick:r,numberOfBlankRows:i,isBlockPropertyValueOverlayOpen:l,propertyFormats:s,hideDefaultButtonText:c,query:p}=e,{isMobile:m}=(0,a().Y0)(),g=(0,L().X)("db_ux_empty_states"),[S,h]=(0,n.useState)(0),f=(0,n.useCallback)((()=>{h(0)}),[]),y=(0,n.useCallback)((()=>{h(0)}),[]),v=(0,d().O$)(o.isInHomeWidgetStore),x=(0,d().K8)((()=>{var e;return Boolean(null===(e=p.aggregations)||void 0===e?void 0:e.length)}),[p.aggregations]),b=(0,u().IS)((e=>{const t=v?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n,icon:r}=(0,j().BJ)({theme:e,isMobile:m,hideTextWithTransition:c,hideTextWithoutTransition:l});return{button:{...o,transition:"background 0.2s ease",borderBottom:`1px solid ${t}`,paddingLeft:g?0:8},buttonHovered:{background:e.tableRowHoveredBackground},icon:r,firstRow:{...n,...!g&&{opacity:0!==S||c?0:1},height:"100%"},lastRow:{...!g&&{borderBottom:"none"},...g&&!x&&{marginBottom:6}},text:{...n,height:"100%"}}}),[c,l,S,x,g,v,m]);return 0===s.length?null:(0,E.jsxs)("div",{onMouseLeave:f,ref:t,children:[(0,E.jsx)(It().A,{className:we().$0P,onClick:r,onMouseDown:Te().tr,style:b.button,hoveredStyle:b.buttonHovered,onMouseEnter:y,children:(0,E.jsx)("span",{style:b.firstRow,children:g?(0,E.jsx)(Nd,{propertyFormats:s,collectionContextStore:o,isRowHovered:0===S}):(0,E.jsxs)(E.Fragment,{children:[(0,tr().plusSmallIcon)(b.icon),(0,E.jsx)(rr,{collectionContextStore:o})]})})},"add-row-button-default"),Array.from({length:i}).map(((e,t)=>{const n=t+1,l=n===i,a=S===n?1:0;return(0,E.jsx)(It().A,{className:we().Mbm,onClick:r,onMouseDown:Te().tr,style:{...b.button,...l&&b.lastRow},hoveredStyle:b.buttonHovered,onMouseEnter:()=>h(n),children:(0,E.jsx)("span",{style:{...b.text,...!g&&{opacity:a}},children:g?(0,E.jsx)(Nd,{propertyFormats:s,collectionContextStore:o,isRowHovered:S===n}):(0,E.jsxs)(E.Fragment,{children:[(0,tr().plusSmallIcon)(b.icon),(0,E.jsx)(rr,{collectionContextStore:o})]})})},n)}))]})})));function Nd(e){const{propertyFormats:t,collectionContextStore:o,isRowHovered:n}=e;return(0,E.jsx)(E.Fragment,{children:t.map(((e,r)=>(0,E.jsx)($d,{propertyFormat:e,collectionContextStore:o,isRowHovered:n,isFirstColumn:0===r,showCellBorder:1===t.length||r!==t.length-1},e.property)))})}function $d(e){const{propertyFormat:t,collectionContextStore:o,isRowHovered:n,isFirstColumn:r,showCellBorder:i}=e,l=(0,a().v3)(),{isMobile:s}=(0,a().Y0)(),c=(0,d().K8)((()=>(0,j().oe)({environment:l,propertyFormat:t})),[l,t]),p=(0,u().IS)((e=>({tableCell:{display:"flex",width:c,height:"100%",position:"relative",borderRight:i?`1px solid ${e.tableDividerColor}`:"none"},icon:{width:Ao().Ev.sm,height:Ao().Ev.sm,marginLeft:s?0:1,marginRight:7,fill:e.lightIconColor},newPageLabel:{display:"flex",alignItems:"center",paddingLeft:8,minWidth:100}})),[c,s,i]);return(0,E.jsx)("div",{style:p.tableCell,children:n&&r?(0,E.jsxs)("div",{style:p.newPageLabel,children:[(0,tr().plusSmallIcon)(p.icon),(0,E.jsx)(rr,{collectionContextStore:o})]}):null})}var Ud=()=>o(124967),qd=()=>o(499222);const Xd=n.memo((function(e){const{collectionContextStore:t,groupFormat:o,handleAddRowClick:n,hasSearchQuery:r,hasFilter:i,hasMultipleGroups:l,shouldShowAddRowButton:s,shouldShowLinkButton:c,left:p,height:m}=e,g=(0,L().X)("db_ux_empty_states"),{isMobile:S}=(0,a().Y0)(),h=(0,d().O$)(t.isInHomeWidgetStore),f=(0,u().IS)((e=>{const t=h?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n}=(0,j().BJ)({theme:e,isMobile:S});return{button:{...o,borderBottom:`1px solid ${t}`},buttonInner:n}}),[h,S]);return g&&(i||r)?(0,E.jsx)(Yd,{hasMultipleGroups:l,left:p,height:m,children:(0,E.jsx)(Qd,{collectionContextStore:t,groupFormat:o,handleAddRowClick:n,hasSearchQuery:r,hasFilter:i,shouldShowAddRowButton:s,shouldShowLinkButton:c})}):(0,E.jsx)(It().A,{className:we().Mbm,onClick:n,onMouseDown:Te().tr,disabled:!s,style:f.button,children:s?(0,E.jsx)("span",{style:f.buttonInner,children:i?(0,E.jsx)(pt().sA,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,E.jsx)(pt().sA,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,E.jsx)("span",{style:f.buttonInner,children:i?(0,E.jsx)(pt().sA,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,E.jsx)(pt().sA,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})})),Yd=n.memo((function(e){const{hasMultipleGroups:t,left:o,height:n,children:r}=e,{isMobile:i}=(0,a().Y0)(),l=(0,u().IS)((()=>({container:{position:"sticky",display:"flex",height:n||(i?t?144:216:144),gap:4},stickyContainer:{left:o,transform:"translateX(-50%)",position:"sticky",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"}})),[t,n,i,o]);return(0,E.jsx)("div",{style:{width:"100%",overflowX:"initial"},children:(0,E.jsx)("div",{style:l.container,className:we().Mbm,children:(0,E.jsx)("div",{style:l.stickyContainer,children:r})})})}));function Qd(e){const{collectionContextStore:t,groupFormat:r,handleAddRowClick:i,hasSearchQuery:l,hasFilter:s,shouldShowAddRowButton:c,shouldShowLinkButton:d}=e,p=(0,a().v3)(),{isMobile:m}=(0,a().Y0)(),g=(0,n.useCallback)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id;o&&((0,qd().E)({userId:p.currentUser.id,collectionViewId:o,isOpen:!0}),t.filtersBarOpenStore.setState(!0))}),[t,p]),S=(0,n.useCallback)((()=>{t.searchQueryStore.setState("")}),[t]),h=(0,u().IS)((e=>{const{buttonInner:t}=(0,j().BJ)({theme:e,isMobile:m});return{container:{overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},iconStyle:{width:16,fill:t.color},buttonInner:t,menuButton:{width:"auto",color:"inherit"}}}),[m]),f=(0,n.useCallback)((e=>(0,E.jsx)("div",{style:h.container,children:(0,E.jsx)(dr().p,{...e,...l?{}:{icon:Ud().$,iconStyle:h.iconStyle},children:(0,E.jsx)("span",{style:h.buttonInner,children:l?(0,E.jsx)(pt().sA,{defaultMessage:"No search results",id:"database.tableView.noResults.emptyTablePlaceholderWithSearch"}):(0,E.jsx)(pt().sA,{defaultMessage:"No filter results",id:"database.tableView.noResults.emptyTablePlaceholderWithFilters"})})})})),[h,l]),y=(0,n.useCallback)((e=>{const n=[l?{key:"clear-search",render:t=>(0,E.jsx)(Ui().A,{...t,title:(0,E.jsx)(pt().sA,{defaultMessage:"Clear search",id:"database.tableView.emptyTablePlaceholderWithFilters.clearSearch"}),icon:(0,E.jsx)(Lr().I,{icon:o(755564).N}),buttonStyle:h.menuButton,onClick:()=>{S(),e.close()}}),action:()=>{}}:null,s?{key:"edit-filter",render:t=>(0,E.jsx)(Ui().A,{...t,title:(0,E.jsx)(pt().sA,{defaultMessage:"Edit filter",id:"database.tableView.emptyTablePlaceholderWithFilters.editFilter"}),icon:(0,E.jsx)(Lr().I,{icon:o(686752).pencilLineIcon}),buttonStyle:h.menuButton,onClick:()=>{g(),e.close()}}),action:()=>{}}:null,d?{key:"link-existing",render:e=>(0,E.jsx)(gr().O,{collectionContextStore:t,groupFormat:r,renderLinkButton:t=>(0,E.jsx)(Ui().A,{...e,title:(0,E.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"}),icon:(0,E.jsx)(Lr().I,{icon:mr().arrowDiagonalUpRightIcon}),buttonStyle:h.menuButton,...t})}),action:()=>{}}:null,c?{key:"add-row",render:t=>(0,E.jsx)(Ui().A,{...t,title:(0,E.jsx)(pt().sA,{defaultMessage:"Create a new page",id:"database.tableView.emptyTablePlaceholderWithFilters.addRow"}),icon:(0,E.jsx)(Lr().I,{icon:ni().plusIcon}),buttonStyle:h.menuButton,onClick:t=>{i(t),e.close()}}),action:()=>{}}:null];return(0,E.jsx)(Ti().A,{menuType:ji().gu.Popup,children:(0,E.jsx)(Mi().Ay,{style:{padding:4},initialFocus:0,type:Mi().Oh.Vertical,sections:[{key:"empty-results",render:e=>(0,E.jsx)(Pi().A,{...e,hideTitle:!0}),items:n.filter((e=>null!==e))}]})})}),[l,s,d,c,h.menuButton,S,g,t,r,i]);return(0,E.jsx)(qi().Ay,{popupType:qi().z7.Popup,placementToOrigin:qi().sx.Top,alignmentToOrigin:qi().yP.Center,renderOrigin:f,render:y})}var Zd=()=>o(944342),Jd=()=>o(829090),eu=()=>o(981133),tu=()=>o(402047);const ou={position:"absolute",display:"flex",opacity:.5,zIndex:81},nu=function(e){const t=(0,n.useRef)(null),r=(0,n.useRef)(),i=(0,d().uB)(e.store,o(121686).A),l=(0,d().O$)(i),{direction:a,sectionedKeys:s,sectionStyles:c,keys:u,disableVerticalEdgeScroll:p,disableHorizontalEdgeScroll:m,disabled:g,renderKey:S}=e,h={..."horizontal"===a?Ka().Z0:Ka().Bb,...l.isDragging&&{position:"relative",zIndex:1,width:l.savedContainerRect.width,height:l.savedContainerRect.height},...e.style};function v(e){return"string"==typeof e?e:e.key}const x=(0,d().K8)((()=>u.map(((e,t)=>{const o=v(e),n=S(o,t,t===u.length-1);if(l.isDragging&&l.draggingKey===o){const{savedKeyRects:e,savedContainerRect:r,currentXOffset:i,currentYOffset:s}=l,c=e[t];let d,u;"vertical"===a?(d=(0,Zd().A)(c.top+s,r.top,r.top+r.height-c.height)-r.top,u=c.left-r.left):(d=c.top-r.top,u=(0,Zd().A)(c.left+i,r.left,r.left+r.width-c.width)-r.left);const p={...ou,left:u,top:d,width:c.width,height:c.height,zIndex:1};return(0,E.jsx)("div",{style:p,children:n},o)}}))),[u,S,a,l]);function b(){const{direction:o}=e;return!r.current&&t.current&&(r.current="vertical"===o?(0,F().NM)(t.current):(0,F().T8)(t.current)),r.current}const C=g?{}:{onDraggableDragCancel:()=>{l.isDragging&&i.reset()},onDraggableDragEnd:()=>{if(l.isDragging){const{keys:t,onDrop:o}=e,{startKeyPosition:n,currentKeyPosition:r}=l;if(n!==r){const e=f().o8(t);e.splice(r,0,e.splice(n,1)[0]);const i=v(t[n]);o(e.map(v),{key:i,startPosition:n,endPosition:r})}e.onDragEnd&&e.onDragEnd(),i.reset()}},onDraggableDragStart:o=>{o.preventDefault();const{keys:n}=e,r=t.current;if(!r)return;if(!(r instanceof Element))return;const l=tu().EV(o.target,(e=>tu().vq(e)&&e.classList.contains(we().wAf))),a=tu().EV(o.target,(e=>e.parentNode===l));if(l&&a){const t=Jd().PE(r.children).indexOf(l),o=Jd().PE(l.children).indexOf(a);let c=0;const d=Object.keys(s);for(let e=0;e<t;e++)c+=s[d[e]].length;c+=o;const u=n[c];if("object"==typeof u&&!u.draggable)return;const p=r.getBoundingClientRect(),m=f().Bq(Object.keys(s).map(((e,t)=>s[e].map(((e,o)=>r.children[t].children[o].getBoundingClientRect()))))),g=b();if(g){const t=v(n[c]);e.onDraggingKeyChanged&&e.onDraggingKeyChanged(t),i.setState({isDragging:!1,willDrag:!0,currentXOffset:0,currentYOffset:0,draggingKey:t,startKeyPosition:c,startScrollX:g.scrollLeft,startScrollY:g.scrollTop,currentKeyPosition:c,savedContainerRect:p,savedKeyRects:m})}}},onDraggableDragMove:t=>{!l.isDragging&&l.willDrag&&l.draggingKey&&(0,eu().A)(t.startX,t.startY,t.currentX,t.currentY)>=_e().tC[t.device]&&(i.setState({currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset,startScrollX:l.startScrollX,startScrollY:l.startScrollY,startKeyPosition:l.startKeyPosition,currentKeyPosition:l.currentKeyPosition,savedKeyRects:l.savedKeyRects,savedContainerRect:l.savedContainerRect,draggingKey:l.draggingKey,isDragging:!0,willDrag:!1}),e.onDragStart&&e.onDragStart());const o=b();if(l.isDragging&&o){const{savedKeyRects:e,startScrollX:n,startScrollY:r}=l,a=o.scrollLeft-n,s=o.scrollTop-r,c=f().wq(e,(e=>(0,eu().A)(t.currentX+a,t.currentY+s,e.left+e.width/2,e.top+e.height/2)));if(c){const o=e.indexOf(c);i.setState({...l,currentXOffset:t.diffX+a,currentYOffset:t.diffY+s,currentKeyPosition:o})}}}};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(hc().A,{...C,forceTouch:!0,allowDragWhileTextEditing:!0,disableVerticalEdgeScroll:p||"horizontal"===a,disableHorizontalEdgeScroll:m||"vertical"===a,render:o=>{let n=0;return(0,E.jsx)("div",{ref:t,style:h,...o,children:Object.entries(s).map((t=>{let[o,r]=t;const i=((e,t)=>(0,E.jsx)("div",{className:we().wAf,style:null==c?void 0:c[e],children:t},e))(o,r.map(((t,o)=>((t,o)=>{const n=v(t),r=e.keys.map(v),i=S(n,o,r.length-1===o);let a="";if(l.isDragging){const{startKeyPosition:t,currentKeyPosition:n}=l;t===n?a="":"horizontal"===e.direction?n===o&&o<t?a=`inset 4px 0 ${or().Ay.blueWithAlpha(.5)}`:n===o&&o>t&&(a=`inset -4px 0 ${or().Ay.blueWithAlpha(.5)}`):"vertical"===e.direction&&(n===o&&o<t?a=`inset 0 4px ${or().Ay.blueWithAlpha(.5)}`:n===o&&o>t&&(a=`inset 0 -4px ${or().Ay.blueWithAlpha(.5)}`))}return(0,E.jsx)("div",{style:{display:"flex",flexDirection:"vertical"===e.direction?"column":"horizontal"===e.direction?"row":(0,y().HB)(e.direction),boxShadow:a},children:i},n)})(t,o+n))));return n+=r.length,i}))})}}),x]})};const ru={viewBox:"0 0 16 16",svg:(0,E.jsx)("path",{d:"M8 1.95a6.05 6.05 0 1 0 0 12.1 6.05 6.05 0 0 0 0-12.1m0 3.5a.55.55 0 0 1 .55.55v1.45H10a.55.55 0 1 1 0 1.1H8.55V10a.55.55 0 1 1-1.1 0V8.55H6a.55.55 0 1 1 0-1.1h1.45V6A.55.55 0 0 1 8 5.45"})},iu=(0,Ao().wt)("plusCircleFillSmall",ru);var lu=()=>o(261603),au=()=>o(862384),su=()=>o(466321),cu=()=>o(59175);const du=(0,pt().YK)({inputPlaceholder:{defaultMessage:"Type property name...",id:"collectionTable.addColumnContainer.inputPlaceholder"}});function uu(e){const{nameInput:t,setNameInput:o,buttonPopupStore:r}=e,i=(0,pt().tz)(),l=(0,n.useRef)(null),s=(0,a().v3)(),c=(0,n.useRef)(null),p=(0,d().K8)((()=>r.state.open),[r]),m=(0,n.useCallback)((()=>{se().default.reset(),ce().default.reset(),Od().A.reset(),l.current&&(0,F().$v)({element:l.current,environment:s,blockAlignment:"center",inlineAlignment:"nearest",behavior:"smooth",additionalPadding:{left:20,right:20}})}),[s,l]),g=(0,n.useCallback)((()=>{r.setState({...r.state,open:!1}),o("")}),[o,r]),S=(0,n.useCallback)((e=>{"Escape"===e.key&&g()}),[g]),h=(0,n.useCallback)((e=>{o(e.target.value)}),[o]),f=(0,u().IS)((e=>({container:{minWidth:400},input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.text.primary,marginBottom:1,width:200}})),[]);return(0,E.jsx)("div",{ref:l,style:f.container,children:(0,E.jsx)(cu().A,{ref:c,focusInitial:p,style:f.input,focus:p,format:cu().C.Transparent,value:t,onChange:h,placeholder:i.formatMessage(du.inputPlaceholder),showClearButton:!0,onFocus:m,onCancel:g,onClearButtonClick:g,onKeyDown:S,onMouseDown:Te().tr})})}const pu=(0,pt().YK)({addProperty:{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty.ariaLabel"}}),mu=n.memo((function(e){const{collectionContextStore:t}=e,r=(0,a().v3)(),i=(0,pt().tz)(),l=(0,L().X)("db_ux_chrome"),s=(0,L().X)("db_ux_properties"),{isMobile:c}=(0,a().Y0)(),p=(0,d().O$)(t.normalizedSchemaStore),m=(0,n.useMemo)((()=>Object.keys(p).length<=1),[p]),[g,S]=(0,n.useState)(""),h=(0,u().IS)((e=>({button:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"auto",borderRadius:0,padding:8},iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm,...l&&{fill:(0,o(916963).P0)({theme:e,willShowOnTooltip:!1})}},longButton:{display:"flex",alignItems:"center",justifyContent:"center",height:"75%",width:"100%",paddingLeft:6,paddingRight:6,fontSize:14},smallButton:{display:"flex",alignItems:"center",justifyContent:"start",height:28,width:28,overflow:"hidden",paddingLeft:6,paddingRight:6,fontSize:14},smallButtonHovered:{width:"auto",paddingRight:8}})),[l]),f=(0,d().uB)(void 0,De().A),y=(0,n.useCallback)((()=>{f.setState({...f.state,open:!1}),S("")}),[f,S]),b=(0,n.useCallback)(((e,n,i,l)=>{o(487454).nZ({environment:r,collectionContextStore:t,propertyType:e,isSuggestedProperty:n,propertyName:i,selectOptions:l,from:"table",shouldOpenEditMenu:!s}),y()}),[t,r,y,s]),C=(0,n.useCallback)(((e,t,o,n)=>{b(e,t,g.length>0?g:o,n)}),[b,g]),w=(0,n.useCallback)((()=>{t.collectionStore()&&(I().clear({environment:r}),k().IU({environment:r}),(0,au().y)(),(0,v().X)({environment:r,collectionContextStore:t,action:"click_new_property"}),x().R8({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:b}}))}),[t,r,b]),A=(0,d().K8)((()=>f.state.open),[f]),j=(0,n.useCallback)((e=>A&&s?(0,E.jsx)(uu,{nameInput:g,setNameInput:S,buttonPopupStore:f}):(0,E.jsx)(dr().p,{testId:"add-column-button",style:m?h.longButton:h.smallButton,hoveredStyle:m?void 0:h.smallButtonHovered,onMouseDown:Fd,icon:m?iu:tr().plusSmallIcon,iconStyle:h.iconStyle,isGray:!0,...e,children:(0,E.jsx)(pt().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"})})),[h.longButton,h.smallButton,h.smallButtonHovered,m,h.iconStyle,g,s,A,f]),R=(0,n.useCallback)((()=>(0,E.jsx)(lu().FZ,{collectionContextStore:t,collectionSettingsStore:t.settingsStore,onAccept:C,nameInput:g,handleClosePopup:y})),[t,C,g,y]),T=(0,n.useCallback)((()=>{I().clear({environment:r}),k().IU({environment:r}),(0,au().y)(),(0,v().X)({environment:r,collectionContextStore:t,action:"click_new_property"})}),[r,t]),M=(0,d().O$)(t.permissionScopesStore);return l?c||!s?j({onClick:w}):(0,E.jsx)(qi().Ay,{popupType:su().n.Popup,disabled:!M.canConfigureBlock,originGap:9,alignmentToOrigin:qi().yP.Start,buttonPopupStore:f,renderOrigin:j,render:R,onClick:T,onClose:y}):(0,E.jsx)(At().A,{testId:"add-column-button",style:h.button,onMouseDown:Fd,onClick:w,icon:tr().plusSmallIcon,iconStyle:h.iconStyle,ariaLabel:i.formatMessage(pu.addProperty)})}));function gu(e){let{collectionContextStore:t}=e;const o=(0,a().v3)(),r=(0,u().IS)((e=>({dotsIcon:{width:12,fill:e.mediumIconColor},button:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}})),[]),i=(0,n.useCallback)((()=>{x().Ow({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),(0,v().X)({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),x().a2({collectionSettingsStore:t.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}),[t,o]);return(0,E.jsx)(It().A,{style:r.button,onMouseDown:Fd,onClick:i,className:we().LcC,children:(0,E.jsx)("div",{style:Vd,children:(0,gi()._)(r.dotsIcon)})})}var Su=()=>o(332284);const hu=n.memo((function(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:i,isShimmerRow:l}=e,a=(0,L().X)("db_ux_chrome"),s=(0,n.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,ac().X4)(or().CM[e.mode].gray,.15)},${(0,ac().X4)(or().CM[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,ac().X4)(or().CM[e.mode].gray,.35)},${(0,ac().X4)(or().CM[e.mode].gray,.2)},  transparent)`),[o,t]),c=(0,u().IS)((e=>({container:{display:"flex",flexDirection:"row",height:"100%"},border:{position:"absolute",right:0,width:a?1:2,height:l?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-3,width:3,height:l?34:"100%",background:s(e)},animate:{opacity:r?1:0}})),[a,l,o,t,s,r]);return(0,E.jsxs)("div",{style:c.container,children:[i?null:(0,E.jsx)("div",{style:c.border}),(0,E.jsx)(kt().A,{visible:!0,animate:c.animate,children:(0,E.jsx)("div",{style:c.shadow})})]})})),fu=n.memo((function(e){const{checkedState:t,onClick:r,checkboxType:i,collectionContextStore:l,isBlockHovered:s,passesFilter:c,disabled:p,frozoneProps:m}=e,g=(0,a().v3)(),S=(0,o(486905).Jj)(),h=(0,d().K8)((()=>S&&Su().default.state.isOpen&&Su().default.state.isPlusButtonVisible),[S]),[f,y]=(0,n.useState)(!1),v=(0,n.useRef)(null);(0,n.useEffect)((()=>{v.current&&(v.current.indeterminate="indeterminate"===t)}),[t]);const x=(0,d().O$)(nn().Hf),b=(0,n.useCallback)((e=>{if(p)return;r(e);const t=(0,ke().sl)(l)||{};xe().vd(g,"collection_multi_select_checkbox_clicked",{...t,checkbox_type:i})}),[p,i,l,g,r]),C=(0,n.useMemo)((()=>h?0:!1===t&&!f||x?s?.6:null!=m&&m.shouldShowStickyMultiSelectColumn?.4:0:1),[t,f,x,s,null==m?void 0:m.shouldShowStickyMultiSelectColumn,h]),w=(0,u().IS)((e=>{const t=null!=m&&m.shouldShowStickyMultiSelectColumn?C>0?1:0:C;return{multiSelectCheckbox:{background:null!=m&&m.isScrolled?null==m?void 0:m.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=m&&m.isCollectionViewBlockSelected?or().Ay.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:vo().S8,height:vo().S8,cursor:p?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2},label:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:p?void 0:"pointer",zIndex:1},container:{width:`${vo().tG}px`,height:`${vo().tG}px`,display:"flex",justifyContent:"center",alignItems:"center"},animate:{opacity:t}}}),[C,p,null==m?void 0:m.frozenStyles.background,null==m?void 0:m.isCollectionViewBlockSelected,null==m?void 0:m.isScrolled,null==m?void 0:m.shouldShowStickyMultiSelectColumn]),k=(0,n.useCallback)((()=>{y(!0)}),[]),I=(0,n.useCallback)((()=>{y(!1)}),[]);return(0,E.jsxs)(kt().A,{animate:w.animate,style:w.multiSelectCheckbox,onMouseEnter:k,onMouseLeave:I,children:[(0,E.jsx)("div",{style:w.multiSelectCheckboxInner,children:(0,E.jsx)("label",{style:w.label,onClick:Te().kV,onMouseDown:Te().tr,children:(0,E.jsx)("div",{style:w.container,children:(0,E.jsx)("input",{type:"checkbox",style:w.checkBoxInput,ref:v,checked:!0===t,onChange:b,disabled:p})})})}),null!=m&&m.shouldFreezeMultiSelectColumn?(0,E.jsx)(hu,{isCollectionViewBlockSelected:null==m?void 0:m.isCollectionViewBlockSelected,passesFilter:c,isCheckbox:!0,isScrolled:!0}):null]})})),yu=n.memo((function(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:r,frozoneProps:i}=e,l=(0,a().v3)(),s=(0,n.useCallback)((()=>(0,re().v2)(t[0],o).filter((e=>e.canEdit()))),[o,t]),c=(0,d().K8)((()=>0===s().length),[s]),{checkedState:p,allVisibleItemsChecked:m}=(0,d().K8)((()=>{const e=s(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=se().default.state.stores.filter((t=>e.includes(t))).length;let n;return n=0!==o&&(o===t&&!r||"indeterminate"),{checkedState:n,allVisibleItemsChecked:o===t}}),[s,r]),g=(0,n.useCallback)((e=>{var t;const n=s(),r=se().default.state.stores,i=(0,j().ut)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===p||"indeterminate"===p&&!m?k().td({environment:l,stores:f().KC(i,n)}):(!0===p||"indeterminate"===p&&m)&&k().td({environment:l,stores:f().FF(i,...n)}),e.stopPropagation(),e.preventDefault()}),[p,o,l,s,m]),S=(0,d().K8)((()=>(0,M().f5)({environment:l,collectionContextStore:o})),[l,o]),h=(0,u().IS)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:S?{position:"absolute",left:-vo().Fh,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,S]);return(0,E.jsx)("div",{style:h.wrapper,children:(0,E.jsx)("div",{style:h.checkboxContainer,children:(0,E.jsx)(fu,{passesFilter:!0,checkedState:p,onClick:g,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:c})})})}));var vu=()=>o(170913),xu=()=>o(155347),bu=()=>o(991378);function Cu(e){const{origin:t,propertyType:o}=e,n=(0,a().v3)();return(0,E.jsx)(Yc().k,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,E.jsx)(pt().sA,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,E.jsx)(pt().sA,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,E.jsx)(pt().sA,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,y().HB)(o)}}(),content:function(){switch(o){case"owner":return(0,E.jsx)(pt().sA,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,E.jsx)("span",{style:{fontWeight:Ro().Wy.semibold},children:e})}});case"verification":return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(pt().sA,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,E.jsx)(xu().o,{href:(0,bo().xS)("guides.wikis"),style:{color:or().Ay.uiLightGray}})]});case"tags":return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(pt().sA,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,E.jsx)(xu().o,{href:(0,bo().xS)("guides.databaseProperties"),style:{color:or().Ay.uiLightGray}})]});default:(0,y().HB)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,y().HB)(o)}}(),onCloseClick:()=>{vu().ZP(n)},onPrimaryButtonClick:()=>vu().A6(n),onBackButtonClick:()=>vu().Jz(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:bu().gO,pointerOffset:bu().j$,style:{width:bu().Sw}})}var wu=()=>o(158247),ku=()=>o(711659);const Iu=new(le().O2)("TableHeaderCellMenu",(()=>Promise.all([o.e(36192),o.e(55373),o.e(62475),o.e(3151),o.e(98629),o.e(36209),o.e(92845),o.e(71718),o.e(83324),o.e(63077),o.e(41870),o.e(90966),o.e(88552),o.e(90214),o.e(8184),o.e(28271),o.e(17254),o.e(28721),o.e(33813),o.e(68455),o.e(91137),o.e(19167),o.e(47779)]).then(o.bind(o,740645)))),Au=(0,le()._h)(Iu,(e=>e.TableHeaderCellMenu));var ju=()=>o(90957),Ru=()=>o(853100),Tu=()=>o(806125),Mu=()=>o(824500),_u=()=>o(663073),Pu=()=>o(260682),Bu=()=>o(308439),Vu=()=>o(475105),Fu=()=>o(755989);function Lu(e){let{propertySchema:t}=e;const o=(0,Fu().kg)(t);return o?(0,E.jsx)(Ou,{featureName:o}):null}function Ou(e){let{featureName:t}=e;const o=(0,u().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:4,width:200,textWrap:"wrap"},title:{lineHeight:Ro().K_.UISmall.desktop,fontSize:Ro().J.UISmall.desktop},description:{lineHeight:Ro().K_.UIRegular.desktop,fontSize:Ro().J.UIRegular.desktop,color:e.text.secondary}})),[]),n=(0,Fu().uF)({featureName:t});if(null==n||!n.upsell)return null;const{upsellTier:r,expirationDate:i}=n;return(0,E.jsx)(jt().A,{placement:Ee().W.Top,render:e=>(0,E.jsx)("div",{...(0,Hi().A)(e),children:(0,E.jsx)(Lr().I,{icon:Bu().exclamationMarkTriangleIcon,color:"uiYellowPrimary",style:{padding:2}})}),renderTooltip:()=>(0,E.jsxs)("div",{style:o.container,children:[(0,E.jsx)("div",{style:o.title,children:(0,E.jsx)(Vu().ZY,{upsellTier:r})}),(0,E.jsx)("div",{style:o.description,children:(0,E.jsx)(Vu().H5,{expirationDate:i})})]})})}const Eu=(0,pt().YK)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),Du=n.memo((function(e){let{type:t}=e;const r=(0,a().v3)(),i=(0,pt().tz)(),l=(0,n.useRef)(null),s=(0,u().IS)((e=>({icon:{fill:e.icon.orangePrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",borderTop:`1px solid ${e.stroke.secondary}`},button:{width:"auto"},dismissButton:{color:e.text.uiBluePrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{width:14,height:14,marginRight:0}})),[]),c=(0,bo().xS)("guides.duplicateToSpace"),d=(0,n.useCallback)((()=>(0,E.jsxs)(Ti().A,{menuType:ji().gu.Popup,children:[(0,E.jsx)(Pi().A,{style:s.text,children:i.formatMessage(Eu[t])}),(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=l.current)||void 0===e||e.setOpen(!1)},render:e=>(0,E.jsx)(Ui().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...s.button,...s.dismissButton}})},{key:"learn-more",action:e=>{var t,o,n;null===(t=(o=e.event).preventDefault)||void 0===t||t.call(o),null===(n=l.current)||void 0===n||n.setOpen(!1),yr().oo({environment:r,url:c,openInNew:"tab"})},render:e=>(0,E.jsx)(Ui().A,{...e,title:(0,E.jsx)(pt().sA,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,o(284594).$)(),desktopIconStyle:s.learnMoreIcon,buttonStyle:{...s.button,...s.learnMoreButton},href:c,external:!0})}],render:e=>(0,E.jsx)(Pi().A,{...e,style:s.footer})}]})]})),[s,i,r,c,t]),p=(0,n.useCallback)((e=>(0,E.jsx)(At().A,{icon:Wr().Q,iconStyle:s.icon,ariaLabel:i.formatMessage(Eu[t]),...e})),[s,i,t]);return(0,E.jsx)(qi().Ay,{popupType:su().n.Popup,render:d,renderOrigin:p,ref:l})})),zu=n.memo((function(e){const{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,disableCellRightBorder:l,disabled:s,format:c,formatKey:p,isLast:m,paddingTop:g,property:S,renderSpacer:h,schema:f,width:v,collectionViewBlockStore:x}=e,b=(0,n.useRef)(null);(0,wu().b)(o(471745).A,(()=>({collectionContextStore:r,property:S,getNode:()=>b.current})),[r,S]);const C=(0,a().v3)(),{isMobile:w}=(0,a().Y0)(),{value:A}=(0,le().fJ)(ve().T.formulas),{value:j}=(0,le().fJ)(ve().T.formulaConstants),{value:R}=(0,le().fJ)(ve().T.formulaPermissions),[T,M]=(0,n.useState)(!1),_=(0,d().O$)(r.permissionScopesStore),P=(0,d().uB)(void 0,De().A),B=(0,d().K8)((()=>o(695412).A.state.publicPageData),[]),{isRightMostFrozenColumn:V,isScrolled:F}=(0,d().K8)((()=>{const{frozenIndex:e,isScrolled:t}=r.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[r.frozoneStore,i]),O=f[S],D=(0,d().K8)((()=>{var e;if("relation"!==(null==O?void 0:O.type))return!1;const t=null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,Wo().o2)(t,O)}),[r,O]),[{value:z}]=(0,Cn().Yb)((async()=>{var e;if("formula"!==(null==O?void 0:O.type))return!1;const t=r.collectionStore(),n=null===(e=r.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&n&&A&&j&&R))return!1;const i=(0,tn().i)(),l=(0,o(753123).MC)({collectionFeatureGates:i,experimentService:Fo().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel}),a={type:"block",collection:n},s={kind:j.FormulaContextValueKind.ThisRow,type:a},c={sourceProperty:S,valueTypes:[s],handleDataRequest:l,publicPageDataCollection:{id:null==B?void 0:B.collectionId,schema:null==B?void 0:B.collectionSchema},spaceId:t.getSpaceId(),featureGates:i};return!(await R.hasAccessToProperty({collectionPointer:n,collectionSchema:f,context:c,propertyId:S,hasAccessFn:R.hasSameSpaceAccess}))}),[r,O,S,f,A,j,R,B]),K=(0,L().X)("collections_xws"),H=(0,L().X)("db_ux_chrome"),W=D&&K,G=z&&K,N=(0,Pu().D)(O),$=(0,d().K8)((()=>x.getCollectionStore()),[x]),U=(0,n.useCallback)((()=>{I().clear({environment:C}),k().IU({environment:C}),(0,au().y)()}),[C]),q=(0,n.useCallback)((e=>{w||(e.preventDefault(),(0,Te().SQ)({event:e,context:Te().y$.EditorContextMenu,callback:()=>{U(),P.setState({open:!0})}}))}),[w,U,P]),X=(0,n.useCallback)((e=>{M(e)}),[M]),Y=(0,u().IS)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:v,borderRight:l?void 0:`1px solid ${e.tableDividerColor}`},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:g},buttonHovered:{background:e.tableRowHoveredBackground},property:{fontSize:14,flex:"1 1 auto"},enabledIcon:{width:20,height:20,marginLeft:4},menuWrapper:{marginLeft:H?-6:void 0}})),[v,l,g,H]),Q=(0,n.useCallback)((e=>O?(0,E.jsx)(Ku,{propertySchema:O,tooltipEvents:e,propertyId:S,collectionViewBlockStore:x}):null),[O,S,x]),Z=(0,n.useCallback)(((e,t)=>{var n;return O?(0,E.jsxs)(It().A,{style:Y.button,hoveredStyle:Y.buttonHovered,disabled:s,...(0,Hi().A)(e,t),children:[h&&h(m),(0,E.jsx)(Rt().mA,{propertySchema:O,showIcon:!0,badge:(0,E.jsxs)(E.Fragment,{children:["relation"===O.type&&N&&(0,E.jsx)(Tu().z,{style:Y.enabledIcon}),$&&(0,E.jsx)(o(204427).s,{collectionStore:$,propertyId:S,propertySchema:O}),"button"===O.type&&(0,y().O9)(O.automation_id)&&(0,E.jsx)(Gu,{propertyId:S,propertySchema:O,automationId:O.automation_id,collectionViewBlockStore:x}),Boolean(null===(n=O.description)||void 0===n?void 0:n.length)&&!w&&(0,E.jsx)(o(6327).g,{setIsHovered:X}),(0,E.jsx)(Rt().Jv,{propertySchema:O}),(0,E.jsx)(Rt().Zr,{propertyId:S,collectionContextStore:r}),(0,E.jsx)(Lu,{propertySchema:O})]}),style:Y.property,property:S}),W&&(0,E.jsx)(Du,{type:"relation"}),G&&(0,E.jsx)(Du,{type:"formula"}),V&&(0,E.jsx)(hu,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(F)})]}):null}),[O,Y.button,Y.buttonHovered,Y.enabledIcon,Y.property,s,h,m,N,$,S,x,w,X,W,G,V,F,r]),J=(0,n.useCallback)((e=>O?(0,E.jsx)(jt().A,{tooltipClassName:we().StS,disableTooltip:W||G,delayThreshold:T?0:500,placement:Ee().W.Right,renderTooltip:Q,render:t=>Z(t,e)}):null),[O,W,G,Q,T,Z]),ee=(0,n.useCallback)((e=>(0,E.jsx)(Au,{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,format:c,formatKey:p,parent:e,property:S,schema:f})),[t,r,i,c,p,S,f]);return O?(0,E.jsxs)("div",{ref:b,style:Y.container,className:we().P2l,onContextMenu:q,children:[(0,E.jsx)(Mu().dT,{origin:b,store:r}),(0,E.jsx)(qi().Ay,{popupType:w?ks().nl.BottomSheet:ks().nl.Popup,bottomSheetInitialState:"half",disabled:!_.canConfigureBlock,originGap:H?0:1,popupWrapStyle:Y.menuWrapper,alignmentToOrigin:qi().yP.Start,buttonPopupStore:P,renderOrigin:J,render:ee,onClick:U})]}):null}));function Ku(e){const{propertyId:t,propertySchema:n,tooltipEvents:r,collectionViewBlockStore:i}=e,l=(0,u().IS)((e=>({description:{color:e.text.contrastSecondary},sharingEnabledTooltip:{marginTop:8,color:e.text.contrastSecondary},personPropertyPermissionsTooltip:{marginTop:8,color:e.text.contrastSecondary},aiUpdate:{color:e.text.contrastSecondary}})),[]),a=(0,d().K8)((()=>(0,Wo().$M)(n)&&(0,Wo().om)(n)),[n]),s=(0,Pu().D)(n),c=(0,d().K8)((()=>i.getCollectionStore()),[i]);return(0,E.jsxs)("div",{...r,style:_u().Q$,children:[(0,E.jsx)("div",{children:n.name}),void 0!==(null==n?void 0:n.description)&&n.description.length>0?(0,E.jsx)("div",{style:l.description,children:n.description}):null,c&&"relation"===n.type&&s&&(0,E.jsx)(Tu().F,{propertySchema:n,collectionStore:c,style:l.sharingEnabledTooltip}),c&&"person"===n.type&&(0,E.jsx)(o(416347).o,{propertySchema:n,propertyId:t,collectionStore:c,style:l.personPropertyPermissionsTooltip}),a&&a.auto_update_on_edit&&(0,E.jsx)("div",{style:l.aiUpdate,children:(0,E.jsx)(pt().sA,{...Ru().A.keptUpToDateWithNotionAITooltip})}),"button"===n.type&&(0,y().O9)(n.automation_id)&&(0,E.jsx)(Wu,{propertyId:t,propertySchema:n,automationId:n.automation_id,collectionViewBlockStore:i})]})}function Hu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:i}=e,l=(0,d().K8)((()=>o.getSpaceId()),[o]),a=ae().dn.createChildStore(o,{id:t,table:ku().yB,spaceId:l});return(0,ju().cN)({automationStore:a,propertyId:n,propertySchema:r,collectionContextStore:i})}function Wu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,u().IS)((e=>({wrap:{color:e.text.contrastSecondary}})),[]);return Hu({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,ee().ET)()})?(0,E.jsx)("div",{style:i.wrap,children:(0,E.jsx)(pt().sA,{...Ru().A.buttonPropertyErrorTooltip})}):null}function Gu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,u().IS)((e=>({icon:{width:14,height:14,marginLeft:5,fill:e.mediumIconColor}})),[]);return Hu({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,ee().ET)()})?(0,Wr().Q)(i.icon):null}var Nu=()=>o(61014);const $u={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1},Uu=n.memo((function(e){let{leftFormat:t,height:r,onTemporaryResize:i,onAccept:l,onCancel:s,propertySchema:c,resultStore:d}=e;const u=(0,n.useRef)(void 0),{isPhone:p}=(0,a().Y0)(),[m,g]=(0,n.useState)(!1),[S,h]=(0,n.useState)(!1),y=!p&&(S||m),v=(0,n.useCallback)((e=>{const o=u.current;if(!o||!o.width)return;const n=Math.max(o.width+e.diffX,Qu(c,t,o.width,e.optionKey));return{...o,width:n}}),[t,c]),x=(0,n.useCallback)((e=>{e.preventDefault(),u.current=t,h(!0)}),[t]),b=(0,n.useCallback)((e=>{const t=v(e);t&&i(t)}),[v,i]),C=(0,n.useCallback)((e=>{const t=v(e);t&&l(t),h(!1)}),[v,l]),w=(0,n.useCallback)((()=>{s(),u.current=void 0,h(!1)}),[s]),k=(0,n.useCallback)((e=>{const n=d.state?d.state.blockIds:[],r=f().oE(n.map((e=>{const n=o(879857).A.findBlockPropertyValueByBlockId(e,t.property),r=null==n?void 0:n.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...r),Qu(c,t,t.width)))};l(e)}}),[t,l,c,d]),I=(0,n.useCallback)((e=>(0,E.jsx)("div",{style:y?Ju(r):Zu(r),onDoubleClick:k,...e})),[k,r,y]);return(0,E.jsx)("div",{style:$u,onMouseMove:()=>g(!0),onMouseLeave:()=>g(!1),children:(0,E.jsx)(hc().A,{onDraggableDragStart:x,onDraggableDragMove:b,onDraggableDragEnd:C,onDraggableDragCancel:w,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:I})})}));const qu=32,Xu=64,Yu=100;function Qu(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return qu;const n=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return qu;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return qu;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Nu().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return qu;if("auto_increment_id"===(null==e?void 0:e.type))return Xu;return Yu}(e,t);return o&&o<n?qu:n}function Zu(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:or().Ay.blueWithAlpha(0),cursor:"col-resize"}}function Ju(e){return{...Zu(e),background:or().Ay.blueWithAlpha(.8)}}const ep=n.memo((function(e){let{store:t,collectionContextStore:r,schema:i,query:l,disabled:s,formatKey:c,disableCellRightBorder:p,renderSpacer:m,allowHidingTitle:g,paddingTop:S,showRightActions:h,showPropertyFormats:f,resultStore:y,format:x,tableStore:b,height:C,groupsPointer:w,property:k,index:I,isLast:R}=e;const T=(0,a().v3)(),{isMobile:M,isPhone:_}=(0,a().Y0)(),P=(0,n.useRef)(null),B=(0,d().K8)((()=>b.getCurrentFormat(x)),[x,b]),V=f[I],{wikiOnboardingPhase:F,showWikiTooltip:L}=(0,d().K8)((()=>{var e,n,l,a;const s=vu().WH(),c="notion://wiki_collection"===(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())&&t.isCollectionViewPageWithContent()&&t.id===(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.id),d=c&&("notion://wiki/owner_property"===k||k===o(86280)._e.Owner)&&"owner"===s,u=c&&"verification"===(null===(l=i[k])||void 0===l?void 0:l.type)&&"verification"===s,p=c&&"multi_select"===(null===(a=i[k])||void 0===a?void 0:a.type)&&"tags"===s;return{wikiOnboardingPhase:s,showWikiTooltip:!M&&(d||u||p)}}),[r,M,k,i,t]),O=(0,d().K8)((()=>p||R&&!Ld(s,h)),[p,s,R,h]),D=(0,d().K8)((()=>(0,j().oe)({environment:T,propertyFormat:V})),[T,V]),z=(0,n.useCallback)((e=>{const t=b.getCurrentFormat(B),o=b.getCurrentProperties(c,t).map((t=>t.property===e.property?e:t)),n={...t,[c]:o};b.setState({...b.state,temporaryFormat:n})}),[b,c,B]),K=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=b.getCurrentFormat(B),n=b.getCurrentProperties(c,B).map((t=>t.property===e.property?e:t)),i={...o,[c]:n};A().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:T,canUndo:!0,perform:e=>{(0,Ii().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),b.setState({...b.state,temporaryFormat:void 0}),(0,v().X)({environment:T,collectionContextStore:r,action:"table_resize_columns"})}),[r,T,B,c,b]),H=(0,n.useCallback)((()=>{b.setState({...b.state,temporaryFormat:void 0})}),[b]),W=(0,u().IS)((()=>({container:{display:"flex",position:"relative"}})),[]);return(0,E.jsxs)("div",{style:W.container,ref:L?P:null,children:[L&&(0,E.jsx)(Cu,{origin:P,propertyType:F}),V&&D&&(0,E.jsx)(zu,{format:B,schema:i,query:l,property:k,width:D,collectionViewBlockStore:t,collectionContextStore:r,disabled:s,formatKey:c,isLast:R,disableCellRightBorder:O,allowHidingTitle:g,renderSpacer:m,paddingTop:S,columnIndex:I,groupsPointer:w}),!s&&!_&&(0,E.jsx)(Uu,{leftFormat:V,onTemporaryResize:z,onAccept:K,onCancel:H,height:C,propertySchema:i[k],resultStore:y})]},k)})),tp=p().default.createClass(void 0,{name:"ReducerResultStore"}),op=n.memo((function(e){let{allowHidingTitle:t,children:o,collectionContextStore:r,disableCellRightBorder:i,disabled:l,disableHorizontalEdgeScroll:s,disableTopBorder:c,format:p,formatKey:m,frozoneProps:g,groupFormat:S,hasMoreReducerResults:h,height:f,isInHomeWidget:y,isInPeekRenderer:v,minWidth:x,paddingLeft:b,paddingRight:C,paddingTop:w,query:k,renderSpacer:I,resultStore:A,schema:j,showHoverActionsStore:R,showPropertyFormats:T,showRightActions:_,store:P,tableStore:B}=e;const V=(0,a().v3)(),F=(0,n.useRef)(null),O=(0,L().X)("db_ux_chrome"),D=(0,d().K8)((()=>(0,M().f5)({environment:V,collectionContextStore:r})),[r,V]),z=(0,d().uB)(A,tp),K=(0,n.useMemo)((()=>S?[S]:[]),[S]),H=(0,n.useMemo)((()=>Ld(l,_)),[l,_]),W=(0,d().K8)((()=>!!R&&R.state),[R]),G=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),N=(0,d().O$)(r.isUnlistedViewStore),$=(0,M().Oz)(r),U=(0,u().IS)((e=>{const t=y?e.tableHomeDividerColor:e.tableDividerColor,o=y?"transparent":N?e.surface.elevated:v?e.cardContentBackground:(null==$?void 0:$.background)||e.contentBackground,n=K.length>0;return{flex:{display:"flex"},buttonContainer:{display:"flex",justifyContent:"center",alignItems:"center"},headerRow:{display:"flex",background:o,zIndex:87,height:f,color:e.text.secondary,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${c?"":`, inset 0 1px 0 ${t}`}`,minWidth:x,left:"timeline"===G?void 0:0,right:"timeline"===G?void 0:0,position:"relative",boxSizing:"border-box"},stickyStyle:{paddingLeft:b+(O&&n?24:0),paddingRight:C,minWidth:x,background:o,borderRight:"timeline"===G?`1px solid ${e.tableDividerColor}`:void 0,"--timeline-box-shadow":"timeline"===G?"0px":void 0},transitionStickyStyle:{paddingLeft:O&&n?24:0,..."timeline"===G?{borderRight:void 0}:{}}}}),[y,N,null==$?void 0:$.background,v,f,c,x,G,b,O,C,K.length]);return(0,E.jsx)(sl().g,{stickyAttachPoint:y?"no-stick":"ceiling",absoluteHeight:f,nodeRef:F,stickyStyle:U.stickyStyle,transitionStickyStyle:U.transitionStickyStyle,children:(0,E.jsxs)("div",{className:we().FYj,style:U.headerRow,dir:"ltr",ref:F,children:[D?(0,E.jsx)(yu,{groupsPointer:K,collectionContextStore:r,frozoneProps:g,hasMoreReducerResults:Boolean(h)}):null,(0,E.jsx)(np,{showRightActions:_,store:P,collectionContextStore:r,schema:j,query:k,disabled:l,formatKey:m,disableCellRightBorder:i,renderSpacer:I,allowHidingTitle:t,paddingTop:w,frozoneProps:g,disableTopBorder:c,backgroundColor:U.headerRow.background,disableHorizontalEdgeScroll:s,showPropertyFormats:T,format:p,height:f,tableStore:B,groupsPointer:K,resultStore:z}),(0,E.jsxs)(kt().A,{visible:H,animate:{opacity:W?1:0},style:O?U.buttonContainer:U.flex,children:[(0,E.jsx)(mu,{collectionContextStore:r}),O?null:(0,E.jsx)(gu,{collectionContextStore:r})]}),o]})})})),np=n.memo((function(e){let{allowHidingTitle:t,backgroundColor:o,collectionContextStore:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,disableTopBorder:s,disabled:c,format:p,formatKey:m,frozoneProps:g,groupsPointer:S,height:h,paddingTop:y,query:x,renderSpacer:b,resultStore:C,schema:w,showPropertyFormats:k,showRightActions:I,store:j,tableStore:R}=e;const T=(0,a().v3)(),{canConfigureBlock:_}=(0,d().O$)(r.permissionScopesStore),P=(0,d().O$)(r.isInHomeWidgetStore),{frozenIndex:B,unfrozenIndexAddendum:V,stickyLeft:F}=(0,n.useMemo)((()=>{const e=null==g?void 0:g.frozenIndex;return{frozenIndex:e,unfrozenIndexAddendum:(0,M().qi)(e),stickyLeft:null==g?void 0:g.frozenStyles.left}}),[null==g?void 0:g.frozenIndex,null==g?void 0:g.frozenStyles.left]),{showProperties:L,frozenShowProperties:O,unfrozenShowProperties:D}=(0,n.useMemo)((()=>{const e=k.map((e=>e.property)),[t,o]=[e.slice(0,V),e.slice(V)];return{showProperties:e,frozenShowProperties:t,unfrozenShowProperties:o}}),[k,V]),z=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=R.getCurrentFormat(p),n=f().Ul(R.getCurrentProperties(m,p),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0})),i={...o,[m]:n};A().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:T,canUndo:!0,perform:e=>{(0,Ii().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),(0,v().X)({environment:T,collectionContextStore:r,action:"table_reorder_columns"})}),[r,T,p,m,R]),K=(0,u().IS)((e=>{const t=P?e.tableHomeDividerColor:e.tableDividerColor;return{flex:{display:"flex"},frozenStyle:{display:"flex",...null==g?void 0:g.frozenStyles,left:P?vo().hj:F??0,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${s?"":`, inset 0 1px 0 ${t}`}`}}}),[o,s,null==g?void 0:g.frozenStyles,P,F]),H=(0,n.useMemo)((()=>({frozen:O,unfrozen:D})),[O,D]),W=(0,n.useMemo)((()=>({frozen:K.frozenStyle,unfrozen:{display:"flex"}})),[K.frozenStyle]),G=(0,n.useCallback)(((e,o,n)=>(0,E.jsx)(ep,{collectionContextStore:r,store:j,schema:w,query:x,disabled:c,format:p,formatKey:m,allowHidingTitle:t,showPropertyFormats:k,resultStore:C,showRightActions:I,disableCellRightBorder:i,renderSpacer:b,paddingTop:y,tableStore:R,groupsPointer:S,height:h,property:e,index:o,isLast:n},e)),[t,r,i,c,p,m,S,h,y,x,b,C,w,k,I,j,R]);return c||!_?(0,E.jsxs)("div",{style:Ka().Z0,children:[(0,E.jsx)("div",{style:K.frozenStyle,children:O.map(((e,t)=>G(e,t,t===L.length-1)))}),D.map(((e,t)=>G(e,t+V,t===L.length-1)))]}):(0,M().Eh)(B)?(0,E.jsx)(nu,{style:K.flex,direction:"horizontal",keys:L,sectionedKeys:H,sectionStyles:W,renderKey:G,onDrop:z,disableHorizontalEdgeScroll:l}):(0,E.jsx)(Ka().Ay,{direction:"horizontal",keys:L,renderKey:G,onDrop:z,disableHorizontalEdgeScroll:l})}));function rp(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,u().IS)((()=>({container:{display:"flex",background:o&&n?or().Ay.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,E.jsx)(kt().A,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,E.jsx)(E.Fragment,{children:t})}var ip=()=>o(686329);function lp(e){let{store:t,collectionContextStore:o,children:n,anyWrapping:r}=e;return(0,jd().DV)()&&r?(0,E.jsx)(ap,{store:t,collectionContextStore:o,children:n}):(0,E.jsx)("div",{style:{display:"flex"},children:n})}function ap(e){let{store:t,collectionContextStore:o,children:r}=e;const i=(0,n.useRef)(null),l=(0,n.useRef)(null),a=o.virtualizedModule.getBlockHeightsCache(),s=(0,d().O$)(a.getBlockHeightStore(t.id)),c=(0,n.useCallback)((()=>{a.expandHeightToTallestCached(t.id)}),[a,t]);(0,ip().tK)(0===s?i:l,c);const p=(0,u().IS)((()=>({row:{display:"flex",...s?{height:Math.max(s,vo().tt),overflowY:"clip"}:{}}})),[s]);return(0,E.jsx)("div",{ref:i,style:p.row,children:r})}const sp=n.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:i}=e,l=(0,ee().ET)(),s=(0,a().v3)(),c=(0,d().K8)((()=>se().default.state.stores.includes(t)),[t]),u=(0,d().K8)((()=>{var e;return Su().default.state.isOpen&&(null===(e=Su().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),p=(0,n.useCallback)((e=>{var o;(0,j().ut)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?k().td({environment:s,stores:[t]}):k().Lt({environment:s,store:t,selectMode:k().gj()?k().SB.MULTI_SELECT_FROM_BOUNDARY:k().SB.TOGGLE}),e.stopPropagation()}),[l,s,t]);return(0,E.jsx)(fu,{checkedState:c,onClick:p,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:u,frozoneProps:i,passesFilter:o,disabled:!r})}));const cp=n.memo((function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,{isMobile:i}=(0,a().Y0)(),l=(null==o?void 0:o.length)??0,s=Math.max((l-1)*re().yy,0)+re().Pi,c=(0,u().IS)((()=>{const e=i?vo().Um:vo().tt;return{hiddenContainer:{minWidth:s+re().yy,...0===r&&n?{marginLeft:-8,marginRight:4}:{}},buttonContainer:{paddingTop:(e-24)/2,display:"flex",...0===r&&n?{marginLeft:-8,marginRight:0,gap:4}:{}},width:{width:s}}}),[s,i,r,n]);return t?(0,E.jsxs)("div",{style:c.buttonContainer,children:[(0,E.jsx)("div",{style:c.width}),t]}):(0,E.jsx)("div",{style:c.hiddenContainer})})),dp=n.memo((function(e){const{propertyFormat:t,index:r,canEdit:i,isLastColumn:l,isRightMostFrozenColumn:s,store:c,schema:p,disabled:m,disableCellBorderRight:g,disableLastCellBorderRight:S,subitemPath:h,onShiftEnter:y,tableWrap:v,subitemFormat:x,forceMouseEntered:b,shouldCaptureKeyboard:C,isLocked:w,toggleButton:k,onPropertyClick:I,titleColumnIndex:A,isSubitemToggleOnTitleColumn:R,onPropertyTab:T,onPropertyUntab:M,onPropertyEnter:_,onPropertyEsc:P,onPropertyBgClick:B,onPropertyContextMenu:V,collectionViewStore:F,collectionStore:L,blockPropertyValueOverlayStore:O,shouldSetCellHeight:D,onOpenProperty:z,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,groupFormat:W,rowIndex:G,isCollectionViewBlockSelected:N,passesFilter:$,isScrolled:U,shouldShowMultiSelectCheckbox:q,isInHomeWidget:X,normalizedTableSelection:Y,hasColumnVirtualizer:Q}=e,{property:Z,wrap:te}=t,oe=(0,a().v3)(),ne=(0,d().K8)((()=>(0,j().oe)({environment:oe,propertyFormat:t})),[oe,t]),re=(0,ee().ET)(),ie=(null==h?void 0:h.length)??0,le=x&&(0,j().BC)({columnIndex:r,titleColumnIndex:A,isSubitemToggleOnTitleColumn:R}),ae=(0,n.useMemo)((()=>{if(void 0!==ne){if(le){const e=(0,j().si)({columnIndex:r,indentLevel:ie,titleColumnIndex:A,isSubitemToggleOnTitleColumn:R});return ne-e}return ne}}),[ie,r,R,le,A,ne]),se=(0,n.useCallback)((()=>I(c,Z,p)),[I,Z,p,c]),ce=m||!i,[de,ue]=(0,d().K8)((()=>{const e=re.collectionViewBlockStore();if(!e)return[!1,!1];const t=Od().A.state;if(!t.isActive||!(0,Od().g)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:W})||!Y)return[!1,!1];const o=Y,{start:n,end:i}=o,l=G===n.row||G===i.row||f().r4(G,n.row,i.row),a=r===n.col||r===i.col||f().r4(r,n.col,i.col);return[l&&a,G===n.row&&r===n.col]}),[re,W,r,Y,G]),pe=(0,d().K8)((()=>{const e=re.frozoneStore.state.frozenIndex;return void 0!==e&&r<=e}),[re,r]),me=(0,o(689685).V)({collectionContextStore:re,blockId:c.id,property:Z,featureEnabled:Q}),ge=(0,u().IS)((e=>{const t=X?e.tableHomeDividerColor:e.tableDividerColor,o=N?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:ne||void 0,height:me?void 0:"100%",position:"relative",borderRight:g||s||l&&S?"none":`1px solid ${pe?o:t}`},tableSelectionOverlay:{background:de?or().Ay.blueWithAlpha(.07):void 0,borderRadius:ue?3:void 0,boxShadow:ue?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",left:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:ae||void 0}}}),[X,N,ne,me,g,s,l,S,pe,de,ue,ae]),Se=(0,E.jsxs)(J().A,{debugName:"TableRow",capture:C,onShiftEnter:y,children:[(0,E.jsx)(zr().BlockPropertyRouter,{collectionStore:L,store:c,property:Z,disabled:ce,locked:w,width:ae,format:"table",forceMouseEntered:b,tableWrap:Boolean(v||te),isLast:l,indentLevel:0===r&&h?h.length:void 0,onTab:T,onUntab:M,onEnter:_,onClick:se,onEsc:P,onBgClick:B,onContextMenu:V,collectionViewStore:F,shouldSetCellHeight:D,onOpenProperty:z,blockPropertyValueOverlayStore:O,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,propertyIndex:r,shouldShowMultiSelectCheckbox:q},Z),s&&(0,E.jsx)(hu,{isCollectionViewBlockSelected:N,passesFilter:$,isScrolled:U})]}),he=(0,n.useRef)(null);return(0,E.jsxs)("div",{ref:he,className:we().WvK,"data-row-index":G,"data-col-index":r,style:ge.tableCell,children:[le?(0,E.jsx)(cp,{subitemFormat:x,toggleButton:k,subitemPath:h,shouldShowMultiSelectCheckbox:q,propertyIndex:r}):null,(0,E.jsx)("div",{style:ge.propertyValueContainer,children:Se}),de&&(0,E.jsx)("div",{style:ge.tableSelectionOverlay})]})})),up=n.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:a,indexAddendum:s,frozoneProps:c,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g}=e,S=(0,ee().ET)(),h=(0,d().K8)((()=>S.collectionViewStore()),[S]),f=(0,d().K8)((()=>M().Dj({store:i,collectionContextStore:S})),[i,S]),y=(0,d().K8)((()=>!t.state.isOpen&&se().default.state.stores.length>0&&se().default.state.stores[0].id===i.id),[i.id,t]),v=(0,d().O$)(S.currentSubitemFormatStoreForUiDisplayStore),x=(0,d().K8)((()=>"title"===(null==h?void 0:h.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[h]),b=(0,d().K8)((()=>S.frozoneStore.state.frozenIndex),[S]),C=(0,d().K8)((()=>{if(!p)return;if(m)return;if(S.isInlineViewStore.state&&S.isUnlistedViewStore.state)return;const e=Su().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[p,S,m,i]),w=r??o.length;return(0,E.jsx)(E.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(s??0);return(0,E.jsx)(dp,{index:r,store:i,propertyFormat:e,isLastColumn:r===w-1,isRightMostFrozenColumn:b===r,collectionViewStore:h,collectionStore:f,tableWrap:l,shouldSetCellHeight:a,forceMouseEntered:"title"===e.property?C:void 0,shouldCaptureKeyboard:y,subitemFormat:v,isSubitemToggleOnTitleColumn:x,blockPropertyValueOverlayStore:t,isScrolled:(null==c?void 0:c.isScrolled)??!1,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g},e.property)}))})})),pp=n.memo((function(e){let{propertyFormats:t,...o}=e;const{propertiesInRange:n,propertiesInRangeIndices:r,beforeWidth:i,afterWidth:l}=(0,jd().UB)();return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:{width:`${i}px`}}),(0,E.jsx)(up,{...o,propertyFormats:n,propertyFormatsMap:r}),(0,E.jsx)("div",{style:{width:`${l}px`}})]})})),mp=n.memo(n.forwardRef((function(e,t){const{disabled:o,store:r,groupFormat:i,collectionContextStore:l,propertyFormats:s,frozoneProps:c,passesFilter:p,shouldShowMultiSelectCheckbox:m,isLast:g,isInHomeWidget:S,isCollectionViewBlockSelected:h,allRows:f,isInEphemeralView:y,normalizedTableSelection:v,unfrozenIndexAddendum:x,frozenPropertyFormats:b,unfrozenPropertyFormats:C,tableWrap:w,shouldSetCellHeight:k,isNonEditable:I,shouldShowRightActionSpacer:A,...j}=e,{handleOpenPeekPage:R}=e,T=(0,n.useRef)(null),_=(0,a().v3)(),P=(0,d().K8)((()=>!o&&r.canEdit()),[o,r]),B=(0,n.useMemo)((()=>f.findIndex((e=>e===r))),[f,r]),V=null==c?void 0:c.frozenIndex,F=void 0!==V,L=-1===V,O=(0,d().K8)((()=>{if(void 0===V)return!1;const e=Od().A.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Od().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!v)return!1;const o=v,{start:n}=o;return B===n.row&&n.col<=V}),[i,l,v,V,B]),D=(0,n.useMemo)((()=>F?{...null==c?void 0:c.frozenStyles,...O?{zIndex:86}:{zIndex:85},...L?{background:void 0}:{},...S?{left:vo().hj}:{}}:{}),[F,null==c?void 0:c.frozenStyles,O,L,S]),z=(0,u().IS)((e=>{const t=S?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...g&&S?{}:{borderBottom:`1px solid ${t}`},width:"100%"},checkboxContainer:{position:"absolute",left:-vo().Fh,...!L&&{background:null==c?void 0:c.frozenStyles.background,height:"100%"}}}}),[L,null==c?void 0:c.frozenStyles.background,S,g]),K=(0,n.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=bt().default.state,t=M().wy({environment:_,store:r,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:y?"center_peek":void 0});t&&(R(),yr().oo({environment:_,url:t}))}),[l,_,R,y,r]),H=(0,jd().DV)(),W=w||s.some((e=>e.wrap)),G=(0,E.jsxs)(n.Fragment,{children:[(0,E.jsx)("div",{className:we().Eo4,style:z.tableViewRowStyle,dir:"ltr",ref:T,children:(0,E.jsx)(li().c,{store:r,step:"demo_collection_record",children:(0,E.jsxs)(lp,{collectionContextStore:l,store:r,anyWrapping:W,children:[(0,E.jsx)("div",{style:D,children:(0,E.jsx)(rp,{isCollectionViewBlockSelected:h,passesFilter:Boolean(p),shouldFreeze:!L,children:(0,E.jsxs)(E.Fragment,{children:[m&&(0,E.jsx)(kt().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,E.jsx)("div",{style:z.checkboxContainer,children:(0,E.jsx)(sp,{store:r,passesFilter:Boolean(p),frozoneProps:c,canEdit:P})})}),(0,E.jsx)(up,{store:r,canEdit:P,propertyFormats:b,visiblePropertiesLength:b.length,shouldSetCellHeight:k,indexAddendum:0,rowIndex:B,disabled:o,groupFormat:i,tableWrap:w,isLocked:I,isCollectionViewBlockSelected:h,passesFilter:Boolean(p),shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...j})]})})}),H?(0,E.jsx)(pp,{store:r,canEdit:P,propertyFormats:C,visiblePropertiesLength:C.length,shouldSetCellHeight:k,indexAddendum:x,rowIndex:B,disabled:o,groupFormat:i,tableWrap:w,isLocked:I,isCollectionViewBlockSelected:h,passesFilter:!0,shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...j}):(0,E.jsx)(up,{store:r,canEdit:P,propertyFormats:C,visiblePropertiesLength:C.length,shouldSetCellHeight:k,indexAddendum:x,rowIndex:B,disabled:o,groupFormat:i,tableWrap:w,isLocked:I,isCollectionViewBlockSelected:h,passesFilter:!0,shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...j})]})})}),A?(0,E.jsx)("div",{style:{...z.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Be().NW)(r,t,(0,n.useMemo)((()=>({renderedType:"table_row",getNode:()=>T.current,getBlockStore:()=>r,activate:K})),[K,r]),G)})));const gp=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:s}=e,c=(0,a().v3)(),p=(0,ee().Ks)(),m=(0,n.useRef)(null),g=(0,n.useRef)(null),[S,h]=n.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[y,v]=n.useState(0),[x,b]=n.useState(0),C=(0,d().K8)((()=>t.state.isRepositioning||S.isMouseDown),[t,S.isMouseDown]),w=(0,d().K8)((()=>t.state.newFrozenIndex),[t]),k=(0,d().K8)((()=>!!p&&(0,M().f5)({environment:c,collectionContextStore:p})),[c,p]),I=(0,d().K8)((()=>null==p?void 0:p.frozoneStore.state.isScrolled),[p]),A=(0,d().K8)((()=>!I&&-1===o&&k?-4:0),[o,I,k]),R=(0,d().K8)((()=>S.isEntered||C),[S.isEntered,C]),T=(0,d().K8)((()=>t.state.newFrozenColumnXPosition),[t]),_=(0,n.useContext)(ye().R),P=null==_?void 0:_.horizontalScroller,B=(0,n.useCallback)((()=>{var e,t,o;if(!P||!m.current)return 0;const n=(null===(e=m.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(we().FYj);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[P]),V=(0,n.useCallback)((()=>{var e,t,o,n,r;if(!P||!m.current)return 0;const i=(null===(e=m.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(we().Eo4),a=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,s=null===(n=P.getNode())||void 0===n?void 0:n.getElementsByClassName(we().Mbm),c=s&&s.length>0?null===(r=s[s.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(a,c)-i}),[P]),F=(0,d().K8)((()=>{var e;const t=null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==s?new DOMRect(t.x+s+S.x+10,t.y+S.y+10,3,3):void 0}),[s,S]),L=(0,d().K8)((()=>{const e=(null==p?void 0:p.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Oe().kf)(c),o=Math.max(t-e,0);return p&&(0,j().QP)(c,p)?o:0}),[p,c]),O=(0,d().K8)((()=>p&&(0,M().f5)({environment:c,collectionContextStore:p})),[p,c]),D=(0,n.useCallback)((e=>{if(void 0===o||void 0===r||void 0===s||null===m.current||null===g.current)return;const n=m.current.getBoundingClientRect(),a=e.clientX-n.x;if(null==p||p.frozoneStore.setState({...null==p?void 0:p.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!R)return;const c=B();v(c);const d=V();b(d);const u=2+s,S=Math.max(a-u,-u),f=e.clientY-n.y-14,y=n.bottom-n.top-14+d,x=C?c:-14,w=Math.max(Math.min(f,y),x);if(h((e=>({...e,x:C?S:0,y:w}))),C){const e=l,n=g.current.getBoundingClientRect();let c=a,d=i,u=-1,p=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,I&&t===o+1&&(c-=n.x);const i=Math.abs(d-c);i<m&&(m=i,p=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-s-1})}}),[o,r,s,null==p?void 0:p.frozoneStore,R,B,V,C,l,i,t,I]);(0,n.useEffect)((()=>{const e=f().nF((e=>{D(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[D]);const z=(0,n.useCallback)((e=>{C||(D(e.nativeEvent),h((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[C,D]),K=(0,n.useCallback)((e=>{C||h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[C]),H=(0,n.useCallback)((e=>{h((e=>({...e,isMouseDown:!0})))}),[]),W=(0,n.useCallback)((e=>{C&&h((e=>({...e,isEntered:!0})))}),[C]),G=(0,n.useCallback)((e=>{h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),N=(0,n.useCallback)((e=>{C&&h((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[C]),$=(0,u().IS)((e=>{const t=void 0!==w&&void 0!==o&&w<=o;return{repositionerContainer:{zIndex:87,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:C?"grabbing":"grab",pointerEvents:C?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:L+(O?vo().Fh:0),height:"100%"},tooltipContainer:{position:"absolute",left:-1!==s||I?s??0:5,zIndex:30,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:C?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:C?S.x-1:-1,top:C?y:0,width:2,height:C?`calc(100% + ${x-y}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:C?y:0,width:1,height:C?`calc(100% + ${x-y}px`:"100%",background:e.accentColors.uiBlue[300]},frozenGhostColumn:{left:T,opacity:C&&t?1:0},unfrozenGhostColumn:{left:(s??0)+(T??0),opacity:R&&C&&!t?1:0},tooltipDraggable:{position:"absolute",left:C?S.x-2:-2,top:S.y,width:4,height:28,background:e.accentColors.uiBlue[600],borderRadius:4}}}),[w,o,C,L,O,s,I,S.x,S.y,y,x,T,R]);return(0,E.jsx)("div",{className:we().FZs,style:$.repositionerContainer,onMouseEnter:W,onMouseLeave:G,onMouseUp:N,children:(0,E.jsxs)("div",{style:$.repositionerOutsideStickyWrapper,ref:g,children:[(0,E.jsx)("div",{style:$.repositionerInsideStickyWrapper,ref:m,children:(0,E.jsx)(jt().A,{renderTooltip:()=>C&&void 0!==w&&w!==o?(0,E.jsx)(pt().sA,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:w+1}}):(0,E.jsx)(pt().sA,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:C||void 0,placement:Ee().W.Right,originRect:F,render:e=>(0,E.jsxs)(kt().A,{animate:{translateX:A,opacity:R?1:0},...e,style:$.tooltipContainer,children:[(0,E.jsx)("div",{style:$.tooltipOrigin,onMouseEnter:z,onMouseLeave:K,onMouseDown:H}),(0,E.jsx)("div",{style:{...$.ghostColumnBase,...$.frozenGhostColumn}}),(0,E.jsx)("div",{style:$.tooltipColumn}),(0,E.jsx)("div",{style:$.tooltipDraggable})]})})}),(0,E.jsx)("div",{style:{...$.ghostColumnBase,...$.unfrozenGhostColumn}})]})})},Sp={tableSelectionOverlayActions:new(le().O2)("tableSelectionOverlayActions",(async()=>await o.e(95496).then(o.bind(o,368291)))),tableSelectionOverlayPropertyActions:new(le().O2)("tableSelectionOverlayPropertyActions",(async()=>await o.e(40589).then(o.bind(o,823824))))};var hp=()=>o(8383);class fp extends p().default{getInitialState(){}}const yp=fp;class vp extends p().default{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const xp=vp,bp=new Set(["rollup","formula","verification"]);function Cp(e){var t;const{dragAndFillStore:o,frozenIndex:r,rowsWrapRect:i,schema:l,selection:s,selectionStartRectStore:c,showPropertyFormats:p}=e,m=(0,a().v3)(),g=(0,ee().ET)(),S=(0,d().O$)(o),h=(0,d().K8)((()=>{const e=(null==S?void 0:S.start)||s.start;return p[e.col]}),[S,s,p]),f=h?null===(t=l[h.property])||void 0===t?void 0:t.type:void 0,y=(0,d().O$)(c),v=(0,d().K8)((()=>void 0!==r&&s.start.col<=r),[r,s]),x=(0,d().K8)((()=>g.isInHomeWidgetStore.state),[g]),b=(0,d().K8)((()=>(0,M().f5)({environment:m,collectionContextStore:g})),[g,m]),C=(0,u().IS)((e=>{const t=v?91:85,o=v?"sticky":void 0;let n=0;x?n=vo().hj:b&&(n=vo().Fh);return{dragAndFillContainer:{zIndex:t,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:o,left:n},tooltipContainer:y?{position:"absolute",left:y.left+y.width-6-(b?vo().Fh:0)}:{},tooltipOrigin:{position:"absolute",left:0,top:y?y.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:y?y.bottom-5:void 0,width:9,height:9,border:`2px solid ${or().Ay.blueWithAlpha(.57)}`,transform:S?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.text.contrastSecondary,maxWidth:200,...Ro().RC}}}),[v,x,b,y,S]),w=(0,n.useMemo)((()=>{if(y&&i)return new DOMRect(y.x+i.x+y.width-4,y.y+i.y+y.height-4,7,7)}),[y,i]),k=(0,n.useCallback)((()=>(0,E.jsx)(pt().sA,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),I=(0,n.useCallback)((e=>(0,E.jsx)("div",{...e,className:we().yle,style:C.dragAndFillContainer,children:(0,E.jsx)("div",{style:C.dragAndFillOutsideStickyWrapper,children:(0,E.jsx)("div",{style:C.dragAndFillInsideStickyWrapper,children:(0,E.jsxs)("div",{style:C.tooltipContainer,children:[(0,E.jsx)("div",{style:C.tooltipOrigin}),(0,E.jsx)("div",{style:C.tooltipCircle})]})})})})),[C]);return y?!f||(0,Wo().F_)(f)||bp.has(f)?null:(0,E.jsx)(jt().A,{renderTooltip:k,delayThreshold:300,forceVisibleState:!!S||void 0,originRect:w,placement:Ee().W.Right,render:I}):null}const wp=n.memo((function(e){const{groupFormat:t}=e,r=(0,a().v3)(),i=(0,n.useContext)(ri().n),l=(0,n.useRef)(null),s=(0,n.useRef)(void 0),c=(0,L().X)("improved_drag_and_fill"),{value:u}=(0,le().fJ)(te().g),{value:p}=(0,le().fJ)(oe().S),{value:m}=(0,le().fJ)(ve().T.formulas),g=(0,n.useMemo)((()=>Sp.tableSelectionOverlayActions.load()),[]),S=(0,d().uB)(void 0,yp),h=(0,d().uB)(void 0,xp),f=(0,d().r6)((()=>(0,re().v2)(t,e.collectionContextStore)),[t,e.collectionContextStore]),y=(0,d().K8)((()=>(0,M().f5)({environment:r,collectionContextStore:e.collectionContextStore})),[r,e.collectionContextStore]),v=(0,d().K8)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),x=(0,d().r6)((()=>{const n=e.collectionContextStore.collectionViewBlockStore();if(!n)return;const r=Od().A.state;if(!r.isActive||!(0,Od().g)(r.selectionKey,{collectionViewBlockStore:n,groupFormat:t}))return;const i=(0,j().yR)(r.selection,e.showPropertyFormats.length,f.state.length);return o(196916).kn(f.state[i.start.row]),i}),[e.collectionContextStore,e.showPropertyFormats.length,t,f]),b=(0,d().O$)(x),C=(0,d().K8)((()=>{const e=x.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[x]),w=(0,d().K8)((()=>{const e=x.state;return e&&e.start.row===e.end.row}),[x]),k=c?w:C,I=(0,d().r6)((()=>{const t=x.state;if(!t)return;if(!l.current)return;const o=t.start,n=e.showPropertyFormats,i=f.state[o.row],a=(0,hp().Xw)(i,l.current);if(!a)return;const s=l.current.getBoundingClientRect(),c=a.height,d=a.top-s.top-1,u=n[o.col].width||0,p=c+1;let m=(0,hp().$u)(e.collectionContextStore,r);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(m+=t.width)}return new DOMRect(m-1,d,u+1,p)}),[f,r,x,e.collectionContextStore,e.showPropertyFormats]),A=(0,d().r6)((()=>{const t=x.state;if(!t||!w)return;if(!l.current)return;const o=t.end,n=e.showPropertyFormats,i=f.state[o.row],a=(0,hp().Xw)(i,l.current);if(!a)return;const s=l.current.getBoundingClientRect(),c=a.height,d=a.top-s.top-1,u=n[o.col].width||0,p=c+1;let m=(0,hp().$u)(e.collectionContextStore,r);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(m+=t.width)}return new DOMRect(m-1,d,u+1,p)}),[f,r,w,x,e.collectionContextStore,e.showPropertyFormats]),R=c?A:I,T=(0,d().r6)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),_=(0,d().K8)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),P=(0,d().r6)((()=>{const t=T.state;if(void 0!==t){let o=(0,hp().$u)(e.collectionContextStore,r);const n=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=n.length);e++){const t=n[e];t.width&&(o+=t.width)}return o-1-(y?vo().Fh:0)}}),[T,y,e.collectionContextStore,e.showPropertyFormats,r]),B=(0,d().K8)((()=>(0,hp().$u)(e.collectionContextStore,r)-(y?vo().Fh:0)),[e.collectionContextStore,r,y]),V=(0,d().K8)((()=>{let t=!1;const o=(0,hp().yA)(e.collectionContextStore,e.groupFormat),n=o.length,r=se().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==T.state&&!S.state&&!t&&!Od().A.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[S,T,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,n.useEffect)((()=>{l.current&&(s.current=new MutationObserver((()=>{I.recompute()})),s.current.observe(l.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=s.current;return()=>{e&&e.disconnect()}}),[I]);const F=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:hp().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,r,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.disableHorizontalEdgeScroll,x,f,P,T]),O=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:hp().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),D=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:hp().Dp.Up,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),z=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:hp().Dp.Down,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),K=(0,n.useCallback)((async t=>{(await g).handleEnter({shortcutEvent:t,environment:r,schema:v,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),H=(0,n.useCallback)((async t=>{t.preventDefault();(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:hp().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),W=(0,n.useCallback)((async t=>{t.preventDefault();(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:hp().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),G=(0,n.useCallback)((async e=>{(await g).handleEsc({keyboardEvent:e,environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[f,r,x,g]),N=(0,n.useCallback)((async()=>{(await g).handleDelete({environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state})}),[f,r,x,e.collectionContextStore,e.disabled,e.showPropertyFormats,g]),$=(0,n.useCallback)((async t=>{(await g).handleCut({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,formulasModule:m})}),[g,r,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,x,f,m]),U=(0,n.useCallback)((async t=>{(await g).handleCopy({clipboardEvent:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:f.state,formulasModule:m,normalizedTableSelection:x.state})}),[g,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,f,m,x]),q=(0,n.useCallback)((async t=>{const o=await g,n=await X().R.clipboardActions.load();o.handlePaste({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,schema:v,showPropertyFormats:e.showPropertyFormats,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:p,disabled:e.disabled,allRows:f.state,clipboardActions:n,normalizedTableSelection:x.state})}),[g,f,r,u,x,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,v,p]),Y=(0,n.useCallback)((async()=>{(await g).handleCommandEnter({environment:r,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,overrideLinkClick:i})}),[f,r,x,i,e.collectionContextStore,g]),Q=(0,n.useCallback)((async()=>{(await g).handleShiftEnter({environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,selectionStartRectStore:I,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,I]),Z=(0,n.useCallback)((async()=>{(await g).handleCommandShiftEnter({environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,r,x]),ee=(0,n.useCallback)((async t=>{(await g).handleDuplicate({keyboardEvent:t,environment:r,disabled:e.disabled,schema:v,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,r,x,v,e.disabled,e.showPropertyFormats]),ne=(0,n.useCallback)((async t=>{(await g).handleKeypress({keyboardEvent:t,environment:r,schema:v,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),ie=(0,n.useCallback)((async e=>{(await g).handleMoveTo({shortcutOrKeyboardEvent:e,environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,r,x]),ae=(0,n.useCallback)((async t=>{(await g).handleDragStart({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,paddingLeft:e.paddingLeft,disabled:e.disabled,dragAndFillStore:S,frozenColumnRepositionStore:h,frozenIndex:T.state,allRows:f.state,normalizedTableSelection:x.state})}),[g,f,S,r,h,T,x,e.collectionContextStore,e.showPropertyFormats,e.disabled,e.paddingLeft]),ce=(0,n.useCallback)((async t=>{(await g).handleDragMove({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,dragAndFillStore:S,frozenColumnRepositionStore:h,normalizedTableSelection:x.state,allRows:f.state,selectionStartRectStore:I})}),[g,f,S,r,h,x,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,I]),de=(0,n.useCallback)((async()=>{(await g).handleDragEnd({environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,schema:v,dragAndFillStore:S,frozenColumnRepositionStore:h,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,S,r,h,x,e.collectionContextStore,e.showPropertyFormats,v]),ue=(0,n.useCallback)((async()=>{(await g).handleDragCancel({dragAndFillStore:S,frozenColumnRepositionStore:h})}),[S,h,g]);return(0,E.jsx)(J().A,{debugName:"TableSelectionOverlay",capture:void 0!==b,onLeft:F,onRight:O,onUp:D,onDown:z,onEnter:K,onTab:H,onUntab:W,onEsc:G,onDelete:N,onBackspace:N,onCut:$,onCopy:U,onPaste:q,onCommandEnter:Y,onShiftEnter:Q,onCommandShiftEnter:Z,onDuplicate:ee,onKeypress:ne,onMoveTo:ie,children:(0,E.jsx)(hc().A,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:ae,onDraggableDragMove:ce,onDraggableDragEnd:de,onDraggableDragCancel:ue,render:t=>{var o;return(0,E.jsxs)("div",{ref:l,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[(0,hp().Gd)(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&b&&(k||S.state)?(0,E.jsx)(Cp,{dragAndFillStore:S,frozenIndex:T.state,rowsWrapRect:null===(o=l.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:v,selection:b,selectionStartRectStore:R,showPropertyFormats:e.showPropertyFormats}):null,V&&(0,E.jsx)(gp,{frozenColumnRepositionStore:h,xForFirstCellInRow:B,maxFrozenIndex:_,showPropertyFormats:e.showPropertyFormats,frozenIndex:T.state,frozenSectionWidth:P.state}),(0,E.jsx)(kp,{...e,allRowsStore:f,selectionStartRectStore:I,normalizedTableSelectionStore:x,frozenSectionWidthStore:P,frozenIndexStore:T})]})}})})}),No().A),kp=n.memo((function(e){const t=(0,a().v3)(),o=(0,n.useMemo)((()=>Sp.tableSelectionOverlayActions.load()),[]),r=(0,n.useMemo)((()=>Sp.tableSelectionOverlayPropertyActions.load()),[]),i=(0,n.useMemo)((()=>({onPropertyTab:async()=>{(await r).handlePropertyTabOrUntab({type:"tab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyUntab:async()=>{(await r).handlePropertyTabOrUntab({type:"untab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyEnter:async()=>{(await r).handlePropertyEnter({environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyClick:async(o,n,i)=>{(await r).handlePropertyClick({store:o,property:n,schema:i,environment:t,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})},onPropertyEsc:async()=>{(await r).handlePropertyEsc({environment:t,collectionContextStore:e.collectionContextStore,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})},onPropertyBgClick:async()=>{(await r).handlePropertyBgClick(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:async o=>{(await r).handlePropertyContextMenu({mouseEvent:o,environment:t,collectionContextStore:e.collectionContextStore,allRows:e.allRowsStore.state,normalizedTableSelection:e.normalizedTableSelectionStore.state})},onOpenProperty:async o=>{(await r).handlePropertyOpenProperty({openProperty:o,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,disableHorizontalEdgeScroll:Boolean(e.disableHorizontalEdgeScroll),collectionContextStore:e.collectionContextStore,environment:t})},onSelectableEnter:async n=>{(await o).handleRowSelectableEnter({onEnterArgs:n,environment:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})}})),[o,r,t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,E.jsx)(E.Fragment,{children:e.render(i)})}),No().A);function Ip(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,s=(0,a().v3)(),c=(0,u().DP)(),p=(0,a().Y0)().isPhone,m=(0,ee().Ks)(),g=(0,Jr().A)(!0,0,100),S=(0,d().K8)((()=>Boolean(null==m?void 0:m.normalizedFormatStore.state.hide_table_vertical_lines)),[m]),h=l.isScrolled,f=l.frozenIndex,y=void 0!==f,v=(0,d().K8)((()=>{if(!m)return!1;const e=m.collectionViewBlockStore();return!!e&&(0,Bd().d1)(e)}),[m]),x=(0,d().K8)((()=>m?(0,j().wy)({environment:s,collectionContextStore:m,isPhone:p,theme:c}):{}),[m,s,p,c]),b=(0,d().K8)((()=>Boolean(null==m?void 0:m.isInHomeWidgetStore.state)),[null==m?void 0:m.isInHomeWidgetStore]),C=(0,u().IS)((e=>{let t="0x 16px";return y?t=void 0:b&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...x,...-1===f?{background:void 0}:{}},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:y?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:S?void 0:`1px solid ${e.tableDividerColor}`}}}),[y,b,x,f,S]);if(!g||!m)return null;const w=n.map(((e,t)=>(0,E.jsx)("div",{style:{...C.column,width:e},children:(0,E.jsx)(to().A,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let k=null,I=[];if(y&&void 0!==f){const e=w.slice(0,f+1);k=(0,E.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,E.jsx)(rp,{isCollectionViewBlockSelected:v,passesFilter:!0,shouldFreeze:-1!==f,children:e}),e.length>0?(0,E.jsx)(hu,{isCollectionViewBlockSelected:v,passesFilter:!0,isShimmerRow:!0,isScrolled:h}):null]}),I=w.slice(f+1,w.length)}else I=w;let A=1;o||r||i||(A=t?10:3);const R=[...Array(A)].map(((e,t)=>(0,E.jsxs)("div",{style:C.rowContainer,children:[k,I]},t)));return(0,E.jsx)("div",{style:C.container,children:(0,E.jsx)("div",{style:C.rowsContainer,children:R})})}const Ap=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,disabled:i,format:l,groupFormat:s,isFullScreen:c,isInPeekRenderer:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,query:f,schema:y,showHoverActionsStore:v,store:x,tableStore:b,headerWidth:C}=e,w=(0,L().X)("db_ux_chrome"),k=(0,L().X)("db_ux_empty_states"),I=(0,a().v3)(),{isMobile:R,isPhone:T}=(0,a().Y0)(),_=(0,pt().tz)(),P=(0,u().DP)(),B=(0,n.useContext)(ri().n),V=(0,fe().Zp)(),F=(0,n.useMemo)((()=>s?[s]:[]),[s]),{groupState:O,groupCount:D}=(0,d().K8)((()=>({groupState:r.groupsStore.getGroupState(F),groupCount:r.groupsStore.getAllGroupStates().length})),[r.groupsStore,F]),{reducerResult:z,isReady:K,hasPartialResults:H,pageCount:W,shouldShowShimmer:G}=(0,d().K8)((()=>{const e=null==O?void 0:O.reducerResultStore.state,t=void 0!==e,o=(null==e?void 0:e.blockIds.length)||0,n=void 0!==e&&e.blockIds.length>0;return{reducerResult:e,isReady:t,hasPartialResults:n,pageCount:o,shouldShowShimmer:(0,Yn().iv)({collectionContextStore:r,groupsPointer:F,hasPartialResults:n})}}),[r,O,F]),N=0===W&&K&&!G,$=(0,d().K8)((()=>(0,Yn().Kk)({collectionContextStore:r,groupsPointer:F})),[r,F]),U=(0,d().O$)(r.permissionScopesStore),q=(0,Be().bx)(e.store,e.disabled),X=(0,d().K8)((()=>!!q&&(!U.isSyncedCollection&&U.canEditContent)),[q,U]),{showPropertyFormats:Y,titleColumnIndex:Q,propertyWidths:Z,totalPropertyWidth:J}=(0,d().K8)((()=>{const e=(0,j().GW)(l,b).filter((e=>e.visible)),t=e.findIndex((e=>{let{property:t}=e;return"title"===t})),o=e.map((e=>{let{width:t}=e;return t||Md().kp}));return{showPropertyFormats:e,titleColumnIndex:t,propertyWidths:o,totalPropertyWidth:e.reduce(((e,t)=>e+(t.width||0)),0)}}),[l,b],{useDeepEqual:!0}),ee=(0,d().K8)((()=>(0,j().Ty)(l,b)),[l,b]),te=(0,d().K8)((()=>J+(U.canEditContent?32:0)),[J,U]),oe=(0,d().K8)((()=>"collectionTypedView"===r.contextType),[r]),ne=(0,d().O$)(r.isInHomeWidgetStore),ie=(0,d().O$)(r.isUnlistedViewStore),le=(0,d().O$)(r.isInlineViewStore),ae=ie&&le,ce=(0,d().K8)((()=>(0,Ce().sj)(x.id)),[x]),de=(0,d().K8)((()=>M().fG({collectionContextStore:r,environment:I,intl:_})),[r,I,_]),ue=(0,d().K8)((()=>{const e=Boolean(r.currentCombinatorFilterStore.state),t=r.currentPropertyFiltersStore.state.length>0;return e||t}),[r]),pe=(0,d().K8)((()=>""!==r.searchQueryStore.state),[r]),me=(0,n.useMemo)((()=>k&&N&&(ue||pe)),[k,N,ue,pe]),{shouldShowAddRowButton:ge,canAddRow:Se}=(0,d().K8)((()=>{const e=K&&!ne&&(X||oe)&&Boolean(r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}));return me?{shouldShowAddRowButton:!1,canAddRow:e}:{shouldShowAddRowButton:e,canAddRow:e}}),[me,K,ne,X,oe,r]),he=Boolean(s),ye=(0,d().K8)((()=>!me&&(K&&!G&&0===W&&ge&&!ue&&!he)),[ue,me,W,K,G,ge,he]),ve=(0,n.useMemo)((()=>c?4:2),[c]),xe=(0,d().K8)((()=>{var e;return Boolean(null===(e=f.aggregations)||void 0===e?void 0:e.length)}),[f]),be=(0,d().K8)((()=>!me&&(!(k&&!xe)&&!(ie||null!=V&&V.hideTableAggregationRow))),[k,me,ie,null==V?void 0:V.hideTableAggregationRow,xe]),Ie=(0,d().K8)((()=>M().XQ({collectionContextStore:r,reducerResult:z,isFullScreen:c})),[r,c,z]),Ae=(0,d().K8)((()=>r.viewIsFlushToTopbar()),[r]),je=(0,d().K8)((()=>Boolean(r.normalizedFormatStore.state.hide_table_vertical_lines)),[r]),Re=(0,d().K8)((()=>{const e=(0,re().v2)(F[0],r);return se().default.state.stores.filter((t=>e.includes(t))).length>0}),[F,r]),Me=(0,d().K8)((()=>{const{isScrolled:e,frozenIndex:t,tryShowHiddenFrozenColumn:o}=r.frozoneStore.state;if(void 0===t)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n={...(0,j().wy)({environment:I,collectionContextStore:r,isPhone:T,theme:P}),display:"flex",...e&&-1===t&&{height:"calc(100% - 1px)",borderBottom:`1px solid ${P.tableDividerColor}`}},i=Boolean(e&&-1===t),l=Boolean(i&&(o||Re)),a=r.collectionViewBlockStore(),s=!!a&&(0,Bd().d1)(a);return{isScrolled:Boolean(e),frozenIndex:t,frozenStyles:n,shouldFreezeMultiSelectColumn:i,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:s}}),[Re,r,I,T,P],{useDeepEqual:!0}),_e=(0,d().K8)((()=>{const e=r.collectionViewStore();return X&&R&&!(null!=e&&e.isSyncedCollection())}),[X,r,R]),Pe=(0,d().O$)(r.defaultPageTemplateStore),Ve=(0,d().K8)((()=>{var e,o;const n=null===(e=r.collectionStore())||void 0===e?void 0:e.id;return(t.state.isOpen&&(null===(o=t.state.collectionContextStore)||void 0===o||null===(o=o.collectionStore())||void 0===o?void 0:o.id))===n}),[t,r]),[Fe,Le]=(0,n.useState)(!1),Oe=(0,n.useCallback)((()=>{Le(!0)}),[]),Ee=(0,n.useCallback)((()=>{Le(!1)}),[]),De=(0,n.useCallback)((()=>{if(!O)return;const e=r.collectionStore();if(!e||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o=se().default.state.stores[0];if(!o)return;const n=r.subitemTreeStore.state,i=(0,en().Qe)(n.children,(e=>e.value.store===o));if(!i)return;const l=i?(0,re().kY)(i.map((e=>e.value.store))):"",a=r.subitemExpandedStore.state.get(l);Boolean(null==a?void 0:a.isExpanded)&&A().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:I,canUndo:!0,perform:n=>{const l=(0,Mn().u)({environment:I,collectionContextStore:r,groupsPointer:O.groupsPointer,store:o,before:!1,collectionStore:e,transaction:n,subitemPath:i,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(l&&t){const e=()=>{Rn().ho({isNewBlock:!0,environment:I,blockPropertyValueOverlayStore:t,store:l,property:"title",format:"table",collectionContextStore:r})};r.registerCallbackForItemMounted(l,e)}}})}),[t,r,I,O]),ze=(0,n.useCallback)((e=>{const n=new(o(732491).aD)(I,"handleAddRowClick");if(!(0,Xe().EF)(I)||!O)return n.fail("invalid_state"),void(0,Xe().QY)(I);r.searchQueryStore.state&&(0,Jn().S)({searchQuery:"",collectionContextStore:r,isFullScreen:c}),A().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:I,canUndo:!0,perform:e=>{const o=(0,Qn().Q)({environment:I,collectionContextStore:r,groupsPointer:s?[s]:[],shouldCoerce:!0,templateStore:Pe,transaction:e,from:{createBlock:"table_group_results"},tracker:n,inMemoryRecordCache:I.defaultRecordCache.inMemoryRecordCache});if(!o)return;const i=o.newStore;if(R){const e=(0,kr().Ay)({store:i,fullyQualified:!1,pageVisitSource:To().y8.Create});B?B(e):yr().oo({environment:I,url:e})}else{if(o.coercionSucceeded){const o=()=>{Rn().ho({isNewBlock:!0,environment:I,blockPropertyValueOverlayStore:t,store:i,property:"title",format:"table",collectionContextStore:r})};r.registerCallbackForItemMounted(i,o),e.postSubmitCallbacks.push((async e=>{if(!e)return r.virtualizedModule.waitToScrollToBlock(F,i)}))}else Ko().VU({environment:I,store:i,peekMode:M().hH(r),resultsStore:O.resultsStore,collectionContextStore:r,pageVisitSource:To().y8.Create});const n=r.currentSubitemFormatStoreForCollectionStore.state;An().v(I,{from:n?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:i.id,creating_block_id:i.id,...(0,ke().sl)(r)})}}})}),[I,O,r,c,s,Pe,R,B,t,F]),Ke=(0,n.useCallback)((e=>{O&&((0,Te().kV)(e),z&&(0,Uo().H)({collectionContextStore:r,environment:I,incrementLimitArgs:{isFullScreen:c,currentResultCount:z.blockIds.length,groupsPointer:O.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,_d().K)(I))}),[r,I,O,c,z]),He=(0,M().Oz)(r),We=(0,u().IS)((e=>{const{button:t,buttonInner:o,icon:n}=(0,j().BJ)({theme:e,isMobile:R,hideTextWithTransition:ye&&Fe,hideTextWithoutTransition:ye&&Ve});return{wrapper:{position:"relative",marginLeft:w&&F.length>0?24:void 0},iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:k?`1px solid ${e.tableDividerColor}`:void 0,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...$?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}},loadMoreButtonInner:o,text:{color:e.text.tertiary,flexGrow:1},addRowButtonWrapper:{...t,display:"flex",alignItems:"center",gap:w?4:2,paddingLeft:2,paddingRight:2},addRowButton:{...w?{display:"inline-flex",height:28,borderRadius:6,paddingLeft:6,paddingRight:8}:{...t},background:(null==He?void 0:He.background)||(p?e.cardContentBackground:e.contentBackground)},addRowButtonHovered:{background:w?e.buttonHoveredBackground:e.tableRowHoveredBackground},addRowButtonInner:o,linkExistingButton:{paddingLeft:6,paddingRight:8,borderRadius:6,marginLeft:w?void 0:12},linkExistingButtonInner:{display:"flex",alignItems:"center",gap:8,fontSize:14,height:28,color:e.text.tertiary},linkExistingIcon:{width:16,height:16,fill:e.icon.tertiary},aggregationRow:{...(!K||ne)&&{opacity:0,pointerEvents:"none",left:0,right:0}},spinner:{marginTop:1,marginLeft:8,marginRight:8}}}),[R,k,ye,Fe,Ve,w,F.length,$,null==He?void 0:He.background,p,K,ne]),Ge=(0,n.useCallback)((e=>(0,E.jsx)(jp,{args:e,store:x,collectionContextStore:r,collectionViewFormat:ee,blockPropertyValueOverlayStore:t,groupFormat:s,groupsPointer:F,propertyFormats:Y,schema:y,canDrag:_e,disabled:i,titleColumnIndex:Q,onShiftEnter:De,frozoneProps:Me,isInHomeWidget:ne,isFullScreen:c,isInEphemeralView:ae})),[x,r,ee,t,s,F,Y,y,_e,i,Q,De,Me,ne,c,ae]);return O?(0,E.jsxs)("div",{style:We.wrapper,children:[(0,E.jsx)(op,{store:x,format:ee,groupFormat:s,schema:y,query:f,collectionContextStore:r,isInPeekRenderer:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,blockPropertyValueOverlayStore:t,resultStore:O.reducerResultStore,showPropertyFormats:Y,showRightActions:U.canConfigureCollection&&U.canConfigureBlock&&!ae&&!ce,showHoverActionsStore:v,allowHidingTitle:!1,tableStore:b,formatKey:"table_properties",disabled:i||!U.canConfigureBlock,disableTopBorder:!Ae||he||w,disableCellRightBorder:!Ae||he||je||w,height:vo().sH,frozoneProps:Me,isInHomeWidget:ne,hasMoreReducerResults:Boolean(null==z?void 0:z.hasMore)}),(0,E.jsx)(wp,{store:x,collectionContextStore:r,minWidth:m,blockPropertyValueOverlayStore:t,showPropertyFormats:Y,disabled:!X,groupFormat:s,tableStore:b,paddingLeft:S,render:Ge}),G&&(0,E.jsx)(Ip,{isFullScreen:c,hasGroups:void 0!==s,propertyWidths:Z,hasPartialResults:H,hasSearchQuery:pe,frozoneProps:Me}),ye?(0,E.jsx)(Gd,{collectionContextStore:r,handleAddRowClick:ze,numberOfBlankRows:ve,hideDefaultButtonText:Fe,propertyFormats:Y,isBlockPropertyValueOverlayOpen:Ve,query:f}):N?(0,E.jsx)(Xd,{collectionContextStore:r,groupFormat:s,shouldShowAddRowButton:Se,shouldShowLinkButton:de,hasFilter:ue,hasSearchQuery:pe,handleAddRowClick:ze,hasMultipleGroups:D>1,left:Math.floor(C/2)}):null,(0,E.jsx)("div",{style:{width:te}}),Ie&&(ne?(0,E.jsx)(qo().jJ,{groupsPointer:F,store:x,collectionContextStore:r,format:l,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:We.viewAllButton}):(0,E.jsx)(It().A,{onMouseDown:Te().tr,onClick:Ke,disabled:$,hoveredStyle:We.loadMoreButtonHovered,style:We.loadMoreButton,children:(0,E.jsxs)("span",{style:We.loadMoreButtonInner,children:[(0,wn().g)(We.iconStyle),(0,E.jsx)("div",{style:We.text,children:(0,E.jsx)(pt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),$?(0,E.jsx)("div",{style:We.spinner,children:(0,E.jsx)(ur().A,{size:"sm"})}):X&&(0,E.jsx)(Pd().w,{collectionContextStore:r,format:l})]})})),ge&&!ye&&w&&(0,E.jsxs)("div",{style:We.addRowButtonWrapper,children:[(0,E.jsx)(It().A,{onClick:ze,onMouseDown:Te().tr,style:We.addRowButton,hoveredStyle:We.addRowButtonHovered,className:we().$0P,children:(0,E.jsxs)("span",{style:We.addRowButtonInner,children:[(0,tr().plusSmallIcon)(We.iconStyle),(0,E.jsx)(rr,{collectionContextStore:r})]})}),de&&(0,E.jsx)(gr().O,{collectionContextStore:r,groupFormat:s,renderLinkButton:e=>(0,E.jsx)(It().A,{style:We.linkExistingButton,...e,children:(0,E.jsxs)("span",{style:We.linkExistingButtonInner,children:[(0,qa().arrowDiagonalUpRightSmallIcon)(We.linkExistingIcon),(0,E.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]}),ge&&!ye&&!w&&(0,E.jsx)(It().A,{onClick:ze,onMouseDown:Te().tr,style:We.addRowButton,hoveredStyle:We.addRowButtonHovered,className:we().$0P,children:(0,E.jsxs)("span",{style:We.addRowButtonInner,children:[(0,tr().plusSmallIcon)(We.iconStyle),(0,E.jsx)(rr,{collectionContextStore:r}),de&&(0,E.jsx)(gr().O,{collectionContextStore:r,groupFormat:s,renderLinkButton:e=>(0,E.jsx)(It().A,{style:We.linkExistingButton,...e,children:(0,E.jsxs)("span",{style:We.linkExistingButtonInner,children:[(0,qa().arrowDiagonalUpRightSmallIcon)(We.linkExistingIcon),(0,E.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}),be&&(0,E.jsx)(Hd,{pageCount:W,collectionContextStore:r,disabled:i||!U.canConfigureBlock,groupFormat:s,isFullScreen:c,isInPeekRenderer:p,onMouseEnter:Oe,onMouseLeave:Ee,paddingLeft:S,paddingRight:h,query:f,schema:y,showPropertyFormats:Y,showRightActionsSpacer:U.canConfigureCollection,style:We.aggregationRow})]}):null})),jp=n.memo((function(e){const{args:t,blockPropertyValueOverlayStore:o,canDrag:r,collectionContextStore:i,collectionViewFormat:l,disabled:s,frozoneProps:c,groupFormat:p,groupsPointer:m,isFullScreen:g,isInHomeWidget:S,onShiftEnter:h,propertyFormats:f,schema:y,store:v,titleColumnIndex:x,isInEphemeralView:b}=e,C=(0,a().v3)(),w=(0,d().K8)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),k=(0,d().K8)((()=>M().f5({environment:C,collectionContextStore:i})),[i,C]),I=(0,d().K8)((()=>v.isNonEditableState()),[v]),A=(0,u().IS)((()=>({itemSelectableHalo:{borderRadius:3,zIndex:86},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),R=(0,n.useCallback)((()=>A.itemSelectableStyle),[A]),T=(0,n.useCallback)((e=>{const{store:t,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,E.jsx)(Sd,{store:t,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:s,groupsPointer:m,onSubitemCreate:e=>{if(o){const t=()=>{Rn().ho({isNewBlock:!0,environment:C,blockPropertyValueOverlayStore:o,store:e,property:"title",format:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(e,t)}}})}),[o,i,s,C,m]),_=(0,d().K8)((()=>{const e=i.collectionViewBlockStore();return!(!e||i.isFullScreenStore.state)&&(0,Bd().d1)(e)}),[i]),P=(0,d().K8)((()=>(0,re().v2)(p,i)),[p,i]),B=(0,d().K8)((()=>{const e=Od().A.state;if(e.isActive)return(0,j().yR)(e.selection,f.length,P.length)}),[P.length,f.length]),V=null==c?void 0:c.frozenIndex,F=(0,d().K8)((()=>M().qi(V)),[V]),[L,O]=(0,n.useMemo)((()=>void 0!==V?[f.slice(0,V+1),f.slice(V+1)]:[[],f]),[V,f]),D=(0,d().K8)((()=>{var e;return Boolean(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue())}),[i]),z=(0,d().K8)((()=>{var e;return Boolean("timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())||!D&&!f.some((e=>e.wrap)))}),[i,f,D]),K=(0,d().K8)((()=>{const e=i.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[i.permissionScopesStore]),H=(0,d().K8)((()=>{var e;return!S&&"timeline"!==(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i,S]),W=(0,jd().DV)(),G=(0,n.useMemo)((()=>({schema:y,collectionContextStore:i,propertyFormats:f,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:s,blockPropertyValueOverlayStore:o,disableCellBorderRight:w,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:I,disableTableWrap:!1,onShiftEnter:h,titleColumnIndex:x,groupFormat:p,frozoneProps:c,shouldShowMultiSelectCheckbox:k,isInHomeWidget:S,isCollectionViewBlockSelected:_,allRows:P,isInEphemeralView:b,normalizedTableSelection:B,unfrozenIndexAddendum:F,frozenPropertyFormats:L,unfrozenPropertyFormats:O,tableWrap:D,shouldSetCellHeight:z,isNonEditable:K,shouldShowRightActionSpacer:H,hasColumnVirtualizer:W})),[t.onOpenProperty,t.onPropertyBgClick,t.onPropertyClick,t.onPropertyContextMenu,t.onPropertyEnter,t.onPropertyEsc,t.onPropertyTab,t.onPropertyUntab,o,i,s,w,h,f,y,x,p,c,k,I,S,_,P,b,B,F,L,O,D,z,K,H,W]),N=g;return(0,E.jsx)(Hn,{collectionContextStore:i,groupsPointer:m,format:l,canDrag:r,resultProps:G,canDrop:!0,resultComponent:mp,disabled:s,direction:zn.Vertical,getItemSelectableStyle:R,itemSelectableHaloStyle:A.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:o,titleColumnIndex:x,nestedCreateSubitemButton:T,virtualizeResults:N})}),No().A),Rp=n.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,collectionContextStore:l,format:s,schema:c,disabled:p,isFullScreen:m,isRootChild:g,isInPeekRenderer:S,isPreviewing:h,query:f,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,minWidth:x,placementStore:b,headerWidth:C}=e,w=(0,a().v3)(),k=(0,d().uB)(void 0,Ad),I=(0,n.useRef)(null),A=(0,L().X)("db_ux_chrome"),R=s.collection_group_by,T=m&&!R,_=(0,d().K8)((()=>(0,j().GW)(s,k)),[s,k]),P=(0,d().K8)((()=>(0,M().mM)(l,m)),[l,m]),B=(0,d().K8)((()=>l.isInHomeWidgetStore.state),[l.isInHomeWidgetStore]),V=(0,d().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),F=(0,d().K8)((()=>{const e=l.settingsStore.state.open,t="sidebar"===b.state;return e&&t}),[l.settingsStore,b]),O=n.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<ze().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),(0,Uo().H)({collectionContextStore:l,environment:w,incrementLimitArgs:{isFullScreen:m,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,w,m]),D=(0,u().IS)((()=>({selectable:{position:"relative",marginRight:F?yo().vE:void 0},container:{position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingLeft:r,paddingRight:i,marginTop:A?4:0}})),[o,r,i,F,A]),z=(0,fe().Zp)();return(0,ei().A)((e=>{const n=(0,E.jsx)(lt().A,{store:t,shouldShowHalo:!m&&!B&&!h,canSelect:!m&&!V,disablePointerEvents:null==z?void 0:z.disableAllPointerEvents,analyticsName:"table",style:D.selectable,...e,children:R?(0,E.jsx)(Tp,{collectionContextStore:l,store:t,format:s,schema:c,query:f,isFullScreen:m,isRootChild:g,isInPeekRenderer:S,paddingLeft:r,paddingBottom:o,paddingRight:i,minWidth:x,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:p,headerWidth:C}):(0,E.jsx)(_p,{collectionContextStore:l,store:t,format:s,schema:c,query:f,isFullScreen:m,isInPeekRenderer:S,paddingLeft:r,paddingRight:i,paddingBottom:o,minWidth:x,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:p,groupFormat:void 0,headerWidth:C})});return(0,E.jsx)("div",{className:we().EOV,style:D.container,ref:I,children:(0,E.jsxs)(Dn.Provider,{value:I,children:[R?(0,E.jsx)(Td,{collectionContextStore:l,tableProperties:_,paddingLeft:r,paddingRight:i,children:n}):(0,E.jsx)(Pl,{nodeRef:I,children:(0,E.jsx)(Td,{collectionContextStore:l,tableProperties:_,paddingLeft:r,paddingRight:i,children:n})}),!P&&!T&&(0,E.jsx)(Xn().A,{onChange:e=>O(e)})]})})}))})),Tp=n.memo((function(e){let{collectionContextStore:t,store:o,format:r,schema:i,query:l,disabled:s,isFullScreen:c,paddingLeft:d,paddingRight:p,isRootChild:m,isInPeekRenderer:g,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,tableStore:v,headerWidth:b}=e;const C=(0,a().v3)(),w=(0,u().IS)((e=>({groupDivider:{borderTop:`1px solid ${e.tableDividerColor}`}})),[]),k=(0,L().X)("db_ux_chrome"),I=(0,n.useCallback)((()=>{x().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Mo().V1}})}),[t]),A=(0,n.useCallback)(((e,t)=>k&&0===e.index?{marginTop:4}:k||t.isInHomeWidgetStore.state?{}:0!==e.index||t.viewIsFlushToTopbar()?e.index>0&&t.shouldShowSpinnerStore.state?{}:w.groupDivider:{}),[k,w.groupDivider]),j=(0,n.useCallback)(((e,o)=>{if(C.device.isMobile)zo().uK({environment:C,store:e,pageVisitSource:To().y8.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;Ko().VU({environment:C,store:e,peekMode:(0,M().hH)(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:To().y8.Create})}}),[t,C]);return(0,E.jsx)(ca,{reducerId:"table_groups",store:o,collectionContextStore:t,disabled:s,isFullScreen:c,isRootChild:m,paddingLeft:d,stickyLeft:!0,renderGroup:e=>(0,E.jsx)(_p,{store:o,format:r,schema:i,query:l,collectionContextStore:t,showHoverActionsStore:S,isFullScreen:c,isInPeekRenderer:g,disabled:s,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,paddingLeft:d,paddingRight:p,tableStore:v,groupFormat:e,headerWidth:b}),onClickEmptyStateButton:I,getGroupStyle:e=>A(e,t),renderHeader:e=>(0,E.jsx)(Mp,{args:e,isInPeekRenderer:g}),onGroupHeaderAddItem:(e,t,o)=>{j(e,o)}})})),Mp=n.memo((function(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:n}=t,r=(0,d().O$)(n.isInHomeWidgetStore),i=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${o?e.cardContentBackground:e.contentBackground}`}})),[o]);return(0,E.jsx)(dl,{...t,height:r?yt().ag:vo().n1,paddingTop:0,toggleClosedMarginBottom:8,stickyStyle:i.stickyStyle})})),_p=n.memo((function(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:a,isFullScreen:s,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,tableStore:f,headerWidth:y}=e;const v=(0,d().uB)(f,Ad);return(0,d().K8)((()=>l.groupsStore.getGroupState(t?[t]:[])),[l,t])?(0,E.jsx)(Ap,{tableStore:v,groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:a,isFullScreen:s,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,headerWidth:y}):null}));var Pp=()=>o(546286),Bp=()=>o(131809);class Vp extends p().default{constructor(){super("hiddenGroupsVisibleStore")}getInitialState(){return!1}}class Fp extends p().default{getInitialState(){return new Set}}class Lp extends(()=>o(151255))().A{constructor(){super(...arguments),this.itemsRefStore=new Fp}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const Op=new Lp;(0,o(996094).exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",Op);var Ep=()=>o(221573),Dp=()=>o(210106),zp=()=>o(627683);const Kp=15,Hp=33,Wp=12,Gp={position:"absolute",left:0,top:0,zIndex:86,width:"100%",height:"100%",pointerEvents:"none"};function Np(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+Wp,o.top=o.top-Kp)),o):o}function $p(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:s,isFullScreen:c,isRootChild:p,relationType:m,isUserDrawnTemp:g,isNewSubitemPlaceholder:S,renderEmitter:h}=e,f=(0,ee().ET)(),y=(0,a().v3)(),v=(0,Ep().I)(),[x,b]=(0,n.useState)(!1),C=(0,u().DP)(),[w,k]=(0,n.useState)(null),[I,A]=(0,n.useState)(null),j=(0,n.useCallback)((e=>{k(e.state)}),[]),R=(0,n.useCallback)((e=>{A(e.state)}),[]),T=(0,n.useCallback)((()=>{l().default.afterNextFlush((()=>{v("CollectionTimelineRelationArrow","CollectionTimelineRelationArrow/resetTopPositions")}))}),[v]);(0,n.useEffect)((()=>(k(t.stores.nodeStore.state),A(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(j),null==o||o.stores.nodeStore.addListener(R),null==h||h.addListener(T),f.filtersBarOpenStore.addListener(T),()=>{t.stores.nodeStore.removeListener(j),null==o||o.stores.nodeStore.removeListener(R),null==h||h.removeListener(T),f.filtersBarOpenStore.removeListener(T)})),[t,o,h,j,R,T,f.filtersBarOpenStore]);const M=(0,d().K8)((()=>nn().Ay.state.isDragging&&nn().Ay.state.draggedStores.includes(t.props.store)),[t]),_=(0,d().K8)((()=>o&&nn().Ay.state.isDragging&&nn().Ay.state.draggedStores.includes(o.props.store)),[o]),P=(0,d().K8)((()=>{const e=nn().Ay.state;return e.isDragging?e.currentY-e.startY:0}),[]),B=w&&w.getBoundingClientRect().y+(M?P:0),V=(0,d().K8)((()=>{const e=t.itemPositionStore.state;return B&&e?{left:e.left,right:"subitem"===m?e.left+Wp:e.right,top:"subitem"===m?B+Kp:B}:void 0}),[m,t.itemPositionStore,B]),F=I&&I.getBoundingClientRect().y+(_?P:0),L=(0,d().K8)((()=>{const e=F&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:F}:void 0;return"subitem"===m?Np({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,F,m,t.itemPositionStore]),O=(0,d().O$)(t.dateValueStore),D=(0,d().K8)((()=>null==o?void 0:o.dateValueStore.state),[o]),z=(0,d().K8)((()=>void 0!==i.dragStateStore.state),[i]),K=(0,d().K8)((()=>void 0!==i.drawStateStore.state),[i]),H=(0,d().O$)(i.hoveredItemStore),W=x&&!z&&!K,G=(0,n.useCallback)((()=>{r&&!s&&Pp().cd({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:f,environment:y,timelineState:i,isFullScreen:c,isRootChild:p})}),[t,s,r,f,y,i,c,p]),N=(0,n.useCallback)((()=>{b(!0)}),[b]),$=(0,n.useCallback)((()=>{b(!1)}),[b]),U=(0,n.useCallback)((e=>{if(L)return(0,E.jsx)(Up,{topOffset:e,endPosition:L,handleCloseButtonClick:G})}),[L,G]),q=(0,d().O$)(f.permissionScopesStore),X=H===t.props.store,Y=o&&H===o.props.store,Q=X||Y||W||"subitem"===m?1:.7;let Z;const J=(0,d().K8)((()=>t.props.store.canEdit()),[t.props.store]),te=(0,d().K8)((()=>"subitem"!==m&&(J&&("collectionTypedView"===f.contextType||q.canEditContent))),[m,J,f,q.canEditContent]);"subitem"===m?Z=C.collectionUnsetDependencyArrow:O&&D&&(Z=O<=D?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const oe=(0,u().IS)((()=>({svgStyle:{zIndex:"dependency"===m&&(W||Y)?86:83}})),[m,W,Y]);return V?g?(0,E.jsx)(qp,{startPosition:V,timelineState:i}):S?(0,E.jsx)(Xp,{startPosition:V,timelineState:i}):t!==o&&L?(0,E.jsx)(Yp,{startPosition:V,endPosition:L,strokeOpacity:Q,strokeColorOverride:Z,svgStyle:oe.svgStyle,cornerRadiusOverride:"subitem"===m?8:void 0,relationType:m,handleMouseMove:N,handleMouseLeave:$,renderChildren:te&&W?U:void 0}):null:null}function Up(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,u().IS)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,Dp().J)(r.icon)})})}function qp(e){const{startPosition:t,timelineState:o}=e,n=(0,d().K8)((()=>{const e=o.drawStateStore.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawStateStore]);return n?(0,E.jsx)(Yp,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function Xp(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,u().DP)(),i=(0,d().O$)(n.dateRangePlaceholderStore),l=(0,d().K8)((()=>null!=i&&i.active?i.date:void 0),[i]),a=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,s=a?a[a.length-1].children.length:0,c=o.top+s*Hp+Kp+5,p=(0,d().K8)((()=>{const e=(0,xo().BD)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return Np({startItemPosition:o,value:t})}),[l,c,o,n]);return p?(0,E.jsx)(Yp,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function Yp(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:l,relationType:a,svgStyle:s,handleMouseMove:c,handleMouseLeave:p}=e,m=(0,ee().ET)(),g=(0,u().DP)(),[S,h]=(0,n.useState)(0),f=t.right,y=t.top+Kp-S,v=o.left-3,x=o.top+Kp-S,b=(0,d().K8)((()=>{if(r)return r;return(0,xo().tH)(m)&&t.right&&o.left?t.right<o.left?g.collectionValidDependencyArrow:g.collectionInvalidDependencyArrow:g.collectionUnsetDependencyArrow}),[m,o.left,t.right,r,g]);return(0,E.jsx)("svg",{style:{...Gp,...s},ref:e=>{e&&h(e.getBoundingClientRect().top)},children:(0,E.jsx)(zp().A,{startPoint:{x:f,y},endPoint:{x:v,y:x},style:{stroke:b,strokeWidth:xo().cC,strokeOpacity:l},useRightAngles:"subitem"===a,showArrowHead:"dependency"===a&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:c,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(S)})})}function Qp(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:l,renderEmitter:a}=e,s=(0,ee().ET)(),c=(0,n.useCallback)((()=>{t.drawStateStore.setState(void 0)}),[t.drawStateStore]),u=(0,d().K8)((()=>s.collectionViewBlockStore()),[s]),p=(0,d().K8)((()=>s.settingsStore.state.open),[s]);if((0,n.useEffect)((()=>{var e;!p&&null!==(e=t.drawStateStore.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[p,t.drawStateStore,c]),!r||!u)return null;const m=Op.findCollectionTimelineViewItems(u);return(0,E.jsx)(E.Fragment,{children:m.map((e=>{const{store:r,groupFormat:s}=e.props,c=null==s?void 0:s.value,d=c?(0,Mo().AC)(c):"noGroup";return(0,E.jsxs)(n.Fragment,{children:[(0,E.jsx)(Zp,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,E.jsx)(Zp,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function Zp(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,relationType:a,renderEmitter:s}=e,{store:c,schema:u}=t.props,p=(0,ee().ET)(),m=(0,d().K8)((()=>"dependency"===a?o.drawStateStore.state:void 0),[o.drawStateStore,a]),g=(0,d().K8)((()=>(null==m?void 0:m.startStore)===c),[c,m]),S=(0,d().K8)((()=>g&&!(null!=m&&m.tryToCompleteDrawnArrow)),[m,g]),h=(0,d().K8)((()=>"dependency"===a?g&&m?m.temporaryDependencyRelationPointers:(0,xo().GW)(p,c,u):"subitem"===a?(0,xo().s0)(p,c,u):[]),[a,g,m,p,c,u]),f=(0,d().K8)((()=>p.collectionViewBlockStore()),[p]),y=(0,d().K8)((()=>{var e;const n=o.dateRangePlaceholderStore.state;if("subitem"!==a||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[a,t.props.store,o.dateRangePlaceholderStore]),v=(0,d().K8)((()=>[...Op.getItemsRefStore().state]),[]);return f?(0,E.jsxs)(E.Fragment,{children:[h.map((e=>{if(c.id===e.id)return null;const d=v.filter((t=>t.props.store.id===e.id));return(0,E.jsx)(n.Fragment,{children:d.map((n=>{const c=n.props.store,d=n.props.groupFormat;return(0,E.jsx)($p,{startItem:t,endItem:n,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:a},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===a&&S&&(0,E.jsx)($p,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}),"subitem"===a&&y&&(0,E.jsx)($p,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"})]}):null}const Jp=n.memo((function(e){const{zoomLevel:t,onChange:o}=e,r=(0,a().Y0)(),i=(0,u().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.mediumIconColor}})),[]),l=(0,n.useMemo)((()=>(0,Ll().b)(i.icon)),[i.icon]),s=(0,n.useCallback)((e=>(0,E.jsxs)(dr().p,{size:"sm",isGray:!0,...e,children:[(0,E.jsx)(em,{zoomLevel:t}),l]})),[l,t]),c=(0,n.useCallback)((e=>(0,E.jsx)(tm,{parent:e,zoomLevel:t,onChange:o})),[t,o]);return(0,E.jsx)(qi().Ay,{popupType:r.isMobile?ks().nl.SlideUp:ks().nl.Popup,originGap:8,renderOrigin:s,render:c})})),em=n.memo((function(e){const{zoomLevel:t}=e;return"hours"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):"5_years"===t?(0,E.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.years",defaultMessage:"5 Years"}):void(0,y().HB)(t)})),tm=n.memo((function(e){const{zoomLevel:t,onChange:o,parent:r}=e,{isMobile:i}=(0,a().Y0)(),l=(0,n.useMemo)((()=>[{key:"calendar by section",render:e=>(0,E.jsx)(Pi().A,{...e}),items:Md().Ui.map((e=>{const t={key:e,render:t=>(0,E.jsx)(Ui().A,{...t,title:(0,E.jsx)(em,{zoomLevel:e})}),action:()=>{o(e),r.close()}};return t}))}]),[o,r]),s=(0,n.useCallback)((e=>{const o=i?{menuType:ji().gu.Modal,title:(0,E.jsx)(pt().sA,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,E.jsx)(_i().DoneMenuText,{}),onClickRight:r.close,...e}:{menuType:ji().gu.Popup,width:180,...e};return(0,E.jsx)(Ti().A,{...o,children:(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,sections:l,initialFocus:Md().Ui.indexOf(t)})})}),[i,r.close,l,t]);return(0,E.jsx)(it().A,{capture:!0,allowEsc:!0,render:s})})),om=6,nm=xo().tp+xo().lH,rm=n.memo((function(e){let{timelineState:t,scrollerLeftOffset:i,paddingLeft:l,showTable:s,isFullScreen:c,isRootChild:p,isReady:m,collectionContextStore:g,isInPeekRenderer:S,format:h,paddingRight:f}=e;const y=(0,u().DP)(),v=(0,a().v3)(),x=(0,d().K8)((()=>{const e=t.zoomLevelStore.state,{primaryDisplayUnit:o,secondaryDisplayUnit:n}=xo().eM[e],a=t.scrollLeftStore.state,{startTimestamp:d}=t.currentRangeStore.state;if(void 0!==a){const t=d+(0,xo().C1)(e,a+i+(!s&&c?l:0));return(0,xo().DY)(r().c9.fromMillis(t),o).startOf(n).valueOf()}}),[t,i,l,s,c]),b=(0,a().Y0)(),C=(0,d().O$)(t.zoomLevelStore),w=(0,d().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:k}=xo().eM[C],I=(0,d().K8)((()=>(0,xo().DG)({environment:v,isFullScreen:c,isRootChild:p})),[v,c,p]),j=(0,d().O$)(g.permissionScopesStore),R=!s&&I&&j.canConfigureBlock,T=(0,M().Oz)(g),_=(null==T?void 0:T.background)||(S?y.cardContentBackground:y.contentBackground),P=S?y.cardContentBackgroundTransparent:y.contentBackgroundTransparent,B=(0,u().IS)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingLeft:c&&!s?i+l:i,display:"flex",alignItems:"center",height:nm,paddingTop:om+(b.isMobile?2:0),background:_,fontSize:14,fontWeight:Ro().Wy.medium},outerContainer:{position:"sticky",left:0,width:w,zIndex:2,height:0},controlBarRight:{position:"absolute",top:1,right:"var(--sticky-horizontal-offset, 0px)",paddingRight:f,display:"flex",alignItems:"center",height:nm,paddingTop:om+1,background:_},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:b.isIOS?0:1,height:22,fill:y.lightIconColor}})),[_,b.isIOS,b.isMobile,c,w,l,f,i,s,y.lightIconColor]),V=(0,n.useRef)(null),F=(0,n.useCallback)((e=>{Pp().k3({timelineState:t,environment:v,zoomLevel:e,centerTimestamp:(0,xo().o$)(t)}),(0,Bp().z2)(v,(0,Bp().ZR)({environment:v,collectionContextStore:g,timelineState:t,isFullScreen:c,isRootChild:p}))}),[t,v,g,c,p]);return(0,E.jsx)(sl().g,{stickyAttachPoint:"ceiling",nodeRef:V,noPlaceholder:!0,children:(0,E.jsxs)("div",{style:B.outerContainer,ref:V,children:[x&&(0,E.jsxs)("div",{style:B.secondaryDisplayUnit,children:[R&&(0,E.jsx)(jt().A,{render:e=>(0,E.jsx)(dr().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;A().createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,xo().iH)(t,!0);Eo().zA({stores:[l],update:o,transaction:e})}}),(0,Bp().VD)(e,{...(0,Bp().ZR)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(v,h,t,g,c,p),style:B.hideTableIcon,...e,children:(0,o(534891).a)({width:14})}),renderTooltip:()=>(0,E.jsx)(pt().sA,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,E.jsx)("span",{style:{paddingLeft:R||b.isPhone?0:c||s?16:2},children:(0,xo().Kx)(x,k)}),!m&&!s&&(0,E.jsx)(im,{}),(0,E.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${_} 20%, ${P} 100%)`}})]}),(0,E.jsxs)("div",{style:B.controlBarRight,children:[(0,E.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${_} 20%, ${P} 100%)`}}),(0,E.jsx)(ed,{collectionContextStore:g}),(0,E.jsx)(Jp,{zoomLevel:C,onChange:F}),(0,E.jsx)(dr().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=t.outerSizeObserver.rect.state.width,c=(0,xo().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(s-c)/2,u=(0,xo().o$)(t),p=u-(0,xo().C1)(a,d);Pp().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:p}),(0,Bp().i6)(e,{...(0,Bp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(v,t,l,h,c,p,g),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,Dc().I)({width:12,fill:y.mediumIconColor})}),(0,E.jsx)(dr().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=(0,xo().uW)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});Pp().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:s}),(0,Bp().AP)(e,{...(0,Bp().ZR)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(v,t,l,h,g,c,p),children:(0,E.jsx)(pt().sA,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,E.jsx)(dr().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=t.outerSizeObserver.rect.state.width,c=(0,xo().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(s-c)/2,u=(0,xo().o$)(t),p=u+(0,xo().C1)(a,d);Pp().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:p}),(0,Bp().i6)(e,{...(0,Bp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(v,t,l,h,c,p,g),style:{paddingLeft:4,paddingRight:4},children:(0,zc().V)({width:12,fill:y.mediumIconColor})})]})]})})}));function im(){return(0,Jr().A)(!0,400,0)?(0,E.jsx)(ur().A,{style:{marginLeft:8,marginTop:1}}):null}var lm=()=>o(496985),am=()=>o(707781);function sm(e){const{shouldShowShimmer:t,children:o}=e,n=(0,Jr().A)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,E.jsx)("div",{className:n,style:{height:"100%"},children:o})}const cm=4,dm=22,um=110,pm=7,mm=22,gm=12,Sm=4,hm=32;function fm(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:s,schema:c}=e,p=(0,a().Y0)(),m=(0,pt().tz)(),g=(0,L().X)("db_ux_chrome"),S=(0,n.useRef)(null),{value:h}=(0,le().fJ)(ve().T.formulas),y=(0,Ep().I)(),v=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&y("CollectionTimelineViewTimeBar","CollectionTimelineViewTimeBar/handleSeconds")}),[y]);(0,n.useEffect)((()=>{const e=setInterval(v,1e3);return()=>clearInterval(e)}),[v]);const{primaryDisplayUnit:x,activeRangeType:b}=(0,d().K8)((()=>{const e=l.zoomLevelStore.state;return xo().eM[e]}),[l]),C=(0,xo().LH)(x),w=r().c9.now(),k=C?w.startOf("minute"):w.startOf("day"),I=w.startOf("minute"),A=(0,d().K8)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Yn().iv)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),j=(0,d().K8)((()=>o.viewIsFlushToTopbar()),[o]),R=new(lm().default)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragStateStore.state,n=l.zoomLevelStore.state,r=l.hoveredItemStore.state,i=l.dateRangePlaceholderStore.state,{activeRangeType:a}=xo().eM[n];if(!a)return;let d;if(t)d=t.temporaryValues.map((e=>(0,xo().yl)(e,"day")));else if(i.active)d=[(0,xo().yl)(i.date,"day")];else{const{stores:t}=se().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=f().sb(f().oE([...n,r]));d=f().oE(i.map((e=>{const t=(0,xo().GM)({store:e,query:s,schema:c,userId:o.getCurrentUserId(),intl:m,formulasModule:h});if(t)return(0,xo().yl)(t,"day")})))}const u=f().wq(d,(e=>{let{start:t}=e;return t.valueOf()})),p=f().Sk(d,(e=>{let{end:t}=e;return t.valueOf()}));return u&&p?{start:u.start.valueOf(),end:p.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),T=null===(t=(0,M().Oz)(o))||void 0===t?void 0:t.background,_=(0,u().IS)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:T||(i?e.cardContentBackground:e.contentBackground),boxSizing:"border-box",boxShadow:j&&!g?`inset 0 var(--timeline-box-shadow, 1px) 0 0 ${e.tableDividerColor}`:void 0},controlBar:{height:nm,position:"relative",overflow:"hidden"},primaryTimeBar:{height:hm,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[T,g,i,j]);return(0,E.jsx)(sl().g,{stickyAttachPoint:"ceiling",nodeRef:S,stickyStyle:_.stickyStyle,transitionStickyStyle:_.transitionStickyStyle,noPlaceholder:!0,children:(0,E.jsxs)("div",{style:_.wrapper,ref:S,children:[(0,E.jsx)("div",{style:_.controlBar,children:!p.isPhone&&(0,E.jsx)(jm,{timelineState:l})}),(0,E.jsxs)("div",{style:_.primaryTimeBar,children:[(0,E.jsx)(sm,{shouldShowShimmer:A,children:(0,E.jsx)(Am,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:k})}),"highlight_days"===b&&(0,E.jsx)(Tm,{timelineState:l,activeRangeStore:R}),(0,E.jsx)(Rm,{timelineState:l,time:k}),"display_range"===b&&(0,E.jsx)(Tm,{timelineState:l,activeRangeStore:R})]}),(0,E.jsx)(Cm,{timelineState:l,time:I})]})})}function ym(e){const{time:t,isNowIndicator:o,timelineState:n}=e,r=n.zoomLevelStore.state,{startTimestamp:i}=n.currentRangeStore.state,{primaryDisplayUnit:l,primaryDisplayUnitAlignment:a}=xo().eM[r],s=(0,xo().DY)(t,l),c=(0,xo().Vz)(t,l),d=(0,xo().w0)(r,s.valueOf()-i),u=(0,xo().w0)(r,t.valueOf()-i),p=(0,xo().w0)(r,c.valueOf()-i)-d,m=o?Sm:0;return{left:("range_start"===a?u-p/2:u)-m,width:p+2*m}}function vm(e){return{color:e.text.primary,fontSize:gm}}function xm(e){return{background:e.timelineRed,width:mm,height:mm,borderRadius:mm/2,position:"absolute",left:`calc(50% - ${mm/2}px)`,top:`calc(50% - ${mm/2}px)`}}function bm(e){const{time:t,accent:o,timelineState:r}=e,i=(0,d().O$)(r.zoomLevelStore),{left:l,width:a}=(0,d().K8)((()=>ym({time:t,isNowIndicator:!1,timelineState:r})),[t,r]),s=(0,u().IS)((e=>({container:{position:"absolute",top:0,left:l,width:a,height:hm-4,display:"flex",alignItems:"start",lineHeight:hm-4+"px"},text:{fontSize:gm,margin:"0 auto"},singleColor:{color:o?e.text.primary:e.text.tertiary},twoColorDarker:{color:o?e.text.primary:e.text.secondary},twoColorLighter:{color:o?e.text.secondary:e.text.tertiary}})),[o,l,a]),c=(0,n.useMemo)((()=>{const{primaryDisplayUnit:t}=xo().eM[i],o=e.time.setLocale(Ec().locale),n=(0,xo().IW)(),r=o.toFormat("t").startsWith(o.toFormat("a"));if("fifteen_minutes"===t){if(n)return(0,E.jsx)("span",{style:s.singleColor,children:o.toFormat("H:mm")});{const e=(0,E.jsx)("span",{style:{...s.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h:mm")}),t=(0,E.jsx)("span",{style:{...s.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,E.jsxs)(E.Fragment,{children:[t,e]}):(0,E.jsxs)(E.Fragment,{children:[e,t]})}}if("hour"===t){if(n)return(0,E.jsx)("span",{style:s.singleColor,children:o.toFormat("H:mm")});{const e=(0,E.jsx)("span",{style:{...s.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h")}),t=(0,E.jsx)("span",{style:{...s.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,E.jsxs)(E.Fragment,{children:[t,e]}):(0,E.jsxs)(E.Fragment,{children:[e,t]})}}return"day"===t||"week"===t?"week"===i||"bi_week"===i?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("span",{style:{...s.twoColorLighter,paddingRight:3},children:o.toFormat("ccccc")}),(0,E.jsx)("span",{style:{...s.twoColorDarker,padding:"2px 7px"},children:o.toFormat("d")})]}):(0,E.jsx)("span",{style:s.singleColor,children:o.toFormat("d")}):"month"===t?(0,E.jsx)("span",{style:s.singleColor,children:o.toFormat("M")}):void(0,y().HB)(t)}),[i,e.time,s.singleColor,s.twoColorDarker,s.twoColorLighter]);return(0,E.jsx)("div",{style:s.container,children:(0,E.jsx)("div",{style:s.text,children:c})})}function Cm(e){const{time:t,timelineState:o}=e,r=(0,d().O$)(o.zoomLevelStore),{startTimestamp:i}=(0,d().O$)(o.currentRangeStore),l=(0,n.useMemo)((()=>Math.floor((0,xo().w0)(r,t.valueOf()-i))),[r,t,i]),a=(0,u().IS)((e=>({container:{position:"absolute",left:l-pm/2+.5,top:Math.floor(hm+nm-pm/2+.5),width:pm,height:pm,background:e.timelineRed,borderRadius:"100%"}})),[l]);return(0,E.jsx)("div",{style:a.container})}function wm(e){const{time:t,timelineState:o,intl:r}=e,{isMobile:i}=(0,a().Y0)(),l=(0,d().O$)(o.zoomLevelStore),{startTimestamp:s}=(0,d().O$)(o.currentRangeStore),c=(0,n.useMemo)((()=>(0,xo().w0)(l,t.valueOf()-s)),[l,t,s]),p=(0,n.useMemo)((()=>{const{secondaryDisplayUnit:e}=xo().eM[l];return(0,xo().u7)((0,am().H)(r),t.valueOf(),e)}),[l,r,t]),m=(0,u().IS)((e=>({container:{position:"absolute",top:0,left:c,height:hm,color:e.text.primary,fontSize:14,fontWeight:Ro().Wy.medium,verticalAlign:"middle",paddingTop:om+(i?2:7),display:"flex",alignItems:"center"}})),[i,c]);return(0,E.jsx)("div",{style:m.container,children:p},c)}function km(e){let{start:t,end:o,rangeWidth:n}=e;const r=(0,u().DP)();return t&&o?n>=um?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:vm(r),children:(0,gc().W_)(t.valueOf(),"month_day",Ec().locale)}),(0,E.jsx)("div",{style:{flexGrow:1}}),(0,E.jsx)("div",{style:vm(r),children:(0,gc().W_)(o.valueOf(),"month_day",Ec().locale)})]}):(0,E.jsxs)("div",{style:vm(r),children:[(0,gc().W_)(t.valueOf(),"month_day",Ec().locale)," – ",t.month===o.month?(0,gc().W_)(o.valueOf(),"day",Ec().locale):(0,gc().W_)(o.valueOf(),"month_day",Ec().locale)]}):(0,E.jsx)("div",{style:vm(r),children:(0,gc().W_)(t.valueOf(),"month_day",Ec().locale)})}function Im(e,t,o,n){const r=e.setLocale(Ec().locale),i=(0,xo().LH)(o),l=(0,xo().IW)();return i?l?(0,E.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,E.jsx)("span",{style:{color:n.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("span",{style:{color:n.text.tertiary,paddingRight:3},children:r.toFormat("ccccc")}),(0,E.jsxs)("div",{style:{position:"relative"},children:[(0,E.jsx)("div",{style:xm(n)}),(0,E.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,E.jsxs)("div",{style:{position:"relative"},children:[(0,E.jsx)("div",{style:xm(n)}),(0,E.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Am(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const n=(0,d().O$)(o.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,d().O$)(o.currentRangeStore),a=xo().eM[n],{primaryDisplayUnit:s,hidePrimaryIndicatorIntersectionOffset:c}=a,u=c||0,p=(0,d().K8)((()=>ym({time:t,isNowIndicator:!0,timelineState:o})),[t,o]),m=p.left+u,g=p.left+p.width-u,S=[];let h=(0,xo().DY)(r().c9.fromMillis(i),s);const f=(0,d().K8)((()=>ym({time:h,isNowIndicator:!1,timelineState:o})),[h,o]);for(;h.valueOf()<l;){const e=f.left+u,t=f.left+f.width-u;void 0!==c&&(m>=e&&m<=t||g>=e&&g<=t)||S.push((0,E.jsx)(bm,{timelineState:o,time:h,accent:!1},h.valueOf()));const n=(0,xo().Vz)(h,s);h=n}return(0,E.jsx)(E.Fragment,{children:S})}function jm(e){let{timelineState:t}=e;const o=(0,pt().tz)(),n=(0,d().O$)(t.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,d().O$)(t.currentRangeStore),a=xo().eM[n],{primaryDisplayUnit:s,secondaryDisplayUnit:c}=a,u=[];let p=(0,xo().DY)(r().c9.fromMillis(i),c);for(;p.valueOf()<l;){u.push((0,E.jsx)(wm,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,xo().Vz)(p,c);p=(0,xo().zj)(e,s)}return(0,E.jsx)(E.Fragment,{children:u})}function Rm(e){let{time:t,timelineState:o}=e;const n=(0,u().DP)(),r=(0,d().O$)(o.zoomLevelStore),{primaryDisplayUnit:i}=xo().eM[r],{left:l,width:a}=(0,d().K8)((()=>ym({time:t,isNowIndicator:!0,timelineState:o})),[t,o]);return(0,E.jsx)("div",{style:{position:"absolute",top:0,left:l,width:a,height:hm-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,E.jsx)("div",{style:{fontSize:gm,margin:"0 auto",display:"flex"},children:Im(t,r,i,n)})},l)}function Tm(e){let{timelineState:t,activeRangeStore:o}=e;const n=(0,u().DP)(),i=(0,d().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:a}=(0,d().O$)(t.currentRangeStore),s=xo().eM[i],{activeRangeType:c}=s,p=(0,d().O$)(o);if(p){const e=(0,xo().DY)(r().c9.fromMillis(p.start),"day"),o=(0,xo().w0)(i,e.valueOf()-l);if("highlight_days"===c){const s=[];let c=r().c9.fromMillis(Math.max(e.valueOf(),(0,xo().DY)(r().c9.fromMillis(l),"day").valueOf()));for(;c.valueOf()<p.end&&c.valueOf()<a;){s.push(c);c=(0,xo().Vz)(c,"day")}const d=(0,xo().w0)(i,c.valueOf()-l)-o+2*cm,u=s.map(((e,o)=>(0,E.jsx)(bm,{timelineState:t,time:e,accent:0===o||o===s.length-1},`${e.toString()}-${o}`)));return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:{position:"absolute",top:0,left:o-cm,width:d,marginTop:(hm-dm)/2-2,height:dm,background:n.timelineDarkerBackground,borderRadius:dm/2}}),u]})}{const t=(0,xo().DY)(r().c9.fromMillis(p.end),"day"),a=(0,xo().NB)(r().c9.fromMillis(p.end),"day"),s=(0,xo().w0)(i,t.valueOf()-l)-o+2*cm;return(0,E.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-cm,minWidth:s,marginTop:(hm-dm)/2-2,height:dm,background:n.timelineDarkerBackground,borderRadius:dm/2,paddingLeft:6,paddingRight:6},children:(0,E.jsx)(km,{start:e,end:e.valueOf()!==a.valueOf()?a:void 0,rangeWidth:s})})}}return null}function Mm(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:n}=e;const r=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),i=t.settingsStore;return(0,E.jsx)(Wa().Ay,{title:(0,E.jsx)(pt().sA,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,E.jsx)(pt().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,E.jsx)(Wa().P6,{onClick:()=>{x().Ow({collectionContextStore:t,collectionSettingsStore:i}),x().a2({collectionSettingsStore:i,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,E.jsx)(pt().sA,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:n}})}function _m(e){let{timelineState:t}=e;const o=(0,Ep().I)(),r=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&o("TimelineBackground","TimelineBackground/handleSeconds")}),[o]);(0,n.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const i=(0,d().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:a}=(0,d().O$)(t.currentRangeStore);return(0,E.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,E.jsx)(Lm,{zoomLevel:i,startTimestamp:l,endTimestamp:a}),(0,E.jsx)(Om,{zoomLevel:i,startTimestamp:l,endTimestamp:a}),(0,E.jsx)(Fm,{zoomLevel:i,startTimestamp:l})]})}const Pm=n.memo(_m,No().A),Bm=n.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,u().IS)((e=>{const r=t.plus({day:2}).startOf("day"),i=(0,xo().w0)(o,t.valueOf()-n);return{weekendIndicator:{position:"absolute",left:i,width:(0,xo().w0)(o,r.valueOf()-n)-i,height:"100%",background:e.timelineDarkerBackground}}}),[t,n,o]);return(0,E.jsx)("div",{style:r.weekendIndicator},t.valueOf())}),No().A),Vm=n.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,u().IS)((e=>({verticalDivider:{position:"absolute",left:(0,xo().w0)(o,t-n),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[n,t,o]);return(0,E.jsx)("div",{style:r.verticalDivider},t)}),No().A),Fm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const n=(0,u().IS)((e=>{const n=r().c9.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,xo().w0)(t,n.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,E.jsx)("div",{style:n.nowVerticalDivider})}),No().A),Lm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{showWeekendIndicators:i}=xo().eM[t];if(!i)return null;let l=(0,xo().DY)(r().c9.fromMillis(o),"day");const a=[];for(;l.valueOf()<n;)6===l.weekday&&a.push((0,E.jsx)(Bm,{start:l,zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,xo().Vz)(l,"day");return(0,E.jsx)(E.Fragment,{children:a})}),No().A),Om=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{verticalDividerUnit:i}=xo().eM[t];if(!i)return null;const l=[];let a=(0,xo().DY)(r().c9.fromMillis(o),i);for(;a.valueOf()<n;)l.push((0,E.jsx)(Vm,{time:a.valueOf(),zoomLevel:t,startTimestamp:o},a.valueOf())),a=(0,xo().Vz)(a,i);return(0,E.jsx)(E.Fragment,{children:l})}),No().A);var Em=()=>o(599834);function Dm(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:s}=e;return(0,n.useCallback)((e=>{const{groupFormat:n,groupsDisplayState:c}=e,d=i.collection_group_by,u=t.groupsStore.getGroupState(n),p=Boolean(n&&!(null!=u&&u.toggleStateStore.state)),{currentGroups:m,visibleGroups:g,hiddenGroups:S}=c,h=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(n,p,m,t),f=null==u?void 0:u.reducerResultStore.state,y=M().XQ({collectionContextStore:t,reducerResult:f,isFullScreen:o}),v=n===S[S.length-1],x=n===g[g.length-1],b=(0,Vo().Zl)(c,t,!1),C=l.state?v:x,w=t.permissionScopesStore.state,k=C&&!r&&w.canConfigureBlock&&d&&(0,Mo().pP)(d,w.canConfigureCollection),I=f&&0===f.blockIds.length;return{groupHeader:Boolean(n&&(!a||!h)),tableHeaderRow:Boolean(a&&!p&&!h),tableAggregationRow:Boolean(a&&!p),addItemRow:Boolean(s&&!p),hiddenGroupsButton:Boolean(x&&S.length>0),groupsLoadMoreButton:Boolean(x&&b),loadMoreButton:Boolean(!p&&y),tableEmptyRow:Boolean(a&&!p&&I),extraGroupMarginBottom:Boolean(a&&p),addGroupButton:Boolean(k)}}),[s,t,r,i.collection_group_by,l,o,a])}const zm=function(e){let{store:t,collectionContextStore:o,groupFormat:n}=e;const r=(0,a().v3)(),i=(0,d().K8)((()=>Km(t)),[t]),{value:l}=(0,le().fJ)(ve().T.formulas),{value:s}=(0,le().fJ)(ne().VI.duplicateActions);return(0,E.jsx)(lt().A,{store:t,style:{width:"100%",height:Em().V+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:i?Hm(i,r,t,o,n):void 0,onInsertAbove:i?Wm(i,r,t,o,n):void 0,onSelectableDrop:e=>function(e,t,o,n,r,i,l){const{droppedDirection:a,droppedStores:s,duplicate:c}=e,d=Km(o);if(!d)return;const u=n.subitemTreeStore.state,p=(0,en().Qe)(u.children,(e=>e.value.store===o)),m=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(m,{environment:t,getData:()=>ke().tv({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const g="collectionTypedView"===n.contextType;A().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{hn({environment:t,collectionStore:g?void 0:d,targetStore:o,droppedDirection:a,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:s,duplicate:c,transaction:e,subitemPath:p,collapsedGroup:!1,formulasModule:i,duplicateActions:l})}})}(e,r,t,o,n,l,s),onNativeDrop:e=>function(e,t,o,n,r,i,l){const{files:a,droppedDirection:s}=e,c=Km(r);if(!c)return;const d=o.collectionViewBlockStore(),u=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:t,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),d&&A().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{vn({environment:t,collectionStore:c,targetStore:d,droppedDirection:s,collectionContextStore:o,groupsPointer:n?[n]:[],files:a,transaction:e,formulasModule:i,duplicateActions:l})}})}(e,r,o,n,t,l,s),onRemove:e=>function(e,t){const{transaction:o}=e,n=Km(t);if(!n)return;St().by({childStore:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function Km(e){return e.getAssociatedCollectionStore()}function Hm(e,t,o,n,r){return i=>{const{insertStores:l,transaction:a}=i,s="collectionTypedView"===n.contextType;return(0,Tn().D)({environment:t,collectionStore:s?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:a})}}function Wm(e,t,o,n,r){return i=>{const{insertStores:l,transaction:a}=i,s="collectionTypedView"===n.contextType;return(0,Tn().D)({environment:t,collectionStore:s?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:a})}}function Gm(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:i,disabled:l,format:s}=e;const c=(0,a().v3)(),{value:u}=(0,le().fJ)(ve().T.formulas),[p]=(0,n.useState)((()=>new(ae().Bv)(c,t.pointer))),m=(0,d().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]),g=(0,d().O$)(r.permissionScopesStore),S=(0,d().K8)((()=>r.collectionViewStore()),[r]),h=(0,d().K8)((()=>i&&g.canEditContent&&!g.isSyncedCollection&&c.device.isMobile&&!(null!=S&&S.isSyncedCollection())),[i,S,c,g]),{value:y}=(0,le().fJ)(ne().VI.duplicateActions),v=(0,n.useMemo)((()=>{if(p)return(0,E.jsx)(lt().A,{store:p,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:a,duplicate:s}=e,c=o.collectionStore();if(!c)return;const d=o.groupsStore.getGroupState(t);if(!d)return;const u=o.collectionViewBlockStore(),p=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:n,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),u&&A().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{hn({environment:n,collectionStore:c,targetStore:u,droppedDirection:l,collectionContextStore:o,groupsPointer:d.groupsPointer,droppedStores:a,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})}})}(e,o,r,c,u,y),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:a}=e,s=t.collectionStore();if(!s)return;const c=t.collectionViewBlockStore(),d=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:n,getData:()=>ke().tv({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),c&&A().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{vn({environment:n,collectionStore:s,targetStore:c,droppedDirection:a,collectionContextStore:t,groupsPointer:o?[o]:[],files:l,transaction:e,formulasModule:r,duplicateActions:i})}})}(e,r,o,c,u,y),analyticsName:"timeline",style:{width:"100%"}})}),[p,i,o,r,c,u,y]);return m?(0,E.jsxs)(E.Fragment,{children:[v,(0,E.jsx)(Hn,{collectionContextStore:r,groupsPointer:m.groupsPointer,format:s,canDrag:h,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:f().lQ},canDrop:!0,resultComponent:zm,disabled:l,direction:zn.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:$m})]}):null}const Nm=n.memo(Gm,No().A);function $m(e){return(0,E.jsx)("div",{style:{width:"100%",height:Em().V+1}})}const Um=n.memo((function(e){let{store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:s,onGroupHeaderAddItem:c,format:d,groupsReducerResultStore:u,hiddenGroupsVisibleStore:p,canEditCollectionTimeline:m,showTable:g}=e;const S=(0,n.useMemo)((()=>({type:"dropzone",hiddenGroupsVisibleStore:p})),[p]),h=(0,n.useCallback)((()=>null),[]),f=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,a().Y0)(),u=Dm({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=u(e),o=(0,j().sG)({isMobile:d})-1;let n=0,r=0;return t.groupHeader&&(n+=xo().tp+xo().lH-1),t.tableHeaderRow&&(n+=xo().MR),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=Em().V),t.loadMoreButton&&(r+=qo().LA),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=Ol+El+Dl),t.groupsLoadMoreButton&&(r+=Hl+2*Wl),t.addGroupButton&&(r+=La+Ea+Oa),{paddingTop:n,paddingBottom:r}}),[d,u])}({collectionContextStore:o,isFullScreen:i,disabled:r,format:d,hiddenGroupsVisibleStore:p,showTable:g,canEditCollectionTimeline:m}),y=(0,n.useCallback)((e=>(0,E.jsx)(Nm,{store:t,groupFormat:e,collectionContextStore:o,canEdit:m,format:d,disabled:r&&m})),[o,t,d,r,m]);return d.collection_group_by?(0,E.jsx)(ca,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:s,stickyLeft:!1,renderGroup:y,getGroupStyle:f,renderHeader:h,onGroupHeaderAddItem:c,timelineProps:S,groupsResultStore:u}):(0,E.jsx)("div",{style:f(void 0),children:y(void 0)})}));function qm(e){let{timelineState:t,...o}=e;const{collectionContextStore:n,isFullScreen:r,paddingLeft:i,isInPeekRenderer:l}=o,a=(0,d().O$)(n.isInHomeWidgetStore),s=(0,d().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),c=(0,u().IS)((e=>({outerDiv:{position:"sticky",left:0,width:s,height:xo().tp,zIndex:87},headerStyle:{width:"100%",height:"100%",paddingLeft:r?i:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...a?{}:{background:e.contentBackground,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[r,a,s,i]);return(0,E.jsx)("div",{style:c.outerDiv,children:(0,E.jsx)(dl,{...o,style:c.headerStyle,stickyStyle:c.stickyStyle,preventToggleBackground:l})})}const Xm=new(le().O2)("TimelineItemDateRange",(async()=>await o.e(11922).then(o.bind(o,435621)))),Ym=(0,le()._h)(Xm,(e=>e.TimelineItemDateRange));var Qm=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Qm||{});function Zm(e){let{store:t,type:r,timelineState:i,scrollerLeftOffset:l,paddingLeft:s,format:c,itemPositionStore:p,dateValueStore:m,isDraggingViaTimelineItemStore:g,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y}=e;const v=(0,a().v3)(),x=(0,n.useRef)(Qm.NotDefined),b=(0,n.useRef)(null),C=(0,n.useRef)(null),[w,I]=(0,n.useState)(!1),A="left"===r?o(262400).X:o(420111).O,j=(0,d().O$)(i.outerSizeObserver.rect),R=(0,d().r6)((()=>{const e=p.state;if(e){const{left:t,right:o}=e;if(g.state)return Qm.Hidden;const n=i.scrollLeftStore.state;if(void 0!==n){if("left"===r){const e=n+l;if(e-o>0)return Qm.VisibleOutOfItem;if(e-t>0)return Qm.VisibleInItem}else{const e=n+j.width;if(t-e>0)return Qm.VisibleOutOfItem;if(o-e>0)return Qm.VisibleInItem}return Qm.Hidden}}return Qm.NotDefined}),[g,p,j,l,i,r]),T=(0,u().IS)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:w?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===r&&{marginLeft:8,marginRight:4},..."right"===r&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:f?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===r?l:j.width-220,width:220,height:vo().sH-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===r?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[w,f,j,l,r]);(0,n.useLayoutEffect)((()=>{M()}),[]),(0,n.useEffect)((()=>(R.addListener(M),()=>{R.removeListener(M)})),[]),(0,n.useEffect)((()=>{R.enqueueRecompute()}));const M=(0,n.useCallback)((()=>{const e=b.current,t=C.current;if(e&&t){const o=R.state,n=o===Qm.VisibleInItem||o===Qm.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===Qm.VisibleOutOfItem?"":"none";x.current!==Qm.NotDefined&&o!==Qm.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),x.current=o}}),[R]),_=(0,n.useCallback)((()=>{const e=m.state,o=i.zoomLevelStore.state,{snapUnit:n}=xo().eM[o],l=(0,xo().C1)(o,200);if(e)if("left"===r){const{start:t}=(0,xo().yl)(e,n),r=(0,xo().zb)({timestamp:t.valueOf(),environment:v,timelineState:i,paddingLeft:s,format:c})-l;Pp().k3({timelineState:i,environment:v,zoomLevel:o,centerTimestamp:r})}else{const{end:t}=(0,xo().yl)(e,n),r=(0,xo()._r)({timestamp:t.valueOf(),timelineState:i})+l;Pp().k3({timelineState:i,environment:v,zoomLevel:o,centerTimestamp:r})}I(!1),k().Lt({environment:v,store:t}),(0,Bp().iT)(v,{...(0,Bp().ZR)({environment:v,collectionContextStore:S,timelineState:i,isFullScreen:h,isRootChild:y}),type:r})}),[S,m,v,c,h,y,s,t,i,r]),P=(0,n.useCallback)((()=>{v.device.isPhone||He().A.state||I(!0)}),[v]),B=(0,n.useCallback)((()=>{v.device.isPhone||I(!1)}),[v]);return(0,E.jsxs)("div",{style:T.wrap,onMouseOver:P,onMouseOut:B,onMouseDown:Te().tr,onClick:_,ref:C,children:[(0,E.jsx)("div",{style:T.arrow,ref:b,children:A(T.icon)}),w&&(0,E.jsx)(eg,{dateValueStore:m,timelineState:i,isInPeekRenderer:f})]})}const Jm=n.memo(Zm,No().A);function eg(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:n}=e;const r=(0,u().IS)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:n?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[n]),i=(0,d().O$)(t),l=(0,d().O$)(o.zoomLevelStore);return i?(0,E.jsx)("span",{style:r.dateRange,children:(0,xo().tX)(i,l)}):null}class tg extends p().default{getInitialState(){return null}}function og(e){let{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:l,format:s,query:c,schema:p,blockPropertyValueOverlayStore:m,disabled:g,showProperties:S,collectionContextStore:h,isFullScreen:f,isRootChild:y,toggleButton:v,groupFormat:x,subitemPath:b,isInPeekRenderer:C,handleOpenPeekPage:k}=e;const I=(0,a().v3)(),{value:j}=(0,le().fJ)(ve().T.formulas),R=(0,n.useRef)(null),[T]=(0,n.useState)((()=>t.clone())),_=(0,n.useRef)(null),P=(0,d().K8)((()=>{const e=o.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&!e.newTimelineItemProps&&(0,Mo().Mn)(e.groupFormat,x))return e.date}),[x,t,o]),B=(0,d().r6)((()=>{const e=o.dragStateStore.state;if(P)return P;if(e){const o=e.stores.indexOf(t);if(o>=0)return e.temporaryValues[o]}return ng(t,c,p,I,j)}),[I,P,c,p,t,o,j],{useDeepEqual:!0}),V=(0,d().O$)(B),F=(0,d().K8)((()=>{const e=(0,en().dC)(b);if(!e||Boolean(V))return;const t=e.value.store,o=Op.findCollectionTimelineViewItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[V,b]),L=(0,d().r6)((()=>(0,xo().BD)({timelineState:o,dateValue:V,placeholderDate:P,subitemPlaceholderDate:F})),[V,P,F,o]),O=(0,d().uB)(void 0,tg);(0,wu().b)(Op,(()=>({getNode:()=>R.current,props:{store:t,groupFormat:x,schema:p},stores:{nodeStore:O},dateValueStore:B,itemPositionStore:L})),[t,R,B,x,p,L,O]);const D=(0,d().O$)(L),z=(0,d().K8)((()=>{var e;return null===(e=h.groupsStore.getGroupState(x))||void 0===e?void 0:e.reducerResultStore}),[x,h]),K=(0,fe().Zp)(),H=Boolean(D&&!D.isPlaceholder&&!(null!=K&&K.disableAllPointerEvents)),W=(0,d().r6)((()=>{const e=o.dragStateStore.state,n=nn().Ay.state;return Boolean(e&&e.stores.includes(t)&&n.isDragging&&n.draggedStores.includes(t))}),[t,o]);(0,d().O$)(W);const G=(0,d().K8)((()=>t.getAssociatedCollectionStore()),[t]),N=(0,n.useCallback)((e=>{const n=o.dateRangePlaceholderStore.state,r=h.groupsStore.getGroupState(x);if(r)if(n.active){const{date:e}=n;A().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:I,canUndo:!0,perform:o=>{Pp().Xt({environment:I,store:t,query:c,schema:p,date:e,transaction:o})}}),o.dateRangePlaceholderStore.setState({active:!1})}else{const{horizontalScroller:n}=o,i=o.scrollLeftStore.state,l=L.state,a=_.current;if(!n||void 0===i||!l||!a)return;const s=n.getBoundingClientRect(),c=i+(e.clientX-s.left),d=_.current;if(!d)return;const u=d.lastElementChild;if(!u)return;const p=i+(u.getBoundingClientRect().right-s.left);c>l.right&&c<=p&&(0,Te().SQ)({event:e,context:Te().y$.EditorClick,callback:()=>{(0,_e().Zm)()||Ko().VU({environment:I,store:t,openInNew:Re().Vr(e),peekMode:(0,M().hH)(h),resultsStore:r.resultsStore,collectionContextStore:h,pageVisitSource:To().y8.PeekOpen})}})}}),[h,I,x,L,c,p,t,o]),$=(0,n.useCallback)((()=>{o.dateRangePlaceholderStore.setState({active:!1})}),[o]),U=(0,n.useCallback)((e=>{const{target:t}=e;!I.device.isMobile&&t instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),w().jD({environment:I,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[I]),q=(0,n.useCallback)((e=>{const n=o.dragStateStore.state,i=o.drawStateStore.state,{horizontalScroller:l}=o,a=o.scrollLeftStore.state,s=o.zoomLevelStore.state,d=o.currentRangeStore.state,{snapUnit:u,getDateRangePlaceholderDuration:m}=xo().eM[s];if(!i&&He().A.state||n||ng(t,c,p,I,j)||!l||void 0===a||g)return;const S=l.getBoundingClientRect(),h=a+(e.clientX-S.left),f=(0,xo().C1)(s,h),y=r().c9.fromMillis(d.startTimestamp+f),v=(0,xo().DY)(y,u),b=(0,xo().DY)(m(y),u),C=(0,Ys().p6)(v.valueOf(),(0,Qo().P)()),w=(0,xo().oJ)({startValue:C,snapUnit:u,desiredStart:v,desiredEnd:b});o.dateRangePlaceholderStore.setState({active:!0,store:t,parentStore:G,groupFormat:x,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:c,schema:p}})}),[I,o,t,x,g,c,p,G,j]),X=(0,n.useCallback)((e=>{O.setState(e)}),[O]),Y=(0,u().IS)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:86},dateRange:{display:"flex",height:Em().V+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!z)return null;const Q=Boolean(D);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("div",{ref:R,style:Y.scrollArrows,children:[H&&(0,E.jsx)(Jm,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:L,dateValueStore:B,paddingLeft:l,format:s,isDraggingViaTimelineItemStore:W,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:C,isRootChild:y}),H&&(0,E.jsx)(Jm,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:L,dateValueStore:B,paddingLeft:l,format:s,isDraggingViaTimelineItemStore:W,collectionContextStore:h,isInPeekRenderer:C,isFullScreen:f,isRootChild:y})]}),(0,E.jsx)("div",{style:Y.dateRange,onMouseDown:U,onMouseMove:q,onMouseLeave:$,onClick:N,className:we().ZLF,ref:X,children:Q&&(0,E.jsx)(Ym,{store:t,parentStore:G,toggleButton:v,clonedStore:T,itemPositionStore:L,dateValueStore:B,query:c,schema:p,timelineState:o,blockPropertyValueOverlayStore:m,disabled:g,showProperties:S,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:W,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:C,isRootChild:y,intl:xt().A.getIntl(),propertiesWrapElementRef:_,resultStore:z,handleOpenPeekPage:k})})]})}function ng(e,t,o,n,r){return(0,xo().GM)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:xt().A.getIntl(),formulasModule:r})}function rg(e){const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:l,query:s,schema:c,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,collectionContextStore:S,isFullScreen:h,isRootChild:f,toggleButton:y,groupFormat:v,canEditTimelineItems:x,subitemPath:b,paddingLeft:C,showTable:k}=e,I=(0,a().v3)(),{isMobile:R}=(0,a().Y0)(),[T,M]=(0,n.useState)(),_=(0,u().IS)((()=>({container:{display:"flex",height:(0,j().sG)({isMobile:R})+1,width:"100%",cursor:"default",isolation:"auto"}})),[R]);(0,n.useEffect)((()=>{M(null==t?void 0:t.clone())}),[t]);const P=(0,d().K8)((()=>{var e;return null===(e=S.groupsStore.getGroupState(v))||void 0===e?void 0:e.reducerResultStore}),[S.groupsStore,v]),B=(0,d().K8)((()=>{const e=i.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===o&&(0,Mo().Mn)(e.groupFormat,v))return e.date}),[v,o,t,i.dateRangePlaceholderStore]),V=(0,d().K8)((()=>B),[B],{useDeepEqual:!0}),F=(0,d().K8)((()=>(0,xo().BD)({timelineState:i,dateValue:V,placeholderDate:B,subitemPlaceholderDate:void 0})),[V,B,i]),L=(0,d().K8)((()=>Boolean(F)),[F]),O=(0,d().K8)((()=>!S.isInHomeWidgetStore.state&&!t&&!L&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[S,L,t]),D=(0,d().K8)((()=>S.isInPeekRendererStore.state),[S.isInPeekRendererStore]),z=(0,n.useMemo)((()=>new(lm().default)((()=>F),{debugName:"itemPositionStore"})),[F]),K=(0,n.useMemo)((()=>new(lm().default)((()=>V),{debugName:"dateValueStore"})),[V]),H=(0,n.useMemo)((()=>new(lm().default)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return P?(0,E.jsxs)("div",{style:_.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),w().jD({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,I),onMouseMove:e=>function(e,t,o,n,i,l,a,s,c,d,u,p){var m;const g=t.drawStateStore.state,S=t.dragStateStore.state,{horizontalScroller:h}=t,f=t.scrollLeftStore.state,y=t.zoomLevelStore.state,v=t.currentRangeStore.state,{snapUnit:x,getDateRangePlaceholderDuration:b}=xo().eM[y];if(!g&&He().A.state||S||!h||void 0===f||i)return;const C=null===(m=d.groupsStore.getGroupState(n))||void 0===m?void 0:m.resultsStore;if(!C)return;const w=h.getBoundingClientRect(),k=f+(e.clientX-w.left),I=(0,xo().C1)(y,k),A=r().c9.fromMillis(v.startTimestamp+I),j=(0,xo().DY)(A,x),R=(0,xo().DY)(b(A),x),T=(0,Ys().p6)(j.valueOf(),(0,Qo().P)()),M=(0,xo().oJ)({startValue:T,snapUnit:x,desiredStart:j,desiredEnd:R});t.dateRangePlaceholderStore.setState({active:!0,store:o,parentStore:u,groupFormat:n,date:M,newTimelineItemProps:{query:l,schema:a,resultsStore:C,isFullScreen:s,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,i,t,v,m,s,c,h,x,S,o,b),onMouseLeave:()=>function(e){e.dateRangePlaceholderStore.setState({active:!1})}(i),onClick:e=>function(e,t,o,n,r,i,l,a,s,c,d,u){const p=r.dateRangePlaceholderStore.state;if(p.active){const{date:e}=p,m=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,Xe().EF)(t))return void(0,Xe().QY)(t);A().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,canUndo:!0,perform:r=>{const p=Pp().dO({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:a,collectionContextStore:s,subitemPath:u,from:m});An().v(t,{from:m,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,ke().sl)(s)})}}),r.dateRangePlaceholderStore.setState({active:!1})}}(0,I,s,c,i,h,v,x,S,t,o,b),className:we().ZLF,children:[L&&(0,E.jsx)(Ym,{store:o?void 0:t,parentStore:o,toggleButton:y,clonedStore:T,itemPositionStore:z,dateValueStore:K,query:s,schema:c,timelineState:i,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,scrollerLeftOffset:l,isDraggingViaTimelineItemStore:H,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:D,isRootChild:f,intl:xt().A.getIntl(),resultStore:P,handleOpenPeekPage:lg}),O&&(0,E.jsx)(dg,{parentStore:o,collectionContextStore:S,paddingLeft:C,isFullScreen:h,showTable:k})]}):null}const ig=n.memo(rg);function lg(){}function ag(e){let{isMobile:t}=e;return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:(0,j().sG)({isMobile:t}),lineHeight:Ro().K_.UIRegular.desktop}}function sg(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function cg(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function dg(e){let{parentStore:t,collectionContextStore:o,paddingLeft:n,isFullScreen:r,showTable:i}=e;const{isMobile:l}=(0,a().Y0)(),s=(0,u().DP)(),c=(0,d().O$)(o.currentSubitemFormatStoreForUiDisplayStore),p=(0,d().K8)((()=>{var e;return c&&t?null===(e=t.getSchema()[c.property])||void 0===e?void 0:e.name:""}),[c,t]);return(0,E.jsx)("div",{style:sg(n,r,i),children:(0,E.jsxs)("div",{style:ag({isMobile:l}),children:[(0,Gt().W)(cg(s)),(0,E.jsx)("span",{style:{color:s.text.secondary},children:t&&p?(0,E.jsx)(pt().sA,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:p}}):(0,E.jsx)(pt().sA,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function ug(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:a,schema:s,collectionContextStore:c,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:m,groupFormat:g,paddingLeft:S,showTimelineProperties:h,scrollerLeftOffset:f,showTable:y,canEditTimelineItems:v,isInPeekRenderer:x,isReady:b,canEdit:C}=e,w=(0,d().K8)((()=>c.groupsStore.getGroupState(g)),[c,g]),k=(0,d().O$)(c.permissionScopesStore),I=(0,d().K8)((()=>"collectionTypedView"===c.contextType),[c]);return(0,d().O$)(c.isInHomeWidgetStore)||!w||!b||!C&&!I||k.isSyncedCollection?null:(0,E.jsx)(ig,{store:t,disabled:i||!k.canEditContent&&!I,timelineState:r,schema:s,query:l,format:a,scrollerLeftOffset:f,paddingLeft:S,showProperties:h,blockPropertyValueOverlayStore:u,collectionContextStore:c,isFullScreen:p,showTable:y,isRootChild:m,groupFormat:g,canEditTimelineItems:v,isInPeekRenderer:x,parentStore:o,subitemPath:n})}const pg=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:s,isFullScreen:c,paddingLeft:u,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,isRootChild:S,isReady:h,canEdit:y,disabled:v,scrollerLeftOffset:x}=e,b=(0,a().v3)(),C=(0,d().K8)((()=>{if(!r.timeline_by)return null;const e=t.groupsStore.getGroupState(n);if(!e)return null;const l=e.currentLimit.state,a=f().oE([n&&(0,Yo().K8)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,Qo().P)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:a.length>0?{operator:"and",filters:a}:void 0,limit:l}}),[t,o,n,r,i]),w=(0,d().K8)((()=>t.groupsStore.getGroupState(n)),[t,n]),k=n?[n]:[],I=(0,d().K8)((()=>null==w?void 0:w.reducerResultStore.state),[null==w?void 0:w.reducerResultStore]),A=(0,d().K8)((()=>M().XQ({collectionContextStore:t,reducerResult:I,isFullScreen:c})),[t,I,c]),j=(0,d().K8)((()=>M().Cn({query:r,schema:o})),[r,o]),R=(0,d().K8)((()=>(s.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))),[s]);return w?(0,E.jsxs)(E.Fragment,{children:[C&&(0,E.jsx)(bn().A,{id:k.length>0?`results:${(0,Mo().Hm)(k)}`:"timeline_results",reducer:C,groupsPointer:k,collectionContextStore:t,resultStore:w.reducerResultStore}),(0,E.jsx)(gg,{groupFormat:n,format:s,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,showTimelineProperties:R,paddingLeft:u,isFullScreen:c,isRootChild:S,isReady:h,canEdit:y,canEditTimelineItems:j,disabled:v,showTable:i,scrollerLeftOffset:x}),A&&(0,E.jsx)("div",{style:{width:"100%"},children:i?(0,E.jsx)("div",{style:{height:qo().LA}}):(0,E.jsx)(qo().jJ,{style:{position:"sticky",left:c?u:3,width:"max-content",height:qo().LA},groupsPointer:k,store:l,collectionContextStore:t,format:s,isFullScreen:c,incrementLimitsInRelatedGroups:!1})}),(0,E.jsx)(ug,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>mg(t,n,b),canEditTimelineItems:j,showTimelineProperties:R})]}):null};function mg(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;Ve().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();C().Ey({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||_n().C9.timeline;jn().bn(o,{is_peek:!0,from:"timeline",peek_mode:l})}function gg(e){const t=(0,a().v3)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:s,blockPropertyValueOverlayStore:c,isFullScreen:u,isRootChild:p,showTable:m,canEditTimelineItems:g,scrollerLeftOffset:S,timelineState:h,paddingLeft:f,showTimelineProperties:y,isInPeekRenderer:v}=e,x=(0,d().K8)((()=>{const e=r.permissionScopesStore.state;return{disabled:i||!("collectionTypedView"===r.contextType||e.canEditContent),timelineState:h,schema:s,query:l,format:n,scrollerLeftOffset:S,paddingLeft:f,showProperties:y,blockPropertyValueOverlayStore:c,collectionContextStore:r,isFullScreen:u,showTable:m,isRootChild:p,groupFormat:o,canEditTimelineItems:g,isInPeekRenderer:v,handleOpenPeekPage:()=>mg(r,o,t),isLast:!1}}),[r,o,n,t,i,l,s,c,u,p,m,g,S,h,f,y,v]),b=(0,d().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]);return b?(0,E.jsx)(Hn,{disableSelectable:!0,collectionContextStore:r,groupsPointer:b.groupsPointer,format:n,canDrag:!1,disableRequest:!0,resultProps:x,canDrop:!1,resultComponent:og,disabled:!0,direction:zn.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,E.jsx)(ug,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>mg(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e)}):null}const Sg=n.memo((function(e){let{store:t,collectionContextStore:o,timelineState:r,disabled:i,isFullScreen:l,isInPeekRenderer:s,paddingLeft:c,isRootChild:p,format:m,schema:g,query:S,showTable:h,groupsReducerResultStore:f,hiddenGroupsVisibleStore:y,canEditCollectionTimeline:v,isReady:x,blockPropertyValueOverlayStore:b,tableStore:C,scrollerLeftOffset:w,onGroupHeaderAddItem:k}=e;const I=(0,n.useMemo)((()=>({type:"item",hiddenGroupsVisibleStore:y})),[y]),A=(0,n.useCallback)((e=>{if(!h)return(0,E.jsx)(qm,{timelineState:r,...e})}),[h,r]),R=(0,d().K8)((()=>(0,j().Ty)(m,C)),[m,C]),T=(0,n.useCallback)((e=>(0,E.jsx)(pg,{store:t,groupFormat:e,schema:g,query:S,isInPeekRenderer:s,timelineState:r,collectionContextStore:o,blockPropertyValueOverlayStore:b,paddingLeft:c,format:R,isFullScreen:l,isRootChild:p,isReady:x,canEdit:v,disabled:i,showTable:h,scrollerLeftOffset:w})),[b,v,o,R,i,l,s,x,p,c,S,g,w,h,t,r]),M=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,a().Y0)(),p=(0,u().DP)(),m=Dm({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{const t=m(e),o=(0,j().sG)({isMobile:d});let n=0,r=0;return t.groupHeader&&s&&(n+=xo().tp+xo().lH),t.tableHeaderRow&&(n+=xo().MR-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&s&&(r+=Ol+El+Dl),t.groupsLoadMoreButton&&s&&(r+=Hl+2*Wl),t.addGroupButton&&s&&(r+=La+Ea+Oa),{paddingTop:n,paddingBottom:r,minHeight:xo().tp,boxShadow:e.index>0&&(!s||t.tableHeaderRow)?`inset 0 -1px 0 ${p.tableDividerColor}`:void 0}}),[m,d,s,p.tableDividerColor])}({collectionContextStore:o,isFullScreen:l,disabled:i,format:m,hiddenGroupsVisibleStore:y,showTable:h,canEditCollectionTimeline:v});return m.collection_group_by?(0,E.jsx)(sl().l,{children:(0,E.jsx)(ca,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:i,isFullScreen:l,isRootChild:p,paddingLeft:c,stickyLeft:!1,renderGroup:T,getGroupStyle:M,renderHeader:A,onGroupHeaderAddItem:k,timelineProps:I,groupsResultStore:f})}):T()}));const hg=(0,Ao().wt)("doubleChevronLeft",{viewBox:"0 0 16 16",svg:(0,E.jsx)("path",{d:"M7.07031 13.8887C7.2207 14.0391 7.40527 14.1211 7.62402 14.1211C8.06836 14.1211 8.41699 13.7725 8.41699 13.3281C8.41699 13.1094 8.32812 12.9043 8.17773 12.7539L3.37207 8.05762L8.17773 3.375C8.32812 3.21777 8.41699 3.0127 8.41699 2.80078C8.41699 2.35645 8.06836 2.00781 7.62402 2.00781C7.40527 2.00781 7.2207 2.08984 7.07031 2.24023L1.73828 7.44922C1.56055 7.62012 1.46484 7.8252 1.46484 8.06445C1.46484 8.29688 1.55371 8.49512 1.73828 8.67969L7.07031 13.8887ZM13.1748 13.8887C13.3252 14.0391 13.5098 14.1211 13.7354 14.1211C14.1797 14.1211 14.5283 13.7725 14.5283 13.3281C14.5283 13.1094 14.4395 12.9043 14.2891 12.7539L9.4834 8.05762L14.2891 3.375C14.4395 3.21777 14.5283 3.0127 14.5283 2.80078C14.5283 2.35645 14.1797 2.00781 13.7354 2.00781C13.5098 2.00781 13.3252 2.08984 13.1748 2.24023L7.84961 7.44922C7.66504 7.62012 7.57617 7.8252 7.56934 8.06445C7.56934 8.29688 7.66504 8.49512 7.84961 8.67969L13.1748 13.8887Z"})});const fg=function(e){let{isGrouped:t,format:o,collectionContextStore:n,isFullScreen:r,isRootChild:i,timelineState:l}=e;const s=(0,u().DP)(),c=(0,a().v3)(),{device:d}=c;return(0,E.jsx)(jt().A,{render:e=>(0,E.jsx)(dr().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;A().createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,xo().iH)(t,!1);Eo().zA({stores:[l],update:o,transaction:e})}}),(0,Bp().VD)(e,{...(0,Bp().ZR)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(c,o,n,r,i,l),style:{position:"absolute",top:t?d.isIOS?3:4:d.isIOS?7:8,right:t?6:8,zIndex:84,fill:s.lightIconColor},...e,children:hg({width:14})}),renderTooltip:()=>(0,E.jsx)(pt().sA,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function yg(){const e=(0,u().IS)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,E.jsx)("div",{style:e.rowContainer,children:(0,E.jsx)(to().A,{style:e.rowShimmer})})}const vg=function(e){const{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:s,store:c,disabled:u,format:p,schema:m,isInPeekRenderer:g,query:S,paddingBottom:h,tableStore:f,timelineState:y,isRootChild:v,canEdit:x,paddingLeft:b,paddingRight:C}=e,w=(0,a().v3)(),k=(0,L().X)("db_ux_empty_states"),{titleColumnIndex:I,left:A}=(0,d().K8)((()=>{const e=t.state.findIndex((e=>"title"===e.property)),o=t.state.reduce(((e,t)=>t.visible?e+(t.width||0):e),0),n=w.WindowSizeStore.getSafePaddingLeftPx((0,Ce().F8)(w));return{titleColumnIndex:e,left:Math.floor(o/2)+n}}),[w,t]),j=(0,n.useMemo)((()=>o?[o]:[]),[o]),R=(0,d().K8)((()=>i.groupsStore.getGroupState(j)),[i,j]),T=(0,d().K8)((()=>null==R?void 0:R.reducerResultStore.state),[R]),_=(0,d().K8)((()=>(0,M().XQ)({collectionContextStore:i,reducerResult:T,isFullScreen:r})),[i,T,r]),P=(0,d().O$)(i.shouldShowSpinnerStore),B=(0,d().O$)(i.permissionScopesStore),V=(0,d().O$)(t),F=(0,d().O$)(i.isInHomeWidgetStore),O=(0,d().K8)((()=>"collectionTypedView"===i.contextType),[i]),D=s&&0===(null==T?void 0:T.blockIds.length)&&!P,z=(0,d().K8)((()=>{const e=Boolean(!F&&s&&(x||O)&&!B.isSyncedCollection);return k?e&&!D:e}),[F,s,x,O,B.isSyncedCollection,k,D]);return R?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Cg,{store:c,format:p,schema:m,query:S,collectionContextStore:i,disabled:u,paddingBottom:h,isInPeekRenderer:g,blockPropertyValueOverlayStore:l,tableStore:f,showTablePropertyFormats:V,timelineState:y,isFullScreen:r,isRootChild:v,groupFormat:o,isInHomeWidget:F,paddingLeft:b,paddingRight:C}),D&&(0,E.jsx)(Ag,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,canEdit:x,left:A,height:70}),(0,E.jsx)(Pg,{store:c,schema:m,query:S,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:x,format:p,tableStore:f,paddingLeft:b,disabled:u,groupFormat:o,titleColumnIndex:I,groupsPointer:j}),P&&(0,E.jsx)(yg,{}),_&&(0,E.jsx)(Rg,{collectionContextStore:i,format:p,canEdit:x,groupFormat:o,isFullScreen:r,groupsPointer:j}),z&&(0,E.jsx)(jg,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:g}),(0,E.jsx)(Hd,{groupFormat:o,pageCount:(null==T?void 0:T.blockIds.length)??0,style:bg(s,o,r,b),disabled:u||!B.canConfigureBlock,schema:m,query:S,collectionContextStore:i,isInPeekRenderer:g,isFullScreen:r,showPropertyFormats:V,showRightActionsSpacer:!1,paddingLeft:b,paddingRight:C,disableSticky:!0})]}):null};function xg(){}function bg(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:n},...o&&!t&&{left:n}}}function Cg(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,disabled:a,paddingBottom:s,isInPeekRenderer:c,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:m,timelineState:g,isFullScreen:S,isRootChild:h,isInHomeWidget:f,paddingLeft:y,paddingRight:v}=e;const x=(0,d().K8)((()=>l.groupsStore.getGroupState(t)),[l,t]),b=(0,d().O$)(l.permissionScopesStore),C=(0,d().K8)((()=>l.viewIsFlushToTopbar()),[l]);if(!x)return null;const w=Boolean(t);return(0,E.jsx)(op,{store:o,format:n,schema:r,query:i,collectionContextStore:l,isInPeekRenderer:c,minWidth:void 0,paddingBottom:s,blockPropertyValueOverlayStore:u,showPropertyFormats:m,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:a||!b.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,xo().Zk)(w),paddingTop:w?0:xo().jI-xo().MR,disableTopBorder:!C||w,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:f,hasMoreReducerResults:!1,paddingLeft:y,paddingRight:v,children:!w&&b.canConfigureBlock&&(0,E.jsx)(fg,{isGrouped:!1,format:n,collectionContextStore:l,timelineState:g,isFullScreen:S,isRootChild:h})})}function wg(e,t,o){return{display:"flex",alignItems:"center",height:(0,j().sG)({isMobile:o}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function kg(e){return{width:Ao().Ev.sm,height:Ao().Ev.sm,marginRight:6,fill:e.lightIconColor}}function Ig(e,t,o,n,r,i){const{device:l}=e,a=n?[n]:[],s=t.groupsStore.getGroupState(a);if(!(0,Xe().EF)(e)||!s)return;t.searchQueryStore.state&&(0,Jn().S)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;A().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const a=(0,Qn().Q)({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(a){if(l.isMobile){!function(e,t,o){o?o(e):yr().oo({environment:t,url:e})}((0,kr().Ay)({store:a.newStore,fullyQualified:!1,pageVisitSource:To().y8.Create}),e,i)}else if(a.coercionSucceeded){const o=()=>{Rn().ho({environment:e,blockPropertyValueOverlayStore:r,store:a.newStore,property:"title",format:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(a.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);Ko().VU({environment:e,store:a.newStore,peekMode:(0,M().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:To().y8.Create})}An().v(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:a.newStore.id,creating_block_id:a.newStore.id,...(0,ke().sl)(t)})}}})}function Ag(e){const{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,canEdit:l,left:s,height:c}=e,p=(0,L().X)("db_ux_empty_states"),m=(0,a().v3)(),{isMobile:g}=(0,a().Y0)(),S=(0,u().DP)(),h=(0,n.useContext)(ri().n),f=(0,n.useCallback)((()=>Ig(m,t,o,r,i,h)),[m,t,o,r,i,h]),y=(0,d().K8)((()=>{const e=Boolean(t.currentCombinatorFilterStore.state),o=t.currentPropertyFiltersStore.state.length>0;return e||o}),[t]),v=(0,d().K8)((()=>""!==t.searchQueryStore.state),[t]),x=(0,d().K8)((()=>t.groupsStore.getAllGroupStates().length>1),[t.groupsStore]);return p?(0,E.jsx)(Xd,{collectionContextStore:t,groupFormat:r,handleAddRowClick:f,hasSearchQuery:v,hasFilter:y,hasMultipleGroups:x,shouldShowAddRowButton:l,shouldShowLinkButton:!1,left:s,height:c}):(0,E.jsx)(It().A,{onClick:f,onMouseDown:Te().tr,disabled:!l,style:{display:"flex",alignItems:"center",height:(0,j().sG)({isMobile:g}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,background:S.contentBackground,left:0,right:0,borderBottom:`1px solid ${S.tableDividerColor}`},children:l?(0,E.jsx)("span",{style:{color:S.text.tertiary},children:(0,E.jsx)(pt().sA,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,E.jsx)("span",{style:{color:S.text.tertiary},children:(0,E.jsx)(pt().sA,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function jg(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,isInPeekRenderer:l}=e;const s=(0,a().v3)(),c=(0,u().DP)(),d=(0,n.useContext)(ri().n),p=(0,n.useCallback)((()=>Ig(s,t,o,r,i,d)),[s,t,o,r,i,d]);return(0,E.jsxs)(It().A,{onClick:p,style:wg(l,c,s.device.isMobile),className:we().$0P,onMouseDown:Te().tr,children:[(0,tr().plusSmallIcon)(kg(c)),(0,E.jsx)("span",{style:{color:c.text.tertiary},children:(0,E.jsx)(pt().sA,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function Rg(e){let{groupsPointer:t,collectionContextStore:o,format:n,canEdit:r,groupFormat:i,isFullScreen:l}=e;const s=(0,u().DP)(),c=(0,a().v3)(),p=(0,d().K8)((()=>o.groupsStore.getGroupState(t)),[o,t]),m=(0,d().K8)((()=>(0,Yn().Kk)({collectionContextStore:o,groupsPointer:t})),[o,t]);return p?(0,E.jsxs)(It().A,{onMouseDown:Te().tr,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,Te().kV)(e),k().IU({environment:r}),l&&(0,Uo().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,_d().K)(r)}(e,o,i,l,c),disabled:m,hoveredStyle:m?{background:s.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:qo().LA,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,boxShadow:`0 -1px 0 ${s.tableDividerColor}`,borderBottom:`1px solid ${s.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,wn().g)(kg(s)),(0,E.jsx)("span",{style:{color:s.text.tertiary,flexGrow:1},children:(0,E.jsx)(pt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),m?(0,E.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,E.jsx)(ur().A,{size:"sm"})}):r&&(0,E.jsx)(Pd().w,{collectionContextStore:o,format:n})]}):null}function Tg(e){const t=(0,a().v3)(),{isMobile:o}=(0,a().Y0)(),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:s,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u}=e;return r?(0,E.jsx)(Sd,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:s,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{Rn().ho({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",format:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,j().sG)({isMobile:o})+1}}):null}const Mg=[];function _g(e){let{args:t,schema:o,disabled:n,collectionContextStore:r,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:s,format:c,groupFormat:p,titleColumnIndex:m}=e;(0,u().DP)();const g=(0,a().Y0)(),S=(0,d().K8)((()=>r.collectionViewStore()),[r]),{groupsPointer:h}=t,f=(0,d().K8)((()=>r.groupsStore.getGroupState(h)),[r,h]),y=(0,d().O$)(l),v=(0,d().K8)((()=>!s&&g.isMobile&&!(null!=S&&S.isSyncedCollection())),[s,g,S]),x=(0,d().O$)(r.isInHomeWidgetStore),b=(0,d().K8)((()=>{const e=r.collectionViewBlockStore();return!(!e||r.isFullScreenStore.state)&&(0,Bd().d1)(e)}),[r]),C=(0,d().K8)((()=>(0,re().v2)(p,r)),[p,r]),w=(0,d().K8)((()=>r.isUnlistedViewStore.state&&r.isInlineViewStore.state),[r]),k=(0,d().K8)((()=>{const e=Od().A.state;if(e.isActive)return(0,j().yR)(e.selection,y.length,C.length)}),[C,y]),I=Mg,A=y,R=(0,d().K8)((()=>{const e=r.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[r.permissionScopesStore]);if(!S||!f)return null;return(0,E.jsx)(Hn,{collectionContextStore:r,groupsPointer:h,disableRequest:!0,format:c,canDrag:v,resultProps:{schema:o,collectionContextStore:r,propertyFormats:y,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:xg,titleColumnIndex:m,groupFormat:p,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:x,isCollectionViewBlockSelected:b,allRows:C,isInEphemeralView:w,normalizedTableSelection:k,unfrozenIndexAddendum:0,frozenPropertyFormats:I,unfrozenPropertyFormats:A,tableWrap:!1,shouldSetCellHeight:!0,isNonEditable:R,shouldShowRightActionSpacer:!1,hasColumnVirtualizer:!1},resultComponent:mp,canDrop:!1,disabled:n,direction:zn.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:m,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:l,indentLevel:a}=e;return(0,E.jsx)(Tg,{collectionContextStore:r,disabled:n,blockPropertyValueOverlayStore:i,store:t,parentStore:o,subitemPath:l,indentLevel:a,groupsPointer:h})}})}function Pg(e){let{groupFormat:t,groupsPointer:o,store:r,schema:i,query:l,collectionContextStore:a,blockPropertyValueOverlayStore:s,showTablePropertyFormatsStore:c,canEdit:u,format:p,tableStore:m,paddingLeft:g,disabled:S,titleColumnIndex:h}=e;const f=(0,d().K8)((()=>a.collectionViewStore()),[a]),y=(0,d().K8)((()=>a.groupsStore.getGroupState(t)),[a,t]),v=(0,d().O$)(c),x=(0,n.useCallback)((e=>(0,E.jsx)(_g,{schema:i,disabled:S,collectionContextStore:a,blockPropertyValueOverlayStore:s,showTablePropertyFormatsStore:c,canEdit:u,format:p,groupFormat:t,titleColumnIndex:h,args:{...e,groupsPointer:o}})),[i,S,a,s,c,u,p,t,h,o]);return f&&y?(0,E.jsx)(wp,{store:r,collectionContextStore:a,minWidth:void 0,blockPropertyValueOverlayStore:s,showPropertyFormats:v,disabled:!u,disableHorizontalEdgeScroll:!0,groupFormat:t,render:x,tableStore:m,paddingLeft:g}):null}const Bg=n.memo((function(e){let{store:t,tableStore:o,collectionContextStore:r,timelineState:i,format:l,schema:a,query:s,isFullScreen:c,groupBy:p,paddingLeft:m,paddingRight:g,paddingBottom:S,scrollerLeftOffset:h,isInPeekRenderer:f,isInHomeWidget:y,computedOuterHeight:v,showHoverActionsStore:b,blockPropertyValueOverlayStore:C,isRootChild:w,isReady:k,disabled:I,canEditCollectionTimeline:A,viewIsFlushToTopbar:R,groupsReducerResultStore:T,hiddenGroupsVisibleStore:M,onGroupHeaderAddItem:_}=e;const P=(0,L().X)("db_ux_chrome"),B=(0,n.useRef)(null),V=(0,d().r6)((()=>{const e=(0,j().Ty)(l,o);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[l,o],{useDeepEqual:!0});(0,d().O$)(V);const F=(0,d().K8)((()=>V.state.reduce(((e,t)=>e+(t.width||0)),0)),[V]),O=(0,n.useCallback)((()=>{x().R8({collectionSettingsStore:r.settingsStore,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}),[r]),D=(0,u().IS)((e=>({selectable:{whiteSpace:"nowrap",...y?{}:{background:f?e.cardContentBackground:e.contentBackground},paddingLeft:m,boxSizing:"border-box",borderRight:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:F+m,height:y?"100%":v},tableGroupHeaderSticky:{borderRight:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderRight:void 0},tableGroupHeader:{boxShadow:P?void 0:`inset 0 var(--timeline-box-shadow, 1px) 0 ${e.tableDividerColor}`}})),[y,f,m,F,v,P]),z=(0,d().K8)((()=>(0,j().Ty)(l,o)),[l,o]),K=(0,n.useCallback)((e=>(0,E.jsx)(vg,{store:t,groupFormat:e,schema:a,query:s,isInPeekRenderer:f,timelineState:i,collectionContextStore:r,blockPropertyValueOverlayStore:C,showTablePropertyFormatsStore:V,tableStore:o,paddingLeft:m,paddingRight:g,paddingBottom:S,format:z,isFullScreen:c,isRootChild:w,isReady:k,canEdit:A,disabled:I&&A})),[C,A,r,I,z,c,f,k,w,S,m,g,s,a,V,t,o,i]),H=(0,n.useCallback)((e=>{const t=r.permissionScopesStore.state;return(0,E.jsx)(dl,{...e,height:xo().tp,paddingTop:xo().lH,stickyStyle:D.tableGroupHeaderSticky,transitionStickyStyle:D.tableGroupHeaderTransition,style:0!==e.index||R?D.tableGroupHeader:{},stickyWrapStyle:{marginBottom:xo().lH},children:0===e.index&&t.canConfigureBlock&&(0,E.jsx)(fg,{isGrouped:!0,format:l,collectionContextStore:r,timelineState:i,isFullScreen:c,isRootChild:w})})}),[r,l,c,w,D.tableGroupHeader,D.tableGroupHeaderSticky,D.tableGroupHeaderTransition,i,R]),W=(0,n.useCallback)((()=>({})),[]),G=(0,n.useCallback)((()=>(0,E.jsx)(ca,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:I,isFullScreen:c,isRootChild:w,paddingLeft:m,stickyLeft:!1,renderGroup:K,getGroupStyle:W,renderHeader:H,onGroupHeaderAddItem:_,timelineProps:{type:"table",hiddenGroupsVisibleStore:M},groupsResultStore:T,onClickEmptyStateButton:O})),[r,I,W,T,O,M,c,w,_,m,H,K,t]);return(0,E.jsx)("div",{style:{position:"sticky",left:0,height:0,width:F,zIndex:3},children:(0,E.jsx)(lt().A,{style:D.selectable,store:t,shouldShowHalo:!1,canSelect:!c,analyticsName:"timeline",children:(0,E.jsx)(Ml().q,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:h,children:p?G():(0,E.jsx)(Pl,{nodeRef:B,children:(0,E.jsx)("div",{ref:B,children:K(void 0)})})})})})})),Vg=n.memo(n.forwardRef((function(e,t){let{store:r,collectionContextStore:i,query:l,schema:p,format:m,paddingLeft:g,paddingRight:S,isFullScreen:h,isPreviewing:f,isRootChild:y,disabled:v,isInPeekRenderer:x,paddingBottom:b,showHoverActionsStore:C,blockPropertyValueOverlayStore:w}=e;const k=function(e){let{isFullScreen:t,isRootChild:o}=e;const[r]=(0,n.useState)((()=>(0,xo().o8)({isFullScreen:t,isRootChild:o})));return r}({isFullScreen:h,isRootChild:y}),I=(0,a().v3)(),j=(0,a().Y0)();(0,s().l)((()=>{const e=i.collectionViewStore();e&&Pp().n_({timelineState:k,environment:I,collectionViewStore:e,collectionContextStore:i}),(0,Bp().iH)(I,(0,Bp().ZR)({environment:I,collectionContextStore:i,timelineState:k,isFullScreen:h,isRootChild:y}))})),function(e){let{collectionContextStore:t,query:o,schema:r,environment:i}=e;(0,n.useEffect)((()=>{const e=t.collectionStore();if(e&&!o.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;const l=(0,pt().YK)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});A().createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:i,canUndo:!0,perform:t=>{let a,s=M().HG(r);if(!s&&e.canConfigureCollection){s=(0,Po().Ay)();a={[s]:{name:xt().A.formatMessage(l.date),type:"date"}}}s&&((0,Ai().f)({collectionViewStore:n,update:{timeline_by:s},transaction:t}),Do().zv({store:n,data:{type:"timeline"},transaction:t}),a&&(0,Ho().F)({environment:i,collectionStore:o,update:a,transaction:t}))}})}}),[o,t,r,i])}({collectionContextStore:i,query:l,schema:p,environment:I}),function(e){(0,n.useEffect)((()=>{const t=()=>{He().A.state&&e.hoveredItemStore.setState(void 0)};return He().A.addListener(t),()=>{He().A.removeListener(t)}}),[e])}(k),function(e){let{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:l}=e;(0,n.useEffect)((()=>{const e=r.drawStateStore.state;if(null!=e&&e.tryToCompleteDrawnArrow){(0,xo().tH)(o)&&A().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:t,canUndo:!0,perform:e=>{Pp().sd({timelineState:r,environment:t,transaction:e,collectionContextStore:o,isFullScreen:i,isRootChild:l})}})}}))}({environment:I,collectionContextStore:i,timelineState:k,isFullScreen:h,isRootChild:y}),(0,c().X)((()=>{k.destroyed=!0,k.outerSizeObserver.destroy(),k.timelineSizeObserver.destroy(),k.horizontalScroller&&(k.horizontalScroller.scrollLeft=0,(0,Re().Ol)(k.horizontalScroller,"scroll",V))}));const R=(0,d().uB)(void 0,Ad),T=(0,d().uB)(void 0,Vp),_=(0,d().uB)(void 0,bs),P=(0,n.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=k;if(!e)return;const o=k.zoomLevelStore.state,{startTimestamp:n,endTimestamp:r}=k.currentRangeStore.state,i=e.scrollLeft,l=t.rect.state.width,a=(0,xo().w0)(o,r-n),s=(0,xo().o$)(k);if(i<xo().XK){const e=-(0,xo().C1)(o,xo().E6);k.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),Pp().k3({timelineState:k,environment:I,zoomLevel:o,centerTimestamp:s})}else if(i+l>a-xo().XK){const e=(0,xo().C1)(o,xo().E6);k.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),Pp().k3({timelineState:k,environment:I,zoomLevel:o,centerTimestamp:s})}}),[k,I]),B=(0,hr().U)(P,200),V=(0,n.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=k;if(!e)return;const o=e.scrollLeft,n=k.scrollLeftStore.state;I.device.isIOS&&void 0!==n&&0===o&&n>xo().XK?e.scrollLeft=n:(t&&t(),k.scrollLeftStore.setState(o),(0,xo().nS)(I)?B():P())}),[k,I,B,P]),L=(0,n.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=k.currentRangeStore.state;Pp().bu({timelineState:k,centerTimestamp:(e+t)/2})}),[k]),O=(0,n.useRef)(null),D=(0,n.useCallback)((e=>{if(e){O.current=e;const{outerSizeObserver:t}=k;t.observe(e);const o=(0,F().T8)(e);o&&(k.horizontalScroller=o,(0,Re().P4)(o,"scroll",V),L())}}),[V,L,k]),z=(0,d().K8)((()=>i.viewIsFlushToTopbar()),[i]),K=(0,n.useRef)(null),H=(0,d().K8)((()=>{const e=k.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=k.currentRangeStore.state;return(0,xo().w0)(e,o-t)}),[k]),W=(0,d().K8)((()=>!f&&(0,xo().Od)({environment:I,isRootChild:y,isFullScreen:h,format:m})?xo().HV:g),[f,y,h,m,g,I]),G=(0,d().K8)((()=>(0,xo().Ho)({environment:I,paddingLeft:W,format:m,isFullScreen:h,isRootChild:y})),[I,m,h,y,W]);(0,wu().b)(o(691412).A,(()=>({getNode:()=>K.current,customizeEdgeScrollRect(e){const t=G;return Zs().z8.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[G]),(0,n.useImperativeHandle)(t,(()=>({addBlockToView(e){let{store:t,transaction:o}=e;const n=t.getAssociatedCollectionStore()??i.collectionStore();if(n)return Pp().$N({environment:I,store:t,timelineState:k,query:l,collectionStore:n,collectionContextStore:i,groupFormat:void 0,transaction:o})}})));const N=(0,d().K8)((()=>(0,xo().iw)({environment:I,format:m,isFullScreen:h,isRootChild:y})),[I,m,h,y]),$=(0,d().K8)((()=>i.groupsStore.anyGroupHasResults()),[i]),U=(0,d().O$)(i.isInHomeWidgetStore),q=(0,d().K8)((()=>Boolean(i.viewsModuleContextStore.getViewModuleType())),[i]),X=(0,fe().Zp)(),Y=(0,d().K8)((()=>M().mM(i,h)),[i,h]),Q=(0,d().K8)((()=>{const{timelineSizeObserver:e}=k;return(e.rect.state.height||120)+b+(h?0:72)+(!h&&N?28:0)+(h&&j.isMobile?72:0)}),[k,b,h,N,j.isMobile]),Z=function(e,t){const o=(0,Be().bx)(e,!1);return(0,d().K8)((()=>{const e=t.permissionScopesStore.state;return o&&e.canEditContent&&!e.isSyncedCollection}),[o,t])}(r,i),J=(0,n.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=k;t.observe(e)}}),[k]),ee=(0,n.useCallback)(((e,t,o)=>{if(I.device.isMobile)zo().uK({environment:I,store:e,pageVisitSource:To().y8.Create});else{const{groupFormat:t}=o,n=t?[t]:[],r=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;Ko().VU({environment:I,store:e,peekMode:M().hH(i),showMoveTo:l,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:i,pageVisitSource:To().y8.Create})}}),[I,i]),te=(0,n.useCallback)((e=>{const t=i.isLoadingStore.state,o=i.groupsStore.getGroupState([]);if(!o)return;const n=o.reducerResultStore.state;e<ze().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,Uo().H)({collectionContextStore:i,environment:I,incrementLimitArgs:{isFullScreen:h,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[i,I,h]),oe=(0,u().IS)((e=>({container:{position:"relative",float:"left",minWidth:"100%",width:H,...U?{}:{background:x?e.peekTimelineBackground:e.timelineBackground},...!h&&!N&&!U&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!$||U)&&{minHeight:150},...h&&{paddingBottom:b},height:U?"100%":Q}})),[Q,h,U,x,$,b,H,N]),{timeline_by:ne}=l;if(!ne)return(0,E.jsx)(Mm,{collectionContextStore:i,isFullScreen:h,paddingBottom:b});const re=p[ne];return re&&Wo().$L(re)?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{ref:D}),!z&&!f&&(0,E.jsx)("div",{style:{height:4}}),(0,ei().A)((e=>(0,E.jsx)(Pl,{nodeRef:K,width:H,clipLeftExtra:G||(h?0:W),children:(0,E.jsx)("div",{style:oe.container,className:we().dBr,ref:K,...e,children:(0,E.jsxs)(lt().A,{store:r,analyticsName:"timeline",shouldShowHalo:!h&&!U&&!f,canSelect:!h&&!q,disablePointerEvents:null==X?void 0:X.disableAllPointerEvents,style:U?{height:"100%"}:{},children:[(0,E.jsx)(Pm,{timelineState:k}),(0,E.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:xo().jI},ref:J,children:[(0,E.jsx)(Sg,{store:r,schema:p,query:l,showTable:N,collectionContextStore:i,timelineState:k,disabled:v,isFullScreen:h,isRootChild:y,isInPeekRenderer:x,paddingLeft:W,groupsReducerResultStore:_,hiddenGroupsVisibleStore:T,format:m,canEditCollectionTimeline:Z,isReady:$,blockPropertyValueOverlayStore:w,tableStore:R,scrollerLeftOffset:G,onGroupHeaderAddItem:ee}),(0,E.jsx)(Qp,{timelineState:k,disabled:v,isReady:$,renderEmitter:i.renderEmitter,isFullScreen:h,isRootChild:y})]}),(0,E.jsx)(fm,{isInPeekRenderer:x,timelineState:k,query:l,schema:p,scrollerLeftOffset:G,collectionContextStore:i,showTable:N}),!(null!=X&&X.disableAllPointerEvents)&&(0,E.jsx)(rm,{timelineState:k,isInPeekRenderer:x,paddingLeft:W,paddingRight:!h&&y?8:S,format:m,scrollerLeftOffset:G,isFullScreen:h,isRootChild:y,showTable:N,collectionContextStore:i,isReady:$}),N&&(0,E.jsx)(Bg,{store:r,collectionContextStore:i,groupBy:m.collection_group_by,paddingLeft:W,disabled:v,isFullScreen:h,isRootChild:y,format:m,schema:p,query:l,tableStore:R,scrollerLeftOffset:G,isInPeekRenderer:x,paddingRight:S,paddingBottom:b,isInHomeWidget:U,computedOuterHeight:Q,timelineState:k,showHoverActionsStore:C,blockPropertyValueOverlayStore:w,viewIsFlushToTopbar:z,isReady:$,canEditCollectionTimeline:Z,groupsReducerResultStore:_,hiddenGroupsVisibleStore:T,onGroupHeaderAddItem:ee}),(0,E.jsx)("div",{style:{paddingTop:xo().jI,pointerEvents:"none"},children:(0,E.jsx)(Um,{store:r,collectionContextStore:i,disabled:v,isFullScreen:h,paddingLeft:W,isRootChild:y,format:m,groupsReducerResultStore:_,hiddenGroupsVisibleStore:T,canEditCollectionTimeline:Z,onGroupHeaderAddItem:ee,showTable:N})}),!Y&&(0,E.jsx)(Xn().A,{onChange:te})]})})})))]}):(0,E.jsx)(Mm,{collectionContextStore:i,isFullScreen:h,paddingBottom:b})})));const Fg=new(le().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(28721),o.e(55717),o.e(88372),o.e(22)]).then(o.bind(o,6096)))),Lg=(0,le()._h)(Fg,(e=>e.CollectionChartView)),Og=new(le().O2)("CollectionFormEditorView",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(36209),o.e(92845),o.e(71718),o.e(63077),o.e(90966),o.e(28271),o.e(17254),o.e(72883),o.e(40186),o.e(61660),o.e(23133)]).then(o.bind(o,703636)))),Eg=(0,le()._h)(Og,(e=>e.CollectionFormEditorView));const Dg={CollectionMapView:new(le().O2)("CollectionMapView",(async()=>await Promise.all([o.e(83700),o.e(16443),o.e(36209),o.e(92845),o.e(71718),o.e(90625),o.e(71104),o.e(5910),o.e(51680)]).then(o.bind(o,583066))))},zg=(0,le()._h)(Dg.CollectionMapView,(e=>e.CollectionMapView)),Kg=n.memo((function(e){let{store:t,collectionViewStore:r,isDisabled:i,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,isRootChild:u,paddingLeft:p,paddingRight:m,paddingBottom:g,headerSizeObserver:S,viewType:h,timelineViewRef:f,showHoverActionsStore:y,isInFrameWhenSidePeekOpen:v,query:x,schema:b,format:C,maxHeight:w,placementStore:k,templatePickerMenuListStore:I,editorContentContainerRef:A}=e;const j=(0,ee().ET)(),[R,T]=(0,d().K8)((()=>["collectionSystemView"===j.contextType,j.isInHomeWidgetStore.state]),[j]),M=!(0,Be().bx)(t,R||i),_=(0,d().K8)((()=>oo({store:t,collectionViewStore:r,collectionContextStore:j})),[t,r,j]),P=!(0,Be().bx)(_,R);(0,n.useEffect)((()=>{"rendered"!==bt().default.state.renderPhase&&bt().default.setState({...bt().default.state,renderPhase:"rendered"})}),[]);const V=function(e){let{isFullScreen:t,viewType:o,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:s,store:c}=e;const u=(0,a().v3)();return(0,d().K8)((()=>{const{device:e}=u,a=e.isPhone,d=("gallery"===o||("calendar"===o||"list"===o)&&t)&&n,p=(0,Oe().zo)(u,i),m=O().default.state;return r||l?void 0:t||s?a?`calc(100% - ${2*(0,Ce().F8)(u)}px - ${p}px)`:i?`calc(100% - ${2*O().PeekModePadding.horizontal[m.mode]}px - ${p}px)`:n?(0,Oe().Uh)(u)+(d?(0,Oe().Ql)(u):0):t?`calc(100% - ${2*(0,Ce().Ws)(u)}px - ${p}px)`:(0,B().Ck)(c,void 0,u)?`calc(100% - ${2*(0,Ce().F8)(u)}px - ${p}px)`:B().x6-2*(0,Ce().F8)(u)-p:`calc(100% - ${p}px)`}),[u,o,t,n,i,r,l,s,c])}({isFullScreen:l,viewType:h,isInFrameWhenSidePeekOpen:v,isInHomeWidget:T,isInPeekRenderer:s,isPreviewing:c,isRootChild:u,store:t}),F=s?o(790245).A:o(779921).A,L=(0,d().K8)((()=>S.rect.state.width),[S.rect]);return"table"===h?(0,E.jsx)(Rp,{schema:b,format:C,query:x,store:t,collectionContextStore:j,showHoverActionsStore:y,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:m,minWidth:V,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u,placementStore:k,headerWidth:L},r.id):"board"===h?(0,E.jsx)(Xs,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:m,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"page"===h?_?(0,E.jsx)(Hg,{targetStore:_,collectionViewStore:r,disabled:P,templatePickerMenuListStore:I,isFullScreen:l,editorContentContainerRef:A}):null:"calendar"===h?(0,E.jsx)(nd,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:m,maxHeight:w,minWidth:V,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"list"===h?(0,E.jsx)(bd,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:v&&!T?24:m,minWidth:V,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"gallery"===h?(0,E.jsx)(va,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:m,paddingBottom:g,headerWidth:L,minWidth:V,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"timeline"===h?(0,E.jsx)(Vg,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isRootChild:u,isInPeekRenderer:s,isPreviewing:c,minWidth:V,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,showHoverActionsStore:y,ref:f,paddingLeft:p,paddingRight:m},r.id):"form_editor"===h?(0,E.jsx)(Wg,{collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m},r.id):"chart"===h?(0,E.jsx)(Gg,{collectionViewStore:r,isPreviewing:c,paddingLeft:p,paddingRight:m,headerSizeObserver:S,collectionContextStore:j}):"feed"===h?(0,E.jsx)(o(369789).XQ,{collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m}):"map"===h?(0,E.jsx)(zg,{collectionContextStore:j,paddingLeft:p,paddingRight:m,query:x,format:C,schema:b,store:t,renderGroupResults:e=>(0,E.jsx)(Hn,{disabled:!1,canDrag:!1,canDrop:!1,direction:zn.Vertical,collectionContextStore:j,format:C,groupsPointer:[],shouldShowHoverMenu:!1,emptyDroppableSize:0,analyticsName:"map",...e})}):"chat"===h?(0,E.jsx)(Ye().Q1,{collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m}):"custom"===h?(0,E.jsx)(Ye().bl,{store:t,collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m}):null}));function Hg(e){let{targetStore:t,collectionViewStore:o,disabled:n,templatePickerMenuListStore:r,isFullScreen:i,editorContentContainerRef:l}=e;const a=(0,ee().ET)(),{collectionStore:s}=(0,d().K8)((()=>({collectionStore:a.collectionStore()})),[a]);return(0,E.jsx)(ho,{canEdit:!n,disabled:n,store:t,collectionViewStore:o,templatePickerMenuListStore:r,collectionStore:s,isFullScreen:i,editorContentContainerRef:l})}function Wg(e){let{collectionViewStore:t,collectionContextStore:n,paddingLeft:r,paddingRight:i}=e;const l=(0,a().Y0)(),s=(0,u().IS)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-Wa().l1,marginBottom:120-Wa().l1,padding:0,paddingLeft:r,paddingRight:i},disabledBuilderTitle:{fontSize:14,fontWeight:Ro().Wy.regular},disabledBuilderIcon:{fill:e.lightIconColor,height:72,margin:"0 auto"},offlineErrorWrapper:{padding:0,marginLeft:r,marginRight:i,height:yo().iZ,background:e.fill.lightGraySecondary,borderRadius:16},offlineErrorIcon:{width:25,height:25,fill:e.text.secondary},offlineErrorTitle:{fontSize:14,color:e.text.secondary,fontWeight:void 0}})),[r,i]),c=!(0,d().O$)(Ke().e);return l.isMobile?(0,E.jsx)(Wa().Ay,{style:s.disabledBuilderWrapper,title:(0,E.jsx)("span",{style:s.disabledBuilderTitle,children:(0,E.jsx)(pt().sA,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:jo(s.disabledBuilderIcon)}):c?(0,E.jsx)(Wa().Ay,{style:s.offlineErrorWrapper,title:(0,E.jsx)(pt().sA,{id:"formsInner.offlineBuilder.title",defaultMessage:"Go online to edit this form"}),titleStyle:s.offlineErrorTitle,icon:(0,o(413161).C)(s.offlineErrorIcon)}):(0,E.jsx)(Eg,{collectionContextStore:n,paddingLeft:r,paddingRight:i},t.id)}function Gg(e){let{collectionViewStore:t,isPreviewing:o,paddingLeft:n,paddingRight:r,headerSizeObserver:i,collectionContextStore:l}=e;const a=(0,d().K8)((()=>i.rect.state.width),[i]);return(0,E.jsx)(Lg,{collectionContextStore:l,isPreviewing:o,headingWidth:a,paddingLeft:n,paddingRight:r},t.id)}const Ng=n.memo(Kg);var $g=()=>o(338828),Ug=()=>o(609107),qg=()=>o(943066),Xg=()=>o(510359);const Yg=(0,pt().YK)({plus:{id:"subscriptionTier.plus",defaultMessage:"Plus"},business:{id:"subscriptionTier.business",defaultMessage:"Business"},enterprise:{id:"subscriptionTier.enterprise",defaultMessage:"Enterprise"}});function Qg(e){let{isFullScreen:t,paddingLeft:n,paddingRight:r,paddingBottom:i}=e;const l=(0,ee().ET)(),a=(0,d().K8)((()=>{const e=l.collectionStore();return null==e?void 0:e.getFormat().integration_id}),[l]),s=(0,o(96718).l)(a);return a?s?(0,E.jsx)(Zg,{isFullScreen:t,paddingLeft:n,paddingRight:r,paddingBottom:i,integrationId:a,featureName:s}):(0,E.jsx)(Jg,{isFullScreen:t,paddingLeft:n,paddingRight:r,paddingBottom:i,integrationId:a}):null}function Zg(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i,featureName:l}=e;const s=(0,a().v3)(),c=(0,pt().tz)(),p=(0,ee().ET)(),[m,g]=(0,d().K8)((()=>[p.settingsStore,p.collectionStore()]),[p]),S=(0,d().K8)((()=>m.state.open),[m]),h=(0,d().K8)((()=>{if(g)return g.getIcon()}),[g]),f=(0,d().K8)((()=>$c().A.integrations.state.find((e=>e.id===i))),[i]),y=(0,u().IS)((e=>({integrationTitle:{fontSize:17,fontWeight:590,textAlign:"center"},upgradeDescription:{fontSize:17,fontWeight:510,textAlign:"center",color:e.text.tertiary,marginTop:12},upgradeIcon:{width:18,height:18,margin:2,color:e.text.uiBluePrimary}})),[]),v=(0,Fu().uF)({featureName:l});if(!i||!f||null==v||!v.upsell)return(0,E.jsx)(Jg,{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i});const{isAvailable:x,upsell:b,upsellTier:C}=v;return"none"!==b.type&&C?x&&b?(0,E.jsx)(Jg,{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i,featureName:l}):(0,E.jsx)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,E.jsxs)("div",{style:{paddingRight:S?yo().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,E.jsx)(Gr().B,{icon:h,size:48,disabled:!0,isEmptyPage:!1}),(0,E.jsx)("div",{style:y.integrationTitle,children:(0,E.jsx)(pt().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.externalCollectionUpsell.title",values:{integrationName:f.name}})}),(0,E.jsx)("div",{style:y.upgradeDescription,children:(0,E.jsx)(pt().sA,{defaultMessage:"You must upgrade to {subscriptionTier} to use this feature. {learnMoreLink}",id:"collectionViewBlock.externalCollectionUpsell.description",values:{subscriptionTier:c.formatMessage(Yg[C]),learnMoreLink:(0,E.jsx)(Xg().V,{})}})}),(0,E.jsx)(Xl().A,{size:"md",icon:$g().arrowInCircleUpFillIcon,iconStyle:y.upgradeIcon,style:{marginTop:12},onClick:()=>{qg().K(s,{from:"collection_synced_database",upsell:b})},children:(0,E.jsx)(pt().sA,{defaultMessage:"Upgrade",id:"collectionViewBlock.externalCollectionUpsell.upgradeButton.label"})})]})}):(0,E.jsx)(Jg,{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i})}function Jg(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i,featureName:l}=e;const s=(0,u().DP)(),c=(0,ee().ET)(),[p,m,g]=(0,d().K8)((()=>[c.permissionScopesStore.state,c.settingsStore,c.collectionStore()]),[c]),S=(0,d().K8)((()=>m.state.open),[m]),h=(0,d().K8)((()=>{if(g)return g.getIcon()}),[g]),{isMobileBrowser:f}=(0,a().Y0)(),y=(0,d().K8)((()=>{if(!g)return!1;const e=g.getFormat().integration_id,t=$c().A.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,Ug().jw)(e).length>0}),[g]),v=(0,d().K8)((()=>$c().A.integrations.state.find((e=>e.id===i))),[i]);if(!v)return null;const b=!(f&&!y);return(0,E.jsxs)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,height:250,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[(0,E.jsxs)("div",{style:{paddingRight:S?yo().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,E.jsx)(Gr().B,{icon:h,size:48,disabled:!0,isEmptyPage:!1}),(0,E.jsx)("div",{style:{fontSize:17,fontWeight:Ro().Wy.medium,color:s.text.tertiary,textAlign:"center",marginBottom:-2},children:(0,E.jsx)(pt().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:v.name}})}),p.canConfigureBlock&&(0,E.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:s.text.tertiary},children:b&&(0,E.jsx)(pt().sA,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:v.name,button:e=>(0,E.jsx)(It().A,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{x().Ho({collectionSettingsStore:m})},children:e})}})})]}),l?(0,E.jsx)("div",{style:{position:"absolute",top:8,right:n,maxWidth:270},children:(0,E.jsx)(Vu().gk,{featureName:l,source:"collection_synced_database"})}):null]})}const eS=(0,Ao().wt)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,E.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});function tS(e){let{viewType:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e;const s=(0,a().v3)(),c=(0,ee().ET)(),p=(0,d().O$)(c.permissionScopesStore),m=(0,u().DP)(),g=(0,n.useMemo)((()=>({style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l},icon:eS({height:48,fill:m.lightIconColor,margin:"0 auto"})})),[o,l,r,i,m.lightIconColor]),S=(0,n.useCallback)((()=>{!function(e,t){var o;const n=e.settingsStore,r=(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())??[],i=e.collectionViewStore(),l=1===r.length&&r[0].id===(null==i?void 0:i.id)&&void 0===r[0].getCollectionStore();x().Ow({collectionContextStore:e,collectionSettingsStore:n}),x().R8({collectionSettingsStore:n,item:l?{type:"createViewSource",existingCollectionStore:void 0,createdCollectionRecordPointerMap:void 0}:{type:"linkToDatabase",existingCollectionStore:void 0}}),(0,v().X)({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(c,s)}),[c,s]);return p.canConfigureBlock?(0,E.jsx)(Wa().Ay,{title:t?(0,E.jsx)(pt().sA,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:yt().to[t].toLocaleLowerCase()}}):(0,E.jsx)(pt().sA,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,E.jsx)(pt().sA,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:S,...g}):(0,E.jsx)(Wa().Ay,{title:(0,E.jsx)(pt().sA,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,E.jsx)(pt().sA,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...g})}var oS=()=>o(64713);const nS=n.memo((function(e){let{collectionContextStore:t,store:o,collectionStore:n,collectionViewStore:r,showHoverActionsStore:i,viewSettingsPlacementStore:l,templatePickerMenuListStore:s,leftRightPaddingStore:c,leftRightMarginStore:p,headerHeightStore:m,currentViewType:g,query:S,schema:f,format:y,maxHeight:v,fullWidth:x,scrollerLeftPadding:b,contentEditableVoidLeft:C,additionalCollectionViewInnerHorizontalPadding:w,rootRef:k,timelineViewRef:I,editorContentContainerRef:A,headerSizeObserver:j,isDisabled:R,isFullScreen:T,isInPeek:M,isPreviewing:_,isRootOrDirectChild:P,isPlaceholderExternalCollection:B,isMyTasksEmpty:V,isInFrameWhenSidePeekOpen:F,showHomeCustomDbEmptyState:O,showMyTasksEmptyState:D,isInHomeWidget:z,isHomeCustomDbEmpty:K,isUnlistedView:H,isViewModule:W,handleAddItemClick:G,handleEditorClick:N,handleHorizontalScrollerMount:$,handleEditorMouseDown:U,handleContentMount:q}=e;const{isMobile:X}=(0,a().Y0)(),Y=(0,a().WS)(),Q=T?(0,h().Px)(q,k):q,{paddingLeft:Z,paddingRight:J}=(0,d().K8)((()=>{var e,t;const o=w??0;return{paddingLeft:((null===(e=c.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=c.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[c,w]),ee=(0,d().K8)((()=>"collectionSettings"===t.contextType?0:T?"timeline"===g?96:X?90:180:"timeline"===g||"gallery"===g?0:H?16:Wt().A.state),[t,T,g,H,X]),te=(0,d().K8)((()=>!("chat"===g||"custom"===g)&&t.hasSingleCollection()),[g,t]),[oe,ne,re]=(0,d().K8)((()=>[null==n?void 0:n.isReady(),null==n?void 0:n.isDefined(),null==n?void 0:n.canRead()]),[n]),ie=(0,u().DP)(),le=(0,d().K8)((()=>({shimmer:{backgroundColor:ie.largeShimmerColor,height:48,marginBottom:10,width:"100%"},content:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",...p.state,...!T&&!_&&{...b&&{marginLeft:-b},maxHeight:v?v-m.state:"inherit",...z&&t.isEditableHomeCollectionStore.state?(0,Le().V$)({isPhone:Y,theme:ie}):{},width:x,left:C}},contentInner:T||_?{..."custom"===g&&{height:"100%"}}:{position:"relative",...z?{height:"100%",maxHeight:"inherit"}:{},..."custom"===g&&{height:"100%"}}})),[p,T,_,b,v,m,z,t.isEditableHomeCollectionStore,Y,ie,x,C,g]),ae=(0,L().X)("collection_page_view_content_editable_root");return(0,E.jsx)(Jt().A,{name:"CollectionViewBlockContent",children:(()=>{if(te){if(!n)return(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)(tS,{viewType:g,isFullScreen:T,paddingLeft:Z,paddingRight:J,paddingBottom:ee})});if(!oe)return(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)("div",{style:le.shimmer,children:(0,E.jsx)(to().A,{emphasized:!1,style:le.shimmer})})});if(!ne)return re?(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)(tS,{viewType:g,isFullScreen:T,paddingLeft:Z,paddingRight:J,paddingBottom:ee})}):(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)(oS().P2,{collectionStore:n,paddingLeft:Z,paddingRight:J})})}if(B)return(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)(Qg,{isFullScreen:T,paddingLeft:Z,paddingRight:J,paddingBottom:ee})});if(V&&"calendar"!==g)return(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)(Zt,{collectionContextStore:t,onAddTaskClick:G,from:z?"home_tile_tasks":"home_tasks"})});if(O)return(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!1,style:le.content,children:(0,E.jsx)(Fe().Y8,{collectionContextStore:t,onAddItemClick:G,from:z?"home_tile_custom_db":"home_custom_db"})});const e=(0,E.jsx)(Ng,{store:o,collectionViewStore:r,viewType:g,isDisabled:R,isFullScreen:Boolean(T),isInPeekRenderer:M,isPreviewing:_,isRootChild:P,paddingLeft:Z,paddingRight:J,paddingBottom:ee,headerSizeObserver:j,timelineViewRef:I,showHoverActionsStore:i,isInFrameWhenSidePeekOpen:F,query:S,schema:f,format:y,maxHeight:v,placementStore:l,templatePickerMenuListStore:s,editorContentContainerRef:A}),a=D?e:(0,E.jsx)(Io,{store:o,paddingLeft:b,isPreviewing:_,isFullScreen:Boolean(T),currentViewType:g,isInPeek:M,isInHomeWidget:z,isUnlistedView:H,viewSettingsPlacementStore:l,format:y,isMyTasksEmpty:V,isHomeCustomDbEmpty:K,isInFrameWhenSidePeekOpen:F,handleEditorMouseDown:U,isRootOrDirectChild:P,leftRightPaddingStore:c,paddingBottom:ee,handleHorizontalScrollerMount:$,handleEditorClick:N,children:e});if("page"===g&&ae)return(0,E.jsx)(fo,{store:o,collectionViewStore:r,isFullScreen:Boolean(T),editorContentContainerRef:A,templatePickerMenuListStore:s,isViewsModule:W,style:le.content});const d=(0,E.jsx)("div",{style:le.contentInner,children:a});return"page"===g&&W?(0,E.jsx)("div",{style:le.content,children:d}):"page"===g?(0,E.jsx)(eo().c,{disabled:!1,displayName:"CollectionViewPageContent",ref:Q,style:le.content,children:d}):(0,E.jsx)(rt().s,{ref:Q,allowSelectionWithin:!0,style:le.content,children:d})})()})}));o(610931);var rS=()=>o(755769);function iS(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:r,settingsHeaderSizeObserver:i,placementStore:l,placementToOrigin:s=rS().UV.Bottom,alignmentToOrigin:c=rS().MY.Start,marginTop:u=-1,originGap:p,headerRef:m,handleAddItemClick:g}=e,S=(0,a().v3)(),h=(0,d().O$)(l),[f,y]=(0,n.useState)(!1),[v,x]=(0,n.useState)(!0),b=(0,d().K8)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),C=(0,d().O$)(t.isFullScreenStore),[w,k]=(0,n.useState)(!1),I=(0,d().K8)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),A=(0,d().K8)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),j=(0,d().K8)((()=>{const e=o.rect.state;return 0!==e.width?(0,Ie().wW)(t,S.device.isMobile,e.width):"popup"}),[t,S.device.isMobile,o.rect]);(0,n.useEffect)((()=>{I&&(o.recompute(),i.recompute(),l.setState(j)),I&&!C&&"form_editor"!==A&&(y(!0),x(!1))}),[I,C,l,o,i,A,j]);const R=(0,d().K8)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:i.rect.state.right-2,y:i.rect.state.y-2,width:0,height:i.rect.state.height})),[t,i.rect]);return(0,n.useEffect)((()=>{if(f){const e=null==m?void 0:m.current;if(e){const t=e.getBoundingClientRect();S.WindowSizeStore.state.height-t.top<yo().iZ&&((0,F().vq)(e,{edgeDist:0,animate:!1}),o.recompute(),i.recompute())}y(!1),x(!0)}}),[t,S.WindowSizeStore,o,i,b,f,m]),(0,n.useEffect)((()=>{k(!(!I||!v))}),[I,v]),"sidebar"===h?(0,E.jsx)(lS,{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:r,paddingRight:e.paddingRight,shouldScrollIntoView:f,headerHeightStore:e.headerHeightStore,settingsOpen:w,isInPeekRenderer:b}):(0,E.jsx)(aS,{collectionContextStore:t,placementToOrigin:s,alignmentToOrigin:c,originGap:p??0,marginTop:u,settingsOpen:w,shouldScrollIntoView:f,originRect:R,handleAddItemClick:g})}function lS(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:r,shouldScrollIntoView:i,settingsOpen:l}=e,s=(0,L().X)("db_ux_chrome"),c=(0,a().v3)(),p=(0,d().K8)((()=>{const e=o.rect.state;return c.WindowSizeStore.state.height-(e.top+Ae().Lq)}),[c.WindowSizeStore,o.rect]),m=(0,d().K8)((()=>n.rect.state.height),[n.rect]),g=(0,d().K8)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),S=(0,d().O$)(e.headerHeightStore),h=(0,d().K8)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),f=(0,u().IS)((e=>({topLevelDiv:{position:"absolute",top:S,right:-r,background:g?e.cardContentBackground:e.contentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,borderImage:s?`linear-gradient(180deg, ${e.contentBackground} 0px, ${e.tableDividerColor} 12px) 1 100%`:void 0,paddingRight:r,zIndex:88,...h?{height:m,minHeight:p}:{height:p}},nestedDiv:{...s?{}:{boxShadow:`inset 0 1px 0 ${e.tableDividerColor}`}}})),[S,r,g,h,m,p,s]);return l?(0,E.jsx)(it().A,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,E.jsx)(kt().A,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:f.topLevelDiv,className:we().N11,...(0,Hi().A)({onMouseDown:e=>function(e,t){(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{I().clear({environment:t})}})}(e,c)},e),children:(0,E.jsxs)("div",{style:{display:"flex",...h?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,E.jsx)("div",{style:f.nestedDiv,children:(0,E.jsx)(sS,{collectionContextStore:t,shouldScrollIntoView:i,isSidebar:!0})}),(0,E.jsx)("div",{style:{width:r}})]})})}):null}function aS(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:r,originGap:i,marginTop:l,settingsOpen:s,shouldScrollIntoView:c,originRect:u,origin:p=(0,E.jsx)("div",{}),handleAddItemClick:m}=e,g=(0,a().v3)(),S=(0,n.useCallback)((e=>(0,E.jsx)(sS,{collectionContextStore:t,shouldScrollIntoView:c,isSidebar:e,handleAddItemClick:m})),[t,c,m]),h=function(e){let{collectionContextStore:t}=e;const o=(0,a().v3)(),n=(0,a().WS)(),r=(0,d().K8)((()=>o.WindowSizeStore.isLandscape()),[o.WindowSizeStore]);return(0,d().K8)((()=>"chart"===(null==t?void 0:t.getViewType())&&n&&!r),[t,n,r])}({collectionContextStore:t});return(0,E.jsx)(ks().Ay,{popupType:g.device.isMobile?ks().nl.BottomSheet:ks().nl.Popup,bottomSheetInitialState:h?"half":"full",className:`${we().N11} ${we().xeF}`,open:s,placementToOrigin:o,alignmentToOrigin:r,style:{marginTop:l},origin:p,originGap:i,render:S,onDismiss:t=>{var o;null===(o=e.onDismiss)||void 0===o||o.call(e),function(e,t){(0,Te().SQ)({event:e,context:Te().y$.CollectionSettingsClick,callback:()=>{x().os({collectionSettingsStore:t.settingsStore})}})}(t,e.collectionContextStore)},originRect:u,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}function sS(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoView:n,handleAddItemClick:r}=e;return n?null:(0,E.jsx)(lu().m$,{context:Ie().Bd.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t,handleAddItemClick:r})}const cS=n.memo((function(e){let{store:t,leftRightPaddingStore:o,viewSettingsPlacementStore:n,headerHeightStore:r,headerSizeObserver:i,contentSizeObserver:l,settingsHeaderSizeObserver:a,currentViewType:s,isInHomeWidget:c,placementToOrigin:u,alignmentToOrigin:p,headerRef:m,handleAddItemClick:g}=e;const S=(0,ee().Ks)(),h=(0,d().K8)((()=>(0,V().RX)(t)?{paddingLeft:0,paddingRight:0}:o.state),[o,t]),v=(0,d().K8)((()=>{var e;return void 0!==(null==S||null===(e=S.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==S?void 0:S.viewsModuleContextStore]),x="form_editor"===s,b=(0,d().K8)((()=>{var e;if(u)return u;if(!x)return;return!(null==S||!S.settingsStore.state.open)&&(0,y().Xk)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,f().$1)(null==S?void 0:S.settingsStore.state.stack))||void 0===e?void 0:e.type)?rS().UV.Right:rS().UV.Bottom}),[u,x,null==S?void 0:S.settingsStore]),C=p??(c?rS().MY.End:void 0),w=x?b===rS().UV.Right?24:12:void 0,k=(0,d().K8)((()=>(null==S?void 0:S.isInlineViewStore.state)&&(null==S?void 0:S.isUnlistedViewStore.state)),[null==S?void 0:S.isInlineViewStore,null==S?void 0:S.isUnlistedViewStore]);return v?null:h&&S?(0,E.jsx)(iS,{collectionContextStore:S,headerSizeObserver:i,contentSizeObserver:l,settingsHeaderSizeObserver:a,headerHeightStore:r,placementStore:n,marginTop:k?-10:void 0,placementToOrigin:b,alignmentToOrigin:C,originGap:w,headerRef:m,...h,handleAddItemClick:g}):null}));var dS=()=>o(497808),uS=()=>o(434498);const pS=(0,pt().YK)({defaultAddViewAriaLabel:{id:"collectionViewTabBar.addView",defaultMessage:"Add view, chart, or form"},defaultAddViewTooltip:{id:"collectionViewTabBar.addViewTooltip",defaultMessage:"Add a new view, chart, or form"},linkedAddViewAriaLabel:{id:"collectionViewTabBar.linkedAddView",defaultMessage:"Add view or chart"},linkedAddViewTooltip:{id:"collectionViewTabBar.linkedAddViewTooltip",defaultMessage:"Add a new view or chart"},viewsModuleAddViewAriaLabel:{id:"collectionViewTabBar.viewsModuleAddView",defaultMessage:"Add tab"},viewsModuleAddViewTooltip:{id:"collectionViewTabBar.viewsModuleAddViewTooltip",defaultMessage:"Add a new tab"}}),mS=n.memo((function(e){const{renderState:t,collectionContextStore:o,preventRectangularSelection:n,variant:r}=e,i=(0,d().K8)((()=>"viewsMain"===o.viewsModuleContextStore.getViewModuleType()),[o]),l=(0,u().IS)((()=>({flex:{display:"flex"}})),[]);return t.showAddViewButton?(0,E.jsx)(kt().A,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.flex,onMouseDown:n,children:i?(0,E.jsx)(gS,{variant:r}):(0,E.jsx)(SS,{collectionContextStore:o,variant:r})}):null})),gS=n.memo((function(e){const{variant:t}=e,r=(0,pt().tz)(),i=(0,u().IS)((e=>({button:{..."pills"===t?{height:28,width:28,borderRadius:"100%"}:void 0,background:e.tint.uiBlue},hoveredButton:{color:e.text.uiBluePrimary,background:e.tint.uiBlueHover},pressedButton:{color:e.text.uiBluePrimary,background:e.tint.uiBluePressed},icon:{fill:e.icon.uiBluePrimary,height:Ao().Ev.sm,width:Ao().Ev.sm}})),[t]),l=(0,n.useCallback)((()=>(0,E.jsx)(pt().sA,{...pS.viewsModuleAddViewTooltip})),[]),a=(0,n.useCallback)(((e,t)=>(0,E.jsx)(At().A,{ariaLabel:r.formatMessage(pS.viewsModuleAddViewAriaLabel),className:we().Tel,icon:tr().plusSmallIcon,style:i.button,hoveredStyle:i.hoveredButton,pressedStyle:i.pressedButton,iconStyle:i.icon,...t,...e})),[r,i.button,i.hoveredButton,i.icon,i.pressedButton]),s=(0,n.useCallback)((e=>(0,E.jsx)(jt().A,{renderTooltip:l,render:t=>a(t,e)})),[a,l]);return(0,E.jsx)(o(363913).i,{renderOrigin:s})})),SS=n.memo((function(e){const{collectionContextStore:t,variant:o}=e,r=(0,pt().tz)(),i=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isLinkedCollectionView()}),[t]),l=(0,u().IS)((()=>({button:{..."pills"===o?{height:28,width:28,borderRadius:"100%"}:void 0},icon:{height:Ao().Ev.sm,width:Ao().Ev.sm}})),[o]),a=(0,n.useCallback)((e=>(0,E.jsx)(dS().y7,{collectionContextStore:t,onClose:e.close,forceHideAdvancedConfigItems:!1})),[t]),s=(0,n.useCallback)((()=>(0,E.jsx)(pt().sA,{...i?pS.linkedAddViewTooltip:pS.defaultAddViewTooltip})),[i]),c=(0,n.useCallback)(((e,t)=>(0,E.jsx)(At().A,{ariaLabel:r.formatMessage(i?pS.linkedAddViewAriaLabel:pS.defaultAddViewAriaLabel),className:we().Tel,icon:tr().plusSmallIcon,style:l.button,iconStyle:l.icon,...t,...e})),[r,i,l.button,l.icon]),p=(0,n.useCallback)((e=>(0,E.jsx)(jt().A,{renderTooltip:s,render:t=>c(t,e)})),[c,s]);return(0,E.jsx)(qi().Ay,{popupType:qi().z7.Popup,alignmentToOrigin:uS().C1.Start,originGap:4,render:a,renderOrigin:p},"suggested-views")}));var hS=()=>o(500418);function fS(e){const{origin:t}=e,o=(0,a().v3)();return(0,E.jsx)(Yc().k,{origin:t,placementToOrigin:"bottom",header:(0,E.jsx)(pt().sA,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,E.jsx)(pt().sA,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{vu().A6(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:bu().gO,pointerOffset:bu().Nu,style:{width:bu().Sw}})}function yS(e){const{origin:t}=e,o=(0,a().v3)();return(0,E.jsx)(Yc().k,{origin:t,placementToOrigin:"right",header:(0,E.jsx)(pt().sA,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,E.jsx)(pt().sA,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,E.jsx)("span",{style:{fontWeight:Ro().Wy.semibold},children:e})}}),onCloseClick:()=>{vu().A6(o)},pointerPosition:"50%",pointerLength:bu().gO,pointerOffset:bu().j$,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:bu().Sw}})}var vS=()=>o(511441),xS=()=>o(159809),bS=()=>o(953424),CS=()=>o(622163);const wS=n.memo((function(e){var t,r;const{collectionViewStore:i,collectionContextStore:l,hideUnderline:s,onViewClick:c,disabled:p,variant:m="default"}=e,g=(0,a().v3)(),S=(0,a().Y0)(),h=(0,u().DP)(),[f,y]=(0,n.useState)(!1),b=(0,o(546820).v$)(),C=(0,fe().Zp)(),[w,k]=(0,d().K8)((()=>{var e;return[l.viewsModuleContextStore.isInLayoutBuilder(),null===(e=l.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[l.viewsModuleContextStore]),I=(0,n.useCallback)((()=>{y(!1)}),[]),{renderMenu:A,hasMenuItems:j}=(0,o(476894).y)({collectionViewStore:i,collectionContextStore:l,onClose:I}),R=(0,n.useCallback)((()=>{!j||null!=C&&C.disableAllPointerEvents||y(!0)}),[C,j]),T=(0,n.useCallback)((e=>{e.preventDefault(),(0,Te().SQ)({event:e,context:Te().y$.EditorContextMenu,callback:R})}),[R]),_=(0,n.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const n=l.viewsModuleContextStore.state?void 0:Re().Vr(e);if(c({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:n}),t.id===i.id?R():(0,o(259897).t)({environment:g,collectionContextStore:l,collectionViewId:i.id,openInNew:n,isFullScreen:l.isFullScreenStore.state,isRootChild:l.isRootChildStore.state,isInPeekRenderer:l.isInPeekRendererStore.state}),w&&b){var r;const e=null===(r=l.viewsModuleContextStore.getViewsModule())||void 0===r?void 0:r.id;e&&(b.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),x().Ow({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}(0,v().X)({environment:g,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id})}),[l,c,R,i,w,b,g]),{currentViewStore:P,collectionViewBlockStore:B}=(0,d().K8)((()=>({currentViewStore:l.collectionViewStore(),collectionViewBlockStore:l.collectionViewBlockStore()})),[l]),{isDefinedCollectionViewStore:V,viewIcon:F,viewType:L}=(0,d().K8)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType()})),[i]),O=(null===(t=(0,M().Oz)(l))||void 0===t?void 0:t.background)??"none",D=(0,n.useRef)(null),z=(0,d().K8)((()=>{var e,t;return!((null==B?void 0:B.getSpaceId())!==(null===(e=bt().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===st().Lu&&"sprint_board"===(null===(t=bt().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,B]),K=(0,d().K8)((()=>{var e;return!0===(null===(e=bt().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),H=(0,d().K8)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),W=(null==P?void 0:P.id)===i.id,G="pills"!==m&&!s&&W&&H,N=W&&w&&"existing_module"===(null==b||null===(r=b.currentModuleSelection)||void 0===r?void 0:r.type)&&b.currentModuleSelection.moduleId===k;return V&&P&&B?(0,E.jsx)(ks().Ay,{popupType:S.isMobile?ks().nl.BottomSheet:ks().nl.Popup,alignmentToOrigin:Ee().C.Start,open:f,render:A,onDismiss:I,trapFocus:!0,origin:(0,E.jsxs)("div",{className:we().f_$,style:{display:"flex",alignItems:"center",background:w?void 0:O,height:"100%",...G&&{borderBottom:`2px solid ${h.text.primary}`,paddingTop:2},..."pills"===m?{marginRight:1}:void 0},onContextMenu:T,children:[z&&(0,E.jsx)(xr().U7,{origin:D}),K&&(0,E.jsx)(Mu().gO,{origin:D,store:l}),(0,E.jsx)(kS,{collectionViewStore:i,render:e=>(0,E.jsxs)(dr().p,{"aria-selected":W,role:"tab",ref:D,size:"pills"===m?"lg":"md",style:{display:"flex",alignItems:"center",height:32,fontSize:14,fontWeight:Ro().Wy.medium,color:W?h.text.primary:h.text.secondary,maxWidth:jS,..."pills"===m?{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px 6px 10px",whiteSpace:"nowrap"}:{},...w?N?(0,CS().nl)({width:3,color:h.stroke.uiBluePrimary}):(0,CS().nl)({width:1.5,color:h.stroke.uiBlueSecondary}):void 0,...w?{marginRight:4,transition:"box-shadow 0.3s"}:void 0},hovered:w?W&&!N:"pills"===m?f||W:f,hoveredStyle:w?{...(0,CS().nl)({width:3,color:h.stroke.uiBlueSecondary}),background:"none"}:void 0,pressedStyle:w?{...(0,CS().nl)({width:3,color:h.stroke.uiBluePrimary}),background:"none"}:void 0,onClick:_,disabled:p,...e,children:[(0,E.jsx)(vS().h,{color:W?"regular":"light",viewIcon:F,viewType:L,style:{marginRight:6}}),(0,E.jsx)("span",{style:{...Ro().RC,marginTop:1},children:(0,E.jsx)(AS,{collectionContextStore:l,collectionViewStore:i})})]},i.id)})]})}):null}));function kS(e){const t=(0,u().DP)(),{collectionViewStore:n,render:r}=e,i=(0,ee().ET)(),l=(0,d().K8)((()=>{var e;const t=null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id;return!!t&&((0,Ce().sj)(t)&&i.isInHomeWidgetStore.state)}),[i.isInHomeWidgetStore,n]),[a,s]=(0,d().K8)((()=>{const e=n.getName(),t=n.getType(),r=(0,M().OO)({collectionViewName:e,collectionViewType:t});if(!t)return[r,void 0];const i=n.getFormat().description;if(i)return[r,i];const l=n.getCollectionStore(),a=null==l?void 0:l.getName();if(l&&a){var s,c;if((null==l||null===(s=l.getParentBlockStore())||void 0===s?void 0:s.id)===(null===(c=n.getParentBlockStore())||void 0===c?void 0:c.id))return[r,(0,E.jsx)(pt().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:yt().to[t],collection:(0,o(654548).r4)(a,l)}},"viewTab.tooltip.2")]}return[r,(0,E.jsx)(pt().sA,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:yt().to[t]}},"viewTab.tooltip.2")]}),[n]);return a?(0,E.jsx)(jt().A,{placement:l?Ee().W.Top:Ee().W.Bottom,originGap:l?0:void 0,alignment:Ee().C.Start,delayThreshold:500,style:l?{marginBottom:-5,marginLeft:8}:{},render:e=>l?(0,E.jsx)("div",{style:{marginLeft:-8},children:r(e)}):r(e),renderTooltip:e=>l?(0,E.jsx)(pt().sA,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"}):(0,E.jsxs)("div",{...e,style:_u().Q$,children:[a,(0,E.jsx)("div",{style:{color:t.text.contrastSecondary},children:s})]})}):null}function IS(e,t,o){var n;const r=e.collectionStore();if(!r)return t.getName();const i=r.getPropertyMapping(),l=t.getName(),a=null==i?void 0:i[st().yx.TaskToSprintRelation];if(!o||!a||l!==xt().A.formatMessage(xS().DZ.tasksCurrentSprintV2ViewName))return t.getName();const s=o[a];if(!s||"relation"!==s.type||!s.collection_pointer)return t.getName();const c=null===(n=(0,bS().ax)(e,"current",s.collection_pointer,r))||void 0===n?void 0:n.getBlockTitleStore().getValue();return c?`${xt().A.formatMessage(xS().DZ.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function AS(e){const{collectionViewStore:t,collectionContextStore:n}=e,[r,i]=(0,d().K8)((()=>{const e=n.settingsStore.state;return[e.open,f().HV(e.stack)]}),[n.settingsStore]),l=(0,d().K8)((()=>n.viewsModuleContextStore.state),[n.viewsModuleContextStore]),a=(0,d().K8)((()=>n.collectionViewStore()),[n]),s=(0,d().K8)((()=>t.getCollectionStore()),[t]),c=(0,d().K8)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===st().Lu&&null!=s&&s.isDefined()?{name:IS(n,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,n]),u=r&&i&&("duplicateExistingView"===i.type||"createView"===i.type);return!c||(null==a?void 0:a.id)===t.id&&u&&!l?(0,E.jsx)(pt().sA,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,E.jsx)(o(559181).A,{collectionViewName:c.name,collectionViewType:c.type})}const jS=220,RS={default:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:40},pills:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:52}},TS=n.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:r,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:s,disabled:c,variant:p="default"}=e,m=(0,a().v3)(),g=(0,a().Y0)(),S=(0,a().WS)(),h=(0,L().X)("db_ux_chrome"),f=(0,n.useRef)(null),y=(0,n.useRef)(null),x=(0,n.useRef)(new(qe().E)({throttleMs:50})),b=(0,n.useRef)(new Map),C=(0,d().O$)(r),w=(0,fe().Zp)(),k=(0,n.useRef)(null),{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:I,MORE_BUTTON_MAX_WIDTH:j,ADD_VIEW_BUTTON_MAX_WIDTH:R,VIEW_TAB_PADDING:T}=(0,n.useMemo)((()=>RS[p]),[p]),{isInCollectionViewPageWithContent:_,isEditingViewsModuleInPageBuilder:B}=(0,d().K8)((()=>{var e;return{isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),V=(0,d().O$)(t.permissionScopesStore),F=(0,d().O$)(t.isFullScreenStore),O=(0,d().O$)(t.isInHomeWidgetStore),D=(0,d().O$)(t.isEditableHomeCollectionStore),z=(0,d().K8)((()=>{var e;return l?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,l]),K=(0,d().K8)((()=>Boolean(Ge().Ay.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(433364).gt)(bt().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]);(0,n.useEffect)((()=>{const e=x.current;return()=>{e.destroy()}}),[x]);const H=(0,n.useCallback)((e=>{let t=b.current.get(e.id);t||(t=new(o(807672).k)({style:{fontSize:`${Ro().J.UIRegular.desktop}px`,fontWeight:Ro().Wy.medium}}),b.current.set(e.id,t));const n=(0,M().OO)({collectionViewName:e.getName(),collectionViewType:e.getType()}),r=t.measure(n);return Math.min(T+r.width,jS)}),[T]),W=(0,d().K8)((()=>MS(t,i,w,l)),[t,i,w,l]),G=(0,d().K8)((()=>{const e=t.collectionViewStore();if(!e)return;if("collectionSettings"===t.contextType)return[];const o=Math.max(j,W?R:0);let n=x.current.rect.state.width-o;const r=[],i=H(e);if(!(i<n))return r;r.push(e),n-=i;for(const t of z){if(t.id===e.id)continue;const o=H(t);if(!(o<n))break;r.push(t),n-=o}const l=r.filter((t=>t.id!==e.id)),a=z.findIndex((t=>t.id===e.id));return l.splice(a,0,e),l}),[t,j,W,R,H,z]),N=(0,d().K8)((()=>"collectionSettings"===t.contextType),[t]),$=(0,n.useMemo)((()=>{const e=(null==G?void 0:G.length)||0,t=z.length-e,o=G&&(0===e||1===e&&z.length>1)||S||_||D,n=N?"allTabsVisible":o?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:W&&"allTabsVisible"===n,addViewButtonAnimatedIn:F||C||B,viewSelectState:n,moreViewsCount:t}}),[G,z,S,_,D,W,F,C,B,N]),U=(0,n.useCallback)((e=>{e&&x.current.observe(e)}),[x]),q=(0,d().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e.getType()}),[t]),X=(0,u().IS)((e=>{const t=c||O,n=t&&"pills"!==p||"pills"===p?0:5;return{jiraOnboardingContainer:{boxShadow:o(730950).p.outlineBlueInputBoxShadow.light,borderRadius:6},draggableContainer:{height:"100%"},tabContainer:{display:"flex",alignItems:"center",height:32,fontSize:t?Ro().J.UISmall.desktop:14,fontWeight:t?Ro().Wy.regular:Ro().Wy.medium,color:t?e.text.secondary:e.text.primary,maxWidth:"form_editor"===q&&g.isMobile?I:jS,..."pills"===p?{background:"rgba(55, 53, 47, 0.06)",borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingLeft:10,paddingRight:10,whiteSpace:"nowrap"}:{}},moreViewsContainer:{display:"flex",alignItems:"center",height:32,fontSize:Ro().J.UIRegular.desktop,color:e.text.secondary,..."pills"===p?{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingLeft:10,paddingRight:10,whiteSpace:"nowrap"}:{}},viewIcon:{marginLeft:n,marginRight:6},viewTitle:{...Ro().RC,marginRight:h?4:6},tabChevron:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:e.lightIconColor}}}),[I,g.isMobile,c,h,O,p,q]),Y=(0,n.useMemo)((()=>{if(G&&"dropdown"!==$.viewSelectState)return!V.canConfigureBlock||null!=w&&w.disableAllPointerEvents?G.map(((e,o)=>{const r=n.createRef();return 0===o&&K?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{ref:r,style:X.jiraOnboardingContainer,children:(0,E.jsx)(wS,{collectionContextStore:t,collectionViewStore:e,onViewClick:s,disabled:c,hideUnderline:l,variant:p},e.id)}),(0,E.jsx)(P().dM,{origin:r})]}):(0,E.jsx)(wS,{collectionContextStore:t,collectionViewStore:e,onViewClick:s,disabled:c,hideUnderline:l,variant:p},e.id)})):(0,E.jsx)(Ka().Ay,{direction:"horizontal",keys:G.map((e=>e.id)),style:X.draggableContainer,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:(e,o)=>{const r=G.find((t=>t.id===e));if(r){const e=n.createRef();return 0===o&&K?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{ref:e,style:X.jiraOnboardingContainer,children:(0,E.jsx)(wS,{collectionContextStore:t,collectionViewStore:r,onViewClick:s,disabled:c,hideUnderline:l,variant:p},r.id)}),(0,E.jsx)(P().dM,{origin:e})]}):(0,E.jsx)(wS,{collectionContextStore:t,collectionViewStore:r,onViewClick:s,disabled:c,hideUnderline:l,variant:p})}},onDrop:e=>function(e,t,n){const r=n.collectionViewBlockStore();if(!r)return;A().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,canUndo:!0,perform:t=>{(0,o(949094).i)({collectionViewBlockStore:r,newViewIds:e,transaction:t})}})}(e,m,t)})}),[G,$.viewSelectState,V.canConfigureBlock,null==w?void 0:w.disableAllPointerEvents,X.draggableContainer,X.jiraOnboardingContainer,K,t,s,c,l,p,m]),Q=(0,n.useCallback)((e=>{const n=t.collectionViewStore();if(null!=n&&n.isDefined()){if("dropdown"===$.viewSelectState){var r;const i=n.getType(),l=n.getFormat().collection_view_icon,a=c||O,s="page"===n.getType()&&(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===st().pW;return(0,E.jsxs)(E.Fragment,{children:[!g.isMobile&&s&&"home"===vu().WH()&&(0,E.jsx)(fS,{origin:f}),(0,E.jsx)(kS,{collectionViewStore:n,render:r=>(0,E.jsxs)(dr().p,{ref:f,style:X.tabContainer,hovered:"pills"===p||void 0,size:"pills"===p?"lg":"md",disabled:c,...(0,Hi().A)(e,r),children:[(0,E.jsx)(vS().h,{color:a?"lightGray":"regular",viewType:i,viewIcon:l,style:X.viewIcon,size:a?Ao().Ev.sm:void 0}),(0,E.jsx)("span",{style:X.viewTitle,children:(0,E.jsx)(AS,{collectionContextStore:t,collectionViewStore:n})}),c?null:(0,o(663821).arrowChevronSingleDownSmallIcon)(X.tabChevron)]})})]})}return"someTabsNotVisible"===$.viewSelectState?(0,E.jsx)(dr().p,{style:X.moreViewsContainer,size:"pills"===p?"lg":"md",...e,children:(0,E.jsx)("span",{children:(0,E.jsx)(pt().sA,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:$.moreViewsCount}})})}):void 0}}),[t,$.viewSelectState,$.moreViewsCount,c,O,g.isMobile,X.tabContainer,X.viewIcon,X.viewTitle,X.tabChevron,X.moreViewsContainer,p]),Z=(0,n.useCallback)((e=>{var n;const{device:r}=m,i=(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===st().pW;return(0,E.jsxs)(E.Fragment,{children:[!r.isMobile&&"views"===vu().WH()&&i&&(0,E.jsx)(yS,{origin:y}),(0,E.jsx)("div",{ref:y,children:(0,E.jsx)(dS().W5,{collectionContextStore:t,onClose:e.close,onViewClick:s,onAddViewClick:e=>function(e,t,n){A().createAndCommit({userAction:e,environment:t,canUndo:!0,perform:e=>{(0,o(791009).Z)({environment:t,collectionContextStore:n,newViewType:"table",transaction:e})}}),(0,o(153258).b)({environment:t,collectionContextStore:n,view_type:"table",from:"addButton"})}(e,m,t)})})]})}),[t,m,s]),J=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),ee=(0,Nr().BG)();return(0,E.jsx)(Qe().lC,{collectionContextStore:t,step:"views",containerRef:k,children:(0,E.jsx)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",...h?{marginLeft:-4,marginTop:-3}:{},flexGrow:10,overflow:"hidden",...B?{paddingLeft:2}:{}},ref:U,children:(0,E.jsxs)("div",{ref:k,style:{display:"flex",alignItems:"center",flexShrink:1,height:"100%"},children:[Y,$.showMoreViewsButton&&(0,E.jsx)("div",{onMouseDown:J,children:(0,E.jsx)(qi().Ay,{alignmentToOrigin:uS().C1.Start,originGap:4,popupType:S?ee?ks().nl.BottomSheet:ks().nl.SlideUp:ks().nl.Popup,render:e=>Z(e),renderOrigin:Q,onClick:()=>function(e,t){(0,v().X)({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(m,t)})}),(0,E.jsx)(mS,{renderState:$,collectionContextStore:t,preventRectangularSelection:J,variant:p})]})})})}));function MS(e,t,o,n){return"collectionSettings"!==e.contextType&&(!(n||t||null!=o&&o.disableAllPointerEvents)&&(!!e.permissionScopesStore.state.canConfigureBlock&&!e.isMultiSourceView))}var _S=()=>o(479020),PS=()=>o(610271);const BS=n.memo((function(e){const{collectionContextStore:t}=e,o=(0,d().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isParentCollectionDead:r}=(0,d().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:n}}),[t]);return n&&(!o&&r)?(0,E.jsx)(VS,{parentBlockStore:n}):null})),VS=n.memo((function(e){let{parentBlockStore:t}=e;const r=(0,a().v3)(),{isMobile:i}=(0,a().Y0)(),l=i?PS().wt:PS().Ye,s=(0,u().IS)((e=>({layoutComponent:{color:e.text.secondary,background:e.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:Ro().Wy.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),c=(0,n.useCallback)((()=>{(0,xe().vd)(r,"view_deleted_database_from_deleted_collection_view_banner"),o(264330).Y({environment:r,store:t,pageVisitSource:To().y8.LinkInPage})}),[r,t]);return(0,E.jsxs)(l,{style:s.layoutComponent,alignItems:"center",justifyContent:i?"":"space-between",children:[(0,E.jsxs)(PS().Ye,{alignItems:"center",children:[(0,ut().I)(s.trashIcon),(0,E.jsx)(pt().sA,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,E.jsxs)(dr().p,{style:s.viewCollectionButton,onClick:c,isLightGray:!0,children:[(0,E.jsx)(pt().sA,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,o(268974).B)(s.arrowIcon)]})]})}));var FS=()=>o(193302),LS=()=>o(950808),OS=()=>o(723249),ES=()=>o(440961);function DS(){const e=(0,ee().Ks)(),t=(0,d().K8)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,Jr().A)(t,500,100)?(0,E.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,E.jsx)(ur().A,{style:{width:14,height:14}})}):null}const zS=n.memo(DS);var KS=()=>o(493738);const HS=(0,pt().YK)({searchLabel:{id:"database.searchButton.tooltip",defaultMessage:"Search"},searchInputPlaceholder:{id:"database.searchInputPlaceholder",defaultMessage:"Type to search..."}}),WS=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,currentViewType:r,topbarIconButtonStyle:i}=e,l=(0,a().v3)(),s=(0,d().K8)((()=>0===t.collectionStoresStore.state.length),[t]),c=(0,d().O$)(t.searchOpenStore),p=(0,d().O$)(t.searchQueryStore),m=(0,u().IS)((e=>({iconButton:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:e.mediumIconColor},input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.text.primary,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),g=(0,n.useCallback)((()=>{se().default.reset(),ce().default.reset(),Od().A.reset()}),[]),S=(0,n.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),h=(0,n.useCallback)((()=>{t.searchQueryStore.state||S()}),[t,S]),f=(0,n.useCallback)((e=>{27===e.keyCode&&S()}),[S]),y=(0,n.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),(0,v().X)({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]),x=(0,n.useCallback)((e=>{(0,Jn().S)({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(o)}),function(e,t){xe().vd(e,"collection_search",t)}(l,{view_type:r})}),[t,r,l,o]),b=(0,hr().Y)(x,250),C=(0,n.useCallback)((()=>xt().A.formatMessage(HS.searchLabel)),[]),w=(0,n.useCallback)((e=>(0,E.jsx)("div",{...e,style:m.ignoreArea,children:(0,E.jsx)(cu().A,{style:m.input,right:(0,E.jsx)(FS().LazyAssistantCollectionSearchInputButton,{collectionContextStore:t}),format:cu().C.Transparent,value:p,onChange:b,placeholder:xt().A.formatMessage(HS.searchInputPlaceholder),focusInitial:c,showClearButton:!0,onFocus:g,onBlur:h,onCancel:S,onClick:Te().kV,onClearButtonClick:S,onKeyDown:f})})),[t,S,h,g,f,b,c,p,m.ignoreArea,m.input]),k=(0,n.useCallback)((e=>(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(At().A,{...e,icon:KS().u,iconStyle:m.iconButton,style:i,disabled:s,onClick:y,ariaLabel:xt().A.formatMessage(HS.searchLabel)}),(0,E.jsx)(kt().A,{visible:c,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,E.jsx)(it().A,{capture:c,allowEsc:!0,render:w})})]})),[s,y,w,c,m.iconButton,i]);return(0,E.jsx)(jt().A,{renderTooltip:C,render:k})}),No().A);var GS=()=>o(155352),NS=()=>o(164045);function $S(){const e=(0,a().v3)(),t=(0,ee().ET)(),r=(0,d().K8)((()=>t.settingsStore.state.open&&LS()._T({tab:(0,GS().S)(t.settingsStore)})),[t]),i=(0,d().O$)(t.isInHomeWidgetStore),l=(0,d().K8)((()=>t.aliveAutomationCountStore.state>0),[t]),s=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),c=(0,d().K8)((()=>{var e;return null===(e=bt().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),p=(0,d().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore();return null==o?void 0:o.pathIsDead()}),[t]),m=(0,d().K8)((()=>null==s?void 0:s.isLocked()),[s]),{disabled:g,tooltipCopy:S,ariaLabel:h}=function(e){let{hasAutomations:t,isPageInTrash:o,isParentCollectionInTrash:r}=e;const i=!(0,d().O$)(Ke().e),l=(0,n.useMemo)((()=>(r||o)&&!t),[t,o,r]);if(i&&!t)return{disabled:!0,tooltipCopy:xt().A.formatMessage(US.disableAutomationsSettingsButtonOfflineTooltip),ariaLabel:xt().A.formatMessage(US.disableAutomationsSettingsButtonOfflineAriaLabel)};if(l)return{disabled:!0,tooltipCopy:xt().A.formatMessage(US.disableAutomationsSettingsButtonTrashTooltip),ariaLabel:xt().A.formatMessage(US.disableAutomationsSettingsButtonTrashAriaLabel)};return{disabled:!1,tooltipCopy:xt().A.formatMessage(US.openAutomationsSettingsButtonTooltip),ariaLabel:xt().A.formatMessage(US.openAutomationsSettingsButtonAriaLabel)}}({hasAutomations:l,isPageInTrash:c,isParentCollectionInTrash:p}),f=(0,u().IS)((e=>({buttonStyle:(0,NS().j)({theme:e,isInHomeWidget:i}),iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:l?e.icon.uiBluePrimary:e.mediumIconColor}})),[l,i]),y=(0,d().K8)((()=>LS().rc({collectionStore:t.collectionStore()})),[t]),v=(0,n.useCallback)((o=>{(0,Te().SQ)({event:o,context:Te().y$.CollectionAutomationSettingsClick,callback:()=>{const o=t.settingsStore,n=o.state.open,r=(0,GS().S)(o);n&&"automationSettings"===(null==r?void 0:r.type)?x().os({collectionSettingsStore:o}):l||m||c||p||!y?(x().Ow({collectionContextStore:t,collectionSettingsStore:o}),x().R8({collectionSettingsStore:o,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}})):x().js({environment:e,collectionSettingsStore:o,collectionContextStore:t})}})}),[e,t,l,m,c,p,y]);return(0,E.jsx)(jt().A,{renderTooltip:()=>S,render:e=>(0,E.jsx)(At().A,{ariaLabel:h,className:we().Jnf,icon:o(591039).lightningSmallIcon,style:f.buttonStyle,iconStyle:f.iconStyle,hovered:r,onClick:v,disabled:g,...e})})}const US=(0,pt().YK)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTrashTooltip:{defaultMessage:"Can’t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.tooltip"},disableAutomationsSettingsButtonTrashAriaLabel:{defaultMessage:"Can’t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.ariaLabel"},disableAutomationsSettingsButtonOfflineTooltip:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.tooltip"},disableAutomationsSettingsButtonOfflineAriaLabel:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.ariaLabel"}}),qS=n.memo($S);const XS=(0,pt().YK)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}}),YS=n.memo((function(e){const{createFilterSettingsStore:t}=e,r=(0,a().v3)(),{isMobile:i,isPhone:l}=(0,a().Y0)(),s=!(0,d().O$)(Ke().e),c=(0,ee().ET)(),p=(0,d().K8)((()=>t.state.open),[t]),m=(0,d().O$)(c.isInHomeWidgetStore),g=(0,d().K8)((()=>(0,Bo().N1)({collectionContextStore:c,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[c]),S=(0,d().K8)((()=>(0,Bo().I6)(c)),[c]),h=(0,d().K8)((()=>{var e;return s&&"chart"===(null===(e=c.collectionViewStore())||void 0===e?void 0:e.getType())}),[s,c]),f=h?xt().A.formatMessage(mt().AY.unavailableOfflineTooltip):xt().A.formatMessage(XS.filterLabel),y=(0,n.useCallback)((()=>{var e;const n=null===(e=c.collectionViewStore())||void 0===e?void 0:e.id,i=c.isEphemeralView(),a=(0,o(542714).H)(c)?c.currentCombinatorFilterStore.state:void 0,s=c.currentPropertyFiltersStore.state,d=c.filtersBarOpenStore.state;n&&!l&&((0,qd().E)({userId:r.currentUser.id,collectionViewId:n,isOpen:!d}),c.filtersBarOpenStore.setState(d)),m||i?d||s.length>0||a?x().R8({collectionSettingsStore:c.settingsStore,item:{type:"filters"}}):(x().R8({collectionSettingsStore:c.settingsStore,item:{type:"createFilter"}}),hl().Ms(c)):d||s.length>0||a?c.filtersBarOpenStore.setState(!d):(x().R8({collectionSettingsStore:t,item:{type:"createFilter"}}),hl().Ms(c)),(0,v().X)({environment:r,collectionContextStore:c,action:"click_topbar_filter"})}),[c,t,r,m,l]),b=(0,n.useCallback)((()=>{x().os({collectionSettingsStore:t})}),[t]),C=(0,u().IS)((e=>({buttonStyle:(0,NS().j)({theme:e,isInHomeWidget:m}),iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:g?e.icon.uiBluePrimary:e.mediumIconColor},tempFilterIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9},iconContainer:{position:"relative"}})),[m,g]),w=(0,n.useCallback)((()=>f),[f]),k=(0,n.useCallback)((()=>(0,E.jsx)(lu().m$,{context:Ie().Bd.TopbarFilterPopup,collectionContextStore:c,collectionSettingsStore:t,hideDesktopHeader:!0})),[c,t]);return(0,E.jsx)(ks().Ay,{trapFocus:!0,popupType:i?qi().z7.SlideUp:qi().z7.Popup,open:p,placementToOrigin:rS().UV.Bottom,alignmentToOrigin:rS().MY.Start,origin:(0,E.jsx)(jt().A,{renderTooltip:w,render:e=>(0,E.jsxs)("div",{style:C.iconContainer,children:[(0,E.jsx)(At().A,{...e,ariaLabel:f,icon:Ud().$,iconStyle:C.iconStyle,style:C.buttonStyle,onClick:y,disabled:h}),S&&(0,E.jsx)("div",{style:C.tempFilterIndicator})]})}),onDismiss:b,originGap:4,render:k})})),QS={viewBox:"0 0 16 16",svg:(0,E.jsx)("path",{d:"M8 2.115c-.854 0-1.569.554-1.824 1.315a3.96 3.96 0 0 0-2.138 3.518v.895c0 .655-.238 1.287-.669 1.78l-.616.704c-.75.858-.141 2.202 1 2.202H5.89a2.156 2.156 0 0 0 4.218 0h2.139c1.14 0 1.75-1.344.999-2.202l-.616-.704a2.7 2.7 0 0 1-.669-1.78v-.895A3.96 3.96 0 0 0 9.824 3.43 1.92 1.92 0 0 0 8 2.115m-.669 1.839A.68.68 0 0 1 8 3.365c.34 0 .623.253.669.589l.048.353.33.138a2.71 2.71 0 0 1 1.665 2.503v.895c0 .958.348 1.882.978 2.603l.616.704a.078.078 0 0 1-.058.129H3.752a.078.078 0 0 1-.058-.129l.616-.704c.63-.72.978-1.645.978-2.603v-.895c0-1.126.686-2.093 1.665-2.503l.33-.138zM8 13.084c-.394 0-.735-.226-.9-.555h1.8c-.165.33-.506.556-.9.556"})},ZS=(0,Ao().wt)("bellSmall",QS),JS=(0,pt().YK)({followLabel:{defaultMessage:"Follow",id:"collectionViewBlock.action.follow.title"}});function eh(e){let{createFollowSettingsStore:t}=e;const{isMobile:o}=(0,a().Y0)(),r=(0,ee().ET)(),i=(0,u().IS)((e=>({buttonStyle:(0,NS().j)({theme:e,isInHomeWidget:!1}),iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:e.mediumIconColor},iconContainer:{position:"relative"}})),[]),l=(0,n.useMemo)((()=>xt().A.formatMessage(JS.followLabel)),[]),s=(0,d().K8)((()=>t.state.open),[t]),c=(0,n.useCallback)((()=>{x().R8({collectionSettingsStore:t,item:{type:"follow"}})}),[t]),p=(0,n.useCallback)((()=>{x().os({collectionSettingsStore:t})}),[t]),m=(0,n.useCallback)((()=>l),[l]),g=(0,n.useCallback)((()=>(0,E.jsx)(lu().m$,{context:Ie().Bd.TopbarFollowPopup,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0})),[r,t]);return(0,E.jsx)(ks().Ay,{trapFocus:!0,popupType:o?qi().z7.BottomSheet:qi().z7.Popup,open:s,placementToOrigin:rS().UV.Bottom,alignmentToOrigin:rS().MY.Start,origin:(0,E.jsx)(jt().A,{renderTooltip:m,render:e=>(0,E.jsx)("div",{style:i.iconContainer,children:(0,E.jsx)(At().A,{...e,ariaLabel:l,icon:ZS,iconStyle:i.iconStyle,style:i.buttonStyle,onClick:c})})}),onDismiss:p,originGap:4,render:g})}const th=(0,pt().YK)({openFullscreenPageButtonTooltip:{id:"database.collectionViewBlock.openFullscreenPageButton.tooltip",defaultMessage:"Open as full page"}});function oh(e){let{store:t,viewType:r}=e;const i=(0,a().v3)(),l=(0,ee().ET)(),s=(0,d().K8)((()=>(0,kr().Ay)({store:t,fullyQualified:!1,pageVisitSource:To().y8.Expand,demoSettingsStore:OS().A})),[t]),c=(0,u().DP)(),p=(0,d().K8)((()=>{const e=l.isInHomeWidgetStore.state;return(0,NS().j)({theme:c,isInHomeWidget:e})}),[l,c]),m=(0,n.useCallback)((()=>function(e,t){xe().vd(e,"open_collection_as_page",t)}(i,{view_type:r})),[i,r]),g=xt().A.formatMessage(th.openFullscreenPageButtonTooltip);return(0,E.jsx)(jt().A,{renderTooltip:()=>g,render:e=>(0,E.jsx)(At().A,{ariaLabel:g,href:s,onClick:m,icon:o(20643).arrowExpandDiagonalBottomLeftToTopRightSmallIcon,style:p,iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm},...e})})}const nh=n.memo(oh);var rh=()=>o(577097);var ih=()=>o(437800);class lh extends p().default{getInitialState(){return{query:"",limit:20}}}const ah=lh;var sh=()=>o(701513);const ch=(0,pt().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),dh=p().default.createClass(void 0,{name:"ResultStore"});function uh(e){let{collectionViewBlockStore:t,collectionViewType:r,property:i,collectionContextStore:l,onClose:s,onAddPage:c}=e;const u=(0,a().v3)(),p=(0,a().Y0)(),m=(0,d().uB)(void 0,ah),g=(0,d().uB)(void 0,dh),S=(0,d().K8)((()=>m.state.query),[m]),h=(0,d().O$)(g),f=(0,d().K8)((()=>{const{query:e,limit:t}=m.state;return{type:"results",filter:{operator:"and",filters:[{property:i,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[i,m]),y=(0,n.useCallback)((e=>{m.setState({query:e.target.value,limit:gh})}),[m]),v=(0,n.useCallback)((e=>{const t=m.state.limit,o=l.isLoadingStore.state;e<mh&&h&&h.hasMore&&!o&&m.setState({...m.state,limit:t+gh})}),[l,h,m]),x=(0,n.useCallback)((()=>{let e;return e="calendar"===r?p.isMobile?(0,E.jsx)(pt().sA,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,E.jsx)(pt().sA,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,E.jsx)(pt().sA,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),h?h&&0===h.blockIds.length?(0,E.jsx)(Pi().A,{title:e,children:(0,E.jsx)(ws().A,{title:(0,E.jsx)(pt().sA,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,E.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,sections:[{key:"results",render:t=>(0,E.jsx)(Pi().A,{...t,title:e}),items:fh(h.blockIds,l,t,i,c,u,r)}],initialFocus:S?0:void 0}):(0,E.jsx)(Pi().A,{children:(0,E.jsx)(hh,{})})}),[t,r,h,l,i,c,u,S,p.isMobile]);return(0,E.jsxs)(o(981247).Pq,{title:void 0,onCancel:s,desktopWidth:320,children:[(0,E.jsx)(Pi().A,{isInput:!0,children:(0,E.jsx)(Cs().Ay,{placeholder:xt().A.formatMessage(ch.searchPlaceholder),focus:!p.isMobile||void 0,focusAfterAnimation:!0,value:S,onChange:y})}),(0,E.jsx)(bn().A,{id:"no_date_results",reducer:f,collectionContextStore:l,render:x,resultStore:g}),(0,E.jsx)(Xn().A,{onChange:v})]})}const ph=n.memo(uh,No().A),mh=200,gh=20;function Sh(e){let{props:t,store:o,disabled:r,url:i,collectionViewType:l}=e;const s=(0,a().v3)(),c=(0,a().Y0)(),d=n.useRef(null),u=(0,E.jsx)(sh().A,{...t,ref:d,store:o,hidePath:!0,disabled:r,right:void 0!==i?(0,E.jsx)(dr().p,{size:"sm",href:i,disabled:r,onClick:()=>{!function(e){xe().vd(e,"collection_no_date_menu_view")}(s)},children:(0,E.jsx)(pt().sA,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==l||c.isMobile?u:(0,E.jsx)(lt().A,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[ih().up(e.current)]}return[]}(d),analyticsName:"calendar_no_date_item",children:u})}function hh(){return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(to().A,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,E.jsx)(to().A,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function fh(e,t,o,n,r,i,l){const a=e.map((e=>ae().Bv.createChildStore(o,{table:z().ev,id:e}))).filter((e=>!(0,rh().b)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=bt().default.state;if(!o)return;const n=(0,M().wy)({environment:i,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1}),a={key:e.id,render:t=>(0,E.jsx)(Sh,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:l}),action:()=>{e.canEdit()&&(r(e),function(e){xe().vd(e,"collection_no_date_menu_add")}(i))}};return a}));return f().oE(a)}function yh(e){let{noDateTotal:t,noDateProperty:o,collectionViewType:r,timelineViewRef:i}=e;const l=(0,a().v3)(),{isMobile:s}=(0,a().Y0)(),c=(0,ee().ET)(),p=(0,d().K8)((()=>c.collectionViewBlockStore()),[c]),m=(0,n.useCallback)((()=>{(0,v().X)({environment:l,collectionContextStore:c,action:"click_topbar_no_date"})}),[c,l]),g=(0,u().IS)((e=>({buttonStyle:(0,NS().y)({theme:e})})),[]),S=(0,n.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),o=null==i?void 0:i.current;if(!t)return;const{performResult:n}=A().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:l,canUndo:!0,perform:n=>"calendar"===r?(0,sc().$N)({environment:l,store:e,collectionStore:t,collectionContextStore:c,startDayOfWeek:Ce().XX.state,transaction:n}):o?o.addBlockToView({store:e,transaction:n}):void 0});n&&k().td({environment:l,stores:[n]})}),[c,r,l,i]),h=(0,n.useCallback)((e=>p?(0,E.jsx)(ph,{collectionViewBlockStore:p,property:o,onClose:e.close,onAddPage:S,collectionViewType:r,collectionContextStore:c}):null),[c,p,r,o,S]);return!(0,d().O$)(Ke().e)?null:(0,E.jsx)(qi().Ay,{popupType:s?su().n.SlideUp:su().n.Popup,placementToOrigin:qi().sx.Bottom,alignmentToOrigin:qi().yP.Start,originGap:4,render:h,onClick:m,renderOrigin:e=>(0,E.jsx)(dr().p,{isGray:!0,style:g.buttonStyle,...e,children:(0,E.jsx)(pt().sA,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:t>=Di().iY?Di().iY-1+"+":t}})})})}const vh=n.memo(yh),xh={viewBox:"0 0 20 20",svg:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("path",{d:"M10.375 6.775c.345 0 .625.28.625.625v3.15a.625.625 0 1 1-1.25 0V7.4c0-.345.28-.625.625-.625m0 6.775a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,E.jsx)("path",{d:"M4.066 8.914a6.477 6.477 0 0 1 12.859 1.029 3.494 3.494 0 0 1-1.725 6.532H5.121a3.855 3.855 0 0 1-1.056-7.56m6.384-4.14a5.226 5.226 0 0 0-5.2 4.716l-.047.482-.48.075a2.605 2.605 0 0 0 .406 5.178H15.2a2.244 2.244 0 0 0 .853-4.32l-.41-.169.024-.443q.008-.146.008-.293a5.225 5.225 0 0 0-5.225-5.225"})]})},bh=(0,Ao().wt)("cloudExclamation",xh);var Ch=()=>o(449596);const wh=(0,pt().YK)({offlineLabelOneView:{defaultMessage:"The top {numPages} pages are available offline",id:"collectionViewBlock.offlineIndicator.labelOneView"},offlineLabelMultipleViews:{defaultMessage:"The top {numPages} pages in the first view are available offline",id:"collectionViewBlock.offlineIndicator.labelMultipleViews"},lastSyncedOn:{defaultMessage:"Last synced on {date}",id:"collectionViewBlock.offlineIndicator.lastSyncedOn"}});function kh(){const e=(0,ee().ET)(),t=(0,d().O$)(e.isInHomeWidgetStore),o=(0,u().IS)((e=>({iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm},iconContainer:{position:"relative",...(0,NS().j)({theme:e,isInHomeWidget:t})},secondaryText:{color:e.text.secondary}})),[t]),r=(0,d().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.id}),[e]),i=(0,d().K8)((()=>{var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewIds().length)??0}),[e]),l=(0,d().K8)((()=>Fo().default.getConfigKey("offline_query_collection_settings","limit")),[]),a=(0,d().K8)((()=>{var e;return void 0!==r&&"success"===(null===(e=Ch().A.state.offlinePages)||void 0===e||null===(e=e[r])||void 0===e?void 0:e.downloadStatus)}),[r]),s=(0,d().K8)((()=>{var e;return a&&void 0!==r?null===(e=Ch().A.state.offlinePages)||void 0===e||null===(e=e[r])||void 0===e?void 0:e.lastDownloadedAt:void 0}),[r,a]),c=s?xt().A.formatMessage(wh.lastSyncedOn,{date:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(s)}):void 0,p=xt().A.formatMessage(1===i?wh.offlineLabelOneView:wh.offlineLabelMultipleViews,{numPages:l}),m=(0,n.useCallback)((()=>(0,E.jsxs)("div",{style:{width:200},children:[(0,E.jsx)("div",{children:p}),c&&(0,E.jsx)("div",{style:o.secondaryText,children:c})]})),[p,c,o.secondaryText]);return s?(0,E.jsx)(jt().A,{renderTooltip:m,render:e=>(0,E.jsx)("div",{style:o.iconContainer,...e,children:bh(o.iconStyle)}),textWrap:!0}):null}const Ih=n.memo(kh);const Ah=n.memo((function(e){let{store:t,settingsHeaderSizeObserver:r,handleAddItemClick:i,collectionModel:l}=e;const s=(0,a().v3)(),{isMobile:c}=(0,a().Y0)(),p=(0,n.useRef)(null),m=(0,ee().ET)(),g=(0,d().O$)(m.isFullScreenStore),S=(0,d().K8)((()=>m.isMultiSourceView),[m]),h=(0,d().K8)((()=>(0,M().h6)(m)),[m]),f=(0,d().K8)((()=>r.rect.state.width<=Ie().xO),[r]),y=(0,d().K8)((()=>{if(!m.isMultiSourceView)return;const e=m.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:Qt}),[m]),v=(0,L().X)("db_ux_chrome"),b=(0,d().K8)((()=>{if(v)return!!c||!g}),[g,c,f,v]),C=S,w=(0,u().IS)((()=>({buttonWrapper:{...v?{display:"flex",alignItems:"center",justifyContent:"center"}:{},position:"relative",marginLeft:b?4:6,display:"flex"},buttonStyle:{fontSize:14,height:28},mainButtonStyle:b?{width:28}:{},iconStyle:b?{width:15,marginRight:0}:{}})),[v,b]),k=(0,n.useCallback)((e=>{x().Ub({environment:s,handleAddItemClick:i,buttonRef:p,event:e})}),[s,i,p]),I=(0,n.useCallback)((e=>(0,E.jsx)(o(627717).A,{ref:p,title:b?null:h,icon:b?o(280704).b:void 0,color:"blue",onClick:e=>{S?k(e):i(e)},mainButtonTooltip:y===Qt?(0,E.jsx)(pt().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,E.jsx)("br",{})}}):b?h:null,onDropdownClick:e.onClick,style:w.buttonStyle,mainButtonStyle:w.mainButtonStyle,iconStyle:w.iconStyle,className:we().kel,disabled:Boolean(y),disableDropdown:C})),[h,C,i,S,y,k,b,w.buttonStyle,w.iconStyle,w.mainButtonStyle]),A=(0,n.useRef)(null),j=(0,n.useCallback)((e=>(0,E.jsx)(Qe().lC,{collectionContextStore:m,containerRef:A,step:"new_page",children:I(e)})),[m,I]);return(0,E.jsx)(o(108678).m,{store:t,popupType:c?su().n.SlideUp:su().n.Popup,renderOrigin:e=>(0,E.jsx)("div",{style:w.buttonWrapper,ref:A,children:j(e)}),placementToOrigin:qi().sx.Bottom})})),jh={viewBox:"0 0 16 16",svg:(0,E.jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},Rh=(0,Ao().wt)("arrowUpDownSmall",jh),Th=(0,pt().YK)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function Mh(e){let{createSortSettingsStore:t}=e;const o=(0,ee().ET)(),{isMobile:r}=(0,a().Y0)(),i=(0,a().v3)(),l=(0,d().K8)((()=>t.state.open),[t]),s=(0,d().K8)((()=>o.currentSortsStore.state.length>0),[o]),c=(0,d().K8)((()=>(0,Bo().gv)(o)),[o]),p=(0,d().O$)(o.isInHomeWidgetStore),m=(0,n.useCallback)((()=>{const e=o.permissionScopesStore.state.canConfigureBlock?o.currentCombinatorFilterStore.state:void 0,n=o.currentPropertyFiltersStore.state,r=o.filtersBarOpenStore.state,l=s||r||n.length>0||e;p&&x().R8({collectionSettingsStore:o.settingsStore,item:{type:s?"sort":"createSort"}}),l?p||(o.filtersBarOpenStore.setState(!r),s?x().R8({collectionSettingsStore:o.filterBarSortSettingsStore,item:{type:"sort"}}):x().R8({collectionSettingsStore:t,item:{type:"createSort"}})):p||x().R8({collectionSettingsStore:t,item:{type:"createSort"}}),(0,v().X)({environment:i,collectionContextStore:o,action:"click_topbar_sort"})}),[o,t,i,s,p]),g=(0,n.useCallback)((()=>{x().os({collectionSettingsStore:t})}),[t]),S=xt().A.formatMessage(Th.sortLabel),h=(0,u().IS)((e=>({iconStyle:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:s?e.icon.uiBluePrimary:e.mediumIconColor,transform:"rotate(180deg)"},buttonStyle:(0,NS().j)({theme:e,isInHomeWidget:p}),tempSortIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[s,p]);return(0,E.jsx)(ks().Ay,{popupType:r?qi().z7.SlideUp:qi().z7.Popup,placementToOrigin:rS().UV.Bottom,alignmentToOrigin:rS().MY.Start,open:l,origin:(0,E.jsx)(jt().A,{renderTooltip:()=>S,render:e=>(0,E.jsxs)("div",{style:{position:"relative"},children:[(0,E.jsx)(At().A,{...e,ariaLabel:S,icon:Rh,iconStyle:h.iconStyle,style:h.buttonStyle,onClick:m}),c&&(0,E.jsx)("div",{style:h.tempSortIndicator})]})}),onDismiss:g,originGap:4,render:()=>(0,E.jsx)(lu().m$,{context:Ie().Bd.TopbarSortPopup,collectionContextStore:o,collectionSettingsStore:t,hideDesktopHeader:!0}),trapFocus:!0})}const _h=n.memo(Mh);function Ph(){const e=(0,a().v3)(),t=(0,ee().ET)(),r=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:Ro().Wy.medium,color:e.text.secondary},searchIcon:{width:Ao().Ev.sm,height:Ao().Ev.sm,fill:e.mediumIconColor,marginRight:6}})),[]),l=(0,n.useCallback)((()=>{o(932387).su({environment:e,analyticsFrom:"wiki-home-collection-view"}),r&&o(189823).Ay.updateFilters({ancestors:[r]})}),[e,r]);return r?(0,E.jsxs)(dr().p,{style:i.button,onClick:l,children:[(0,KS().u)(i.searchIcon),(0,E.jsx)(pt().sA,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const Bh=n.memo(Ph);const Vh=(0,pt().YK)({feedbackButtonTooltip:{defaultMessage:"Share feedback on using Posts",id:"collectionViewBlock.action.postsFeedback.tooltip"}});function Fh(e){const{theme:t,isInHomeWidget:r}=e,i=(0,a().v3)(),l=xt().A.formatMessage(Vh.feedbackButtonTooltip),s=(0,n.useCallback)((()=>l),[l]);return(0,E.jsx)(jt().A,{renderTooltip:s,render:e=>(0,E.jsx)(dr().p,{...e,ariaLabel:l,icon:o(827744).r,isGray:!0,onClick:()=>{o(110975).f({environment:i,url:"https://notion.notion.site/1caefdeead058012a151c3f764a4135b"})},style:(0,NS().j)({theme:t,isInHomeWidget:Boolean(r),isFeedbackButton:!0}),children:(0,E.jsx)(pt().sA,{defaultMessage:"Feedback",id:"TeamHome.feedback.label"})})})}const Lh=new(le().O2)("MinimizableCollectionViewBlockHeaderActions",(async()=>await o.e(94516).then(o.bind(o,774111)))),Oh=(0,le()._h)(Lh,(e=>e.MinimizableCollectionViewBlockHeaderActions)),Eh=n.memo((function(e){const{allowedActions:t,collectionContextStore:r,createFilterSettingsStore:i,createSortSettingsStore:l,createFollowSettingsStore:s,currentViewType:c,handleAddItemClick:m,headerSizeObserver:g,isFullScreen:S,isInHomeWidget:h,isPlaceholderExternalCollection:f,minimizedActionViewStore:y,settingsHeaderSizeObserver:v,showHoverActionsStore:x,store:b,timelineViewRef:C,containerStyleOverrides:w}=e,k=(0,a().v3)(),{isPhone:I,isMobile:A,isMobileNative:j}=(0,a().Y0)(),R=(0,L().X)("db_ux_chrome"),T=(0,L().X)("db_ux_empty_states"),M=(0,L().X)("download_for_offline"),_=(0,d().K8)((()=>(0,o(300659).D)({isMobileNative:j})),[j]),B=(0,u().DP)(),V=(0,o(556078).S)(),F=(0,d().K8)((()=>r.collectionViewStore()),[r]),O=(0,d().K8)((()=>"view"===o(795756).A.getMode(k,b).permission),[k,b]),D=(0,d().K8)((()=>(0,bo().w6)(k)),[k]),z=(0,d().K8)((()=>({blockId:OS().A.getCurrentStepBlockId(),subStep:OS().A.getCurrentStepSubStep()??""})),[]),K=(0,d().K8)((()=>{const e=V&&V.publicEditModeStore.state.hasPublicPermission;return!(!OS().A.isActiveDemo()||!e)&&(!A&&z.blockId===b.id)}),[z.blockId,A,V,b.id]),H=(0,d().O$)(r.wasCreatedThisSessionStore),W=(0,d().K8)((()=>{const e=r.resultSetStore.state;return((null==e?void 0:e.blockIds.size)??0)<3}),[r.resultSetStore]),G=(0,d().O$)(r.normalizedSchemaStore),[N,$]=(0,n.useState)(!1);(0,n.useEffect)((()=>{H&&W&&Object.keys(G).length<=1||$(!0)}),[N,H,W,G]);const U=(0,d().K8)((()=>(void 0!==r.collectionStore()||"collectionTypedView"===r.contextType)&&!f&&v.rect.state.width>=Ie().xO),[r,f,v]),q=(0,d().K8)((()=>!!K||x.state),[K,x]),X=(0,d().K8)((()=>{const e=g.rect.state;return!A&&e.width>0&&e.width<400}),[A,g.rect]),{isUnlisted:Y,isUnlistedFromSemanticQuery:Q}=(0,d().K8)((()=>{const e=null==F?void 0:F.getUnlistedStatus(),t=!0===(null==e?void 0:e.isUnlisted);return{isUnlisted:t,isUnlistedFromSemanticQuery:t&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}}),[F]),Z=(0,d().K8)((()=>{if(X||S||I||Y||!b.canEditCollection())return null;const e=v.rect.state.width<=Ie().xO;return(0,E.jsx)(o(73771).A,{store:b,isInlineCollection:!0,hideText:e,buttonStyle:{marginLeft:4}})}),[S,I,Y,v.rect,X,b]),J=(0,d().K8)((()=>{const e=v.rect.state.width<=Ie().xO;return(0,E.jsx)(P().GL,{store:b,collectionContextStore:r,v2:!0,hideText:e})}),[v.rect,b,r]),ee=(0,d().K8)((()=>{var e,o;if(!t||t.includes("noDate"))return"timeline"===c?null===(e=r.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by:"calendar"===c?null===(o=r.normalizedQueryStore.state)||void 0===o?void 0:o.calendar_by:void 0}),[t,r.normalizedQueryStore,c]),te=(0,d().uB)(void 0,p().default),oe=(0,d().K8)((()=>{if(ee)return{type:"aggregation",aggregation:{property:ee,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[ee]),ne=(0,d().K8)((()=>{if(oe){const e=te.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[oe,te]),re=(0,d().K8)((()=>{if(!ee||!ne||!U||X||"calendar"!==c&&"timeline"!==c)return null;const e=r.permissionScopesStore.state,t=r.collectionStore();return"collectionTypedView"===r.contextType||t&&e.canEditContent?(0,E.jsx)(vh,{noDateTotal:ne,noDateProperty:ee,collectionViewType:c,timelineViewRef:C}):null}),[r,c,ee,ne,U,X,C]),ie=(0,n.useMemo)((()=>T&&!N||!U||"page"===c||"form_editor"===c||t&&!t.includes("filter")?null:K&&"filter"===z.subStep?(0,E.jsx)(ES().F,{subStep:"filter",step:"demo_collection",children:(0,E.jsx)(YS,{createFilterSettingsStore:i})}):(0,E.jsx)(YS,{createFilterSettingsStore:i})),[T,N,U,c,t,K,z.subStep,i]),le=(0,d().K8)((()=>{if(T&&!N)return null;if(!U||"page"===c||"form_editor"===c||t&&!t.includes("sort"))return null;if("chart"===c){var e,o;const t=null===(e=r.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==t?void 0:t.type)||"results-advanced"!==(null==t||null===(o=t.chartFormat)||void 0===o?void 0:o.mainSort))return null}return K&&"sort"===z.subStep?(0,E.jsx)(ES().F,{subStep:"sort",step:"demo_collection",children:(0,E.jsx)(_h,{createSortSettingsStore:l})}):(0,E.jsx)(_h,{createSortSettingsStore:l})}),[T,N,U,c,t,K,z.subStep,l,r]),ae=(0,d().K8)((()=>T&&!N||!U||"chart"===c||"page"===c||f||!(0,LS().aS)(r)||O||t&&!t.includes("automations")?null:K&&"automations"===z.subStep?(0,E.jsx)(ES().F,{subStep:"automations",step:"demo_collection",children:(0,E.jsx)(qS,{})}):(0,E.jsx)(qS,{})),[T,N,U,c,f,r,O,t,K,z.subStep]),se=(0,d().K8)((()=>{return T&&!N||!U||"form_editor"===c||"chart"===c||X||t&&!t.includes("search")||f?null:"page"===c?null!==(e=r.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,E.jsx)(Bh,{}):null:(0,E.jsx)(WS,{collectionContextStore:r,isFullScreen:Boolean(S),currentViewType:c,topbarIconButtonStyle:(0,NS().j)({theme:B,isInHomeWidget:Boolean(h)})});var e}),[T,N,U,c,X,t,f,r,S,B,h]),ce=(0,d().K8)((()=>{var e;return!U||t&&!t.includes("ai")||f||null!=r&&null!==(e=r.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,E.jsx)(FS().LazyAssistantCollectionViewButton,{collectionContextStore:r})}),[r,f,U,t]),de=(0,n.useMemo)((()=>S||O||t&&!t.includes("fullScreen")?null:(0,E.jsx)(nh,{store:b,viewType:c})),[S,b,c,t,O]),ue=(0,d().K8)((()=>O||t&&!t.includes("viewSettings")||f?null:K&&"settings"===z.subStep?(0,E.jsx)(ES().F,{subStep:"settings",step:"demo_collection",children:(0,E.jsx)(oS().XA,{collectionContextStore:r,settingsHeaderSizeObserver:v,style:(0,NS().j)({theme:B,isInHomeWidget:Boolean(h)})})}):(0,E.jsx)("div",{style:{position:"relative"},children:(0,E.jsx)(oS().XA,{collectionContextStore:r,settingsHeaderSizeObserver:v,style:(0,NS().j)({theme:B,isInHomeWidget:Boolean(h)})})})),[r,h,f,v,B,t,K,z,O]),pe=(0,d().K8)((()=>!D&&U&&null!=t&&t.includes("saveOrOpenOverflow")?(0,E.jsx)(oS().fV,{collectionContextStore:r,shouldHideSaveViewOption:Q}):null),[U,t,r,Q,D]),me=(0,d().K8)((()=>{var e;return"page"===c||"form_editor"===c||"feed"===c||f||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||t&&!t.includes("addItem")?null:(0,E.jsx)(Ah,{store:b,settingsHeaderSizeObserver:v,handleAddItemClick:m,collectionModel:null===(e=r.collectionStore())||void 0===e?void 0:e.getModel()})}),[c,f,r,t,b,v,m]),ge=(0,d().K8)((()=>{var e;return(null===(e=b.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[b]),Se=(0,n.useMemo)((()=>"form_editor"!==c||t&&!t.includes("formActionButtons")||ge?null:(0,E.jsx)(o(546172).Pe,{showCompactDesktopHeader:X,collectionContextStore:r})),[c,t,X,r,ge]),he=(0,d().K8)((()=>null!=t&&t.includes("closeCollectionViewInModal")&&r.isUnlistedViewStore.state?(0,E.jsx)(oS().YL,{}):null),[t,r]),fe=(0,d().K8)((()=>{const e=r.collectionViewStore(),t=r.collectionStore();return!(!e||!t)&&t.getSpaceId()!==e.getSpaceId()}),[r]),ye=(0,d().K8)((()=>fe&&Fo().default.checkGate({gateName:"collections_xws"})),[fe]),ve=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),xe=(0,d().O$)(Ke().e),be=(0,n.useMemo)((()=>xe||!M?null:(0,E.jsx)(Ih,{})),[xe,M]),Ce=(0,n.useMemo)((()=>"feed"===c&&_?(0,E.jsx)(Fh,{theme:B,isInHomeWidget:Boolean(h)}):null),[c,B,h,_]),we=(0,d().K8)((()=>r.databaseType),[r]),ke=(0,n.useMemo)((()=>T&&!N?null:U&&"feed"===c&&_?we?null:(0,E.jsx)(eh,{createFollowSettingsStore:s}):null),[c,s,_,T,N,U,we]),Ae=(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(zS,{}),Ce,be,ye&&(0,E.jsx)(Du,{type:"linkedView"}),Z,J,oe&&(0,E.jsx)(bn().A,{id:"no_date_count",collectionContextStore:r,reducer:oe,resultStore:te}),re,ke,ie,le,ae,ce,se,de,ue,pe,me,Se,he]}),je=(0,u().IS)((()=>({container:R?{height:"100%",flexGrow:1}:{}})),[R]);return I?(0,E.jsxs)(kt().A,{visible:q,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,E.jsx)(zS,{}),be,ye&&(0,E.jsx)(Du,{type:"linkedView"}),de,ue,me,Se,pe]}):(0,E.jsx)("div",{style:{...je.container,...w},children:R&&!A?(0,E.jsx)(Oh,{settingsHeaderSizeObserver:v,isFullScreen:S,collectionContextStore:r,viewSettingsButton:ue,minimizedActionViewStore:y,children:Ae}):(0,E.jsx)(kt().A,{visible:q,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},onMouseDown:ve,children:Ae})})}));var Dh=function(e){return e[e.TabBar=0]="TabBar",e[e.Source=1]="Source",e[e.None=2]="None",e}(Dh||{});function zh(e){const{currentViewType:t,store:o,isFullScreen:r,hideViewTabBar:i,collectionViewHeaderText:l,headerActionsBehavior:s,allowedActions:c,isInHomeWidget:m,isMyTasksPage:g,isHomeCustomDbPage:S,showHoverActionsStore:f,headerSizeObserver:y,isPlaceholderExternalCollection:v,handleEditorMouseDown:b,handleHeaderMouseMove:C,handleHeaderMouseLeave:w,handleHeaderMount:k,handleSettingsHeaderMount:I,leftRightPaddingStore:A,headerHeightStore:j,canEdit:R,contentSizeObserver:T,settingsHeaderSizeObserver:_,viewSettingsPlacementStore:P,showOnlyCurrentView:B,switchViewMetric:V,handleAddItemClick:F,timelineViewRef:O,createFilterSettingsStore:z,filterBarCreateFilterSettingsStore:K,headerWrapStyle:H,headerRef:W,headerStyleOverrides:G,minimizedActionViewStore:N,createFollowSettingsStore:$}=e,U=(0,L().X)("db_ux_chrome"),q=(0,a().v3)(),X=(0,ee().ET)(),Y=(0,fe().Zp)(),Q=(0,d().K8)((()=>X.collectionStore()),[X]),Z=(0,d().uB)(void 0,p().default),J=(0,d().K8)((()=>{if(g){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[g]),te=(0,d().uB)(void 0,p().default),oe=(0,d().K8)((()=>{if(S)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[S]),ne=(0,d().uB)(void 0,De().A),re=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"}));(0,n.useEffect)((()=>{x().d9({environment:q,collectionContextStore:X})}),[q,X]);const ie=(0,d().K8)((()=>{const e=X.viewIsFlushToTopbar();return("timeline"===t||"table"===t)&&e||m||X.isUnlistedViewStore.state||U}),[X,t,U,m]),le=(0,d().K8)((()=>A.state),[A]),ae=(0,d().K8)((()=>j.state),[j]),se=(0,d().K8)((()=>{var e;return null===(e=X.viewsModuleContextStore)||void 0===e?void 0:e.isInLayoutBuilder()}),[X.viewsModuleContextStore]),ce=(0,d().K8)((()=>o.isNonEditableState()),[o]),de=(0,d().K8)((()=>{var e;return U||"viewsMain"===(null===(e=X.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())}),[X.viewsModuleContextStore,U]),ue=Se({collectionContextStore:X,previewContext:Y,isPlaceholderExternalCollection:v}),pe=(0,n.useCallback)((e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:n}=e;if(t.id!==o.id&&!n){const e=t.getType(),n=o.getType();if(e&&n){var r;if(V)V.current={from:e,to:n,metric:Ve().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(r=X.remoteResultStore.state)||void 0===r?void 0:r.sizeHint};"form_editor"===e&&X.isClientModeEnabledStore.setState(!1),"form_editor"===n&&x().os({collectionSettingsStore:X.settingsStore})}}}),[X.isClientModeEnabledStore,X.remoteResultStore,X.settingsStore,V]),me=(0,d().K8)((()=>{var e;return(null===(e=X.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[X]),ge=(0,d().K8)((()=>MS(X,v,Y,B)),[X,v,Y,B]),he=(0,n.useMemo)((()=>({showMoreViewsButton:!1,showAddViewButton:ge,addViewButtonAnimatedIn:!0,viewSelectState:"allTabVisible",moreViewsCount:0})),[ge]),ye=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),ve=(0,n.useMemo)((()=>(0,E.jsx)(mS,{renderState:he,collectionContextStore:X,preventRectangularSelection:ye,variant:"default"})),[X,ye,he]),xe=(0,n.useMemo)((()=>i?Dh.None:U&&1===(null==me?void 0:me.length)&&!r&&ue?Dh.Source:Dh.TabBar),[i,U,me,ue,r]),be=(0,d().K8)((()=>Boolean(null==Q?void 0:Q.isSyncedCollection())),[Q]),Ce=(0,d().K8)((()=>be&&xe===Dh.Source),[be,xe]),we=(0,u().IS)((e=>{let t;return t=ie?{}:se?{boxShadow:`0 0.5px 0 ${e.stroke.uiBlueSecondary}`,marginBottom:.5}:{boxShadow:`0 1px 0 ${e.tableDividerColor}`,marginBottom:1},{headerPositioningStyle:{left:null==le?void 0:le.paddingLeft,paddingLeft:m?Le().Fq:void 0,width:"100%"},headerStyle:{display:"flex",alignItems:Ce?"flex-start":"center",...Ce?{}:{height:ae},...t,left:null==le?void 0:le.paddingLeft,paddingLeft:m?Le().Fq:void 0,width:"100%",...G},selectableStyle:{position:"relative"},headerActionsStyle:{...Ce&&{marginTop:6}}}}),[ae,G,ie,m,se,null==le?void 0:le.paddingLeft,Ce]),ke=(0,n.useMemo)((()=>{switch(xe){case Dh.TabBar:return(0,E.jsx)(TS,{collectionContextStore:X,showHoverActionsStore:f,isPlaceholderExternalCollection:v,showOnlyCurrentView:B??!1,onViewClick:pe,disabled:g,variant:de?"pills":"default"});case Dh.Source:return(0,E.jsx)(D,{store:o,collectionContextStore:X,isFullScreen:r,showHoverActionsStore:f,canEdit:R,addViewButton:ve});case Dh.None:return null}}),[xe,ve,X,f,v,B,pe,g,de,o,r,R]),Ie=(0,n.useMemo)((()=>"hidden"===s?null:(0,E.jsx)(Eh,{showHoverActionsStore:f,isFullScreen:r,store:o,currentViewType:t,collectionContextStore:X,isPlaceholderExternalCollection:v,settingsHeaderSizeObserver:_,createFilterSettingsStore:z,createSortSettingsStore:re,createFollowSettingsStore:$,isInHomeWidget:m,handleAddItemClick:F,headerSizeObserver:y,timelineViewRef:O,allowedActions:c,minimizedActionViewStore:N,containerStyleOverrides:we.headerActionsStyle})),[s,f,r,o,t,X,v,_,z,re,$,m,F,y,O,c,N,we.headerActionsStyle]);return(0,E.jsxs)(rt().s,{allowSelectionWithin:!0,style:H,onMouseDown:b,onMouseMove:C,onMouseLeave:w,ref:(0,h().Px)(k,W),children:[r&&(0,E.jsx)(cS,{currentViewType:t,headerSizeObserver:y,contentSizeObserver:T,settingsHeaderSizeObserver:_,headerHeightStore:j,viewSettingsPlacementStore:P,store:o,leftRightPaddingStore:A,isInHomeWidget:m,headerRef:W}),le&&(0,E.jsxs)(lt().A,{store:o,shouldShowCopyLinkButton:ce,analyticsName:(0,M().LI)(t),style:we.selectableStyle,shouldShowHalo:!(r||m||null!=Y&&Y.isPreviewing),children:[(0,E.jsxs)("div",{style:we.headerStyle,ref:I,children:[ke,l,Ie]}),J&&(0,E.jsx)(bn().A,{id:"tasks_results",collectionContextStore:X,reducer:J,resultStore:Z}),oe&&(0,E.jsx)(bn().A,{id:"custom_db_results",collectionContextStore:X,reducer:oe,resultStore:te})]}),(0,E.jsxs)("div",{style:we.headerPositioningStyle,dir:"ltr",children:[ue&&!U&&(0,E.jsx)(D,{store:o,collectionContextStore:X,isFullScreen:r,showHoverActionsStore:f,canEdit:R}),(0,E.jsx)(BS,{collectionContextStore:X}),(0,E.jsx)(Kh,{collectionContextStore:X,showHoverActionsStore:f,filterBarCreateFilterSettingsStore:K,saveControlMoreActionsButtonPopupStore:ne,currentViewType:t,isInHomeWidget:m})]})]})}function Kh(e){let{collectionContextStore:t,showHoverActionsStore:o,filterBarCreateFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r,currentViewType:i,isInHomeWidget:l}=e;const s=(0,a().v3)(),c=(0,a().WS)(),u=(0,d().K8)((()=>(0,bo().J9)(s)),[s]),p=(0,d().O$)(t.filtersBarOpenStore),m=(0,d().O$)(t.shouldShowSourceStore),g=(0,d().O$)(t.completeSprintButtonContextStore),S=m?8:12;return"page"===i||"form_editor"===i||"feed"===i&&(u||c)||l?null:p?(0,E.jsx)(hS().N9,{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r}):g?(0,E.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:c?12:8,paddingTop:S},children:[(0,E.jsx)("div",{style:{flex:1}}),(0,E.jsx)(_S().A,{collectionContextStore:t})]}):null}var Hh=()=>o(484844),Wh=()=>o(218508);const Gh={formula:{initialResult:"collections_formula_initial_result_duration",mountToFirstResult:"collections_formula_mount_to_first_result"},relation:{initialResult:"collections_relation_initial_result_duration",mountToFirstResult:"collections_relation_mount_to_first_result"},rollup:{initialResult:"collections_rollup_initial_result_duration",mountToFirstResult:"collections_rollup_mount_to_first_result"}};function Nh(){return{formula:(0,L().X)("formulas_enable_clientside_metrics"),relation:(0,L().X)("relation_enable_clientside_metrics"),rollup:(0,L().X)("rollup_enable_clientside_metrics")}}const $h=Symbol("DONE_WITH_INITIAL_RENDER");function Uh(e){const{collectionContextStore:t}=e,o=function(e){const{collectionContextStore:t,mountedBeforeInitialPageRender:o}=e,r=(0,a().v3)(),i=(0,n.useRef)(new(Wh().G)((()=>({done:!1,didTrackFirstResult:!1,pageIdToStatus:new Map})))),s=Nh();return{trackMount:(0,n.useCallback)((e=>{let{pageId:t,propertyId:o,propertyType:n}=e;if(!s[n])return;const r=i.current;if(r===$h)return;const l=r.get(o);if(l.done)return;const a=performance.now();l.pageIdToStatus.has(t)||l.pageIdToStatus.set(t,{mountTime:a,gotFirstResult:!1}),(0,y().O9)(l.earliestMountTime)||(l.earliestMountTime=a)}),[s]),trackResult:(0,n.useCallback)((e=>{let{pageId:n,propertyId:a,propertyType:c,endTime:d,context:u}=e;if(!s[c])return;const p=i.current;if(p===$h)return;const m=p.get(a);if(m.done)return;const{initialResult:g,mountToFirstResult:S}=Gh[c],h=m.pageIdToStatus.get(n);if(!h)return void(0,Hh().NK)(`Property result duration performance entry for ${n}/${a} not found`);const v=f().Bj((()=>({...(0,ke().kz)(t),is_navigation:!o,...u})));m.didTrackFirstResult||(m.didTrackFirstResult=!0,(0,y().O9)(m.earliestMountTime)?Ve().default.measure({metricName:S,startTime:m.earliestMountTime,endTime:d},{environment:r,shouldSendIfStatsigNotInitialized:!0,data:v()}):(0,Hh().NK)(`Missing earliestMountTime for property ${a}`)),h.gotFirstResult||(h.gotFirstResult=!0,Ve().default.measure({metricName:g,startTime:h.mountTime,endTime:d},{environment:r,shouldSendIfStatsigNotInitialized:!0,data:v()})),l().default.afterNextFlush((()=>{m.didTrackFirstResult&&[...m.pageIdToStatus.values()].every((e=>e.gotFirstResult))&&p.set(a,{done:!0}),[...p.values()].every((e=>e.done))&&(i.current=$h)}))}),[t,s,r,o])}}(e);return(0,s().w)((()=>{t.propertyResultDurationTracker||(t.propertyResultDurationTracker=o)})),null}function qh(e){const t=Nh();return n.useMemo((()=>Object.values(t).some((e=>e))),[t])?(0,E.jsx)(Uh,{...e}):null}var Xh=()=>o(809226),Yh=()=>o(387232);function Qh(e,t,o,n){return{render_started_at:o.cvbBlockRenderStart,mounted_at:o.cvbBlockRenderMount,items_started_at:o.itemsStart,items_visible:o.itemsVisible,query_request_count:t.queryCollectionRequests.length,query_request_times:t.queryCollectionRequests,collection_reducer_request_count:Object.keys(t.collectionReducerRequests).length,collection_reducer_request_times:Object.values(t.collectionReducerRequests),collection_prefetch_processing_time:Yh().X.getProcessingTime(),page_origin_time:(0,Ve().getPageOriginOrPrewarmedTabAppStartTime)(e),cvb_bundle_timing:Zh(),lazy_render_started_at:n}}function Zh(){const e=oS().H6.CollectionViewBlock.getLoadingMetrics();if(null!=e&&e.resolvedAt&&null!=e&&e.startedAt)return{started_at:e.startedAt,resolved_at:e.resolvedAt,duration_ms:e.resolvedAt-e.startedAt}}var Jh=()=>o(876359);class ef extends p().default{getInitialState(){return{stage:"NOT_TRACKING"}}}function tf(e,t,o,r,i,s){const c=(0,a().v3)(),u=(0,d().uB)(void 0,ef),p=(0,n.useRef)(0),m=(0,n.useRef)(t),g=(0,n.useRef)(),S=(0,n.useRef)(void 0),h=(0,n.useRef)(void 0),f=(0,n.useRef)(!0),v=(0,n.useRef)(!1),x=(0,n.useCallback)((()=>{"NOT_TRACKING"===u.state.stage&&(u.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),S.current=performance.now())}),[u]),b=(0,n.useCallback)((e=>{"NOT_TRACKING"===u.state.stage&&(u.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(g.current=e))}),[u]),C=(0,n.useCallback)((()=>{if(o.current)return;const t=u.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(p.current++,1===p.current){const e=performance.now();l().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===u.state.stage&&u.setState({stage:"SHOULD_TRACK",endTime:e,source:u.state.source})}))}}else"NOT_TRACKING"===t&&f.current&&(f.current=!1,Ve().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:c,data:ke().ax({environment:c,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:v.current,isPrewarmedTab:(0,Me().isPrewarmedTabInitialRender)(c),cvbLoadingStateOnInitialRender:i})}))}),[e,o,c,u,i]),w=(0,n.useCallback)((()=>{h.current||(h.current=performance.now())}),[]),k=(0,n.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===u.state.stage&&(v.current=!0,e.isEmptyStore.removeListener(k),C())}),[e.isEmptyStore,C,u]),I=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,Me().isPrewarmedTabInitialRender)(c),a=o?We().A.state.prewarmedTabAppStartTimeOverride:void 0,d=ke().ax({environment:c,collectionContextStore:e,visibleItemsCount:p.current||0,wasInitialRenderEmpty:v.current,isPrewarmedTab:o,cvbLoadingStateOnInitialRender:i}),u=c.RouterStore.state.route,f="page"===u.name&&u.blockId?me().Ob.lookupViewIds(u.blockId).length:0;if("INITIAL"===t.state.source){var n,l;const i=(0,Pe().A)(null===(n=e.collectionViewStore())||void 0===n?void 0:n.id),u=null===(l=c.prefetchCache)||void 0===l?void 0:l.getPrefetchAnalytic(i),p={cvbBlockRenderStart:m.current,cvbBlockRenderMount:S.current,itemsStart:h.current,itemsVisible:t.state.endTime},g=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:a}=We().A.state.subMetricsStore.state,s=t=>{let{startTime:o,endTime:n}=t;if(e.isPrewarmedTab){if(n<=e.prewarmedTabNavigationStart)return 0;if(o<e.prewarmedTabNavigationStart&&n>e.prewarmedTabNavigationStart)return n-e.prewarmedTabNavigationStart}return n-o};return o&&a&&(l["collections.await_page_chunk_end_to_cvb_start"]=s({startTime:a.endTime,endTime:o}),(0,Jh().f)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:a.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=s({startTime:o,endTime:n}),(0,Jh().f)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=s({startTime:n,endTime:r}),(0,Jh().f)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=s({startTime:r,endTime:i}),(0,Jh().f)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(o&&"number"==typeof a?{subMetricsTimes:p,isPrewarmedTab:!0,prewarmedTabNavigationStart:a}:{subMetricsTimes:p,isPrewarmedTab:!1}),y={...d,sub_metrics:g,initial_render_timings:Qh(c,e.timingTracker.finishTracking(),p,null==s?void 0:s.current),includes_page_origin_to_app_start:!0};r&&Ve().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:c,data:y,shouldSendIfStatsigNotInitialized:!0}),m.current&&(Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:c,data:y,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==u?void 0:u.type)&&void 0!==u.finished_at&&u.finished_at>m.current&&Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:m.current,endTime:u.finished_at},{environment:c,data:d}),(y.is_full_screen||1===f)&&Xh().u4({name:"database_visit",args:{database_visit_id:y.database_visit_id}}))}else if("NAVIGATION"===t.state.source){if(g.current){const e={...d,wasm_sqlite_initialized:We().A.state.metricDataStore.state.wasm_sqlite_initialized,...$e().A.getDatabaseNavigationMetrics(g.current)};Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:g.current,endTime:t.state.endTime},{environment:c,data:e})}m.current&&(Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:c,data:d}),(d.is_full_screen||1===f)&&Xh().u4({name:"database_visit",args:{database_visit_id:d.database_visit_id}}))}else(0,y().ub)(t.state.source);t.setState({stage:"COMPLETED"}),p.current=0}}),[e,o,c,r,i,s]);return(0,n.useEffect)((()=>(u.addListener(I),()=>{u.removeListener(I)})),[I,u]),(0,n.useEffect)((()=>(e.isEmptyStore.addListener(k),()=>{e.isEmptyStore.removeListener(k)})),[e.isEmptyStore,k]),{handleInitialDatabaseRender:x,handleNavigationDatabaseRender:b,handleItemMount:C,handleItemsRenderStart:w}}function of(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,mountedBeforeInitialPageRender:r,cvbLoadingStateOnInitialRender:i,lazyRenderStartedAtRef:l}=e,{handleInitialDatabaseRender:a,handleNavigationDatabaseRender:s,handleItemMount:c,handleItemsRenderStart:d}=tf(t,o,n,r,i,l);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:a,handleNavigationDatabaseRender:s,handleItemMount:c,handleItemsRenderStart:d}),null}const nf=n.memo(n.forwardRef((function(e,t){const{store:P,isFullScreen:z,productUseCase:K,viewsModuleContext:H,overrideViewType:W,headerActionsBehavior:G="default",overridePaddingLeft:N,overridePaddingRight:$,fullWidth:U,headerText:q,hideViewTabBar:X,headerAllowedActions:Y,maxHeight:Q,disabled:Z,forceLocalQueryCollection:J=!1,isUnlistedView:te,viewId:oe,onMount:ne,setCollectionContextStore:re,showOnlyCurrentView:ie,additionalCollectionViewInnerHorizontalPadding:se,templatePickerMenuListStore:ce,mountedBeforeInitialPageRender:ue,cvbLoadingStateOnInitialRender:pe,lazyRenderStartedAtRef:Ze,editorContentContainerRef:Je}=e,et=(0,u().DP)(),tt=(0,a().WS)(),ot=(0,n.useRef)(null),st=(0,a().v3)(),ct=(0,fe().Zp)(),dt=(null==ct?void 0:ct.isPreviewing)??!1,ut=(0,n.useMemo)((()=>new(ze().A)(st)),[st]),pt=(0,n.useContext)(ye().R),{didDelayOffscreenRenderRef:mt}=function(e){let{collectionContextStore:t,isFullScreen:r,rootRef:i}=e;const l=(0,n.useRef)(r),a=(0,n.useRef)(!1),s=(0,d().K8)((()=>o(236631).Ay.isOpen()),[]);return(0,n.useEffect)((()=>{if(!i.current)return;if(l.current)return;if(s)return l.current=!0,void t.shouldDelayRenderStore.setState(!1);if(!i.current.parentElement)return;const e=new IntersectionObserver((o=>{const n=!o.reduce(((e,t)=>t.time>e.time?t:e),o[0]).isIntersecting;n?a.current=!0:(l.current=!0,e.disconnect()),t.shouldDelayRenderStore.setState(n)}));return e.observe(i.current.parentElement),()=>e.disconnect()}),[t,s,i]),{didDelayOffscreenRenderRef:a}}({collectionContextStore:ut,isFullScreen:z,rootRef:ot}),gt=(0,d().uB)(void 0,o(744011).A),St=(0,n.useMemo)((()=>new(qe().E)),[]),ht=(0,n.useMemo)((()=>new(qe().E)),[]),ft=(0,n.useMemo)((()=>new(qe().E)),[]),yt=(0,n.useRef)(null),vt=(0,n.useRef)(),xt=(0,n.useRef)(null),[bt]=(0,n.useState)((()=>performance.now())),Ct=(0,n.useRef)(new Map),wt=(0,n.useRef)(),kt=(0,L().X)("query_collection_schema_change"),It=(0,n.useRef)(null);It.current||(It.current=new nt(ut,st)),(0,n.useEffect)((()=>{ut.previewContextStore.setState(ct)}),[ct,ut]),(0,n.useEffect)((()=>{const e=It.current;return async function(){const{createHasSchemaChangedForQueryStore:t}=await ge.load();ut.hasSchemaChangedForQueryStore=t(ut),kt&&(null==e||e.subscribeToSchemaChanges(ut.hasSchemaChangedForQueryStore))}(),()=>{null==e||e.unsubscribeFromSchemaChanges()}}),[It,ut,kt]);const At=(0,n.useRef)(),jt=(0,n.useRef)(),Rt=(0,d().K8)((()=>ut.collectionStore()),[ut]),[Tt,Mt]=(0,n.useState)(!1),[_t,Pt]=(0,n.useState)(!1),[Bt,Vt]=(0,n.useState)(!1),Ft=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),Lt=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createFollowSettingsStore"})),Ot=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Et=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),Dt=(0,d().uB)(void 0,p().default.createClass(void 0,{name:"viewSettingsPlacementStore"})),zt=(0,d().uB)(void 0,De().A);(0,o(235786).b)(ut);const Kt=(0,d().K8)((()=>ut.collectionViewStore()),[ut]),Wt=(0,n.useCallback)((()=>{var e;return W??(null===(e=ut.collectionViewStore())||void 0===e?void 0:e.getType())}),[W,ut]),Gt=(0,d().r6)((()=>(0,V().cq)(P)),[P]),Nt=(0,d().O$)(Gt),$t=(0,d().O$)(ut.isInHomeWidgetStore),{isViewModule:Ut}=(0,d().K8)((()=>{const e=ut.viewsModuleContextStore;return{isViewModule:Boolean(e.getViewModuleType())}}),[ut]),qt=(0,d().K8)((()=>(0,V().RX)(P)),[P]),Xt=(0,d().r6)((()=>{const e=(0,Oe().Uh)(st)-B().x6;if(qt&&!z&&!(0,B().Ck)(P,void 0,st)&&e>0&&!$t)return e/2}),[st,qt,z,P,$t]),Yt=(0,d().O$)(Xt),Qt=(0,d().K8)((()=>{var e;return(null===(e=yt.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[yt]),Zt=(0,n.useCallback)((e=>{var t,o;if(ut.isInHomeWidgetStore.state)return;const n=ut.normalizedFormatStore.state,r=null===(t=Qt.current)||void 0===t?void 0:t.clientWidth;ut.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==yt||null===(o=yt.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:Xt.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[ut,Qt,Xt]),Jt=(0,d().K8)((()=>P.isRootOrDirectChild()),[P]),eo=(0,d().K8)((()=>(0,he().dC)(st,P)),[st,P]),to=(0,d().r6)((()=>{const e=Wt(),t=(0,M().l0)({environment:st,store:P,isFullScreen:z,sizeObserver:St,viewType:e,collectionContextStore:ut});return t&&void 0!==N&&(t.paddingLeft=N),t&&void 0!==$&&(t.paddingRight=$),t&&Jt&&eo&&(0,B().Ck)(P,void 0,st)&&"page"!==e&&(t.paddingRight+=he().Qb),t}),[st,P,z,St,Wt,ut,N,$,Jt,eo]);(0,d().O$)(to);const oo=(0,n.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(152058).p)(t)&&Vt(!0)}),[Vt]),no=(0,n.useCallback)((()=>{Vt(!1)}),[Vt]),ro=(0,n.useCallback)((()=>{He().A.state||Mt(!0)}),[Mt]),io=(0,n.useCallback)((()=>{Mt(!1)}),[Mt]),lo=(0,n.useCallback)((()=>{var e,t;if($t)return;const o=null===(e=yt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=ut.frozoneStore.state.scrollerWidth,r=null===(t=yt.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=ut.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=ut.collectionViewStore(),a=ut.normalizedFormatStore.state;ut.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:Xt.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,a),tryShowHiddenFrozenColumn:!1})))}),[ut,yt,Xt,$t]),ao=(0,n.useCallback)((()=>{var e,t;const o=null===(e=yt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=to.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==ut.frozoneStore.state.isScrolled&&(ut.frozoneStore.setState({...ut.frozoneStore.state,isScrolled:r}),lo())}),[ut,lo,to]),so=(0,n.useRef)(!1);!function(e){let{environment:t,collectionContextStore:o}=e;const r=(0,n.useCallback)((e=>{e.state.online||(0,R().M)(t,o,{src:"initial_load"})}),[t,o]);(0,s().l)((()=>{Ke().A.state.online&&Ke().A.addListener(r)})),(0,c().X)((()=>{Ke().A.removeListener(r)}))}({environment:st,collectionContextStore:ut}),(0,d().K8)((()=>{var e;const t=ut.collectionViewStore(),n=ut.collectionStore(),r=st.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,a=P.getCollectionViewStores(),s=a.map((e=>e.id)),c=null!==(e=a[0])&&void 0!==e&&e.isDefined()?a[0]:void 0,d=P.id,u=g().K.get({userId:r,key:(0,je().H6)(d)});let p;const m=e=>!!te||(!!s.includes(e)||"collectionSettings"===ut.contextType);if(oe&&m(oe)?p=oe:t&&m(t.id)?p=t.id:u&&m(u)?p=u:c&&m(c.id)&&(p=c.id),p){const e=ae().pS.createChildStore(t??P,{table:o(289765).Gy,id:p});if(e.isDefined()){p!==u&&g().K.set({userId:r,key:(0,je().H6)(d),value:p});const t=e.getCollectionStore();e&&(!so.current||p!==i||t&&t.id!==l)&&(so.current=!0,ut.forceLocalQueryCollection=J,(0,o(72813).d)({environment:st,collectionViewBlockStore:P,collectionViewStore:e,collectionStore:t,collectionContextStore:ut,isFullScreen:z??!1,productUseCase:K,isRootChild:P.isRootOrDirectChild(),isInPeekRenderer:Nt,viewsModuleContext:H}))}}}),[P,ut,st,z,K,Nt,H,J,te,oe]);const{frozenIndex:co,tableFrozenColumnIndex:uo}=(0,d().K8)((()=>({frozenIndex:ut.frozoneStore.state.frozenIndex,tableFrozenColumnIndex:null==Kt?void 0:Kt.getTableFrozenColumnIndex(ut.frozoneStore.state.scrollerWidth,ut.normalizedFormatStore.state)})),[ut.frozoneStore,ut.normalizedFormatStore,Kt]);(0,n.useEffect)((()=>{void 0===co&&Kt&&Zt(Kt)}),[ut,Kt,co,Zt]);const po=(0,n.useRef)(!1);(0,n.useEffect)((()=>(po.current=!0,()=>{po.current=!1})),[]);const mo=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(mo.current){const e=Wt();e&&(i().A.withListenerIgnored((()=>{const t=ut.collectionStore(),o=ut.collectionViewStore(),n=null==o?void 0:o.getChartType(),r=null==o?void 0:o.getChartPlaceholderType();(0,xe().vd)(st,"database_visit",{collection_id:null==t?void 0:t.id,collection_view_id:null==o?void 0:o.id,collection_view_block_id:P.id,type:e,is_full_screen:z,is_peek:Gt.state,peek_mode:O().default.state.mode,database_visit_id:ut.visitSessionId,chart_type:"placeholder"===n?r:n,is_chart_placeholder:"placeholder"===n})})),mo.current=!1)}}),[]);const{value:go}=(0,le().fJ)(ve().T.formulas);(0,n.useEffect)((()=>{(0,y().O9)(go)&&ut.formulasCodeStore.setState(go)}),[go,ut.formulasCodeStore]),(0,n.useEffect)((()=>{be(st)}),[st]),(0,n.useEffect)((()=>{i().A.withListenerIgnored((()=>{const e=ut.collectionViewStore();if(e&&"collectionTypedView"===ut.contextType){const t=ut.databaseType,n=Wt();t&&n&&(0,xe().WU)(st,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:P.id,type:n,databaseType:t,is_my_tasks:(0,o(520969).NY)("myTasks")===P.id})}}))}),[]),(0,n.useEffect)((()=>{const e=Ve().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:st,getData:()=>({...(0,ke().kz)(ut),is_first_render:mo.current})})})),jt.current&&i().A.withListenerIgnored((()=>{if(!jt.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=jt.current;Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:st,getData:()=>{const o=(0,ke().kz)(ut),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:ut.isLoadingStore.state,row_count_category:(0,ke().Cu)(n),...l}}}),jt.current=void 0})),(0,n.useEffect)((()=>{const e=()=>{if(!ut.isLoadedStore.state||!po.current||ut.wasCreatedThisSessionStore.state||ut.didFireLoadEventsStore.state)return;ut.didFireLoadEventsStore.setState(!0);const e=st.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const n=ut.isFullScreenStore.state;if(n){var i;const e=null===(i=ut.collectionViewStore())||void 0===i?void 0:i.getType();if(!We().A.state.initialRenderCompleted&&ue){var l;o(601661).setInitialRenderCompleted(),r().oh.hackyOffsetParsesCorrectly()||(0,xe().vd)(st,"luxon_hacky_offset_parses_correctly_false");const i=()=>{var n,r;const i=(0,ke().kz)(ut),l=ut.collectionViewStore(),a=null==l?void 0:l.id,s=(0,Pe().A)(a),c=ut.requestBackend;return{...i,is_push:(null===(n=t)||void 0===n?void 0:n.isPush)??!1,collectionViewType:e,initial_route:st.RouterStore.state.initialRoute.name,prefetchCache:null===(r=st.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic(s))||void 0===r?void 0:r.type,cvb_loading_state:pe,wasm_sqlite_initialized:We().A.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(527589).A)(),collection_request_backend:c,sub_metrics:Me().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};Ve().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:st,getData:i,shouldSendIfStatsigNotInitialized:!0});const c=oS().H6.CollectionViewBlock.getLoadingMetrics();var a,s;if(null!=c&&c.startedAt)Ve().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:c.startedAt,endTime:c.resolvedAt},{environment:st,data:{did_prefetch:"hit-match"===(null===(a=st.prefetchCache)||void 0===a||null===(a=a.getPrefetchAnalytic((0,Pe().A)(null===(s=ut.collectionViewStore())||void 0===s?void 0:s.id)))||void 0===a?void 0:a.type),is_full_screen:n}});null===(l=ut.databaseItemsVisibleTracker)||void 0===l||l.handleInitialDatabaseRender()}else{var c;const t=$e().A.popTimings(),o=()=>({...(0,ke().kz)(ut),wasm_sqlite_initialized:We().A.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:e,...$e().A.getDatabaseNavigationMetrics(null==t?void 0:t.navigationStart)});t&&Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:t.navigationStart},{environment:st,getData:o}),Ne().A.state.isMeasuring&&Ne().A.update((e=>({...e,isMeasuring:!1}))),null===(c=ut.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(null==t?void 0:t.navigationStart)}}else{var d,u;if(ue)null===(d=ut.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender();else null===(u=ut.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender()}};return ut.isLoadedStore.addListener(e),e(),()=>{ut.isLoadedStore.removeListener(e)}}),[ut,st,ue,pe]),(0,d().K8)((()=>{for(const t of P.getCollectionViewStores())t.getValue();const e=ut.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[P,ut]),(0,n.useEffect)((()=>{const e=()=>!O().default.isCenterPeekOpen()&&Ue().A.state.isVisible,t=()=>{var t;e()&&(null===(t=It.current)||void 0===t||t.maybeProcessQueuedCollectionEmit("page_show"))},o=()=>{var t;e()&&(null===(t=It.current)||void 0===t||t.maybeProcessQueuedCollectionEmit("exit_peek"))};return Ue().A.addListener(t),O().default.addListener(o),()=>{Ue().A.removeListener(t),O().default.removeListener(o)}}),[It]),(0,n.useEffect)((()=>{const e=e=>{o(946591).bE({environment:st,sprintSettingsContext:e.state})};return ut.sprintSettingsContextStore.addListener(e),()=>{ut.sprintSettingsContextStore.removeListener(e)}}),[ut,st]),(0,n.useEffect)((()=>{const e=async e=>{if(e.state){const e=ut.collectionViewBlockStore(),t=ut.collectionViewStore(),o=ut.collectionStore();if(!e||!t||!o)return;await(0,R().M)(st,ut,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}};return ut.relativeVariablesAreStaleStore.addListener(e),()=>{ut.relativeVariablesAreStaleStore.removeListener(e)}}),[ut,st,J]);const{contextType:So,databaseType:ho,remoteCollectionIds:fo}=(0,d().K8)((()=>({contextType:ut.contextType,databaseType:ut.databaseType,remoteCollectionIds:ut.remoteCollectionIdsStore.state})),[ut]);(0,n.useEffect)((()=>{if(wt.current)return;if("collectionTypedView"!==So||!ho)return;const e=new(at().C)(st,(0,S().aW)({spaceId:P.getSpaceId(),databaseType:ho}),((e,t)=>{var o;null===(o=It.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:rf(P),isCollectionTypeChange:!0})}));e.subscribe(),wt.current=e;const t=wt.current;return()=>{t.unsubscribe()}}),[ut,st,It,P,So,ho]),(0,n.useEffect)((()=>{null==re||re(ut)}),[re,ut]),(0,n.useEffect)((()=>{null==ne||ne(Wt())}),[]),(0,n.useEffect)((()=>{void 0===uo||$t||ut.frozoneStore.setState({...ut.frozoneStore.state,frozenIndex:uo})}),[ut.frozoneStore,$t,uo]),(0,n.useEffect)((()=>{const e=e=>{const t=Array.from(Ct.current.keys()??[]),o=f().R9(t,e),n=f().R9(e,t);for(const i of o){var r;null===(r=Ct.current.get(i))||void 0===r||r.unsubscribe(),Ct.current.delete(i)}for(const i of n){const e=new(at().C)(st,(0,S().eG)(i),((e,t)=>{var o;null===(o=It.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:rf(P),isCollectionTypeChange:!1})}));e.subscribe(),Ct.current.set(i,e)}};if(Rt)e([Rt.id]);else if("collectionTypedView"===So){e(fo??[]);const t=t=>{e(t.state)};return ut.remoteCollectionIdsStore.addListener(t),()=>{ut.remoteCollectionIdsStore.removeListener(t)}}}),[ut.remoteCollectionIdsStore,It,Rt,So,st,fo,P]),(0,n.useEffect)((()=>{const e=Ct.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const yo=(0,n.useMemo)((()=>({onFocus:oo,onBlur:no,onMouseMove:ro,onMouseLeave:io})),[oo,no,ro,io]);(0,n.useEffect)((()=>{var e;const t=null===(e=yt.current)||void 0===e?void 0:e.getNode();return t&&(0,Re().P4)(t,"scroll",ao),()=>{t&&(0,Re().Ol)(t,"scroll",ao)}}),[ao]),(0,n.useEffect)((()=>()=>{(0,o(964056).u)({collectionContextStore:ut})}),[ut]),(0,n.useEffect)((()=>()=>{St.destroy(),ht.destroy(),ft.destroy()}),[St,ht,ft]),(0,n.useEffect)((()=>()=>{var e;null==vt||null===(e=vt.current)||void 0===e||e.disconnect()}),[]),(0,me().L)({collectionContextStore:ut,isFullScreen:Boolean(z),wasCreatedThisSessionStore:ut.wasCreatedThisSessionStore,environment:st,didDelayOffscreenRenderRef:mt}),(0,n.useEffect)((()=>{var e;const t=null===(e=ut.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=ut.settingsStore;t.external_collection_type&&t.synced_collection_external_url&&Ge().Ay.state.defaultExternalCollectionSetting&&(x().eM({collectionSettingsStore:o,source:Ge().Ay.state.defaultExternalCollectionSetting}),Ge().Ay.setState({...Ge().Ay.state,open:!1,defaultExternalCollectionSetting:void 0}))}),[ut]);const vo=(0,d().r6)((()=>{var e;const t=null==Rt?void 0:Rt.isSyncedCollection(),o=!0===(null==Rt||null===(e=Rt.getFormat().sync_state)||void 0===e?void 0:e.syncing),n=st.device.isMobile;return Boolean(t&&o&&!n)}),[Rt,st]);(0,d().O$)(vo),(0,n.useEffect)((()=>{const e=async t=>{const n=await o(818369).callApi({eventName:"getExternalCollectionSyncState",environment:st,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=ut.numberChildrenReceivedStore,i=ut.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(At.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(vo){const t=ut.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return vo.addListener(t),()=>{vo.removeListener(t),clearTimeout(At.current)}}),[vo,ut,st]);const xo=Z||Boolean(null==ct?void 0:ct.disableAllPointerEvents),bo=(0,Be().bx)(P,xo),Co=(0,d().K8)((()=>!!Rt&&(0,m().Qu)(Rt.getValue())),[Rt]),wo=(0,d().K8)((()=>(0,Ce().sj)(P.id)),[P]),ko=(0,d().K8)((()=>(0,Ce().Wu)(P.id)),[P]),Io=(0,d().K8)((()=>!!wo&&ut.isEmptyStore.state),[wo,ut]),Ao=(0,d().K8)((()=>!!ko&&ut.isEmptyStore.state),[ko,ut]),jo=(0,d().K8)((()=>$t&&wo&&0===ut.collectionStoresStore.state.length&&ut.isLoadedStore.state),[$t,wo,ut]),Ro=(0,d().K8)((()=>$t&&ko&&0===ut.collectionStoresStore.state.length&&P.getCollectionViewStores().length<=1),[$t,ko,ut,P]),To=(0,L().X)("workflow_container"),Mo=(0,d().K8)((()=>To&&P.isReady()&&0===P.getCollectionViewStores().length&&"collectionSettings"!==ut.contextType),[To,P,ut]),_o=(0,d().r6)((()=>{if(!Jt||!eo||!(0,B().Ck)(P,void 0,st)||P.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(he().Qb/2)}}),[st,Jt,eo,P]);(0,d().O$)(_o);const Po=(0,d().r6)((()=>{var e;if(jo||Ro)return 0;const t="viewsMain"===(null===(e=ut.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return q||"hidden"!==G||!X?t?Ae().WK:te||ut.isInHomeWidgetStore.state?Ae().nh:Ae().Lq:0}),[jo,Ro,ut,q,G,X,te]);(0,d().O$)(Po);const Bo=(0,L().X)("db_ux_chrome"),Vo=Se({collectionContextStore:ut,previewContext:ct,isPlaceholderExternalCollection:Co}),Fo=(0,d().K8)((()=>{var e;return(null===(e=ut.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[ut]),Lo=(0,n.useMemo)((()=>{const e=1===(null==Fo?void 0:Fo.length);return Bo&&Vo&&(z||!e)}),[Bo,Vo,Fo,z]),Oo=(0,d().K8)((()=>{if(Tt||_t||Bt||z)return!0;if("always_show"===G)return!0;if(st.device.isMobile)return!0;if("form_editor"===Wt())return!0;if(ut.settingsStore.state.open)return!0;if(ut.searchOpenStore.state)return!0;if(Et.state.open)return!0;if(Lt.state.open)return!0;if(Ft.state.open)return!0;if(Ot.state.open)return!0;if(ut.filterBarSortSettingsStore.state.open)return!0;if(Array.from(ut.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!zt.state.open}),[st.device,Tt,_t,Bt,z,G,Wt,ut,Et,Ft,Ot,zt,Lt]),Eo=(0,d().r6)((()=>!(!Bo||ut.isInHomeWidgetStore.state)||Oo),[Oo,Bo,ut]);(0,d().O$)(Eo);const Do=(0,d().r6)((()=>ut.collectionActionsMinimizedStore.state&&!z?M().xE.Collapsed:M().xE.Expanded),[ut.collectionActionsMinimizedStore,z]);(0,d().O$)(Do);const zo=(0,d().K8)((()=>{const e=Wt();return!!e&&(0,Ie().II)({currentViewType:e,isPlaceholderExternalCollection:Co,collectionContextStore:ut,allowedActions:Y,settingsHeaderSizeObserver:ht})}),[Wt,ut,Y,Co,ht]);(0,d().K8)((()=>{zo&&x().IW({collectionSettingsStore:ut.settingsStore,showAddItemButton:!0})}),[zo,ut]);const Ko=(0,n.useCallback)((e=>{if(!ut.collectionViewBlockStore()||!(0,Xe().EF)(st))return;const t=ut.isMultiSourceView;b().Ur({userAction:"CollectionViewBlock.handleAddItemClick",environment:st,collectionContextStore:ut,collectionViewBlockStore:P,shouldCoerce:!0,templateStore:ut.defaultPageTemplateStore.state,useCrdt:!0,showMoveTo:t,peekModeOverride:$t?"center_peek":void 0,from:{createBlock:"cvb_add_item"}}),(0,v().X)({environment:st,collectionContextStore:ut,action:"click_topbar_new_item"})}),[ut,st,P,$t]),Ho=(0,n.useCallback)((e=>{const{device:t}=st,{target:o}=e;if(!Kt||t.isMobile||!(o instanceof HTMLElement))return;const n=Wt();n&&0===e.button&&"form_editor"!==n&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),w().jD({environment:st,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===n||"table"===n})}})}),[st,Kt,Wt]),Wo=(0,n.useCallback)(((e,t)=>{(0,Te().SQ)({event:e,context:Te().y$.EditorClick,callback:()=>{if(Gt.state||C().Cx(st),"page"===t&&!(0,_e().Zm)()){const{clientX:t,clientY:o,target:n}=e;l().default.afterNextFlush((()=>{A().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:st,canUndo:!0,perform:e=>{I().editNearestBlockOrInsertIfAtBottomOfPage(st,{x:t,y:o,target:n instanceof Element?n:void 0},e)}})}))}}})}),[st,Gt]),Go=(0,n.useMemo)((()=>f().sg(lo,100)),[lo]),No=(0,n.useCallback)((()=>{He().A.state||Pt(!0)}),[Pt]),$o=(0,n.useCallback)((()=>{Pt(!1)}),[Pt]),Uo=(0,n.useCallback)((e=>{e&&St.observe(e)}),[St]),qo=(0,n.useCallback)((e=>{e&&ft.observe(e)}),[ft]),Xo=(0,n.useCallback)((e=>{e&&ht.observe(e)}),[ht]),Yo=(0,n.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(we().Dkd);yt.current=n?e:(null==pt?void 0:pt.horizontalScroller)||null;const r=ut.collectionViewStore();Zt(r);const i=null===(o=yt.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(vt.current=new ResizeObserver(Go),vt.current.observe(i))}),[ut,Go,Zt,pt]),Qo=(0,d().K8)((()=>{if("form_editor"!==Wt()&&ut.settingsStore.state.open&&"sidebar"===Dt.state&&!0!==o(925830).b.state.visible)return(0,E.jsx)("div",{style:{...to.state,..._o.state,borderTop:`1px solid ${et.tableDividerColor}`,height:12}})}),[ut,_o,to,et,Dt,Wt]),Zo=(0,d().K8)((()=>{const e=null==Rt?void 0:Rt.getValue();return Boolean(e&&(0,m().SJ)(e))}),[Rt]),Jo=(0,d().K8)((()=>{var e;if(Wt())return(0,j().B2)({blockStore:P,isFullScreen:Boolean(z),environment:st,collectionContextStore:ut})?0:-((null===(e=to.state)||void 0===e?void 0:e.paddingLeft)??0)}),[Wt,P,z,to,st,ut]),[en,tn,on]=(0,d().K8)((()=>[ut.normalizedSchemaStore.state,ut.normalizedQueryStore.state,ut.normalizedFormatStore.state]),[ut]),nn=(0,d().K8)((()=>{if("collectionTypedView"===ut.contextType)return G;if("collectionSystemView"===ut.contextType){const e=ut.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,o(833369).TR)(t)?"default":"hidden"}return!Rt||Rt&&!1===Rt.canRead()||!Rt.isDefined()?"hidden":G??"default"}),[ut,Rt,G]),rn=(0,n.useRef)(null),ln=(0,d().K8)((()=>{var e,t;const o=qt&&!O().default.isSidePeekOpeningStore.state&&!te,n=o?z?{paddingLeft:(null==to||null===(e=to.state)||void 0===e?void 0:e.paddingLeft)??0,paddingRight:16}:{paddingLeft:0,paddingRight:((null==to||null===(t=to.state)||void 0===t?void 0:t.paddingRight)??0)+16}:null==to?void 0:to.state,r=(0,Oe().Uh)(st),i=(0,B().Ck)(P,void 0,st)||z?r:Math.min(B().x6,r);return{headerWrapper:{minHeight:Po.state,paddingLeft:null==n?void 0:n.paddingLeft,paddingRight:null==n?void 0:n.paddingRight,width:U,position:"relative",left:-((null==n?void 0:n.paddingLeft)??0),flexShrink:0,...(z||dt||o)&&{position:"sticky",zIndex:86,left:0,width:!qt||!n||z||dt||te?void 0:i-n.paddingLeft/2},...P.isNonEditableState()&&{cursor:"default"},..._o.state}}}),[st,U,Po,dt,z,qt,te,_o,to,P]),an=(0,d().K8)((()=>{var e,t;if(Mo)return(0,E.jsx)(Ye().Vh,{store:P});const n=Wt();if(!(Kt&&en&&tn&&on&&n))return null;if(Zo)return(0,E.jsx)(ee().RI,{value:ut,children:(0,E.jsx)(rt().s,{allowSelectionWithin:!0,style:ln.headerWrapper,onMouseDown:Ho,onMouseMove:No,onMouseLeave:$o,onClick:Wo,ref:(0,h().Px)(Uo,ot),children:(0,E.jsx)(lt().A,{store:P,shouldShowHoverMenu:!0,analyticsName:(0,M().LI)(n),shouldShowHalo:!z&&!dt&&!$t,canSelect:!(z||dt||$t||Ut),children:(0,E.jsx)(o(872282).A,{store:P,style:{width:"auto"},disabled:!1})})})});if(Ro)return(0,E.jsx)(ee().RI,{value:ut,children:(0,E.jsx)("div",{ref:ot,...yo,style:{display:"contents"},children:(0,E.jsxs)("div",{style:(0,Le().V$)({isPhone:tt,theme:et}),ref:rn,children:[(0,E.jsx)("div",{style:{position:"relative"},children:(0,E.jsx)(cS,{currentViewType:n,headerSizeObserver:St,contentSizeObserver:ft,settingsHeaderSizeObserver:ht,headerHeightStore:Po,viewSettingsPlacementStore:Dt,store:P,leftRightPaddingStore:to,isInHomeWidget:$t,placementToOrigin:Ee().W.Right,alignmentToOrigin:Ee().C.Center,headerRef:rn})}),(0,E.jsx)(Fe().Ww,{feature:"custom_db",onSetup:e=>{x().Ow({collectionContextStore:ut,collectionSettingsStore:ut.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:Rt}]})}})]})})});const r=(0,E.jsx)(nS,{collectionContextStore:ut,store:P,collectionStore:Rt,collectionViewStore:Kt,currentViewType:n,isDisabled:xo,isFullScreen:Boolean(z),isInPeek:Nt,isPreviewing:dt,isRootOrDirectChild:Jt,headerSizeObserver:St,timelineViewRef:xt,showHoverActionsStore:Eo,handleAddItemClick:Ko,isPlaceholderExternalCollection:Co,isMyTasksEmpty:Io,isInFrameWhenSidePeekOpen:qt,query:tn,schema:en,format:on,showHomeCustomDbEmptyState:Ro,maxHeight:Q,viewSettingsPlacementStore:Dt,templatePickerMenuListStore:ce,editorContentContainerRef:Je,showMyTasksEmptyState:jo,isInHomeWidget:$t,isUnlistedView:te,isHomeCustomDbEmpty:Ao,handleHorizontalScrollerMount:Yo,handleEditorMouseDown:Ho,handleEditorClick:Wo,leftRightPaddingStore:to,handleContentMount:qo,rootRef:ot,isViewModule:Ut,additionalCollectionViewInnerHorizontalPadding:se,scrollerLeftPadding:Yt,headerHeightStore:Po,fullWidth:U,contentEditableVoidLeft:Jo,leftRightMarginStore:_o});return(0,E.jsx)(ee().RI,{value:ut,children:(0,E.jsx)(o(242335).Z,{value:gt,children:(0,E.jsxs)("div",{ref:ot,...yo,style:{display:"contents"},children:[z?void 0:(0,E.jsx)("div",{style:{position:"relative"},children:(0,E.jsx)(cS,{currentViewType:n,headerSizeObserver:St,contentSizeObserver:ft,settingsHeaderSizeObserver:ht,headerHeightStore:Po,viewSettingsPlacementStore:Dt,store:P,leftRightPaddingStore:to,isInHomeWidget:$t,headerRef:rn,handleAddItemClick:Ko})}),(0,E.jsx)(de,{}),(0,E.jsx)(Ht,{isFullScreen:Boolean(z),leftRightPaddingStore:to,leftRightMarginStore:_o,overrideViewType:W}),Lo&&(0,E.jsx)(rt().s,{allowSelectionWithin:!0,onMouseDown:Ho,onMouseMove:No,onMouseLeave:$o,ref:(0,h().Px)(Uo,rn),children:(0,E.jsx)("div",{style:{marginBottom:6},children:(0,E.jsx)(D,{store:P,collectionContextStore:ut,showHoverActionsStore:Eo,isFullScreen:Boolean(z),canEdit:bo,paddingLeft:null===(e=to.state)||void 0===e?void 0:e.paddingLeft})})}),(0,E.jsx)(zh,{currentViewType:n,store:P,headerWrapStyle:ln.headerWrapper,headerActionsBehavior:nn,allowedActions:Y,hideViewTabBar:X??!1,showHoverActionsStore:Eo,headerSizeObserver:St,isFullScreen:Boolean(z),isInHomeWidget:$t,isMyTasksPage:wo,isHomeCustomDbPage:ko,isPlaceholderExternalCollection:Co,collectionViewHeaderText:q,handleEditorMouseDown:Ho,handleHeaderMouseMove:No,handleHeaderMouseLeave:$o,handleHeaderMount:Uo,handleSettingsHeaderMount:Xo,leftRightPaddingStore:to,headerHeightStore:Po,canEdit:bo,viewSettingsPlacementStore:Dt,contentSizeObserver:ft,settingsHeaderSizeObserver:ht,handleAddItemClick:Ko,timelineViewRef:xt,filterBarCreateFilterSettingsStore:Ot,createFilterSettingsStore:Ft,createFollowSettingsStore:Lt,switchViewMetric:jt,showOnlyCurrentView:Boolean(ie),headerRef:rn,headerStyleOverrides:{...te&&{paddingLeft:24,paddingRight:24,paddingTop:12}},minimizedActionViewStore:Do}),"form_editor"===n?(0,E.jsx)(it().A,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,render:e=>(0,E.jsx)("div",{...e,children:r})}):r,Qo,(0,E.jsx)(Qe().DG,{collectionContextStore:ut,paddingLeft:null===(t=to.state)||void 0===t?void 0:t.paddingLeft}),(0,E.jsx)(of,{collectionContextStore:ut,collectionViewBlockRenderStartTime:bt,didDelayOffscreenRenderRef:mt,mountedBeforeInitialPageRender:ue,cvbLoadingStateOnInitialRender:pe,lazyRenderStartedAtRef:Ze}),(0,E.jsx)(qh,{collectionContextStore:ut,mountedBeforeInitialPageRender:Boolean(ue)})]})})})}),[ln,Wt,Kt,en,tn,on,Zo,Ro,P,Rt,xo,z,Nt,dt,Jt,se,St,Eo,Ko,Co,Io,qt,Q,Dt,ce,jo,Yt,$t,te,Ao,Ho,to,Yo,Wo,_o,qo,Po,ut,tt,et,gt,yo,ft,ht,W,nn,Y,X,wo,ko,q,No,$o,Uo,Xo,bo,Ot,Ft,Lt,ie,Qo,bt,mt,ue,Ut,Mo,Je,pe,Do,Lo,Jo,U,Ze]);return(0,Be().NW)(P,t,(0,d().K8)((()=>({renderedType:"collection_view_page"===P.getType()?"collection_view_page":"collection_view",getBlockStore:()=>P,getNode:()=>ot.current,collectionContextStore:ut,resetLeftScrollAfterFlush:()=>{l().default.afterNextFlush((()=>{var e;const t=null===(e=yt.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,F().T8)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>function(e,t){k().IU({environment:e}),l().default.afterNextFlush((()=>{const n=t.collectionStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionStoreIfSingleSource();if(n&&(0,m().Qu)(n.getValue()))x().Ho({collectionSettingsStore:i});else if(l){(0,o(610509).P)({environment:e,collectionContextStore:t});const n=t.collectionViewStore();"form_editor"!==(null==n?void 0:n.getType())&&(x().Ow({collectionContextStore:t,collectionSettingsStore:i}),x().R8({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0}}),"chart"===(null==n?void 0:n.getType())&&t.isCreatingNewChartCollectionStore.setState(!0))}else if(n){const l=null==t?void 0:t.collectionViewStore();l?(!function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:n,collectionContextStore:r,environment:i}=e,l=null==o?void 0:o.id,a=l?(0,T().v)(l):void 0,s=M().Mf({collectionStore:t,sourceCollectionViewBlockStore:n,currentCollectionViewBlockStore:n,currentCollectionViewStore:o,constraints:(0,T().v)(o.id)}).find((e=>{var t;return e.id===(null==a||null===(t=a.viewPointer)||void 0===t?void 0:t.id)}));s&&(0,_().U)({viewToDuplicateStore:s,collectionContextStore:r,collectionViewStore:o,environment:i})}({collectionStore:n,collectionViewStore:l,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),x().Ow({collectionContextStore:t,collectionSettingsStore:i}),x().R8({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,o(458988).M)({environment:e,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i})}else{const e=null==t?void 0:t.collectionViewStore();let o;var a;if(e)o=null===(a=(0,T().v)(e.id))||void 0===a?void 0:a.viewSettingsStack;x().Ow({collectionContextStore:t,collectionSettingsStore:i,initialStack:o})}}))}(st,ut)})),[P,ut,st]),an)})));function rf(e){var t;return!Ue().A.state.isVisible||!(!O().default.isCenterPeekOpen()||null!==(t=O().default.peekTargetStore.state)&&void 0!==t&&t.uiContains(e))}const lf=nf;class af extends n.Component{componentDidCatch(e){throw o(812815).lE("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,E.jsx)(lf,{...t,ref:e})}}const sf=n.forwardRef(((e,t)=>(0,E.jsx)(af,{...e,collectionViewBlockRef:t})))},698995:(e,t,o)=>{o.d(t,{A:()=>v,S:()=>f});var n=o(242343),r=()=>o(237385),i=()=>o(803290),l=()=>o(950635),a=()=>o(653998),s=()=>o(907721),c=()=>o(932322),d=()=>o(701270),u=()=>o(482570),p=o(163643);const m="UIRegular-14px/Regular",g="UIRegular-14px/Semibold",S="iOS/Callout-16px/Regular",h=n.forwardRef(((e,t)=>{const{actor:n,userTitle:a,defaultUserTitle:d="name_only",useEmailAsTooltip:m,tooltip:g,tooltipPlacement:S,hoveredStyle:h,disabledFeedback:v,customUserTitleStyles:x,iconSizeOverride:b}=e,C=(0,r().v3)(),w=(0,i().K8)((()=>n.asActor&&n.isUser()?n.email:void 0),[n]),k=m&&w?w:g,I=b||(C.device.isMobile?c().nd:c().pg),A="name_and_email"===d||"name_and_email_unless_right"===d&&!Boolean(e.right)?(0,p.jsx)(y,{actor:null==n?void 0:n.asActor,customStyles:x}):(0,p.jsx)(f,{customStyles:x,actor:null==n?void 0:n.asActor}),j=a??A;let R;return(0,l().H3)(n)?R=(0,p.jsx)(o(951156).A,{botValue:null==n?void 0:n.asActor,size:I}):(0,l().ps)(n)?R=(0,p.jsx)(u().A,{userValue:null==n?void 0:n.asActor,size:I}):(0,l().h2)(n)?R=(0,p.jsx)(u().A,{userValue:void 0,size:I}):(0,o(76394).HB)(n),(0,p.jsx)(o(103151).A,{placement:S??s().W.Bottom,alignment:s().C.Start,textWrap:!0,render:n=>(0,p.jsx)(o(535906).A,{...(0,o(906230).A)(n,e),icon:R,title:j,disabledFeedback:v,className:"notranslate",right:e.right,ref:t,hoveredStyle:h}),disableTooltip:!k,renderTooltip:()=>k})}));function f(e){const{actor:t,customStyles:o}=e,n=(0,r().v3)(),l=(0,a().tz)(),s=(0,i().K8)((()=>t&&t.id===n.currentUser.id),[n,t]),c=(0,i().K8)((()=>t&&t.getDisplayName(l)),[t,l]),u=n.device.isMobile?S:m;return s?(0,p.jsx)(a().sA,{id:"UserMenuItem.fullName.authorLabel",defaultMessage:"<author>{fullName}</author> <you>(You)</you>",values:{author:e=>(0,p.jsx)(d().D,{as:"span",styleName:u,customStyles:o,children:e}),fullName:c,you:e=>(0,p.jsx)(d().D,{as:"span",colorName:"secondary",styleName:u,customStyles:o,children:e})}}):c?(0,p.jsx)(d().D,{styleName:u,customStyles:o,children:c}):(0,p.jsx)(d().D,{styleName:u,customStyles:o,children:(0,p.jsx)(a().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}function y(e){const t=(0,r().v3)(),{actor:o,customStyles:n}=e,l=(0,a().tz)(),s=(0,i().K8)((()=>o&&o.getDisplayName(l)),[o,l]),{email:c,showEmail:u}=(0,i().K8)((()=>{const e=o&&o.asActor&&o.isUser()?o.email:void 0;return{email:e,showEmail:s!==e}}),[o,s]),h=t.device.isMobile?"iOS/Callout-16px/Regular":g,f=t.device.isMobile?S:m;return s?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(d().D,{as:"span",styleName:h,customStyles:n,children:s}),u&&(0,p.jsx)(d().D,{as:"span",styleName:f,customStyles:n,children:` ${c}`})]}):(0,p.jsx)(d().D,{styleName:g,customStyles:n,children:(0,p.jsx)(a().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}h.displayName="UserMenuItem";const v=h},708920:(e,t,o)=>{o.d(t,{Gj:()=>r,RN:()=>a,vZ:()=>i});o(362833),o(725707),o(107652),o(491955),o(500234);var n=()=>o(486826);function r(e){const t=n().c9.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n().c9.fromMillis(e.endUnixTimestampMS):void 0,r=n().c9.fromMillis(e.startOfWeekUnixTimestampMS),i=n().c9.fromMillis(e.endOfWeekUnixTimestampMS),l=t.startOf("day"),a=n().c9.max(r,l),s=Math.ceil(a.diff(r,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=n().c9.min(i,e);c=Math.ceil(t.diff(a,"days").get("days"))}return{start:t,end:o,startOfWeek:r,endOfWeek:i,startColumn:s,columnCount:c}}function i(e){const t=(e.attendees||[]).filter((e=>!e.self&&!e.resource));return e.hasParticipants&&t.length>0&&t.every((e=>"declined"===e.responseStatus))}const l={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15};function a(e){const t=e.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===t.length)return;const{upcomingMinsThreshold:o,startingMinsThreshold:r,startedMinsThreshold:i}=l,a=[],c=[],d=[],u=[],p=[];for(const l of t){if(l.isAllDay)continue;const e=s(l),t=n().c9.now(),m=e.start.diff(t,"minutes").minutes;m>=0&&m<=o?a.push(l):-m>=r?d.push(l):-m>=i?u.push(l):e.contains(t)?c.push(l):p.push(l)}return[...a,...d,...u,...c,...p][0]}function s(e){const t=n().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}),o=n().c9.fromISO(e.end.dateTime,{zone:e.end.timeZone});return n().IX.fromDateTimes(t,o)}},744011:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(129044))().default{constructor(){super(...arguments),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},748039:(e,t,o)=>{o.d(t,{Is:()=>u,LS:()=>g,NH:()=>S,QA:()=>m,_b:()=>p});o(362833),o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601);var n=()=>o(486826),r=(o(242343),()=>o(114103)),i=()=>o(16456),l=()=>o(653998),a=()=>o(200524),s=()=>o(76394),c=()=>o(378219),d=o(163643);function u(e){const t=c().g7(e)??[],o=[];for(const n of t){if(!("block"===n.table&&!0===n.isTemplate()&&n.getFormat().automation_id&&n.id!==e.id))continue;const t=n.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,r().templateAncestorsViolateRecurrenceNesting)(o)}}function p(e){switch(e){case"day":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,s().HB)(e)}}function m(){return{start_date:n().c9.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,i().dB)(),hour:0,minute:0,frequency:"day",interval:1}}function g(e){const{recurrence:t,intl:o,leadingPhrase:n}=e;return(0,r().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===n)return"";if("every"===n)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===n)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,s().HB)(n);break;case"day":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":{const e=(null==t?void 0:t.weekdays)||[];return 5===e.length&&(0,a()._)(new Set(e),new Set(["MO","TU","WE","TH","FR"]))?o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weekday",defaultMessage:"weekday"}):o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"})}case"weeks":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function S(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},753030:(e,t,o)=>{o.d(t,{C:()=>r});var n=()=>o(698094);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=e=>{let{value:t,passThroughData:o}=e,n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},754313:(e,t,o)=>{o.d(t,{A:()=>s});o(242343);var n=()=>o(237385),r=()=>o(466321),i=()=>o(922172),l=()=>o(443252),a=o(163643);function s(e){const{isMobile:t}=(0,n().Y0)();return t?(0,a.jsx)(l().Ay,{ariaLabel:e.ariaLabel,open:e.isOpen,popupType:r().n.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:e.render,style:e.style}):(0,a.jsx)(i().a,{ariaLabel:e.ariaLabel,open:e.isOpen,preventHideChildrenWhileOpening:!0,render:e.render,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle,showCloseIcon:e.showCloseIcon})}},755564:(e,t,o)=>{o.d(t,{N:()=>r});o(242343);const n={viewBox:"0 0 20 20",svg:(0,o(163643).jsx)("path",{d:"M6.337 3.05a.625.625 0 0 0-.003.885L8.828 6.44a.625.625 0 1 0 .886-.882L8.287 4.125H10A5.875 5.875 0 1 1 4.125 10a.625.625 0 1 0-1.25 0A7.125 7.125 0 1 0 10 2.875H8.285l1.44-1.432a.625.625 0 0 0-.882-.886z"})},r=(0,o(680369).wt)("arrowCircleSpinCounterClockwise",n)},758261:(e,t,o)=>{o.d(t,{j:()=>r});class n extends(()=>o(151255))().A{}const r=new n},772785:(e,t,o)=>{o.d(t,{O:()=>u,e:()=>d});o(725707),o(500234);var n=()=>o(752597),r=()=>o(881984),i=()=>o(384221),l=()=>o(663539),a=()=>o(360482),s=()=>o(758261),c=()=>o(191759);function d(e,t){const o=a().dd(t),n=l().xh(o);e.setState({...e.state,files:n})}async function u(e){const{blockStore:t,pageViewBlockStore:o,environment:l}=e;o?o.setState({...o.state,forceDiscussionOpen:!0}):c().A.openNewPageDiscussionInput(t),r().o2(l,{from:"page_comments"}),await n().default.afterNextFlush();const a=s().j.find((e=>e.getBlockStore().id===t.id)),d=null==a?void 0:a.getInputStore();d&&i().setSelectionAtEnd({store:d.state.textStore})}},801204:(e,t,o)=>{o.d(t,{D:()=>A});o(725707),o(491955);var n=o(242343),r=()=>o(237385),i=()=>o(803290),l=()=>o(174114),a=()=>o(740520),s=()=>o(680369),c=()=>o(653998),d=()=>o(31448),u=()=>o(236339),p=()=>o(927999),m=()=>o(84543),g=o(163643);const S=function(e){const{store:t,titleStyle:n,actionButton:r,addViewButton:l}=e,a=(0,i().K8)((()=>t.getParentBlockStore()),[t]);return(0,g.jsx)("div",{children:(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,g.jsx)(o(847058).c,{step:"demo_collection",store:a,children:(0,g.jsx)(o(709237).A,{store:t,style:n})}),l,r]})})};var h=()=>o(535906),f=()=>o(858023),y=()=>o(397791),v=()=>o(443252),x=()=>o(28210),b=()=>o(88271),C=()=>o(202193),w=()=>o(640979),k=()=>o(622286),I=()=>o(308265);const A=n.memo((function(e){const{isHovered:t,collectionContextStore:n,addViewButton:r,showHoverActionsStore:a,titleStyle:s,iconStyle:c,iconSize:u}=e,[p,m,h]=(0,i().K8)((()=>[n.collectionStore(),n.collectionViewBlockStore(),n.permissionScopesStore.state]),[n]),f=(0,i().K8)((()=>n.viewsModuleContextStore.isInLayoutBuilder()),[n]),y=(0,i().K8)((()=>{const e=n.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,o(486881).j_)(t))}),[n]),v=(0,i().K8)((()=>{var e;return Boolean((null==p||null===(e=p.getParentBlockStore())||void 0===e?void 0:e.id)===(null==m?void 0:m.id))}),[p,m]),x=(0,i().K8)((()=>Boolean(null==p?void 0:p.isSyncedCollection())),[p]),b=(0,o(390263).Zp)(),C=(v||y)&&h.canConfigureCollection&&!(null!=b&&b.disableEditingName)&&!x,w=(0,l().IS)((()=>({container:{width:"max-content",maxWidth:"100%",marginRight:4,display:"flex",alignItems:"center",...d().RC},titleStyle:{fontWeight:d().Wy.bold,fontSize:22,...y?{}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"},marginRight:4,...s}})),[y,s]);return p&&(null!=b&&b.disableAllPointerEvents||f)?(0,g.jsxs)("div",{style:w.container,children:[(0,g.jsx)(T,{collectionContextStore:n,disabled:!0,iconStyle:c,iconSize:u}),(0,g.jsx)(S,{store:p,titleStyle:w.titleStyle})]}):C?(0,g.jsx)(R,{isHovered:t,collectionContextStore:n,showHoverActionsStore:a,titleStyle:w.titleStyle,iconStyle:c,iconSize:u,addViewButton:r}):(0,g.jsx)(j,{isHovered:t,addViewButton:r,collectionContextStore:n,showHoverActionsStore:a,titleStyle:w.titleStyle,iconStyle:c,iconSize:u})})),j=n.memo((function(e){const{isHovered:t,collectionContextStore:a,showHoverActionsStore:s,titleStyle:c,iconStyle:p,iconSize:m,addViewButton:h}=e,f=(0,r().v3)(),{collectionStore:y,collectionViewBlockStore:v}=(0,i().K8)((()=>({collectionStore:a.collectionStore(),collectionViewBlockStore:a.collectionViewBlockStore()})),[a]),{isSystemCollection:x,href:b}=(0,i().K8)((()=>{const e=Boolean(null==y?void 0:y.isSystemCollection());return{isSystemCollection:e,href:e?void 0:(0,o(314164).t2)(a)}}),[a,y]),C=(0,k().X)("db_ux_chrome"),w=(0,l().IS)((()=>({container:{width:"max-content",maxWidth:"100%",marginRight:4,...d().RC},containerInner:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:6},containerHovered:{...C&&{background:"none"}}})),[C]),I=(0,n.useCallback)((()=>{(0,u().X)({environment:f,collectionContextStore:a,action:"click_collection_name_link_button"})}),[f,a]);return y&&v?(0,g.jsxs)(o(931085).A,{disabled:x,style:w.container,innerStyle:w.containerInner,hoveredStyle:w.containerHovered,href:b,onClick:I,children:[(0,g.jsx)(T,{collectionContextStore:a,disabled:!0,iconStyle:p,iconSize:m}),(0,g.jsx)(S,{addViewButton:t?h:void 0,actionButton:t?(0,g.jsx)(M,{showHoverActionsStore:s,collectionContextStore:a}):void 0,store:y,titleStyle:c})]}):null})),R=n.memo((function(e){const{isHovered:t,collectionContextStore:a,addViewButton:s,showHoverActionsStore:d,titleStyle:p,iconStyle:m,iconSize:S}=e,h=(0,r().v3)(),f=(0,c().tz)(),y=(0,i().K8)((()=>a.collectionStore()),[a]),v=(0,i().K8)((()=>a.collectionViewBlockStore()),[a]),x=(0,i().K8)((()=>null==y?void 0:y.getNameStore()),[y]),b=(0,I().BG)(),w=(0,k().X)("db_ux_chrome"),A=(0,i().K8)((()=>{var e;return b&&y?(0,C().nE)({intl:f,isDBUXChromeEnabled:w,isWorkflowsAppContainerEnabled:b,collectionStore:y}):(null==v||null===(e=v.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:v.getRecordModel,userTimeZone:(0,o(427091).P)(),intl:f,isWorkflowsAppContainerEnabled:b}))||(0,C().nE)({intl:f,isWorkflowsAppContainerEnabled:b,isDBUXChromeEnabled:w,collectionStore:y})}),[y,v,f,b,w]),j=(0,l().IS)((e=>({container:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},titleIcons:{display:"flex",alignItems:"center",opacity:t?1:0},text:p,placeholder:{WebkitTextFillColor:e.pageTitlePlaceholderTextColor,cursor:"text"}})),[p,t]),R=(0,n.useMemo)((()=>(0,g.jsxs)("div",{style:j.titleIcons,children:[s,(0,g.jsx)(M,{showHoverActionsStore:d,collectionContextStore:a})]})),[s,a,d,j.titleIcons]),_=(0,n.useCallback)((()=>{o(360378).IU({environment:h})}),[h]),P=(0,n.useCallback)((()=>{(0,u().X)({environment:h,collectionContextStore:a,action:"click_collection_name_input"})}),[h,a]);return y&&v&&x?(0,g.jsxs)("div",{style:j.container,children:[(0,g.jsx)(T,{collectionContextStore:a,disabled:!1,iconStyle:m,iconSize:S}),(0,g.jsx)(o(636045).A,{store:x,style:j.text,disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:A,onEnter:_,onEsc:_,onClick:P,disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:o(868199).Os.none,placeholderStyle:j.placeholder},x.id),R]}):null})),T=n.memo((function(e){const{disabled:t,collectionContextStore:s,iconStyle:c,iconSize:d=22}=e,u=(0,r().v3)(),{collectionStore:p,collectionViewBlockStore:S}=(0,i().K8)((()=>({collectionStore:s.collectionStore(),collectionViewBlockStore:s.collectionViewBlockStore()})),[s]),h=(0,i().K8)((()=>null==p?void 0:p.getIcon()),[p]),f=(0,i().K8)((()=>{var e;return Boolean((null==p||null===(e=p.getParentBlockStore())||void 0===e?void 0:e.id)===(null==S?void 0:S.id))}),[p,S]),v=(0,i().K8)((()=>null==S?void 0:S.getType()),[S]),b=(0,l().IS)((e=>({iconStyle:{width:d,height:d,marginRight:4,...c},container:{position:"relative",width:d+2,height:d+2,marginRight:4,display:"flex",alignItems:"center",justifyContent:"center"},arrowContainer:{width:20,marginRight:4},pageLinkIndicatorIcon:{position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===e.mode?e.text.primary:"#3E3C38",stroke:"dark"===e.mode?e.surface.wash:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[c,d]),C=(0,n.useCallback)((e=>{const t=p&&p.getIconStore();t&&m().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:u,canUndo:!0,perform:n=>{o(759625).KY({store:t,value:e,transaction:n})}})}),[p,u]);return p&&S?h||f?h?(0,g.jsxs)("div",{style:b.container,children:[t?(0,g.jsx)(x().B,{disabled:!0,bucket:"secure",store:p,icon:h,isEmptyPage:!1,style:b.iconStyle,size:d}):(0,g.jsx)(x().B,{disabled:!1,bucket:"secure",store:p,icon:h,isEmptyPage:!1,style:b.iconStyle,size:d,iconLoggingData:{recordTable:p.table,source:"inline_collection",block_type:v,collection_id:p.id},onChange:C}),!f&&(0,o(333889).G)(b.pageLinkIndicatorIcon)]}):null:(0,g.jsx)("div",{style:b.arrowContainer,children:(0,g.jsx)(y().I,{icon:a().arrowDiagonalUpRightIcon})}):null})),M=n.memo((function(e){const{showHoverActionsStore:t,collectionContextStore:a}=e,{isMobile:d}=(0,r().Y0)(),u=(0,c().tz)(),p=(0,i().O$)(t),m=(0,l().IS)((()=>({container:{display:"flex"},buttonPopup:{width:240},iconStyle:{width:s().Ev.sm,height:s().Ev.sm}})),[]),S=(0,n.useCallback)((e=>(0,g.jsx)(o(356813).A,{icon:o(533666).Y,iconStyle:m.iconStyle,ariaLabel:u.formatMessage(C().k9.actionsButtonAriaLabel),...e})),[u,m.iconStyle]),h=(0,n.useCallback)((e=>(0,g.jsx)(_,{parent:e,collectionContextStore:a})),[a]);return(0,g.jsx)(o(615917).A,{visible:p,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:m.container,children:(0,g.jsx)(o(273520).Ay,{popupType:d?v().nl.SlideUp:v().nl.Popup,render:h,renderOrigin:S,style:m.buttonPopup,originGap:4})})})),_=n.memo((function(e){const{parent:t,collectionContextStore:l}=e,s=(0,r().v3)(),{isMobile:d}=(0,r().Y0)(),S=(0,k().X)("db_ux_chrome"),{collectionStore:v,collectionViewStore:x}=(0,i().K8)((()=>({collectionStore:l.collectionStore(),collectionViewStore:l.collectionViewStore()})),[l]),C=(0,i().O$)(l.permissionScopesStore),A=(0,i().K8)((()=>null==v?void 0:v.isSyncedCollection()),[v]),j=(0,i().K8)((()=>{var e,t;const o=Boolean(null==v?void 0:v.isSystemCollection()),n=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.id,r=null==v||null===(t=v.getParentBlockStore())||void 0===t?void 0:t.id,i=r&&n&&r===n;return(!(l.isFullScreenStore.state&&i)||!(0,I().ei)())&&!o}),[l,v]),R=(0,n.useMemo)((()=>{const e=[j?{key:"view",render:e=>(0,g.jsx)(h().A,{...e,title:(0,g.jsx)(c().sA,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,g.jsx)(y().I,{icon:a().arrowDiagonalUpRightIcon})}),action:e=>{(0,o(210290).q)({environment:s,collectionContextStore:l,event:e.event,buttonPopupParent:t})}}:null,C.canConfigureCollection&&!A?{key:"edit_name",render:e=>(0,g.jsx)(h().A,{...e,title:(0,g.jsx)(c().sA,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,g.jsx)(y().I,{icon:o(686752).pencilLineIcon})}),action:()=>{const e=null==v?void 0:v.getNameStore();e&&(o(384221).selectAllText({environment:s,store:e,canSelectAllBlocks:!1}),t.close(),(0,u().X)({environment:s,collectionContextStore:l,action:"click_source_edit_title"}))}}:null];return e.filter((e=>null!==e))}),[j,C.canConfigureCollection,A,s,l,t,v]),T=(0,n.useMemo)((()=>({key:"show_title",render:e=>(0,g.jsx)(h().A,{...e,icon:(0,g.jsx)(y().I,{icon:o(99949).e}),title:(0,g.jsx)(c().sA,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{m().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:s,canUndo:!0,perform:e=>{if(!x)return;p().zA({stores:[x],update:{hide_linked_collection_name:!0},transaction:e});const t=l.collectionViewBlockStore();S&&t&&p().zA({stores:[t],update:{hide_inline_collection_name:!0},transaction:e})}}),t.close(),(0,u().X)({environment:s,collectionContextStore:l,action:"click_source_hide_title"})}})),[l,x,s,t,S]),M=(0,n.useMemo)((()=>[R.length>0?{key:"actions",render:e=>(0,g.jsx)(b().A,{...e}),items:R}:null,C.canConfigureBlock?{key:"show_title",render:e=>(0,g.jsx)(b().A,{...e,topBorder:!0}),items:[T]}:null].filter((e=>null!==e))),[R,T,C.canConfigureBlock]);return v?(0,g.jsx)(o(935091).A,{menuType:d?w().gu.ActionSheet:w().gu.Popup,children:(0,g.jsx)(f().Ay,{type:f().Oh.Vertical,onAccept:t.close,sections:M,initialFocus:void 0})}):null}))},807672:(e,t,o)=>{o.d(t,{k:()=>r});let n;class r{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;n||(n=document.createElement("div"),n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",n.style.opacity="0",document.body.appendChild(n)),o(975392).uk(this.style,((e,t)=>{n&&(n.style[t]=e)})),n.textContent=e;const r=n.getBoundingClientRect();return this.lastResult={text:e,rect:r},r}}},855470:(e,t,o)=>{o.d(t,{V:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("chevronRight",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M12.375 8.06445C12.375 7.83203 12.2861 7.63379 12.1084 7.45605L6.77637 2.24023C6.62598 2.08984 6.44141 2.01465 6.22266 2.01465C5.77832 2.01465 5.42285 2.35645 5.42285 2.80078C5.42285 3.01953 5.51172 3.21777 5.66211 3.375L10.4746 8.06445L5.66211 12.7539C5.51855 12.9043 5.42285 13.1025 5.42285 13.3213C5.42285 13.7725 5.77832 14.1143 6.22266 14.1143C6.44141 14.1143 6.62598 14.0391 6.77637 13.8887L12.1084 8.67285C12.293 8.49512 12.375 8.29688 12.375 8.06445Z"})})},865011:(e,t,o)=>{o.d(t,{S4:()=>v,Sn:()=>h,j2:()=>S,kc:()=>g,oq:()=>y});o(362833),o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(725707),o(491955),o(771702),o(403517);var n=()=>o(486826),r=()=>o(352613),i=()=>o(871002),l=()=>o(16456),a=()=>o(427091),s=()=>o(769884),c=()=>o(975392),d=()=>o(782422),u=()=>o(708920),p=()=>o(213517),m=()=>o(836331);(0,o(653998).YK)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}});function g(e){return!1===e.isDragging}function S(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,r=o.getQuery(n);if(!r||!r.calendar_by)return;const i=t.dateRangeStartStore.state,s=t.dateRangeEndStore.state,c=(0,l().p6)(i,(0,a().P)()),d=(0,l().p6)(s,(0,a().P)());return f({calendarBy:r.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function h(e){const{collectionContextStore:t,startOfDay:o}=e,r=t.collectionViewStore();if(!r)return;const i=t.normalizedSchemaStore.state,s=r.getQuery(i);if(!s||!s.calendar_by)return;const c=n().c9.fromMillis(o).endOf("day").valueOf(),d=(0,l().p6)(o,(0,a().P)()),u=(0,l().p6)(c,(0,a().P)());return f({calendarBy:s.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function f(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function y(e){var t;const{collectionContextStore:o,results:n,getRecordValue:r,intl:s,formulasModule:p}=e,m=o.collectionViewStore(),g=o.normalizedQueryStore.state,S=o.normalizedSchemaStore.state,h=g?g.calendar_by:void 0,f=o.dateRangeStartStore.state,y=o.dateRangeEndStore.state,b=(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().calendar_show_weekends)??!0,C=d().XX.state,w=(0,a().P)(),k=o.getCurrentUserId();if(!(m&&g&&h&&S))return;const I=new Map,A=new Map,j=c().oE(n.map((e=>v({blockStore:e,calendarBy:h,schema:S,getRecordValue:r,userId:k,intl:s,resultCache:I,regExpCache:A,formulasModule:p})))),R={};n.forEach(((e,t)=>{R[e.id]=t}));0===(g.sort||[]).length&&j.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return R[e.id]-R[t.id]}return o-n}));const T=b?(0,l().iB)(f,C,w):(0,l().J0)(f,C,w),M=b?(0,l().hp)(y,C,w):(0,l().EK)(y,C,w);let _=T;const P=[];do{const e=b?(0,l().hp)(_.valueOf(),C,w):(0,l().EK)(_.valueOf(),C,w),t={},o=j.filter((t=>(0,i().m6)(_.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:r,end:i,includeTime:l,timeZone:a}=o,{startColumn:s,columnCount:c}=(0,u().Gj)({startUnixTimestampMS:r.valueOf(),endUnixTimestampMS:i?i.valueOf():void 0,startOfWeekUnixTimestampMS:_.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=x(s,c,t);return{id:n,start:r.valueOf(),end:i?i.valueOf():void 0,row:d,includeTime:l,timeZone:a}}));P.push({start:_.valueOf(),end:e.valueOf(),items:o}),_=b?(0,l().iB)(_.plus({week:1}).plus({hour:25}).valueOf(),C,w):(0,l().J0)(_.plus({week:1}).plus({hour:25}).valueOf(),C,w)}while(_<M);return P}function v(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:i,intl:c,userId:d,resultCache:u,regExpCache:g,formulasModule:S}=e,h=t.getAssociatedCollectionStore(),f=t.getModel();if(!f)return;const y=(0,r().d2)({property:o,schema:n,block:f,getRecordModel:s().b4_.fromGetRecordValueFn(i),propertyMapping:null==h?void 0:h.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,a().P)(),depth:0,intl:c,visitedProperties:new Set,resultCache:u,regExpCache:g,experimentService:m().default,collectionFeatureGates:(0,p().i)()},formulasModule:S}).next().value;if("date"!==(null==y?void 0:y.type))return;const v=y.value;if(!v)return;const x=(0,l().AA)(v,(0,a().P)());if(!x)return;return{id:f.id,start:x.start,end:x.end,includeTime:"datetime"===v.type||"datetimerange"===v.type,timeZone:"datetime"===v.type||"datetimerange"===v.type?v.time_zone:void 0}}function x(e,t,o){let n=0;for(;;){let r=!1;for(let i=0;i<t;i++)b(o,e+i,n)&&(r=!0);if(!r)break;n++}for(let r=0;r<t;r++)C(o,e+r,n);return n}function b(e,t,o){return Boolean(e[o]&&e[o][t])}function C(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}},911575:(e,t,o)=>{o.d(t,{$0:()=>h,Fx:()=>w,Ge:()=>m,I3:()=>u,Kj:()=>b,PP:()=>k,TK:()=>I,Yy:()=>d,aE:()=>A,cQ:()=>C,kH:()=>g,m7:()=>p,nq:()=>v,nv:()=>f,tj:()=>S});o(725707),o(491955),o(113085);var n=()=>o(975392),r=()=>o(76394),i=()=>o(564134),l=()=>o(810111),a=()=>o(479056),s=()=>o(875089);(0,r().u0)((e=>(0,r().O9)(e)&&(0,r().O9)(e.target)&&(0,r().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const c={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(c[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:a,sort:c,sourcePropertyIds:d}=e,p=(d??(0,r().uv)(o)).filter(((t,n,r)=>{const l=o[t];return!(!l||!u(l))&&(("relation"!==l.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,l))&&(!a||a([t,l],n,o)))}));if(0===p.length)return[];if(!t||!1===c)return p;const m=(0,s().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:o,sort:a}=e,c=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().JY)(r))}));if(0===c.length)return[];if(!t||!1===a)return c;const d=(0,s().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(c,(e=>d.findIndex((t=>t.property===e))))}function g(e){return e.type===a().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===a().M9.TokenExpected?{type:e.type,token:e.token}:e.type===a().uW.MissingSchemaPropertyOnThisRow||e.type===a().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===a().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===a().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===a().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===a().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===a().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===a().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===a().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===a().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===a().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===a().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===a().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===a().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const S={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function h(e){return Boolean(S[e.type])}function f(e){const{collectionFormat:t,collectionSchema:o,filter:a,sort:c}=e,d=(0,r().uv)(o).filter(((e,t,n)=>{var r;const l=o[e];return!(!l||!S[l.type])&&((!(0,i().$M)(l)||null===(r=(0,i().om)(l))||void 0===r||!r.auto_update_on_edit)&&(!a||a([e,l],t,o)))}));if(0===d.length)return[];if(!t||!1===c)return d;const u=(0,s().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(d,(e=>u.findIndex((t=>t.property===e))))}const y={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function v(e){return y[e.type]}const x={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function b(e){return x[e.type]}function C(e){return 0===e}function w(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function k(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function I(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!u(r):!S[r.type])}function A(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i,relativeDate:l}=t.event;if(void 0===i)return!1;const a="some"===n.type&&n.some,s="all"===n.type&&n.all;if((a||s||[]).some((e=>k({collectionSchema:o,property:e.property})||I({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const c="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),d="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!e&&("none"===n.type||c||d)&&!l)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},918305:(e,t,o)=>{o.d(t,{_:()=>r});o(242343);const n={viewBox:"0 0 20 20",svg:(0,o(163643).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},r=(0,o(680369).wt)("layout",n)},949094:(e,t,o)=>{o.d(t,{i:()=>s});o(725707),o(491955),o(403517);var n=()=>o(878378),r=()=>o(289765),i=()=>o(975392),l=()=>o(551102),a=()=>o(413871);function s(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:s}=e,c=t.getCollectionViewStores(),{beforeOps:d}=(0,n().i)(c.map((e=>e.id)).slice(0,o.length),o);i().jJ(d,((e,n)=>{const c=a().pS.createChildStore(t,{table:r().Gy,id:n,spaceId:t.getSpaceId()});if(e)l().nc({parentStore:t.getCollectionViewsStore(),insertStore:c,beforeStore:a().pS.createChildStore(t,{table:r().Gy,id:e,spaceId:t.getSpaceId()}),transaction:s});else{const e=i().HV(o.filter((e=>e!==n)));l().WH({parentStore:t.getCollectionViewsStore(),insertStore:c,afterStore:e?a().pS.createChildStore(t,{table:r().Gy,id:e,spaceId:t.getSpaceId()}):void 0,transaction:s})}}))}},954397:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,slidersIcon:()=>i});o(242343);var n=o(163643);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},i=(0,o(680369).wt)("sliders",r)},970709:(e,t,o)=>{o.d(t,{DG:()=>l,lC:()=>i});var n=()=>o(129978);const r={postInstallTourTooltip:new(n().O2)("workflowTemplateTourTooltip",(()=>o.e(99013).then(o.bind(o,141772)))),onboardingPills:new(n().O2)("onboardingPills",(()=>o.e(96431).then(o.bind(o,379636))))},i=(0,n()._h)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n()._h)(r.onboardingPills,(e=>e.PostInstallPills))},981247:(e,t,o)=>{o.d(t,{NS:()=>u,Pq:()=>g,Z3:()=>d,sw:()=>p});o(242343);var n=()=>o(237385),r=()=>o(435819),i=()=>o(935091),l=()=>o(932322),a=()=>o(743668),s=()=>o(640979),c=o(163643);const d=8,u=8,p=32,m={height:p+d-2,paddingTop:d-2};function g(e){let{title:t,helpButton:o,onCancel:l,desktopMinWidth:d,desktopMaxWidth:u,desktopWidth:p,children:m}=e;const{device:g}=(0,n().v3)();return(0,c.jsx)(r().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:s().gu.Modal,title:t,right:(0,c.jsx)(a().DoneMenuText,{}),onClickRight:l,...e}:{menuType:s().gu.Popup,...d&&{minWidth:d},...u&&{maxWidth:u},...p&&{width:p},...e},(0,c.jsx)(i().A,{...n,header:t&&(0,c.jsx)(S,{title:t,helpButton:o}),children:m})}})}function S(e){let{title:t,helpButton:o}=e;return(0,n().v3)().device.isMobile?null:(0,c.jsx)(l().Ay,{style:m,title:t,right:o})}},990910:(e,t,o)=>{o.d(t,{FB:()=>p,Ql:()=>m,SM:()=>g,Wv:()=>i,Yz:()=>a,ds:()=>r,e4:()=>n,eQ:()=>l,im:()=>c,jw:()=>s,k2:()=>u,uG:()=>d});const n=8,r=10,i=8,l=24,a=6,s=1.5,c=(l-s)/2,d=l+a,u=`calc(100% + ${i+(n-a)-d}px)`,p=l+8,m=-16;function g(e){return"margin_comments"===e?12:"comment_unfurl"===e?14:16}},991378:(e,t,o)=>{o.d(t,{Nu:()=>l,Sw:()=>n,gO:()=>r,j$:()=>i});const n=220,r=24,i=-7,l=-3},993254:(e,t,o)=>{o.d(t,{T:()=>r});o(362833),o(725707),o(244387);var n=()=>o(437800);function r(e){const{environment:t,collectionStore:o,duplicate:r,droppedStores:i,transaction:l,duplicateActions:a}=e,{movedStores:s,reparentedStores:c}=i.reduce(((e,t)=>(r||t.getAssociatedCollectionId()!==(null==o?void 0:o.id)?e.reparentedStores.push(t):e.movedStores.push(t),e)),{movedStores:[],reparentedStores:[]});return[...s,...n().MS({environment:t,droppedStores:c,duplicate:r,transaction:l,resolveTemplateVariables:!1,duplicateActions:a})]}},994488:(e,t,o)=>{o.d(t,{o:()=>n});o(362833),o(403517);function n(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];if(0===o.length)return e.map((e=>[e]));const i=[];for(const l of e)i.push(...n(o[0],...o.slice(1)).map((e=>[l,...e])));return i}}}]);