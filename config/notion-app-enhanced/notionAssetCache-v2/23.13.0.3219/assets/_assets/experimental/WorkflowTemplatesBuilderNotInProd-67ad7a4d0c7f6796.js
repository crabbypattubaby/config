"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[94611],{76435:(e,t,o)=>{o.d(t,{AW:()=>d,OV:()=>p,Pe:()=>u,Vk:()=>s});o(403517);var n=o(242343),i=()=>o(174114),l=()=>o(3311),r=o(163643);const a={marginBottom:4};function s(e){const{label:t,value:o,onChange:n}=e,i=m();return(0,r.jsxs)("div",{style:a,children:[(0,r.jsx)("input",{type:"checkbox",checked:o,id:i,onChange:e=>n(e.target.checked)}),(0,r.jsx)("label",{htmlFor:i,children:t})]})}function p(e){const{label:t,value:o,onChange:n,options:l,optionLabels:s}=e,p=m(),c=(0,i().IS)((e=>({container:a,select:{display:"inline-flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"transparent",borderRadius:6,border:`1px solid ${e.outlineButtonBorder}`}})),[]);return(0,r.jsxs)("div",{style:c.container,children:[(0,r.jsxs)("label",{htmlFor:p,children:[t,": "]}),(0,r.jsx)("select",{value:o,onChange:e=>n(e.target.value),style:c.select,children:l.map((e=>(0,r.jsx)("option",{value:e,children:s?s[e]:e},e)))})]})}const c="(none)";function d(e){const{label:t,value:o,onChange:n,options:i,optionLabels:l}=e;return(0,r.jsx)(p,{label:t,value:o??c,onChange:e=>n(e===c?void 0:e),options:[c,...i],optionLabels:l?{...l,[c]:"none"}:void 0})}function u(e){const{label:t,value:o,onChange:n,placeholder:l,dataList:s,disabled:p}=e,c=m(),d=m(),u=(0,i().IS)((e=>({input:{fontSize:14,lineHeight:"20px",position:"relative",borderRadius:6,boxShadow:e.inputBoxShadow,background:e.inputBackground,cursor:"text",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,border:"unset"}})),[]);return(0,r.jsxs)("div",{style:a,children:[(0,r.jsxs)("label",{htmlFor:c,children:[t,": "]}),(0,r.jsx)("input",{style:u.input,id:c,list:s?d:void 0,type:"text",value:o,disabled:p,placeholder:l,onChange:e=>{n(e.target.value)}}),s&&(0,r.jsx)("datalist",{id:d,children:s.map(((e,t)=>(0,r.jsx)("option",{value:e},t)))})]})}function m(){const[e]=(0,n.useState)((()=>(0,l().Ay)()));return e}},141479:(e,t,o)=>{o.d(t,{N:()=>n,s:()=>i});const n=["pre_signup_build_with_ai"],i={select_and_customize_template:["templateSelection","features","viewsSelection"],customize_template:["features","viewsSelection"],select_and_build_with_ai:["templateSelection","setupGeneratorInput","setupGeneratorBuilding","features","viewsSelection"],build_with_ai:["setupGeneratorInput","setupGeneratorBuilding","features","viewsSelection"],new_user_template_onboarding:["templateSelection","setupGeneratorBuilding","features","viewsSelection"],pre_signup_build_with_ai:["setupGeneratorInput","setupGeneratorBuilding","features","viewsSelection"]}},151602:(e,t,o)=>{o.d(t,{A:()=>l});class n extends(()=>o(129044))().default{getInitialState(){return{}}}const i=new n;o(996094).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const l=i},367950:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},376896:(e,t,o)=>{o.d(t,{Kg:()=>s,Pg:()=>p,nN:()=>c,vW:()=>d});o(362833),o(725707),o(500234);var n=()=>o(505966),i=()=>o(564134),l=()=>o(975392),r=()=>o(76394),a=()=>o(901552);function s(e){var t;let{propertyId:o,propertyTemplate:n,firstTableViewInfo:i}=e;const l=null==i||null===(t=i.format.table_properties)||void 0===t?void 0:t.find((e=>e.property===o));if(l){const{property:e,...t}=l;n.tablePropertyFormat=t}}function p(e){const{type:t}=e;switch(t){case"title":case"text":case"checkbox":case"number":case"person":case"file":case"url":case"email":case"phone_number":case"created_time":case"created_by":case"last_edited_time":case"last_edited_by":case"last_visited_time":case"date":case"select":case"multi_select":case"status":case"formula":case"relation":case"auto_increment_id":case"button":return!0;case"rollup":case"location":case"verification":case"geo_point":return!1;default:(0,r().HB)(t)}}function c(e){if("relation"===e.type)return{type:"relation",name:e.name,autoRelate:e.autoRelate};const t=(0,l().mg)(e);if(delete t.workflow_template_instance,(0,i().DQ)(t)&&t.options)for(const o of t.options)delete o.collectionIds;return t}function d(e){let{propertyTemplateValue:t,mapper:o}=e;const i=[];if((0,n().$G)({object:t,callback:e=>{const t=e.property;i.push(t)}}),0===i.length)return;const l={};for(const n of i)o.populateDependencyMap((0,a().vO)({type:"property",id:n}),l);return l}},381547:(e,t,o)=>{o.d(t,{Cy:()=>j,iK:()=>C,qT:()=>S});o(725707),o(491955),o(403517);var n=o(242343),i=()=>o(114101),l=()=>o(237385),r=()=>o(174114),a=()=>o(908568),s=()=>o(745758),p=()=>o(541017),c=()=>o(199001),d=()=>o(653998),u=()=>o(220413),m=()=>o(975392),f=()=>o(31448),y=()=>o(91472),g=()=>o(211379),h=()=>o(129978),v=()=>o(907721),I=()=>o(356813),b=()=>o(103151),w=()=>o(35462),x=o(163643);const T=(0,d().YK)({copyColor:{defaultMessage:"Copied '{stringValue}'",id:"uidoc.colors.copied"}});function C(e){let{children:t,style:o}=e;const n=(0,r().IS)((e=>({subheader:{fontSize:24,fontWeight:f().Wy.semibold,letterSpacing:"-0.5px",marginTop:36,marginBottom:8,lineHeight:1,...o}})),[o]);return(0,x.jsx)("div",{style:n.subheader,children:t})}function j(e){let{children:t,style:o,scrollContentRef:i}=e;const c=function(){const e=(0,l().v3)();return(0,n.useCallback)((async t=>{const o=t.length>B?`${t.slice(0,B)}...`:t;(await y().R.clipboardActions.load()).copyString({copiedMessage:{...T.copyColor,defaultMessage:`Copied '${o}'`},environment:e,stringValue:t})}),[e])}(),[u,f]=(0,n.useState)(!1),v=(0,n.useRef)(null),{value:b}=(0,h().fJ)(g().y),{renderChildren:w,githubUrl:C}=(0,n.useMemo)((()=>{if(V(t)){var e;const o=`https://github.com/makenotion/notion-next/tree/main/${t.fileName}#L${(null===(e=t.start)||void 0===e?void 0:e.line)??"1"}`;return{renderChildren:(t.source&&function(e){const t=e.split("\n"),o=t.map((e=>{var t;return(null===(t=e.match(/^\s*/))||void 0===t?void 0:t[0])??""})).filter(((e,t)=>""!==e&&0!==t));if(0===o.length)return e;const n=m().wq(o,(e=>e.length));if(!n||0===n.length)return e;return t.map((e=>e.startsWith(n)?e.slice(n.length):e)).join("\n")}(t.source))??t.source??t.value,githubUrl:o}}return{renderChildren:t}}),[t]),j=(0,r().IS)((e=>({code:{fontSize:"80%",fontFamily:"monospace",color:e.text.primary,borderRadius:"0.25em",background:"rgba(135, 131, 120, 0.15)",padding:"0.2em 0.4em",position:"relative",tabSize:2,margin:0,...o},buttonBar:{position:"absolute",right:2,top:2,display:"flex",gap:4},button:{width:"1.55em",height:"1.55em"}})),[o]);(0,n.useLayoutEffect)((()=>{var e;const o="string"==typeof t?t:null===(e=v.current)||void 0===e?void 0:e.innerText;if(b&&o&&v.current){const e=p().y.TypeScript,t=b.languages[e],n=b.highlight(o,t,e);v.current.innerHTML=n}}));const S=(0,d().tz)();return(0,x.jsxs)("pre",{onMouseEnter:()=>{f(!0)},onMouseLeave:()=>{f(!1)},style:j.code,ref:i,children:[(0,x.jsx)("div",{ref:v,children:w}),u&&(0,x.jsxs)("div",{style:j.buttonBar,children:[C&&(0,x.jsx)(I().A,{ariaLabel:S.formatMessage({id:"uidoc.code.openInGithub",defaultMessage:"Open in Github"}),style:j.button,hasBackground:!0,icon:s().F,showShadow:!0,href:C,external:!0}),(0,x.jsx)(I().A,{ariaLabel:S.formatMessage({id:"uidoc.code.copy",defaultMessage:"Copy code"}),style:j.button,hasBackground:!0,icon:a().n,showShadow:!0,onClick:()=>{c((null==w?void 0:w.toString())||"")}})]})]})}function S(e){const[t,o]=(0,n.useState)(!1);return(0,x.jsx)("div",{onMouseEnter:()=>{o(!0)},onMouseLeave:()=>{o(!1)},children:(0,x.jsx)(k,{marginTopBottom:e.marginTopBottom,isInverted:e.isInverted,children:(0,x.jsx)(_,{showSize:e.showSize??t,showInsets:e.showInsets??t,insetSize:24,children:(0,x.jsx)(O,{isInverted:e.isInverted,children:e.children})})})})}function k(e){const{marginTopBottom:t}=e,o=(0,r().DP)(),i=M(),l=e.isInverted?i:o,a=(0,n.useMemo)((()=>({borderRadius:4,overflow:"hidden",border:`1px solid ${l.regularDividerColor}`,backgroundColor:l.contentBackground,marginTop:t??12,marginBottom:t??12,color:l.text.primary})),[l,t]);return(0,x.jsx)("div",{style:a,children:e.children})}function _(e){const{showInsets:t,showSize:o,insetSize:i,children:l}=e,a=(0,n.useRef)(null),s=(0,r().IS)((e=>{const o=t?"rgba(255, 105, 180, 1)":"rgba(255, 105, 180, 0)",n=`1px dashed ${o}`,l=`${i}px`,r="all 0.1s ease-in-out",a={t:{borderBottom:n,transition:r},l:{borderRight:n,transition:r},r:{borderLeft:n,transition:r},b:{borderTop:n,transition:r,position:"relative"}};return{grid:{display:"grid",gridTemplateColumns:`${l} auto ${l}`,gridTemplateRows:`${l} auto ${l}`,...a.t,...a.l,...a.r,...a.b},...a,tl:{...a.t,...a.l},tr:{...a.t,...a.r},bl:{...a.b,...a.l},br:{...a.b,...a.r},c:{position:"relative"},insetText:{color:o,fontSize:10,paddingLeft:(i-10)/2,fontFamily:f().Tf.githubMono,lineHeight:l,maxHeight:i,transition:r,position:"absolute"}}}),[t,i]);return(0,x.jsxs)("div",{style:s.grid,children:[(0,x.jsx)("div",{style:s.tl}),(0,x.jsx)("div",{style:s.t}),(0,x.jsx)("div",{style:s.tr}),(0,x.jsx)("div",{style:s.l}),(0,x.jsx)("div",{style:s.c,ref:a,children:l}),(0,x.jsx)(b().A,{forceVisibleState:o??t,renderTooltip:()=>{var e;return`${null===(e=a.current)||void 0===e?void 0:e.getBoundingClientRect().height}px`},placement:v().W.Right,render:()=>(0,x.jsx)("div",{style:s.r})}),(0,x.jsx)("div",{style:s.bl}),(0,x.jsx)(b().A,{placement:v().W.Bottom,forceVisibleState:o??t,renderTooltip:()=>{var e;return`${null===(e=a.current)||void 0===e?void 0:e.getBoundingClientRect().width}px`},render:()=>(0,x.jsx)("div",{style:s.b,children:(0,x.jsx)(w().A,{style:s.insetText,children:`${i}px inset`})})}),(0,x.jsx)("div",{style:s.br})]})}function M(){const{mode:e}=(0,r().DP)();return(0,u().O4)({theme:"light"===e?"dark":"light"})}function O(e){let{children:t,isInverted:o}=e;const{mode:n}=M();return o?(0,x.jsx)(i().wX,{mode:n,children:t}):(0,c().Du)(t)}const B=25;function V(e){return Boolean(e&&"object"==typeof e&&("isSourceMacroResult"in e||"value"in e&&"source"in e))}const $=(0,n.createContext)(!1);$.displayName="UIDocExpandAllCode"},540816:(e,t,o)=>{o.d(t,{NU:()=>y,O:()=>f,Rf:()=>m,SU:()=>h,cV:()=>g,fn:()=>v});o(362833),o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(725707),o(491955),o(403517);var n=()=>o(994966),i=()=>o(367950),l=()=>o(758989),r=()=>o(34662),a=()=>o(76394),s=()=>o(91338),p=()=>o(477784),c=()=>o(413871),d=()=>o(940445),u=()=>o(376896);function m(e){var t;const{collectionViewBlockStore:o,collectionStore:m,instanceMap:f}=e,y=m.id,g=(0,i()._)({table:"collection",id:y}),v=f[g]??{};if(!o.isReady()||!m.isReady())return;let I,b=!1;const w=o.getCollectionViewIds().map((e=>{const t=c().pS.createChildStore(o,{table:"collection_view",id:e}),i=t.getModel();if(!i)return void(b=!0);const l=t.getCollectionStore();if(!l)return void(b=!0);let r=!1;return I||"table"!==i.getType()||(I=e,r=!0),l.id===y?function(e){const{collectionViewStore:t,templateIdToInstancePointersMap:o,schema:i,isFirstTableView:l}=e,r=t.id;let a=t.getName();const c=t.getType(),u=h(o,"collection_view",r);let m;l&&!a&&(m=n().Gs,a=(0,d().getWorkflowTemplateName)(d().globalWorkflowTemplates.fromId(m)));!a&&c&&(a=p().A.intl.formatMessage(s().X[c]));return{type:"collection_view",name:a,id:r,viewType:c,format:t.getNormalizedFormat(i)??{},query:t.getRawQuery(),templateId:u,isFirstTableView:l,defaultBuiltinTemplateIdToMapTo:m}}({collectionViewStore:t,templateIdToInstancePointersMap:v,schema:l.getSchema(),isFirstTableView:r}):void 0})).filter(a().O9);if(b)return;const x=[];for(const n of w)if(n.isFirstTableView){const e=n.format;if(e.table_properties){for(const t of e.table_properties)t.visible&&x.push(t.property);if(x.length>0)break}}const T=m.getSchema(),C=Object.entries(T).map((e=>{let[t,o]=e;if(o)return function(e){const{propertyId:t,schema:o,instanceMap:n,templateIdToInstancePointersMap:l}=e,r="relation"===o.type&&o.collection_id?function(e,t){const o=(0,i()._)({table:"collection",id:t});return h(e[o]??{},"collection",t)}(n,o.collection_id):void 0;return{type:"property",id:t,name:o.name,schema:o,relatedCollectionTemplateId:r,templateId:h(l,"property",t),isSupported:u().Pg(o)}}({propertyId:t,schema:o,instanceMap:f,templateIdToInstancePointersMap:v})})).filter(a().O9),j=m.getLayoutStore();if(j&&!j.isReady())return;const S=null==j?void 0:j.getModel(),k=S?function(e){const{layoutModel:t,templateIdToInstancePointersMap:o}=e,n=h(o,"layout",t.id);let i;if(n){const e=d().globalWorkflowTemplates.fromId(n);"layout"===e.type&&(i=e.name)}return{id:t.id,type:"layout",templateId:n,name:i,layout:t.getRawModules(),spaceId:t.spaceId}}({layoutModel:S,templateIdToInstancePointersMap:v}):void 0,_=m.getAutomationStores().map((e=>e.pointer)),M=null===(t=m.getIcon())||void 0===t?void 0:t.icon,O=M&&(0,l().T8)(M)?M:void 0,B=m.getDescription();return{type:"collection",id:y,description:B,descriptionAsString:(0,r().q4_)(B),schema:T,templateId:h(v,"collection",y),name:(0,r().q4_)(m.getName()),pageTemplateIds:m.getTemplatePages(),format:m.getFormat(),icon:O,properties:C,collectionViews:w,firstTableViewId:I,layout:k,templateIdToInstancePointersMap:v,tableOrderPropertyIds:x,automationPointers:_}}function f(e){return"property"===e.type&&"title"===e.id}function y(e){return f(e)&&"Name"===e.schema.name}function g(e){const{collectionInfo:t,pageStore:o,instanceMap:n,recordMap:l}=e,a=(0,r().q4_)(o.getTitleValue())||"Untitled",s=n[(0,i()._)({table:"collection",id:t.id})]??{},p=new Set,c=o.getProperties();for(const i of Object.keys(c))"title"!==i&&p.add(i);return{type:"block",id:o.id,recordMap:l,templateId:h(s,"block",o.id),name:a,propertyIds:p,spaceId:o.getSpaceId()}}function h(e,t,o){var n;return null===(n=v(e,t,o))||void 0===n?void 0:n.templateId}function v(e,t,o){for(const[n,i]of Object.entries(e))for(const e of i)if(e.type===t&&e.id===o)return{...e,templateId:n}}},576217:(e,t,o)=>{o.r(t),o.d(t,{WorkflowTemplatesBuilderNotInProd:()=>io});var n=o(242343),i=()=>o(622286),l=(o(610931),o(403517),o(875472),o(76509),o(863754),()=>o(237385)),r=()=>o(803290),a=()=>o(174114),s=()=>o(3311),p=()=>o(286404),c=()=>o(381547),d=()=>o(927685),u=()=>o(76435);function m(e,t,o){!function(e,t){const o=(0,n.useRef)(),i=(0,n.useRef)();(0,n.useEffect)((()=>{if(o.current&&i.current!==t)throw new Error(`Assertion failure: "${e}" has changed. Original value was "${i.current}", but it is now "${t}".`);o.current=!0,i.current=t}),[e,t])}("persisted reducer key",e);const i=(0,n.useReducer)(t,void 0,(()=>{try{const t=window.sessionStorage.getItem(e);return t?JSON.parse(t):o}catch(t){return o}})),[l]=i;return(0,n.useEffect)((()=>{try{window.sessionStorage.setItem(e,JSON.stringify(l))}catch(t){}}),[e,l]),i}var f=()=>o(951592),y=()=>o(162901),g=()=>o(201430),h=()=>o(753030),v=(o(362833),()=>o(427091)),I=()=>o(220574),b=()=>o(34662),w=()=>o(818369),x=()=>o(795394),T=()=>o(759625),C=()=>o(448316),j=()=>o(413871),S=()=>o(545250);Error;function k(e){const{environment:t,transaction:o,rows:n,collectionInfo:{collectionId:i,spaceId:l,schema:r}}=e;let a=0,s=0;const p=function(e){const t=new Map;for(const[o,n]of Object.entries(e))n&&t.set(n.name,o);return t}(r),c=new(j().md)(t,{table:"collection",id:i,spaceId:l});for(const d of n){const{_id:e,...n}=d.value;let i;d.isNewRow?(i=T().Wv({environment:t,type:"page",inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,spaceId:l}),x().X$({childStore:i,parentStore:c,transaction:o}),a+=1):(i=j().Bv.createChildStore(c,{table:"block",id:e,spaceId:l}),s+=1);for(const[l,a]of Object.entries(n)){const e=p.get(l);if(!e)throw new Error(`Unable to find property id for "${l}"`);const n=r[e];if(!n)throw new Error(`No property schema found for "${l}"`);const s=_({value:a,schema:n}),c="title"===e?i.getBlockTitleStore():i.getPropertiesStore().getKeyStore(e);C().R9({environment:t,store:c,transaction:o,value:s})}}return{created:a,updated:s}}function _(e){const{value:t}=e;if("string"!=typeof t&&void 0!==t)throw new Error("Only property strings are currently supported.");return(0,b().x9d)(t)}function M(e){throw new Error("usePrototypeCollectionRows should never be used in production")}var O=()=>o(214144),B=()=>o(84543),V=()=>o(633144);function $(e){const{environment:t,templates:o,collectionInfo:n,templateToRowIdMap:i}=e,l=function(e,t){const o=[];for(const n of e){const e=!t.has(n.templateId),i=t.get(n.templateId)??(0,O().JW)();o.push({isNewRow:e,value:{_id:i,Name:n.templateId,JSON:JSON.stringify(n,null,2)}})}return o}(o,i);return B().createAndCommit({userAction:"prototypeBuilderRegistryActions.upsertWorkflowTemplatesToPrototypeBuilderRegistry",environment:t,canUndo:!0,perform:e=>k({environment:t,collectionInfo:n,transaction:e,rows:l})})}function N(e){let{rows:t}=e;const o=function(e){const{collectionInfo:t,errors:o}=e,n=[];for(const l of e.rows)if(l.JSON)try{const e=JSON.parse(l.JSON);n.push({collectionRowId:l._id,template:e})}catch(i){if(!(i instanceof Error))throw i;o.push({id:l._id,error:i})}return{collectionInfo:t,errors:o,templatesWithRowIds:n,templateToRowIdMap:R(n)}}(t);o.errors.length>0&&console.warn("Errors loading prototype workflow template builder registry:",o.errors),V().A.setState(o)}function R(e){const t=new Map;for(const o of e){const e=o.template.templateId,n=o.collectionRowId;t.has(e)&&console.warn(`Duplicate definition for template id "${e}" found.`,o.template),t.set(e,n)}return t}var A=()=>o(627618);A().object({required:{_id:A().string()},optional:{Name:A().string(),JSON:A().string()}});var P=()=>o(836331);function D(){return(0,r().K8)((()=>F?F.getState():P().default.getConfigKey("workflow_templates_builder_config","prototype_registry_view_url")),[])}const F=void 0;(0,o(996094).exposeDebugValue)("WorkflowTemplatesBuilderLocalRegistryViewUrlStore",F);var L=o(163643);function E(){const e=D();return e?(0,L.jsx)(W,{viewUrl:e}):null}function W(e){const{viewUrl:t}=e,o=M();return(0,n.useEffect)((()=>{o.value&&N({rows:o.value})}),[o]),null}function U(e,t){var o;switch(t.type){case"reset":return K;case"setUrl":return{...K,url:t.url};case"setMultiCollectionPageUrl":return{...K,multiCollectionPageUrl:t.url};case"setCreateCopy":return{...e,createCopy:t.createCopy};case"addNewCompoundTemplate":return{...e,newCompoundTemplates:[...e.newCompoundTemplates??[],{id:(0,s().Ay)(),initialName:t.initialName}]};case"setFeatureOrdering":return{...e,featureOrdering:t.featureOrdering};case"updateBuilderSettings":return{...e,builderSettings:{...e.builderSettings,[t.key]:{...null===(o=e.builderSettings)||void 0===o?void 0:o[t.key],[t.property]:t.value}}}}}const K={url:"",multiCollectionPageUrl:"",createCopy:!1};o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(725707),o(491955),o(771702);var q=()=>o(505966),z=()=>o(293665),J=()=>o(653998),G=()=>o(76394),H=()=>o(141666),Q=()=>o(814370),X=()=>o(381697),Y=()=>o(940445),Z=()=>o(727528),ee=()=>o(901552);var te=()=>o(540816),oe=()=>o(367950),ne=()=>o(711659),ie=()=>o(477784);const le=3;o(107652);var re=()=>o(706788),ae=()=>o(145017),se=()=>o(134549);function pe(e){const{spaceId:t,collectionInfo:o,collectionStore:i,instanceMap:a}=e,s=(0,l().v3)(),p=(0,r().K8)((()=>{if(t&&null!=o&&o.pageTemplateIds&&i)return o.pageTemplateIds.map((e=>j().Bv.createChildStore(i,{table:ae().ev,id:e})))}),[null==o?void 0:o.pageTemplateIds,i,t]),c=(0,r().K8)((()=>!!p&&p.every((e=>ce(e)))),[p]),d=(0,r().K8)((()=>{if(!(t&&p&&o&&a&&c))return;return p.map((e=>{const t=(0,se().loadLocalSubtree)(s,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0,includeLegacyTransclusionBlockValues:!1,excludeCrdtData:!0}),n=(0,b().q4_)(e.getTitleValue());if("error"===t.type)return{type:"error",error:`For page template "${n}", loadLocalSubtree returned "${t.reason}" for ${t.pointer.table} ${t.pointer.id}.`};const{recordMap:i}=t;for(const o of i.getModelsByTable(ae().ev))if(o.isExternalObjectInstanceType()){const e=o.getFormat();if(!e.is_placeholder)return{type:"error",error:`For page template "${n}", external object instance ${o.id} is not a placeholder.`};if(!(0,re().CX)({integrationId:e.integration_id}))return{type:"error",error:`For page template "${n}", external object instance ${o.id} is not a Notion-owned integration.`}}for(const{model:o}of t.recordMap)null==o||o.__IM_SORRY__getValue();const l=(0,te().cV)({collectionInfo:o,pageStore:e,recordMap:i,instanceMap:a});return l?{type:"success",blockInfo:l}:{type:"error",error:`For page template "${n}", getBlockInfo returned undefined.`}}))}),[t,p,o,a,c,s]);return(0,n.useMemo)((()=>{if(!d)return{infos:void 0,errors:[]};const e=[],t=[];for(const o of d)"success"===o.type?e.push(o.blockInfo):t.push(o.error);return t.length>0?{infos:void 0,errors:t}:{infos:e,errors:t}}),[d])}function ce(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.isReady())return!1;if(t[e.id])return!0;t[e.id]=!0;const o=[];if(e instanceof j().Bv){o.push(...e.getContentStores()),o.push(...e.getNonContentChildrenStores()),o.push(...e.getCollectionViewStores());const t=e.getCollectionStore();t&&o.push(t);const n=e.getTransclusionReferenceTargetStore();n&&o.push(n)}else e instanceof j().pS||e instanceof j().md||(0,G().HB)(e);return o.every((e=>ce(e,!1,t)))}const de=(0,n.createContext)(null);function ue(){const e=(0,n.useContext)(de);if(!e)throw new Error("Persisted context not found");return e}function me(e){var t,o,i,a,s;let p,c;const{state:u,dispatch:m,allIcons:b,requireTemplateInstance:x,templateRegistryMap:T,templateProvider:C}=e,k=(0,l().v3)(),_=function(e){const t=(0,S().parseRoute)({url:e,isMobile:!1,baseUrl:d().A.domainBaseUrl,publicDomainName:d().A.publicDomainName,protocol:d().A.protocol,currentUrl:void 0});if("page"===t.name&&t.blockId)return{blockId:t.blockId}}((null==u?void 0:u.url)??""),M=null==_?void 0:_.blockId;_||(p??="Invalid collection URL");const O=(0,r().K8)((()=>M?function(e){const{environment:t,collectionViewBlockId:o}=e,n=new(j().Bv)(t,{table:"block",id:o});if(!n.isReady())return{type:"loading"};if(!n.getModel())return{type:"error",message:"Inaccessible collection view block"};if(!n.isCollectionView())return{type:"error",message:"Block is not a collection view block/page"};const i=n.getCollectionStore();return null!=i&&i.isReady()?i.getModel()?{type:"success",collectionViewBlockStore:n,collectionStore:i,spaceId:i.getSpaceId()}:{type:"error",message:"Inaccessible collection"}:{type:"loading"}}({collectionViewBlockId:M,environment:k}):{type:"loading"}),[M,k]);let B;switch(O.type){case"error":p??=O.message;break;case"loading":c??="Loading collection";break;case"success":B=O;break;default:(0,G().HB)(O)}const V=null===(t=B)||void 0===t?void 0:t.spaceId,$=null===(o=B)||void 0===o?void 0:o.collectionStore.id,N=null===(i=B)||void 0===i?void 0:i.collectionStore,R=(0,r().K8)((()=>{if(!N)return;const e=(0,X().loadWorkflowTemplateInstances)(N);return e.isLoading?{status:"pending"}:{status:"resolved",value:{[`collection:${N.id}`]:(0,Z().b3)(e.instances)}}}),[N]),A=(0,n.useMemo)((()=>{if(null!=R&&R.value)return function(e,t){const o={};for(const n of(0,H().HP)(e)){const i=e[n];o[n]=(0,Z().ju)(i,t)}return o}(R.value,C)}),[null==R?void 0:R.value,C]),P=null===(a=B)||void 0===a?void 0:a.collectionViewBlockStore;let D=(0,r().K8)((()=>{if(P&&N&&A)return(0,te().Rf)({collectionViewBlockStore:P,collectionStore:N,instanceMap:A})}),[N,P,A]);D||(c??="Loading collection dependencies");const F=function(e,t){const o=(0,l().v3)(),i=null==e?void 0:e.id,r=null==e?void 0:e.firstTableViewId,a="collection_group_results",[s,p]=(0,n.useState)(0);(0,n.useEffect)((()=>{if(!i)return;const e=new(h().C)(o,(0,g().eG)(i),(()=>{p((e=>e+1))}));return e.subscribe(),()=>{e.unsubscribe()}}),[i,o]);const c=(0,f().lW)(s,250,Object.is),[d]=(0,y().Yb)((async()=>{if(!r||!i||!t)return;const e=await w().callApi({eventName:"queryCollection",environment:o,data:{collectionView:{spaceId:t,id:r},source:{type:"collection",id:i,spaceId:t},loader:{filter:{operator:"or",filters:void 0},reducers:{[a]:{type:"results",limit:le}},searchQuery:"",sort:[],userId:o.currentUser.id,userTimeZone:(0,v().P)()}}}),n=[];if("success"===e.type){const t=e.data.result.reducerResults[a];if("results"===t.type){const{blockIds:o}=t,i=I().RecordMapWithRole.create(e.data.recordMap);for(const e of o){const t=i.getModel({table:"block",id:e});t&&n.push({properties:t.getProperties(),icon:t.getFormat().page_icon})}}}return n}),[i,c,o,r,t]);return d.value}(D,V);F||(c??="Loading example rows"),x&&D&&!D.templateId&&(p=`Collection "${D.name}" is not an instance of a workflow template`,D=void 0);const{infos:L,errors:E}=function(e){const{spaceId:t,collectionInfo:o,collectionStore:n,instanceMap:i}=e;return(0,r().K8)((()=>{if(!(t&&o&&n&&i))return{infos:void 0,errors:[]};const e=[];for(const n of o.properties)"button"===n.schema.type&&n.schema.automation_id&&e.push({table:ne().yB,id:n.schema.automation_id,spaceId:t});e.push(...o.automationPointers);const l=[],r=[],a=[];for(const s of e){const e=j().dn.createChildStore(n,s);if(!e||!e.isDefined()){r.push(`Loading automation ${s.id}...`);continue}const a=(0,oe()._)({table:"collection",id:o.id}),p=i[a]??{},c=e.getNameWithDefault(ie().A.getIntl()),d=e.getModel(),u=[];for(const t of e.getActionStores())t.isDefined()?u.push(t.getModel()):r.push(`Loading action ${t.id}...`);l.push({type:"automation",id:s.id,templateId:(0,te().SU)(p,"automation",e.id),spaceId:t,name:c,referrerName:(0,ee().PT)(c),automationModel:d,automationActionModels:u})}return r.length>0||a.length>0?{infos:void 0,errors:a}:{infos:l,errors:a}}),[o,n,i,t])}({spaceId:V,collectionInfo:D,collectionStore:N,instanceMap:A});L||(c??="Loading automations");const{infos:W,errors:U}=pe({spaceId:V,collectionInfo:D,collectionStore:N,instanceMap:A});W||(c??="Loading page templates");const K=(0,n.useMemo)((()=>{var e;const t=null===(e=D)||void 0===e?void 0:e.templateId;if(!t)return;const o=T.get(t);return"collection"===(null==o?void 0:o.type)?o:void 0}),[null===(s=D)||void 0===s?void 0:s.templateId,T]),Q=(0,n.useMemo)((()=>{if(!K||!D)return[];return(0,q().bQ)(K).map((e=>{const t=T.get(e);if("compound"===(null==t?void 0:t.type))return t})).filter(G().O9)}),[D,K,T]),re=(0,n.useMemo)((()=>{var e;return[...Q.map((e=>({type:"compound",id:e.templateId,name:e.name,templateId:e.templateId}))),...(null===(e=u.newCompoundTemplates)||void 0===e?void 0:e.map((e=>({type:"compound",id:e.id,name:e.initialName,templateId:void 0}))))??[]]}),[Q,u.newCompoundTemplates]),{uninstantiatedFeatures:ae,instantiatedFeatures:se}=(0,n.useMemo)((()=>{if(!D||!L||!W)return{instantiatedFeatures:[],uninstantiatedFeatures:[]};const e=[...D.properties,...D.collectionViews,...re,...W,...L,D.layout].filter(G().O9);if(!K)return{instantiatedFeatures:e,uninstantiatedFeatures:[]};const t=new Set(e.map((e=>e.templateId)).filter(G().O9));return{instantiatedFeatures:e,uninstantiatedFeatures:(0,q().bQ)(K).filter((e=>!t.has(e))).map((e=>{const t=T.get(e);if(t)return{type:"uninstantiated_template",id:t.templateId,templateId:t.templateId,name:(0,Y().getWorkflowTemplateName)(t)}})).filter(G().O9)}}),[L,D,re,W,K,T]),ce=(0,n.useMemo)((()=>[...se,...ae]),[se,ae]),de=(0,n.useMemo)((()=>{const e=new Map;return D?([D,...ce].forEach((t=>{t.templateId&&e.set(t.templateId,(0,ee().vO)(t))})),e):e}),[ce,D]),ue=(0,n.useMemo)((()=>{const e=new Map;return D&&W?([D,...ce,...W].forEach((t=>{e.set((0,ee().vO)(t),t)})),e):e}),[ce,D,W]),me=(0,n.useMemo)((()=>{if(!D)return[];const e=ce.map((e=>(0,ee().vO)(e))),t=new Set(e),o=(K?(0,q().bQ)(K):[]).map((e=>de.get(e))).filter(G().O9),n=(0,H().sb)(u.featureOrdering??[]).filter((e=>t.has(e))),i=new Set(n),l=D.tableOrderPropertyIds.map((e=>{const t=(0,ee().vO)({type:"property",id:e});if(ue.has(t))return t})).filter(G().O9),r=e=>{for(const t of e)i.has(t)||(n.push(t),i.add(t))};r(o),r(l),r(e);return function(e,t){const o=new Set(t);e=e.filter((e=>o.has(e)));const n=new Set(e),i=[];for(const l of t)if(n.has(l)){const t=e.shift()??l;i.push(t)}else i.push(l);return i}(D.collectionViews.map((e=>(0,ee().vO)(e))),n)}),[ce,D,ue,K,u.featureOrdering,de]),fe=(0,n.useMemo)((()=>null!=P&&P.pointer&&V?{...null==P?void 0:P.pointer,spaceId:V}:void 0),[null==P?void 0:P.pointer,V]);"en-US"!==(0,J().tz)().locale&&(p??="You must be on the English locale to use the builder.");return(0,n.useMemo)((()=>{if(!p&&D&&fe&&N&&L&&W){var e;return{type:"loaded",context:{state:u,dispatch:m,templateRegistryMap:T,templateProvider:C,templateIdToBuilderKeyMap:de,featureInfoMap:ue,collectionInfo:D,sourceCollectionTemplate:K,isOriginalSourceCollectionViewBlock:Boolean(K&&(null===(e=K.builderMetadata)||void 0===e?void 0:e.sourceCollectionViewBlock)&&z().L3.isEqual(K.builderMetadata.sourceCollectionViewBlock,fe)),exampleRows:F,compoundTemplateInfos:re,collectionStore:N,featureOrdering:me,uninstantiatedFeatures:ae,allIcons:b,pageTemplatesInfos:W,pageTemplatesErrors:U,automationInfos:L,automationErrors:E,sourceCollectionViewBlockPointer:fe}}}return null!=u&&u.url?p?{type:"error",message:p,collectionId:$,collectionViewBlockId:M}:{type:"loading",message:c,collectionId:$,collectionViewBlockId:M}:{type:"emptyInput"}}),[D,fe,N,L,W,u,p,c,$,M,m,T,C,de,ue,K,F,re,me,ae,b,U,E])}de.displayName="BuilderContext";var fe=()=>o(994966);function ye(){const e=(0,J().tz)(),t=(0,r().K8)((()=>{var t;const o=(null===(t=V().A.state)||void 0===t?void 0:t.templatesWithRowIds.map((e=>e.template)))??[],n=(0,fe().Cb)(e,{localizeTemplates:!1,stage:"next"}),i=new Map;for(const e of n)i.set(e.templateId,e);for(const e of o)i.set(e.templateId,e);return i}),[e]),o=(0,n.useMemo)((()=>new(q().GH)((e=>{const o=t.get(e);if(!o)throw new Error(`Template not found in builder context: "${e}"`);return o}))),[t]);return(0,n.useMemo)((()=>({templateRegistryMap:t,templateProvider:o})),[o,t])}var ge=()=>o(268525),he=()=>o(575015),ve=()=>o(97787);function Ie(e){const{builderContext:t,item:o}=e;if("property"===o.type&&!o.isSupported)return{type:"ignore",reason:"unsupported_property_type"};const n=(0,ee().rW)(t,o);if(n.ignore)return{type:"ignore",reason:"ignore_checkbox_is_checked"};if("uninstantiated_template"===o.type)return n.isDeleted?{type:"ignore",reason:"deleted"}:{type:"mapToTemplateId",templateId:o.templateId,includeInCollectionTemplate:!0};const i=n.templateId??"";return i?n.isDeleted?{type:"ignore",reason:"deleted"}:t.state.createCopy&&!n.bypassCreateCopy&&t.templateRegistryMap.has(i)?{type:"invalidCopyName"}:n.shouldMapToTemplate?{type:"mapToTemplateId",templateId:i,includeInCollectionTemplate:n.includeInCollectionTemplate}:{type:"createOrUpdateTemplate",templateId:i,includeInCollectionTemplate:n.includeInCollectionTemplate}:{type:"ignore",reason:"empty_template_id"}}o(500234);var be=o.n(o(938762)),we=()=>o(435084),xe=(o(113085),o.n(o(485359))),Te=()=>o(218508),Ce=()=>o(564134),je=()=>o(716605),Se=()=>o(185912),ke=()=>o(758989);function _e(e){return/[\"\']/.test(e)}var Me=()=>o(816612);const Oe=new Set(["designGoalsCollection","habitTrackerCollection","meetingOneOnOnesCollection","notesCollection","tasksCollectionForNewUserExperiment","feedbackTrackerCollection","complianceTrackerCollection"]);function Be(e){return"select"===e.type||"multi_select"===e.type}function Ve(e){const{templateId:t,validatorName:o,validatorTestName:n,message:i}=e;return`${[t,o,n].filter(G().O9).join(" -> ")}: ${i}`}class $e{constructor(e){this.templates=void 0,this.templatesRegistry=new Map,this.validators=[],this.currentTemplateId=void 0,this.currentValidatorName=void 0,this.currentValidatorTestName=void 0,this.pipelineStage=void 0,this.errors=[],this.provider=void 0,this.pipelineStage=e.pipelineStage,this.templates=e.templatesToValidate;const t=[...e.templatesToValidate,...e.templatesRegistry??[]];for(const o of t)this.templatesRegistry.has(o.templateId)||this.templatesRegistry.set(o.templateId,o);this.provider=new(q().GH)(this.getWorkflowTemplateFromId.bind(this))}getWorkflowTemplateFromId(e){const t=this.templatesRegistry.get(e);return xe().ok(t,`Template "${e}" must exist`),t}ensureTemplateIdType(e,t){if(this.getWorkflowTemplateFromId(e).type!==t)throw new Error(`Template "${e}" is not of type "${t}"`)}logInvalidTemplateIds(e){for(const t of e??[])this.templatesRegistry.has(t)||this.log("error",`Template id "${t}" does not exist`)}captureExceptions(e,t){try{t()}catch(o){if(o instanceof Error)return void this.log(e,o.message);throw o}}test(e,t){this.testWithLevel("error",e,t)}testWarning(e,t){this.testWithLevel("warning",e,t)}testWithLevel(e,t,o){if(!this.currentTemplateId||!this.currentValidatorName)throw new Error("This method should only be run from a validator");this.currentValidatorTestName=t,this.captureExceptions(e,o),this.currentValidatorTestName=void 0}log(e,t){if(!this.currentTemplateId||!this.currentValidatorName)throw new Error("This method should only be run from a validator");this.errors.push({level:e,templateId:this.currentTemplateId,validatorName:this.currentValidatorName,validatorTestName:this.currentValidatorTestName,message:t})}addValidator(e,t){this.validators.push({name:e,validator:t})}run(){for(const e of this.templates){this.currentTemplateId=e.templateId;for(const{name:t,validator:o}of this.validators)this.currentValidatorName=t,this.captureExceptions("error",(()=>o(this,e))),this.currentValidatorName=void 0;this.currentTemplateId=void 0}}}function Ne(e){const t=new(Te().G)((()=>0));for(const n of e){const e=t.get(n);t.set(n,e+1)}const o=[];for(const[n,i]of t.entries())i>1&&o.push(`${n} (${i})`);if(o.length>0)throw new Error(`Duplicates found: ${o.join(", ")}`)}var Re=()=>o(975392),Ae=()=>o(775781);function Pe(e){const{builderContext:t,item:o}=e,n=Ie({builderContext:t,item:o});if(!n.templateId)return;const{templateId:i}=n;if(o.templateId===i)return;const l=function(e,t){switch(e.type){case"uninstantiated_template":case"compound":return;case"collection":return{type:"collection",id:e.id};case"collection_view":return{type:"collection_view",id:e.id};case"layout":return{type:"layout",id:e.id,spaceId:e.spaceId};case"property":return{type:"property",id:e.id,collectionId:t.id};case"block":return{type:"block",id:e.id,spaceId:e.spaceId};case"automation":return{type:"automation",id:e.id,spaceId:e.spaceId};default:(0,G().HB)(e)}}(o,t.collectionInfo);if(!l)return;return(0,te().fn)(t.collectionInfo.templateIdToInstancePointersMap,l.type,l.id)?{type:"update",pointer:l,templateId:i}:{type:"create",pointer:l,templateId:i}}var De=()=>o(889110),Fe=()=>o(465546),Le=()=>o(21164),Ee=()=>o(289765);function We(e){let{schema:t,collectionViewType:o,primitiveFormat:n}=e;const i={collection_view_icon:n.collection_view_icon,collection_group_by:n.collection_group_by,collection_groups:Ue(n.collection_groups),property_filters:n.property_filters,collection_group_aggregation:n.collection_group_aggregation,hide_linked_collection_name:n.hide_linked_collection_name,collection_peek_mode:n.collection_peek_mode,description:n.description,show_page_icon:n.show_page_icon,collection_view_default_template:n.collection_view_default_template};for(const[r,a]of Object.entries(n))r.startsWith(o)&&(r.endsWith("_properties")&&Array.isArray(a)?i[r]=(l=a,l.filter((e=>!1!==e.visible))).filter((e=>Boolean(t[null==e?void 0:e.property]))):i[r]=a);var l;return i}function Ue(e){if(e&&e.length>0)return e}function Ke(e){var t;let{collectionViewTemplateValue:o,mapper:n}=e;const i={};var l;"object"==typeof(null===(t=o.format)||void 0===t?void 0:t.collection_view_default_template)&&n.populateDependencyMap((0,ee().vO)({type:"block",id:null===(l=o.format)||void 0===l?void 0:l.collection_view_default_template.template_page_id}),i);(0,q().$G)({object:o,callback:e=>{const t=e.property;n.populateDependencyMap((0,ee().vO)({type:"property",id:t}),i)}});const{query2:r}=o;if(r)for(const a of q().Nf){const e=r[a];e&&n.populateDependencyMap((0,ee().vO)({type:"property",id:e}),i)}return i}var qe=()=>o(376896);const ze="__self__";function Je(e){const{collectionInfo:t,compoundTemplateInfos:o,pageTemplatesInfos:n,automationInfos:i}=e,l={templateOutputs:[],instanceActions:[],errors:[],warnings:[],debugMessages:[],counts:{new:0,changed:0,unchanged:0},hasNewOrChangedTemplates:!1,fakeLocalizedTemplates:void 0},r=new Map;for(const[f,y]of e.featureInfoMap.entries()){const t=Ie({builderContext:e,item:y});t.templateId&&r.set(f,t.templateId)}let a;for(const f of t.collectionViews)f.isFirstTableView&&(a=f);for(const f of t.properties){const o=Ie({builderContext:e,item:f});"createOrUpdateTemplate"===o.type&&Ge({builderContext:e,propertyInfo:f,templateId:o.templateId,collectionInfo:t,builderKeyToTemplateIdMap:r,firstTableViewInfo:a,output:l})}for(const f of t.collectionViews){const t=Ie({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&He({builderContext:e,collectionViewInfo:f,templateId:t.templateId,builderKeyToTemplateIdMap:r,output:l})}for(const f of n){const t=Ie({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&Xe({builderContext:e,blockInfo:f,builderKeyToTemplateIdMap:r,templateId:t.templateId,output:l})}for(const f of i){const t=Ie({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&Qe({builderContext:e,automationInfo:f,builderKeyToTemplateIdMap:r,templateId:t.templateId,output:l})}for(const f of o){const t=Ie({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&Ye({builderContext:e,compoundTemplateInfo:f,templateId:t.templateId,output:l})}const s=t.layout;if(s){const t=Ie({builderContext:e,item:s});"createOrUpdateTemplate"===t.type&&function(e){const{builderContext:t,layoutInfo:o,templateId:n,output:i,builderKeyToTemplateIdMap:l}=e,r={},a=new et(n,l,t.featureInfoMap,i),s=(0,Ae().CF)(o.layout);for(const d of s)a.populateDependencyMap(d,r);const p=(0,ee().rW)(t,o),c={templateId:n,type:"layout",name:p.name,value:o.layout,dependencyMap:r};Ze(t,i,c,o)}({builderContext:e,layoutInfo:s,templateId:t.templateId,builderKeyToTemplateIdMap:r,output:l})}const p=Ie({builderContext:e,item:t});"createOrUpdateTemplate"===p.type&&function(e){const{builderContext:t,collectionInfo:o,builderKeyToTemplateIdMap:n,templateId:i,output:l}=e,r=(0,ee().rW)(t,o),a=t.featureOrdering.map((e=>{const o=t.featureInfoMap.get(e);if(!o)return;const n=Ie({builderContext:t,item:o});return"ignore"!==n.type&&"invalidCopyName"!==n.type&&n.includeInCollectionTemplate?{item:o,settings:(0,ee().rW)(t,o),templateId:n.templateId}:void 0})).filter(G().O9),s=o.format?{collection_default_template:o.format.collection_default_template,item_name_config_v2:o.format.item_name_config_v2}:void 0,p={},c=new et(i,n,t.featureInfoMap,l);"object"==typeof(null==s?void 0:s.collection_default_template)&&c.populateDependencyMap((0,ee().vO)({type:"block",id:s.collection_default_template.template_page_id}),p);for(const u of t.exampleRows??[])for(const e in u.properties)c.populateDependencyMap((0,ee().vO)({type:"property",id:e}),p);const d={type:"collection",description:r.description||o.descriptionAsString,category:(0,ee().To)(r.category),value:{targetCollection:{name:o.name,icon:o.icon??ee().Jp,description:o.description,itemName:{singular:r.singularItemName,plural:r.pluralItemName},format:s},exampleRows:t.exampleRows,templateItems:a.map((e=>({pointer:e.templateId,optionality:e.settings.optionality,isInSettings:!!e.settings.isInSettings||void 0}))),onboarding:{isMinimal:r.hasMinimalOnboarding}},templateId:i,dependencyMap:p,builderMetadata:{env:"production",sourceCollectionViewBlock:t.sourceCollectionViewBlockPointer,sourceFirstTableViewId:o.firstTableViewId}};Ze(t,l,d,o)}({builderContext:e,collectionInfo:t,builderKeyToTemplateIdMap:r,templateId:p.templateId,output:l});const c=l.templateOutputs.map((e=>e.template)),d=(0,J().EY)({locale:"fr",defaultLocale:"en-US",messages:{}});try{l.fakeLocalizedTemplates=(0,we().IC)({},d,c,{shouldFakeLocalization:!0,strict:!1})}catch(m){if(!(m instanceof Error))throw m;l.warnings.push(`Some content may need engineering support to be made localizable: ${m.message}`)}const u=function(e){const t=new $e(e);return t.addValidator("template contains no template instance metadata",((e,t)=>{const o=["workflow_template_instance","compound_workflow_template_instances"],n=JSON.stringify(t);for(const i of o)n.includes(i)&&e.log("warning",`Template JSON contains "${i}"--are we properly removing instance metadata from our primitives?`)})),t.addValidator("dependency map",((e,t)=>{"dependencyMap"in t&&(e.test("contains valid template IDs",(()=>{e.logInvalidTemplateIds(Object.values(t.dependencyMap??{}))})),e.test("is declared on templates with dependencies",(()=>{"collection_view"!==t.type&&"layout"!==t.type||xe().ok(void 0!==t.dependencyMap)})))})),t.addValidator("property template is valid",((e,t)=>{"property"===t.type&&(e.test("relationCollectionTemplateId is only set for relation property template",(()=>{xe().equal(void 0!==t.relatedCollectionTemplateId,"relation"===t.value.type),t.relatedCollectionTemplateId&&e.ensureTemplateIdType(t.relatedCollectionTemplateId,"collection")})),e.test("buttonAutomationId is only set for button property template",(()=>{xe().equal(void 0!==t.buttonAutomationId,"button"===t.value.type),t.buttonAutomationId&&e.ensureTemplateIdType(t.buttonAutomationId,"automation")})),e.test("propertyOptionsType is set correctly",(()=>{xe().equal(void 0!==t.propertyOptionsType,Be(t.value))})))})),t.addValidator("contains no files",((e,t)=>{const o=(t,o)=>{const n=(0,je().pJ)(o).filter((e=>(0,Se().Nh)(e.url))).map((e=>`${e.name} (${e.url})`)).join(", ");n.length>0&&e.log("error",`${t} contains files: ${n}`)},n=(e,t)=>{for(const[n,i]of Object.entries(t??{}))o(`${e} property "${n}"`,i)};if("collection"===t.type)(t.value.exampleRows??[]).forEach(((e,t)=>{n(`Example row ${t}`,e.properties)}));else if("block"===t.type){const e=I().RecordMap.create(t.value.recordMap);for(const t of e.getModelsByTable("block"))n(`Block ${t.id}`,t.getProperties())}})),t.addValidator("compound template is valid",((e,t)=>{"compound"===t.type&&(e.test("contains valid templates",(()=>{for(const o of t.value.templateItems){const t=e.getWorkflowTemplateFromId(o.pointer);xe().ok((0,q().$K)(t))}})),e.test("contains two or more templates",(()=>{const e=t.value.templateItems.length;xe().ok(e>=2)})),e.test("has notion static icon",(()=>{xe().ok((0,ke().T8)(t.icon))})),e.test("has no duplicate template IDs",(()=>{Ne(t.value.templateItems.map((e=>e.pointer)))})),e.test("contains all its dependencies",(()=>{for(const o of t.value.templateItems){const n=e.getWorkflowTemplateFromId(o.pointer);if((0,q().$K)(n)){const i=(0,q().Z6)({template:n});for(const n of i){if("collection"===e.getWorkflowTemplateFromId(n.templateId).type)continue;const i=t.value.templateItems.find((e=>e.pointer===n.templateId));i||e.log("warning",`Compound template has explicit dependency "${o.pointer}", which depends on "${n.templateId}" (via ${n.debugSource}). However, the latter is not part of the compound template--it should be!`)}}}})))})),t.addValidator("collection template is valid",((e,t)=>{if("collection"!==t.type)return;const o=(0,q().bQ)(t),n=o.map((t=>e.getWorkflowTemplateFromId(t)));e.testWarning("has description",(()=>{xe().ok(t.description,"collection template should specify description so it'll look nice in suggestions & during onboarding")})),e.test("has valid templateItems",(()=>{for(const o of t.value.templateItems){const t=e.getWorkflowTemplateFromId(o.pointer);xe().ok(t,`No template found for ID ${o.pointer}`),xe().ok((0,q().Jb)(t),`${o.pointer} is not of FeatureTemplate type`),o.isInSettings&&(xe().ok((0,q().bz)(t),`${o.pointer} is not of FeatureTemplateInSettings type`),xe().ok("compound"!==t.type,"Compound template cannot have isInSettings set to true"))}})),e.test("has no duplicate templates across all available template IDs",(()=>{Ne(o)})),e.test("doesn't have two or more relation properties pointing to the same collection preset",(()=>{Ne(n.filter(q().Sz).map((e=>e.relatedCollectionTemplateId)))})),e.test("has valid category",(()=>{t.category&&xe()(Me().RX.includes(t.category))})),e.test("has notion static icon",(()=>{xe().ok((0,ke().T8)(t.value.targetCollection.icon))}));const i=t.value.templateItems.map((t=>({template:e.getWorkflowTemplateFromId(t.pointer),templateItem:t})));e.test("has at most one title property template, which is required",(()=>{const e=i.filter((e=>"property"===e.template.type&&"title"===e.template.value.type));xe().ok(e.length<=1),1===e.length&&xe().ok("required"===e[0].templateItem.optionality)}));const l=t.value.templateItems.filter((t=>"collection_view"===e.getWorkflowTemplateFromId(t.pointer).type)),r=(0,q().A6)(t,e.provider);e.test("contains no required collection_view templates",(()=>{const e=l.filter((e=>"required"===e.optionality)).map((e=>e.pointer));xe().deepStrictEqual(e,[])})),(0,q().cB)(t.templateId)||("next"!==e.pipelineStage&&"M3_3"!==e.pipelineStage||Oe.has(t.templateId)||e.test("contains at least 3 collection_view templates, with 1 optionalDefaultOff",(()=>{l.length<3&&e.log("warning","A collection template should contain at least 3 collection_view templates."),l.some((e=>"optionalDefaultOff"===e.optionality))||e.log("warning","At least one collection_view template should be optionalDefaultOff, to avoid confusing users in the view step.")})),e.test("contains at least 1 collection_view template that is optionalDefaultOn, and is of a supported type",(()=>{xe().ok(r.length>0,"must have at least one default-on view");const t=r[0].value.type;(0,Me().QE)(t)||e.log("warning",`Unsupported default view type "${t}" (engineering will need to add thumbnail support for it).`)})),e.test("has at least one default-on table collection view",(()=>{const t=r.some((e=>"table"===e.value.type));t||e.log("warning","Template has no default-on table views. For user comprehension, we should always be shipping at least one default-on table view per collection.")})),e.test("no people properties assigned to a user",(()=>{(t.value.exampleRows??[]).forEach(((o,n)=>{for(const[l,r]of Object.entries(o.properties??{})){var i;const o=(0,q().Ir)("property",l),r=null===(i=t.dependencyMap)||void 0===i?void 0:i[o];if(!r)continue;const a=e.provider.fromId(r);(0,q().Xq)(a,"property")&&"person"===a.value.type&&e.log("warning",`Example row ${n} has non-empty person property: ${a.value.name}`)}}))})),"next"!==e.pipelineStage&&"M3_3"!==e.pipelineStage||Oe.has(t.templateId)||e.test("all default off collection views show after the default-on collection views",(()=>{const o=new Set((0,q().Mt)({featureTemplateItems:t.value.templateItems,optionality:"optionalDefaultOn",type:"collection_view",provider:e.provider})),n=e.provider.allOfType({templateIds:t.value.templateItems.map((e=>e.pointer)),type:"collection_view"}).findIndex((e=>!o.has(e.templateId)));-1!==n&&n<=o.size-1&&e.log("warning","Default-off collection views should show after the default-on collection views.")})))})),t.addValidator("template contains no user facing strings with straight quotes",((e,t)=>{try{(0,we().nK)([t],{visitString(t,o){let{id:n,defaultMessage:i}=t;return _e(i)&&e.log("warning",`String "${i}" contains straight quotes and is a user facing string.`),i},visitTextValue(t,o,n){let{id:i}=t;if("property"===(null==n?void 0:n.type)&&(0,Ce().$M)(n.value)&&(0,Ce().om)(n.value))return o;const l=(0,b().q4_)(o);return _e(l)&&e.log("warning",`String "${l}" contains straight quotes and is auser facing string.`),o}},{strict:!1})}catch(m){if(!(m instanceof Error))throw m;e.log("warning",`Encountered an error while validating user facing strings: ${m.message}`)}})),t.run(),t.errors}({templatesToValidate:l.templateOutputs.map((e=>e.template)),templatesRegistry:Array.from(e.templateRegistryMap.values()),pipelineStage:"next"});for(const f of u){const e=Ve(f);"error"===f.level?l.errors.push(e):"warning"===f.level?l.warnings.push(e):(0,G().HB)(f.level)}for(const f of l.templateOutputs){const{templateId:e}=f.template;"unchanged"!==f.type&&fe().eX.has(e)&&l.errors.push(`"${e}" is a built-in system template and can't be changed! Consider changing its template id so a new template is created.`)}return l.instanceActions.push(...function(e){const t=[];for(const o of e.featureInfoMap.values()){const n=Pe({builderContext:e,item:o});n&&t.push(n)}return t}(e)),l}function Ge(e){const{builderContext:t,templateId:o,propertyInfo:n,firstTableViewInfo:i,collectionInfo:l,builderKeyToTemplateIdMap:r,output:a}=e,s=(0,ee().rW)(t,n);let p=s.relatedCollectionTemplateId;if(p===ze){const e=Ie({builderContext:t,item:l});if(e.templateId)p=e.templateId;else{const e=`In property "${n.name}", unable to obtain template id for self-relation.`;a.errors.push(e),p=e}}const c=qe().nN(n.schema);let d;if("button"===c.type){const{automation_id:e}=c;if(e){const o=t.featureInfoMap.get((0,ee().vO)({type:"automation",id:e}));if(o){d=Ie({builderContext:t,item:o}).templateId,delete c.automation_id}}if(!d){const e=`In property "${n.name}", unable to obtain template id for automation.`;a.errors.push(e),d=e}}const u={templateId:o,type:"property",value:c,relatedCollectionTemplateId:p,buttonAutomationId:d,propertyOptionsType:Be(c)?null==s?void 0:s.propertyOptionsType:void 0,dependencyMap:qe().vW({propertyTemplateValue:c,mapper:new et(o,r,t.featureInfoMap,a)})};"relation"!==n.schema.type&&qe().Kg({propertyId:n.id,propertyTemplate:u,firstTableViewInfo:i}),Ze(t,a,u,n)}function He(e){const{builderContext:t,collectionViewInfo:o,templateId:n,builderKeyToTemplateIdMap:i,output:l}=e;if(!o.viewType)return void l.errors.push(`Collection "${o.name}" has no type.`);const r={type:o.viewType,name:o.name,format:We({schema:t.collectionInfo.schema,collectionViewType:o.viewType,primitiveFormat:o.format}),query2:o.query};Ze(t,l,{templateId:n,type:"collection_view",value:r,dependencyMap:Ke({collectionViewTemplateValue:r,mapper:new et(n,i,t.featureInfoMap,l)})},o)}function Qe(e){const{builderContext:t,builderKeyToTemplateIdMap:o,automationInfo:n,templateId:i,output:l}=e,r={},a=new et(i,o,t.featureInfoMap,l),s=new Set,p=new Map,{automationModel:c,builderKeys:u}=function(e){const t=new Set,{value:o}=(0,De().n)({automationModel:e,visitors:{visitCollectionProperty:e=>(t.add((0,ee().vO)({id:e,type:"property"})),{type:"keep"}),visitRecordPointer:e=>(e.table!==ae().ev&&e.table!==Le().Vl&&e.table!==ne().yB&&e.table!==Ee().Gy||t.add((0,ee().vO)({id:e.id,type:e.table})),{type:"keep"})}});return{automationModel:o,builderKeys:t}}(n.automationModel),m=c.getTrigger();u.forEach((e=>s.add(e)));const f=n.automationActionModels.map(((e,o)=>{const{automationActionModel:n,builderKeys:l}=function(e){const{actionIdToActionPlaceholderIdMap:t,automationActionModel:o,spaceId:n}=e,i=new Set;function l(e){const o=(0,Fe().y5)(e);if("action"===o.source){const e=t.get(o.action_id)??o.action_id;return(0,Fe().$y)({...o,action_id:e})}if("global"===o.source)return e;(0,G().HB)(o)}const{value:r}=(0,De().G)({automationActionModel:o,baseUrl:d().A.domainBaseUrl,preventClearingConfig:!0,publicDomainName:d().A.publicDomainName,sourceSpaceId:n,visitors:{visitCollectionProperty:e=>(i.add((0,ee().vO)({id:e,type:"property"})),{type:"keep"}),visitCollectionPropertyPointer:e=>(i.add((0,ee().vO)({id:e.propertyId,type:"property"})),i.add((0,ee().vO)({id:e.id,type:"collection"})),{type:"keep"}),visitFormulaContextValue:e=>({type:"replace",value:l(e)}),visitFormulaPageProperty:e=>{if(i.add((0,ee().vO)({id:e.property,type:"property"})),"collection"in e&&e.collection)i.add((0,ee().vO)({id:e.collection.id,type:"collection"}));else if("contextValueId"in e&&e.contextValueId){const t=(0,Re().mg)(e);return t.contextValueId=l(t.contextValueId),{type:"replace",value:t}}return{type:"keep"}},visitRecordPointer:e=>(e.table!==ae().ev&&e.table!==Le().Vl&&e.table!==ne().yB&&e.table!==Ee().Gy||i.add((0,ee().vO)({id:e.id,type:e.table})),{type:"keep"})}});return{automationActionModel:r,builderKeys:i}}({actionIdToActionPlaceholderIdMap:p,automationActionModel:e,spaceId:t.collectionStore.getSpaceId()});l.forEach((e=>s.add(e)));const r=function(e,t){const o=e.getType();return{type:o,config:e.getConfig(),placeholderId:`${t}:${o}`}}(n,`${i}:${o}`);return p.set(n.id,r.placeholderId),r}));for(const d of s)a.populateDependencyMap(d,r);const y={type:"automation",templateId:i,value:{actions:f,name:n.name,trigger:m},dependencyMap:r};return Ze(t,l,y,n),y}function Xe(e){var t;const{builderContext:o,builderKeyToTemplateIdMap:n,blockInfo:i,templateId:l,output:r}=e,a=(0,ee().rW)(o,i),s={};!function(e){const{propertyIds:t,builderKeyToTemplateIdMap:o,output:n,dependencyMap:i}=e;for(const l of t){const e=o.get((0,ee().vO)({type:"property",id:l}));e?i[`property:${l}`]=e:n.errors.push(`In template "${e}", unable to find mapping for property "${l}".`)}}({propertyIds:Array.from(i.propertyIds),dependencyMap:s,builderKeyToTemplateIdMap:n,output:r});const p=i.recordMap.toJson();if(!(0,I().isRecordMapJsonV3)(p))return void r.errors.push("recordMap.toJson() is not V3!");const c=null===(t=p.block)||void 0===t?void 0:t[i.id];var d,u;c&&"page"===c.value.type?null!==(d=c.value.format)&&void 0!==d&&d.workflow_template_instance&&(c.value=(0,Re().mg)(c.value),null===(u=c.value.format)||void 0===u||delete u.workflow_template_instance):r.errors.push(`Page template "${l}" has no root block!`);const m={templateId:l,type:"block",description:a.description,value:{blockPointer:{table:ae().ev,id:i.id,spaceId:o.collectionStore.getSpaceId()},recordMap:p},dependencyMap:s};Ze(o,r,m,i)}function Ye(e){const{builderContext:t,compoundTemplateInfo:o,output:n,templateId:i}=e,l=(0,ee().rW)(t,o);Ze(t,n,{type:"compound",templateId:i,name:l.name,icon:l.icon,value:{templateItems:l.templateItems.map(((e,o)=>{if(!e.pointer)return void n.errors.push(`In "${i}", template item at index ${o} is undefined`);const l=t.featureInfoMap.get(e.pointer);if(!l)return void n.errors.push(`In "${i}", unable to resolve pointer "${e.pointer}"`);const r=Ie({builderContext:t,item:l});if("createOrUpdateTemplate"===r.type||"mapToTemplateId"===r.type)return{pointer:r.templateId,optionality:e.optionality};n.errors.push(`In "${i}", builder action for "${e.pointer}" is "${r.type}"`)})).filter(G().O9)}},o)}function Ze(e,t,o,n){const{templateId:i}=o,l=e.templateRegistryMap.get(i);if(l){const{version:e,copiedFrom:n,...i}=l,r=be()(i,{space:"  "}),a=be()(o,{space:"  "});if(r===a)t.counts.unchanged+=1,t.templateOutputs.push({type:"unchanged",template:{...o,version:e,copiedFrom:n}});else{const i=(e??0)+1;t.hasNewOrChangedTemplates=!0,t.counts.changed+=1,t.templateOutputs.push({type:"changed",newVersion:i,template:{...o,version:i,copiedFrom:n},originalTemplate:l,templateJson:a,originalTemplateJson:r})}}else t.hasNewOrChangedTemplates=!0,t.counts.new+=1,t.templateOutputs.push({type:"new",template:{...o,copiedFrom:e.state.createCopy?n.templateId:void 0}})}class et{constructor(e,t,o,n){this.templateId=e,this.builderKeyToTemplateIdMap=t,this.featureInfoMap=o,this.output=n}map(e){const t=this.builderKeyToTemplateIdMap.get(e);return t||(this.output.errors.push(`In template "${this.templateId}", "${e}" has no template id mapping.`),`🚨TEMPLATE ID MAPPING NOT FOUND FOR "${e}"🚨`)}populateDependencyMap(e,t){if(e===ee().rs)return void this.output.debugMessages.push(`"${e}" is a special property and will not be mapped to a template id.`);const o=this.featureInfoMap.get(e),n=this.map(e);o?"compound"!==o.type&&"uninstantiated_template"!==o.type?t[`${o.type}:${o.id}`]=n:this.output.errors.push(`"${e}" has invalid feature type: "${o.type}"`):this.output.errors.push(`"${e}" has no feature info`)}}function tt(e,t){const o=e.templateOutputs.map((e=>e.template)),n=o.find((e=>"collection"===e.type));if(!n)return;return{collectionTemplate:n,templateProvider:new(q().GH)((e=>{const n=o.find((t=>t.templateId===e));return n||t.templateProvider.fromId(e)}))}}function ot(e){const t=(0,a().IS)((e=>({code:{fontFamily:"monospace",backgroundColor:e.lightGrayButtonHoveredBackground,padding:2,borderRadius:4}})),[]);return(0,L.jsx)("code",{style:t.code,children:e.children})}function nt(e){let{children:t,style:o,type:n="default"}=e;const i=(0,a().IS)((e=>({details:{border:`1px solid ${e.regularDividerColor}`,padding:10,borderRadius:4,..."subtle"===n&&{border:"none",margin:4},..."superSubtle"===n&&{border:"none",margin:"none",padding:0},...o}})),[n,o]);return(0,L.jsx)("details",{style:i.details,children:t})}function it(e){let{children:t}=e;const[o,i]=(0,n.useState)(!1),l=(0,n.useCallback)((()=>i(!0)),[]),r=(0,n.useCallback)((()=>i(!1)),[]),s=(0,a().IS)((e=>({itemContainer:{display:"flex",alignItems:"stretch",justifyContent:"stretch",padding:2,borderRadius:4,backgroundColor:o?e.outlineButtonHoveredBackground:"transparent",marginBottom:4,width:"100%"},item:{paddingTop:2,paddingBottom:2,paddingLeft:4,fontSize:12,flexGrow:1},borderItem:{width:4,borderRadius:2,backgroundColor:e.stroke.grayPrimary}})),[o]);return(0,L.jsxs)("div",{onMouseEnter:l,onMouseLeave:r,style:s.itemContainer,children:[(0,L.jsx)("div",{style:s.borderItem}),(0,L.jsx)("div",{style:s.item,children:t})]})}const lt=n.memo(it);var rt=()=>o(908568),at=()=>o(809811),st=()=>o(356813),pt=()=>o(579494);function ct(e){const t=(0,J().tz)(),o=(0,a().IS)((e=>({container:{display:"inline-flex",alignItems:"center",gap:2},link:{display:"inline-block",textDecoration:"underline",color:e.text.blueSecondary}})),[]),n=(0,L.jsx)(pt().A,{href:e.href,style:o.link,external:e.openInNewTab,children:e.children});let i=(0,at().Jf)({str:e.href,allowNoProtocol:!0});return"string"==typeof i&&(0,at().cW)(i)&&(i=(0,at().pf)({relativeUrl:i,baseUrl:d().A.domainBaseUrl})),i&&e.includeCopyButton?(0,L.jsxs)("span",{style:o.container,children:[n,(0,L.jsx)(st().A,{ariaLabel:t.formatMessage({id:"workflowTemplatesBuilder.uidoc.builderLink.copyButton",defaultMessage:"Copy link"}),icon:rt().n,style:{width:18,height:18},onClick:()=>{navigator.clipboard.writeText(i),he().D6({label:"Link copied to clipboard"})}})]}):n}var dt=()=>o(209684),ut=()=>o(535906),mt=()=>o(858023),ft=()=>o(443252),yt=()=>o(907721);function gt(e){let{builderContext:t,builderOutputWorld:i,builderKey:l,showType:s}=e;const[p,c]=(0,n.useState)(!1),{featureOptionality:d,featureType:u}=(0,r().K8)((()=>{var e;const o=t.featureInfoMap.get(l),n=(null==o?void 0:o.templateId)&&(null==i?void 0:i.templateProvider.fromId(o.templateId)),r=null==i?void 0:i.collectionTemplate;return{featureOptionality:null==r||null===(e=r.value.templateItems.find((e=>e.pointer===(null==n?void 0:n.templateId))))||void 0===e?void 0:e.optionality,featureType:null==o?void 0:o.type}}),[t.featureInfoMap,l,i]),m=(0,ee().D6)(t,l,{includeType:!1}),f="required"===d?"Required":"optionalDefaultOn"===d?"On":"Off",y=(0,n.useCallback)((()=>{c(!0)}),[]),g=(0,n.useCallback)((e=>{t.dispatch({type:"updateBuilderSettings",key:l,property:"optionality",value:e}),c(!1)}),[t,l]),h=(0,a().IS)((e=>{const t={property:e.fill.blueSecondary,automation:e.fill.brownSecondary,collection_view:e.fill.greenSecondary,compound:e.fill.graySecondary,block:e.fill.purpleSecondary,collection:e.fill.redSecondary,layout:e.fill.orangeSecondary,uninstantiated_template:e.fill.graySecondary}[u??"uninstantiated_template"],n={borderRadius:4,paddingLeft:4,paddingRight:4,backgroundColor:t};return{container:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",gap:4,paddingRight:4},name:o(31448).RC,labels:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},optionalityLabel:{...n,color:"light"===e.mode?e.white:e.text.primary,fontSize:12,height:"fit-content",background:"required"===d?e.redButtonBackground:"optionalDefaultOn"===d?e.blueButtonBackground:e.stroke.lightGrayPrimary},optionalityLabelHovered:{background:"required"===d?e.redButtonHoveredBackground:"optionalDefaultOn"===d?e.blueButtonHoveredBackground:e.stroke.lightGraySecondary},optionalityLabelPressed:{background:"required"===d?e.redButtonPressedBackground:"optionalDefaultOn"===d?e.blueButtonPressedBackground:e.stroke.lightGraySecondary},featureTypeLabel:{...n,backgroundColor:t}}}),[d,u]);return(0,L.jsxs)("div",{style:h.container,children:[(0,L.jsx)("div",{style:h.name,children:m}),(0,L.jsxs)("div",{style:h.labels,children:[u&&s(u)&&(0,L.jsx)("div",{style:h.featureTypeLabel,children:u}),(0,L.jsx)(ft().Ay,{trapFocus:!0,origin:(0,L.jsx)(dt().p,{style:h.optionalityLabel,hoveredStyle:h.optionalityLabelHovered,pressedStyle:h.optionalityLabelPressed,onClick:y,children:f}),popupType:ft().nl.Popup,open:p,placementToOrigin:yt().W.Right,alignmentToOrigin:yt().C.Start,onDismiss:()=>c(!1),render:()=>(0,L.jsx)(o(935091).A,{menuType:o(640979).gu.Popup,width:100,children:(0,L.jsx)(mt().Ay,{type:mt().Oh.Vertical,initialFocus:0,sections:[{key:"optionality",render:e=>(0,L.jsx)(o(88271).A,{...e}),items:[ht("required",g),ht("optionalDefaultOn",g),ht("optionalDefaultOff",g)]}]})})})]})]})}function ht(e,t){return{key:e,render:t=>(0,L.jsx)(ut().A,{...t,title:"required"===e?"Required":"optionalDefaultOn"===e?"On":"Off"}),action:()=>t(e)}}const vt=n.memo(gt);var It=()=>o(961397);function bt(e){const{builderOutputWorld:{collectionTemplate:t,templateProvider:o}}=e,i=(0,r().K8)((()=>t?(0,q().A6)(t,o):[]),[t,o]),l=(0,r().K8)((()=>{const e=o.allOfType({templateIds:t.value.templateItems.map((e=>e.pointer)),type:"collection_view"}),n=Object.fromEntries(t.value.templateItems.map((e=>[o.fromId(e.pointer).templateId,e.optionality])));return e.map((e=>({view:e,optionality:n[e.templateId]})))}),[t.value.templateItems,o]),s=(0,r().K8)((()=>null==t?void 0:t.value.templateItems.map((e=>(0,It().bd)(e.pointer,e.optionality,o)))),[null==t?void 0:t.value.templateItems,o]),p=(0,n.useMemo)((()=>(0,It().UA)({collectionViewTemplates:i,featureTemplateSelections:s??[]})),[i,s]),d=(0,a().IS)((e=>{const t={display:"inline-block",paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2,borderRadius:6,fontSize:12};return{featureTemplateSelection:{...t,backgroundColor:e.tint.regular,border:`2px solid ${e.stroke.lightGrayPrimary}`},featureTemplateSelectionSelected:{...t,background:e.stroke.uiBlueSecondary,border:`2px solid ${e.stroke.uiBluePrimary}`},featureTemplateSelectionRequired:{...t,background:e.stroke.uiRedSecondary,border:`2px solid ${e.stroke.uiRedPrimary}`},list:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",gap:4,margin:0,padding:0}}}),[]);return s&&0!==s.length?(0,L.jsxs)("div",{children:[(0,L.jsx)(c().iK,{children:"Feature selection step preview"}),(0,L.jsx)("aside",{children:"(Items with a blue background mean they are selected by default.)"}),(0,L.jsx)("p",{children:"Properties"}),(0,L.jsx)("ul",{style:d.list,children:p.map((e=>(0,L.jsx)("li",{style:e.selected?d.featureTemplateSelectionSelected:d.featureTemplateSelection,children:(0,Y().getWorkflowTemplateName)(e.template)},e.template.templateId)))}),(0,L.jsx)("p",{children:"Views"}),(0,L.jsx)("ul",{style:d.list,children:l.map((e=>{let{view:t,optionality:o}=e;return(0,L.jsx)("li",{style:"optionalDefaultOn"===o?d.featureTemplateSelectionSelected:"required"===o?d.featureTemplateSelectionRequired:d.featureTemplateSelection,children:(0,Y().getWorkflowTemplateName)(t)},t.templateId)}))})]}):null}var wt=()=>o(502140),xt=()=>o(823301);function Tt(e){const{transaction:t,collectionStore:o,action:n,logger:i}=e;"create"===n.type||"update"===n.type?(0,xt().ZQ)({transaction:t,collectionStore:o,templateId:n.templateId,instance:n.pointer,logger:i}):(0,G().HB)(n)}function Ct(e){const{builderOutput:t}=e,{collectionStore:o}=ue(),i=(0,l().v3)(),[r,a]=(0,n.useState)(!1),s=(0,n.useCallback)((()=>{const e=V().A.state;if(!e)return void he().D6({label:"Workflow templates are not loaded!"});(0,wt().log)({level:"info",from:"WorkflowTemplatesBuilder.InstallTemplatesButton",type:"install",data:{miscDataToConvertToString:t}}),a(!0);const{serverCommitResult:n,performResult:{created:l,updated:r}}=$({environment:i,collectionInfo:e.collectionInfo,templateToRowIdMap:e.templateToRowIdMap,templates:t.templateOutputs.filter((e=>"unchanged"!==e.type)).map((e=>e.template))}),{serverCommitResult:s}=function(e){const{environment:t,collectionStore:o,actions:n}=e,i=new(Y().WorkflowTemplateLogger);return B().createAndCommit({userAction:"builderInstantiationActions.executeBuilderInstanceActions",environment:t,canUndo:!0,perform(e){for(const t of n)Tt({transaction:e,collectionStore:o,action:t,logger:i})}})}({environment:i,actions:t.instanceActions,collectionStore:o});Promise.all([n,s]).then((()=>{he().D6({label:`Created ${l} templates and updated ${r}.`})})).catch((e=>{console.error(e),he().D6({label:"Alas, an error occurred. See the console for details."})})).finally((()=>{a(!1)}))}),[i,t,o]),{counts:c}=t;return(0,L.jsxs)(p().A,{size:"lg",onClick:s,disabled:r,children:["Install templates to prototype registry (",c.new," new,"," ",c.changed," changed)"]})}function jt(e){let{children:t,style:o}=e;const n=(0,a().IS)((e=>({pre:{backgroundColor:e.modalBackground,fontSize:12,padding:10,overflow:"auto",...o}})),[o]);return(0,L.jsx)("pre",{style:n.pre,children:t})}const St=n.memo(jt);function kt(e){const t=(0,J().tz)(),{object:o}=e,n=(0,a().IS)((e=>({container:{position:"relative"},pre:{backgroundColor:e.modalBackground,padding:10,fontSize:12,overflow:"auto",maxHeight:"500px"},copyButton:{position:"absolute",top:10,right:10}})),[]);return(0,L.jsxs)("div",{style:n.container,children:[(0,L.jsx)(St,{style:n.pre,children:JSON.stringify(o,null,2)}),(0,L.jsx)(st().A,{style:n.copyButton,icon:rt().n,ariaLabel:t.formatMessage({id:"workflowTemplatesBuilder.uidoc.jsonSnippet.copyButton",defaultMessage:"Copy to clipboard"}),onClick:()=>{navigator.clipboard.writeText(JSON.stringify(o,null,2))}})]})}function _t(e){const{errors:t,label:o,type:n}=e;return(0,L.jsx)(Mt,{messages:t,label:o,type:n||"error"})}function Mt(e){const{messages:t,label:o,type:n}=e;return(0,L.jsxs)("div",{className:n,children:[o,(0,L.jsx)("ul",{children:t.map(((e,t)=>(0,L.jsx)("li",{children:e},t)))})]})}function Ot(e){var t;const{label:o,color:n,value:i,onChange:l}=e,{allIcons:r}=ue(),a=(null===(t=(0,ke().DV)(i))||void 0===t?void 0:t.iconName)??"";return(0,L.jsxs)("div",{style:{display:"flex"},children:[(0,L.jsx)(u().OV,{label:o,value:a,onChange:e=>{l(`/icons/${e}_${n}.svg`)},options:r}),(0,L.jsx)("img",{src:i,style:{width:32,height:32},alt:a})]})}var Bt=o.n(o(638582)),Vt=()=>o(103151),$t=()=>o(831466);function Nt(e){const{oldValue:t,newValue:o}=e,n=new(Bt()),i=n.diff_linesToChars_(t,o),l=n.diff_main(i.chars1,i.chars2,!1);n.diff_charsToLines_(l,i.lineArray),n.diff_cleanupSemantic(l);const r=(0,a().IS)((e=>({container:{position:"relative"},pre:{backgroundColor:e.modalBackground,padding:10,fontSize:12,overflow:"auto",maxHeight:"500px"},copyButtons:{position:"absolute",display:"flex",flexDirection:"row",gap:4,top:10,right:10},copyButtonNewIcon:{stroke:e.stroke.greenSecondary},copyButtonOldIcon:{stroke:e.tint.uiRedHover},diffDelete:{backgroundColor:e.tint.uiRed,color:e.text.redPrimary,textDecoration:"line-through"},diffInsert:{backgroundColor:e.stroke.greenSecondary}})),[]),s=e=>{const i=()=>{if("diff"===e){const e=n.patch_make(t,o),i=n.patch_toText(e);navigator.clipboard.writeText(i)}else navigator.clipboard.writeText("new"===e?o:t);he().D6({label:`Copied ${e} value to clipboard`})},l="new"===e?r.copyButtonNewIcon:"old"===e?r.copyButtonOldIcon:void 0,a=`Copy ${e} value to clipboard`;return(0,L.jsx)(Vt().A,{placement:yt().W.Top,renderTooltip:()=>a,render:t=>(0,L.jsx)(dt().p,{...t,icon:rt().n,iconStyle:l,"aria-label":a,onClick:i,children:e})})};return(0,L.jsxs)("div",{style:r.container,children:[(0,L.jsx)(St,{style:r.pre,children:l.map(((e,t)=>{let o,n,[i,l]=e;return i===$t().Cm?(o="diff-delete",n=r.diffDelete):i===$t().Ug&&(o="diff-insert",n=r.diffInsert),(0,L.jsx)("span",{className:o,style:n,children:l},t)}))}),(0,L.jsxs)("div",{style:r.copyButtons,children:[s("diff"),s("old"),s("new")]})]})}function Rt(e){var t;const{item:o,builderOutput:n}=e,i=ue(),{dispatch:l}=i,r=Ie({builderContext:i,item:o}),a=(0,ee().vO)(o),s=(0,ee().rW)(i,o),c="collection"===o.type?o.descriptionAsString:void 0,d=(0,te().O)(o);return(0,L.jsxs)("div",{children:["collection"!==o.type&&"compound"!==o.type&&"uninstantiated_template"!==o.type&&(0,L.jsx)(u().Vk,{label:"Do not instantiate a template for this primitive",value:s.ignore,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"ignore",value:e})}}),"uninstantiated_template"!==o.type&&"collection"!==o.type&&(0,L.jsx)(u().Vk,{label:"Map to existing template, do not update it",value:s.shouldMapToTemplate,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"shouldMapToTemplate",value:e})}}),!s.ignore&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u().Pe,{label:"Template id",value:s.templateId??"",disabled:"uninstantiated_template"===o.type&&"mapToTemplateId"===r.type,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"templateId",value:e})}}),(0,L.jsx)(Ft,{action:r,builderOutput:n,onUndelete:()=>{l({type:"updateBuilderSettings",key:a,property:"isDeleted",value:!1})}})]}),i.state.createCopy&&(0,L.jsx)(u().Vk,{label:"Bypass create copy (allow reuse of original template)",value:s.bypassCreateCopy,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"bypassCreateCopy",value:e})}}),"createOrUpdateTemplate"===r.type&&(0,L.jsxs)(L.Fragment,{children:["compound"===o.type||"layout"===o.type?(0,L.jsx)(u().Pe,{label:"Name",value:s.name,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"name",value:e})}}):void 0,"compound"===o.type&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Ot,{label:"Icon",color:"gray",value:s.icon,onChange:e=>l({type:"updateBuilderSettings",key:a,property:"icon",value:e})}),(0,L.jsxs)("ol",{children:[s.templateItems.map(((e,t)=>(0,L.jsxs)("li",{children:[(0,L.jsx)(At,{templateItem:e,onChange:e=>{var o,n,i;l({type:"updateBuilderSettings",key:a,property:"templateItems",value:(o=s.templateItems,n=e,i=t,o.map(((e,t)=>t===i?n:e)))})}}),(0,L.jsx)(p().A,{size:"lg",style:{marginBottom:4},onClick:()=>{var e,o;l({type:"updateBuilderSettings",key:a,property:"templateItems",value:(e=s.templateItems,o=t,e.filter(((e,t)=>t!==o)))})},children:"Delete compound template item"})]},t))),(0,L.jsx)("p",{children:(0,L.jsx)(p().A,{size:"lg",onClick:()=>{l({type:"updateBuilderSettings",key:a,property:"templateItems",value:[...s.templateItems,{pointer:void 0,optionality:"optionalDefaultOn"}]})},children:"Add compound template item"})}),(0,L.jsx)(Lt,{templateItems:s.templateItems,onChange:e=>l({type:"updateBuilderSettings",key:a,property:"templateItems",value:e})})]})]}),"property"!==o.type&&"collection_view"!==o.type&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u().Pe,{label:"Description",value:s.description??"",placeholder:c,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"description",value:e})}}),c&&s.description&&s.description!==c?(0,L.jsx)("aside",{children:"Leave this blank to fall back to the underlying primitive's description."}):null]}),"property"===o.type&&"relation"===o.schema.type&&(0,L.jsx)(Pt,{label:"Related collection",value:s.relatedCollectionTemplateId,onChange:e=>l({type:"updateBuilderSettings",key:a,property:"relatedCollectionTemplateId",value:e})}),"collection"===o.type?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u().AW,{label:"Category",value:(0,ee().To)(s.category),onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"category",value:(0,ee().OU)(e)})},options:Me().RX}),null!==(t=o.format)&&void 0!==t&&t.item_name_config_v2?(0,L.jsx)("p",{children:"The collection specifies its own item name terminology. Cool, we will reuse that!"}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("p",{children:"The collection does not specify its own item name terminology. You can specify it below, but this is deprecated and support for it will be removed soon."}),(0,L.jsx)(u().Pe,{label:"Singular",value:s.singularItemName,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"singularItemName",value:e})}}),(0,L.jsx)(u().Pe,{label:"Plural",value:s.pluralItemName,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"pluralItemName",value:e})}})]}),(0,L.jsx)(u().Vk,{label:"Use minimal onboarding",value:s.hasMinimalOnboarding,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"hasMinimalOnboarding",value:e})}})]}):(0,L.jsxs)(L.Fragment,{children:["compound"!==o.type&&!d&&(0,L.jsx)(u().Vk,{label:"Include in collection template",value:s.includeInCollectionTemplate,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"includeInCollectionTemplate",value:e})}}),s.includeInCollectionTemplate&&!d&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u().OV,{label:"Required",value:s.optionality,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"optionality",value:e})},options:Et,optionLabels:Wt}),"compound"!==o.type&&(0,L.jsx)(u().Vk,{onChange:e=>l({type:"updateBuilderSettings",key:a,property:"isInSettings",value:e}),label:"Is pulled up to top of customize menu",value:s.isInSettings})]})]}),"property"===o.type&&Be(o.schema)&&(0,L.jsx)(u().OV,{label:"Property options type",value:s.propertyOptionsType,onChange:e=>{l({type:"updateBuilderSettings",key:a,property:"propertyOptionsType",value:e})},options:["sample","content"]})]}),("createOrUpdateTemplate"===r.type||"mapToTemplateId"===r.type)&&("compound"===o.type||"uninstantiated_template"===o.type)&&(0,L.jsx)(p().A,{size:"lg",onClick:()=>l({type:"updateBuilderSettings",key:a,property:"isDeleted",value:!0}),children:"Delete"})]})}function At(e){const{templateItem:t,onChange:o}=e;return(0,L.jsxs)("div",{children:[(0,L.jsx)(Dt,{excludeTypes:["collection","compound"],value:t.pointer,onChange:e=>o({...t,pointer:e})}),(0,L.jsx)(u().OV,{label:"Required",value:t.optionality,onChange:e=>o({...t,optionality:e}),options:Et,optionLabels:Wt})]})}function Pt(e){const{label:t,value:o,onChange:i}=e,l=ue(),{options:r,optionLabels:a}=(0,n.useMemo)((()=>{const e=[ze],t={[ze]:"(self-relation)"};for(const o of l.templateRegistryMap.values())"collection"===o.type&&(e.push(o.templateId),t[o.templateId]=`${o.value.targetCollection.name} (${o.templateId})`);return{options:e,optionLabels:t}}),[l.templateRegistryMap]);return(0,L.jsx)(u().AW,{label:t,value:o,onChange:i,options:r,optionLabels:a})}function Dt(e){const t=ue(),{value:o,onChange:n,excludeTypes:i}=e,l=new Set(i),r={},a=[];for(const[s,p]of t.featureInfoMap.entries())l.has(p.type)||(a.push(s),r[s]=(0,ee().D6)(t,p));return(0,L.jsx)(u().AW,{label:"Template",value:o,onChange:n,options:a,optionLabels:r})}function Ft(e){const{action:t,builderOutput:o,onUndelete:n}=e,i=(0,a().IS)((e=>({success:{color:e.stroke.greenPrimary},subtle:{color:e.text.graySecondary}})),[]);switch(t.type){case"mapToTemplateId":return(0,L.jsxs)("aside",{children:["This will be mapped to the"," ",(0,L.jsx)(ot,{children:t.templateId})," template."]});case"createOrUpdateTemplate":const e=o.templateOutputs.find((e=>e.template.templateId===t.templateId));if(!e)return(0,L.jsx)("aside",{className:"error",children:"An error occurred when generating the new template."});switch(e.type){case"new":return(0,L.jsxs)(nt,{children:[(0,L.jsx)("summary",{style:i.success,children:"A new template will be created."}),(0,L.jsx)("p",{children:"Here's the new template's JSON:"}),(0,L.jsx)(Nt,{oldValue:"",newValue:JSON.stringify(e.template,null,2)})]});case"unchanged":return(0,L.jsxs)(nt,{type:"superSubtle",children:[(0,L.jsx)("summary",{style:i.subtle,children:"This template has not been changed from its value in the registry."}),(0,L.jsx)("p",{children:"Here's the unchanged template's JSON:"}),(0,L.jsx)(Nt,{oldValue:JSON.stringify(e.template,null,2),newValue:JSON.stringify(e.template,null,2)})]});case"changed":return(0,L.jsxs)(nt,{children:[(0,L.jsxs)("summary",{style:i.success,children:["The existing template will be updated to version"," ",e.newVersion," (however, instances of the template will not be updated)."]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:"The following changes will be made to the template in the registry:"}),(0,L.jsx)(Nt,{oldValue:e.originalTemplateJson,newValue:e.templateJson})]})]})}(0,G().HB)(e);break;case"ignore":return"deleted"===t.reason?(0,L.jsxs)("aside",{children:["This has been deleted and won't be included in any templates."," ",(0,L.jsx)(p().A,{size:"lg",onClick:n,children:"Undelete"})]}):(0,L.jsxs)("aside",{children:["This data will be ignored (reason:"," ",(0,L.jsx)(ot,{children:t.reason}),")."]});case"invalidCopyName":return(0,L.jsx)("aside",{className:"error",children:"This id is already taken."})}}function Lt(e){const{templateItems:t,onChange:o}=e,n=ue();return t.length<=1?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("aside",{children:"Drag-and-drop in the list below to re-order template items."}),(0,L.jsx)(ve().Ay,{direction:"vertical",keys:t.map(((e,t)=>t.toString())),renderKey:e=>{const o=t[parseInt(e)].pointer,i=o?(0,ee().D6)(n,o):"(ERROR)";return(0,L.jsx)(lt,{children:i})},onDrop:e=>{o(e.map((e=>t[parseInt(e)])))}})]})}const Et=["required","optionalDefaultOn","optionalDefaultOff"],Wt={optionalDefaultOn:"Optional (default on)",optionalDefaultOff:"Optional (default off)",required:"Required"};function Ut(e){const{builderContextState:t,...o}=e,n=(0,a().IS)((e=>({error:{color:e.text.redSecondary}})),[]);switch(t.type){case"loaded":return(0,L.jsx)(de.Provider,{value:t.context,children:(0,L.jsx)(Kt,{...o})});case"emptyInput":return null;case"error":return(0,L.jsx)("div",{style:n.error,children:t.message});case"loading":return(0,L.jsxs)("p",{children:[(0,L.jsxs)("strong",{children:[t.message||"Loading","…"]}),(0,L.jsx)("br",{}),"collection view block id:"," ",(0,L.jsx)(ot,{children:t.collectionViewBlockId||"(unknown)"}),(0,L.jsx)("br",{}),"collection id:"," ",(0,L.jsx)(ot,{children:t.collectionId||"(unknown)"})]})}(0,G().HB)(t)}function Kt(e){var t;const{isCompact:o}=e,i=ue(),l=(0,r().K8)((()=>Je(i)),[i]),a=(0,n.useMemo)((()=>i.featureOrdering.filter((e=>{const t=i.featureInfoMap.get(e);if(t){const e=Ie({builderContext:i,item:t});return("createOrUpdateTemplate"===e.type||"mapToTemplateId"===e.type)&&e.includeInCollectionTemplate}return!1}))),[i]),s=(0,r().K8)((()=>null!==V().A.state),[]),p=D(),d=l.warnings.length>0?(0,L.jsx)(_t,{errors:l.warnings,type:"warning",label:"Your templates have the following warnings. While you can save them to the registry, we won't be able to ship them to production until they're fixed:"}):null,u=l.hasNewOrChangedTemplates?(0,L.jsx)(Ct,{builderOutput:l}):(0,L.jsx)("aside",{children:"The template registry is up to date."}),{properties:m,collectionViews:f,compoundTemplateInfos:y,blockTemplateInfos:g,automationInfos:h,uninstantiatedTemplateInfos:v}=(0,n.useMemo)((()=>{const e=[],t=[],o=[],n=[],l=[],r=[];for(const a of i.featureOrdering){const s=i.featureInfoMap.get(a);if(s)switch(s.type){case"property":e.push(s);break;case"collection_view":t.push(s);break;case"compound":o.push(s);break;case"uninstantiated_template":r.push(s);break;case"collection":case"layout":break;case"block":n.push(s);break;case"automation":l.push(s);break;default:(0,G().HB)(s)}}return{properties:e,collectionViews:t,compoundTemplateInfos:o,blockTemplateInfos:n,automationInfos:l,uninstantiatedTemplateInfos:r}}),[i.featureInfoMap,i.featureOrdering]),I=Boolean(0===l.errors.length&&s&&p);let b=null,w=l.warnings.length;const x=null===(t=i.sourceCollectionTemplate)||void 0===t||null===(t=t.builderMetadata)||void 0===t?void 0:t.sourceCollectionViewBlock;x&&!i.isOriginalSourceCollectionViewBlock&&(b=(0,L.jsxs)("p",{className:"warning",children:["The template you're updating was created based on"," ",(0,L.jsx)("a",{href:(0,ge().Jj)(x),children:"this collection"}),", which is different from the one you provided."]}),w+=1);const T=(0,n.useMemo)((()=>tt(l,i)),[i,l]),C=(0,L.jsxs)(L.Fragment,{children:[b,(0,L.jsx)(qt,{sourceCollectionViewBlockURL:(0,ge().Jj)(i.sourceCollectionViewBlockPointer),collectionInfo:i.collectionInfo,properties:m,collectionViews:f,builderOutput:l}),(0,L.jsx)(Ht,{blockTemplateInfos:g,pageTemplatesErrors:i.pageTemplatesErrors,builderOutput:l}),(0,L.jsx)(Gt,{automationInfos:h,automationErrors:i.automationErrors,builderOutput:l}),(0,L.jsx)(Jt,{compoundTemplateInfos:y,builderOutput:l}),(0,L.jsx)(zt,{uninstantiatedFeatures:v,builderOutput:l}),(0,L.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:30},children:[(0,L.jsx)(Qt,{featureOrdering:a,onChange:e=>i.dispatch({type:"setFeatureOrdering",featureOrdering:e})}),T&&(0,L.jsx)(bt,{builderOutputWorld:T})]}),(0,L.jsx)(c().iK,{children:"Output"}),l.errors.length>0&&(0,L.jsx)(_t,{errors:l.errors,label:"You can't save the templates to the registry until the following errors are fixed:"}),l.debugMessages.length>0&&(0,L.jsxs)(nt,{type:"subtle",children:[(0,L.jsx)("summary",{children:"Debug log"}),(0,L.jsx)(Mt,{messages:l.debugMessages})]}),I&&(0,L.jsxs)(L.Fragment,{children:[d,u]}),(0,L.jsxs)(nt,{children:[(0,L.jsx)("summary",{children:"Template definition JSON output"}),(0,L.jsx)(kt,{object:l.templateOutputs.map((e=>e.template))})]}),l.fakeLocalizedTemplates&&(0,L.jsxs)(nt,{children:[(0,L.jsx)("summary",{children:"Fake-localized template definition JSON output"}),(0,L.jsx)(kt,{object:l.fakeLocalizedTemplates})]}),(0,L.jsxs)(nt,{children:[(0,L.jsx)("summary",{children:"Template instance actions JSON output"}),(0,L.jsx)(kt,{object:l.instanceActions})]})]});if(o){const e=l.errors.length>0?(0,L.jsxs)("span",{className:"error",children:[l.errors.length," errors"]}):null,t=w>0?(0,L.jsxs)("span",{className:"warning",children:[w," warnings"]}):null,o=(0,L.jsxs)("span",{children:[l.counts.new," new, ",l.counts.changed," changed"]});return(0,L.jsxs)(nt,{style:{margin:0},children:[(0,L.jsxs)("summary",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,L.jsxs)("div",{style:{flexGrow:1},children:[i.collectionInfo.name," - ",e," ",t," ",o]}),(0,L.jsx)("div",{children:I&&u})]}),C]})}return C}function qt(e){const{sourceCollectionViewBlockURL:t,collectionInfo:o,properties:n,collectionViews:i,builderOutput:l}=e;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("h2",{children:"Collection"}),(0,L.jsxs)("p",{children:["This is the"," ",(0,L.jsx)("strong",{children:(0,L.jsx)(ct,{href:t,openInNewTab:!0,children:o.name})})," ","collection."]}),(0,L.jsx)(Xt,{}),(0,L.jsx)(Rt,{item:o,builderOutput:l}),(0,L.jsx)("h2",{children:"Properties"}),(0,L.jsx)("ul",{children:n.map((e=>{const{id:t,schema:o}=e;return(0,L.jsxs)("li",{children:[(0,L.jsx)("div",{children:(0,L.jsx)("strong",{children:o.name})}),e.isSupported?(0,L.jsx)(Rt,{item:e,builderOutput:l}):(0,L.jsxs)("div",{className:"error",children:["Alas, the ",(0,L.jsx)(ot,{children:o.type})," ","property type is not currently supported by the builder."]})]},t)}))}),(0,L.jsx)("h2",{children:"Views"}),(0,L.jsx)("ul",{children:i.map((e=>(0,L.jsxs)("li",{children:[(0,L.jsx)("div",{children:(0,L.jsx)("strong",{children:e.name})}),(0,L.jsx)(Rt,{item:e,builderOutput:l})]},e.id)))}),o.layout&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("h2",{children:"Layout"}),(0,L.jsx)(Rt,{item:o.layout,builderOutput:l})]})]})}function zt(e){const{uninstantiatedFeatures:t,builderOutput:o}=e;return 0===t.length?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("h2",{children:"Uninstantiated templates"}),(0,L.jsx)("ul",{children:t.map((e=>(0,L.jsx)("li",{children:(0,L.jsx)(Rt,{item:e,builderOutput:o})},e.id)))})]})}function Jt(e){const{compoundTemplateInfos:t,builderOutput:o}=e,{dispatch:n}=ue();return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("h2",{children:"Compound templates"}),(0,L.jsx)("ul",{children:t.map((e=>(0,L.jsx)("li",{children:(0,L.jsx)(Rt,{item:e,builderOutput:o})},e.id)))}),(0,L.jsx)("p",{children:(0,L.jsx)(p().A,{size:"lg",onClick:()=>{const e=window.prompt("Enter a name for the new compound template (it can be changed later).");e&&n({type:"addNewCompoundTemplate",initialName:e})},children:"Add new compound template…"})})]})}function Gt(e){const{automationInfos:t,automationErrors:o,builderOutput:n}=e;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("h2",{children:"Automations"}),o.length>0&&(0,L.jsx)("div",{className:"error",children:(0,L.jsx)("ul",{children:o.map(((e,t)=>(0,L.jsx)("li",{children:e},t)))})}),(0,L.jsx)("ul",{children:t.map((e=>(0,L.jsxs)("li",{children:[(0,L.jsx)("div",{children:(0,L.jsx)("strong",{children:e.name})}),(0,L.jsx)(Rt,{item:e,builderOutput:n})]},e.id)))})]})}function Ht(e){const{blockTemplateInfos:t,pageTemplatesErrors:o,builderOutput:n}=e;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("h2",{children:"Page Templates"}),o.length>0&&(0,L.jsx)("div",{className:"error",children:(0,L.jsx)("ul",{children:o.map(((e,t)=>(0,L.jsx)("li",{children:e},t)))})}),(0,L.jsx)("ul",{children:t.map((e=>(0,L.jsxs)("li",{children:[(0,L.jsx)("div",{children:(0,L.jsx)("strong",{children:e.name})}),(0,L.jsx)(Rt,{item:e,builderOutput:n})]},e.id)))})]})}function Qt(e){const{featureOrdering:t,onChange:o}=e,n=ue(),i=(0,r().K8)((()=>tt(Je(n),n)),[n]),l=(0,r().K8)((()=>{const e=[];for(const o of t){const t=n.featureInfoMap.get(o);"property"!==(null==t?void 0:t.type)&&"compound"!==(null==t?void 0:t.type)||e.push(o)}return e}),[n.featureInfoMap,t]),a=(0,r().K8)((()=>{const e=[];for(const o of t){const t=n.featureInfoMap.get(o);"collection_view"===(null==t?void 0:t.type)&&e.push(o)}return e}),[n.featureInfoMap,t]),s=(0,r().K8)((()=>{const e=[];for(const o of t){const t=n.featureInfoMap.get(o);"collection_view"!==(null==t?void 0:t.type)&&"property"!==(null==t?void 0:t.type)&&"compound"!==(null==t?void 0:t.type)&&e.push(o)}return e}),[n.featureInfoMap,t]),p=e=>{o([...e,...a,...s])},d=()=>{he().D6({label:"Reorder views by editing the collection itself, instead of through the builder."})},u=e=>{o([...l,...a,...e])};if(t.length<=1)return null;const m=e=>{const t="Properties"===e?l:"Views"===e?a:s;return 0===t.length?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("p",{children:e}),(0,L.jsx)(ve().Ay,{direction:"vertical",keys:t,renderKey:t=>(0,L.jsx)(lt,{children:(0,L.jsx)(vt,{builderContext:n,builderOutputWorld:i,builderKey:t,showType:t=>!("property"===t&&"Properties"===e||"collection_view"===t&&"Views"===e)})}),onDrop:"Properties"===e?p:"Views"===e?d:u})]})};return(0,L.jsxs)("div",{children:[(0,L.jsx)(c().iK,{children:"Feature ordering"}),(0,L.jsx)("aside",{children:"Drag-and-drop in the list below to re-order the collection features."}),m("Properties"),m("Views"),m("Other")]})}function Xt(){const{state:e,dispatch:t,collectionInfo:o}=ue(),i=Boolean(o.templateId);return(0,n.useEffect)((()=>{!i&&e.createCopy&&t({type:"setCreateCopy",createCopy:!1})}),[i,t,e.createCopy]),i?(0,L.jsx)("div",{className:"paragraph",children:(0,L.jsx)(u().Vk,{onChange:e=>t({type:"setCreateCopy",createCopy:e}),label:`Create a copy of the source "${o.templateId}" template (instead of updating it)`,value:e.createCopy})}):null}const Yt="workflowTemplateBuilderState",Zt=new URLSearchParams(window.location.search.slice(1)),eo="initialUrl",to="initialMultiCollectionPageUrl";Zt.get(eo),Zt.get(to);function oo(){if(!(0,i().X)("workflow_templates_builder"))throw new Error("Assertion failure, builder is not enabled!");const e=Boolean(D()),t=function(){const e=(0,l().v3)(),[t]=(0,y().Yb)((async()=>{const t=await(0,Q().default)({environment:e,url:"/icons/all",method:"GET",format:"json",mode:"cors"});if("success"===t.type){const e=null==t?void 0:t.data;return Object.keys(e)}}),[e]);return(null==t?void 0:t.value)??[]}(),o=(0,l().v3)(),n=(0,r().O$)(o.RouterStore).route,p=(0,a().IS)((e=>({container:{backgroundColor:e.contentBackground,borderRadius:6,borderBottom:`1px solid ${e.stroke.graySecondary}`,borderTop:`1px solid ${e.stroke.graySecondary}`}})),[]);let c;if("page"===n.name&&n.blockId&&n.collectionViewId&&e){const e=`${d().A.domainBaseUrl}/${(0,s().Xw)(n.blockId)}`;c=(0,L.jsx)(no,{url:e,allIcons:t,hideUntilLoaded:!0,showOnlyIfOriginalSourceCollection:!0,className:"uidoc-workflow-templates-builder-in-app",style:p.container},e)}return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(E,{}),c]})}function no(e){const{url:t,allIcons:o,hideUntilLoaded:i,showOnlyIfOriginalSourceCollection:l,className:r,style:a}=e,s=(0,n.useMemo)((()=>({...K,url:t})),[t]),[p,c]=m(`${Yt}_${t}`,U,s),d=me({state:p,dispatch:c,allIcons:o,requireTemplateInstance:!0,...ye()});if(i&&"loaded"!==d.type)return null;if(l&&"loaded"===d.type&&!d.context.isOriginalSourceCollectionViewBlock)return null;const u=(0,L.jsx)(Ut,{builderContextState:d,isCompact:!0});return r||a?(0,L.jsx)("div",{className:r,style:a,children:u}):u}function io(e){return(0,i().X)("workflow_templates_builder")?(0,L.jsx)(oo,{}):null}},658294:(e,t,o)=>{o.d(t,{G:()=>l});var n=()=>o(137476),i=()=>o(836331);function l(e,t){n().vd(e,"delete_property",t),i().default.logEvent("delete_property")}},725494:(e,t,o)=>{o.r(t),o.d(t,{checkmarkIcon:()=>i,iconDefinition:()=>n});o(242343);const n={viewBox:"0 0 20 20",svg:(0,o(163643).jsx)("path",{d:"M15.784 4.002a.625.625 0 0 1 .214.857L9.445 15.784a.625.625 0 0 1-1.01.085l-4.37-5.098a.625.625 0 0 1 .948-.814l3.806 4.44 6.109-10.181a.625.625 0 0 1 .857-.214"})},i=(0,o(680369).wt)("checkmark",n)},753030:(e,t,o)=>{o.d(t,{C:()=>i});var n=()=>o(698094);class i{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=e=>{let{value:t,passThroughData:o}=e,n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},775781:(e,t,o)=>{o.d(t,{CF:()=>a,f:()=>l});o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(403517);var n=()=>o(901552),i=()=>o(727528);function l(e){let{collectionStore:t,modules:o,dependencyMap:n}=e;return s({modules:o,mapper:r(t,n)})}function r(e,t){return o=>(0,i().CB)({collectionStore:e,sourceTemplateType:"property",sourcePrimitiveId:o,dependencyMap:t})}function a(e){const t=new Set;return s({modules:e,mapper:e=>(t.add((0,n().vO)({type:"property",id:e})),e)}),t}function s(e){let{modules:t,mapper:o}=e;const n=e=>e?e.map((e=>function(e){let{module:t,mapper:o}=e;switch(t.type){case"bottomControls":case"relationsGroup":case"cover":case"discussions":case"editor":case"expandedBacklinks":case"formQuestion":case"formSubmit":case"formTitle":case"inlinePageSections":case"placeholder":case"properties":case"transcript":case"viewsMain":return t;case"property":return{...t,propertyId:o(t.propertyId)};case"titleWithIcon":return{...t,propertyIds:t.propertyIds?t.propertyIds.map(o):void 0};case"views":return{...t,relation_pointer:t.relation_pointer?{...t.relation_pointer,property:o(t.relation_pointer.property)}:void 0}}return t}({module:e,mapper:o}))):void 0;return{page_layout_schema:n(t.page_layout_schema),page_info_layout_schema:n(t.page_info_layout_schema),form_layout_schema:n(t.form_layout_schema),person_profile_page_main:n(t.person_profile_page_main),person_profile_page_details:n(t.person_profile_page_details)}}},901552:(e,t,o)=>{o.d(t,{D6:()=>x,Jp:()=>d,OU:()=>h,PT:()=>w,To:()=>g,rW:()=>v,rs:()=>f,vO:()=>y});o(725707),o(491955),o(500234),o(403517);var n=()=>o(975392),i=()=>o(76394),l=()=>o(940445),r=()=>o(540816);const a="content",s="item",p="items",c="optionalDefaultOn",d="/icons/document_gray.svg",u={collection_view:"View",layout:"Layout",collection:"Collection",property:"Property",compound:"Compound",block:"Block",automation:"Automation"},m=Symbol("BuilderKey"),f=y({type:"property",id:o(564134).rn});function y(e){return(0,i().GV)(`${e.type}:${e.id}`,m)}function g(e){if("explicit-undefined"!==e)return e}function h(e){return void 0===e?"explicit-undefined":e}function v(e,t){var o;const n=y(t),u=null===(o=e.state.builderSettings)||void 0===o?void 0:o[n],m=b(e,t),f=m?function(e,t){const o={},n=e.templateRegistryMap.get(t);if(!n)return o;o.name=(0,l().getWorkflowTemplateName)(n),"property"!==n.type&&"collection_view"!==n.type&&"block"!==n.type&&(o.description=n.description);"property"===n.type&&(o.propertyOptionsType=n.propertyOptionsType,o.relatedCollectionTemplateId=n.relatedCollectionTemplateId);if("collection"===n.type){var r;o.hasMinimalOnboarding=null===(r=n.value.onboarding)||void 0===r?void 0:r.isMinimal,o.singularItemName=n.value.targetCollection.itemName.singular,o.pluralItemName=n.value.targetCollection.itemName.plural,o.category=n.category}if("collection"!==n.type&&e.sourceCollectionTemplate){const n=e.sourceCollectionTemplate.value.templateItems.find((e=>e.pointer===t));n?(o.optionality=n.optionality,o.isInSettings=n.isInSettings):o.includeInCollectionTemplate=!1}"compound"===n.type&&(o.icon=n.icon,o.templateItems=n.value.templateItems.map((t=>{const o=e.templateIdToBuilderKeyMap.get(t.pointer);if(o)return{pointer:o,optionality:t.optionality}})).filter(i().O9));return o}(e,e.state.createCopy&&t.templateId?t.templateId:m):{};return{templateId:m,isDeleted:(null==u?void 0:u.isDeleted)??"uninstantiated_template"===t.type,description:((null==u?void 0:u.description)??f.description)||void 0,category:(null==u?void 0:u.category)??f.category,optionality:(0,r().O)(t)?"required":(null==u?void 0:u.optionality)??f.optionality??c,hasMinimalOnboarding:(null==u?void 0:u.hasMinimalOnboarding)??f.hasMinimalOnboarding??!1,singularItemName:(null==u?void 0:u.singularItemName)??f.singularItemName??s,pluralItemName:(null==u?void 0:u.pluralItemName)??f.pluralItemName??p,isInSettings:(null==u?void 0:u.isInSettings)??f.isInSettings??!1,propertyOptionsType:(null==u?void 0:u.propertyOptionsType)??(null==f?void 0:f.propertyOptionsType)??a,includeInCollectionTemplate:(null==u?void 0:u.includeInCollectionTemplate)??(null==f?void 0:f.includeInCollectionTemplate)??!0,templateItems:(null==u?void 0:u.templateItems)??(null==f?void 0:f.templateItems)??[],name:(null==u?void 0:u.name)??(null==f?void 0:f.name)??t.name??("layout"===t.type?"Layout":""),icon:(null==u?void 0:u.icon)??(null==f?void 0:f.icon)??d,bypassCreateCopy:I(u,t),relatedCollectionTemplateId:(null==u?void 0:u.relatedCollectionTemplateId)??(null==f?void 0:f.relatedCollectionTemplateId),ignore:(null==u?void 0:u.ignore)??!!(0,r().NU)(t),shouldMapToTemplate:(null==u?void 0:u.shouldMapToTemplate)??!("collection_view"!==t.type||!t.defaultBuiltinTemplateIdToMapTo)}}function I(e,t){return void 0!==(null==e?void 0:e.bypassCreateCopy)?e.bypassCreateCopy:"property"===t.type&&"relation"===t.schema.type}function b(e,t){var o;const n=y(t),i=null===(o=e.state.builderSettings)||void 0===o?void 0:o[n],l=I(i,t),a=e.state.createCopy&&!l?void 0:t.templateId;if(void 0!==(null==i?void 0:i.templateId))return null==i?void 0:i.templateId;if(void 0!==a)return a;const s="collection"===t.type?"":`${b(e,e.collectionInfo)}.`;return(0,r().O)(t)?`${s}title${u.property}`:"collection_view"===t.type&&t.defaultBuiltinTemplateIdToMapTo&&!1!==(null==i?void 0:i.shouldMapToTemplate)?t.defaultBuiltinTemplateIdToMapTo:t.name&&"uninstantiated_template"!==t.type?s+(p=t.name,c=t.type,`${w(p)}${u[c]}`):"layout"===t.type?`${s}default${u.layout}`:"automation"===t.type?`${s}${t.referrerName}${u.automation}`:void 0;var p,c}function w(e){return(0,n().xQ)(e)}function x(e,t){let o,n,i,{includeType:l=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof t?(n=t,i=e.featureInfoMap.get(t)):(i=t,n=y(i)),i){const t=v(e,i);o=`${t.name||t.templateId}${l?` (${r=i,r.type.replace(/_/g," ")})`:""}`}var r;return o||n}},961397:(e,t,o)=>{o.d(t,{C8:()=>u,ET:()=>d,Ll:()=>C,OX:()=>f,QT:()=>g,Rh:()=>b,UA:()=>c,Wm:()=>h,XM:()=>p,aO:()=>I,bd:()=>m,gM:()=>y,gP:()=>x,hq:()=>v,pp:()=>w});o(610931),o(362833),o(725707),o(491955),o(500234),o(403517);var n=()=>o(505966),i=()=>o(141479),l=()=>o(3311),r=()=>o(76394),a=()=>o(940445);const s=3;function p(e){let{origin:t,parentStore:o,flowId:n}=e;return{collectionTemplate:void 0,origin:t,flowId:n??(0,l().Ay)(),collectionTemplatesSearchQuery:void 0,parentStore:o}}function c(e){let{collectionViewTemplates:t,featureTemplateSelections:o}=e;const i=[];for(const l of t)i.push(...(0,n().CA)({template:l,dependencyMap:l.dependencyMap||{}}).map((e=>e.templateId)));return o.filter((e=>"required"!==e.optionality&&!i.includes(e.template.templateId)&&g(e.template)))}function d(e){let{template:t}=e;return{recordTitles:new Array(s).fill(""),featureTemplateSelections:t.value.templateItems.map((e=>m(e.pointer,e.optionality)))}}function u(e){const{collectionTemplate:t,origin:o,flowId:n,parentStore:i}=e;return{collectionTemplate:t,userCustomizations:d({template:t}),origin:o,flowId:n??(0,l().Ay)(),parentStore:i,collectionTemplatesSearchQuery:void 0,previewCollectionInfo:void 0}}function m(e,t){const o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:a().globalWorkflowTemplates).fromId(e);if(!(0,n().Jb)(o))throw new Error(`Template ${e} in collection template is not a feature template`);return"required"===t?{template:o,optionality:"required",selected:!0}:"optionalDefaultOn"===t?{template:o,optionality:"optionalDefaultOn",selected:!0}:"optionalDefaultOff"===t?{template:o,optionality:"optionalDefaultOff",selected:!1}:void(0,r().HB)(t)}function f(e){if(!e.collectionTemplate)throw new Error("Collection template cannot be undefined");return{collectionTemplate:e.collectionTemplate,userCustomizations:e.userCustomizations,origin:e.origin,flowId:e.flowId,collectionTemplatesSearchQuery:e.collectionTemplatesSearchQuery,parentStore:e.parentStore,previewCollectionInfo:e.previewCollectionInfo}}function y(e){var t,o,n,i;return{origin:e.origin,has_selection_modal_search_query:((null===(t=e.collectionTemplatesSearchQuery)||void 0===t?void 0:t.length)??0)>0,flow_id:e.flowId,collection_template_id:null===(o=e.collectionTemplate)||void 0===o?void 0:o.templateId,destination_type:null===(n=e.parentStore)||void 0===n?void 0:n.table,destination_id:null===(i=e.parentStore)||void 0===i?void 0:i.id}}function g(e){return"property"===e.type&&"relation"!==e.value.type||"compound"===e.type}function h(e){const{version:t}=e;return i().s[t]}function v(e){const{currentStepIndex:t}=e;return h(e)[t]}function I(e,t){const{currentStepIndex:o,collectionTemplate:n}=e,i=h(e);for(let l=o+1;l<i.length;l++){const e=i[l];if(!(n&&T({step:e,template:n,action:"next",isPhone:t})))return l}return-1}function b(e,t){return I(e,t)>=0}function w(e,t){return x(e,t)>=0}function x(e,t){const{currentStepIndex:o,collectionTemplate:n}=e,i=h(e);for(let l=o-1;l>=0;l--){const e=i[l];if(!(n&&T({step:e,template:n,action:"previous",isPhone:t})))return l}return-1}function T(e){let{step:t,template:o,action:n,isPhone:i}=e;switch(t){case"viewsSelection":return i||a().globalWorkflowTemplates.allOfType({templateIds:o.value.templateItems.map((e=>e.pointer)),type:"collection_view"}).length<=1;case"templateSelection":case"features":case"setupGeneratorInput":return!1;case"setupGeneratorBuilding":return"previous"===n;default:(0,r().HB)(t)}}function C(e){let{userCustomizations:t,templateId:o}=e;const n=t.featureTemplateSelections,i=n.find((e=>e.template.templateId===o));if(!i||"required"===i.optionality)return t;const l={...i,selected:!i.selected};return{...t,featureTemplateSelections:n.map((e=>e.template.templateId===o?l:e)),prevFeatureTemplateSelections:n}}},963644:(e,t,o)=>{o.d(t,{i:()=>l});var n=()=>o(876695),i=()=>o(658294);function l(e){const{environment:t,collectionContextStore:o,property_type:l,from:r,property:a,...s}=e,p=(0,n().sl)(o)||{};(0,i().G)(t,{property:a,property_type:l,from:r,...s,...p})}}}]);