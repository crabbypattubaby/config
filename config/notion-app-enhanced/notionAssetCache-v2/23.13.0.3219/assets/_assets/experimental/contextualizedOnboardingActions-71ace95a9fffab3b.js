"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[34420,77970],{35294:(e,t,r)=>{r.r(t),r.d(t,{applyMultiplayerReverseTrialIfEligible:()=>u().V_,applyReverseBusinessTrial:()=>u().xX,applyReversePlusTrial:()=>u().xE,handleTrialUpgradeFromOnboarding:()=>u().WR,handleTrialUpgradeFromOnboardingImpl:()=>u().eu,isEligibleForBlockLimitTimedTrial:()=>c});var n=()=>r(732541),i=()=>r(647242),a=()=>r(436622),s=()=>r(397138),o=()=>r(384055);async function c(e,t){const r=await a().A.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,i().AI)(r))return!1;const c=null==t?void 0:t.getSetting("reach_block_limit_time");if(!c||(0,n().Mn)(c)<3)return!1;if(await(0,s().G)(e))return!1;const u=t.getSpaceId();return!!(await(0,o().L6)({environment:e,spaceId:u,offerCampaign:"default"}))}var u=()=>r(308839)},265516:(e,t,r)=>{r.d(t,{Q:()=>n,a:()=>i});let n=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}({});class i extends(()=>r(129044))().default{getInitialState(){return{dayStoreMap:new Map,isDragging:!1,startingMonth:0}}}},308839:(e,t,r)=>{r.d(t,{V_:()=>k,WR:()=>N,eu:()=>T,xE:()=>x,xX:()=>R});r(610931);var n=()=>r(486826),i=(r(242343),()=>r(502140)),a=()=>r(647242),s=()=>r(678988),o=()=>r(653998),c=()=>r(450475),u=()=>r(3311),l=()=>r(421650),d=()=>r(818369),p=()=>r(145046),m=()=>r(70989),v=()=>r(137476),f=()=>r(485966),y=()=>r(436622),g=()=>r(836331),b=()=>r(855827),_=()=>r(397138),S=()=>r(104838),h=()=>r(384055),w=()=>r(298520),I=()=>r(613313),A=()=>r(111826),E=()=>r(879205),D=()=>r(30299),C=r(163643);const M=(0,o().YK)({applyingBusinessTrial:{id:"trialUpsellActions.applyingBusinessTrial",defaultMessage:"Setting up your Business trialâ€¦"}});async function T(e){var t,r;const{environment:c,stripe:u,elements:d,trialData:m,trialDays:v,sessionId:g,customerName:b,businessName:_}=e;if(!d||!u)return void i().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:h}=await d.submit();if(h)return void l().$X(c,{error:"could not submit form",error_type:"payment_method"});const M=await u.createPaymentMethod({elements:d});if(M.error)return void l().$X(c,{error:M.error.message,error_type:"payment_method"});if(!M.paymentMethod)return void l().$X(c,{error:"could not create token",error_type:"payment_method"});const T={type:"paymentMethodId",value:M.paymentMethod.id},N=f().default.state.currentSpaceStore;if(!N)return;const k=N.id,R=await w().p_({environment:c,spaceId:k}),x=await y().A.awaitData(c,{spaceId:k});if(!x)throw new Error("Billing data not loaded");const V=(0,a().lQ)(x),B=E().A.state.selectedCurrencyCode??"USD",P=(0,D().Zr)(),q=(0,s().vk)(R,{interval:"month",product:P,currency:B}),F=(0,I().Le)(),L=(0,s().vH)(V,{price:q,quantity:1},{isMay13PackagingChangesEnabled:F}),U=n().c9.now().plus({days:v});return await async function(e){const{environment:t,spaceStore:r,paymentData:n,desiredState:i,stripe:a,trialData:s,customerName:c,businessName:u,addressZip:d,addressCountry:m,sessionId:v}=e,f=await y().A.awaitData(t,{spaceId:r.id});try{const e=await S().nV({environment:t,sessionId:v,spaceStore:r,desiredState:i,paymentData:n,from:"onboarding",trialData:s,billingEmail:(0,A().cs)(f),customerName:c,businessName:u,addressZip:d,addressCountry:m}),l=e.paymentIntentClientSecret,y=e.paymentIntentStatus;if(l&&"requires_action"===y){const{error:e}=await a.handleNextAction({clientSecret:l});e&&(await S().M2({environment:t,spaceStore:r,from:"subscription_upgrade_onboarding_failed_payment"}),p().f1((0,C.jsx)(o().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void l().AF(t)}}({environment:c,spaceStore:N,desiredState:{...L,trialEnd:U},paymentData:T,stripe:u,trialData:m,customerName:b,businessName:_,addressZip:(null===(t=M.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(r=M.paymentMethod.billing_details.address)||void 0===r?void 0:r.country)||"",sessionId:g})}const N=(0,r(975392).sg)(T,1e3,{leading:!0,trailing:!1});async function k(e){let{spaceStore:t,environment:r}=e;const n=t.id;if(await(0,h().L6)({environment:r,spaceId:n,offerCampaign:"reverse"})&&(0,I().s)(r)){await x(t,r,"going_multiplayer")&&await b().A.resetData(r,{spaceId:n})}}async function R(e,t,r){try{m().m({message:M.applyingBusinessTrial});const n=e.id,i=await d().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:n,trialData:{id:"business_reverse",from:r}}});return"success"===i.type?((0,v().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"business_reverse",success:"success"===i.data.status}}}),await S().o2({environment:t,spaceStore:e}),m().V(),"success"===i.data.status):(V("business_reverse",t,i.error),m().V(),!1)}catch(n){return V("business_reverse",t,n),m().V(),!1}}async function x(e,t,r){let n="reverse";try{const i=await(0,_().G)(t),a=Boolean(g().default.checkGate({gateName:"apply_reverse_trial_key"}));i&&(n="reverse_mm_ent");const s=e.id,o=`${s}_timed_trial`,c=a?(0,u().gB)(o):void 0,l=await d().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:s,trialData:{id:n,from:r},idempotencyKey:c}});return"success"===l.type?((0,v().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:n,success:"success"===l.data.status}}}),await S().o2({environment:t,spaceStore:e}),"success"===l.data.status):(V(n,t,l.error),!1)}catch(i){return V(n,t,i),!1}}function V(e,t,r){(0,v().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),i().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,c().convertErrorToLog)(r)})}},649074:(e,t,r)=>{r.d(t,{DS:()=>i,Fe:()=>u,GB:()=>s,Gf:()=>d,V_:()=>l,j1:()=>c,j8:()=>a,yp:()=>p,yw:()=>o});var n=()=>r(647242);function i(e){return(0,n().Fq)({subscription:e})}function a(e){return(0,n().Ry)({subscription:e,trial:void 0})}function s(e){let{subscriptionState:t,logFunction:r,spaceId:i}=e;const a=m(t);return(0,n().yB)({billingData:{subscription:a,trial:void 0},logFunction:r,spaceId:i})}function o(e){return(0,n().q8)({subscription:e})}function c(e){return(0,n().V9)({subscription:m(e),trial:void 0})}function u(e){return(0,n().d$)({subscription:m(e),trial:void 0})}function l(e){return(0,n().ji)({subscription:m(e),trial:void 0})}function d(e){return(0,n().AI)({subscription:m(e),trial:void 0})}function p(e,t){return(0,n().KH)({subscription:m(e),trial:void 0},t)}function m(e){return e?{...e,trialEnd:void 0}:void 0}},678988:(e,t,r)=>{r.d(t,{HO:()=>m,V5:()=>c,Vr:()=>u,ef:()=>p,gL:()=>l,ng:()=>y,vH:()=>d,vk:()=>f,z2:()=>v});r(610931),r(112188),r(725707),r(491955),r(500234),r(403517),r(113085);var n=()=>r(141666),i=()=>r(647242),a=()=>r(649074),s=()=>r(216376),o=()=>r(455831);function c(e,t){return m(e.items,t.items).some((e=>{let[t,r]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const r=i().xp(e),n=i().xp(t);if(!r||!n)return!1;return o().o3[r]>o().o3[n]}(t,r)}))}function u(e,t,r){let{trialEnd:n,items:i}=t;return{trialEnd:n,items:i.map((t=>{const n=t.price.product,i=t.price.unitAmount.currencyCode,a=f(e,{interval:r,product:n,currency:i});return{...t,price:a}}))}}function l(e,t){const r=e.items.filter((e=>i().IE(e)!==t));return{...e,items:r}}function d(e,t,r){const{isMay13PackagingChangesEnabled:n}=r,a=i().IE(t),s=t.price.product,o=e.items.filter((e=>{const t=e.price.product,r=i().IE(e);return!(a===r)&&!(n&&"ai"===t&&("business"===s||"enterprise"===s))}));return{...e,items:o.concat([t])}}function p(e){const{state:t,prices:r,quantities:n,params:{interval:a,currency:s},products:o,flags:{isMay13PackagingChangesEnabled:c}}=e,u=o.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),l=u.map((e=>i().Mr(e))),d=t.items.filter((e=>{const t=e.price.product,r=i().IE(e),n=l.includes(r),a=c&&"ai"===t&&(u.includes("business")||u.includes("enterprise"));return!n&&!a})),p=u.map((e=>y(f(r,{interval:a,currency:s,product:e}),n)));return{...t,items:d.concat(p)}}function m(e,t){return(0,n().Z4)(e,(e=>i().IE(e)),t,(e=>i().IE(e)))}function v(e){const{prices:t,billingData:r,product:n}=e,s=i().Ry(r),o=i().lQ(r),c=a().yw(o),u=i().q8(r),l=c??u;return t.find((e=>e.product===n&&e.billingInterval===l&&e.unitAmount.currencyCode===s))}function f(e,t){let{interval:r,product:n,currency:i}=t;return function(e,t){if(null==e)throw new Error(t);return e}(e.find((e=>e.product===n&&e.billingInterval===r&&e.unitAmount.currencyCode===i)),`Unable to find price with interval: ${r}, product: ${n}, currency: ${i}`)}function y(e,t){const{numSeats:r,numCustomHostnames:n}=t;return"public_domain_custom_hostnames"===(0,s().vK)(e.product)?{price:e,quantity:n}:{price:e,quantity:r}}},855827:(e,t,r)=>{r.d(t,{A:()=>i});const n=new(r(967203).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{var n;let{spaceId:i}=t;if(null===(n=r(485966).default.state.currentSpaceStore)||void 0===n||!n.canAdmin())return;const a=await Promise.resolve().then(r.bind(r,818369)),s=await a.callApi({eventName:"getCustomerOffersReceived",environment:e,data:{spaceId:i},headers:(0,r(519423).WS)({cellId:void 0,spaceId:i})});return"success"===s.type&&(0,r(76394).EI)(s.data)?s.data:void 0}));r(996094).exposeDebugValue("OffersReceivedStore",n);const i=n},993254:(e,t,r)=>{r.d(t,{T:()=>i});r(362833),r(725707),r(244387);var n=()=>r(437800);function i(e){const{environment:t,collectionStore:r,duplicate:i,droppedStores:a,transaction:s,duplicateActions:o}=e,{movedStores:c,reparentedStores:u}=a.reduce(((e,t)=>(i||t.getAssociatedCollectionId()!==(null==r?void 0:r.id)?e.reparentedStores.push(t):e.movedStores.push(t),e)),{movedStores:[],reparentedStores:[]});return[...c,...n().MS({environment:t,droppedStores:u,duplicate:i,transaction:s,resolveTemplateVariables:!1,duplicateActions:o})]}}}]);