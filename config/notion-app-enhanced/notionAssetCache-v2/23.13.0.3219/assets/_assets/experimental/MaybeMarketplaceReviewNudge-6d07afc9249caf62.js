"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[54215],{53592:(e,t,i)=>{i.d(t,{Bl:()=>d,IH:()=>u,Lh:()=>T,Mh:()=>f,RY:()=>h,VP:()=>y,_A:()=>m,n$:()=>p});var n=()=>i(76394),r=()=>i(732541),o=()=>i(524118),s=()=>i(881961);const a=15;function d(e){if(!s().Vu.includes(e))throw new(o().rTV)("Rating must be an integer between 1 and 5.",{type:"marketplace_listing_review_invalid_rating"});return!0}const c=3,l=100;function u(e){const t=e.trim();if(t.length<c)throw new(o().rTV)("Title too short",{type:"marketplace_listing_review_title_too_short"});if(t.length>l)throw new(o().rTV)("Title too long",{type:"marketplace_listing_review_title_too_long"})}const g=50,v=1500;function m(e){const t=e.trim();if(t.length<g)throw new(o().rTV)("Description too short",{type:"marketplace_listing_review_description_too_short"});if(t.length>v)throw new(o().rTV)("Title too long",{type:"marketplace_listing_review_description_too_long"})}const w=40;function h(e){const t=e.trim();if(0===t.length)throw new(o().rTV)("Name is required",{type:"marketplace_listing_review_name_too_short"});if(t.length>w)throw new(o().rTV)("Name too long",{type:"marketplace_listing_review_name_too_long"})}const I=5,_=1500;function p(e){const t=e.trim();if(t.length<I)throw new(o().rTV)("Creator response too short",{type:"marketplace_listing_review_creator_response_too_short"});if(t.length>_)throw new(o().rTV)("Creator response too long",{type:"marketplace_listing_review_creator_response_too_long"})}function f(e){return void 0!==e.getTitle()&&void 0!==e.getSerializedContent()}function y(e){return(0,r().YH)(e)<a}function T(e){switch(e){case"mostRecent":return{columnName:"updated_time",direction:"descending"};case"highestRating":return{columnName:"rating",direction:"descending"};case"lowestRating":return{columnName:"rating",direction:"ascending"};default:(0,n().HB)(e)}}},160500:(e,t,i)=>{i.d(t,{A:()=>o});const n={reviewIdCache:{},isOpen:!1,acquisitionId:"",stage:"rating",rating:0,source:void 0};class r extends(()=>i(129044))().default{getInitialState(){return{...n}}setReviewId(e,t){this.setState({...this.state,reviewIdCache:{...this.state.reviewIdCache,[e]:t}})}getReviewId(e){return this.state.reviewIdCache[e]}openModal(e){let{stage:t,acquisitionId:i,rating:r,source:o}=e;this.setState({...n,reviewIdCache:this.state.reviewIdCache,isOpen:!0,acquisitionId:i,stage:t,rating:r||0,source:o})}closeModal(){this.setState({...n,reviewIdCache:this.state.reviewIdCache})}updateState(e){this.setState({...this.state,...e})}}const o=new r},709742:(e,t,i)=>{i.r(t),i.d(t,{MaybeMarketplaceReviewNudge:()=>y});var n=i(242343),r=()=>i(237385),o=()=>i(803290),s=()=>i(162901),a=()=>i(53592),d=()=>i(818369),c=()=>i(485966),l=()=>i(527012),u=()=>i(978993),g=()=>i(710601),v=()=>i(160500),m=()=>i(835898),w=()=>i(948214),h=i(163643);const I=15,_=10,p=10,f=1;function y(e){let{blockStore:t}=e;const i=(0,r().v3)(),{installationPointer:y,version:T,lastEditedById:k,lastEditedTime:R,createdTime:q}=function(e){return(0,o().K8)((()=>{var t;if(!e.isDefined())return{};const i=e.getModel();return{installationPointer:i.getIsImprintableBlock()?null===(t=i.getFormat().installation_imprint)||void 0===t?void 0:t.pointer:void 0,lastEditedById:e.getLastEditedById(),lastEditedTime:e.getLastEditedTime(),createdTime:e.getCreatedTime(),version:i.getVersion()}}),[e])}(t),{acquisitionPointer:C}=function(e){const t=(0,r().v3)();return(0,o().K8)((()=>{if(!e)return{};const i=new(g().f)(t,e);return{acquisitionPointer:null==i?void 0:i.getAcquisitionPointer()}}),[t,e])}(y),{customerPointer:S,acquisitionStatus:M,listingId:b,acquisitionId:V,succeededTime:N}=function(e){const t=(0,r().v3)();return(0,o().K8)((()=>{var i,n;if(!e)return{};const r=new(l().y)(t,e);return{acquisitionStatus:null==r?void 0:r.getStatus(),succeededTime:(null===(i=r.getAttributes())||void 0===i?void 0:i.succeeded_time)??r.getCreatedTime(),customerPointer:null==r?void 0:r.getCustomerPointer(),listingId:null==r?void 0:r.getListingId(),acquisitionId:null==r||null===(n=r.getModel())||void 0===n?void 0:n.id}}),[t,e])}(C),{acquirerId:P,customerId:E}=function(e){let{customerPointer:t,acquisitionStatus:i,succeededTime:n,listingId:s}=e;const d=(0,r().v3)();return(0,o().K8)((()=>{var e,r;if(!t||"succeeded"!==i||!s||!n||(0,a().VP)(n))return{};const{currentUserSettingsStore:o}=c().default.state;if(null==o||!o.isDefined())return{};const l=o.getSettingsStore().getKeyStore("marketplace_review_nudge").getValue();if(Object.keys(l||{}).length>=p||(null===(e=(l||{})[s])||void 0===e?void 0:e.length)>=f)return{};const g=new(u().z)(d,t);return{acquirerId:null==g?void 0:g.getAcquirerId(),customerId:null==g||null===(r=g.getModel())||void 0===r?void 0:r.id}}),[d,t,i,s,n])}({customerPointer:S,acquisitionStatus:M,succeededTime:N,listingId:b}),B=function(e){let{currentUserId:t,listingId:i,customerId:r,acquirerId:s,version:a,lastEditedById:d,lastEditedTime:c,createdTime:l}=e;const u=(0,n.useRef)(Date.now());return(0,o().K8)((()=>{if(!(r&&s&&i&&a&&d&&c&&l))return!1;if(c<u.current)return!1;if(s!==t||d!==t)return!1;return!((c-l)/6e4<I)&&!(a<_)}),[t,i,r,s,a,d,c,l])}({currentUserId:i.currentUser.id,listingId:b,customerId:E,acquirerId:P,version:T,lastEditedById:k,lastEditedTime:R,createdTime:q}),{reviewId:K,isReady:A}=function(e){let{acquisitionId:t,listingId:i,customerId:o,shouldDisplayNudge:a}=e;const c=(0,r().v3)(),[l,u]=(0,n.useState)(),[g,m]=(0,s().V$)((async()=>{if(i&&o&&t){const e=await d().callApi({eventName:"getMarketplaceListingReviewForCustomer",environment:c,data:{listingId:i,customerId:o}});if("success"===e.type&&e.data.success){const{reviewId:i}=e.data;v().A.setReviewId(t,i),u(i)}}}),[c,i,o,t]),w=Boolean(a&&i&&o&&t);return(0,n.useEffect)((()=>{w&&m()}),[w,m]),{reviewId:l,isReady:"resolved"===g.status}}({acquisitionId:V,listingId:b,customerId:E,shouldDisplayNudge:B}),{isReady:D,isComplete:L,rating:O}=(0,m().Z)(K);return B&&A&&D&&!L&&!O&&V&&b?(0,h.jsx)(w().lK,{acquisitionId:V,listingId:b}):null}},835898:(e,t,i)=>{i.d(t,{L:()=>c,Z:()=>l});var n=()=>i(237385),r=()=>i(803290),o=()=>i(53592),s=()=>i(881961),a=()=>i(413871),d=()=>i(160500);function c(e){return l((0,r().K8)((()=>d().A.getReviewId(e)),[e]))}function l(e){const t=(0,n().v3)();return(0,r().K8)((()=>{if(e){const i=new(a().Js)(t,{table:s().UN,id:e}),n=i.isReady(),r=i.getModel();return{isReady:n,isComplete:Boolean(r&&(0,o().Mh)(r)),rating:i.getRating()}}return{isComplete:!1,isReady:!0}}),[t,e])}},948214:(e,t,i)=>{i.d(t,{hD:()=>o,lK:()=>a});var n=()=>i(129978);const r=new(n().O2)("MaybeMarketplaceReviewNudge",(()=>i.e(54215).then(i.bind(i,709742)))),o=(0,n()._h)(r,(e=>e.MaybeMarketplaceReviewNudge)),s=new(n().O2)("MarketplaceReviewNudge",(()=>Promise.all([i.e(39782),i.e(2501)]).then(i.bind(i,310722)))),a=(0,n()._h)(s,(e=>e.MarketplaceReviewNudge))}}]);