"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77282],{54852:(e,t,n)=>{n.d(t,{A:()=>I});n(362833),n(725707),n(491955),n(500234),n(403517);var i=n(242343),s=()=>n(803290),o=()=>n(599932),a=()=>n(214080),r=()=>n(769884),l=()=>n(409211),c=()=>n(653998),d=()=>n(31448),u=()=>n(861095),p=()=>n(360482),m=()=>n(907721),g=()=>n(714604),v=()=>n(413871),f=()=>n(535906),h=()=>n(858023),y=()=>n(975515),S=()=>n(625880),b=n(163643);const x=(0,c().YK)({invited_page:{id:"PermissionsInviteSearchRequest.userTooltip.invited_page",defaultMessage:"{userNameAndEmail} is invited to this page already"},invited_database:{id:"PermissionsInviteSearchRequest.userTooltip.invite_database",defaultMessage:"{userNameAndEmail} is invited to this database already"},invited_space:{id:"PermissionsInviteSearchRequest.userTooltip.invited_space",defaultMessage:"{userNameAndEmail} is invited to this workspace already"},invited_team:{id:"PermissionsInviteSearchRequest.userTooltip.invited_team",defaultMessage:"{userNameAndEmail} is invited to this teamspace already"},not_in_space:{id:"PermissionsInviteSearchRequest.userTooltip.admin",defaultMessage:"Click to invite {userNameAndEmail}"}});function k(e,t){return e.filter(((e,n)=>n<t))}const I=function(e){const{store:t,shouldShowBots:I,shouldShowGroups:C,sectionRenderLimit:w,membersOnly:T,hideCurrentUser:A,hideUserTypeToken:M,disableInvitedUsers:j,guestsMustBeRequested:R,hideTitle:_,defaultUserTitle:B,performSearchRequest:P}=e,[L,E,q]=(0,s().$y)(e.permissionsInviteStore),U=(0,n(237385).v3)(),{device:G}=U,F=(0,c().tz)(),{tokenQuery:N}=L,D=(0,i.useMemo)((()=>u()._c({environment:{device:G}})),[G]),O=(0,n(174114).IS)((e=>({roleBadge:{...D},invitedBadge:{...D,backgroundColor:e.defaultBadgeBackground}})),[D]),W="invitee",H=(0,s().K8)((()=>{const e=n(985532).A.state.shouldUseEdgeCache,t=n(836331).default.checkGate({gateName:"edge_cache_settings"});return e&&t}),[]),K={request:N,performRequest:e=>P?P({query:e,limit:10,environment:U}):n(235843).hQ({query:e,sectionLimit:{userLimit:10,botLimit:I?10:0,groupLimit:C?10:0,importContactLimit:0},membersOnly:T,environment:U,intl:F,shouldUseEdgeCacheRollout:H}),render:(e,i,s)=>{if(e)return(0,b.jsx)(S().z,{loading:!s,hideTitle:_,children:(0,b.jsx)(y().A,{title:(0,b.jsx)(c().sA,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})})});const I=i&&{...i,inviteUsers:i.inviteUsers.filter((e=>!(0,u().mQ)({permissionsInviteStore:q,target:e})&&(!A||e.value.id!==U.currentUser.id))),importedContacts:(0,u().GZ)(i.inviteUsers,i.importedContacts)},T=I&&(null==N?void 0:N.length)>0,{inviteUsers:P,inviteGroups:E,importedContacts:G=[]}=T?I:(0,u().Es)({currentInviteActors:I,permissionsInviteStore:q,targetStore:t}),D=[...k(P,w),...k(G,10)].map(((e,i)=>{const s="newUser"===e.type?e.value.email:e.value.id,o=(0,u().$D)(e),d=Boolean(T&&(0,u().VF)({permissionsInviteStore:q,userTarget:e,targetStore:t}));return{key:s,render:i=>{const{tooltip:s,userTypeToken:g}=function(e){const{userTarget:t,targetStore:n,isInvited:i,userSpaceRole:s,styles:o,intl:a}=e,d="newUser"===t.type?null:r().Bj6.fromValue(l().oo,t.value).getDisplayName(a),m=t.value.email,g=d&&d!==m?`${d} (${m})`:m,f=s&&"not_in_space"!==s;if(i)return{tooltip:(0,p().Yu)(n)?a.formatMessage(x.invited_space,{userNameAndEmail:g}):n instanceof v().Bv?a.formatMessage(x.invited_page,{userNameAndEmail:g}):n instanceof v().md?a.formatMessage(x.invited_database,{userNameAndEmail:g}):a.formatMessage(x.invited_team,{userNameAndEmail:g}),userTypeToken:(0,b.jsx)("div",{style:{...o.invitedBadge},children:(0,b.jsx)(c().sA,{id:"inviteUserModal.userRole.invitedBadge.label",defaultMessage:"Invited"})})};if(f){const e=u().S6({role:s,intl:a,nameOrEmail:g});return{tooltip:e.tooltip,userTypeToken:(0,b.jsx)("div",{style:{...o.roleBadge},children:e.userRoleBadge})}}return{tooltip:a.formatMessage(x.not_in_space,{userNameAndEmail:g}),userTypeToken:void 0}}({userTarget:e,targetStore:t,userSpaceRole:o,isInvited:d,styles:O,intl:F});return"existingUser"===e.type?(0,b.jsx)(n(698995).A,{...i,actor:(0,n(950635).A7)(e.value),right:M?void 0:g,tooltip:s,tooltipPlacement:m().W.Left,disabled:j&&d,defaultUserTitle:B}):(0,b.jsx)(n(103151).A,{placement:m().W.Left,alignment:m().C.Start,textWrap:!0,render:t=>(0,b.jsx)(f().A,{...i,...t,icon:(0,a().n)({width:24,height:24}),right:g,title:e.value.email.trim(),disabled:j&&d}),disableTooltip:!s,renderTooltip:()=>s})},action:()=>{if(j&&d)return;if(!L.isInviteTargetsEmpty&&(0,g().qs)(L))return;const t={...e,..."existingUser"===e.type&&{spaceRole:o}};n(528643).kH(U,{subscription_tier:(0,n(764227).AI)(),invite_token_query:N,selected_user_token:e,selected_user_token_rank:i,from:"permission_invite"}),q.setState({...L,inviteTargets:[...L.inviteTargets,t],isInviteTargetsEmpty:!1,tokenQuery:"",inputFocus:W})}}})),H=k(E,w).map((e=>{const{value:t}=e;return{key:t.id,render:e=>(0,b.jsx)(n(466051)._,{group:t,menuListItemProps:e}),action:()=>{!L.isInviteTargetsEmpty&&(0,g().qs)(L)||q.setState({...L,inviteTargets:[...L.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:"",inputFocus:W})}}})),K=[],z=L.isInviteTargetsEmpty||!(0,g().qs)(L);if(D.length>0&&z&&K.push({key:"user results",render:e=>(0,b.jsx)(S().z,{...e,loading:!s,hideTitle:_}),items:D}),C&&H.length>0&&z&&K.push({key:"group results",render:e=>(0,b.jsx)(n(88271).A,{...e,title:(0,b.jsx)(c().sA,{id:"inviteUserModal.searchDropdown.selectGroupTitle",defaultMessage:"Select a group"}),loading:!s}),items:H}),0===K.length&&z){const e=(0,o().qh)(L.tokenQuery);if((0,o().DT)(e)){const o={type:"newUser",value:{email:e},source:"email"},a=(0,u().mQ)({target:o,permissionsInviteStore:q});if(!a)return;if(a)return(0,b.jsx)(S().z,{loading:!s,hideTitle:_,children:(0,b.jsx)(y().A,{title:(0,b.jsx)(c().sA,{id:"inviteUserModal.userAlreadyInvitedMessage",defaultMessage:"Already inviting {user}.",values:{user:(0,b.jsx)("span",{style:{fontWeight:d().Wy.bold},children:(0,u().Sk)({intl:F,target:a})})}})})});const r=(i&&i.inviteUsers||[]).find((t=>"existingUser"===t.type&&t.value.email===e));if(r&&"existingUser"===r.type&&(0,u().wF)({store:t,target:r}))return(0,b.jsx)(S().z,{loading:!s,hideTitle:_,children:(0,b.jsx)(y().A,{title:(0,b.jsx)(c().sA,{id:"inviteUserModal.userAlreadyHasPermissionMessage",defaultMessage:"{user} already has permission.",values:{user:(0,b.jsx)("span",{style:{fontWeight:d().Wy.bold},children:(0,n(14931).c6)(F,r.value)})}})})})}else{if(!L.tokenQuery)return null;K.push({key:"user results",render:e=>(0,b.jsx)(S().z,{...e,loading:!s,hideTitle:_,title:R?(0,b.jsx)(c().sA,{id:"inviteUserModal.searchDropdown.requestPeople",defaultMessage:"Keep typing to request inviting an email"}):(0,b.jsx)(c().sA,{id:"inviteUserModal.searchDropdown.addPeople",defaultMessage:"Keep typing to invite email"})}),items:[{key:L.tokenQuery,render:e=>(0,b.jsx)(f().A,{icon:(0,a().n)({width:24,height:24}),title:L.tokenQuery,...e}),action:()=>{}}]})}}return(0,b.jsx)(h().Ay,{type:h().Oh.Vertical,initialFocus:N.length>0?0:void 0,sections:K})}};return(0,b.jsx)(n(921637).A,{...K})}},64256:(e,t,n)=>{n.d(t,{BY:()=>h,Lg:()=>y,id:()=>k,nE:()=>I,xi:()=>S});n(362833),n(725707),n(324989),n(403517);var i=()=>n(502140),s=()=>n(707781),o=()=>n(446588),a=()=>n(647242),r=()=>n(818369),l=()=>n(919536),c=()=>n(575015),d=()=>n(477784),u=()=>n(485966),p=()=>n(436622),m=()=>n(138385),g=()=>n(133926),v=()=>n(307542),f=()=>n(814059);async function h(e){const{environment:t,spaceStore:n,contextualInviteStore:i}=e;!function(e){const{spaceStore:t,contextualInviteStore:n}=e,i=t.getRole();if(!i||!(0,o().NB)(i))return!1;if(!n.hasGuests())return!1;if(t.getDisableMembershipRequests())return!1;return(0,v().x3)()}({environment:t,spaceStore:n,contextualInviteStore:i})?await async function(e){const{spaceStore:t,contextualInviteStore:n,environment:i}=e,s=t.getRole();if(!s||!(0,o().vp)(s))return!1;if(!n.hasGuests())return!1;return await(0,g().Se)(i,{name:"members",spaceId:t.id,userId:t.userId,amount:1})}({environment:t,spaceStore:n,contextualInviteStore:i})?i.startWorkspaceInvite():i.setState({...i.state,inviteStage:m().d5.closed}):i.startRequestMembership()}async function y(e){const{environment:t,spaceStore:n,contextualInviteStore:s,from:o,intl:a}=e,{selection:r,flowId:d}=s.state;if("page_guest"===r||!s.hasGuests())return s.reset(),!1;const{inviteTargets:u,unknownEmails:p}=await b({environment:t,contextualInviteStore:s}),m={...s.state};s.reset();const v=await(0,g().Se)(t,{name:"non_admin_members",spaceId:n.id,userId:n.userId})?e.inviteRole??"read_and_write":"editor";try{await l().eP({environment:t,store:n,inviteTargets:u,inviteRole:v,isOnboarding:!1,invite:{inviteOrigin:o,inviteFlowId:d,disable_invite_email:!0}})}catch(f){return function(e,t){if(0===t.length)return;c().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:k(t,e),userCount:t.length})})}(a,m.invitedUsers),i().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{...m,inviteTargets:u}}}),!1}finally{p.length&&i().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.unknownUserId",data:{miscDataToConvertToString:{...m,unknownEmails:p}}})}return!0}async function S(e){const{environment:t,spaceStore:n,originId:s,originType:o,reasonMessage:a,contextualInviteStore:l,intl:d}=e,{selection:u}=l.state;if("page_guest"===u||!l.hasGuests())return l.reset(),!1;const{inviteTargets:p,unknownEmails:m}=await b({environment:t,contextualInviteStore:l}),g={...l.state};l.reset();const v=[];try{const e=p.map((e=>r().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:e.value.id,spaceId:n.id,message:a,attributes:{origin_id:s,origin_type:o,origin_table:"share_menu"===o?"block":"space",add_permissions_on_approval:!1}}}).catch((()=>v.push(e)))));await Promise.all(e)}catch(f){return function(e,t){if(0===t.length)return;c().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:k(t,e)})})}(d,g.invitedUsers),i().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.inviteTargets",data:{miscDataToConvertToString:{...g,inviteTargetsWithErrors:v}}}),!1}finally{m.length&&i().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.unknownUserId",data:{miscDataToConvertToString:{...g,unknownEmails:m}}})}return!0}async function b(e){const{environment:t,contextualInviteStore:n}=e,{invitedEmailToUserIdMap:i}=n.state,s=[],o=[];for(const a of n.state.invitedUsers){if(!a.isGuest)continue;const e=await x(t,a,i);e?s.push({type:"existingUser",value:{id:e,email:a.email,version:1}}):o.push(a.email)}return{inviteTargets:s,unknownEmails:o}}async function x(e,t,n){const i=await async function(e,t,n){let i=t.id;if(i||(i=n[t.email]),!i){const n=await r().callApi({eventName:"findUser",environment:e,data:{email:t.email}});if("failed"!==n.type){const e=n.data;e.value&&(i=e.value.value.id)}}return i}(e,t,n);if(i)return i;const o=(0,s().H)(d().A.getIntl()),a=await r().callApi({eventName:"createEmailUser",environment:e,data:{email:t.email,preferredLocaleOrigin:"inferred_from_inviter",preferredLocale:o}});return"failed"!==a.type?a.data.userId:void 0}function k(e,t){return(0,f().l)(e.flatMap((e=>e.email||[])))}function I(e,t){var n;const{state:i}=t,s=null===(n=u().default.state.currentSpaceStore)||void 0===n?void 0:n.id,o=s?(0,a().AI)(p().A.getData(e,{spaceId:s})):void 0,r=t.getGuestEmails();return{invite_flow_id:i.flowId,user_count:r.length,user_emails:r,invite_space_role_selection:i.selection,is_bot:!1,subscription_tier:o}}},93004:(e,t,n)=>{n.d(t,{P:()=>a});var i=()=>n(21164),s=()=>n(818369),o=()=>n(413871);async function a(e){const{environment:t,teamStore:n}=e,a=null==n?void 0:n.getSpaceId(),r=n&&a&&{id:n.id,table:i().Vl,spaceId:a},l=n&&r&&o().md.createChildStore(n,r),c=l&&l.isReady()&&!l.isDefined()&&l.canEdit();if(n&&a&&l&&c){const e=await s().callApi({eventName:"createCollectionViewBlockForPosts",environment:t,data:{spaceId:a,teamId:n.id}});if("failed"===e.type)throw e.error;if("success"===e.type){const{collectionViewBlockId:t}=e.data;return t}}}},127776:(e,t,n)=>{n.d(t,{Vs:()=>A,gj:()=>T,hX:()=>R,oH:()=>j,v4:()=>M});n(610931);var i=()=>n(488587),s=()=>n(502140),o=()=>n(427091),a=()=>n(214144),r=()=>n(218357),l=()=>n(412527),c=()=>n(779470),d=()=>n(34662),u=()=>n(539174),p=()=>n(818369),m=()=>n(649334),g=()=>n(84543),v=()=>n(477784),f=()=>n(213124),h=()=>n(904697),y=()=>n(513060),S=()=>n(196387),b=()=>n(320462),x=()=>n(485966),k=()=>n(413871),I=()=>n(810733),C=()=>n(93004),w=()=>n(628854);async function T(e){let{environment:t,name:n,description:i,icon:s,accessLevel:o,isDefault:a,flowId:l,createTeamHome:c,teamPermissionRole:d,spacePermissionRole:m,members:g,settings:v}=e;const{currentSpaceStore:f}=x().default.getState();if(!f)throw new Error("currentSpaceStore does not exist");const h=S().default.mark("client_create_team_latency"),y=f.id,b=await p().callApi({eventName:"createTeam",environment:t,data:{spaceId:y,name:n,description:i,icon:s,isDefault:a,accessLevel:o,teamPermissionRole:d,spacePermissionRole:m,members:g,settings:v}});if("failed"===b.type)return void(0,w().O)(b);const{teamId:I}=b.data,T=k().h4.createChildStore(f,{table:r().yK,id:I,spaceId:y});return await T.load(),(0,C().P)({environment:t,teamStore:T}),c&&_({environment:t,teamStore:T}),u()._P(t,{store:T,flowId:l}),S().default.measure(h,{environment:t}),T}function A(e){var t;let{environment:n,page:i}=e;const s=a().JW(),o=(null===(t=i.getParentPointer())||void 0===t?void 0:t.table)!==r().yK?"page_to_team_nested":"page_to_team";u().H8(n,{from:o,flowId:s}),I().A.setState({open:!0,pageStore:i,flowId:s})}async function M(e){var t;let{environment:n,page:i,flowId:s,intl:a}=e;const{accessLevel:l,spacePermissionRole:c,teamPermissionRole:u,members:p}=(0,h().getAccessLevelAndPermissionsForTeamCreatedFromPage)(i),m=(i.isDefined()?i.getModel().getRenderTitle({intl:a,userTimeZone:(0,o().P)(),getRecordModel:i.getRecordModel}):void 0)??d().q4_(i.getTitleValue()),v=await T({environment:n,name:m,icon:null===(t=i.getIcon())||void 0===t?void 0:t.icon,accessLevel:l,isDefault:!1,description:"",flowId:s,createTeamHome:!1,teamPermissionRole:u,spacePermissionRole:c,members:p});if(!v)return;const{currentSpaceViewStore:f}=x().default.state;if(!f)return;const S=await(0,y().U)();g().createAndCommit({userAction:"teamActions.movePageToCreatedTeam",environment:n,canUndo:!0,perform:e=>{S({environment:n,currentSpaceViewStore:f,transaction:e,teamStore:v,action:"move",value:{type:r().yK,id:v.id},targets:[i],location:{type:"append"}})}}),(0,w().F2)({environment:n,teamId:v.id,tab:b().p.Members,from:"create_team_from_page"}),await new Promise((e=>setTimeout((()=>(0,w().Mh)({teamStore:v,environment:n})),100)))}async function j(e){let{environment:t,name:n,description:i,icon:s,flowId:o,trackCreateTeamComplete:a}=e;const{currentSpaceStore:l}=x().default.getState();if(!l)throw new Error("currentSpaceStore does not exist");const c=l.id,d=await p().callApi({eventName:"enableTeams",environment:t,data:{spaceId:c,defaultTeamName:n,defaultTeamIcon:s,defaultTeamDescription:i}});if("failed"===d.type)return void(0,w().O)(d);const{teamId:m}=d.data,g=k().h4.createChildStore(l,{table:r().yK,id:m,spaceId:c});return await g.load(),await _({environment:t,teamStore:g}),u().b0(t,{spaceId:c,store:g,flowId:o}),a&&m&&u()._P(t,{store:g,flowId:o}),g}async function R(e){var t;let{environment:n,teamStore:s,from:o,buttonPopupStore:r}=e;if(!n.currentUser.id)return!1;const l=a().JW(),c=s.isDefault(),d=s.getTeamAccessLevel();if(c)return!1;const p=s.getName(),m=await T({environment:n,name:(0,i().Q)(p||""),description:"",icon:s.getRawIcon(),accessLevel:d,isDefault:c,createTeamHome:!0,teamPermissionRole:null===(t=s.getTeamPermission())||void 0===t?void 0:t.role,spacePermissionRole:s.getSpacePermissionRole(),members:[],settings:s.getSettings(),flowId:l});return!!m&&(u().KK(n,{store:m,from:o}),(0,w().L0)({environment:n,teamStore:m,shouldScroll:!0}),(0,w().F2)({environment:n,teamId:m.id,tab:b().p.General,from:"duplicate_team",buttonPopupStore:r}),new Promise((e=>setTimeout(e,500))).then((()=>{(0,f().jH)(p)})),!0)}async function _(e){const{environment:t,teamStore:n}=e,i=x().default.state.currentSpaceStore,o=x().default.state.currentSpaceViewStore;if(!i||!o)return s().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-SpaceOrSpaceViewStoreError"}),!1;const a=(r=v().A.getIntl(),(0,c().B)(l().wA.teamsHomepage,r));var r;return!!(await m().createTemplateInstance({environment:t,item:a,spaceStore:i,spaceViewStore:o,useMinimalTemplates:!1,type:"inTeam",teamStore:n,from:"homepage_team",isOnboarding:!1}))||(s().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-PageNotCreated"}),!1)}},138385:(e,t,n)=>{n.d(t,{Ay:()=>a,NJ:()=>i,d5:()=>s});n(725707),n(491955),n(403517),n(113085);let i=function(e){return e.unselected="unselected",e.workspace_member="workspace_member",e.request_workspace_member="request_workspace_member",e.page_guest="page_guest",e.closed="closed",e}({}),s=function(e){return e[e.closed=0]="closed",e[e.share_page=1]="share_page",e[e.share_workspace=2]="share_workspace",e[e.request_workspace=3]="request_workspace",e}({});class o extends(()=>n(129044))().default{getInitialState(){return{inviteStage:s.closed,selection:i.workspace_member,order:[i.workspace_member,i.page_guest],invitedUsers:[],invitedEmailToUserIdMap:{},flowId:n(214144).JW()}}startWorkspaceInvite(){this.setState({...this.state,inviteStage:s.share_workspace,order:[i.workspace_member,i.page_guest],selection:i.workspace_member})}startRequestMembership(){this.setState({...this.state,inviteStage:s.request_workspace,order:[i.request_workspace_member,i.page_guest],selection:i.request_workspace_member})}hasGuests(){return this.state.invitedUsers.some((e=>e.isGuest))}getGuestEmails(){return this.state.invitedUsers.filter((e=>e.isGuest)).map((e=>e.email))}}const a=o},214080:(e,t,n)=>{n.d(t,{n:()=>s});n(242343);var i=n(163643);const s=(0,n(680369).wt)("mailRound",{viewBox:"0 0 17 12",svg:(0,i.jsx)("path",{d:"M3.09961 11.9639H14.1055C15.3359 11.9639 16.0469 11.2529 16.0469 9.84473V2.29785C16.0469 0.896484 15.3291 0.185547 13.9004 0.185547H2.89453C1.66406 0.185547 0.953125 0.889648 0.953125 2.29785V9.84473C0.953125 11.2598 1.6709 11.9639 3.09961 11.9639ZM7.68652 6.41992L2.52539 1.32715C2.67578 1.26562 2.85352 1.23145 3.05859 1.23145H13.9414C14.1533 1.23145 14.3379 1.26562 14.4883 1.33398L9.34082 6.41992C9.04688 6.71387 8.78027 6.84375 8.51367 6.84375C8.24023 6.84375 7.97363 6.70703 7.68652 6.41992ZM1.99902 9.84473V2.29785C1.99902 2.24316 1.99902 2.27051 1.99902 2.22266L5.92969 6.08496L2.00586 9.96094C1.99902 9.92676 1.99902 9.88574 1.99902 9.84473ZM15.001 2.30469V9.85156C15.001 9.87891 15.001 9.91309 15.001 9.94043L11.0977 6.08496L15.001 2.24316C15.001 2.30469 15.001 2.30469 15.001 2.30469ZM3.05859 10.918C2.86719 10.918 2.70312 10.8906 2.55957 10.8291L6.64746 6.78906L7.0918 7.22656C7.57031 7.69824 8.02832 7.89648 8.51367 7.89648C8.99219 7.89648 9.45703 7.69824 9.93555 7.22656L10.3799 6.78906L14.4609 10.8223C14.3105 10.8906 14.1396 10.918 13.9414 10.918H3.05859Z"})})},235843:(e,t,n)=>{n.d(t,{Ah:()=>L,D6:()=>P,KW:()=>j,Oo:()=>M,Pp:()=>E,St:()=>B,hQ:()=>U,iS:()=>_,kW:()=>R,l5:()=>A,lf:()=>q});n(610931),n(362833),n(333225),n(494367),n(516262),n(573119),n(240480),n(950443),n(619601),n(725707),n(491955),n(771702),n(403517);var i=()=>n(599932),s=()=>n(446588),o=()=>n(145017),a=()=>n(528762),r=()=>n(975392),l=()=>n(23371),c=()=>n(76394),d=()=>n(919536),u=()=>n(64256),p=()=>n(352723),m=()=>n(861095),g=()=>n(360482),v=()=>n(904697),f=()=>n(509484),h=()=>n(485966),y=()=>n(436622),S=()=>n(138385),b=()=>n(836331),x=()=>n(714604),k=()=>n(413871),I=()=>n(943066),C=()=>n(127776),w=()=>n(528643),T=()=>n(818369);async function A(e){const{environment:t,store:n,sudoModeStore:r,permissionsInviteStore:l,onInviteStart:u,contextualInviteStore:v,inviteOrigin:f}=e,{tokenQuery:h}=l.state;if((0,i().DT)(h.trim())&&(l.state.isInviteTargetsEmpty||!(0,x().qs)(l.state))){const e={type:"newUser",value:{email:h.trim()},source:"email"};m().mQ({target:e,permissionsInviteStore:l})||l.setState({...l.state,inviteTargets:[...l.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""})}if(!l.state.isInviteTargetsEmpty&&l.state.inviteTargets.length>0){null==u||u();const e=l.state;if((0,x().qs)(e)){if(e.table===o().ev){if(!(0,g()._p)(n))throw new Error("Table mismatch.");const{inviteTargets:i,flowId:s,emailMessage:o}=e;l.reset();const a=await d().eP({environment:t,store:n,sudoModeStore:r,inviteTargets:i,inviteRole:void 0,isOnboarding:!1,invite:{inviteFlowId:s,inviteMessage:o,inviteOrigin:f}});return{success:a.success,requestedUserCount:a.success?Object.keys(a.requestedUsers).length:0}}if(e.table===a().NX){if(!(0,g().Yu)(n))throw new Error("Table mismatch.");const{inviteTargets:i,inviteRole:s,flowId:o}=e;l.reset();return{success:(await d().eP({environment:t,store:n,sudoModeStore:r,inviteTargets:i,inviteRole:s,isOnboarding:!1,invite:{inviteFlowId:o,inviteOrigin:f}})).success,requestedUserCount:0}}(0,c().HB)(e)}else{const{inviteRole:i,flowId:o,emailMessage:a}=e;l.reset();const c=await(0,p().hb)(n,e.inviteTargets);if((0,s().PW)(i)){const e=await d().eP({environment:t,store:n,sudoModeStore:r,inviteTargets:c,inviteRole:i,isOnboarding:!1,invite:{inviteFlowId:o,inviteMessage:a,inviteOrigin:f}});return e.success&&(null==v||v.setState({...null==v?void 0:v.state,invitedEmailToUserIdMap:e.invitedUsers})),{success:e.success,requestedUserCount:e.success?Object.keys(e.requestedUsers).length:0}}if((0,g().$R)(n)&&(0,x().nV)(e)){return{success:await d().sQ({environment:t,store:n,inviteTargets:e.inviteTargets,inviteRole:i,createNewTeamFlowId:o}),requestedUserCount:0}}}}return{success:!0,requestedUserCount:0}}function M(e){e.permissionsInviteStore.setState({...e.permissionsInviteStore.state,modalOpen:!1,flowId:void 0})}function j(e){const{permissionsInviteStore:t,contextualInviteStore:n}=e;if(!n)return;const i=[];t.state.inviteTargets.forEach((e=>{if("newUser"===e.type)i.push({email:e.value.email,isGuest:!0});else if("existingUser"===e.type){const t={...e.value,email:e.value.email,isGuest:"none"===e.spaceRole||"not_in_space"===e.spaceRole};i.push(t)}})),n.setState({...n.state,invitedUsers:i})}async function R(e){const{environment:t,store:n,sudoModeStore:i,permissionsInviteStore:s,contextualInviteStore:o,onInviteClick:r,onInviteComplete:l,inviteOrigin:c,intl:d}=e,p=n.getSpaceId(),m=new(k().SL)(t,{table:a().NX,id:p}),g=p?await y().A.awaitData(t,{spaceId:p}):void 0;if((null==o?void 0:o.state.selection)===S().NJ.workspace_member&&m&&(0,v().isEligibleToCreateTeamspace)(t,g)){if(!(await C().oH({environment:t,flowId:s.state.flowId||"",trackCreateTeamComplete:!1})))return;j({permissionsInviteStore:s,contextualInviteStore:o}),await(0,u().Lg)({environment:t,spaceStore:m,contextualInviteStore:o,from:c,intl:d})}else j({permissionsInviteStore:s,contextualInviteStore:o});let f={success:!1,requestedUserCount:0};try{f=await A({environment:t,store:n,sudoModeStore:i,permissionsInviteStore:s,contextualInviteStore:o,onInviteStart:()=>{null==r||r()},inviteOrigin:c})}catch(h){}finally{null==l||l(f.success,f.requestedUserCount)}}async function _(e){const{environment:t,permissionsInviteStore:n,from:i}=e;await m().iQ({environment:t,permissionsInviteStoreState:n.state,from:i})||n.reset()}function B(e){const{permissionsInviteStore:t,targetToRemove:n,defaultRoleForNonBot:i}=e;if(!t.state.isInviteTargetsEmpty)if((0,x().qs)(t.state))if((0,x().qs)(t.state)){const e=t.state.inviteTargets.filter((e=>e!==n));0===e.length?t.setState({...t.state,inviteTargets:[],inviteRole:i,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:e})}else(0,c().HB)(t.state);else{const e=t.state.inviteTargets.filter((e=>e!==n));0===e.length?t.setState({...t.state,inviteTargets:[],inviteRole:i,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:e})}}function P(e){const{environment:t,onUpgradeButtonClick:n,upgradeButtonName:i}=e;I().K(t,{from:i,upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}}),null==n||n()}async function L(e,t){const n=new Set(t),i=Array.from(n).map((async t=>{const n=await T().callApi({eventName:"findUser",environment:e,data:{email:t}});if("success"===n.type){const e=n.data;if(e.value){return{type:"existingUser",value:e.value.value}}}return{type:"newUser",value:{email:t},source:"email"}}));return await Promise.all(i)}async function E(e){const t="invitee",{environment:n,permissionsInviteStore:s,event:o}=e;if(!s.state.isInviteTargetsEmpty&&(0,x().qs)(s.state)){const e=o.target.value;s.setState({...s.state,inputFocus:t,tokenQuery:e})}else{const e=o.target.value,{extractedEmails:a,newInputValue:r}=(0,i().Ct)(e),l=(await L(n,a)).filter((e=>!m().mQ({target:e,permissionsInviteStore:s}))),c=[...s.state.inviteTargets,...l];c.length>0?s.setState({...s.state,inviteTargets:c,isInviteTargetsEmpty:!1,inputFocus:t,tokenQuery:r}):s.setState({...s.state,inviteTargets:[],isInviteTargetsEmpty:!0,inputFocus:t,tokenQuery:r})}}function q(e){const{environment:t,newRole:n,permissionsInviteStore:i}=e,{state:s}=i;w().Jy(t,{...m().oX(t,s),invite_updated_role:n}),!s.isInviteTargetsEmpty&&(0,x().qs)(s)||i.setState({...s,inviteRole:n})}async function U(e){var t;const{query:n,environment:i,sectionLimit:s,intl:o,membersOnly:a,importContactType:c,shouldUseEdgeCacheRollout:d}=e,{currentSpaceStore:u}=h().default.state;if(!u)return{inviteUsers:[],inviteBots:[],inviteGroups:[]};const p=b().default.getConfigKey("search_contacts_timeout","timeoutMs"),{userLimit:m,botLimit:g,groupLimit:v,importContactLimit:y}=s,S=await f().T.searchActions.load(),[x,k,I,{user:C,email:w},A]=await Promise.all([m>0?S.searchSpaceUsers({environment:i,query:n,membersOnly:a,limit:m,shouldUseEdgeCacheRollout:d}):[],g>0?S.searchSpaceBots({environment:i,query:n}):[],v>0?S.searchSpaceGroups({query:n,intl:o}):[],S.searchEmailUser(i,n),y>0?(0,l().nQ)(p,T().callApi({eventName:"searchContacts",environment:i,data:{spaceId:u.id,limit:y,query:n,importContactType:c,includeNonNotionUsers:!a,includeUserId:!0}})):void 0]),M=x.slice(0,m).map((e=>({type:"existingUser",value:e}))),j=k.slice(0,g).map((e=>({type:"bot",value:e}))),R=I.slice(0,v).map((e=>({type:"group",value:e})));C&&M.unshift({type:"existingUser",value:C}),w&&M.unshift({type:"newUser",value:{email:w},source:"email"});let _=[];return"success"===(null==A||null===(t=A.result)||void 0===t?void 0:t.type)&&(_=A.result.data.contacts.map((e=>({type:"newUser",value:{email:e.email,name:e.name,avatar_url:e.profile_photo,user_id:e.user_id},source:e.type})))),{inviteUsers:r().hS(M,(e=>e.value.email)),inviteBots:j,inviteGroups:R,importedContacts:_}}},244180:(e,t,n)=>{n.d(t,{b:()=>s});n(242343);var i=n(163643);const s=(0,n(680369).wt)("taskList",{viewBox:"0 0 18 17",svg:(0,i.jsx)("path",{d:"M3.48438 7.29688C5.35938 7.29688 6.92188 5.73438 6.92188 3.85938C6.92188 1.96875 5.35938 0.40625 3.48438 0.40625C1.59375 0.40625 0.0390625 1.96875 0.0390625 3.85938C0.0390625 5.73438 1.60156 7.29688 3.48438 7.29688ZM3.07031 5.70312C2.89844 5.70312 2.77344 5.61719 2.65625 5.47656L1.78125 4.42969C1.69531 4.32812 1.66406 4.23438 1.66406 4.10156C1.66406 3.85938 1.85156 3.67188 2.08594 3.67188C2.24219 3.67188 2.35156 3.73438 2.45312 3.875L3.05469 4.625L4.44531 2.39062C4.54688 2.23438 4.67969 2.15625 4.83594 2.15625C5.07031 2.15625 5.26562 2.33594 5.26562 2.55469C5.26562 2.66406 5.24219 2.76562 5.16406 2.88281L3.5 5.46875C3.39844 5.61719 3.25 5.70312 3.07031 5.70312ZM9.39844 4.54688H17.2578C17.6406 4.54688 17.9531 4.24219 17.9531 3.85938C17.9531 3.47656 17.6406 3.17188 17.2578 3.17188H9.39844C9.01562 3.17188 8.71875 3.47656 8.71875 3.85938C8.71875 4.24219 9.01562 4.54688 9.39844 4.54688ZM3.48438 16.3281C5.35938 16.3281 6.92188 14.7656 6.92188 12.8828C6.92188 10.9922 5.35938 9.4375 3.48438 9.4375C1.59375 9.4375 0.0390625 11 0.0390625 12.8828C0.0390625 14.7656 1.60156 16.3281 3.48438 16.3281ZM3.48438 15C2.32812 15 1.36719 14.0312 1.36719 12.8828C1.36719 11.7344 2.33594 10.7578 3.48438 10.7578C4.625 10.7578 5.60156 11.7344 5.60156 12.8828C5.60156 14.0312 4.625 15 3.48438 15ZM9.39844 13.5859H17.2578C17.6406 13.5859 17.9531 13.2812 17.9531 12.8984C17.9531 12.5156 17.6406 12.2109 17.2578 12.2109H9.39844C9.01562 12.2109 8.71875 12.5156 8.71875 12.8984C8.71875 13.2812 9.01562 13.5859 9.39844 13.5859Z"})})},299097:(e,t,n)=>{n.d(t,{A:()=>s});class i extends(()=>n(129044))().default{getInitialState(){return{permissionsInviteStore:new(n(339838).A),contextualInviteStore:new(n(138385).Ay)}}get stage(){return this.state.contextualInviteStore.state.inviteStage}}const s=i},328547:(e,t,n)=>{n.d(t,{A:()=>u});n(403517);var i=n(242343),s=()=>n(803290),o=()=>n(653998),a=()=>n(861095),r=()=>n(360482),l=()=>n(783e3),c=()=>n(797715),d=n(163643);const u=function(e){const{origin:t,permissionsInviteStore:u,store:p,handleClickRemoveToken:m,handleInputChange:g,handleInputSubmit:v,defaultRoleForNonBot:f,right:h,focus:y,handleFocus:S}=e,b=(0,s().K8)((()=>0!==(0,n(352723).Qo)()),[]),x="share_menu"===t||"add_members"===t,k="add_members"===t,[I,C]=(0,s().$y)(u),w=(0,n(237385).v3)(),{device:T}=w,A=(0,o().tz)(),{tokenQuery:M}=I,j=(0,n(731390).N)(p),R=I.inviteTargets.map((e=>{const t="newUser"===e.type?e.value.email:`${e.type}-${e.value.id}`,s=(0,a().yi)(e),r="newUser"===e.type||"existingUser"===e.type?e.value.email:void 0,c=s?j:void 0,u={key:t,target:e,onClickRemove:m,role:I.inviteRole,shouldWrap:x,showInfoIcon:Boolean(c)};return x&&r?(0,d.jsx)(n(103151).A,{placement:n(907721).W.Top,disableTooltip:k,renderTooltip:()=>s?c||(0,d.jsx)(o().sA,{defaultMessage:"{email} will be invited as a guest",id:"ContextualInvite.permissions_invites.guest.tooltip",values:{email:r}}):r,render:n=>(0,i.createElement)("span",{...n,key:t},(0,d.jsx)(l().A,{...u,backgroundColor:(0,a().qv)(e)}))},t):(0,i.createElement)(l().A,{...u,key:t})}));return(0,d.jsx)(c().Ay,{focus:T.isMobile?void 0:y,focusInitial:T.isMobile,focusAfterAnimation:!0,onClick:()=>{T.isMobile||null==S||S()},format:c().le.Share,value:M,onChange:g,type:"email",tokens:R,disabled:!1,autoComplete:"off",placeholder:x?b?A.formatMessage({defaultMessage:"Add people, groups, or emails…",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithTeams"}):A.formatMessage({defaultMessage:"Add emails or people",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithoutBots"}):(0,r().Yu)(p)||(0,r().nw)(p)?A.formatMessage({id:"inviteUserModal.searchInput.placeholder",defaultMessage:"Search name or emails"}):A.formatMessage({id:"permissionsInvite.searchInput.placeholder",defaultMessage:"Search emails, names, or groups"}),onRemoveLastToken:()=>{const e={...I};e.inviteTargets=e.inviteTargets.slice(0,-1),0===e.inviteTargets.length&&(e.isInviteTargetsEmpty=!0,e.inviteRole=f),C(I)},right:h,inputFullWidth:!0,inputAndTokenWrapRightStyle:{paddingTop:w.device.isMobile?0:I.isInviteTargetsEmpty?7:6,paddingBottom:w.device.isMobile||x?0:4},onEmptySubmit:()=>v(),dontShowBorderBottom:T.isAndroid,showBorder:x,...!x&&{style:{padding:"10px  9px 4px 9px"}},...x&&{style:{borderRadius:4,paddingTop:I.isInviteTargetsEmpty?3:0,paddingBottom:0,...y&&{background:"none"}}}})}},339838:(e,t,n)=>{n.d(t,{A:()=>s});class i extends(()=>n(129044))().default{getInitialState(){return{modalOpen:!1,tokenQuery:"",inviteTargets:[],inviteRole:"editor",isInviteTargetsEmpty:!0,table:n(145017).ev,flowId:void 0,inputFocus:"invitee",emailMessage:""}}}const s=i},368156:(e,t,n)=>{n.d(t,{A:()=>s});class i extends(()=>n(129044))().default{getInitialState(){return{open:!1,focus:"none"}}open(){this.setState({open:!0,focus:"none"})}close(){this.setState({open:!1,focus:"none"})}}const s=new i},408118:(e,t,n)=>{n.d(t,{j:()=>g});var i=n(242343),s=()=>n(237385),o=()=>n(803290),a=()=>n(653998),r=()=>n(76394),l=()=>n(469880),c=()=>n(228437),d=()=>n(802955),u=()=>n(335737),p=()=>n(356813),m=n(163643);function g(e){const{traceId:t,feedbackState:n,setFeedbackState:l,feedbackType:g}=e,{thumbsUpType:f,thumbsDownType:h}=(0,i.useMemo)((()=>{switch(g){case"ai_block":return{thumbsDownType:"ai_block_thumbs_down",thumbsUpType:"ai_block_thumbs_down"};case"autofill":return{thumbsDownType:"ai_autofill_thumbs_down",thumbsUpType:"ai_autofill_thumbs_up"};default:(0,r().HB)(g)}}),[g]),y=(0,a().tz)(),S=(0,s().v3)(),b=!(0,o().O$)(d().e),x=(0,i.useCallback)((()=>{u().A.setState({...u().A.state,open:!0,type:h,traceId:t,thumbsUpOrDown:"down"}),l({type:"thumbsdown",userContent:"",shareWithNotion:!0}),v({environment:S,inferenceId:t,feedbackType:"thumbsdown",userContent:"",shareWithNotion:!0})}),[S,l,h,t]),k=(0,i.useCallback)((()=>{u().A.setState({...u().A.state,open:!0,type:f,traceId:t,thumbsUpOrDown:"up"}),l({type:"thumbsup",userContent:"",shareWithNotion:!0}),v({environment:S,inferenceId:t,feedbackType:"thumbsup",userContent:"",shareWithNotion:!0})}),[S,l,f,t]);return(0,m.jsxs)("div",{onClick:e=>{e.stopPropagation(),e.preventDefault()},children:[(0,m.jsx)(p().A,{onClick:k,icon:(0,c().gZ)("thumbsup","thumbsup"===(null==n?void 0:n.type)),ariaLabel:y.formatMessage({id:"AiFeatureFeedbackButtons.thumbsUp",defaultMessage:"Helpful"}),disabled:b}),(0,m.jsx)(p().A,{icon:(0,c().gZ)("thumbsdown","thumbsdown"===(null==n?void 0:n.type)),onClick:x,ariaLabel:y.formatMessage({id:"AiFeatureFeedbackButtons.thumbsDown",defaultMessage:"Not helpful"}),disabled:b})]})}function v(e){const{environment:t,inferenceId:n,feedbackType:i,userContent:s,shareWithNotion:o}=e;l().I5(t,{type:"property_autofill",inference_id:n,feedback_type:i,timestamp:(new Date).toUTCString(),user_comment:s,share_with_notion:o})}},466051:(e,t,n)=>{n.d(t,{_:()=>g});var i=n(242343),s=()=>n(237385),o=()=>n(803290),a=()=>n(653998),r=()=>n(591130),l=()=>n(485966),c=()=>n(535906),d=()=>n(969836),u=()=>n(932322),p=()=>n(28210),m=n(163643);function g(e){const t=(0,s().Y0)(),{group:n,menuListItemProps:g,spaceStore:v,iconSizeOverride:f}=e,h=(0,a().tz)(),y=(0,o().K8)((()=>{const e=v??l().AppStoreCurrentSpaceStore.state;if(e&&n.icon)return{pointer:{table:e.table,id:e.id},icon:n.icon}}),[n,v]),S=(0,i.useMemo)((()=>(0,r().Pf)({intl:h,groupName:n.name})),[n.name,h]),b=f||(t.isMobile?u().nd:u().pg);return(0,m.jsx)(c().A,{...g,icon:y?(0,m.jsx)(p().B,{disabled:!0,size:b,icon:y,isEmptyPage:!1,title:S}):(0,m.jsx)(d().A,{size:b}),title:S})}},556338:(e,t,n)=>{n.d(t,{A:()=>r});var i=()=>n(378219),s=()=>n(360482),o=()=>n(548694);function a(e,t){return(0,o().hN)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const r=function(e){return(0,n(803290).K8)((()=>{if((0,s().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if(!(0,s()._p)(e))return(0,o().r7)(e)?a(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,i().Uo)(e),r=(0,i().pp)(e),l=r||n(485966).default.state.currentSpaceStore;if((0,o().r7)(l))return a(l,t);const c=!(null!=r&&r.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:c,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:c,isGuestRequestRequired:!1}}),[e])}},591090:(e,t,n)=>{n.d(t,{$:()=>s});n(242343);var i=n(163643);const s=(0,n(680369).wt)("membersFilled",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M20.31 14.731c2.22 0 4.097-1.967 4.097-4.513 0-2.485-1.887-4.391-4.098-4.391-2.2 0-4.097 1.937-4.087 4.411 0 2.526 1.866 4.493 4.087 4.493zm-11.725.233c1.937 0 3.57-1.724 3.57-3.935 0-2.17-1.653-3.823-3.57-3.823-1.917 0-3.57 1.683-3.56 3.844 0 2.19 1.633 3.914 3.56 3.914zm-5.588 9.21h7.606c-1.085-1.552.082-4.615 2.374-6.42-1.116-.72-2.566-1.248-4.392-1.248-4.533 0-7.464 3.337-7.464 6.085 0 1.004.507 1.582 1.876 1.582zm10.994-.01h12.637c1.673 0 2.251-.508 2.251-1.44 0-2.607-3.316-6.198-8.57-6.198-5.263 0-8.57 3.59-8.57 6.197 0 .933.578 1.44 2.252 1.44z"})})},625880:(e,t,n)=>{n.d(t,{z:()=>r});n(242343);var i=()=>n(174114),s=()=>n(653998),o=()=>n(88271),a=n(163643);function r(e){const t=(0,i().IS)((()=>({container:{paddingBlock:4}})),[]);return(0,a.jsx)(o().A,{title:e.hideTitle?void 0:(0,a.jsx)(s().sA,{id:"inviteUserModal.searchDropdown.selectPersonTitle",defaultMessage:"Select a person"}),style:t.container,...e})}},731390:(e,t,n)=>{n.d(t,{N:()=>a});n(242343);var i=()=>n(653998),s=()=>n(556338),o=n(163643);function a(e){const t=(0,s().A)(e);return t.isGuestRequestRequired?(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn't allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn't allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},783e3:(e,t,n)=>{n.d(t,{A:()=>d});n(242343);var i=()=>n(466003),s=()=>n(752903),o=()=>n(670481),a=()=>n(14931),r=()=>n(76394),l=()=>n(591130),c=n(163643);const d=function(e){let{isStrikedThrough:t,backgroundColor:d,onClickRemove:u,target:p,disabled:m,showInfoIcon:g,style:v,shouldWrap:f}=e;const h=(0,n(237385).v3)(),y=(0,n(653998).tz)(),{device:S}=h,b=(0,n(803290).K8)((()=>function(e){let t,{target:n,intl:s,showInfoIcon:d}=e;switch(n.type){case"newUser":t=n.value.email.trim();break;case"existingUser":t=(0,a().c6)(s,n.value);break;case"bot":t=(0,i().Hg)(n.value);break;case"group":t=(0,l().Pf)({intl:s,groupName:n.value.name});break;default:(0,r().HB)(n)}return d?(u=t,(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,o().G)({marginRight:4,width:14,height:14}),u]})):t;var u}({target:p,intl:y,showInfoIcon:g})),[p,y,g]);return(0,c.jsx)(n(809785).A,{showRemoveButton:!0,isSingle:!0,isStrikedThrough:t,backgroundColor:d,format:S.isMobile?s().NY.Large:s().NY.Medium,onClickRemove:e=>function(e,t,n){e.stopPropagation(),t(n)}(e,u,p),disabled:m,disabledFeedback:!0,value:b,style:v,shouldWrap:f})}},810733:(e,t,n)=>{n.d(t,{A:()=>s});class i extends(()=>n(129044))().default{getInitialState(){return{open:!1}}}const s=new i},881143:(e,t,n)=>{n.r(t),n.d(t,{AiBlockV2:()=>Gt});n(610931),n(333225),n(494367),n(516262),n(573119),n(240480),n(950443),n(619601),n(725707),n(491955),n(771702);var i=()=>n(561074),s=n(242343),o=()=>n(470637),a=()=>n(16791),r=()=>n(237385),l=()=>n(803290),c=()=>n(174114),d=()=>n(76394),u=()=>n(446588),p=()=>n(145017),m=()=>n(21164),g=()=>n(528762),v=()=>n(118174);function f(e){const{referenceContext:t,getRecordRole:n,getCanReadSlackChannel:i}=e;if(!t)return!0;for(const s of t)if("collection"===s.type){const e=n({id:s.collectionId,table:m().Vl})??"none";if(!(0,u().Tt)(e))return!1}else if("page"===s.type||"currentPage"===s.type){const e=n({id:s.pageId,table:p().ev})??"none";if(!(0,u().Tt)(e))return!1}else if("slack"===s.type){if(!i(s))return!1}else(0,d().HB)(s);return!0}class h{constructor(e){this.permissionLevel=void 0,this.permissionLevel=e}canOpenConfigurationPanel(){switch(this.permissionLevel){case"editor":case"configuration_reader":return!0;case"reader":return!1;default:(0,d().HB)(this.permissionLevel)}}canEditConfigurationPanel(){switch(this.permissionLevel){case"reader":case"configuration_reader":return!1;case"editor":return!0;default:(0,d().HB)(this.permissionLevel)}}canGenerateBlock(){switch(this.permissionLevel){case"editor":return!0;case"configuration_reader":case"reader":return!1;default:(0,d().HB)(this.permissionLevel)}}canDuplicateBlock(){switch(this.permissionLevel){case"reader":return!1;case"configuration_reader":case"editor":return!0;default:(0,d().HB)(this.permissionLevel)}}}var y=()=>n(502140),S=()=>n(325283),b=()=>n(582226),x=()=>n(994798),k=()=>n(73751),I=()=>n(653998),C=()=>n(543736),w=()=>n(975392),T=()=>n(393378),A=()=>n(31448),M=()=>n(818369),j=()=>n(145046),R=()=>n(795394),_=()=>n(900635),B=()=>n(759625),P=()=>n(84543),L=()=>n(103151),E=()=>n(137476),q=()=>n(950746),U=()=>n(477784),G=()=>n(485966),F=()=>n(363043),N=()=>n(413871),D=()=>n(880195),O=()=>n(388615),W=()=>n(273520),H=()=>n(966638),K=n(163643);function z(e){const{traceId:t,feedbackState:i,setFeedbackState:s}=e;return(0,K.jsx)(n(408118).j,{setFeedbackState:s,feedbackState:i,traceId:t,feedbackType:"ai_block"})}var V=()=>n(849311),Q=(n(500234),n(403517),()=>n(752597)),$=()=>n(660714),Y=()=>n(735737),Z=()=>n(198654),X=()=>n(55658),J=()=>n(244180),ee=()=>n(34662),te=()=>n(357247),ne=()=>n(384221),ie=()=>n(918135),se=()=>n(373040),oe=()=>n(935091),ae=()=>n(983050),re=()=>n(126996),le=()=>n(868199),ce=()=>n(640979),de=()=>n(621641),ue=()=>n(205670),pe=()=>n(421338),me=()=>n(209684),ge=()=>n(286270),ve=()=>n(535906),fe=()=>n(441292),he=()=>n(858023),ye=()=>n(646498),Se=()=>n(951540),be=()=>n(88271),xe=()=>n(289051),ke=()=>n(636045),Ie=()=>n(431551),Ce=()=>n(35462);function we(e){const{store:t,style:n}=e,i=(0,r().v3)(),o=(0,l().K8)((()=>{const e=t.getNavigableBlockStore();return(null==e?void 0:e.isTemplate())??!1}),[t]),a=(0,l().K8)((()=>t.autoGenerateOnTemplateDuplication()),[t]),c=(0,s.useCallback)((()=>{P().createAndCommit({userAction:"AiBlock.updateBlockConfiguration",environment:i,canUndo:!0,perform:e=>{B().zv({store:t.getFormatStore().getKeyStore("ai_block_configuration_menu"),data:{autoGenerateOnTemplateDuplication:!a},transaction:e})}})}),[t,i,a]);return o?(0,K.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",...n},children:[(0,K.jsx)(Ce().A,{children:(0,K.jsx)(I().sA,{id:"AiBlockV2.AutoGenerateOnTemplateDuplicationFieldToggle.Label",defaultMessage:"Autofill when template is duplicated"})}),(0,K.jsx)(Ie().A,{on:a,onClick:c})]}):null}n(362833);var Te=()=>n(83544),Ae=()=>n(887508),Me=()=>n(32194),je=()=>n(188877),Re=()=>n(741329),_e=()=>n(646591),Be=()=>n(289988),Pe=()=>n(907721),Le=()=>n(210466),Ee=()=>n(695951),qe=()=>n(356813),Ue=()=>n(975515),Ge=()=>n(443252),Fe=()=>n(701513),Ne=(n(358848),n(91270),()=>n(555919)),De=()=>n(752903),Oe=()=>n(427091),We=()=>n(28210),He=()=>n(709237),Ke=()=>n(809785),ze=()=>n(547797),Ve=()=>n(59175),Qe=()=>n(206799);const $e=(0,I().YK)({addContextPlaceholder:{id:"ContextTokenPlaceholderTypeahead.addContextPlaceholder",defaultMessage:"Add context"}});function Ye(e){const{disabled:t,currentlyFocusedItem:n,items:i,query:o,setQuery:a,isMenuOpen:r,hasContextsAlready:l,inputRef:d}=e,u=(0,I().tz)(),p=(0,s.useMemo)((()=>{var e;if(!o)return;if(n)return n.title.toLowerCase().startsWith(o.toLowerCase())?`${o}${n.title.slice(o.length)}`:o;const t=null===(e=i.find((e=>e.title.toLowerCase().startsWith(o.toLowerCase()))))||void 0===e?void 0:e.title;return t?`${o}${t.slice(o.length)}`:o}),[i,o,n]),m=(0,s.useMemo)((()=>!r&&l),[r,l]),g=(0,s.useMemo)((()=>o?p??"":u.formatMessage($e.addContextPlaceholder)),[o,u,p]),v=(0,s.useRef)(null),[f,h]=(0,s.useState)(null);(0,s.useEffect)((()=>{v.current&&h(v.current.offsetWidth)}),[v,g,m]),(0,s.useEffect)((()=>{r||a("")}),[r,a]);const y=(0,c().IS)((e=>({container:{display:"flex",alignItems:"center",background:m?"transparent":e.inputBackground,borderRadius:6,paddingLeft:0,paddingRight:0,height:24,...A().RC},backgroundInput:{height:void 0,position:"absolute",top:0,left:0,display:"flex",alignItems:"center",borderRadius:6,paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,fontSize:14,lineHeight:"20px",width:"fit-content",...A().RC,color:e.text.quaternary},foregroundInput:{boxShadow:"none",background:"transparent",width:null===f?void 0:f,color:e.text.secondary},plusIcon:{fill:e.text.quaternary,width:14,height:14,marginLeft:6,...m&&{marginRight:6}}})),[f,m]);return(0,K.jsx)(L().A,{disableTooltip:!m,textWrap:!0,style:{minWidth:200,padding:"4px 8px"},renderTooltip:()=>(0,K.jsx)(I().sA,{id:"ContextTokenPlaceholderTypeahead.tooltip",defaultMessage:"Add context to help Notion AI generate relevant content"}),render:n=>(0,K.jsxs)(me().p,{...n,style:y.container,onClick:e.onFocus,disabled:t,children:[(0,K.jsx)(Qe().Q,{iconGroup:ze().h,variantName:"default",colorName:"grayPrimary",style:y.plusIcon}),!m&&(0,K.jsxs)("div",{style:{position:"relative"},children:[(0,K.jsx)("div",{ref:v,style:y.backgroundInput,children:g}),(0,K.jsx)(fe().A,{capture:!0,debugName:"ContextTokenPlaceholderTypeahead",allowMenuList:!0,children:(0,K.jsx)(Ve().A,{ref:d,disabled:t,style:y.foregroundInput,focus:r,value:o,onChange:e=>{a(e.target.value)},suppressFocusRing:!0,onFocus:()=>{e.onFocus()}})})]})]})})}const Ze=(0,I().YK)({slackIconAriaLabel:{id:"AiBlockV2ContextTokenInput.slackIconAriaLabel",defaultMessage:"Slack"}});function Xe(e){const{disabled:t,currentContexts:n,contextInputRef:i,inputRef:o,query:a,setQuery:r,searchResultMenuIsOpen:u,setSearchResultMenuIsOpen:p,handleUpdateContexts:m,searchResultMenuState:g,menuListStore:v}=e,f=(0,Oe().P)(),h=(0,I().tz)(),y=(0,l().K8)((()=>"notion"===g.type?g.results.map((e=>({key:e.blockStore.id,item:e,title:e.blockStore.getRenderTitle({userTimeZone:f,intl:h})??(0,Ne().L)(h)}))):"slack"===g.type?g.results.map((e=>({key:e.channel.id,title:e.channel.name,item:e}))):"choose"===g.type?[]:void(0,d().HB)(g)),[g,f,h]),S=(0,l().K8)((()=>{const e=v.state.focus.indexGlobal;return void 0!==e?y.at(e):void 0}),[v,y]),b=(0,s.useCallback)((e=>{m(n.filter((t=>!(0,w().n4)(t,e))))}),[n,m]),x=(0,c().IS)((e=>({container:{position:"relative",borderRadius:6,boxShadow:e.inputBoxShadow,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:"transparent",display:"flex",alignItems:"center",padding:4,gap:4,flexWrap:"wrap",cursor:"pointer"},firstLinePlaceholder:{position:"absolute",top:0,left:0,height:32,width:"100%"}})),[]);return(0,K.jsxs)("div",{style:x.container,onClick:()=>p(!0),children:[(0,K.jsx)("div",{ref:i,style:x.firstLinePlaceholder}),(0,K.jsx)(Ye,{disabled:t,inputRef:o,query:a,setQuery:r,items:y,currentlyFocusedItem:S,onSuggestionSelected:e=>{u&&(m([e.item,...n]),r(""),p(!1))},hasContextsAlready:n.length>0,onFocus:()=>{p(!0)},isMenuOpen:u}),n.map((e=>(0,K.jsx)(Je,{contextItem:e,disabled:t,onRemove:t=>{b(e),t.preventDefault(),t.stopPropagation()}},function(e){if("currentPage"===e.type)return`currentPage-${e.blockStore.id}`;if("block"===e.type)return`block-${e.blockStore.id}`;if("slack"===e.type)return`slack-${e.channel.id}`}(e))))]})}function Je(e){const{contextItem:t,disabled:n,onRemove:i}=e,s=(0,I().tz)(),o=(0,Oe().P)(),a=(0,l().K8)((()=>"currentPage"===t.type||"block"===t.type?t.blockStore.getRenderTitle({userTimeZone:o,intl:s})??(0,Ne().L)(s):"slack"===t.type?t.channel.name:void(0,d().HB)(t)),[t,s,o]),r=(0,c().IS)((e=>({tokenWrapper:{backgroundColor:e.lightGrayBannerBackground,cursor:"pointer",paddingLeft:4,paddingRight:4,paddingTop:12,paddingBottom:12,borderRadius:4,maxWidth:150,height:24,color:e.text.secondary}})),[]);return(0,K.jsx)(Ke().A,{disabled:n,style:r.tokenWrapper,format:De().NY.Small,isSingle:!0,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1,showRemoveButton:!0,onClickRemove:i,value:(0,K.jsx)(it,{contextItem:t}),showTooltip:"overflow",tooltip:a,tooltipPlacement:Pe().W.Bottom,tooltipOriginGap:0})}const et=16,tt=12;function nt(){return(0,c().IS)((e=>({recordTitleStyle:{display:"flex",alignItems:"center",gap:4}})),[])}function it(e){const{contextItem:t}=e;return"currentPage"===t.type?(0,K.jsx)(st,{blockStore:t.blockStore}):"block"===t.type?(0,K.jsx)(ot,{blockStore:t.blockStore}):"slack"===t.type?(0,K.jsx)(at,{channel:t.channel}):(0,d().HB)(t)}function st(e){const{blockStore:t}=e,n=nt(),i=(0,l().K8)((()=>t.getIcon()),[t]);return(0,K.jsxs)("div",{style:n.recordTitleStyle,children:[(0,K.jsx)(We().B,{disabled:!0,icon:i,isEmptyPage:!1,size:et}),(0,K.jsx)("div",{style:A().RC,children:(0,K.jsx)(I().sA,{defaultMessage:"Current page",id:"ContextTokenInput.currentPage"})})]})}function ot(e){const{blockStore:t}=e,n=nt(),i=(0,l().K8)((()=>t.getIcon()),[t]);return(0,K.jsxs)("div",{style:n.recordTitleStyle,children:[(0,K.jsx)(We().B,{disabled:!0,icon:i,isEmptyPage:!1,size:et}),(0,K.jsx)(He().A,{store:t})]})}function at(e){const{channel:t}=e,n=nt(),i=(0,I().tz)();return(0,K.jsxs)("div",{style:n.recordTitleStyle,children:[(0,K.jsx)("img",{width:tt,src:Te().A.images.externalIntegrations.slackIconPng,alt:i.formatMessage(Ze.slackIconAriaLabel)}),(0,K.jsx)("div",{children:t.name})]})}const rt=(0,I().YK)({notionIconAriaLabel:{id:"notionIconAriaLabel",defaultMessage:"Notion"},slackIconAriaLabel:{id:"slackIconAriaLabel",defaultMessage:"Slack"},notionContextLabel:{id:"notionContextLabel",defaultMessage:"Notion"},slackContextLabel:{id:"slackContextLabel",defaultMessage:"Slack"}}),lt="notion";function ct(e){var t;const{currentContexts:n,handleUpdateContexts:i,disabled:o}=e,[a,c]=(0,s.useState)(!1),u=(0,l().uB)(void 0,Le().A),p=(0,l().K8)((()=>["notion",...(0,Re().wd)().filter(pt)]),[]),[m,g]=(0,s.useState)(""),{searchResultMenuState:v,setCurrentSearchContext:f}=function(e){const{availableSearchContexts:t,currentContexts:n,query:i}=e,o=t.length>1,[a,c]=(0,s.useState)(o?void 0:lt),u=(0,r().v3)(),p=(0,l().O$)(G().AppStoreCurrentSpaceStore),m=null==p?void 0:p.id,g=(0,l().K8)((()=>_e().NK.state.map((e=>e.store))),[]),{results:v,isResultsLoading:f}=(0,Be().W)({source:"ai_block_v2_page_context_search",query:i,limit:20,type:Me().Vz.BlocksInSpace,excludedBlockIds:n.filter((e=>"slack"!==e.type)).map((e=>e.blockStore.id)),filters:{requireEditPermissions:!1,excludeTemplates:!1},options:{disable:!i||"notion"!==a}}),h=(0,s.useMemo)((()=>v.map((e=>e.store))),[v]),y=(0,s.useMemo)((()=>i?f?"searching":"loaded":"default"),[i,f]),S=(0,l().O$)(G().AppStoreMainEditorCurrentBlockStore),b=(0,l().K8)((()=>{if(i)return h??[];return[...S?[S]:[],...g]}),[i,h,g,S]);(0,s.useEffect)((()=>{m&&(0,xe().Hn)({environment:u,spaceId:m,externalAuthConfig:{type:"universal",app:"slack",spaceId:m}})}),[u,m]);const{channels:x,isFetchingSlack:k}=(0,l().K8)((()=>{if(!m)return{channels:F().m.channels,isFetchingSlack:F().m.fetching};const e=F().c.getStateForBot({type:"universal",app:"slack",spaceId:m});return{channels:e.channels,isFetchingSlack:e.fetching}}),[m]),I=(0,s.useMemo)((()=>Object.values(x).map((e=>({type:"slack",channel:e})))),[x]),[C,w]=(0,s.useState)([]);(0,s.useEffect)((()=>{0===C.length&&I.length>0&&w(I)}),[I,C.length]);const T=function(e,t){const[n,i]=(0,s.useState)(e);return(0,s.useEffect)((()=>{const n=setTimeout((()=>i(e)),t);return()=>clearTimeout(n)}),[e,t]),n}(i,300),[A,M]=(0,s.useState)([]);(0,s.useEffect)((()=>{let e=!1;async function t(){if("slack"===a&&T){const t=await async function(e,t,n,i){const s=100,o=[];for(let a=0;a<t.length;a+=s){const r=t.slice(a,a+s);await new Promise((e=>setTimeout(e,0)));const l=(0,je().Ay)(e,r,n,i);o.push(...l)}return(0,je().Ay)(e,o,n,i)}(T,I,(e=>e.channel.name));e||M(t)}else M(C)}return t(),()=>{e=!0}}),[a,T,I,C]);const j=(0,s.useDeferredValue)(T),R=(0,s.useMemo)((()=>"slack"===a&&j?A:C),[a,j,C,A]),_=(0,s.useMemo)((()=>{if(!a)return{type:"choose"};const e=b.map((e=>({type:e.id===(null==S?void 0:S.id)?"currentPage":"block",blockStore:e})));if("slack"===a){let e="default";return i&&(e=k?"searching":"loaded"),{type:a,status:e,results:R}}if("notion"===a)return{type:a,status:y,results:e};(0,d().HB)(a)}),[a,i,b,R,y,k,S]);return{setCurrentSearchContext:c,searchResultMenuState:dt({currentContexts:n,state:_})}}({availableSearchContexts:p,currentContexts:n,query:m}),h=(0,s.useRef)(null),y=(0,s.useRef)(null);return(0,K.jsx)(Ge().Ay,{popupType:Ge().nl.Popup,open:a,onDismiss:()=>{c(!1)},placementToOrigin:Pe().W.Bottom,alignmentToOrigin:Pe().C.Start,originRect:null==y||null===(t=y.current)||void 0===t?void 0:t.getBoundingClientRect(),trapFocus:!1,sameWidthAsOrigin:!0,origin:(0,K.jsx)(Xe,{disabled:o,currentContexts:n,inputRef:h,handleUpdateContexts:i,searchResultMenuIsOpen:a,setSearchResultMenuIsOpen:c,menuListStore:u,query:m,setQuery:g,searchResultMenuState:v,contextInputRef:y}),render:()=>(0,K.jsx)(ut,{query:m,setQuery:g,availableSearchContexts:p,onSelectResult:e=>{i([e,...n]),c(!1),g("")},currentContexts:n,setCurrentSearchContext:e=>{var t;f(e),null===(t=h.current)||void 0===t||t.focus()},state:v,menuListStore:u})})}function dt(e){const{currentContexts:t,state:n}=e,i=new Set,s=new Set;for(const o of t)"block"===o.type?i.add(o.blockStore.id):"slack"===o.type?s.add(o.channel.id):"currentPage"===o.type?i.add(o.blockStore.id):(0,d().HB)(o);if("choose"===n.type)return n;if("notion"===n.type){const e=(0,w().hS)(n.results.filter((e=>!i.has(e.blockStore.id))),(e=>e.blockStore.id));return{...n,results:e}}if("slack"===n.type){const e=n.results.filter((e=>!s.has(e.channel.id))).sort(((e,t)=>e.channel.name.localeCompare(t.channel.name)));return{...n,results:e}}(0,d().HB)(n)}function ut(e){const{onSelectResult:t,availableSearchContexts:n,state:i,setCurrentSearchContext:o,menuListStore:a,query:r,setQuery:l}=e,u=(0,I().tz)(),p=(0,c().IS)((e=>({backText:{color:e.text.tertiary,fontSize:12},backContentWrap:{display:"flex",alignItems:"center",cursor:"pointer",marginTop:4,marginLeft:8}})),[]),m=(0,s.useMemo)((()=>(0,je().Ay)(r,n,(e=>"notion"===e?u.formatMessage(rt.notionContextLabel):"slack"===e?u.formatMessage(rt.slackContextLabel):void(0,d().HB)(e)))),[n,r,u]),g=(0,s.useMemo)((()=>{const e={key:"no-results",render:()=>(0,K.jsx)(Ue().A,{title:(0,K.jsx)(I().sA,{defaultMessage:"No results found.",id:"contextTokenInput.searchResultMenu.noResults.message"})}),action:()=>{}};if("choose"===i.type)return 0===m.length?[e]:m.map((e=>({key:e,render:t=>(0,K.jsx)(mt,{...t,searchContext:e}),action:()=>{o(e),l("")}})));const n=[];return"default"===i.status||"loaded"===i.status||"searching"===i.status?0===i.results.length?"searching"===i.status?(n.push({key:"loading",render:()=>(0,K.jsx)(Ue().A,{title:(0,K.jsx)(I().sA,{defaultMessage:"Loading…",id:"contextTokenInput.searchResultMenu.loading.message"})}),action:()=>{}}),n):(n.push(e),n):n.concat(i.results.map((e=>"block"===e.type?{key:e.blockStore.id,render:t=>(0,K.jsx)(Fe().A,{...t,store:e.blockStore}),action:()=>{t(e)}}:"slack"===e.type?{key:e.channel.id,render:t=>(0,K.jsx)(xe().qj,{...t,channel:e.channel}),action:()=>{t(e)}}:"currentPage"===e.type?{key:`${e.blockStore.id}-currentPage`,render:t=>(0,K.jsx)(Fe().A,{...t,store:e.blockStore,right:(0,K.jsx)(Ee().A,{content:(0,K.jsx)(I().sA,{id:"ContextTokenInput.currentPage",defaultMessage:"Current page"})})}),action:()=>{t(e)}}:void(0,d().HB)(e)))):(0,d().HB)(i.status)}),[i,m,o,t,l]);return(0,K.jsx)(oe().A,{menuType:ce().gu.Popup,maxHeight:200,header:"choose"!==i.type&&n.length>1&&(0,K.jsx)("div",{style:p.backContentWrap,children:(0,K.jsx)(qe().A,{ariaLabel:u.formatMessage({id:"ContextTokenInput.backButton",defaultMessage:"Back"}),icon:Ae().v,onClick:()=>{o(void 0)},caption:(0,K.jsx)("div",{style:p.backText,children:(0,K.jsx)(I().sA,{id:"ContextTokenInput.backButton",defaultMessage:"Back"})}),captionStyle:{textTransform:void 0,letterSpacing:void 0}})}),children:(0,K.jsx)(he().Ay,{type:he().Oh.Vertical,initialFocus:0,store:a,sections:[{key:"search-results",render:e=>(0,K.jsx)(be().A,{...e}),items:g}]})})}const pt=(0,d().u0)((e=>"slack"===e?{true:e}:{false:e})),mt=s.forwardRef(((e,t)=>{const{searchContext:n,...i}=e,s=(0,I().tz)();let o,a;return"notion"===n?o=(0,K.jsx)("img",{width:20,src:Te().A.images.notionLogoPng,alt:s.formatMessage(rt.notionIconAriaLabel)}):"slack"===n?o=(0,K.jsx)("img",{width:20,src:Te().A.images.externalIntegrations.slackIconPng,alt:s.formatMessage(rt.slackIconAriaLabel)}):(0,d().HB)(n),"notion"===n?a=s.formatMessage(rt.notionContextLabel):"slack"===n?a=s.formatMessage(rt.slackContextLabel):(0,d().HB)(n),(0,K.jsx)(ve().A,{ref:t,...i,icon:o,title:a})}));mt.displayName="SearchContextMenuItem";var gt=()=>n(556078),vt=()=>n(88442),ft=()=>n(802955);const ht=(0,I().YK)({disabledAiCredits:{id:"AiBlockV2.disabled.aiCredits",defaultMessage:"AI is currently disabled"},currentlyGenerating:{defaultMessage:"Generation in progress",id:"AiBlockV2.currentlyGenerating"},cannotEditBlock:{defaultMessage:"This block cannot be edited",id:"AiBlockV2.cannotEditBlock"},insufficientPermissions:{defaultMessage:"You do not have permission to generate this block",id:"AiBlockV2.insufficientPermissions"},noInstructions:{defaultMessage:"No instructions provided",id:"AiBlockV2.noInstructions"},offline:{defaultMessage:"Unavailable while offline",id:"AiBlockV2.offline"}});function yt(e){const{store:t,isGenerating:n,permissionLevelCalculator:i}=e,s=(0,gt().S)(),o=(0,I().tz)(),{blockConfiguration:a}=St(t),r=!(0,l().O$)(ft().e);return(0,l().K8)((()=>{const e=s&&s.publicEditModeStore.state;return(0,vt().ZE)(e)?n?{isDisabled:!0,disabledMessage:o.formatMessage(ht.currentlyGenerating)}:r?{isDisabled:!0,disabledMessage:o.formatMessage(ht.offline)}:!t.canEdit()||t.isNonEditableState()?{isDisabled:!0,disabledMessage:o.formatMessage(ht.cannotEditBlock)}:i.canGenerateBlock()?"summarizeThisPage"===a.type||"extractKeyPointsFromThisPage"===a.type||a.autofillInstructions?{isDisabled:!1}:{isDisabled:!0,disabledMessage:o.formatMessage(ht.noInstructions)}:{isDisabled:!0,disabledMessage:o.formatMessage(ht.insufficientPermissions)}:{isDisabled:!0,disabledMessage:o.formatMessage(ht.disabledAiCredits)}}),[s,n,t,i,a,o,r])}function St(e){const t=(0,r().v3)();return{blockConfiguration:(0,l().K8)((()=>bt({model:e.getModel()})),[e]),updateBlockConfiguration:(0,s.useCallback)((n=>{P().createAndCommit({userAction:"AiBlock.updateBlockConfiguration",environment:t,canUndo:!0,perform:t=>{P().applyOperation({store:e,operation:b().op.update({pointer:e.pointer,path:["format"],args:{ai_block_configuration_menu:n}}),transaction:t})}})}),[t,e])}}function bt(e){var t;const{model:n}=e;if(!n)return v().Z0;const i=null===(t=G().default.state.currentSpaceStore)||void 0===t?void 0:t.getRecordModel;if(!i)return v().Z0;if(null==n||!n.getFormatValue("ai_block_configuration_menu")){const e=(0,v().Hx)({model:n,getRecordModel:i});if(e)return e}return(0,v().Lv)({model:n})}function xt(e){const{store:t,isGenerating:n,permissionLevelCalculator:i}=e,o=yt({store:t,isGenerating:n,permissionLevelCalculator:i}),a=(0,c().IS)((()=>({generatingText:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:8,fontSize:14,fontWeight:400}})),[]),r=function(e){const t=(0,I().tz)(),n=(0,l().K8)((()=>{const n=e.getFormat().ai_last_edited;return n?t.formatDate(n,{day:"numeric",month:"long",year:"numeric"}):void 0}),[t,e]);return(0,l().K8)((()=>{var i;const s=e.getLastEditedTime();if(!s)return;const o=t.formatDate(s,{day:"numeric",month:"long",year:"numeric"});if(o===n)return{lastAiEditGenerationTime:n,lastEditedByName:void 0,lastHumanEditedTime:void 0};return{lastEditedByName:(null===(i=e.getLastEditedByStore())||void 0===i?void 0:i.getDisplayName(t,!1))??void 0,lastHumanEditedTime:o,lastAiEditGenerationTime:n}}),[t,n,e])}(t),d=(0,s.useMemo)((()=>n?(0,K.jsx)(I().sA,{id:"aiBlock.generate.loading.label",defaultMessage:"Generating…"}):null!=r&&r.lastAiEditGenerationTime?(0,K.jsx)(I().sA,{id:"aiBlock.configurableTitle.regenerate",defaultMessage:"Regenerate"}):(0,K.jsx)(I().sA,{id:"aiBlock.configurableTitle.editlabel",defaultMessage:"Generate"})),[n,r]);return(0,K.jsx)(L().A,{renderTooltip:()=>(0,K.jsx)(kt,{store:t,disabledResult:o,lastGeneratedProps:r}),disableTooltip:!o.isDisabled&&!r,render:e=>(0,K.jsx)("div",{style:a.generatingText,...e,children:d})})}function kt(e){const{disabledResult:t,lastGeneratedProps:n}=e,i=(0,c().IS)((e=>({darkTextColor:{color:"#787774"}})),[]);return t.isDisabled?(0,K.jsx)("div",{children:t.disabledMessage}):n?(0,K.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:4},children:[n.lastEditedByName&&n.lastHumanEditedTime&&(0,K.jsx)("div",{style:i.darkTextColor,children:(0,K.jsx)(I().sA,{defaultMessage:"Edited by <whiteName>{personName}</whiteName> {timestamp}",id:"AiBlockV2.lastGeneratedByHuman",values:{personName:n.lastEditedByName,whiteName:e=>(0,K.jsx)("span",{style:{color:"white"},children:e}),timestamp:n.lastHumanEditedTime}})}),(0,K.jsx)("div",{style:i.darkTextColor,children:(0,K.jsx)(I().sA,{defaultMessage:"Generated by <white>AI</white> {timestamp}",id:"AIBlockV2.LastGeneratedAt",values:{timestamp:n.lastAiEditGenerationTime,white:e=>(0,K.jsx)("span",{style:{color:"white"},children:e})}})})]}):null}const It=(0,I().YK)({custom:{id:"AiBlockV2.skillSelector.custom",defaultMessage:"Custom"},summarize:{id:"AiBlockV2.skillSelector.summarize",defaultMessage:"Summarize"},extractKeyPoints:{id:"AiBlockV2.skillSelector.extractKeyPoints",defaultMessage:"Extract key points"}});function Ct(e){const{store:t,handleGenerateClick:n,isGenerating:i,permissionLevelCalculator:s,updateBlockConfiguration:o}=e,a=(0,c().IS)((()=>({popup:{marginTop:4,width:300,padding:12,paddingTop:4,display:"flex",flexDirection:"column",gap:10}})),[]),r=yt({store:t,isGenerating:i,permissionLevelCalculator:s});return(0,K.jsxs)("div",{style:a.popup,children:[(0,K.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsx)("div",{style:{fontSize:14,fontWeight:500,marginLeft:4},children:(0,K.jsx)(I().sA,{id:"aiBlock.configuration.blockSettingsTitle",defaultMessage:"AI block"})}),(0,K.jsx)(_t,{store:t,permissionCalculator:s})]}),(0,K.jsx)(we,{style:{marginLeft:4,marginRight:4},store:t}),(0,K.jsx)(Tt,{store:t,permissionLevelCalculator:s,updateBlockConfiguration:o}),(0,K.jsx)(wt,{store:t}),r.isDisabled?(0,K.jsx)(ge().E,{style:{cursor:"not-allowed"},onClick:n,isLoading:i,disabled:!0,children:(0,K.jsx)(xt,{isGenerating:i,store:t,permissionLevelCalculator:s})}):(0,K.jsx)(Se().A,{onClick:n,isLoading:i,children:(0,K.jsx)(xt,{isGenerating:i,store:t,permissionLevelCalculator:s})})]})}function wt(e){const t=(0,c().IS)((e=>({divider:{borderTop:`1px solid ${e.lightDividerColor}`,marginLeft:-12,marginRight:-12}})),[]),n=(0,l().K8)((()=>bt({model:e.store.getModel()})),[e.store]);return n&&"custom"===n.type?(0,K.jsx)("div",{style:t.divider}):null}function Tt(e){const{store:t,permissionLevelCalculator:n,updateBlockConfiguration:i}=e,s=(0,l().K8)((()=>bt({model:t.getModel()})),[t]);if(!s)return null;switch(s.type){case"custom":return(0,K.jsx)(Mt,{blockConfiguration:s,permissionLevelCalculator:n,updateBlockConfiguration:e=>{i({...s,...e})}});case"extractKeyPointsFromThisPage":case"summarizeThisPage":return(0,K.jsx)(At,{});default:(0,d().HB)(s)}}function At(){const e=(0,c().IS)((e=>({textWrapper:{display:"flex",alignItems:"center",justifyContent:"space-between",marginLeft:4,marginRight:4},currentPageLabel:{color:e.text.tertiary,fontSize:14},pageLabel:{fontSize:14}})),[]);return(0,K.jsxs)("div",{style:e.textWrapper,children:[(0,K.jsx)("div",{style:e.pageLabel,children:(0,K.jsx)(I().sA,{defaultMessage:"Page",id:"AiBlockV2.extractKeyPointsFromThisPage.contextLabel"})}),(0,K.jsx)("div",{style:e.currentPageLabel,children:(0,K.jsx)(I().sA,{defaultMessage:"Current page",id:"AiBlockV2.extractKeyPointsFromThisPage.currentPageLabel"})})]})}function Mt(e){const{blockConfiguration:t,updateBlockConfiguration:n,permissionLevelCalculator:i}=e,o=(0,s.useCallback)((e=>{"custom"===t.type&&n({autofillInstructions:e})}),[t,n]),{store:a}=(0,re().AI)({initialValue:"custom"===t.type?t.autofillInstructions:void 0,onChange:o}),r=(0,I().tz)(),l=t.context,d=(0,s.useCallback)((e=>{n({context:e})}),[n]),u=(0,s.useCallback)((()=>{n({dontSearchWorkspaceAndConnectors:!t.dontSearchWorkspaceAndConnectors})}),[t,n]),p=(0,c().IS)((e=>({textStyle:{display:"flex",alignItems:"center",fontSize:12,paddingLeft:0,paddingRight:0,paddingTop:4,paddingBottom:4,cursor:"pointer",userSelect:"none",fontWeight:400,border:"none"},selectedSourceText:{color:e.text.secondary,marginTop:2},sourcesLabel:{marginTop:4,marginBottom:-2,color:e.text.secondary,fontSize:12,fontWeight:500}})),[]);return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(Rt,{store:a,placeholder:r.formatMessage({id:"AiBlockV2.AutofillInstructions.Placeholder",defaultMessage:"Describe the content that should be generated. Use '@' to mention people, pages, or dates"}),minTextHeight:115,showAtMentionMenu:!0,fontSize:14,fontWeight:400,disabled:!i.canEditConfigurationPanel(),context:l,updateContexts:d}),(0,K.jsx)("div",{style:p.sourcesLabel,children:(0,K.jsx)(I().sA,{defaultMessage:"Sources",id:"AiBlockV2ConfigurationMenu.sourcesLabel"})}),(0,K.jsx)(jt,{contexts:l,updateContexts:d,disabled:!i.canEditConfigurationPanel()}),(0,K.jsxs)(pe().Y1,{direction:"vertical",gap:0,children:[(0,K.jsx)(ye().a,{selectorSize:"small",style:p.textStyle,label:(0,K.jsx)("div",{style:p.selectedSourceText,children:(0,K.jsx)(I().sA,{defaultMessage:"Use selected sources only",id:"AiBlockV2ConfigurationMenu.selectedSourcesOnly"})}),onChange:()=>{},isSelected:!0===t.dontSearchWorkspaceAndConnectors,onClick:u,value:"selected_sources",selectType:"radio"}),(0,K.jsx)(ye().a,{style:p.textStyle,selectAlignYAxis:"top",label:(0,K.jsx)("div",{style:p.selectedSourceText,children:(0,K.jsx)(I().sA,{defaultMessage:"Use selected sources and search workspace to find related information",id:"AiBlockV2ConfigurationMenu.useAllSources"})}),onChange:()=>{},selectType:"radio",isSelected:!Boolean(t.dontSearchWorkspaceAndConnectors),onClick:u,value:"all_sources",selectorSize:"small"})]})]})}function jt(e){const{contexts:t,updateContexts:n,disabled:i}=e,o=(0,l().O$)(G().AppStoreCurrentSpaceStore),a=(0,r().v3)(),u=(0,l().K8)((()=>(0,d().O9)(t)&&o?t.map((e=>"page"===e.type||"collection"===e.type?{type:"block",blockStore:new(N().Bv)(a,{table:p().ev,id:e.pageId,spaceId:o.id})}:"currentPage"===e.type?{type:"currentPage",blockStore:new(N().Bv)(a,{table:p().ev,id:e.pageId,spaceId:o.id})}:"slack"===e.type?e:void(0,d().HB)(e))):[]),[t,o,a]),m=(0,s.useCallback)((e=>{if(i)return;const t=e.map((e=>{if("block"===e.type){var t;const n=null===(t=e.blockStore.getCollectionPointer())||void 0===t?void 0:t.id;return n?{pageId:e.blockStore.id,collectionId:n,type:"collection"}:{pageId:e.blockStore.id,type:"page"}}return"slack"===e.type?e:"currentPage"===e.type?{type:"currentPage",pageId:e.blockStore.id}:void(0,d().HB)(e)}));return n(t)}),[n,i]),g=(0,c().IS)((e=>({titleStyle:{fontSize:14,fontWeight:500,color:e.text.tertiary,display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"}})),[]);return o?(0,K.jsx)("div",{style:g.titleStyle,children:(0,K.jsx)(fe().A,{debugName:"PromptOrActionInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:(0,K.jsx)(ct,{currentContexts:u,handleUpdateContexts:m,disabled:i})})}):null}function Rt(e){const{store:t,minTextHeight:n=50,placeholder:i,showAtMentionMenu:a,fontSize:l=14,fontWeight:d=500,disabled:u,context:p,updateContexts:m}=e,g=(0,c().IS)((e=>({inputWrap:{display:"flex",flexDirection:"column",justifyContent:"space-between",boxShadow:e.inputBoxShadow,minHeight:n,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:"transparent",borderRadius:6,overflow:"inherit",flexGrow:1,flexShrink:1,paddingLeft:6,paddingRight:6,paddingBottom:6},textContainer:{fontSize:l,fontWeight:d,flexGrow:1,padding:"4px 0",maxHeight:240,overflow:"auto"},placeholder:{color:e.text.quaternary}})),[l,d,n]),v=(0,r().v3)();(0,s.useEffect)((()=>{const e=o().A.withListenerIgnored((()=>{var e;return null===(e=G().default.state.currentSpaceStore)||void 0===e?void 0:e.id}));e&&(0,xe().Hn)({environment:v,spaceId:e,externalAuthConfig:{type:"universal",app:"slack",spaceId:e}})}),[v]);const f=(0,s.useCallback)((async()=>{const e=ue().default.state;"editing"===e.mode&&(0,de().KP)(e.multiSelection)&&e.multiSelection.start.store===t||(ne().setSelectionAtEnd({store:t}),await Q().default.afterNextFlush())}),[t]),h=(0,s.useCallback)((e=>{u||(e.preventDefault(),e.stopPropagation(),async function(){await f(),await Q().default.afterNextFlush(),te().Gf({environment:v,mentionTypes:ie().Ap,usePopupOnMobile:!0,mentionSectionOrdering:ie().h2})}())}),[u,v,f]),y=(0,s.useMemo)((()=>{const e=new Set;return null==p||p.forEach((t=>{"page"!==t.type&&"currentPage"!==t.type||e.add(t.pageId)})),e}),[p]),S=(0,s.useCallback)((()=>{const e=o().A.withListenerIgnored((()=>t.getValue()));if(e){const t=(0,ee().moK)(e).filter((e=>!y.has(e.id))).map((e=>({type:"page",pageId:e.id})));m([...p??[],...t])}}),[p,y,t,m]),b=(0,$().Y)(S,200);return(0,s.useEffect)((()=>{!async function(){await Q().default.afterNextFlush(),await Q().default.afterNextFlush(),ne().setSelectionAtEnd({store:t})}()}),[t]),(0,K.jsxs)("div",{style:g.inputWrap,className:ae().CCX,children:[(0,K.jsx)(ke().A,{onChange:b,placeholder:i,placeholderStyle:g.placeholder,style:g.textContainer,disabled:u,store:t,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:le().Os.none}),a&&(0,K.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end"},children:(0,K.jsx)(se().q,{onClick:h})})]})}function _t(e){const{store:t,permissionCalculator:n}=e,i=(0,c().IS)((e=>({icon:{marginLeft:4,fill:e.lightIconColor,width:16,height:12,marginTop:2},optionIcon:{marginRight:4,fill:e.lightIconColor,width:16,height:16},dropdownLabel:{fontSize:14,fontWeight:400,display:"flex",alignItems:"center",marginRight:-4},secondaryTextColor:{color:e.text.tertiary}})),[]),o=[{key:"custom",label:(0,K.jsx)(I().sA,{...It.custom}),icon:e=>(0,X().l)({...i.optionIcon,...e&&{fill:void 0}})},{key:"summarizeThisPage",label:(0,K.jsx)(I().sA,{...It.summarize}),icon:e=>(0,Y().G)({...i.optionIcon,...e&&{fill:void 0}})},{key:"extractKeyPointsFromThisPage",label:(0,K.jsx)(I().sA,{...It.extractKeyPoints}),icon:e=>(0,J().b)({...i.optionIcon,...e&&{fill:void 0}})}],{currentSkillType:a,updateBlockSkillType:r}=function(e){const t=(0,s.useRef)(void 0),{blockConfiguration:n,updateBlockConfiguration:i}=St(e);return{updateBlockSkillType:(0,s.useCallback)((e=>{var s;if(e===n.type)return;if(e===(null===(s=t.current)||void 0===s?void 0:s.type))return i(t.current),void(t.current=n);let o;switch(e){case"custom":o={type:"custom",version:2,title:n.title,autofillInstructions:void 0,placeholderText:void 0,context:void 0};break;case"extractKeyPointsFromThisPage":o={type:"extractKeyPointsFromThisPage",version:2,title:n.title};break;case"summarizeThisPage":o={type:"summarizeThisPage",version:2,title:n.title};break;default:(0,d().HB)(e)}t.current=n,i(o)}),[n,i]),currentSkillType:n.type}}(t),u=o.find((e=>e.key===a))??null,p=(0,s.useCallback)(((e,t)=>{r(e),t()}),[r]),m=(0,l().K8)((()=>!n.canEditConfigurationPanel()),[n]);return(0,K.jsx)(W().Ay,{isWaxPaper:!0,popupType:W().z7.Popup,disabled:m,placementToOrigin:W().sx.Top,trapFocus:!1,renderOrigin:e=>(0,K.jsxs)(me().p,{...e,style:i.dropdownLabel,hoveredStyle:{background:"rgba(0, 0, 0, 0)"},children:[null==u?void 0:u.icon(),(0,K.jsx)("div",{style:i.secondaryTextColor,children:null==u?void 0:u.label}),(0,Z().b)(i.icon)]}),render:e=>{const t={menuType:ce().gu.Popup,width:220},n=[{key:"skillSelectorSection",render:e=>(0,K.jsx)(be().A,{...e}),items:o.map((t=>({key:t.key,action:()=>p(t.key,e.close),render:e=>(0,K.jsx)(ve().A,{...e,title:t.label,shouldWrapCaption:!0,left:t.icon(!0),isChecked:t.key===a})})))}];return(0,K.jsx)(oe().A,{...t,children:(0,K.jsx)(he().Ay,{initialFocus:void 0,type:he().Oh.Vertical,sections:n,style:{position:"relative"}})})}})}function Bt(e){const t=e?F().c.getStateForBot({type:"universal",app:"slack",spaceId:e}):void 0;return e=>{if("public"===e.channel.type)return!0;const n=null==t?void 0:t.channels[e.channel.id];return Boolean(n)}}function Pt(e){const{handleGenerateClick:t,store:n,isGenerating:u,permissionLevelCalculator:m,configurationPopupStore:g,traceId:v}=e,{blockConfiguration:f,updateBlockConfiguration:h}=St(n),y=yt({store:n,isGenerating:u,permissionLevelCalculator:m}),S=(0,l().K8)((()=>g.state.open),[g]),b=(0,c().IS)((e=>({divider:{borderRight:`1px solid ${e.regularDividerColor}`},actionbarWrapperStyle:{position:"absolute",zIndex:85,top:-40,right:-2,borderRadius:10,height:32,fontSize:14,lineHeight:1.2,display:"flex",whiteSpace:"nowrap",fontFamily:A().vc(a().locale).sans,background:e.popoverBackground,boxShadow:e.shadowMD,visibility:S?"hidden":"visible"}})),[S]),x=(0,r().v3)(),{isMobile:k}=x.device;(0,l().K8)((()=>{_().EF.state===n.pointer.id&&(!function(e){var t;const{updateBlockConfiguration:n,blockConfiguration:i,environment:s}=e,a=new Set,r=null===(t=G().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(r&&"context"in i){for(const e of i.context??[])if("collection"===e.type||"page"===e.type||"currentPage"===e.type){const t=new(N().Bv)(s,{table:p().ev,id:e.pageId,spaceId:r});o().A.withListenerIgnored((()=>!t.canRead()))&&a.add(e.pageId)}else"slack"===e.type?Bt(r)(e)||a.add(e.channel.id):(0,d().HB)(e);n({...i,context:(i.context??[]).filter((e=>"slack"===e.type?!a.has(e.channel.id):!a.has(e.pageId)))})}}({environment:x,blockConfiguration:f,updateBlockConfiguration:h}),g.setState({open:!0}),_().EF.setState(void 0))}),[f,x,n,h,g]);const I=(0,s.useCallback)((()=>{g.setState({open:!1})}),[g]),C=(0,l().K8)((()=>g.state.open),[g]),w=m.canOpenConfigurationPanel();return(0,K.jsx)(i().P.div,{animate:{opacity:1},initial:{opacity:0},style:b.actionbarWrapperStyle,children:(0,K.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,K.jsx)(Et,{disabledResult:y,onClick:t,isGenerating:u,store:n,permissionLevelCalculator:m,traceId:v}),(0,K.jsx)("div",{style:b.divider}),(0,K.jsx)(W().Ay,{disabled:!w||k,buttonPopupStore:g,open:C,onClick:()=>{(0,E().u4)({environment:x,event:{eventName:"ai_block_settings_panel_opened",eventProperties:{}}})},render:()=>(0,K.jsx)(Ct,{store:n,updateBlockConfiguration:h,onClosePopup:I,handleGenerateClick:t,isGenerating:u,permissionLevelCalculator:m}),renderOrigin:e=>(0,K.jsx)(Lt,{...e,disabled:!w}),popupType:W().z7.Popup,originGap:8})]})})}const Lt=s.forwardRef((function(e,t){const{onClick:i,...s}=e,o=(0,I().tz)(),a=(0,c().IS)((()=>({wrapper:{display:"flex",alignItems:"center",cursor:"pointer",paddingLeft:10,paddingRight:10,paddingTop:6,paddingBottom:6,...s.disabled&&{cursor:"not-allowed",opacity:.5}}})),[s.disabled]);return(0,K.jsx)(L().A,{renderTooltip:()=>o.formatMessage({defaultMessage:"Insufficient permissions to view",id:"AiBlockV2.insufficientPermissionsTooltip"}),disableTooltip:!s.disabled,render:e=>(0,K.jsx)(n(126451).A,{style:a.wrapper,ignoreLocalHoverState:!0,hovered:!1,onClick:i,ref:t,...(0,n(906230).A)(s,e),children:(0,K.jsx)(I().sA,{id:"AiBlockV2.editConfiguration",defaultMessage:"Settings"})})})})),Et=s.forwardRef((function(e,t){const{onClick:n,disabledResult:i,isGenerating:o,store:a,permissionLevelCalculator:l,traceId:d}=e,u=i.isDisabled,p=(0,c().IS)((e=>({wrapper:{cursor:u?"not-allowed":"pointer",paddingTop:6,paddingBottom:6,paddingRight:6,paddingLeft:6,fontSize:12,opacity:u?.5:1,display:"flex",alignItems:"center"}})),[u]),m=(0,r().v3)(),{isMobile:g}=m.device,[v,f]=(0,s.useState)(void 0);return(0,K.jsxs)("div",{style:p.wrapper,onClick:u?void 0:n,ref:t,children:[(0,K.jsx)(xt,{isGenerating:o,store:a,permissionLevelCalculator:l}),g?null:(0,K.jsx)(z,{traceId:d,feedbackState:v,setFeedbackState:f})]})})),qt=(0,I().YK)({failedToGenerate:{id:"AIBlockV2.FailedToGenerate",defaultMessage:"Failed to generate. Please try again later."}});function Ut(e){const{spaceId:t,currentUserId:n}=(0,l().K8)((()=>{var e,t;return{spaceId:null===(e=G().default.state.currentSpaceStore)||void 0===e?void 0:e.id,currentUserId:null===(t=G().default.state.currentUserStore)||void 0===t?void 0:t.id}}),[]),i=(0,l().K8)((()=>e.getModel()),[e]),s=(0,l().K8)((()=>{var t;return null===(t=e.getNavigableBlockStore())||void 0===t?void 0:t.pointer}),[e]);return(0,l().K8)((()=>function(e){const{model:t,spaceId:n,currentUserId:i,getRecordRole:s,getCanReadSlackChannel:o,currentPagePointer:a}=e;if(!t)return"reader";if(!n||!i)return"reader";const r=s(t.pointer)??"none";if(!(0,u().Tt)(r))return"reader";const l=s({id:n,table:g().NX})??"none";if(!(0,u().Tt)(l))return"reader";if(!(0,u().p2)(r))return"configuration_reader";const c=(0,v().Lv)({model:t});if("custom"===c.type)return f({referenceContext:c.context,getCanReadSlackChannel:o,getRecordRole:s})?"editor":"configuration_reader";if("summarizeThisPage"===c.type||"extractKeyPointsFromThisPage"===c.type)return a?f({referenceContext:[{type:"page",pageId:a.id}],getCanReadSlackChannel:o,getRecordRole:s})?"editor":"configuration_reader":"reader";(0,d().HB)(c)}({spaceId:t,currentUserId:n,getCanReadSlackChannel:Bt(t),getRecordRole:e.getRecordRole,model:i,currentPagePointer:s})),[t,n,e,i,s])}function Gt(e){const{store:t,hoveredOrSelectionState:n,setHaloShouldBeVisible:i,showingOverlay:o,disabled:a,disableHoverMenu:c,configurationPopupStore:d}=e,u=(0,r().v3)(),p=(0,I().tz)(),m=new h(Ut(t)),g=(0,s.useCallback)((e=>{j().ui({message:e,showCancel:!1,keepFocus:!1,items:[{label:U().A.formatMessage(j()._0.dismissButtonLabel),onAccept:w().D_}]})}),[]),[v,f]=(0,s.useState)(!1),b=(0,l().K8)((()=>t.isGenerating()),[t]);(0,s.useEffect)((()=>{f(b)}),[b]);const x=t.id,k=(0,s.useCallback)((async()=>{await async function(e){const{environment:t,setIsGenerating:n,onError:i,store:s,intl:o}=e;function a(){i(o.formatMessage(qt.failedToGenerate))}n(!0);const r=async()=>{var e,n;const i=null===(e=G().default.state.currentSpaceStore)||void 0===e?void 0:e.id;if(!i)return;const o=null===(n=s.getNavigableBlockStore())||void 0===n?void 0:n.pointer;if(!o)return;const a=await M().callStreamApi({eventName:"generateAiBlock",environment:t,data:{blockPointer:{...s.pointer,spaceId:i},parentPagePointer:{...o,spaceId:i},analyticsSource:"client"}});if((0,S().kX)(a)||"success"!==a.type||!C().hS.is(a.data))throw new Error("InvalidServerResponse");{let e=[];for await(const n of a.data){if(!(0,S().PX)(n))throw new Error("InvalidStreamResponse");Nt({environment:t,operations:n.operations,blockIds:n.blockIds,aiBlockStore:s}),e=n.operations}if(0===e.length)throw new Error("EmptyGeneration")}};try{return await(0,T().L5)({fn:r,retryAttemptsMS:[50,100,200],retryAttemptRandomOffsetMS:0,initialInput:void 0,handleError:(e,t,n)=>(t&&a(),function(e){const{type:t,aiBlockId:n,spaceId:i,miscDataToConvertToString:s}=e;y().log({from:"generateAiBlockTask",level:"error",type:t,data:{miscDataToConvertToString:{aiBlockId:n,spaceId:i,...s}}})}({aiBlockId:s.id,spaceId:s.getSpaceId(),type:e.name,miscDataToConvertToString:{source:"client",isRetrying:!t,retryAttempt:n}}),t?{status:"throw",error:e}:{status:"retry"})})}finally{n(!1)}}({environment:u,intl:p,onError:g,store:t,setIsGenerating:f})}),[u,p,g,t]),A=(0,s.useCallback)((()=>{d.setState({open:!0})}),[d]),R=(0,l().K8)((()=>!t.hasContent()),[t]),_=(0,l().K8)((()=>t.getContentStore()),[t]),B=(0,r().Y0)();return(0,K.jsxs)(D().A,{name:"AiBlockV2",children:[(0,K.jsx)("div",{style:{paddingLeft:8,minHeight:32},onClick:R?A:void 0,children:(0,K.jsx)(H().A,{emptyPlaceholder:(0,K.jsx)(Ft,{placeholderText:p.formatMessage({id:"AiBlockV2.EmptyEditingPlaceholder3",defaultMessage:"Your AI content will be generated here - click to setup"})}),disabled:a||v,store:_,disableHoverMenu:c||n!==q().l.SelectedDescendant,disableDrag:B.isMobile})}),o&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(V().gM,{hoveredOrSelectionState:n,setHaloShouldBeVisible:i,colorVariant:"blue",configurationPopupStore:d}),(0,K.jsx)(O().s,{allowSelectionWithin:!1,children:(0,K.jsx)(Pt,{store:t,handleGenerateClick:k,isGenerating:v,permissionLevelCalculator:m,configurationPopupStore:d,traceId:x})})]})]})}function Ft(e){const{placeholderText:t}=e,n=(0,c().IS)((e=>({textWrapper:{caretColor:e.text.tertiary,color:e.text.tertiary,marginTop:4,marginBottom:4,cursor:"pointer"}})),[]);return(0,K.jsx)("div",{style:n.textWrapper,children:t})}function Nt(e){const{environment:t,operations:n,blockIds:i,aiBlockStore:s}=e;0!==n.length&&P().createAndCommit({userAction:"aiBlockV2.handleGenerateStreamResponse",environment:t,canUndo:!0,perform:e=>{s.getContentIds().forEach((t=>{P().applyOperation({store:s,operation:(0,x().TQ)({blockParentId:s.id,recordId:t}),transaction:e})}));for(const i of n)if((0,k().ph)(i)){const n=new(N().Bv)(t,i.pointer);P().applyCrdtTextOperation({store:n,operation:i,invertedOperation:void 0,transaction:e})}else if((0,b().$Y)(i)||(0,b().mP)(i))switch(i.pointer.table){case p().ev:{const n=new(N().Bv)(t,i.pointer);if("set"===i.command&&0===i.path.length){const s=n.getParentStore()??(i.args.parent_id&&i.args.parent_table?new(N().pm)({environment:t,pointer:{table:i.args.parent_table,id:i.args.parent_id,spaceId:i.args.space_id??n.getSpaceId()}}):void 0),o=B().Wv({environment:t,id:i.pointer.id,type:i.args.type,properties:i.args.properties,format:i.args.format,permissions:i.args.permissions,inMemoryRecordCache:n.inMemoryRecordCache,spaceId:i.args.space_id??n.getSpaceId(),transaction:e});s&&R().NI({childStore:o,parentStore:s,transaction:e})}else P().applyOperation({store:n,operation:i,transaction:e});break}default:{const n=new(N().pm)({environment:t,pointer:i.pointer,path:i.path});P().applyOperation({store:n,operation:i,transaction:e})}}else(0,d().HB)(i);for(const n of i){const i=new(N().Bv)(t,{table:p().ev,id:n,spaceId:s.getSpaceId()});R().NI({childStore:i,parentStore:s,transaction:e})}B().zv({store:s.getFormatStore(),data:{ai_last_edited:Date.now()},transaction:e})}})}},945669:(e,t,n)=>{n.r(t),n.d(t,{RequestMembersModal:()=>R,default:()=>_,messages:()=>j});var i=n(242343),s=()=>n(237385),o=()=>n(803290),a=()=>n(174114),r=()=>n(653998),l=()=>n(220413),c=()=>n(31448),d=()=>n(528643),u=()=>n(235843),p=()=>n(575015),m=()=>n(441292),g=()=>n(59175),v=()=>n(935091),f=()=>n(433119),h=()=>n(443252),y=()=>n(951540),S=()=>n(35462),b=()=>n(328547),x=()=>n(54852),k=()=>n(64256),I=()=>n(640979),C=()=>n(861095),w=()=>n(907721),T=()=>n(368156),A=()=>n(299097),M=n(163643);const j=(0,r().YK)({reason_placeholder:{id:"RequestMembersModal.reason.placeholder",defaultMessage:"Add a reason (optional)"}});function R(e){const t=(0,s().v3)(),{store:n,origin:R,analyticsFrom:_}=e,{modalOpen:B,focus:P}=(0,o().K8)((()=>{const{open:e,focus:t}=T().A.state;return{modalOpen:e,focus:t}}),[]),L=(0,i.useCallback)((e=>{B&&T().A.setState({...T().A.state,open:!0,focus:e})}),[B]),E=(0,o().uB)(void 0,A().A),q=(0,r().tz)(),U=(0,a().IS)((()=>({modalStyle:{alignSelf:"center",overflow:"visible",top:0,width:420},container:{padding:20},title:{fontWeight:c().Wy.medium,marginBottom:10},reasonTitle:{color:l().Ay.mediumTextColor,marginTop:10,marginBottom:5},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:15},requestInvitesButton:{marginLeft:20}})),[]);(0,i.useEffect)((()=>{L("invites")}),[L]);const G=e=>{e.currentTarget===e.target&&L("none")},F=async()=>{d().RH(t,{...k().nE(t,E.state.contextualInviteStore),from:_}),u().KW({permissionsInviteStore:E.state.permissionsInviteStore,contextualInviteStore:E.state.contextualInviteStore}),E.state.contextualInviteStore.startRequestMembership();const e=E.state.contextualInviteStore.state.invitedUsers;T().A.close();const i=await k().xi({environment:t,spaceStore:n,originId:void 0,originType:_,reasonMessage:E.state.permissionsInviteStore.state.emailMessage,contextualInviteStore:E.state.contextualInviteStore,intl:q});N({success:i,intl:q,users:e}),E.reset()},N=e=>{const{success:t,intl:n,users:i}=e;0!==i.length&&(t?p().D6({label:n.formatMessage({id:"requestMembersModal.requestSuccess.toast",defaultMessage:"Successfully requested membership for {users} to your workspace admins."},{users:k().id(i,n)})}):p().D6({label:n.formatMessage({id:"requestMembersModal.requestFail.toast",defaultMessage:"Failed to invite {users} to the workspace."},{users:k().id(i,n)})}))};return(0,M.jsx)(f().A,{modalStyle:U.modalStyle,open:B,onDismiss:async()=>{if(!(await(0,C().iQ)({environment:t,permissionsInviteStoreState:E.state.permissionsInviteStore.state,from:"space_settings_add_members"})))return T().A.close(),void E.reset();L("none")},renderContent:()=>(0,M.jsxs)("div",{style:U.container,onClick:G,children:[(0,M.jsx)("div",{style:U.title,onClick:G,children:(0,M.jsx)(r().sA,{id:"requestMembersModal.title",defaultMessage:"Request to invite members"})}),(0,M.jsx)(h().Ay,{popupType:h().nl.Popup,alignmentToOrigin:w().C.Start,placementToOrigin:w().W.Bottom,open:"invites"===P,sameWidthAsOrigin:!0,originGap:10,disableMouseCapture:!0,origin:(0,M.jsx)(b().A,{permissionsInviteStore:E.state.permissionsInviteStore,store:n,handleClickRemoveToken:e=>{u().St({targetToRemove:e,permissionsInviteStore:E.state.permissionsInviteStore,defaultRoleForNonBot:"read_and_write"})},handleInputChange:async e=>{L("invites"),await u().Pp({environment:t,event:e,permissionsInviteStore:E.state.permissionsInviteStore})},handleInputSubmit:async()=>{},origin:"add_members",defaultRoleForNonBot:"read_and_write",right:(0,M.jsx)("div",{}),focus:"invites"===P,handleFocus:()=>L("invites")}),onDismiss:()=>L("none"),render:()=>{const e=(0,M.jsx)(x().A,{permissionsInviteStore:E.state.permissionsInviteStore,store:n,defaultRoleForSpaceBot:"editor",shouldShowBots:!1,shouldShowGroups:!1,sectionRenderLimit:10,membersOnly:!1}),t={menuType:I().gu.Popup,disableScroller:!1};return(0,M.jsx)("div",{children:(0,M.jsx)(v().A,{...t,width:380,children:e})})},style:{width:"100%"}}),(0,M.jsx)("div",{style:U.reasonTitle,onClick:G,children:(0,M.jsx)(r().sA,{id:"requestMembersModal.reasonForRequest.title",defaultMessage:"Reason for request"})}),(0,M.jsx)(m().A,{debugName:"RequestMembersModal",capture:!0,allowEsc:!0,children:(0,M.jsx)(g().A,{textarea:!0,style:{padding:8},value:E.state.permissionsInviteStore.state.emailMessage,focus:"reason"===P,onFocus:()=>L("reason"),onChange:e=>{E.state.permissionsInviteStore.setState({...E.state.permissionsInviteStore.state,emailMessage:e.target.value})},placeholder:q.formatMessage(j.reason_placeholder)})}),(0,M.jsxs)("div",{style:U.footer,onClick:G,children:[(0,M.jsx)(S().A,{isSecondaryColor:!0,isSmall:!0,isMultiline:!0,children:(0,M.jsx)(r().sA,{id:"RequestMembersModal.caption",defaultMessage:"Your admins will approve or decline your request."})}),(0,M.jsx)(y().A,{size:"lg",style:U.requestInvitesButton,onClick:F,children:(0,M.jsx)(r().sA,{id:"requestMembersModal.requestInvitesButton.label",defaultMessage:"Request invites"})})]})]}),origin:(0,M.jsx)("div",{onClick:()=>{T().A.open()},children:R})})}const _=R},969836:(e,t,n)=>{n.d(t,{A:()=>a});n(242343);var i=()=>n(174114),s=()=>n(591090),o=n(163643);function a(e){const t=function(e){const{size:t,style:n}=e;return(0,i().IS)((e=>({icon:{width:.6*t,height:.6*t,fill:e.text.secondary},iconContainer:{width:t,height:t,borderRadius:"100%",background:e.regularDividerColor,display:"flex",alignItems:"center",justifyContent:"center",...n}})),[t,n])}(e),n=(0,s().$)(t.icon);return(0,o.jsx)("div",{style:t.iconContainer,children:n})}}}]);