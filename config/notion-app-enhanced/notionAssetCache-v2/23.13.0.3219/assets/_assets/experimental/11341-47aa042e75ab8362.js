"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11341],{262230:(e,t,n)=>{n.r(t),n.d(t,{applyStudentGitHubGrant:()=>Ee,cancelSubscription:()=>Se,closeSubscriptionUpgradeModal:()=>Te,handlePaymentIntentNextActions:()=>De,handlePlanChangeClick:()=>Me,openSubscriptionUpgradeModal:()=>Be,openSubscriptionUpgradeModalForClaimAndUpgrade:()=>Pe,payUnpaidInvoice:()=>ve,refreshAllBillingData:()=>Ie,refreshSubscriptionData:()=>we,refreshUserData:()=>xe,trackSubscriptionUpdate:()=>ge,updateAddress:()=>be,updateBillingEmail:()=>ye,updateCurrentSpace:()=>Ae,updatePaymentMethod:()=>fe,updateSubscription:()=>pe,updateSubscriptionToEducationPlan:()=>ke,updateVatId:()=>he});n(610931),n(242343);var r=()=>n(502140),o=()=>n(214144),a=()=>n(329911),i=()=>n(519423),s=()=>n(647242),c=()=>n(649074),d=()=>n(678988),l=()=>n(395665);var u=()=>n(653998),p=()=>n(975392),m=()=>n(76394),g=()=>n(421650),f=()=>n(818369),v=()=>n(216268),b=()=>n(145046),h=()=>n(70989),y=()=>n(336519),S=()=>n(594878),I=()=>n(995625),x=()=>n(477784),w=()=>n(739425),k=()=>n(672796),A=()=>n(309968),C=()=>n(485966),B=()=>n(837141),T=()=>n(436622),P=()=>n(359540),M=()=>n(985532),D=()=>n(836331),_=()=>n(320168),E=()=>n(990394),U=()=>n(493065),N=()=>n(855827),H=()=>n(341720),W=()=>n(330358),L=()=>n(172553),O=()=>n(297898),V=()=>n(685952);const $=new(n(967203).U)((e=>{let{spaceId:t}=e;return t}),(async function(e,t){let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,818369)),a=await o.callApi({eventName:"countUsers",environment:e,data:{spaceId:r}});return"success"===a.type?a.data:void 0}));n(996094).exposeDebugValue("UserCountsStore",$);var F=()=>n(472951),R=()=>n(613313),j=()=>n(298520),z=()=>n(146907),G=()=>n(670682);n(725707),n(491955),n(500234),n(403517);var q=()=>n(505316),Y=()=>n(111826),K=()=>n(764227),Q=()=>n(403551),J=()=>n(868224),Z=()=>n(577038),X=()=>n(352858),ee=()=>n(879205),te=()=>n(305043),ne=()=>n(201430),re=()=>n(698094);async function oe(e){const{environment:t,spaceId:n}=e,r=(0,ne().GM)({spaceId:n});if(!se||se!==r){let n;!function(e){ie&&re().Ay.removeListener(ie,e)}(t);const o=t=>{let{value:r}=t;void 0!==n&&n!==r&&ae(e),n=r},a=p().nF(o,5e3);ie=re().Ay.addListener(r,void 0,a,void 0,t),se=r;const i=A().A.state;if(!Object.keys(i).length)return ae(e)}}async function ae(e){const{environment:t,spaceId:n}=e;if((0,Y().e9)(t,n))return;const r=await f().callApi({eventName:"getBillingSubscriptionBannerData",environment:t,data:{spaceId:n},headers:(0,i().WS)({cellId:void 0,spaceId:n})});var o;"success"===r.type&&((null===(o=C().default.state.currentSpaceStore)||void 0===o?void 0:o.id)===n&&A().A.setState(r.data.bannerData));const a=await f().callApi({eventName:"getSubscriptionEntitlements",environment:t,data:{spaceId:n}});var s;"success"===a.type&&((null===(s=C().default.state.currentSpaceStore)||void 0===s?void 0:s.id)===n&&B().A.setState(a.data))}let ie,se;var ce=()=>n(397138),de=n(163643);const le="SubscriptionData",ue=(0,u().YK)({updatingSubscription:{id:"subscriptionSettings.updatingSubscriptionMessage",defaultMessage:"Updating your subscription…"},paymentMethodUpdateAuthFailed:{id:"subscriptionSettings.paymentMethodUpdateAuthFailedMessage",defaultMessage:"We could not update your payment method. Please try again or contact support."},verifyingEligibility:{id:"subscriptionSettings.verifyingEligibilityMessage",defaultMessage:"Verifying eligibility…"},educationPlusFree:{id:"subscriptionSettings.educationPlusFreeMessage",defaultMessage:"You are now subscribed to Notion's Education plan for free"},finishingUp:{id:"subscription.upgrade.finishing",defaultMessage:"Finishing up..."}});async function pe(e){const{from:t,environment:n,spaceStore:r,billingEmail:o,paymentData:a,vatId:i,coupon:c,customerName:l,businessName:u,addressLine1:p,addressZip:m,addressCity:g,addressState:S,addressCountry:I,promoCodeId:x,useTestClock:w,sessionId:k,inAppOffer:A,desiredState:C,trialData:B,postUpgradeCallback:T}=e;v().Re({bannerStore:E().A}),h().m({message:ue.updatingSubscription});const P=r.id,M=await(0,G().Vv)({environment:n,spaceId:P});if(!M)throw new Error("Billing data not loaded");const D=(0,s().PP)(M),{plan:_,addOns:U,isTrial:N}=function(e,t){if(!t)return{plan:void 0,addOns:[],isTrial:void 0};const n=e.items.filter((e=>"plan"!==(0,s().IE)(e))),r=t.items.find((e=>"plan"===(0,s().IE)(e))),o=t.items.filter((e=>"plan"!==(0,s().IE)(e)));return{isTrial:Boolean(t.trialEnd),plan:null==r?void 0:r.price.externalId,addOns:(0,d().HO)(n,o).map((e=>{let[t,n]=e;return{isCancellation:!n,priceId:(n??t).price.externalId,quantity:null==n?void 0:n.quantity}}))}}(D,C),H=await f().callApi({eventName:"updateSubscription",environment:n,data:{spaceId:P,plan:_,addOns:U,billingEmail:o,paymentMethodId:(0,q().optionalPaymentMethodIdGivenPaymentData)(a),vatId:i,coupon:c,customerName:l,businessName:u,addressLine1:p,addressZip:m,addressCity:g,addressState:S,addressCountry:I,promoCodeId:x,useTestClock:w,countryCode:undefined,modalSessionId:k,inAppOffer:A,isTrial:N,clientVersion:n.device.version,trialData:B,from:t}});if("failed"===H.type)throw h().V(),b().Qg(H),new Error("An error occurred while updating subscription");Ie({environment:n,spaceStore:r});const[L,O]=await Promise.all([(0,ce().G)(n),(0,G().Vv)({environment:n,spaceId:P})]);if(!O)throw h().V(),new Error("Billing data not loaded");return ge({environment:n,context:{spaceId:P,planType:r.getPlanType(),from:t,isMmOrEnt:L,trialData:B,modalId:k},oldData:M,newData:O,desiredState:C}),h().V(),T?T():Boolean(B)||me({oldTier:(0,s().AI)(M),newTier:(0,s().AI)(O),oldAddOns:(0,s().ji)(M),newAddOns:(0,s().ji)(O)}),W().A.state.open&&"requests"===W().A.state.currentTab&&y().Ow({currentTab:"billing"}),H.data}function me(e){return!!(0,R().Pe)()&&X().A.open(e)}function ge(e){var t;let{environment:n,context:r,oldData:o,newData:a,desiredState:i}=e;const d=(0,s().V9)(o),l=(0,s().AI)(o),u=(0,s().ji)(o),p=(0,s().q8)(o),m=(0,s().Ry)(o),f=o.email,v=(0,c().j1)(i),b=(0,c().Gf)(i),h=(0,c().V_)(i),y=(0,c().yw)(i),S=(0,c().j8)(i),x=Boolean(null==i?void 0:i.trialEnd),w=a.email,k=!(0,s().Fq)(o)&&(0,c().DS)(i),A=(0,s().Fq)(o)&&(0,c().DS)(i),C=(0,s().Fq)(o)&&!(0,c().DS)(i);k&&v?g().BK(n,{plan:v,credit_amount:0}):A?g().pT(n,{billing_email_changed:f!==w,plan_changed:v!==d,plan_current:v,plan_old:d,currency_code:S,billing_address_changed:!1}):C&&d&&g().pp(n,{plan:d}),g().xN(n,{from:r.from,action:C?"cancel":"update",spaceId:r.spaceId,isMmOrEnt:r.isMmOrEnt,planType:r.planType,addressCountry:null===(t=a.address)||void 0===t?void 0:t.country,oldSubscriptionTier:l,newSubscriptionTier:b,oldCurrency:m,newCurrency:S,oldPriceId:d,newPriceId:v,oldAddOns:u,newAddOns:h,oldBillingInterval:p,newBillingInterval:y,creditAmount:0,isProfessionalTeamUser:(0,I().YD)(),isTrial:x,trialEndDate:(0,s().i5)(o),trialData:r.trialData,modalId:r.modalId})}async function fe(e){const{environment:t,stripe:n,spaceStore:r,paymentMethodId:o}=e,a=await f().callApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:r.id,paymentMethodId:o}});if("failed"!==a.type){if(a.data.clientSecret&&"requires_action"===a.data.status){if("succeeded"!==await _e({stripe:n,clientSecret:a.data.clientSecret}))return void b().f1(x().A.formatMessage(ue.paymentMethodUpdateAuthFailed));const e=await f().callApi({eventName:"setDefaultPaymentMethod",environment:t,data:{spaceId:r.id,paymentMethodId:o}});if("failed"===e.type)return void b().Qg(e)}await Ie({environment:t,spaceStore:r})}else b().Qg(a)}async function ve(e){const{environment:t,spaceStore:n,invoiceId:r,paymentMethodId:o}=e,a=await f().callApi({eventName:"payInvoice",environment:t,data:{invoiceId:r,paymentMethodId:o}});"failed"!==a.type?await Ie({environment:t,spaceStore:n}):b().Qg(a)}async function be(e){const{environment:t,spaceStore:n,address:r}=e;v().Re({bannerStore:E().A}),h().m({message:ue.updatingSubscription});const o=await f().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,address:r}});if("failed"===o.type)throw h().V(),b().Qg(o),o.error;g().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await Ie({environment:t,spaceStore:n}),h().V()}async function he(e){const{environment:t,spaceStore:n,vatId:r}=e;v().Re({bannerStore:E().A}),h().m({message:ue.updatingSubscription});const o=await f().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,vatId:r}});if("failed"===o.type)throw h().V(),b().Qg(o),o.error;g().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!1}),await Ie({environment:t,spaceStore:n}),h().V()}async function ye(e){const{environment:t,spaceStore:n,email:r}=e;v().Re({bannerStore:E().A}),h().m({message:ue.updatingSubscription});const o=await f().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,billingEmail:r}});if("failed"===o.type)throw h().V(),b().Qg(o),o.error;g().pT(t,{billing_email_changed:!0,plan_changed:!1,billing_address_changed:!1}),await Ie({environment:t,spaceStore:n}),h().V()}async function Se(e){var t;const{environment:n,spaceStore:r,from:o}=e,a=await T().A.awaitData(n,{spaceId:null==r?void 0:r.id});if(!a)throw new Error("Billing data not loaded");v().Re({bannerStore:E().A}),h().m({message:ue.updatingSubscription});const i=await f().callApi({eventName:"cancelSubscription",environment:n,data:{spaceId:r.id,cancelImmediately:e.cancelImmediately}});if("failed"===i.type)return h().V(),void b().Qg(i);const c=(0,s().V9)(a);c&&g().pp(n,{plan:c}),await Ie({environment:n,spaceStore:r});if(!te().subscriptionDataStoreInstance.state)throw new Error("Subscription data not loaded.");return g().xN(n,{from:o,action:"cancel",spaceId:r.id,oldSubscriptionTier:(0,s().AI)(a),newSubscriptionTier:void 0,oldPriceId:null===(t=(0,s().KH)(a,"plan"))||void 0===t?void 0:t.price.externalId,oldCurrency:(0,s().Ry)(a),newCurrency:void 0,oldAddOns:(0,s().ji)(a),oldBillingInterval:(0,s().q8)(a),newBillingInterval:void 0,isCancelSubscription:!0,isProfessionalTeamUser:(0,I().YD)(),trialEndDate:(0,s().i5)(a)}),h().V(),!0}async function Ie(e){let{environment:t,spaceStore:n}=e;const r=n.id;ee().A.setState({...ee().A.state,status:"init"}),await Promise.all([j().$W({environment:t,spaceId:r}),we(t,r),T().A.resetData(t,{spaceId:r}),O().t.resetData(t,{spaceId:r}),_().A.resetData(t,{spaceId:r}),Z().c.resetData(t,{spaceId:r}),P().L.resetData(t,{spaceId:r}),V().A.resetData(t,{spaceId:r}),H().A.resetData(t,{spaceId:r})])}async function xe(e){let{environment:t,spaceStore:n}=e;const r=n.id;await Promise.all([we(t,r),H().A.resetData(t,{spaceId:r})])}async function we(e,t){var n;const o=t??(null===(n=C().default.state.currentSpaceStore)||void 0===n?void 0:n.id),s=e.currentUser.id;if(!o)throw new Error("No spaceId.");const c=`${le}:${o}:v2`,d=a().K.get({userId:s,key:c});d&&(te().subscriptionDataStoreInstance.setState(d),te().subscriptionDataStoreInstance.spaceId=o,F().k.setState(d.userSimilarity)),await U().transactionQueue.drain();const l=D().default.checkGate({gateName:"dont_load_users"}),[u,p]=await Promise.all([f().callApi({eventName:"getSubscriptionData",environment:e,data:{spaceId:o},headers:(0,i().WS)({cellId:void 0,spaceId:o})}),l?Promise.resolve({type:"success",data:{users:[],joinedMemberIds:[],userSimilarity:{},shouldUseEdgeCache:!0},status:200}):f().callApi({eventName:"getVisibleUsers",environment:e,data:{spaceId:o,supportsEdgeCache:!0},headers:(0,i().WS)({spaceId:o})})]),m=D().default.checkGate({gateName:"users_edge_cache"});if("success"===u.type&&"success"===p.type){var v;const t={...u.data,...p.data};m&&M().A.setState({shouldUseEdgeCache:p.data.shouldUseEdgeCache});try{a().K.set({userId:s,key:c,value:t})}catch{r().log({level:"error",from:"subscriptionActions",type:"subscriptionDataTooLarge",data:{miscDataToConvertToString:{subscriptionDataJsonSize:JSON.stringify(t).length}}})}(null===(v=C().default.state.currentSpaceStore)||void 0===v?void 0:v.id)===o&&(te().subscriptionDataStoreInstance.setState(t),te().subscriptionDataStoreInstance.spaceId=o,F().k.setState(t.userSimilarity),Y().Fq(t)&&g().G3(e))}else r().log({level:"error",from:"subscriptionActions",type:"fetchSubscriptionDataFailed",data:{miscDataToConvertToString:{getSubscriptionDataResponseType:u.type,getSubscriptionDataResponseStatus:u.status,getVisibleUserResponseType:p.type,getVisibleUserResponseStatus:p.status}}});m&&M().A.state.shouldUseEdgeCache&&await $.resetData(e,{spaceId:o}),await Promise.all([S().aiDependency.load().then((t=>{let{completionActions:n}=t;return n.maybeUpdateAiEligibility(e,o,!0)}))])}const ke=(0,p().sg)((async function(e){const{environment:t,spaceStore:r,code:o}=e;h().m({message:ue.verifyingEligibility});const a=te().subscriptionDataStoreInstance.state;if(!a)throw new Error("Subscription data not loaded.");const i=await f().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:r.id,code:o}});"failed"===i.type?b().Qg(i):i.data.isEligible?(await Ie({environment:t,spaceStore:r}),Ce(a,t)):n(945857).A.setState({open:!0,handlePromoCode:async e=>{h().m({message:ue.updatingSubscription});const n=await f().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:r.id,code:e}});"failed"===n.type?b().Qg(n):n.data.isEligible?(await Ie({environment:t,spaceStore:r}),Ce(a,t)):b().f1((0,de.jsx)(u().sA,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),h().V()}}),h().V()}),1e3,{leading:!0,trailing:!1});async function Ae(e){const{environment:t,spaceId:n,isNewlyCreatedSpace:r}=e,o=te().subscriptionDataStoreInstance.spaceId;if(!t.currentUser.isLoggedIn()||o&&o===n)await te().subscriptionDataStoreInstance.waitUntilLoaded();else{if(A().A.setState({}),oe({environment:t,spaceId:n}),B().A.setState({}),r){const e={type:"unsubscribed_admin",users:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,accountBalance:0,userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1};te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,F().k.setState(e.userSimilarity)}we(t,n)}}async function Ce(e,t){const n=()=>{me({oldTier:e.subscriptionTier??"free",newTier:"student",oldAddOns:[],newAddOns:[]})||b().rG({message:x().A.formatMessage(ue.educationPlusFree)}),W().A.setState({...W().A.state,currentTab:"billing",defaultSubtab:void 0});const n=Y().RJ(e);g().tt(t,{plan:"student_free",old_plan:n?n.plan:void 0})};await k().shouldCreatePassword(t)?w().r({environment:t,onSubmit:n,onCancel:n}):n()}function Be(e,t){const{subscriptionTier:n,from:r,addOnFeature:a,coupon:i,isTrial:s,dismissMobilePlansModal:c,postUpgradeCallback:d,offer:l}=t,u=o().JW();g().ae(e,{subscriptionTier:n,from:r,addOnFeature:a,currency_code:ee().A.state.selectedCurrencyCode,isTrial:s,modal_id:u}),L().A.open({from:r,subscriptionTier:n,billingInterval:"month",addOnFeature:a,coupon:i,isTrial:s,sessionId:u,dismissMobilePlansModal:c,postUpgradeCallback:d,offer:l})}function Te(e){const t=L().A.state;t.open&&(g().OC(e,{modal_id:t.sessionId}),L().A.setState({open:!1}))}function Pe(e){J().A.open(e)}async function Me(e){var t;const{environment:n,product:o,spaceStore:a,from:i,pageSection:u,churnState:g,billingData:f}=e,v=await j().p_({environment:n,spaceId:a.id}),b=f.subscription;if(!(b&&(0,m().O9)(f.paymentMethod)||"free"===o))return void Be(n,{subscriptionTier:o,from:i});const h=(0,s().lQ)(f),y=(0,s().Ry)(f),S=(0,c().yw)(h),I=(0,c().yw)(b),x=S??I,w=(null===(t=(0,s().KH)(f,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,k=(0,c().GB)({spaceId:a.id,logFunction:r().log.bind(r()),subscriptionState:h}),A=(0,c().GB)({spaceId:a.id,logFunction:r().log.bind(r()),subscriptionState:b}),C=k??A;let B;if("free"===o)B=(0,d().gL)(h,"plan");else{if(!(y&&x&&C))throw new Error("Trying to update plan on a subscription with no items");{const e=(0,R().Le)();B=(0,d().ef)({state:h,prices:v,quantities:{numSeats:C,numCustomHostnames:w},params:{currency:y,interval:x},products:[o],flags:{isMay13PackagingChangesEnabled:e}})}}if(!p().n4(h,B)){if((0,d().V5)(h,B)){if("no_churn"===g||!g)return;if((0,l().hZ)(N().A.getData(n,{spaceId:null==a?void 0:a.id}))&&(0,l().Jf)("resurrection_offer",K().AI(),I)){if(!(await(0,Q().Z)(n)))return}return 0===B.items.length?await Se({environment:n,spaceStore:a,from:i,cancelImmediately:"churn_immediately"===g}):await pe({environment:n,spaceStore:a,desiredState:B,from:i})}(0,z().o)(n,{desiredProducts:[o],from:i,analyticsArgs:{from:i,pageSection:u}})}}async function De(e){h().m({message:ue.finishingUp});const{paymentIntentData:t,stripe:n,onSuccess:r,onFailure:o}=e,a=t.paymentIntentClientSecret;let i=t.paymentIntentStatus;a&&"requires_action"===i&&(i=await _e({stripe:n,clientSecret:a})),"succeeded"===i||"processing"===i?null==r||r():function(e){let{status:t}=e;return["requires_payment_method","requires_source"].includes(t)}({status:i})&&(null==o||o()),h().V()}async function _e(e){let{stripe:t,clientSecret:n}=e;const{paymentIntent:r,setupIntent:o,error:a}=await t.handleNextAction({clientSecret:n});if(r)return r.status;if(o)return o.status;if(a.payment_intent)return a.payment_intent.status;if(a.setup_intent)return a.setup_intent.status;throw new Error(`Unexpected error handling intent: ${a.message}`)}async function Ee(e){const{environment:t,data:n}=e;await f().callApi({eventName:"applyStudentGitHubGrant",environment:t,data:n})}},352858:(e,t,n)=>{n.d(t,{A:()=>o});n(725707),n(500234);class r extends(()=>n(129044))().default{getInitialState(){return{open:!1}}close(){this.state.open&&this.setState({open:!1})}open(e){let{oldTier:t,newTier:r,oldAddOns:o,newAddOns:a}=e;if(function(e){if(!e)return!1;return["plus","enterprise","business","student"].includes(e)}(r)){if(function(e,t){if(!e||!t)return!1;return"upgrade"===(0,n(455831).qR)({oldTier:e,newTier:t})}(t,r))return this.setState({productUpgrade:r,open:!0}),!0}if(a.length>o.length){const e=a.find((e=>!o.includes(e)));if(function(e){if(!e)return!1;return["ai"].includes(e)}(e))return this.setState({productUpgrade:e,open:!0}),!0}return!1}}const o=new r},359540:(e,t,n)=>{n.d(t,{L:()=>r});const r=new(n(967203).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{var r;let{spaceId:o}=t;const a=await Promise.resolve().then(n.bind(n,818369)),i=await a.callApi({eventName:"getBillingHistory",environment:e,data:{spaceId:o,limit:20}});return"success"===i.type?null===(r=i.data)||void 0===r?void 0:r.events:void 0}));n(996094).exposeDebugValue("BillingHistoryStore",r)},403551:(e,t,n)=>{n.d(t,{Z:()=>v});n(242343);var r=()=>n(818369),o=()=>n(542758),a=()=>n(289241),i=()=>n(137476),s=()=>n(485966),c=()=>n(485779),d=()=>n(653998),l=()=>n(529305),u=()=>n(611824),p=()=>n(392608),m=n(163643);function g(e){let{onAccept:t}=e;return(0,m.jsx)(l().tf,{header:(0,m.jsx)(l().YA,{iconAndTitle:(0,m.jsx)(l().ZQ,{iconGroup:c().r,iconColorName:"uiRedPrimary",title:(0,m.jsx)(d().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,m.jsx)(d().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,m.jsx)(u().A,{external:!0,href:(0,p().xS)("resurrectionLearnMore"),children:e})}})}),footer:(0,m.jsx)(l().aO,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,m.jsx)(d().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:t}],secondaryButtons:[{buttonType:"dismiss",label:(0,m.jsx)(d().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const f=406;async function v(e){var t;const n=null===(t=s().default.state.currentSpaceStore)||void 0===t?void 0:t.id;return await a().T.showAsyncModal((t=>(0,m.jsx)(o().s,{isOpen:t.isOpen,onDismiss:()=>{(0,i().u4)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),t.onDismiss()},onClosed:t.onClosed,areaConstraint:{width:{type:"min",length:f},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,m.jsx)(g,{onAccept:async()=>{(0,i().u4)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),n&&await r().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:n}}),t.resolve("accepted")}})})))}},485779:(e,t,n)=>{n.d(t,{r:()=>r});const r=(0,n(680369).xh)("arrowInCircleDown",{default:{loader:()=>n.e(96029).then(n.bind(n,183781))},small:{loader:()=>n.e(96029).then(n.bind(n,138703))},fill:{loader:()=>n.e(96029).then(n.bind(n,729807))},fillSmall:{loader:()=>n.e(96029).then(n.bind(n,437328))}},["arrow","circle","down","direction","pointer","downgrade"])},505316:(e,t,n)=>{n.r(t),n.d(t,{getLegacyStripeAppearance:()=>k,getStripe:()=>S,injectStripe:()=>y,optionalPaymentMethodIdGivenPaymentData:()=>B,optionalStripeTokenGivenPaymentData:()=>C,stripeElementLocaleGivenNotionLocale:()=>I,translateStripeError:()=>w,useElementsOptions:()=>x});var r=()=>n(353420),o=()=>n(528945),a=n(242343),i=()=>n(237385),s=()=>n(803290),c=()=>n(174114),d=()=>n(707781);var l=()=>n(409211),u=()=>n(688724),p=()=>n(76394),m=()=>n(31448),g=()=>n(927685),f=()=>n(485966),v=()=>n(836331),b=n(163643);let h=null;function y(e){return function(t){const[n]=a.useState(S);return(0,b.jsx)(r().Elements,{stripe:n,children:(0,b.jsx)(r().ElementsConsumer,{children:n=>{let{stripe:r,elements:o}=n;const a={...t,stripe:r,elements:o};return(0,b.jsx)(e,{...a})}})})}}async function S(){return h||(o().loadStripe.setLoadParameters({advancedFraudSignals:!1}),h=(0,o().loadStripe)(g().A.stripe.key)),h}function I(e){switch(e){case"en-US":return"en";case"ko-KR":return"ko";case"ja-JP":return"ja";case"fr-FR":return"fr-FR";case"de-DE":return"de";case"es-ES":return"es-ES";case"es-LA":return"es-419";case"pt-BR":return"pt-BR";case"zh-CN":return"zh";case"zh-TW":return"zh-TW";case"da-DK":return"da";case"nl-NL":return"nl";case"fi-FI":return"fi";case"nb-NO":return"nb";case"sv-SE":return"sv";default:return"auto"}}function x(e){const t=(0,c().DP)(),n=(0,i().v3)(),{type:r}=e,o="setup"===r||"subscription"===r?e.currency:void 0,g="subscription"===r?e.amount:void 0,b=(0,s().K8)((()=>{var e;return(null===(e=f().default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||d().q}),[]),h=(0,s().K8)((()=>"KRW"===o&&function(e){const{experimentService:t,actor:n}=e;return t.checkGate({actor:n,gateName:"kr_card_payment_method"})}({experimentService:v().default,actor:{table:l().oo,id:n.currentUser.id??""}})),[n.currentUser,o]);return(0,a.useMemo)((()=>{const e=function(e){const t=A(e.text.primary),n=A(e.text.secondary),r=A(e.text.tertiary),o=A(e.text.uiRedPrimary),a=A(e.text.uiBluePrimary),i=A(e.icon.contrast),s=A(e.whiteButtonBackground);return{labels:"above",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"12px",spacingGridColumn:"12px",spacingUnit:"4px",spacingTab:"6px",colorPrimary:t,colorPrimaryText:t,colorText:t,colorTextSecondary:n,colorTextPlaceholder:r,colorIcon:t,colorIconCheckmark:i,colorDanger:o,colorBackground:s,colorIconTabHover:t,colorIconTabSelected:a,colorIconChevronDown:t,fontFamily:m().Tf.sans,fontWeightLight:`${m().Wy.light}`,fontWeightNormal:`${m().Wy.regular}`,fontWeightMedium:`${m().Wy.medium}`,fontWeightBold:`${m().Wy.medium}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"500",lineHeight:"16px",color:t,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground},".Tab:focus":{boxShadow:e.outlineBlueInputBoxShadow},".Tab--selected, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:t,boxShadow:"none",outline:"none"},".Tab--selected:hover":{backgroundColor:e.whiteButtonBackground,color:t},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.outlineBlueInputBoxShadow},".Input":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",padding:"7px 8px",backgroundColor:e.surface.wash,boxShadow:`0 0 0 1px ${e.stroke.primary}`,border:"none",color:t},".Input--invalid":{color:t,boxShadow:e.outlineRedInputBoxShadow},".Input:focus":{color:t,boxShadow:e.outlineBlueInputBoxShadow},".Label":{fontSize:"12px",lineHeight:"15px",fontWeight:"500",letterSpacing:"-0.154px",color:n,marginBottom:"8px"},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:o},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:t},".PickerItem:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:t,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--selected:hover":{boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:t},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:n,fontSize:"10px",fontWeight:"400",lineHeight:"13px",letterSpacing:"0.12px"},".CheckboxLabel":{color:t,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:t,fontWeight:"400",padding:"4px 8px"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.outlineBlueInputBoxShadow},".MenuIcon, .MenuIcon:hover":{fill:t},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",padding:"16px"},".Icon":{fill:t}}}}(t),n={appearance:e,locale:I(b)},a={paymentMethodTypes:(0,u().VV)({currency:o,isKrCardFeatureGateEnabled:h})};switch(r){case"address":return n;case"setup":return{...n,...a,currency:null==o?void 0:o.toLowerCase(),mode:"setup",paymentMethodCreation:"manual"};case"subscription":return{...n,...a,amount:g,currency:null==o?void 0:o.toLowerCase(),mode:"subscription",paymentMethodCreation:"manual",setupFutureUsage:"off_session",loader:"never"};default:(0,p().HB)(r)}}),[t,b,o,h,r,g])}function w(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number"});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."})}}(e,t.decline_code);default:return t.message||""}}function k(e){return{labels:"floating",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"8px",spacingGridColumn:"8px",spacingUnit:"4px",spacingTab:"4px",colorPrimary:e.text.primary,colorPrimaryText:e.text.primary,colorText:e.text.primary,colorTextSecondary:e.text.secondary,colorTextPlaceholder:e.text.tertiary,colorIcon:e.text.primary,colorIconCheckmark:e.icon.contrast,colorDanger:e.text.uiRedPrimary,colorBackground:e.whiteButtonBackground,colorIconTabHover:e.text.primary,colorIconTabSelected:e.text.uiBluePrimary,colorIconChevronDown:e.text.primary,fontFamily:m().Tf.sans,fontWeightLight:`${m().Wy.light}`,fontWeightNormal:`${m().Wy.regular}`,fontWeightMedium:`${m().Wy.medium}`,fontWeightBold:`${m().Wy.semibold}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"510",lineHeight:"16px",color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary},".Tab:focus":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:e.outlineBlueInputBoxShadow},".Tab--selected, .Tab--selected:hover, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:e.text.primary,boxShadow:"none",outline:"none"},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.outlineBlueInputBoxShadow},".Input":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",padding:"4px 8px",boxShadow:"none",backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,color:e.text.primary},".Input--invalid":{border:"none",color:e.text.primary,boxShadow:e.outlineRedInputBoxShadow},".Label":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",color:e.text.tertiary},".Label--floating":{fontSize:"10px",fontWeight:"510",lineHeight:"13px",letterSpacing:"0.12px",marginTop:"4px",transition:"all 200ms ease",color:e.text.secondary},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:e.text.uiRedPrimary},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary},".PickerItem:hover, .PickerItem--selected:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:e.text.primary},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:e.text.secondary,fontSize:"12px",fontWeight:"400",lineHeight:"15px"},".CheckboxLabel":{color:e.text.primary,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:e.text.primary,fontWeight:"400"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.outlineBlueInputBoxShadow},".MenuIcon, .MenuIcon:hover":{fill:e.text.primary},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary}}}}function A(e){const[t,n,r,o]=e.match(/[\d.]+/g)??[];return t&&n&&r&&o&&1===parseInt(o)?`rgb(${t}, ${n}, ${r})`:e}function C(e){return"stripeToken"===(null==e?void 0:e.type)?e.value:void 0}function B(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}},577038:(e,t,n)=>{n.d(t,{c:()=>r});const r=new(n(967203).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,818369)),a=await o.callApi({eventName:"getLegacyPriceInfo",environment:e,data:{spaceId:r},headers:(0,n(519423).WS)({cellId:void 0,spaceId:r})});if("success"===a.type)return a.data}))},649074:(e,t,n)=>{n.d(t,{DS:()=>o,Fe:()=>d,GB:()=>i,Gf:()=>u,V_:()=>l,j1:()=>c,j8:()=>a,yp:()=>p,yw:()=>s});var r=()=>n(647242);function o(e){return(0,r().Fq)({subscription:e})}function a(e){return(0,r().Ry)({subscription:e,trial:void 0})}function i(e){let{subscriptionState:t,logFunction:n,spaceId:o}=e;const a=m(t);return(0,r().yB)({billingData:{subscription:a,trial:void 0},logFunction:n,spaceId:o})}function s(e){return(0,r().q8)({subscription:e})}function c(e){return(0,r().V9)({subscription:m(e),trial:void 0})}function d(e){return(0,r().d$)({subscription:m(e),trial:void 0})}function l(e){return(0,r().ji)({subscription:m(e),trial:void 0})}function u(e){return(0,r().AI)({subscription:m(e),trial:void 0})}function p(e,t){return(0,r().KH)({subscription:m(e),trial:void 0},t)}function m(e){return e?{...e,trialEnd:void 0}:void 0}},678988:(e,t,n)=>{n.d(t,{HO:()=>m,V5:()=>c,Vr:()=>d,ef:()=>p,gL:()=>l,ng:()=>v,vH:()=>u,vk:()=>f,z2:()=>g});n(610931),n(112188),n(725707),n(491955),n(500234),n(403517),n(113085);var r=()=>n(141666),o=()=>n(647242),a=()=>n(649074),i=()=>n(216376),s=()=>n(455831);function c(e,t){return m(e.items,t.items).some((e=>{let[t,n]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const n=o().xp(e),r=o().xp(t);if(!n||!r)return!1;return s().o3[n]>s().o3[r]}(t,n)}))}function d(e,t,n){let{trialEnd:r,items:o}=t;return{trialEnd:r,items:o.map((t=>{const r=t.price.product,o=t.price.unitAmount.currencyCode,a=f(e,{interval:n,product:r,currency:o});return{...t,price:a}}))}}function l(e,t){const n=e.items.filter((e=>o().IE(e)!==t));return{...e,items:n}}function u(e,t,n){const{isMay13PackagingChangesEnabled:r}=n,a=o().IE(t),i=t.price.product,s=e.items.filter((e=>{const t=e.price.product,n=o().IE(e);return!(a===n)&&!(r&&"ai"===t&&("business"===i||"enterprise"===i))}));return{...e,items:s.concat([t])}}function p(e){const{state:t,prices:n,quantities:r,params:{interval:a,currency:i},products:s,flags:{isMay13PackagingChangesEnabled:c}}=e,d=s.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),l=d.map((e=>o().Mr(e))),u=t.items.filter((e=>{const t=e.price.product,n=o().IE(e),r=l.includes(n),a=c&&"ai"===t&&(d.includes("business")||d.includes("enterprise"));return!r&&!a})),p=d.map((e=>v(f(n,{interval:a,currency:i,product:e}),r)));return{...t,items:u.concat(p)}}function m(e,t){return(0,r().Z4)(e,(e=>o().IE(e)),t,(e=>o().IE(e)))}function g(e){const{prices:t,billingData:n,product:r}=e,i=o().Ry(n),s=o().lQ(n),c=a().yw(s),d=o().q8(n),l=c??d;return t.find((e=>e.product===r&&e.billingInterval===l&&e.unitAmount.currencyCode===i))}function f(e,t){let{interval:n,product:r,currency:o}=t;return function(e,t){if(null==e)throw new Error(t);return e}(e.find((e=>e.product===r&&e.billingInterval===n&&e.unitAmount.currencyCode===o)),`Unable to find price with interval: ${n}, product: ${r}, currency: ${o}`)}function v(e,t){const{numSeats:n,numCustomHostnames:r}=t;return"public_domain_custom_hostnames"===(0,i().vK)(e.product)?{price:e,quantity:r}:{price:e,quantity:n}}},685952:(e,t,n)=>{n.d(t,{A:()=>o});const r=new(n(967203).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,818369)),a=await o.callApi({eventName:"getInvoiceData",environment:e,data:{spaceId:r,type:"upcoming"}});return"success"===a.type?a.data.invoiceData:void 0}));n(996094).exposeDebugValue("UpcomingInvoiceStore",r);const o=r},855827:(e,t,n)=>{n.d(t,{A:()=>o});const r=new(n(967203).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{var r;let{spaceId:o}=t;if(null===(r=n(485966).default.state.currentSpaceStore)||void 0===r||!r.canAdmin())return;const a=await Promise.resolve().then(n.bind(n,818369)),i=await a.callApi({eventName:"getCustomerOffersReceived",environment:e,data:{spaceId:o},headers:(0,n(519423).WS)({cellId:void 0,spaceId:o})});return"success"===i.type&&(0,n(76394).EI)(i.data)?i.data:void 0}));n(996094).exposeDebugValue("OffersReceivedStore",r);const o=r},868224:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(129044))().default{getInitialState(){return{open:!1,succeeded:!1}}close(){this.setState({open:!1,succeeded:!1})}closeWithSuccess(){this.setState({open:!1,succeeded:!0})}open(e){this.setState({open:!0,temporaryBillingInterval:"month",temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},appliedPromo:void 0,error:void 0,vatApplicable:!1,calculatingTax:!1,payButtonState:"disabled",subscriptionTier:"enterprise",targetPlan:void 0,targetSpace:e,totalUpgradeCost:void 0,onlyShowAddOn:!1,sessionId:n(214144).JW(),type:n(172553).p.TargetSpace})}setAddressField(e){this.state.open&&this.setState({...this.state,temporaryAddress:{...this.state.temporaryAddress,...e},taxCalculationError:void 0})}}const o=new r},945857:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(129044))().default{getInitialState(){return{open:!1}}}const o=new r}}]);