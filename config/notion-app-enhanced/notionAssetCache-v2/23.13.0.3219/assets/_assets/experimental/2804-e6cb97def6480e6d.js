"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2804],{23633:(e,t,r)=>{r.d(t,{$O:()=>s,J5:()=>a,X9:()=>d,cP:()=>l});r(610931);var n=r(242343),o=r(163643);const i=(0,n.createContext)(null);i.displayName="WorkflowEditorContext";const a=(0,n.createContext)(!1);function s(){const e=(0,n.useContext)(i);(0,n.useContext)(a);if(!e)throw new Error("useWorkflowEditorContext must be used inside WorkflowEditorContextProvider");return e}function l(){return(0,n.useContext)(i)??void 0}a.displayName="DisallowWorkflowEditorContext";const d=n.memo((function(e){let{children:t,blockStore:r}=e;const a=(0,n.useMemo)((()=>({blockStore:r})),[r]);return(0,o.jsx)(i.Provider,{value:a,children:t})}))},200524:(e,t,r)=>{function n(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}r.d(t,{_:()=>n})},284208:(e,t,r)=>{r.d(t,{mA:()=>x});r(610931),r(333225),r(494367),r(516262),r(573119),r(240480),r(950443),r(619601),r(725707),r(491955);var n=()=>r(157316),o=()=>r(427091),i=()=>r(293665),a=()=>r(145017),s=()=>r(204132),l=()=>r(76394),d=()=>r(73631),c=()=>r(782422),u=()=>r(213517),p=()=>r(477784),m=()=>r(836331),g=()=>r(398222),y=()=>r(413871),f=()=>r(818369);const h=1e3;class _ extends Error{constructor(e,t){super(t),this.type=e}}class v extends _{constructor(){super("query_collection_limit_outside_range",`Query collection limit must be between 0 andÂ ${h}`)}}class b extends _{constructor(e){super("query_collection_failed",`Query collection failed: ${e.reason}`),this.data=e}}class w extends _{constructor(){super("query_collection_too_many_items","Query collection updating too many items")}}async function x(e,t){const{source:r,parentRecordStore:_,collectionPointer:x,filter:k,sort:S,limit:M}=t,I=M??h;if(I<0||I>h)return{error:new v};const C=y().md.createChildStore(_,x);await C.load();const A=C.getModel();if(!A)return{error:new b({reason:"no collection value"})};const P=C.getParentBlockStore();if(!P)return{error:new b({reason:"no collection parent"})};await P.load();const q=P.getCollectionViewStores()[0],E=q.getSpaceId();if(!q||!E)return{error:new b({reason:"no first collection view"})};const R="results",T={[R]:{type:"results",limit:I}},j=Object.keys(t.aggregations??{});for(const n of j){var U;if(n===R)return{error:new b({reason:`${R} is a reserved reducer keyword.`})};const e=null===(U=t.aggregations)||void 0===U?void 0:U[n];if(!e)return{error:new b({reason:`no aggregation provided for ${n}.`})};e&&(T[n]={type:"aggregation",aggregation:e})}const F=C.getSchema(),B={filter:k&&n().SK(k,F),sort:S&&n().g4(S,F),userId:e.currentUser.id,userTimeZone:(0,o().P)(),searchQuery:void 0,reducers:T},D=await f().callApi({eventName:"queryCollection",environment:e,data:{source:{type:"collection",id:x.id,spaceId:x.spaceId},collectionView:{id:q.id,spaceId:E},loader:B},tracking:{src:r}});if("failed"===D.type)return{error:new b({reason:"server query failed",cause:D.error})};const O=D.data.result.reducerResults[R];if(!O||"results"!==O.type)return{error:new b({reason:"unexpected server result"})};if(O.blockIds.length===h&&O.hasMore)return{error:new w};const{groupsReducerIds:$,reducerIdsWithNoGroupDependencies:W}=n().M(B.reducers,B.reducerDependencies),N=m().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs"),L=Date.now(),V=await d().T.formulas.load(),K={pageSort:[],schema:F,loader:B,userId:e.currentUser.id,userStartOfWeek:c().XX.state,currentTime:L,getRecordModel:_.getRecordModel,getRecordRole:_.getRecordRole,intl:p().A.getIntl(),isSorted:!1,visibleProperties:void 0,relativeVariableResult:null==D?void 0:D.data.relativeVariableResult,currentPageInRelatedCollection:void 0,isSprintPlanningView:!1,collectionSourceType:"collection",groupsReducerIds:$,reducerIdsWithNoGroupDependencies:W,formulaTimeoutMs:N,resultCache:new Map,regExpCache:new Map,experimentService:m().default,collectionFeatureGates:(0,u().i)(),formulasModule:V},G=n().zl(K);for(const o of O.blockIds){var H;const e=y().Bv.createChildStore(_,{table:a().ev,id:o}),t=null===(H=e.getAssociatedCollectionStore())||void 0===H?void 0:H.pointer;if(!(t&&i().L3.isEqualIdTable(t,C.pointer)))continue;const r=_.getRecordModel(e);r&&n().UC(r,A,K,G)}const z=g().A.getEditedBlocksForCollection(A.id),Q=new Set(O.blockIds);for(const o of z){if(Q.has(o))continue;const e=_.getRecordModel({table:a().ev,id:o});e&&n().UC(e,A,K,G)}const{result:Y}=n().Mo(K,G),X=n().uX({result:Y}),Z={};for(const o of j){var J;const e=n().VI({expectedAggregator:null===(J=t.aggregations)||void 0===J||null===(J=J[o])||void 0===J?void 0:J.aggregator,aggregationReducerResult:D.data.result.reducerResults[o]});if(s().Q.isFail(e)){const t="no aggregation provided"===e.error?`no aggregation provided for ${o}`:"unexpected response returned for aggregation"===e.error?`unexpected response returned for aggregation ${o}`:(0,l().HB)(e.error);return{error:new b({reason:t})}}Z[o]=e.value}return{value:{blockIds:X,...Z}}}},329912:(e,t,r)=>{r.d(t,{A:()=>g});r(725707),r(113085),r(242343);var n=()=>r(237385),o=()=>r(803290),i=()=>r(653998),a=()=>r(76394),s=()=>r(145046),l=()=>r(84543),d=()=>r(921706),c=()=>r(745859),u=()=>r(314164),p=()=>r(749975),m=r(163643);function g(){const e=(0,p().Ks)(),t=(0,n().v3)(),r=(0,o().K8)((()=>null==e?void 0:e.settingsStore),[e]);return function(n){if(!r||!n||!e)return;const o=e.collectionStore();if((0,a().O9)(o)){const e=u().KA({deletedSchema:o.getDeletedSchema(),property:n});if(e){var p;if("verification"===(null===(p=o.getDeletedSchema()[n])||void 0===p?void 0:p.type)){const e=o.getSchema(),t=Object.keys(e).some((t=>{var r;return"verification"===(null===(r=e[t])||void 0===r?void 0:r.type)}));if(t)return void s().ui({message:(0,m.jsx)(i().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:(0,m.jsx)(i().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}l().createAndCommit({userAction:"deletedPropertyMenu.handleRestoreDeletedPropertyClick",environment:t,canUndo:!0,perform:r=>{(0,c().F)({environment:t,collectionStore:o,update:e.updateSchema,transaction:r}),(0,d().E)({collectionStore:o,update:e.updateDeletedSchema,transaction:r})}})}}}}},441911:(e,t,r)=>{r.d(t,{e:()=>s,v:()=>a});var n=()=>r(237385),o=()=>r(803290),i=()=>r(640979);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:i().gu.ActionSheet}:{menuType:i().gu.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function s(e){const t=(0,n().Y0)();return(0,o().K8)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},713995:(e,t,r)=>{r.d(t,{l:()=>_,t:()=>v});r(610931);var n=r(242343),o=()=>r(237385),i=()=>r(803290),a=()=>r(711659),s=()=>r(76394),l=()=>r(84543),d=(r(725707),r(113085),()=>r(385649)),c=()=>r(975392),u=()=>r(413871);function p(e,t){var r,n;const o=null==e?void 0:e.getModel(),i=null==t?void 0:t.getModel();if(!t||!i)return!0;if(o&&(null===(r=o.getProperties())||void 0===r?void 0:r.name)!==(null===(n=i.getProperties())||void 0===n?void 0:n.name))return!0;return!(!o||o.getStatus()===i.getStatus())||(!!function(e,t){const r=null==e?void 0:e.getModel(),n=t.getModel();if(!n)return!0;if((0,s().O9)(r)){if(r.isEventType()&&n.isEventType()){const e=r.getEventConfiguration(),t=n.getEventConfiguration();return!(0,c().n4)(e,t)}if(r.isRecurrenceType()&&n.isRecurrenceType()){const e=r.getRecurrence(),t=n.getRecurrence();return!(0,c().n4)(e,t)}return!r.isButtonType()||!n.isButtonType()}if(n.isEventType()){const e=n.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(n.isRecurrenceType())return!0;if(n.isButtonType())return!1;(0,s().HB)(n)}(e,t)||!!function(e,t){const r=t.getSpaceId();if(!r)return!1;if((0,s().O9)(e)){const n=e.getActionIds(),o=t.getActionIds();return n.length!==o.length||!(0,c().n4)(n,o)||n.some((n=>{const o={id:n,spaceId:r,table:d().SC},i=u().bx.createChildStore(e,o).getModel(),a=u().bx.createChildStore(t,o).getModel();return!(0,s().O9)(i)||!(0,s().O9)(a)||!(0,c().n4)(i.getConfig(),a.getConfig())}))}return t.getActionIds().length>0}(e,t))}var m=()=>r(782422),g=()=>r(90875),y=()=>r(303862),f=()=>r(917008),h=()=>r(485966);function _(e){const t=new(g().Z)({deadlockTimeoutMs:l().DEADLOCK_WARNING_TIMEOUT_MS});return{performResult:e.perform(t),serverCommitResult:Promise.resolve(void 0)}}function v(e){const{automationId:t,spaceId:r,defaultValue:d,persist:c}=e,g=(0,o().v3)(),_=(0,i().K8)((()=>{var e;return null===(e=h().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),v=(0,n.useMemo)((()=>{if(t&&r)return{id:t,table:a().yB,spaceId:r}}),[t,r]),b=(0,y().l)("useUnpersistedAutomationStore",{cacheFallback:g.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),w=(0,n.useMemo)((()=>{if(!v)return;const e=b.getEntry({pointer:v,userId:_});if(!(0,s().O9)(e)&&_){if(!d)throw new Error("create is true but no defaultValue provided");b.setRecord({pointer:v,userId:_},{role:"editor",value:d})}return new(u().dn)(g,v,{inMemoryRecordCache:b})}),[d,g,v,b,_]),x=(0,i().K8)((()=>{const e=m().ao();if(v&&e)return u().dn.createChildStore(e,v)}),[v]),k=c?x:w,S=(0,i().K8)((()=>!c&&p(x,w)),[c,x,w]),{createAndCommit:M}=(0,f().D)({unpersistedInMemoryRecordCache:b}),I=(0,n.useCallback)((e=>c?l().createAndCommit({...e,canUndo:!0,environment:g}):M(e)),[M,g,c]);return{maybePersistedTransactionActions:{createAndCommit:I},maybePersistedAutomationStore:k,hasUnpersistedChanges:S}}},748039:(e,t,r)=>{r.d(t,{Is:()=>u,LS:()=>g,NH:()=>y,QA:()=>m,_b:()=>p});r(362833),r(333225),r(494367),r(516262),r(573119),r(240480),r(950443),r(619601);var n=()=>r(486826),o=(r(242343),()=>r(114103)),i=()=>r(16456),a=()=>r(653998),s=()=>r(200524),l=()=>r(76394),d=()=>r(378219),c=r(163643);function u(e){const t=d().g7(e)??[],r=[];for(const n of t){if(!("block"===n.table&&!0===n.isTemplate()&&n.getFormat().automation_id&&n.id!==e.id))continue;const t=n.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&r.push(t.getModel())}}return{automationStoresReady:!0,...(0,o().templateAncestorsViolateRecurrenceNesting)(r)}}function p(e){switch(e){case"day":return(0,c.jsx)(a().sA,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,c.jsx)(a().sA,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,c.jsx)(a().sA,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,c.jsx)(a().sA,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,l().HB)(e)}}function m(){return{start_date:n().c9.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,i().dB)(),hour:0,minute:0,frequency:"day",interval:1}}function g(e){const{recurrence:t,intl:r,leadingPhrase:n}=e;return(0,o().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===n)return"";if("every"===n)return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===n)return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,l().HB)(n);break;case"day":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":{const e=(null==t?void 0:t.weekdays)||[];return 5===e.length&&(0,s()._)(new Set(e),new Set(["MO","TU","WE","TH","FR"]))?r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weekday",defaultMessage:"weekday"}):r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"})}case"weeks":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return r.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function y(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},836471:(e,t,r)=>{r.d(t,{A:()=>u,v:()=>c});r(725707),r(491955);var n=r(242343),o=()=>r(237385),i=()=>r(803290),a=()=>r(137476),s=()=>r(271142),l=r(163643);const d=(0,n.createContext)({collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:r(713995).l},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[],collapsedActionIds:[],hideDragHandle:!1,cantSaveDueToError:!1,toggleActionIdCollapsed:()=>{}});function c(e){const t=(0,o().v3)(),{automationStore:r}=(0,s().EC)(),c=(0,i().K8)((()=>r.getActionIds()),[r]),[u,p]=(0,n.useReducer)(((e,n)=>{const o=e.includes(n);return(0,a().u4)({environment:t,event:{eventName:"automation_action_collapse_toggle",eventProperties:{collapsed:!o,automation_action_id:n,automation_id:r.id}}}),o?e.filter((e=>e!==n)):[...e,n]}),e.defaultCollapseActions?c:[]);return(0,l.jsx)(d.Provider,{value:{...e.value,collapsedActionIds:u,toggleActionIdCollapsed:p},children:e.children})}d.displayName="AutomationEditorContext";const u=d},842541:(e,t,r)=>{r.d(t,{H:()=>p,N:()=>u});r(725707),r(500234);var n=()=>r(803290),o=()=>r(934487),i=()=>r(39559),a=()=>r(442888),s=()=>r(312905),l=()=>r(321185),d=()=>r(485966),c=()=>r(23633);function u(){const{blockStore:e}=(0,c().$O)(),t=(0,l().useCurrentThreadStore)(),r=(0,n().K8)((()=>p({blockStore:e,threadStore:t})),[e,t]);return{blockStore:e,threadStore:t,...r}}function p(e){const{blockStore:t,threadStore:r}=e,{currentSpaceStore:n}=d().default.state;if(!n)return;if(r){var l;const e=(0,a().A3)({clientStore:s().Kd,threadStore:r}),i=(null==t?void 0:t.id)??(null===(l=e.find((e=>"context"===e.type)))||void 0===l||null===(l=l.value)||void 0===l?void 0:l.collectionViewBlockId);if(!i)return;const d=(0,o().rE)({transcript:e,appId:i,spaceId:n.id});if(d)return{workflowPointer:d.workflowModel.pointer,workflowValue:d.workflow}}const c=null==t?void 0:t.getWorkflowStore();return c?{workflowPointer:c.pointer,workflowValue:c.getData()??i().ZB}:void 0}},934487:(e,t,r)=>{r.d(t,{rE:()=>k});r(610931),r(362833),r(725707),r(491955),r(500234),r(403517);var n=()=>r(89646),o=()=>r(897376),i=()=>r(145017),a=()=>r(829629),s=()=>r(34662),l=()=>r(432590),d=()=>r(44250),c=()=>r(963002),u=(r(324989),()=>r(627618)),p=(r(875472),r(76509),r(863754),()=>r(3311));Error;class m extends Error{constructor(e){super(e),this.codeStack=void 0,this.codeSnippet=void 0,this.name="WorkflowError",Object.setPrototypeOf(this,m.prototype)}sentryErrorType(){return"runtime"}sentryExtra(){return{message:this.message,category:"error",level:"error",codeStack:this.codeStack,codeSnippet:this.codeSnippet}}sentryError(){return this}setCodeStack(e){this.codeStack=(e??"").split("\n").map((e=>e.trim())).join("\n").trim()}setCodeSnippet(e){if(!this.codeStack)return;const t=this.codeStack.split("\n").flatMap((e=>{if(!(e=e.trim()).startsWith("at "))return[];let t,r,n="<anonymous>";const o=e.match(/^at\s+([^:]+):(\d+)$/);if(o)return t=o[1],r=parseInt(o[2]),[{name:n,file:t,lineNumber:r}];const i=e.match(/^at\s+([^(]+)\s*\(([^)]+)\)$/);if(i){n=i[1].trim();const e=i[2].split(":");return t=e[0],r=e[1]?parseInt(e[1]):void 0,[{name:n,file:t,lineNumber:r}]}return[]})).filter((t=>{const r=e.find((e=>e.name===t.file));return(null==r?void 0:r.isUser)&&"number"==typeof t.lineNumber}));if(0===t.length)return;const r=[];for(const n of t){if("number"!=typeof n.lineNumber)throw new Error("Line number is not a number");const t=e.find((e=>e.name===n.file));if(!t)continue;const o=t.value.split("\n"),i=n.lineNumber,a=Math.max(0,i-5-1),s=Math.min(o.length,i+5-1);r.push(`<snippet at="${n.file}:${i}">`);for(let e=a;e<=s;e++){const t=e===i-1?">":" ",n=(e+1).toString().padStart(4),a=o[e];a&&r.push(`${t} ${n}| ${a}`)}r.push("</snippet>")}this.codeSnippet=r.join("\n")}render(){const e=[`<message>\n${(this.message||"Unknown error").trim()}\n</message>`,`<stack-trace>\n${this.codeStack}\n</stack-trace>`],t=this.codeSnippet;return t&&(e.push("<code-snippets>"),e.push(t),e.push("</code-snippets>")),e.join("\n")}}class g extends m{constructor(e,t){const{isSystemError:r,debugMessage:n,cause:o,extra:i}=t??{};super(e),this.module=void 0,this.debugMessage=void 0,this.isSystemError=void 0,this.extra=void 0,this.cause=void 0,this.name="WorkflowModuleError",this.isSystemError=r??!1,this.debugMessage=n,this.cause=o,this.extra=i,this.isSystemError&&o instanceof Error&&(this.stack=o.stack),Object.setPrototypeOf(this,g.prototype)}sentryErrorType(){return this.isSystemError?"module_system_error":"runtime"}sentryError(){return this.isSystemError&&this.cause instanceof Error?this.cause:this}sentryExtra(){let e=this.debugMessage??this.message;return this.cause instanceof Error&&(e=this.cause.message),{module:this.module,message:e,debugMessage:this.debugMessage,isSystemError:this.isSystemError,cause:this.cause,codeStack:this.codeStack,codeSnippet:this.codeSnippet,...this.extra}}getInternalMessage(e){if("local"===e||"development"===e)return this.stack??void 0}static wrap(e){return new g(e.message,{cause:e})}}const y="://",f="-";function h(e){if(e.prefix.includes(y))throw new g(`Prefix ${e.prefix} cannot include a "${y}"`,{isSystemError:!0});const t=`${e.prefix}${y}`;return e.id.startsWith(t)?e.id:`${t}${e.id}`}function _(e){const{prefix:t,id:r,originModule:n}=e,o=`${t}${f}`;if(r.startsWith(o))return r.slice(o.length);const i=`${t}${y}`;if(!r.startsWith(i)){const e=r.split(y)[0],o=r.includes(y)?` Instead it appears to be a ${e} id.`:` It appears to be malformed and without the ${t} prefix.`;throw new g(`Id ${r} is not a ${t} id.${o}${n?` Ensure that the id comes from the ${n} module.`:""}`)}return r.slice(i.length)}const v={slackUser:{type:"slackUser",parseUri:e=>new Error("Not implemented"),getUri:e=>h({prefix:"slackUser",id:e.id}),parseUrlToUri:()=>{}},slackMessage:{type:"slackMessage",parseUri:e=>new Error("Not implemented"),getUri:e=>h({prefix:"slackMessage",id:e.id}),parseUrlToUri:()=>{}},slackChannel:{type:"slackChannel",parseUri:e=>new Error("Not implemented"),getUri:e=>h({prefix:"slackChannel",id:e.id}),parseUrlToUri:()=>{}}};r(595257).y;function b(e,t){const r=e.lastIndexOf(t);return-1===r?{processedUrl:e}:{processedUrl:e.substring(0,r),segment:e.substring(r+1)}}function w(e){const{processedUrl:t,segment:r}=b(e,"#");let n=r;n&&(0,p().c_)(n)&&(n=(0,p().np)(n));let{segment:o}=b(t,"/");if(o&&(0,p().c_)(o)&&(o=(0,p().np)(o)),!o||!(0,p().uj)(o)||n&&!(0,p().uj)(n))throw new Error(`Invalid page or app URL: ${e}`);return{pageOrAppId:o,blockId:n}}u().union([u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0}),u().object({required:{operator:u().literals("string_contains","string_does_not_contain","string_ends_with","string_is","string_is_not","string_starts_with"),value:u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})},optional:{},exact:!0})]),u().union([u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0}),u().object({required:{operator:u().literals("number_does_not_equal","number_equals","number_greater_than","number_greater_than_or_equal_to","number_less_than","number_less_than_or_equal_to"),value:u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().number()])},optional:{},exact:!0})},optional:{},exact:!0})]),u().union([u().object({required:{operator:u().literals("date_is","date_is_after","date_is_before","date_is_on_or_after","date_is_on_or_before"),value:u().lazy((()=>x))},optional:{use_end:u().boolean()},exact:!0}),u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0})]);const x=u().union([u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0}),u().object({required:{type:u().literal("relative"),value:u().literals("one_month_ago","one_month_from_now","one_week_ago","one_week_from_now","today","tomorrow","yesterday")},optional:{},exact:!0})]);u().union([u().object({required:{operator:u().literals("enum_is","enum_is_not"),value:u().union([u().array(u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})),u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})])},optional:{},exact:!0}),u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0})]),u().union([u().object({required:{operator:u().literals("enum_contains","enum_does_not_contain"),value:u().union([u().array(u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})),u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})])},optional:{},exact:!0}),u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0})]),u().object({required:{operator:u().literals("checkbox_is","checkbox_is_not"),value:u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().literal(!1),u().literal(!0)])},optional:{},exact:!0})},optional:{},exact:!0}),u().union([u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0}),u().object({required:{operator:u().literals("relation_contains","relation_does_not_contain"),value:u().union([u().array(u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})),u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})])},optional:{},exact:!0})]),u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0}),u().union([u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0}),u().object({required:{operator:u().literals("status_is","status_is_not"),value:u().union([u().array(u().object({required:{type:u().literals("is_group","is_option"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})),u().object({required:{type:u().literals("is_group","is_option"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0})])},optional:{},exact:!0})]),u().union([u().object({required:{operator:u().literals("is_empty","is_not_empty")},optional:{},exact:!0}),u().object({required:{operator:u().literals("person_contains","person_does_not_contain"),value:u().union([u().array(u().union([u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0}),u().object({required:{type:u().literal("relative"),value:u().literal("me")},optional:{},exact:!0})])),u().object({required:{type:u().literal("exact"),value:u().union([u().isUndefined(),u().string()])},optional:{},exact:!0}),u().object({required:{type:u().literal("relative"),value:u().literal("me")},optional:{},exact:!0})])},optional:{},exact:!0})]),'\nIn addition to action: "update", key, name, and type, you must provide additional properties in order to match one of the following UpdateView types:\n\n// Defines how to filter items in a view. Can be nested.\nFilter = {\n\toperator: "and" | "or",\n\tfilters: Array<PropertyFilter | Filter>\n}\n\n// Defines how to filter by a specific property.\nPropertyFilter = {\n\tproperty: string,\n\tfilter: TextFilter | NumberFilter | DateFilter | SelectFilter | MultiSelectFilter | CheckboxFilter | RelationFilter | FileFilter | StatusFilter | PersonFilter\n}\n\n// Defines how to filter text properties.\nTextFilter = {\n\toperator: "string_is" | "string_is_not" | "string_contains" | "string_does_not_contain" | "string_starts_with" | "string_ends_with",\n\tvalue: { type: "exact", value: string | undefined }\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter number properties.\nNumberFilter = {\n\toperator: "number_equals" | "number_does_not_equal" | "number_greater_than" | "number_less_than" | "number_greater_than_or_equal_to" | "number_less_than_or_equal_to",\n\tvalue: { type: "exact", value: number | undefined }\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter date properties.\nDateFilter = {\n\toperator: "date_is" | "date_is_before" | "date_is_after" | "date_is_on_or_before" | "date_is_on_or_after",\n\tvalue:\n\t\t| { type: "exact", value: string | undefined } // ISO 8601 date string\n\t\t| { type: "relative", value: "today" | "tomorrow" | "yesterday" | "one_week_ago" | "one_week_from_now" | "one_month_ago" | "one_month_from_now" },\n\tuse_end?: boolean\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter select properties.\nSelectFilter = {\n\toperator: "enum_is" | "enum_is_not",\n\tvalue: { type: "exact", value: string | undefined } | Array<{ type: "exact", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter multi-select properties.\nMultiSelectFilter = {\n\toperator: "enum_contains" | "enum_does_not_contain",\n\tvalue: { type: "exact", value: string | undefined } | Array<{ type: "exact", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter checkbox properties.\nCheckboxFilter = {\n\toperator: "checkbox_is" | "checkbox_is_not",\n\tvalue: { type: "exact", value: boolean | undefined }\n}\n\n// Defines how to filter relation properties.\nRelationFilter = {\n\toperator: "relation_contains" | "relation_does_not_contain",\n\tvalue: { type: "exact", value: string | undefined } | Array<{ type: "exact", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter file properties.\nFileFilter = {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter status properties.\nStatusFilter = {\n\toperator: "status_is" | "status_is_not",\n\tvalue: { type: "is_group" | "is_option", value: string | undefined } | Array<{ type: "is_group" | "is_option", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter person properties.\nPersonFilter = {\n\toperator: "person_contains" | "person_does_not_contain",\n\tvalue: { type: "exact", value: string | undefined } | { type: "relative", value: "me" } | Array<{ type: "exact", value: string | undefined } | { type: "relative", value: "me" }> // String values are Notion user IDs\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to sort items in a view.\nSort = {\n\t// Must be a valid property from the database schema that is not content.\n\tproperty: string,\n\tdirection: "ascending" | "descending"\n}\n\n// Defines how to group items in a view.\nGroupBy = {\n\tproperty: string,\n\thideEmptyGroups?: boolean\n} & (\n\t{\n\t\ttype: "title" | "text" | "url" | "email" | "phone_number",\n\t\tgroupBy: "exact" | "alphabet_prefix",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "number",\n\t\tgroupBy?: { type: "unique", start?: number, end?: number },\n\t\tstart: number,\n\t\tend: number,\n\t\tsize: number,\n\t\tsort: "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "date" | "created_time" | "last_edited_time",\n\t\tgroupBy: "relative" | "day" | "week" | "month" | "year",\n\t\tsort: "ascending" | "descending",\n\t\tstartDayOfWeek?: 0 | 1\n\t} |\n\t{\n\t\ttype: "select" | "multi_select",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "status",\n\t\tgroupBy: "group" | "option",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "person",\n\t\tsort: "manual"\n\t} |\n\t{\n\t\ttype: "relation",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "checkbox",\n\t\tsort: "manual"\n\t}\n)\n\n// Defines how to show a cover image on each card.\nCoverType =\n\t| { type: "page_cover" }\n\t| { type: "page_content" }\n\t// property must only be of type file\n\t| { type: "property"; property: string }\n\nCardSize = "small" | "medium" | "large"\nCoverAspectRatio = "contain" | "cover"\n\n// Each updated view must match one of the following types:\nUpdateView = {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "table",\n\tdatabaseUrl: string,\n\t// Properties from the database schema that should be shown as columns, excluding content type. Must include the title property.\n\tcolumns: Array<string>,\n\t// Optional property to group rows by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "board",\n\tdatabaseUrl: string,\n\t// Required property to group cards by, must be a valid property from schema that is not content.\n\tgroupBy: GroupBy,\n\t// Properties to show on cards, excluding content. Must include the title property.\n\tcardProperties: Array<string>,\n\t// Optional secondary grouping property, must be a valid property from schema that is not content.\n\tsubGroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n\tcover?: CoverType\n\tcardSize?: CardSize\n\tcoverAspect?: CoverAspectRatio\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "calendar",\n\tdatabaseUrl: string,\n\t// Required date property to use for calendar view (must be date, created_time, or last_edited_time).\n\tcalendarBy: string,\n\t// Optional properties to show on cards, excluding content and title.\n\tcardAdditionalProperties?: Array<string>,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n\t// Optional property to show days by month or week.\n\tviewRange?: "month" | "week"\n\t// Optional property to show weekends in the calendar.\n\tshowWeekends?: boolean\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "list",\n\tdatabaseUrl: string,\n\t// Properties to show for each item, excluding content type. Must include the title property.\n\trowProperties: Array<string>,\n\t// Optional property to group items by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "gallery",\n\tdatabaseUrl: string,\n\t// Properties to show on cards, excluding content. Must include the title property.\n\tcardProperties: Array<string>,\n\t// Optional property to group cards by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n\tcover?: CoverType\n\tcardSize?: CardSize\n\tcoverAspect?: CoverAspectRatio\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "timeline",\n\tdatabaseUrl: string,\n\t// Required date property to use for timeline start (must be date, created_time, or last_edited_time).\n\ttimelineBy: string,\n\t// Optional date property to use for timeline end (must be date, created_time, or last_edited_time).\n\ttimelineByEnd?: string,\n\t// Properties to show on cards, excluding content. Must include the title property.\n\trowProperties: Array<string>,\n\t// Optional property to group items by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n\t// Optional property to show a table of titles next to the timeline.\n\tshowTable?: boolean\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "chat"\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "custom"\n}\n'.trim();function k(e){const{transcript:t,spaceId:r,appId:n,additionalThreadOperations:s}=e,l=(0,o().YO)({transcript:t,additionalThreadOperations:s}),d=function(e){var t;const{recordMap:r,appId:n,spaceId:o}=e,s={table:i().ev,id:n,spaceId:o},l=r.getModel(s),d=null==l||null===(t=l.getFormat())||void 0===t?void 0:t.workflow_id;if(!d)return;const c={table:a().C0,id:d,spaceId:o},u=r.getModel(c),p=null==u?void 0:u.getData();if(!p||!u)return;return{workflow:S({workflow:p,recordMap:r,appId:n,spaceId:o}),workflowModel:u,appModel:l}}({recordMap:l,appId:n,spaceId:r});if(d)return{...d,recordMap:l}}function S(e){const{appId:t,spaceId:r,workflow:n,recordMap:o}=e,a={id:t,table:i().ev,spaceId:r},s=o.getModel(a);if(!s)throw new Error(`App not found: ${t}`);const l=n.modules??[],d=[...l.filter((e=>"database"!==e.type)),...M({appModel:s,recordMap:o,existingDatabaseModules:l.filter((e=>"database"===e.type))})];return{...n,modules:d}}function M(e){const{appModel:t,recordMap:r,existingDatabaseModules:n}=e,o=[];for(const i of t.getCollectionPointers()){const e=r.getModel(i);if(!e)continue;const t=n.find((e=>{var t;return(null===(t=(0,d().DK)(e.state))||void 0===t||null===(t=t.pointer)||void 0===t?void 0:t.id)===i.id}));if(t){const r={...t.state,collection:e.__IM_SORRY__getValue(),propertyKeyToIdMap:(0,l().jL)(e.getSchema())};o.push({...t,state:r})}else o.push(I(e))}return o}function I(e){const t=(0,s().q4_)(e.getNormalizedName());return{type:"database",key:(0,n().L)(t),name:t,version:c().Nh.database.latestVersion,state:{collection:e.__IM_SORRY__getValue(),propertyKeyToIdMap:(0,l().jL)(e.getSchema()),pointer:e.getSpaceShardedPointer(),accessScope:"write"}}}}}]);