"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[45666],{130486:(e,t,a)=>{a.d(t,{l:()=>l});var s=()=>a(803290),r=()=>a(905184),i=()=>a(321185),n=()=>a(485966),o=()=>a(413871);function l(e){const{threadId:t}=e,a=(0,s().O$)(n().AppStoreCurrentSpaceStore);if(a&&t&&t!==i().NEW_CHAT_THREAD_ID)return o().Ei.createChildStore(a,{table:r().To,id:t,spaceId:a.id})}},312905:(e,t,a)=>{a.d(t,{Kd:()=>l});var s=()=>a(129044);a(725707),a(491955);const r={acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,stopInferencePromise:void 0,temporarySteps:[],inferences:[],traceId:void 0,requestInfo:void 0,loading:!1,stagedData:{}};class i extends s().default{getInitialState(){return r}resetState(){var e;null===(e=this.state.abortController)||void 0===e||e.abort(),this.setState(r)}getTemporaryAttachmentStagedDataOrInstantiate(){const e=this.state.stagedData;if(null!=e&&e.attachmentStagedData)return e.attachmentStagedData;const t={stagedAttachmentUploadStore:new(a(513124).G),stagedClientSteps:[],stagedEngineSteps:[],stagedInferenceTranscriptSteps:[]};return this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:t}}),t}getStagedAttachmentUploadStoreIfExists(){var e;const t=this.state.stagedData;return null==t||null===(e=t.attachmentStagedData)||void 0===e?void 0:e.stagedAttachmentUploadStore}stageAttachmentInferenceTranscriptStep(e){const{step:t}=e,a=this.getTemporaryAttachmentStagedDataOrInstantiate(),s={...a,stagedInferenceTranscriptSteps:[...a.stagedInferenceTranscriptSteps,t]};this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:s}})}unstageAttachmentInferenceTranscriptStep(e){var t;const{fileId:a}=e,s=null===(t=this.state.stagedData)||void 0===t?void 0:t.attachmentStagedData;if(!s)return;const r=s.stagedInferenceTranscriptSteps.filter((e=>"attachment"!==e.type||e.fileUrl!==a));this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:{...s,stagedInferenceTranscriptSteps:r}}})}getAndClearStagedAssistantAttachmentSteps(){var e;const t=null===(e=this.state.stagedData)||void 0===e?void 0:e.attachmentStagedData;if(!t)return;const{stagedInferenceTranscriptSteps:a}=t;return this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:void 0}}),a}}const n={type:"search",scopeForNextSearch:{type:"everything"}};class o extends s().default{getInitialState(){const e=a(470637).A.withListenerIgnored((()=>a(836331).default.checkGate({gateName:"workflows_inference_replay"})));return{showHistory:!1,showDebug:!1,loading:!1,configForNewTranscripts:n,userSelectedConfig:void 0,agentModelConfig:void 0,persistStrategy:"manual",model:void 0,debugOverrides:{usePromptCache:e?"s3":void 0},threadRegistry:{},isAIChatTranscriptSidePanelVisible:!1,threadToStagedData:{}}}getOrCreateClientAIChatThreadStore(e){if(!this.state.threadRegistry[e]){const t=new i;return this.setState({...this.state,threadRegistry:{...this.state.threadRegistry,[e]:t}}),t}return this.state.threadRegistry[e]}}const l=new o;(0,a(996094).exposeDebugValue)("clientAiChatStore",l)},513124:(e,t,a)=>{a.d(t,{G:()=>s});a(725707),a(491955);class s extends(()=>a(129044))().default{getInitialState(){return{originalFileUrlToSuccessfullyUploadedFiles:new Map,inProgressUploadFileIdsToProgress:new Map}}setValueForUploadedFile(e,t){this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles).set(e,t)})}setValueForUploadingFile(e,t){const a=new Map(this.state.inProgressUploadFileIdsToProgress);a.set(e,t),this.setState({...this.state,inProgressUploadFileIdsToProgress:a})}deleteValueForUploadingFile(e){const t=new Map(this.state.inProgressUploadFileIdsToProgress);t.delete(e),this.setState({...this.state,inProgressUploadFileIdsToProgress:t})}deleteValueForUploadedFile(e){const t=new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles);t.delete(e),this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:t})}onFileUploadPercentageChanged(e){const{fileId:t,fileName:a,percentage:s,contentType:r}=e;this.setValueForUploadingFile(t,{type:"uploading",fileName:a,progress:s,contentType:r})}onFileUploadFailed(e){const{error:t}=e,{fileId:a,fileName:s}=t;this.setValueForUploadingFile(a,{type:"error",error:t,fileName:s})}onFileUploadCompleted(e,t){this.deleteValueForUploadingFile(e),this.setValueForUploadedFile(t.originalFileUrl,t)}setCompletedFileForRetry(e){this.setValueForUploadedFile(e.originalFileUrl,e)}onDeleteFileUpload(e){this.deleteValueForUploadedFile(e)}isUploadInProgress(){return Array.from(this.state.inProgressUploadFileIdsToProgress.values()).filter((e=>"error"!==e.type)).length>0}doesCurrentChatHaveUpload(){return this.isUploadInProgress()||this.state.originalFileUrlToSuccessfullyUploadedFiles.size>0}}},555434:(e,t,a)=>{a.d(t,{Y:()=>r});var s=()=>a(803290);function r(e){return(0,s().K8)((()=>null==e?void 0:e.getWorkflowStore()),[e])}},685332:(e,t,a)=>{a.r(t),a.d(t,{ChatCollectionView:()=>u});var s=a(242343),r=()=>a(803290),i=()=>a(174114),n=()=>a(375589),o=()=>a(130486),l=()=>a(312905),d=()=>a(393728),c=()=>a(997310),g=()=>a(308265),h=()=>a(555434),p=a(163643);function u(e){const{collectionViewStore:t,paddingLeft:a,paddingRight:u,collectionContextStore:S}=e,f=(0,i().IS)((e=>({container:{paddingLeft:a??0,paddingRight:u??0}})),[a,u]),F=(0,r().K8)((()=>(0,g().sx)()),[]),[U,I]=(0,s.useState)(void 0),T=(0,s.useCallback)((e=>{I(null==e?void 0:e.id)}),[]),y=(0,r().K8)((()=>S.collectionViewBlockStore()),[S]),v=(0,h().Y)(y),m=(0,c().r)(),D=(0,r().K8)((()=>{var e;if(!v||!y)return;if(!v.getData())return;const a=null===(e=t.getModel())||void 0===e?void 0:e.getAgentKey();if(!a)return;return{type:"workflow",agentKey:a,workflowBlockId:y.id}}),[v,t,y]),C=(0,o().l)({threadId:U});return D&&F&&y&&m?(0,p.jsx)("div",{style:f.container,children:(0,p.jsx)(d().hP,{surface:d().wy.inferenceTranscriptChatView,children:(0,p.jsx)(n().NV,{aiChatFeature:"app_builder",threadStore:C,config:D,onThreadChange:T,clientStore:l().Kd,parentStore:m})})}):null}}}]);