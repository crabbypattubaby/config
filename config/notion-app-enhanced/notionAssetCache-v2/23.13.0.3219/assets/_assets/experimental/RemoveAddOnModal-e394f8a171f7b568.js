"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51466],{678988:(e,n,t)=>{t.d(n,{HO:()=>f,V5:()=>u,Vr:()=>c,ef:()=>p,gL:()=>d,ng:()=>y,vH:()=>l,vk:()=>g,z2:()=>m});t(610931),t(112188),t(725707),t(491955),t(500234),t(403517),t(113085);var r=()=>t(141666),o=()=>t(647242),i=()=>t(649074),a=()=>t(216376),s=()=>t(455831);function u(e,n){return f(e.items,n.items).some((e=>{let[n,t]=e;return function(e,n){if(!e)return!1;if(!n)return!0;const t=o().xp(e),r=o().xp(n);if(!t||!r)return!1;return s().o3[t]>s().o3[r]}(n,t)}))}function c(e,n,t){let{trialEnd:r,items:o}=n;return{trialEnd:r,items:o.map((n=>{const r=n.price.product,o=n.price.unitAmount.currencyCode,i=g(e,{interval:t,product:r,currency:o});return{...n,price:i}}))}}function d(e,n){const t=e.items.filter((e=>o().IE(e)!==n));return{...e,items:t}}function l(e,n,t){const{isMay13PackagingChangesEnabled:r}=t,i=o().IE(n),a=n.price.product,s=e.items.filter((e=>{const n=e.price.product,t=o().IE(e);return!(i===t)&&!(r&&"ai"===n&&("business"===a||"enterprise"===a))}));return{...e,items:s.concat([n])}}function p(e){const{state:n,prices:t,quantities:r,params:{interval:i,currency:a},products:s,flags:{isMay13PackagingChangesEnabled:u}}=e,c=s.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),d=c.map((e=>o().Mr(e))),l=n.items.filter((e=>{const n=e.price.product,t=o().IE(e),r=d.includes(t),i=u&&"ai"===n&&(c.includes("business")||c.includes("enterprise"));return!r&&!i})),p=c.map((e=>y(g(t,{interval:i,currency:a,product:e}),r)));return{...n,items:l.concat(p)}}function f(e,n){return(0,r().Z4)(e,(e=>o().IE(e)),n,(e=>o().IE(e)))}function m(e){const{prices:n,billingData:t,product:r}=e,a=o().Ry(t),s=o().lQ(t),u=i().yw(s),c=o().q8(t),d=u??c;return n.find((e=>e.product===r&&e.billingInterval===d&&e.unitAmount.currencyCode===a))}function g(e,n){let{interval:t,product:r,currency:o}=n;return function(e,n){if(null==e)throw new Error(n);return e}(e.find((e=>e.product===r&&e.billingInterval===t&&e.unitAmount.currencyCode===o)),`Unable to find price with interval: ${t}, product: ${r}, currency: ${o}`)}function y(e,n){const{numSeats:t,numCustomHostnames:r}=n;return"public_domain_custom_hostnames"===(0,a().vK)(e.product)?{price:e,quantity:r}:{price:e,quantity:t}}},923948:(e,n,t)=>{t.r(n),t.d(n,{RemoveAddOnModal:()=>C});t(610931);var r=t(242343),o=()=>t(16791),i=()=>t(237385),a=()=>t(803290),s=()=>t(846581),u=()=>t(214144),c=()=>t(647242),d=()=>t(649074),l=()=>t(678988),p=()=>t(331863),f=()=>t(395665),m=()=>t(653998),g=()=>t(975392),y=()=>t(421650),h=()=>t(575015),v=()=>t(997310),_=()=>t(104838),b=()=>t(384055),w=()=>t(613313),I=()=>t(159448),S=()=>t(875500),x=()=>t(469461),E=()=>t(795266),A=t(163643);function C(e){let{currentPeriodEnd:n,isOpen:t,onClose:g}=e;const S=(0,i().v3)(),[C,T]=r.useState("survey"),[k,V]=r.useState({reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[j,M]=r.useState(void 0),[R]=r.useState(u().JW()),B=(0,a().K8)((()=>(0,w().Le)()),[]);(0,r.useEffect)((()=>y().u4(S,{name:"churn_survey",args:{churnType:"ai",reasons:k.reasons,reasonOther:k.reasonOther,reasonOtherTools:k.reasonOtherTools,stage:C,churnSurveyId:R}})),[S,C,k,R]);const P=(0,v().r)(),q=Boolean((0,a().K8)((()=>null==P?void 0:P.canAdmin()),[P])),D=(0,I().lh)({spaceId:null==P?void 0:P.id}),Q=(0,a().K8)((()=>(0,c().Rz)(D)),[D]),K=(0,c().qd)({billingData:D,canUpdateBilling:q}),L=n?(0,s().W_)(n,"long",o().locale):void 0,U=r.useCallback((()=>{y().u4(S,{name:"churn_survey_close",args:{churnSurveyId:R}}),g()}),[R,S,g]);return(0,A.jsx)(E().W,{step:C,isOpen:t,onClose:U,children:(()=>{switch(C){case"survey":return(0,A.jsx)(x().lU,{options:O(),onSubmit:async e=>{y().u4(S,{name:"churn_survey_submitted",args:{churnType:"ai",reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0,stage:C,churnSurveyId:R}}),V((n=>({...n,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0})));const n=await b().z6(S,{spaceId:null==P?void 0:P.id,offerCampaign:"ai_fifty_percent_downgrade"}),t=(0,p().RS)(n);return t&&(0,f().J5)(t)?(M(t),void T("offer")):T("downgrade")}});case"offer":return j?(0,A.jsx)(x().hL,{currentProduct:"ai",currentSubscriptionTier:(0,c().AI)(D),secondaryButtonMessage:(0,A.jsx)(m().sA,{id:"removeAddOnModal.cancelAnyway",defaultMessage:"Cancel anyway"}),newProduct:"free",coupon:j,onSubmit:async e=>{if(e){y().u4(S,{name:"offer_accepted",args:{coupon:j}});const e=null==P?void 0:P.id;if(Q&&e&&K&&(0,f().J5)(j))return(0,w().S7)()?await b().VY({environment:S,spaceId:e,offerCampaign:"ai_fifty_percent_downgrade",entrypoint:"ai_downgrade_flow"}):await b().Qm(S,{customerId:Q,coupon:j,offerType:"add_on_downgrade_flow"}),U(),void h().D6({label:(0,A.jsx)(m().sA,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})}T("downgrade")}}):void T("downgrade");case"downgrade":return(0,A.jsx)(x().kv,{title:(0,A.jsx)(m().sA,{id:"addOnCancellationStep.cancellation.title",defaultMessage:"Remove AI at the end of your billing period?"}),description:L?(0,A.jsx)(m().sA,{id:"addOnCancellationStep.cancellation.description",defaultMessage:"If you continue with the downgrade, you will continue to enjoy Notion AI until the end of your billing period on <bold>{periodEnd}</bold>. You can resubscribe anytime.",values:{periodEnd:L,bold:e=>(0,A.jsx)("b",{children:e})}}):null,onSubmit:async()=>{if(y().u4(S,{name:"continue_downgrade_button_clicked"}),D&&P){const e=(0,c().lQ)(D),n=(0,l().gL)(e,"ai");await(0,_().nV)({environment:S,spaceStore:P,from:"billing_page",desiredState:n})}T("confirmation")},may13PackagingChangesEnabled:B});case"confirmation":if(D){const e=(0,c().lQ)(D);if(Boolean((0,d().yp)(e,"ai")))throw new Error("Notion AI is not cancelled or scheduled to be cancelled")}return(0,A.jsx)(x().Qe,{title:(0,A.jsx)(m().sA,{id:"downgradeFlow.confirmationStep.ai.title",defaultMessage:"Notion AI has been removed"}),formattedPeriodEndDate:L})}})()})}function O(){return[...(0,g().k4)([S().V.tooExpensive,S().V.missingFeatures,S().V.upgradedByMistake,S().V.tooDifficult,S().V.notUsingEnough,S().V.qualityOfResults,S().V.usingAnotherAiService,S().V.dataSecurity]),S().V.other]}}}]);