"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[10815],{34816:(e,t,n)=>{n.d(t,{H4:()=>a().H,_7:()=>r()._});var a=()=>n(614893),r=()=>n(713628)},179140:(e,t,n)=>{n.r(t),n.d(t,{DowngradeModal:()=>oe});n(610931),n(403517);var a=n(242343),r=()=>n(16791),o=()=>n(237385),s=()=>n(803290),i=()=>n(174114),d=()=>n(846581),l=()=>n(214144),u=()=>n(647242),c=()=>n(649074),p=()=>n(331863),m=()=>n(395665),g=()=>n(216376),f=()=>n(455831),v=()=>n(653998),h=()=>n(975392),w=()=>n(421650),S=()=>n(575015),y=()=>n(701270),b=()=>n(829090),x=()=>n(484157),I=()=>n(421338),_=()=>n(209684),D=()=>n(529305),M=()=>n(286404),C=n(163643);function P(e){const{downgradeProduct:t,excessGuests:n,formattedPeriodEndDate:a,internalDomains:r,spaceStore:o,onClickContinue:i,onClickManageGuests:d}=e,l=(0,v().tz)(),u=(0,s().K8)((()=>o.getName()),[o]),c=l.formatMessage(T[t]);return u&&n.length?(0,C.jsx)(D().tf,{header:(0,C.jsx)(D().YA,{iconAndTitle:(0,C.jsx)(D().ZQ,{iconGroup:x().F,iconColorName:"redPrimary",title:l.formatMessage(G.title,{planName:c,spaceName:u})}),description:l.formatMessage(G.description,{domain:r[0].url,number:n.length,date:a})}),footer:(0,C.jsx)(N,{onClickContinue:i,onClickManageGuests:d}),children:(0,C.jsx)(k,{excessGuests:n,spaceName:u})}):null}function k(e){const{excessGuests:t,spaceName:n}=e,a=(0,v().tz)(),r=(0,i().IS)((()=>({wrapper:{background:"#FDF5F3",textAlign:"center"}})),[]),o=(0,s().K8)((()=>t.map((e=>e.getKeyStore("given_name").getValue()??e.getDisplayName(a)))),[t,a]);return(0,C.jsx)(I().Y1,{align:"top-center",borderRadius:6,direction:"vertical",gap:10,padding:"14px 12px",style:r.wrapper,width:"fill",children:(0,C.jsxs)(I().Y1,{direction:"vertical",gap:8,align:"top-center",children:[(0,C.jsx)(I().Y1,{direction:"horizontal",align:"center",style:{paddingLeft:4},children:o.slice(0,3).map(((e,t)=>(0,C.jsx)(R,{givenName:e},t)))}),(0,C.jsxs)(I().Y1,{direction:"vertical",gap:4,align:"center",children:[(0,C.jsx)(y().D,{colorName:"uiRedPrimary",styleName:"Body-14px/Medium",children:(0,C.jsx)(j,{givenNames:o,spaceName:n})}),(0,C.jsx)(y().D,{colorName:"redPrimary",styleName:"Caption-12px/Regular",children:a.formatMessage(G.recommendation)})]})]})})}function j(e){const{givenNames:t,spaceName:n}=e,a=(0,v().tz)();return 1===t.length?(0,C.jsx)(C.Fragment,{children:a.formatMessage(G.oneRemovedGuest,{name1:t[0],spaceName:n})}):2===t.length?(0,C.jsx)(C.Fragment,{children:a.formatMessage(G.twoRemovedGuests,{name1:t[0],name2:t[1],spaceName:n})}):(0,C.jsx)(C.Fragment,{children:a.formatMessage(G.manyRemovedGuests,{name1:t[0],name2:t[1],count:t.length-2,spaceName:n})})}function R(e){const{givenName:t}=e,n=(0,i().IS)((e=>({circle:{borderRadius:14,border:`1px dashed ${e.stroke.uiRedSecondary}`,background:e.surface.elevated,marginLeft:-4}})),[]);return(0,C.jsx)(I().Y1,{style:n.circle,width:28,height:28,align:"center",children:(0,C.jsx)(y().D,{styleName:"Body-14px/Semibold",colorName:"uiRedPrimary",children:(0,b().PE)(t)[0].toUpperCase()})})}function N(e){const{onClickContinue:t,onClickManageGuests:n}=e,a=(0,v().tz)();return(0,C.jsx)(I().Y1,{gap:16,children:(0,C.jsxs)(I().Y1,{gap:8,align:"center",children:[(0,C.jsx)(M().A,{size:"lg","aria-label":a.formatMessage(G.manageGuests),onClick:n,style:{width:"100%"},children:a.formatMessage(G.manageGuests)}),(0,C.jsx)(_().p,{"aria-label":a.formatMessage(G.continueWithDowngrade),onClick:t,style:{justifyContent:"center"},children:(0,C.jsx)(y().D,{colorName:"secondary",children:a.formatMessage(G.continueWithDowngrade)})})]})})}const G=(0,v().YK)({title:{id:"DowngradeWillRemoveGuestsModal.title",defaultMessage:"Downgrading to {planName} will remove guests from {spaceName}"},description:{id:"DowngradeWillRemoveGuestsModal.description",defaultMessage:"{number} of your guests with the email domain ‘@{domain}’ will be removed on {date} to align with your new plan's guest limit"},continueWithDowngrade:{id:"DowngradeWillRemoveGuestsModal.continueWithDowngrade",defaultMessage:"Continue with downgrade"},manageGuests:{id:"DowngradeWillRemoveGuestsModal.manageGuests",defaultMessage:"Manage guests"},manyRemovedGuests:{id:"DowngradeWillRemoveGuestsModal.manyRemovedGuests",defaultMessage:"{name1}, {name2}, and {count, plural, one {1 more guest} other {{count} more guests}} will be removed from {spaceName}"},twoRemovedGuests:{id:"DowngradeWillRemoveGuestsModal.twoRemovedGuests",defaultMessage:"{name1} and {name2} will be removed from {spaceName}"},oneRemovedGuest:{id:"DowngradeWillRemoveGuestsModal.oneRemovedGuest",defaultMessage:"{name1} will be removed from {spaceName}"},recommendation:{id:"DowngradeWillRemoveGuestsModal.recommendation",defaultMessage:"If you want them to retain access, we recommend upgrading them to members."}}),T={business:f().v0.business,enterprise:f().v0.enterprise,free:f().v0.free,personal:f().v0.personal,plus:f().v0.plus,student:f().v0.educationPlus};var A=()=>n(501673),W=()=>n(997310),B=()=>n(931371),E=()=>n(384055),Y=()=>n(82224),F=()=>n(613313),z=()=>n(981899),K=()=>n(764227),L=()=>n(409211),O=(n(725707),n(491955),()=>n(365928));var V=()=>n(111826);var U=()=>n(300481);const H=new(n(967203).U)((e=>{let{spaceId:t,inviteeIds:n}=e;return`${t}:${n.sort().join(",")}`}),(async function(e,t){const a=await Promise.resolve().then(n.bind(n,818369)),r=await a.callApi({eventName:"getInvitesForInvitees",environment:e,data:t});return"success"===r.type?r.data.invites.map((e=>n(769884).Bj6.fromValue(n(72685).Yx,e))):void 0}));n(996094).exposeDebugValue("InvitesForInviteesStore",H);const $=H;var q=()=>n(14679),Q=()=>n(133926),J=()=>n(305043);function Z(e){let{space:t,spaceUser:n,desiredState:a}=e;const r=(0,o().v3)(),i=(d=J().subscriptionDataStoreInstance,(0,s().K8)((()=>{const e=d.state;if(e)return(0,V().oe)(e)}),[d]));var d;const l=(0,s().K8)((()=>n.getUserId()),[n]),u=(0,Q().Mc)({name:"internal_guests",spaceId:t.id,userId:l,amount:0,state:a});return(0,s().K8)((()=>{var e;const n=t.getModel();if(!n||!u)return[];const a=(i??[]).map((e=>function(e,t){return new(q().L)(e,{table:L().oo,id:t})}(r,e.userId))).map((e=>e.getModel())),o=(0,h().oE)(a),s=n.id,d=o.map((e=>e.id)),l=$.getData(r,{spaceId:s,inviteeIds:d}),c=null===(e=U().A.getData(r,{spaceId:s}))||void 0===e?void 0:e.map((e=>e.domain));return function(e){let{featureAvailability:t,guests:n,invites:a,domains:r}=e;const o=(0,h().$z)(a,(e=>e.invitee_id)),s=n.filter((e=>(0,O().C7)(e.email,r))),i=(0,h().Ul)(s,(e=>{const t=o[e.id]??[],n=(0,h().Sk)(t,(e=>e.created_time));return null==n?void 0:n.created_time})),d=n.length,l=t.limit.total,u="unlimited"===l?0:Math.max(d-l,0);return i.slice(0,u)}({featureAvailability:u,guests:o,invites:l??[],domains:c??[]}).map((e=>new(q().L)(r,{table:L().oo,id:e.id})))}),[r,t,u,i])}var X=()=>n(481596),ee=()=>n(34816),te=()=>n(879205),ne=()=>n(875500),ae=()=>n(469461),re=()=>n(795266);function oe(e){let{billingInterval:t,billingData:n,currentPeriodEnd:h,salesStatus:b,isOpen:x,onClose:I,onRequestDowngrade:_,onRequestUpgrade:D,onClickManageGuests:M}=e;const k=(0,g()._y)((0,u().AI)(n)),j=(0,ee().H4)({billingInterval:t,priceStore:te().A,products:X().$m}),R=(0,o().v3)(),N=(0,v().tz)(),G=(0,u().Rz)(n),T=(0,W().r)(),L=(0,s().K8)((()=>Boolean(null==T?void 0:T.canAdmin())),[T]),O=(0,u().qd)({billingData:n,canUpdateBilling:L}),V=(0,s().K8)((()=>(0,F().Le)()),[]),[U,H]=a.useState("plan_select"),[$,q]=a.useState({newProduct:k,reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[Q]=a.useState(l().JW()),[J,ne]=a.useState(void 0);(0,a.useEffect)((()=>w().u4(R,{name:"churn_survey",args:{newProduct:$.newProduct,churnType:k,reasons:$.reasons,reasonOther:$.reasonOther,reasonOtherTools:$.reasonOtherTools,stage:U,churnSurveyId:Q}})),[R,U,$,Q,k]);const oe=(0,B().HI)(),ie=(0,A().A)(T),de=Z({space:T,spaceUser:oe,desiredState:(0,u().ek)($.newProduct)}),le=(0,i().DP)(),ue=(0,s().K8)((()=>{const e=$.newProduct?(0,Y().j)({highlightStyle:{color:le.text.uiRedPrimary},intl:N,isMay13PackagingChangesEnabled:V})[k][$.newProduct]:void 0;return null==e?void 0:e.map((e=>({icon:e.icon,beforeMessage:e.beforeDowngrade,message:e.afterDowngrade?(0,C.jsx)(y().D,{styleName:"Body-14px/Regular",colorName:"primary",customStyles:{display:"inline"},children:e.afterDowngrade}):null,messageIcons:e.afterDowngradeIcons,tooltip:e.tooltip})))}),[k,$.newProduct,N,le,V]),ce=a.useCallback((()=>{w().u4(R,{name:"churn_survey_close",args:{churnSurveyId:Q}}),I()}),[Q,R,I]),pe=a.useCallback((e=>{T&&("upgrade"===(0,f().qR)({oldTier:k,newTier:e})&&"free"!==e?(w().QP(R,{from:"downgrade_modal",for_subscription_tier:e}),D({environment:R,spaceStore:T,billingData:n,product:e,pageSection:"downgrade_modal",from:"downgrade_modal"}),ce()):(q((t=>({...t,newProduct:e}))),H("survey")))}),[n,k,R,ce,D,T]),me=h?(0,d().W_)(h,"long",r().locale):void 0;return(0,C.jsx)(re().W,{step:U,isOpen:x,onClose:ce,children:(()=>{const e=(0,K().kg)({subscriptionTier:$.newProduct,currentSubscriptionTier:k,salesStatus:b,packagingChangesEnabled:V});switch(U){case"plan_select":return(0,C.jsx)(ae().K2,{initialPlan:$.newProduct,asyncPriceByProduct:j,salesStatus:b,onSubmit:pe});case"survey":return(0,C.jsx)(ae().lU,{options:se(),onSubmit:async e=>{w().u4(R,{name:"churn_survey_submitted",args:{newProduct:$.newProduct,churnType:k,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.switching??void 0,stage:U,churnSurveyId:Q}}),q((t=>({...t,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.switching??void 0})));const t=await E().z6(R,{spaceId:null==T?void 0:T.id,offerCampaign:(0,z().p)(R,null==T?void 0:T.id)}),n=(0,p().RS)(t);if(n&&(0,m().OJ)(n))return ne(n),void H("offer");H("remove_guests")}});case"offer":return J?(0,C.jsx)(ae().hL,{currentProduct:k,currentSubscriptionTier:k,coupon:J,newProduct:$.newProduct,onSubmit:async e=>{if(e){w().u4(R,{name:"offer_accepted",args:{coupon:J}});const e=null==T?void 0:T.id,t=(0,z().p)(R,e);G&&e&&O&&(0,m().OJ)(J)&&((0,F().S7)()&&t?await E().VY({environment:R,spaceId:e,offerCampaign:t,entrypoint:"downgrade_flow"}):await E().Qm(R,{customerId:G,offerType:"downgrade_flow",newPlan:k,coupon:J}),S().D6({label:(0,C.jsx)(v().sA,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})),ce()}else H("remove_guests")}}):void H("remove_guests");case"remove_guests":const t=de&&de.length>0,a=ie&&ie.length>0;return t&&a&&me&&T?(0,C.jsx)(P,{downgradeProduct:$.newProduct,excessGuests:de,formattedPeriodEndDate:me,internalDomains:ie,spaceStore:T,onClickContinue:()=>H("downgrade"),onClickManageGuests:M}):void H("downgrade");case"downgrade":return(0,C.jsx)(ae().kv,{newProduct:$.newProduct,title:(0,C.jsx)(v().sA,{id:"downgradeModal.header.downgrade.title",defaultMessage:"Continue downgrading to {planMessage}?",values:{planMessage:(0,f().u2)({product:e,intl:N})}}),description:me&&!V?(0,C.jsx)(v().sA,{id:"downgradeFlow.restrictionStep.description",defaultMessage:"You can still utilize all the features of your current plan until {date}. You can resubscribe or switch to another plan anytime.",values:{date:(0,C.jsx)("span",{style:{fontWeight:590},children:me})}}):me?(0,C.jsx)(v().sA,{id:"downgradeFlow.restrictionStep.description.mayMoment",defaultMessage:"You can still utilize all the features of your current plan until {date}",values:{date:me}}):null,restrictionList:ue,onSubmit:async e=>{if(w().u4(R,{name:"continue_downgrade_button_clicked"}),T&&n){if(!(await _({billingData:n,environment:R,product:$.newProduct,spaceStore:T,from:"billing_page",churnState:null!=e&&e.churnImmediately?"churn_immediately":"churn_by_end_of_billing_period"})))return}H("confirmation")},may13PackagingChangesEnabled:V});case"confirmation":if(n){if((0,c().Gf)((0,u().lQ)(n))!==$.newProduct)throw new Error("Subscription tier has not changed and is not scheduled to be changed.")}return(0,C.jsx)(ae().Qe,{title:(0,C.jsx)(v().sA,{id:"downgradeFlow.confirmationStep.title",defaultMessage:"Your workspace is now on {plan}",values:{plan:(0,f().u2)({product:e,intl:N})}}),formattedPeriodEndDate:me})}})()})}function se(){return[...(0,h().k4)([ne().V.notUsingEnough,ne().V.switching,ne().V.tooExpensive,ne().V.tooDifficult,ne().V.missingFeatures,ne().V.upgradedByMistake,ne().V.consolidatingWorkspaces]),ne().V.other]}},300481:(e,t,n)=>{n.d(t,{A:()=>r});const a=new(n(967203).U)((e=>{let{spaceId:t}=e;return t}),(async function(e,t){var a;let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,818369)),s=await o.callApi({eventName:"getInternalDomains",environment:e,data:{spaceId:r}});return"success"===s.type?null===(a=s.data)||void 0===a?void 0:a.internalDomainsWithInfo:void 0}));n(996094).exposeDebugValue("InternalDomainsStore",a);const r=a},365928:(e,t,n)=>{n.d(t,{C7:()=>o,CH:()=>s,JD:()=>r});n(725707),n(500234);var a=()=>n(599932);function r(e,t){return!!e&&o(e.getEmail(),t)}function o(e,t){return void 0!==s(e,t)}function s(e,t){if(!e)return;const n=(0,a().zN)(e);return t.find((e=>e.url===n))}},428121:(e,t,n)=>{n.d(t,{M:()=>o,z:()=>s});var a=()=>n(492435),r=()=>n(647242);function o(e){let{billingData:t,experimentService:n,spaceId:o}=e;const s=(0,r().YF)(t),i=(0,r().N8)(null==t?void 0:t.subscription),d=n.checkGate({gateName:"packaging_changes_05_13_2025",actor:a().S3,customIDs:{spaceId:o}}),l=(0,r().eh)(t,"plus"),u=(0,r().eh)(t,"business"),c=(0,r().eh)(t,"enterprise"),p=(0,r().eh)(t,"ai"),m=(0,r().eh)(t,"student"),g=(0,r().eh)(t,"personal");return d?i?p&&(l||u||c)?{currentState:{featureSet:"advanced",reason:"ai_product"},upsell:void 0}:{currentState:{featureSet:"none"},upsell:{product:"ai",featureSet:"advanced"}}:s?p&&g?{currentState:{featureSet:"advanced",reason:"personal_ai"},upsell:void 0}:g&&!p?{currentState:{featureSet:"none"},upsell:{product:"ai",featureSet:"advanced"}}:p&&!g?{currentState:{featureSet:"core",reason:"ai_product"},upsell:{product:"personal",featureSet:"advanced"}}:{currentState:{featureSet:"none"},upsell:{product:"ai",featureSet:"core"}}:m?p?{currentState:{featureSet:"core",reason:"ai_product"},upsell:{product:"business",featureSet:"advanced"}}:{currentState:{featureSet:"none"},upsell:{product:"ai",featureSet:"core"}}:u?p?{currentState:{featureSet:"advanced",reason:"ai_product"},upsell:void 0}:{currentState:{featureSet:"advanced",reason:"business"},upsell:void 0}:c?p?{currentState:{featureSet:"advanced",reason:"ai_product"},upsell:void 0}:{currentState:{featureSet:"advanced",reason:"enterprise"},upsell:void 0}:p?{currentState:{featureSet:"core",reason:"ai_product"},upsell:{product:"business",featureSet:"advanced"}}:{currentState:{featureSet:"none"},upsell:{product:"business",featureSet:"advanced"}}:p?{currentState:{featureSet:"core",reason:"ai_product"},upsell:void 0}:{currentState:{featureSet:"none"},upsell:{product:"ai",featureSet:"core"}}}function s(e){var t;let{billingData:n,experimentService:a,spaceId:r}=e;return"ai"===(null===(t=o({billingData:n,experimentService:a,spaceId:r}))||void 0===t||null===(t=t.upsell)||void 0===t?void 0:t.product)}},484157:(e,t,n)=>{n.d(t,{F:()=>a});const a=(0,n(680369).xh)("exclamationMarkCircle",{default:{loader:()=>n.e(64087).then(n.bind(n,639239))},small:{loader:()=>n.e(64087).then(n.bind(n,369337))},fill:{loader:()=>n.e(64087).then(n.bind(n,43029))},fillSmall:{loader:()=>n.e(64087).then(n.bind(n,158686))}},["exclamation","circle","alert","warning","attention"])},496984:(e,t,n)=>{n.d(t,{Y:()=>r});var a=()=>n(174114);function r(){return(0,a().IS)((e=>({bulletList:{paddingInlineStart:0,marginBlock:"0px 0px",listStyleType:"none"},bulletItem:{display:"flex",minHeight:24,alignItems:"center"},bulletItemContent:{display:"flex",gap:4},bulletItemContentMultiLineExtra:{paddingTop:4,paddingBottom:4},bulletItemCheckmarkContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},bulletItemCheckmarkContainerMultiLineExtra:{alignItems:"flex-start",paddingTop:2,justifyContent:void 0},bulletItemCheckmark:{width:12,height:12,color:e.icon.secondary},coloredRow:{display:"flex",flexDirection:"row",gap:12,backgroundColor:e.surface.wash,borderRadius:2},column:{width:"100%",minWidth:150,paddingTop:10,paddingBottom:12},featureDetailsStyle:{paddingTop:12},gridSectionTitle:{paddingLeft:12},gridSection:{display:"flex",flexDirection:"column",gap:42},row:{display:"flex",flexDirection:"row",gap:12},tooltip:{width:156},tooltipWithImageExtra:{paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:6},lastRow:{borderBottom:`1px solid ${e.stroke.secondary}`},sidebar:{width:"100%",paddingTop:12,paddingBottom:12,maxWidth:118},titleSection:{paddingLeft:12}})),[])}},501673:(e,t,n)=>{n.d(t,{A:()=>s});n(403517);var a=()=>n(237385),r=()=>n(803290),o=()=>n(300481);function s(e){const t=(0,a().v3)();return(0,r().K8)((()=>{var n;const a=null==e?void 0:e.id;if(a)return null===(n=o().A.getData(t,{spaceId:a}))||void 0===n?void 0:n.map((e=>e.domain))}),[t,e])}},614893:(e,t,n)=>{n.d(t,{H:()=>o});var a=()=>n(237385),r=()=>n(803290);function o(e){const{billingInterval:t,priceStore:n,products:o}=e,s=(0,a().v3)();return(0,r().K8)((()=>{const e={};for(const a of o)e[a]=n.getPrice(s,(e=>e.product===a&&e.billingInterval===t));return e}),[t,s,n,o])}},713628:(e,t,n)=>{n.d(t,{_:()=>s});var a=()=>n(237385),r=()=>n(803290),o=()=>n(421650);function s(e){const{asyncPrice:t}=e,n=(0,a().v3)();return(0,r().K8)((()=>{if(t&&t.isLoaded&&t.result)return o().m4(n,{externalId:t.result.externalId}),t.result.getMonthlyUnitCost().toMoneyValue()}),[t,n])}},981899:(e,t,n)=>{n.d(t,{p:()=>o});var a=()=>n(647242),r=()=>n(436622);function o(e,t){if(!t)return;const n=r().A.getData(e,{spaceId:t});if(!n)return;const o=(0,a().AI)(n),s=(0,a().q8)(n);if(o&&s&&"year"!==s)switch(o){case"plus":return"team_three_months";case"business":return"business_three_months";case"enterprise":return"enterprise_three_months";default:return}}}}]);