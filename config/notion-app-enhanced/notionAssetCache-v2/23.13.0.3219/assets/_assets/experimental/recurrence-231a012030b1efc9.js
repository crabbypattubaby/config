"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[29021],{56432:(e,t,o)=>{o.r(t),o.d(t,{addAutomationAction:()=>z,clearInvalidVariables:()=>$,createAutomation:()=>j,deleteAutomation:()=>J,disableAutomation:()=>Y,duplicateAutomation:()=>U,duplicateAutomationAction:()=>H,enableAutomation:()=>G,insertEmptyTextInDuplicateBlockAction:()=>Z,messages:()=>V,removeAutomationAction:()=>K,reorderAutomationActions:()=>L,restartAutomation:()=>N});o(610931),o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(725707),o(491955),o(500234),o(771702),o(403517);var n=o.n(o(485359)),r=()=>o(486826),i=()=>o(752597),a=()=>o(911575),c=()=>o(779698),l=()=>o(889110),s=()=>o(114103),u=()=>o(100851),d=()=>o(262148),p=()=>o(807912),m=()=>o(582226),y=()=>o(293665),f=()=>o(711659),g=()=>o(385649),v=()=>o(66460),h=()=>o(34662),b=()=>o(975392),S=()=>o(728373),_=()=>o(204132),M=()=>o(76394),C=()=>o(551102),T=()=>o(795394),x=()=>o(759625),A=()=>o(384221),k=()=>o(84543),I=()=>o(927685),w=()=>o(425447),P=()=>o(137476),R=()=>o(213517),B=()=>o(754697),O=()=>o(37394),W=()=>o(271142),F=()=>o(459845),E=()=>o(909177),D=()=>o(113800);const V=(0,o(653998).YK)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function j(e){const{actionIds:t,automationId:o,automationName:r,environment:i,inMemoryRecordCache:a,parentPointer:c,transaction:l,trigger:s}=e,u=o??(0,B().Z1)({environment:i,table:f().yB,spaceId:c.spaceId}),d=x().eC({environment:i,inMemoryRecordCache:a??i.defaultRecordCache.inMemoryRecordCache,table:f().yB,transaction:l,value:{action_ids:t,alive:!0,id:u,parent_id:c.id,parent_table:c.table,properties:{name:r},space_id:c.spaceId,status:"active",trigger:s}});return n()(d.isTriggerType(s.type),"Trigger type mismatch"),d}function z(e){const{actionId:t,environment:o,intl:r,automationStore:a,actionType:l,transaction:s,insertionPoint:u,config:d,createDuplicateBlocksContainer:p=!0,builderType:m="sidebar"}=e,v=a.getSpaceId();if(!v)return;let b;if("duplicate_blocks"===l&&p){b=x().Wv({environment:o,inMemoryRecordCache:a.inMemoryRecordCache,transaction:s,type:"text"});const e=Z({environment:o,contentStore:b.getContentStore(),transaction:s});i().default.afterNextFlush((()=>{const t=O().T.find((t=>y().L3.isEqual(t.props.store.pointer,e.pointer)));t&&A().setSelectionAtStart({store:t.props.store.getBlockTitleStore()})}))}const _=d??function(e){const{actionType:t,automationStore:o,intl:n}=e;if("modal_confirmation"===t)return{continue_button:{text:n.formatMessage(V.defaultContinueWorkflowMessage)},cancel_button:{text:n.formatMessage(V.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,h().x9d)(n.formatMessage(V.defaultConfirmationWorkflowText))}};if("define_variables"===t){const e=(0,S().Ay)();return{values:{[e]:{name:(0,E().v)(o.getActionStores(),n.formatMessage(g().xC)),value:{type:"simple",value:[[""]]}}},variableIds:[e]}}}({actionType:l,automationStore:a,intl:r})??{},T=x().eC({environment:o,inMemoryRecordCache:a.inMemoryRecordCache,table:g().SC,transaction:s,value:{id:t,type:l,parent_id:a.id,parent_table:f().yB,alive:!0,space_id:v,config:_,blocks:b?[b.id]:[]}});return b&&C().BC({transaction:s,parentStore:T.getKeyStore("blocks"),appendStore:b}),!u||"afterActionId"in u?C().BC({transaction:s,parentStore:a.getActionIdsStore(),appendStore:T,after:null==u?void 0:u.afterActionId}):"beforeActionId"in u?C().Hs({transaction:s,parentStore:a.getActionIdsStore(),prependStore:T,before:u.beforeActionId}):(0,M().HB)(u),q({transaction:s,automationStore:a}),(0,F().CM)(((e,t,n)=>{const r=(0,P().ik)(o),i=(0,F().zc)({automationActionStore:T,formulaAnalyticsModule:t,formulasModule:e,simpleFormulasModule:n});(0,M().O9)(i)&&(0,c().dW)(r,{automation_action:i,automation_action_id:T.id,automation_id:T.getParentId(),builder_type:m}),T.isDefined()&&(0,c().c_)(r,{automation_action_id:T.id,automation_action_type:T.getType(),automation_id:a.id,builder_type:m})})),n()(T.isType(l),"Action type mismatch"),T}function N(e){var t,o;const{automationStore:n,transaction:i}=e,a=n.getRecurrence();if(!a)return;const c=r().c9.now().plus({day:1}).startOf("day"),l={...a,start_date:c.toMillis(),end_condition:"date"===(null===(t=a.end_condition)||void 0===t?void 0:t.type)?{type:"date",end_at:(0,s().getNewEndTimestamp)(c,a.start_date,null===(o=a.end_condition)||void 0===o?void 0:o.end_at).toMillis()}:a.end_condition};x().zv({store:n,transaction:i,data:{status:"active"}}),x().zv({store:n.getKeyStore("trigger"),transaction:i,data:{recurrence:(0,s().convertFromUnpersistedRecurrenceConfig)(l)}})}function U(e){const{actorPointer:t,environment:o,includeParenting:n,sourceAutomationStore:r,targetAutomationId:i,transaction:a}=e,c=r.getParentStore();if(!c||!c.isReady())throw new Error("Automation parent store not ready");const l=r.getValue(),s=r.getSpaceId();if(!(0,M().O9)(l)||!(0,M().O9)(s))throw new Error("Undefined automation value or space id");const u={},p={...(0,b().mg)(l),id:i??(0,B().Z1)({environment:o,table:f().yB,spaceId:(0,v().e)(s)})};u[r.id]=p.id,(0,M().O9)(p.action_ids)&&(0,M().EI)(p.action_ids)&&p.action_ids.forEach((e=>u[e]=(0,B().Z1)({environment:o,table:g().SC,spaceId:(0,v().e)(s)})));const m=e=>{let{requested:t}=e;const o=u[t.id];return(0,M().O9)(o)?{...t,id:o}:t};(0,d().i)({actor:t,duplicateRecord:p,options:{},mapper:m,originalRecord:l});const y=x().eC({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,table:f().yB,transaction:a,value:p});n&&T().NI({childStore:y,parentStore:c,transaction:a});const h=r.getActionStores(),S=Promise.all(h.map((e=>{const t=u[e.id],{automationActionStore:n,onComplete:r}=H({environment:o,includeParenting:!1,mapper:m,sourceActionStore:e,targetAutomationActionId:t,transaction:a});return T().NI({childStore:n,parentStore:y,transaction:a}),r}))),_=S.then((e=>e.flat()));return{automationStore:y,onComplete:_}}function H(e){const{environment:t,includeParenting:o,insertionPoint:n,mapper:r,sourceActionStore:i,targetAutomationActionId:a,transaction:l}=e,s=i.getParentStore();if(!s||!s.isReady())throw new Error("Automation store is not ready");const d=i.getValue(),p=i.getSpaceId();if(!(0,M().O9)(d)||!(0,M().O9)(p))throw new Error("Undefined action value or space id");const m={...(0,b().mg)(d),id:a??(0,B().Z1)({environment:t,table:g().SC,spaceId:(0,v().e)(p)})},y=t.currentUser.id,f=i.inMemoryRecordCache.makeGetRecordRoleFn(y);(0,u().I)({duplicateRecord:m,getRecordRole:f,originalRecord:d,mapper:e=>(null==r?void 0:r(e))??e.requested,options:{},originOptions:{baseUrl:I().A.domainBaseUrl,publicDomainName:I().A.publicDomainName},duplicateBlocks:!1});const h=x().eC({environment:t,inMemoryRecordCache:i.inMemoryRecordCache,table:g().SC,transaction:l,value:m});o&&(!n||"afterActionId"in n?T().NI({after:null==n?void 0:n.afterActionId,childStore:h,parentStore:s,transaction:l}):"beforeActionId"in n?T().Ti({before:null==n?void 0:n.beforeActionId,childStore:h,parentStore:s,transaction:l}):(0,M().HB)(n),q({transaction:l,automationStore:s}));const S=Promise.all(i.getBlockStores().map((e=>{const{blockStores:o,onComplete:n}=w().duplicateBlock({environment:t,preferDuplicateLocation:"local",stores:[e],targetSpaceId:(0,v().e)(e.pointer.spaceId),transaction:l,options:{addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1}}),r=o[0];return T().NI({childStore:r,parentStore:h,transaction:l}),n}))),_=h.getModel();return(0,M().O9)(_)&&(0,F().CM)(((e,o,n)=>{const r=(0,P().ik)(t),i=(0,F().zc)({automationActionStore:h,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:n});(0,M().O9)(i)&&(0,c().dW)(r,{automation_action:i,automation_action_id:_.id,automation_id:_.parent_id,from:"duplicate"}),(0,c().c_)(r,{automation_action_id:_.id,automation_action_type:_.type,automation_id:s.id,from:"duplicate"})})),{automationActionStore:h,onComplete:S}}function L(e){const{automationStore:t,automationTypecheckModule:o,contextType:n,environment:r,formulasModule:i,from:a,intl:c,isSubscribed:l,movedActionId:s,newActionIds:u,transaction:d}=e;x().zv({store:t,transaction:d,data:{action_ids:u}}),q({automationStore:t,transaction:d});Q({automationStore:t,transaction:d,typecheckResult:(0,D().Z)({environment:r,automationStore:t,automationTypecheckModule:o,contextType:n,formulasModule:i,intl:c,isSubscribed:l})}),(0,P().u4)({environment:r,event:{eventName:"automation_action_move",eventProperties:{automation_id:t.id,automation_action_id:s,from:a}}})}function K(e){const{actionStore:t,automationStore:o,automationTypecheckModule:n,contextType:r,environment:i,formulasModule:a,intl:l,isSubscribed:s,transaction:u}=e,d=(0,D().Z)({environment:i,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:a,intl:l,isSubscribed:s});!function(e){const{automationActionStore:t,automationStore:o,environment:n,transaction:r,hasError:i=!1}=e;let a=t.getParentStore();if((0,M().O9)(o)){const e=t.getParentPointer();if(!(0,M().O9)(e))throw new Error("Automation action does not have a parent pointer");if(!y().L3.isEqual(e,o.pointer))throw new Error(`Automation action parent pointer does not match argument: ${y().L3.toKey(e)}, ${y().L3.toKey(o.pointer)}`);a=o}else if(!(0,M().O9)(a))throw new Error("Automation store is undefined");T().zz({childStore:t,parentStore:a,transaction:r});const l=t.getModel();(0,M().O9)(l)&&(0,F().CM)(((e,o,r)=>{const s=(0,P().ik)(n),u=(0,F().zc)({automationActionStore:t,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:r});(0,M().O9)(u)&&(0,c().YO)(s,{automation_action:u,automation_action_id:l.id,automation_id:l.parent_id,has_error:i}),(0,c().gW)(s,{automation_action_id:l.id,automation_action_type:l.type,automation_id:a.id,has_error:i})}))}({automationActionStore:t,environment:i,transaction:u,hasError:(_().Q.isSuccess(d)&&d.value.actionValidationFailures[t.id]||[]).length>0}),Q({automationStore:o,transaction:u,typecheckResult:d})}function $(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:a,isSubscribed:c,transaction:l}=e;Q({automationStore:o,transaction:l,typecheckResult:(0,D().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:a,isSubscribed:c})})}function q(e){const{automationStore:t,transaction:o}=e;t.getSpaceId()&&t.getActionStores().forEach(((e,t)=>{var n;if(!e.isDefined())return;const r=e.getModel();r.isType("open_page")&&"url"===(null===(n=r.getConfig())||void 0===n||null===(n=n.target)||void 0===n?void 0:n.type)&&!(0,a().cQ)(t)&&x().zv({store:e.getConfigStore(),transaction:o,data:{target:null}})}))}function Q(e){const{automationStore:t,transaction:o,typecheckResult:n}=e,r=t.getSpaceId(),i=t.getModel();if(r&&i&&!_().Q.isFail(n))for(const a of i.getActionIds()){const e=t.getRecordStore(t,{table:g().SC,id:a,spaceId:r});if(!e.isDefined())continue;const i=e.getModel(),c=new Set(n.value.actionInputValueTypes[a].map((e=>{if(e.kind===p().FormulaContextValueKind.Binding||e.kind===p().FormulaContextValueKind.ContextValue)return e.id;e.kind!==p().FormulaContextValueKind.ThisRow&&(0,M().HB)(e)})).filter(M().O9)),{value:s}=(0,l().G)({automationActionModel:i,baseUrl:I().A.domainBaseUrl,preventClearingConfig:!0,publicDomainName:I().A.publicDomainName,sourceSpaceId:r,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:void 0,visitFormulaContextValue:e=>c.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormulaPageProperty:void 0,visitRecordPointer:void 0}}),u=m().op.update({pointer:e.pointer,path:["config"],args:s.getConfig()??{}});k().applyOperation({store:e,operation:u,transaction:o})}}function Z(e){const{environment:t,contentStore:o,transaction:n}=e,r=x().Wv({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId});return C().BC({parentStore:o,appendStore:r,transaction:n}).childStore}function G(e){const{automationStore:t,environment:o,transaction:n}=e;x().zv({store:t,data:{status:"active"},transaction:n});const r=t.getModel();(0,M().O9)(r)&&(0,F().CM)(((e,n,i)=>{const a=(0,W().To)(t);let l=[];a&&_().Q.isSuccess(a)&&(l=a.value.valueTypes);const s=(0,P().ik)(o),u=(0,c().sp)({automationModel:r,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,R().i)(),simpleFormulasModule:i});(0,c().Ah)(s,u)}))}function Y(e){const{automationStore:t,environment:o,status:n,transaction:r}=e,i=n??"disabled";x().zv({store:t,data:{status:i},transaction:r}),t.isTriggerType("recurrence")&&x().zv({store:t,data:{run_at:void 0},transaction:r});const a=t.getModel();(0,M().O9)(a)&&(0,F().CM)(((e,n,r)=>{const i=(0,W().To)(t);let l=[];i&&_().Q.isSuccess(i)&&(l=i.value.valueTypes);const s=(0,P().ik)(o),u=(0,c().sp)({automationModel:a,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,R().i)(),simpleFormulasModule:r});(0,c().vN)(s,u)}))}function J(e){const{automationStore:t,environment:o,transaction:n}=e;x().zv({store:t,data:{alive:!1},transaction:n});const r=t.getModel();(0,M().O9)(r)&&(0,F().CM)(((e,n,i)=>{const a=(0,W().To)(t);let l=[];a&&_().Q.isSuccess(a)&&(l=a.value.valueTypes);const s=(0,P().ik)(o),u=(0,c().sp)({automationModel:r,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,R().i)(),simpleFormulasModule:i});(0,c().Iv)(s,u)}))}},88224:(e,t,o)=>{o.r(t),o.d(t,{TemplateRecurrenceConfigMenu:()=>g});var n=o(242343),r=()=>o(237385),i=()=>o(273520),a=()=>o(748039),c=()=>o(174114),l=()=>o(474110),s=()=>o(653998),u=()=>o(975392),d=()=>o(209684),p=()=>o(906230),m=o(163643);function y(e){const{buttonPopupEvents:t,focused:n,tooltipLabel:i,recurrence:a,showTooltip:y,variant:g="dropdown"}=e,v=(0,r().v3)(),{device:h}=v,b=(0,c().DP)(),S=(0,s().tz)(),_=function(){const{isMobile:e}=(0,r().Y0)();return(0,c().IS)((t=>({iconStyle:{fill:t.regularIconColor,width:e?18:16}})),[e])}(),M=Boolean(a);return(0,m.jsx)(o(103151).A,{disableTooltip:!y,delayThreshold:300,renderTooltip:()=>i,render:e=>{switch(g){case"dropdown":return(0,m.jsx)(o(918625)._,{...(0,p().A)(e,t),focused:n,icon:(0,l().l)(_.iconStyle),title:(0,m.jsx)(s().sA,{defaultMessage:"Repeat",id:"database.templatePickerItem.actionMenu.repeat"}),showExtensionArrow:h.isMobile,right:f({isActive:M,recurrence:a,intl:S})});case"icon":return(0,m.jsx)(d().p,{...u().cJ((0,p().A)(e,t),["focused","ignoreLocalHoverState"]),disallowTabbing:!1,size:"sm",role:"button",children:(0,l().l)({color:o(220413).Ay.blue,width:14})});case"label":return(0,m.jsxs)(d().p,{...(0,p().A)(e,t),children:[f({isActive:M,recurrence:a,intl:S}),(0,o(198654).b)({fill:b.lightIconColor,marginLeft:4,width:10})]})}}})}function f(e){let{isActive:t,recurrence:o,intl:n}=e;return t?o?(0,m.jsx)(m.Fragment,{children:(0,u().ZH)((0,a().LS)({recurrence:o,intl:n}))}):void 0:(0,m.jsx)(s().sA,{defaultMessage:"Off",id:"database.templatePickerItem.recurrenceConfigMenuLabel.off"})}const g=(0,n.forwardRef)((function(e,t){const{recurrence:n,onChange:c,disabled:l,buttonPopupStore:s}=e,u=(0,r().v3)(),{device:d}=u,p=d.isMobile?i().z7.SlideUp:i().z7.Popup,f=(0,o(266263).$)({recurrence:e.recurrence,onChange:c,disabled:l,requireExplicitSaveAndAllowDelete:!0,buttonPopupStore:s});return(0,m.jsx)(o(511952).A,{...e,popupType:p,ref:t,stopClickPropagation:!0,buttonPopupStore:f.buttonPopupStore,disabled:!1,onClose:async()=>{f.hasUnpersistedChanges()&&!(await o(264022).lT({hasPendingChanges:!0}))||(f.onClose(),f.buttonPopupStore.setState({open:!1}))},persistOnClose:!0,renderOrigin:t=>(0,m.jsx)(y,{buttonPopupEvents:t,focused:e.focused,tooltipLabel:n&&(0,a()._b)(n.frequency),recurrence:e.recurrence,showTooltip:e.showTooltip,variant:e.variant}),render:f.render})}))},137696:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>a,x2:()=>r});var n=()=>o(76394);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function a(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},271142:(e,t,o)=>{o.d(t,{EC:()=>M,To:()=>_,YC:()=>C,or:()=>S,u:()=>b});o(610931);var n=o(242343),r=()=>o(237385),i=()=>o(803290),a=()=>o(496985),c=()=>o(232312),l=()=>o(653998),s=()=>o(76394),u=()=>o(337658),d=()=>o(73631),p=()=>o(137696),m=()=>o(129978),y=()=>o(113800),f=()=>o(830925),g=o(163643);const v=new WeakMap,h=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});h.displayName="AutomationContext";function b(e){const{automationStore:t,children:o,contextType:n}=e,b=(0,r().v3)(),S=(0,l().tz)(),{value:_}=(0,m().fJ)(d().T.formulas),{value:M}=(0,m().fJ)(u().QV.automationTypecheck),C=(0,f().n)(t),T=(0,i().K8)((()=>{if(!_)return{error:new(c().N9)("Missing formulas dependency")};if(!M)return{error:new(c().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:c,isSubscribed:l}=e,u=v.get(o);if(u)return u;{const e=new(a().default)((()=>{const e=o.getTriggerType();let a=r;return(0,s().O9)(e)&&(0,p().x2)(e)&&(a=(0,p().H8)(e)),(0,y().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:a,formulasModule:i,intl:c,isSubscribed:l})}),{debugName:"automationContextTypecheckResultCachedStore"});return v.set(o,e),e}}({environment:b,automationStore:t,automationTypecheckModule:M,contextType:n,formulasModule:_,intl:S,isSubscribed:C});return e.state}),[b,t,M,n,_,S,C]);return(0,g.jsx)(h.Provider,{value:{automationStore:t,typecheckResult:T,contextType:n,defined:!0},children:o})}function S(e){const{automationStore:t,children:o}=e,n=(0,i().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,g.jsx)(b,{automationStore:t,contextType:(0,p().H8)(n??"event"),children:o})}function _(e){var t;return null===(t=v.get(e))||void 0===t?void 0:t.state}function M(){const e=n.useContext(h);if(!1===e.defined)throw new Error("No automation context found!");return e}function C(){return n.useContext(h)}},297340:(e,t,o)=>{o.d(t,{A:()=>i});var n=o(242343),r=o(163643);const i=function(e){let{firstDayOfWeek:t,value:i,selectValue:a=!0,onChange:c,onFocus:l,onBlur:s,disabledDays:u,className:d}=e;const p=(0,n.useMemo)((()=>new Date(i)),[i]),[m,y]=(0,n.useState)(p),f=(0,n.useRef)(i);(0,n.useLayoutEffect)((()=>{f.current!==i&&(y(new Date(i)),f.current=i)}),[i]);const g=(0,n.useCallback)(((e,t,o)=>{c(e.getTime())}),[c]);return(0,r.jsx)("div",{style:{paddingRight:8,paddingBottom:8,paddingLeft:8,paddingTop:4},children:(0,r.jsx)(o(789894).n,{locale:o(16791).locale,className:d??"notion-calendar-picker",numberOfMonths:1,weekStartsOn:t,modifiers:a?{value:p}:{},showOutsideDays:!0,fixedWeeks:!0,onDayClick:g,onMonthSelected:y,disabled:u,month:m,onDayBlur:s,onDayFocus:l})})}},441911:(e,t,o)=>{o.d(t,{e:()=>c,v:()=>a});var n=()=>o(237385),r=()=>o(803290),i=()=>o(640979);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:i().gu.ActionSheet}:{menuType:i().gu.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function c(e){const t=(0,n().Y0)();return(0,r().K8)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},459845:(e,t,o)=>{o.d(t,{CM:()=>p,UB:()=>d,zc:()=>u});o(725707),o(491955),o(403517);var n=()=>o(779698),r=()=>o(204132),i=()=>o(76394),a=()=>o(73631),c=()=>o(137476),l=()=>o(213517),s=()=>o(271142);function u(e){const{automationActionStore:t,automationStore:o,formulaAnalyticsModule:a,formulasModule:c,simpleFormulasModule:u}=e,d=t.getModel(),p=o??t.getParentStore();if(!d||!p)return;const m=p.getActionStores().map((e=>e.getModel())).filter(i().O9),y=(0,s().To)(p);let f=[];return y&&r().Q.isSuccess(y)&&(f=y.value.valueTypes),(0,n()._f)({automationActionModel:d,automationActionModels:m,formulaAnalyticsModule:a,formulasModule:c,simpleFormulasModule:u,formulaTypecheckContextValues:f,getRecordModel:t.getRecordModel,featureGates:(0,l().i)()})}function d(e,t){const{automationStore:o,automationActionStore:n}=t;o.isTriggerType("event")||p(((t,r,i)=>{const a=u({automationActionStore:n,automationStore:o,formulaAnalyticsModule:r,formulasModule:t,simpleFormulasModule:i});a&&(0,c().pM)(e,"automation_action_update",n.id,1,{automation_action:a,automation_action_id:n.id,automation_id:o.id})}))}function p(e){return Promise.all([a().T.formulas.load(),a().T.formulaAnalytics.load(),a().T.simpleFormulas.load()]).then((t=>{let[o,n,r]=t;e(o,n,r)})).catch((e=>{console.error("Error sending analytics for automations",e)}))}},464567:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>v,createRecurrenceInner:()=>b,deleteRecurrence:()=>h});var n=()=>o(114103),r=()=>o(214144),i=()=>o(711659),a=()=>o(385649),c=()=>o(21164),l=()=>o(76394),s=()=>o(927999),u=()=>o(759625),d=()=>o(84543),p=()=>o(137476),m=()=>o(754697),y=()=>o(485966),f=()=>o(413871),g=()=>o(56432);function v(e){let{environment:t,blockStore:o,recurrence:r}=e;const l=o.getAutomationId(),s=(0,n().convertFromUnpersistedRecurrenceConfig)(r);l?function(e,t,o,n){const r=o.getParentStore();if(!r||r.table!==c().Vl)return;const l=o.getSpaceId(),s={table:i().yB,id:t,spaceId:l},p=f().dn.createChildStore(o,s),y=p.getTrigger();if(!y)return;const g=p.getActionStores()[0];d().createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",canUndo:!0,perform:t=>{const i=S({automationId:p.id,spaceId:l,collectionPointer:r.getSpaceShardedPointer(),templatePageId:o.id});let c;g?(c=g.id,u().zv({store:g,data:i,transaction:t})):(c=(0,m().Z1)({environment:e,table:a().SC,spaceId:l}),u().eC({environment:e,table:a().SC,inMemoryRecordCache:p.inMemoryRecordCache,transaction:t,value:{id:c,...i}})),u().zv({store:p,data:{alive:!0,status:"active",trigger:{id:y.id,type:"recurrence",recurrence:n},action_ids:[c]},transaction:t})}}),_(e,{type:"updated",frequency:n.frequency})}(t,l,o,s):function(e,t,o){d().createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",canUndo:!0,perform:n=>{b(n,e,t,o)}})}(t,o,s)}function h(e){let{environment:t,blockStore:o}=e;const n=o.getAutomationStore();(0,l().O9)(n)&&(d().createAndCommit({environment:t,userAction:"recurrenceActions.deleteRecurrence",canUndo:!0,perform:e=>{g().disableAutomation({automationStore:n,environment:t,transaction:e}),g().deleteAutomation({automationStore:n,environment:t,transaction:e}),s().zA({stores:[o],update:{automation_id:void 0},transaction:e})}}),_(t,{type:"deleted"}))}function b(e,t,o,n){const{currentUserRootStore:l}=y().default.state;if(!l)return;const d=o.getParentStore();if(!d||d.table!==c().Vl)return;if(!d.getParentBlockStore())return;const p=o.getSpaceId(),f=(0,m().Z1)({environment:t,table:a().SC,spaceId:p}),g=u().eC({environment:t,table:i().yB,inMemoryRecordCache:o.inMemoryRecordCache,value:{parent_id:o.id,parent_table:o.table,alive:!0,space_id:p,status:"active",trigger:{id:r().JW(),type:"recurrence",recurrence:n},action_ids:[f]},transaction:e}).pointer.id;s().zA({stores:[o],update:{automation_id:g},transaction:e}),u().eC({environment:t,table:a().SC,inMemoryRecordCache:o.inMemoryRecordCache,transaction:e,value:{id:f,...S({automationId:g,spaceId:p,collectionPointer:d.getSpaceShardedPointer(),templatePageId:o.id})}}),_(t,{type:"created",frequency:n.frequency})}function S(e){const{automationId:t,spaceId:o,collectionPointer:n,templatePageId:r}=e;return{parent_id:t,parent_table:i().yB,type:"create_page",alive:!0,space_id:o,config:{collection:n,template_page_id:r}}}function _(e,t){p().vd(e,"recurrence_saved",t)}},474110:(e,t,o)=>{o.d(t,{l:()=>r});o(242343);var n=o(163643);const r=(0,o(680369).wt)("repeat",{viewBox:"0 0 16 14",svg:(0,n.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},511952:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(242343),r=()=>o(803290),i=()=>o(917717),a=o(163643);function c(e,t){const{onClose:c,persistOnClose:l,render:d,stopClickPropagation:p,onClick:m,disablePopup:y,disabled:f,forceInitialInbound:g,renderOrigin:v,originGap:h,borderRadius:b,popupWrapStyle:S}=e,_=(0,r().uB)(e.buttonPopupStore,o(962373).A);(0,n.useEffect)((()=>()=>{_.setState({open:!1})}),[_]);const M=(0,n.useCallback)((()=>s(c,l,_)),[c,l,_]),C=(0,n.useCallback)((()=>(0,a.jsx)(u,{onClose:c,persistOnClose:l,render:d,buttonPopupStore:_})),[c,l,d,_]),T=(0,n.useCallback)((e=>function(e,t,o,n,r){t&&(null==e||e.stopPropagation());if(e&&i().Vt(e))return;o&&o(e);n||r.setState({...r.state,open:!0})}(e,p,m,y,_)),[p,m,y,_]),x=(0,r().K8)((()=>v({...e,onClick:f?o(975392).D_:T})),[f,T,e,v]),A=(0,r().K8)((()=>_.state.open),[_]);return(0,a.jsx)(o(443252).Ay,{ref:t,...e,forceInitialInbound:Boolean(g),render:C,open:A,onDismiss:M,origin:x,originGap:h,borderRadius:b,popupWrapStyle:S,trapFocus:!0})}const l=n.forwardRef(c);function s(e,t,o){e&&e(),t||o.reset()}function u(e){let{onClose:t,persistOnClose:o,render:i,buttonPopupStore:c}=e;const l=(0,n.useCallback)((()=>s(t,o,c)),[t,o,c]),u=(0,r().K8)((()=>i({close:l})),[i,l]);return(0,a.jsx)(a.Fragment,{children:u})}},789894:(e,t,o)=>{o.d(t,{n:()=>i});var n=()=>o(129978);const r=new(n().O2)("react-day-picker",(async()=>await Promise.all([o.e(95555),o.e(75831),o.e(68548)]).then(o.bind(o,210513)))),i=(0,n()._h)(r,(e=>e.default))},909177:(e,t,o)=>{o.d(t,{v:()=>n});o(333225),o(494367),o(516262),o(573119),o(240480),o(950443),o(619601),o(725707),o(244387);function n(e,t){const o=e.reduce(((e,t)=>{if(t.isType("define_variables")){var o;const n=null===(o=t.getModel())||void 0===o?void 0:o.getVariables();if(n)for(const t of Object.values(n))e.add(t.name)}return e}),new Set),n=t.replace(/\s*\d+$/,"");let r=1,i=`${n} ${r}`;for(;o.has(i);)i=`${n} ${r}`,r++;return i}},911575:(e,t,o)=>{o.d(t,{$0:()=>g,Fx:()=>C,Ge:()=>m,I3:()=>d,Kj:()=>_,PP:()=>T,TK:()=>x,Yy:()=>u,aE:()=>A,cQ:()=>M,kH:()=>y,m7:()=>p,nq:()=>b,nv:()=>v,tj:()=>f});o(725707),o(491955),o(113085);var n=()=>o(975392),r=()=>o(76394),i=()=>o(564134),a=()=>o(810111),c=()=>o(479056),l=()=>o(875089);(0,r().u0)((e=>(0,r().O9)(e)&&(0,r().O9)(e.target)&&(0,r().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const s={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},u={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function d(e){return Boolean(s[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:c,sort:s,sourcePropertyIds:u}=e,p=(u??(0,r().uv)(o)).filter(((t,n,r)=>{const a=o[t];return!(!a||!d(a))&&(("relation"!==a.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,a))&&(!c||c([t,a],n,o)))}));if(0===p.length)return[];if(!t||!1===s)return p;const m=(0,l().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return n().Ul(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:o,sort:c}=e,s=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().JY)(r))}));if(0===s.length)return[];if(!t||!1===c)return s;const u=(0,l().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return n().Ul(s,(e=>u.findIndex((t=>t.property===e))))}function y(e){return e.type===c().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===c().M9.TokenExpected?{type:e.type,token:e.token}:e.type===c().uW.MissingSchemaPropertyOnThisRow||e.type===c().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===c().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===c().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===c().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===c().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===c().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===c().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===c().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===c().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===c().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===c().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===c().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===c().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const f={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function g(e){return Boolean(f[e.type])}function v(e){const{collectionFormat:t,collectionSchema:o,filter:c,sort:s}=e,u=(0,r().uv)(o).filter(((e,t,n)=>{var r;const a=o[e];return!(!a||!f[a.type])&&((!(0,i().$M)(a)||null===(r=(0,i().om)(a))||void 0===r||!r.auto_update_on_edit)&&(!c||c([e,a],t,o)))}));if(0===u.length)return[];if(!t||!1===s)return u;const d=(0,l().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return n().Ul(u,(e=>d.findIndex((t=>t.property===e))))}const h={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function b(e){return h[e.type]}const S={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function _(e){return S[e.type]}function M(e){return 0===e}function C(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function T(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function x(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!d(r):!f[r.type])}function A(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i,relativeDate:a}=t.event;if(void 0===i)return!1;const c="some"===n.type&&n.some,l="all"===n.type&&n.all;if((c||l||[]).some((e=>T({collectionSchema:o,property:e.property})||x({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const s="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),u="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!e&&("none"===n.type||s||u)&&!a)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},918625:(e,t,o)=>{o.d(t,{_:()=>u});o(242343);var n=()=>o(237385),r=()=>o(174114),i=()=>o(198654),a=()=>o(126451),c=()=>o(932322),l=()=>o(35462),s=o(163643);function u(e){const t=(0,r().DP)(),o=(0,n().v3)(),{device:u}=o;return(0,s.jsx)(a().A,{mobileFeedback:u.isMobile,onClick:e.onClick,hovered:e.focused,disabled:e.disabled,style:{width:"100%",...!u.isMobile&&{borderRadius:6},...e.buttonStyle},hoveredStyle:e.hoveredButtonStyle,pressedStyle:e.pressedButtonStyle,children:(0,s.jsx)(c().Ay,{...e,dontShrinkTitle:!0,right:(0,s.jsxs)("div",{style:{display:"flex",whiteSpace:"nowrap"},children:[e.right&&(0,s.jsx)(l().A,{isSecondaryColor:!0,isMobile:u.isMobile,children:e.right}),!u.isMobile&&(0,s.jsx)("div",{style:{flexShrink:0},children:(0,i().b)({width:10,marginLeft:4,fill:t.lightIconColor,transform:"right"===e.chevronType?"rotate(-90deg)":void 0,transition:"transform 0.2s ease"})})]})})})}}}]);