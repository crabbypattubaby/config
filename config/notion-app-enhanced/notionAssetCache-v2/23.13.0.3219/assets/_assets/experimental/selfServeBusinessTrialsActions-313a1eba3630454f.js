"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[7520,65213],{35294:(e,t,n)=>{n.r(t),n.d(t,{applyMultiplayerReverseTrialIfEligible:()=>c().V_,applyReverseBusinessTrial:()=>c().xX,applyReversePlusTrial:()=>c().xE,handleTrialUpgradeFromOnboarding:()=>c().WR,handleTrialUpgradeFromOnboardingImpl:()=>c().eu,isEligibleForBlockLimitTimedTrial:()=>l});var r=()=>n(732541),a=()=>n(647242),i=()=>n(436622),s=()=>n(397138),o=()=>n(384055);async function l(e,t){const n=await i().A.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,a().AI)(n))return!1;const l=null==t?void 0:t.getSetting("reach_block_limit_time");if(!l||(0,r().Mn)(l)<3)return!1;if(await(0,s().G)(e))return!1;const c=t.getSpaceId();return!!(await(0,o().L6)({environment:e,spaceId:c,offerCampaign:"default"}))}var c=()=>n(308839)},220549:(e,t,n)=>{n.d(t,{J7:()=>i,V9:()=>l,XF:()=>c,tk:()=>s,tz:()=>o});n(403517);var r=()=>n(486826);const a={0:"onboardingIntro",1:"intro",3:"inviteMembers",5:"connectWorkspace",8:"createTeamspaces",11:"verifyPages",14:"samlSSO",17:"storeRecords",20:"notionAi"},i=Object.fromEntries((0,n(76394).WP)(a).map((e=>{let[t,n]=e;return[n,Number(t)]})));function s(e){if(e in a)return a[e]}function o(e,t,n){const a=r().c9.fromMillis(e.endDateMs),i=n??r().c9.now();return i<a&&a.diff(i).as("days")<=t}function l(e,t){const n=r().c9.fromMillis(e.endDateMs);return(t??r().c9.now())>n}function c(e,t){const n=r().c9.fromMillis(e.endDateMs);return(t??r().c9.now()).hasSame(n,"day")}},308839:(e,t,n)=>{n.d(t,{V_:()=>N,WR:()=>k,eu:()=>E,xE:()=>L,xX:()=>C});n(610931);var r=()=>n(486826),a=(n(242343),()=>n(502140)),i=()=>n(647242),s=()=>n(678988),o=()=>n(653998),l=()=>n(450475),c=()=>n(3311),d=()=>n(421650),u=()=>n(818369),p=()=>n(145046),m=()=>n(70989),f=()=>n(137476),v=()=>n(485966),y=()=>n(436622),S=()=>n(836331),g=()=>n(855827),_=()=>n(397138),b=()=>n(104838),w=()=>n(384055),h=()=>n(298520),T=()=>n(613313),M=()=>n(111826),I=()=>n(879205),B=()=>n(30299),A=n(163643);const D=(0,o().YK)({applyingBusinessTrial:{id:"trialUpsellActions.applyingBusinessTrial",defaultMessage:"Setting up your Business trialâ€¦"}});async function E(e){var t,n;const{environment:l,stripe:c,elements:u,trialData:m,trialDays:f,sessionId:S,customerName:g,businessName:_}=e;if(!u||!c)return void a().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:w}=await u.submit();if(w)return void d().$X(l,{error:"could not submit form",error_type:"payment_method"});const D=await c.createPaymentMethod({elements:u});if(D.error)return void d().$X(l,{error:D.error.message,error_type:"payment_method"});if(!D.paymentMethod)return void d().$X(l,{error:"could not create token",error_type:"payment_method"});const E={type:"paymentMethodId",value:D.paymentMethod.id},k=v().default.state.currentSpaceStore;if(!k)return;const N=k.id,C=await h().p_({environment:l,spaceId:N}),L=await y().A.awaitData(l,{spaceId:N});if(!L)throw new Error("Billing data not loaded");const x=(0,i().lQ)(L),P=I().A.state.selectedCurrencyCode??"USD",V=(0,B().Zr)(),U=(0,s().vk)(C,{interval:"month",product:V,currency:P}),F=(0,T().Le)(),R=(0,s().vH)(x,{price:U,quantity:1},{isMay13PackagingChangesEnabled:F}),$=r().c9.now().plus({days:f});return await async function(e){const{environment:t,spaceStore:n,paymentData:r,desiredState:a,stripe:i,trialData:s,customerName:l,businessName:c,addressZip:u,addressCountry:m,sessionId:f}=e,v=await y().A.awaitData(t,{spaceId:n.id});try{const e=await b().nV({environment:t,sessionId:f,spaceStore:n,desiredState:a,paymentData:r,from:"onboarding",trialData:s,billingEmail:(0,M().cs)(v),customerName:l,businessName:c,addressZip:u,addressCountry:m}),d=e.paymentIntentClientSecret,y=e.paymentIntentStatus;if(d&&"requires_action"===y){const{error:e}=await i.handleNextAction({clientSecret:d});e&&(await b().M2({environment:t,spaceStore:n,from:"subscription_upgrade_onboarding_failed_payment"}),p().f1((0,A.jsx)(o().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void d().AF(t)}}({environment:l,spaceStore:k,desiredState:{...R,trialEnd:$},paymentData:E,stripe:c,trialData:m,customerName:g,businessName:_,addressZip:(null===(t=D.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(n=D.paymentMethod.billing_details.address)||void 0===n?void 0:n.country)||"",sessionId:S})}const k=(0,n(975392).sg)(E,1e3,{leading:!0,trailing:!1});async function N(e){let{spaceStore:t,environment:n}=e;const r=t.id;if(await(0,w().L6)({environment:n,spaceId:r,offerCampaign:"reverse"})&&(0,T().s)(n)){await L(t,n,"going_multiplayer")&&await g().A.resetData(n,{spaceId:r})}}async function C(e,t,n){try{m().m({message:D.applyingBusinessTrial});const r=e.id,a=await u().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:r,trialData:{id:"business_reverse",from:n}}});return"success"===a.type?((0,f().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"business_reverse",success:"success"===a.data.status}}}),await b().o2({environment:t,spaceStore:e}),m().V(),"success"===a.data.status):(x("business_reverse",t,a.error),m().V(),!1)}catch(r){return x("business_reverse",t,r),m().V(),!1}}async function L(e,t,n){let r="reverse";try{const a=await(0,_().G)(t),i=Boolean(S().default.checkGate({gateName:"apply_reverse_trial_key"}));a&&(r="reverse_mm_ent");const s=e.id,o=`${s}_timed_trial`,l=i?(0,c().gB)(o):void 0,d=await u().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:s,trialData:{id:r,from:n},idempotencyKey:l}});return"success"===d.type?((0,f().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:r,success:"success"===d.data.status}}}),await b().o2({environment:t,spaceStore:e}),"success"===d.data.status):(x(r,t,d.error),!1)}catch(a){return x(r,t,a),!1}}function x(e,t,n){(0,f().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),a().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,l().convertErrorToLog)(n)})}},309968:(e,t,n)=>{n.d(t,{A:()=>a});class r extends(()=>n(129044))().default{}const a=new r},472951:(e,t,n)=>{n.d(t,{k:()=>a});n(403517);class r extends(()=>n(129044))().default{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort(((e,t)=>{let[n,r]=e,[a,i]=t;return i-r})).map((e=>{let[t,n]=e;return t}))}}const a=new r;(0,n(996094).exposeDebugValue)("UserSimilarityStore",a)},844393:(e,t,n)=>{n.r(t),n.d(t,{closeSelfServeBusinessTrialEndingModal:()=>S,closeSelfServeBusinessTrialExplorePlanModal:()=>w,closeSelfServeBusinessTrialLossAversionModal:()=>_,closeSelfServeBusinessTrialStartModal:()=>v,createSelfServeBusinessTrial:()=>h,determineMessageEligibility:()=>T,openSelfServeBusinessTrialEndingModal:()=>y,openSelfServeBusinessTrialExplorePlanModal:()=>b,openSelfServeBusinessTrialLossAversionModal:()=>g,openSelfServeBusinessTrialStartModal:()=>f});var r=()=>n(486826),a=()=>n(519423),i=()=>n(647242),s=()=>n(678988),o=()=>n(884697),l=()=>n(818369),c=()=>n(220549),d=()=>n(879205),u=()=>n(967772),p=()=>n(35294),m=()=>n(262230);function f(e){u().iJ.setState({open:!0,...e})}function v(){u().iJ.update((e=>({...e,open:!1})))}function y(e){u().L3.update((()=>({...e,open:!0})))}function S(){u().L3.update((e=>({...e,open:!1,modalState:"initial"})))}function g(e){u().uE.setState({...e,open:!0})}function _(){u().uE.update((e=>({...e,open:!1})))}function b(e){u().Sp.setState({open:!0,...e})}function w(){u().Sp.update((e=>({...e,open:!1})))}async function h(e){const{billingData:t,environment:n,spaceStore:a,from:l,memberCount:c,prices:u,campaign:f="stacked_business_trial"}=e;if(!a||!l||!t||void 0===c)return;if("free"===(0,i().AI)(t))return void(await(0,p().applyReverseBusinessTrial)(a,n,l));const v=e.nowForTesting??r().c9.now(),y=c,S={product:"business",interval:"month",currency:d().A.state.selectedCurrencyCode??"USD"},g={items:[{price:(0,s().vk)(u,S),quantity:y}],trialEnd:v.plus({days:o().WL})};await(0,m().updateSubscription)({environment:n,spaceStore:a,from:l,desiredState:g,trialData:{id:f,from:l}})}async function T(e,t){const{billingData:n,environment:r,currentSpaceStore:s}=t,d=s.getSpaceId();if(!n)return!1;if(!(0,i().TB)(n))return!1;const u=(0,i().DS)(n),p=await l().callApi({eventName:"getCustomerOffersReceived",environment:r,data:{spaceId:d},headers:(0,a().WS)({cellId:void 0,spaceId:d})});if("failed"===p.type)return!1;const m=(0,o().yL)(p.data);if(!m)return!1;const f=Math.floor(u.diff(m,"days").days),v=c().J7[e];if("onboardingIntro"===e){const e=(0,o().F$)(p.data);if(0===f&&"onboarding"!==(null==e?void 0:e.entrypoint))return!1}return f===v}},884697:(e,t,n)=>{n.d(t,{$G:()=>i,$z:()=>u,BV:()=>d,F$:()=>l,WL:()=>a,e3:()=>o,x5:()=>s,yL:()=>c});n(725707),n(500234);var r=()=>n(395665);const a=30,i=5,s=3;function o(e){return Boolean(l(e))}function l(e){return u(e)||function(e){var t;return null===(t=p(e))||void 0===t?void 0:t.find((e=>{let{offer:t}=e;return"business_cc"===t.campaign}))}(e)||function(e){var t;return null===(t=p(e))||void 0===t?void 0:t.find((e=>"claimed"===e.type&&"trial"===e.offer.type&&"business_reverse"===e.offer.campaign))}(e)}function c(e){const t=l(e);if(t)return(0,r().Vm)(t)}function d(e){const t=l(e);if(t)return(0,r().kd)(t)}function u(e){var t;return null===(t=p(e))||void 0===t?void 0:t.find((e=>"claimed"===e.type&&"trial"===e.offer.type&&"stacked_business_trial"===e.offer.campaign))}function p(e){if(e)return Array.isArray(e)?e:[e]}},967772:(e,t,n)=>{n.d(t,{L3:()=>i,Sp:()=>o,iJ:()=>a,uE:()=>s});var r=()=>n(129044);const a=r().default.createValue({open:!1,openedFrom:void 0},{name:"SelfServeBusinessTrialStartModalStore"}),i=r().default.createValue({open:!1,openedFrom:void 0,recentPageStores:[],verifiedPageStores:[],teamStores:[],workspaceUserStores:[],connectedApps:[],modalState:"initial"},{name:"SelfServeBusinessTrialEndingModalStore"}),s=r().default.createValue({open:!1,openedFrom:void 0,connectedApps:[],teamStores:[],pageStores:[],onSecondaryButtonClick:void 0},{name:"SelfServeBusinessTrialLossAversionModalStore"}),o=r().default.createValue({open:!1,connectedApps:[],teamStores:[],pageStores:[]},{name:"SelfServeBusinessTrialExplorePlanStore"})}}]);