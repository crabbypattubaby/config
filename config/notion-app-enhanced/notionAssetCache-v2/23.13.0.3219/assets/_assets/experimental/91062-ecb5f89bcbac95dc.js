"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[91062],{33368:(e,t,n)=>{n.d(t,{D:()=>y});var r=n(242343),a=()=>n(237385),i=()=>n(803290),o=()=>n(331863),s=()=>n(395665),l=()=>n(818369),d=()=>n(548694),c=()=>n(997310),u=()=>n(485966),p=()=>n(384055),m=()=>n(898055),g=()=>n(647242),f=()=>n(613313);function y(){const e=(0,a().v3)(),t=(0,c().r)(),n=null==t?void 0:t.id,y=(0,m().l)({spaceId:n}),[v,h]=(0,r.useState)(!1),{currentSpaceStore:b}=(0,i().K8)((()=>{const{currentSpaceStore:e}=u().default.state;return{currentSpaceStore:e}}),[]),x=(0,i().K8)((()=>b?(0,d().GK)(e,b):void 0),[b,e]),S=function(e){return(0,i().K8)((()=>(0,f().vv)()&&Boolean("free"===(0,g().AI)(e))),[e])}(y),j=(0,i().K8)((()=>null==t?void 0:t.canAdmin()),[t]);return(0,r.useEffect)((()=>{!async function(){if(S&&n&&j)try{const t=await l().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:n,offerCampaign:"resurrection_offer"}});if("failed"===t.type)return;if("offer"in t.data){const n=(0,o().RS)(t.data.offer);(0,s().u6)(n)&&(h(!0),x&&(0,p().Zc)({environment:e,spaceName:x,offerCampaign:"resurrection_offer"}))}}catch(t){return}}()}),[e,n,S,x,j]),v}},75199:(e,t,n)=>{n.d(t,{G5:()=>u,Ux:()=>g,g3:()=>p,jn:()=>c,o2:()=>m});n(725707),n(403517),n(244387);var r=()=>n(237385),a=()=>n(162901),i=()=>n(423600),o=()=>n(331863),s=()=>n(395665),l=()=>n(818369),d=()=>n(111826);function c(e){const{items:t,promo:n}=e;return t.map((e=>e.price.getDiscountPerBillingInterval({quantity:e.quantity,promo:n}))).reduce(((e,t)=>e.plus(t)))}function u(e){const{items:t,coupon:n}=e,r=n?(0,s().Pz)((0,o().Pq)(n)):void 0;return t.map((e=>e.price.getCostPerBillingInterval({quantity:e.quantity,offer:r}))).reduce(((e,t)=>e.plus(t)))}function p(e){const{taxAmount:t,calculatingTax:n,currencyCode:r}=e,a=t&&!n?t:0;return new(i().W)(r,a)}function m(e,t){const n=Math.min(0,d().o2(e));return new(i().W)(t,-n)}function g(e){const t=(0,r().v3)(),[n]=(0,a().Yb)((async()=>{if(!e)return;const n=await l().callApi({eventName:"getPromoCode",environment:t,data:{code:e.code}});return"failed"!==n.type?n.data.promo:void 0}),[t,e]);return"resolved"===n.status?n.value:void 0}},142914:(e,t,n)=>{n.d(t,{A:()=>l});var r=()=>n(237385),a=()=>n(204758),i=()=>n(162901),o=()=>n(89509),s=()=>n(818369);function l(){var e;const t=(0,r().v3)(),[n]=(0,i().Yb)((async()=>{const e=await s().callApi({eventName:"getGeoIpLocation",environment:t,data:{}});if("success"===e.type)return e.data}),[t]),l=null==n||null===(e=n.value)||void 0===e?void 0:e.countryCodeFromIp;return!!(0,a().Ef)(l)&&(0,o().Lv)(l)}},541750:(e,t,n)=>{n.d(t,{P:()=>g});var r=n(242343),a=()=>n(237385),i=()=>n(174114),o=()=>n(653998),s=()=>n(421338),l=()=>n(701270),d=()=>n(289151),c=()=>n(137476),u=()=>n(392608),p=()=>n(231786),m=n(163643);function g(e){let{message:t,isChecked:n,onChange:g,error:f}=e;const y=(0,o().tz)(),v=(0,i().IS)((e=>({termsContainer:{display:"flex",flexDirection:"column",gap:8,paddingTop:16,borderTop:`1px solid ${e.stroke.primary}`}})),[]),h=(0,a().v3)(),b=r.useRef(null);return r.useEffect((()=>{f&&b.current&&b.current.scrollIntoView({behavior:"smooth",block:"center"})}),[f]),(0,m.jsx)("div",{ref:b,style:v.termsContainer,children:(0,m.jsxs)(s().Y1,{direction:"horizontal",align:"top-left",gap:8,children:[(0,m.jsx)(d().T,{size:14,checked:n,onClick:()=>{(0,c().u4)({environment:h,event:{eventName:"click_subscription_terms_checkbox",eventProperties:{checked:!n}}}),g(!n)},id:"terms",style:{margin:1},"aria-required":!0}),(0,m.jsxs)(s().Y1,{direction:"vertical",gap:8,children:[(0,m.jsxs)(l().D,{styleName:"UISmall-12px/Regular",colorName:"primary",as:"label",htmlFor:"terms",children:[t,(0,m.jsx)("div",{style:{display:"inline-block",position:"absolute",paddingLeft:1},children:(0,m.jsx)(p().W,{tooltipTitle:y.formatMessage({id:"onboardingTimedTrials.termsOfService.tooltip",defaultMessage:"Read full terms and conditions"}),buttonProps:{href:(0,u().xS)("terms"),external:!0}})})]}),f?(0,m.jsx)(l().D,{styleName:"UISmall-12px/Regular",colorName:"uiRedPrimary",children:f}):null]})]})})}},724574:(e,t,n)=>{n.d(t,{f:()=>p});n(242343);var r=()=>n(83544),a=()=>n(174114),i=n(163643);function o(e){const{style:t,shadowVariant:n="strong",wrapStyle:r,imageSrc:o,variant:s="medium",alt:l,wrapWithPadding:d=!0}=e;let c=36;"medium"===s?c=36:"large"===s&&(c=48);const u=(0,a().IS)((e=>({faceImgWrap:{width:c,height:c,borderRadius:"100%",background:e.assistantCornerButtonBackground,..."strong"===n&&{boxShadow:e.shadowMD},..."light"===n&&{borderRadius:"50%",boxShadow:e.shadowSM},overflow:"hidden",...r},faceImg:{height:c,width:c,...d&&{pointerEvents:"none"},...t}})),[n,r,d,t,c]),p=(0,i.jsx)("img",{style:u.faceImg,src:o,alt:l});return d?(0,i.jsx)("div",{children:(0,i.jsx)("div",{style:u.faceImgWrap,children:p})}):p}function s(){const e=(0,a().IS)((e=>({meetingNotesLight:{width:104,height:104,top:-17,left:-31,bottom:-28,position:"absolute"}})),[]);return(0,i.jsx)("div",{style:{width:47.3,height:48.7},children:(0,i.jsx)("img",{src:r().A.images.subscriptions.meetingNotesLightSvg,alt:"Notion AI Meeting Notes",style:e.meetingNotesLight})})}var l=()=>n(338563);function d(){const e=(0,a().IS)((e=>({wrapper:{display:"inline-block",position:"relative",width:52,height:52},mailIcon:{position:"absolute",width:24,objectFit:"cover",right:0,bottom:0}})),[]);return(0,i.jsxs)("div",{style:e.wrapper,children:[(0,i.jsx)(o,{imageSrc:l(),variant:"large",alt:"Notion AI Mail Icon"}),(0,i.jsx)("img",{style:e.mailIcon,src:r().A.images.subscriptions.notionAiMailSvg,alt:"Notion AI Mail Icon"})]})}var c=()=>n(531568),u=()=>n(849469);function p(e){const{headerContent:t,primaryProduct:n}=e;if("featureWithCustomImage"in t)switch(t.featureWithCustomImage){case"coreAI":case"aiConnectors":return(0,i.jsx)(c().cG,{variant:"medium_large"});case"meetingNotes":return(0,i.jsx)(s,{});case"researchMode":return(0,i.jsx)(o,{imageSrc:r().A.images.subscriptions.researchModeSvg,variant:"large",alt:"Notion Research Mode"});case"notionAIForMail":return(0,i.jsx)(d,{})}else if("ai"===n)return(0,i.jsx)(c().cG,{variant:"medium_large"});return(0,i.jsx)(u().X,{product:n})}},876933:(e,t,n)=>{n.r(t),n.d(t,{CheckoutUpgradeModal:()=>Oe});var r=()=>n(353420),a=n(242343),i=()=>n(237385),o=()=>n(803290),s=()=>n(647242),l=()=>n(539048),d=()=>n(983050),c=()=>n(153642),u=()=>n(172553),p=()=>n(104838),m=()=>n(505316),g=()=>n(111826),f=()=>n(159448),y=()=>n(879205),v=(n(362833),n(725707),n(113085),()=>n(269280)),h=()=>n(502140);const b=(0,n(680369).xh)("infoBubble",{default:{loader:()=>n.e(89306).then(n.bind(n,657529))},small:{loader:()=>n.e(87344).then(n.bind(n,642443))},mini:{loader:()=>n.e(72612).then(n.bind(n,318255))},large:{loader:()=>n.e(78596).then(n.bind(n,307631))}});var x=()=>n(789831),S=()=>n(216376),j=()=>n(455831),I=()=>n(653998),C=()=>n(975392),A=()=>n(421650),w=()=>n(336519),_=()=>n(421338),M=()=>n(206799),T=()=>n(701270),k=()=>n(548694),P=()=>n(965694),D=()=>n(740699),U=()=>n(485966),N=()=>n(802955),E=()=>n(330358),B=(n(610931),n(491955),()=>n(486826)),O=()=>n(712437),R=()=>n(537609),K=()=>n(145017),Y=()=>n(678988),q=()=>n(395665),F=()=>n(688724),L=()=>n(145046),z=()=>n(70989),W=()=>n(191756),V=()=>n(575015),G=()=>n(281885),H=()=>n(216143),Q=()=>n(244698),J=()=>n(436622),Z=()=>n(359540),$=()=>n(413871),X=()=>n(213824),ee=()=>n(26399),te=n(163643);function ne(e){const{onClick:t}=e;return(0,te.jsx)(ee().N,{buttonInfo:{onClick:t,label:(0,te.jsx)(I().sA,{id:"spaceSubscriptionUpgradeModal.upgradeAi.getStarted",defaultMessage:"Get started"})}})}var re=()=>n(613313),ae=()=>n(298520),ie=()=>n(262230);const oe=(0,I().YK)({cancelFailedSubscription:{id:"subscription.upgrade.cancel_failed_subscription",defaultMessage:"Cancelling subscription..."}});async function se(e){var t;const{address:n,billingEmail:r,billingInterval:a,coupon:i,currencyCode:o,environment:l,isStartingTrial:d,modalId:c,modalType:u,paymentData:p,promo:m,quantity:g,selectedProducts:f,stripe:y,useTestClock:v,vatId:h,intl:b,from:x,postUpgradeCallback:S}=e,j=U().default.state.currentSpaceStore;if(!j)return;const w=await ae().p_({environment:l,spaceId:j.id}),_=await J().A.awaitData(l,{spaceId:null==j?void 0:j.id});if(!_)throw new Error("Billing data not loaded");const M=(null===(t=(0,s().KH)(_,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,T=(0,s().lQ)(_),k=d?B().c9.now().plus({days:14}):void 0,P=(0,C().oE)(f).filter((e=>"free"!==e)),D=(0,re().Le)(),N=(0,Y().ef)({state:{...T,trialEnd:k},prices:w,quantities:{numSeats:g,numCustomHostnames:M},params:{interval:a,currency:o},products:P,flags:{isMay13PackagingChangesEnabled:D}}),E=P.some((e=>(0,q().Jf)(i,e,a)));try{const e=await ie().updateSubscription({environment:l,spaceStore:j,desiredState:(0,Y().Vr)(w,N,a),paymentData:p,billingEmail:r,coupon:m&&"coupon"===m.source?m.code:void 0,customerName:n.name,businessName:n.businessName,addressLine1:n.addressLine1,addressCity:n.city,addressZip:n.zipCode,addressState:n.state,addressCountry:n.country,vatId:h??void 0,promoCodeId:m&&"promo_code"===m.source?m.code:void 0,from:x??"subscription_upgrade_modal",useTestClock:v,sessionId:c,inAppOffer:E?i:void 0,postUpgradeCallback:S});await ie().handlePaymentIntentNextActions({paymentIntentData:e,stripe:y,onSuccess:()=>{A().dI(l,{payment_intent_id:e.paymentIntentId,modal_id:c,modal_type:u})},onFailure:async()=>{await async function(e){const{updateSubscriptionResponse:t,environment:n,modalId:r,modalType:a,spaceStore:i,currencyCode:o,intl:s}=e,{subscriptionStatus:l,paymentIntentId:d}=t,c=i.id;await Z().L.resetData(n,{spaceId:c});const u=await Z().L.awaitData(n,{spaceId:c})??[];L().ui({message:"trialing"===l?(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed.trial",defaultMessage:"Please provide an alternate payment method to complete your upgrade."}):(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."}),showCancel:!1,keepFocus:!1,disableBackgroundDismiss:!0,items:[{label:(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed.pay_invoice",defaultMessage:"Complete payment"}),onAccept:()=>{if(A().GB(n,{payment_intent_id:d,modal_id:r,modal_type:a}),(0,re().Ug)())return(0,X().U)(n,i,o,[u[0]],s);window.open(t.invoiceUrl,"_blank")},color:"red"},{label:(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed.cancel",defaultMessage:"Cancel upgrade"}),onAccept:async()=>{A().WB(n,{payment_intent_id:t.paymentIntentId,modal_id:r,modal_type:a}),z().m({message:oe.cancelFailedSubscription}),await ie().cancelSubscription({environment:n,spaceStore:i,from:"subscription_upgrade_modal-failed_payment"}),z().V()}}]})}({updateSubscriptionResponse:e,environment:l,modalId:c,spaceStore:j,currencyCode:o,intl:b})}}),m&&(0,R().rP)(l.currentUser.id)}catch{A().WB(l,{modal_id:c,modal_type:u})}}var le=()=>n(37644),de=()=>n(384055),ce=()=>n(910200),ue=()=>n(724574),pe=()=>n(980759),me=()=>n(969426),ge=()=>n(242111),fe=()=>n(764227),ye=()=>n(33368),ve=()=>n(275831),he=()=>n(142914),be=()=>n(614893),xe=()=>n(713628),Se=()=>n(700432),je=()=>n(201009),Ie=()=>n(847184),Ce=()=>n(541750),Ae=()=>n(499670),we=()=>n(174114),_e=()=>n(245388),Me=()=>n(259460);function Te(e){let{header:t,paymentContent:n,orderOptions:r,footer:a,showDismissButton:s}=e;const l=(0,i().v3)(),{isMobile:d}=(0,i().Y0)(),c=(0,o().K8)((()=>(0,Me().A)(l)),[l])||!r,u=function(e){return(0,we().IS)((()=>({wrapper:{...!e&&{minWidth:506}},mobile:{display:"grid",gridTemplateRows:"1fr auto",overflow:"hidden auto"}})),[e])}(d),p=(0,te.jsxs)(_().Y1,{direction:c?"vertical":"horizontal",gap:c?20:32,style:{...d&&u.mobile},children:[(0,te.jsx)(_().Y1,{direction:"vertical",gap:c?20:28,width:c?"fill":420,children:n}),(0,te.jsxs)(_().Y1,{direction:"vertical",gap:c?20:28,width:c?"fill":310,children:[r,a]})]});return(0,te.jsxs)(_().Y1,{direction:"vertical",gap:c?28:36,padding:32,width:"hug",height:"hug",style:u.wrapper,children:[t,p,s&&(0,te.jsx)(_e().Rz,{})]})}n(403517);var ke=()=>n(884373),Pe=()=>n(966789),De=()=>n(75199),Ue=()=>n(338578);function Ne(e){var t;const{state:n,data:r,promo:i,billingData:l,dueAtPeriodEnd:d,billingInterval:u,products:p}=e,{coupon:m,calculatingTax:g,taxAmount:f}=n,[v,h]=a.useState(!1),b=De().Ux(i),x=(0,o().K8)((()=>y().A.state.selectedCurrencyCode??"USD"),[]),S=(0,Ue().o)(),j=(0,c().V)()??1;if(0===S.length)return(0,te.jsx)(Pe().A,{});const I=p.map((e=>(0,Y().vk)(S,{product:e,interval:u,currency:x}))),C={numSeats:j,numCustomHostnames:(null===(t=(0,s().KH)(l,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0},A=I.map((e=>(0,Y().ng)(e,C))),w=p.some((e=>(0,q().Jf)(m,e,u))),M=De().G5({items:A,coupon:w?m:void 0});let T;if(0!==S.length&&"year"===u){const e=w?"year":"month",t=p.map((t=>(0,Y().vk)(S,{product:t,interval:e,currency:x}))).map((e=>(0,Y().ng)(e,C)));T=De().G5({items:t}).withMultipliedAmount(w?1:12)}const k=T?T.minus(M):void 0,P=De().g3({calculatingTax:g,taxAmount:f,currencyCode:x}),D=De().jn({items:A,promo:b}),U=De().o2(r,x),N=M.plus(P).minus(D).minus(U),E=N.amount<0?N.withMultipliedAmount(0):N,B=function(e){var t;let{hasDiscount:n,dueAtPeriodEnd:r,billingData:a,billingInterval:i}=e;if(n)return{chargeType:"immediate"};if(r&&null!=a&&null!==(t=a.subscription)&&void 0!==t&&t.currentPeriodEnd)return{chargeType:"nextPeriod",periodEnd:a.subscription.currentPeriodEnd};return{chargeType:void 0,billingInterval:i}}({hasDiscount:0!==D.amount&&0!==U.amount,dueAtPeriodEnd:d,billingData:l,billingInterval:u});return(0,te.jsxs)(_().Y1,{gap:2,children:[(0,te.jsx)(Ie().BB,{total:E,handleToggleExpanded:()=>h((e=>!e)),isExpanded:v,discount:D,accountBalance:U,annualPriceDifference:k,coupon:w?m:void 0,isTotalLoading:g,...B}),(0,te.jsx)(Ie()._z,{isExpanded:v,children:(0,te.jsxs)(_().Y1,{gap:12,children:[(0,te.jsx)(Ie().f5,{items:A,coupon:w?m:void 0}),(0,te.jsx)(ke().A,{size:1}),(0,te.jsx)(Ie().Qs,{subtotal:M,tax:P,discount:D,accountBalance:U,showDiscountLine:0!==D.amount&&b&&!m,isCalculatingTax:g,subtotalMonthly:T})]})})]})}var Ee=()=>n(905467);function Be(e){const{state:t,data:n,spaceStore:l,spaceViewStore:d}=e,c=(0,i().v3)(),p=(0,I().tz)(),B=(0,r().useStripe)(),R=(0,r().useElements)(),{isMobile:Y,isPhone:q}=(0,i().Y0)(),L=(0,f().lh)({spaceId:l.id}),z=(0,Se().q)(),J=(0,o().K8)((()=>U().default.state.currentUserRootStore),[]),Z=(0,ve().p)(),X=(0,o().K8)((()=>{if(u().A.state.open)return u().A.state.dismissMobilePlansModal}),[]),ee=(0,o().O$)(N().e),{availableCurrencyCodes:ie,currencyCode:oe}=(0,o().K8)((()=>({availableCurrencyCodes:y().A.availableCurrencyCodes,currencyCode:y().A.selectedCurrencyCode??"USD"})),[]),we=(0,he().A)(),_e=(0,D().L)(),Me=(0,f().UL)(),ke=(0,ye().D)(),Pe=(0,o().K8)((()=>t.addOnFeature??(0,S()._y)(t.subscriptionTier)),[t.addOnFeature,t.subscriptionTier]),De=(0,o().K8)((()=>"ai"===Pe&&(0,re().u1)()),[Pe]),Ue=(0,Ae().v1)(L,Z,Pe);(0,v().l)((()=>{const e=g().qc(n);u().A.update((t=>{var r;return{...t,appliedPromo:e?null===(r=n.customerData)||void 0===r?void 0:r.stripe.promo:void 0}})),e&&void 0!==(null==L?void 0:L.address)&&u().A.setAddressField(null==L?void 0:L.address)}));const Be=Ue&&(0,s().eh)(L,"ai"),Oe=(0,o().K8)((()=>(0,re().Le)()),[]),Re=(0,fe().YS)({product:Pe,currentSubscriptionTier:(0,s().AI)(L),salesStatus:z,packagingChangesEnabled:Oe}),Ke=(0,o().K8)((()=>{const e=[Pe];return!((0,s().ji)(L)??[]).includes("ai")&&!Ue&&!Oe&&e.push("ai"),e}),[Pe,L,Ue,Oe]),[{billingInterval:Ye,addOnFeature:qe,name:Fe,businessName:Le,vatId:ze,termsAccepted:We},Ve]=a.useState({billingInterval:"ai"===Pe?"year":"month",name:_e??"",businessName:"",vatId:we?"":void 0,termsAccepted:void 0}),[Ge,He]=a.useState({}),[Qe,Je]=a.useState(),[Ze,$e]=a.useState(!1),Xe=a.useCallback((e=>{Je(void 0),e.name&&He((e=>({...e,name:void 0}))),void 0!==e.termsAccepted&&He((e=>({...e,termsAccepted:void 0}))),Ve((t=>({...t,...e})))}),[]),et=a.useMemo((()=>(0,C().sb)((0,C().oE)([Pe,qe,...Be?["ai"]:[]]))),[Pe,qe,Be]),[tt,nt]=a.useState(!1);a.useEffect((()=>{Me&&!t.coupon&&(u().A.update((e=>({...e,coupon:"ai_fifty_percent"}))),async function(){await(0,de().x3)({environment:c,hasReceived:!1,offerType:"add_on_upgrade_flow",coupon:"ai_fifty_percent"})}())}),[t.coupon,Me,c]),a.useEffect((()=>{ke&&("month"===Ye&&"plus"===Pe&&(u().A.update((e=>({...e,coupon:"resurrection_offer"}))),tt||(!async function(){await(0,de().x3)({environment:c,hasReceived:!1,offerType:"resurrection_flow",coupon:"resurrection_offer"})}(),nt(!0))),"year"===Ye&&"plus"===Pe&&u().A.update((e=>({...e,coupon:void 0}))))}),[t.coupon,ke,Ye,Pe,c,tt]),a.useEffect((()=>{ce().Qe({environment:c,billingInterval:Ye,vatId:ze,billingData:L,addOn:qe,onlyShowAddOn:"ai"===Pe})}),[c,Ye,qe,ze,L,Pe]);const rt={month:(0,be().H)({billingInterval:"month",priceStore:y().A,products:Ke}),year:(0,be().H)({billingInterval:"year",priceStore:y().A,products:Ke})},at=(0,xe()._)({asyncPrice:rt[Ye??"month"].ai}),it=(0,Ae().tA)(L,Me),ot=(0,xe()._)({asyncPrice:rt.month[Pe]}),st=(0,xe()._)({asyncPrice:rt.year[Pe]}),lt=a.useCallback((()=>{const e={};return(0,P().r)(Fe)||(e.name=p.formatMessage({id:"spaceSubscriptionUpgradeModal.name.required.error",defaultMessage:"Please enter a valid name."})),De&&!We&&(e.termsAccepted=p.formatMessage({id:"spaceSubscriptionUpgradeModal.terms.required.error",defaultMessage:"You must opt in to upgrade your plan"})),He((t=>({...t,...e}))),e}),[Fe,p,We,De]),dt=a.useCallback((async e=>{Je(void 0);const n=lt();if(!(0,C().Im)(n))return;if(A().Fp(c,{modal_id:t.sessionId,from:t.from}),$e(!0),!R||!B)return(0,h().log)({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}}),Je(p.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})),void $e(!1);const r=await(0,k().Pu)({environment:c,spaceId:l.id})??1,a=await async function(e){const{billingEmail:t,coupon:n,currencyCode:r,environment:a,elements:i,billingInterval:o,name:s,businessName:l,vatId:d,intl:c,modalId:u,promo:p,quantity:g,selectedProducts:f,stripe:y,useTestClock:v,from:h,postUpgradeCallback:b}=e,x=await async function(e){const{modalId:t,modalType:n,environment:r,intl:a,elements:i,stripe:o}=e,s=a.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."}),{error:l}=await i.submit();if(l)return A().qC(r,{error:"could not submit form",error_type:"payment_method",modal_id:t,modal_type:n}),{error:s};const{error:d,paymentMethod:c}=await o.createPaymentMethod({elements:i});if(d)return A().qC(r,{error:d.message,error_type:"payment_method",modal_id:t,modal_type:n}),A().cr(r,{error:d.code,stripe_decline_code:d.decline_code}),{error:m().translateStripeError(a,d)};if(!c)return A().qC(r,{error:"could not create token",error_type:"payment_method",modal_id:t,modal_type:n}),{error:s};const u={type:"paymentMethodId",value:c.id},p=c.billing_details.address;return{paymentData:u,address:{zipCode:(null==p?void 0:p.postal_code)??"",country:F()._q.includes(c.type)?"KR":(null==p?void 0:p.country)??""}}}({modalId:u,environment:a,intl:c,elements:i,stripe:y});if("error"in x)return{error:x.error};return void(await se({address:{name:s??"",businessName:l??"",addressLine1:"",addressLine2:"",zipCode:x.address.zipCode??"",city:"",state:"",country:x.address.country??""},billingEmail:t,billingInterval:o,coupon:n,currencyCode:r,environment:a,modalId:u,paymentData:x.paymentData,promo:p,quantity:g,selectedProducts:f,stripe:y,vatId:d,useTestClock:v,intl:c,from:h,postUpgradeCallback:b}))}({billingEmail:g().Nl(t,L),coupon:t.coupon,currencyCode:oe,environment:c,elements:R,intl:p,billingInterval:Ye,name:Fe,businessName:Le,vatId:we?ze:void 0,modalId:t.sessionId,promo:t.appliedPromo,quantity:r,selectedProducts:et,stripe:B,useTestClock:e.useTestClock,from:t.from,postUpgradeCallback:t.postUpgradeCallback});return null!=a&&a.error?(Je(a.error),void $e(!1)):(function(e){const{environment:t,modalId:n}=e;u().A.reset(),A().OC(t,{modal_id:n})}({environment:c,modalId:t.sessionId}),"ai"===Pe?(E().A.reset(),function(e){const{environment:t,spaceStore:n,spaceViewStore:r,intl:a,currentUserRootStore:i}=e,o=(0,Q().getAIUpgradeTemplate)({intl:a});if(!o)throw new Error("AI template not found");if(!i)throw new Error("Cannot create BlockStore: currentUserRootStore not found");const s=$().Bv.createChildStore(i,{table:K().ev,id:o.rootId});(0,G().Fq)({environment:t,blockStore:s,spaceStore:n,spaceViewStore:r,hideModal:!0,disableRedirect:!0,showDuplicationStartedToast:!1,showDuplicationFinishedToast:!1}).then((e=>{e&&V().D6({label:a.formatMessage({id:"spaceSubscriptionUpgradeModal.upgradeAi.success",defaultMessage:"You now have unlimited Notion AI"}),style:{gap:8,display:"flex"},right:(0,te.jsx)(ne,{onClick:()=>{W().uK({environment:t,store:e,visitType:H().ig.Link,pageVisitSource:O().y8.Duplicate})}})})})).catch((e=>{h().log({from:"client/checkoutActions",level:"error",type:"aiUpgrade.duplicationFailed",data:{message:"AI Upgrade duplication failed.  Block store not found"}})}))}({environment:c,spaceStore:l,spaceViewStore:d,intl:p,currentUserRootStore:J}),void(Y&&(null==X||X()))):void(q?null==X||X():w().Ow({currentTab:"billing"})))}),[L,Ye,Le,oe,J,R,c,p,Y,q,Fe,X,Pe,et,l,d,t,B,lt,we,ze]),ct=(0,o().K8)((()=>(0,re().Ir)()&&!1),[]),ut=[{buttonType:"primary",isDisabled:Ze,isLoading:Ze,label:x().Kq.some((e=>e===Pe))?(0,te.jsx)(I().sA,{id:"subscriptionUpgradeModal.upgradeButton.upgradeToPlan",defaultMessage:"Upgrade to {plan}",values:{plan:(0,j().u2)({product:Re,intl:p})}}):(0,te.jsx)(I().sA,{id:"subscriptionUpgradeModal.upgradeButton.upgradeAi",defaultMessage:"Upgrade now"}),onClick:()=>dt({useTestClock:!1})}];ct&&ut.push({buttonType:"primary",isDisabled:Ze,label:"🚧 Upgrade with Test Clock 🚧",onClick:()=>dt({useTestClock:!0})});const pt=["business","enterprise"].includes(Pe)?[{buttonType:"outline",label:(0,te.jsxs)(_().Y1,{direction:"horizontal",gap:6,align:"center",children:[(0,te.jsx)(M().Q,{iconGroup:b,variantName:"default",colorName:"primary"}),(0,te.jsx)(I().sA,{id:"spaceSubscriptionSettings.upgradeModal.contactSales",defaultMessage:"Contact sales"})]}),onClick:()=>(0,le().lK)({initialQuestion:"enterprise"===Pe?"interest_in_enterprise":"interest_in_business",openedFrom:"enterprise"===Pe?"enterprise_checkout_modal":"business_checkout_modal"})}]:void 0;if(!ee)return(0,te.jsx)(je()._,{});const mt=(0,Ae().P8)({product:Re,coupon:t.coupon,isOnTrialWithAiProduct:Be,from:t.from,may13PackagingChangesEnabled:Oe});Ue&&(mt.subtitle=(0,te.jsx)(T().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",customStyles:{maxWidth:525},children:(0,te.jsx)(I().sA,{id:"subscriptionUpgradeModal.upgradeDuringTrial",defaultMessage:"Unlimited access to our most loved team features. If you choose not to upgrade, you will be on a free plan with restricted usage."})}));const gt=(0,ue().f)({headerContent:mt,primaryProduct:Pe});return(0,te.jsx)(Te,{showDismissButton:!0,header:(0,te.jsx)(Ie().K4,{...mt,image:gt}),paymentContent:(0,te.jsxs)(_().Y1,{gap:14,children:[(0,te.jsx)(Ie().ck,{formData:{name:Fe,businessName:Le,vatId:ze},onChangeFormData:Xe,errors:Ge,modalId:t.sessionId}),(0,te.jsx)(Ee().q,{modalId:t.sessionId})]}),orderOptions:it?null:(0,te.jsxs)(_().Y1,{gap:20,children:[(0,te.jsx)(Ie().TJ,{selectedBillingInterval:Ye,monthlyUnitPrice:ot,yearlyUnitPrice:st,onChange:e=>{A().bT(c,{billingInterval:e,modal_id:t.sessionId}),Xe({billingInterval:e})},product:Pe,coupon:t.coupon}),Ke.includes("ai")&&"ai"!==Pe?(0,te.jsx)(Ie().nB,{selectedAddOn:qe,unitPrice:at,onChange:e=>{A().Gs(c,{addOnFeatures:e?[e]:void 0,modal_id:t.sessionId}),Xe({addOnFeature:e})},coupon:t.coupon,billingInterval:Ye}):null,(0,te.jsx)("div",{style:{position:"absolute",top:-8,right:0},children:(0,te.jsx)(me().y,{availableCurrencyCodes:ie,selectedCurrencyCode:oe,onSelectCurrency:ae().cP,from:"upgrade_modal"})})]}),footer:(0,te.jsxs)(_().Y1,{gap:16,children:[(0,te.jsx)(Ne,{state:t,data:n,billingInterval:Ye,products:et,promo:t.appliedPromo,billingData:L,dueAtPeriodEnd:Ue}),De?(0,te.jsx)(Ce().P,{isChecked:Boolean(We),onChange:e=>{Xe({termsAccepted:e})},error:Ge.termsAccepted,message:(0,te.jsx)(I().sA,{defaultMessage:"Notion {planName} will auto-renew each month at {money}/seat plus taxes unless canceled. Cancel via the Billing tab prior to renewal to avoid future charges",id:"checkout.termsOfService",values:{money:ot?(0,te.jsx)(ge().v,{cost:ot,trailingZeroDisplay:"stripIfInteger"}):"-",planName:(0,j().u2)({product:Re,intl:p})}})}):null,(0,te.jsx)(Ie().iu,{primaryButtons:ut,secondaryButtons:pt,termsOfService:(0,te.jsx)(pe().w,{showTrialEndDisclaimer:(0,s().TB)(L)&&!Ae().v1,products:et,showProductTerms:!De})}),Qe?(0,te.jsx)(T().D,{styleName:"Caption-12px/Regular",colorName:"uiRedPrimary",children:Qe}):null]})})}function Oe(e){let{data:t,spaceStore:n,spaceViewStore:r}=e;const s=(0,i().v3)();(0,a.useEffect)((()=>{p().o2({environment:s,spaceStore:n})}),[s,n]);const c=(0,f().lh)({spaceId:n.id}),m=(0,o().K8)((()=>u().A.state),[]);return(0,te.jsx)(l().s,{ariaLabelledBy:d().Kvs,isOpen:m.open,onClosed:()=>p().dl(s),animateSizeTransition:!1,areaConstraint:{width:{type:"min",length:400}},render:()=>m.open?(0,te.jsx)("div",{style:{overflowY:"auto"},children:(0,te.jsx)(Re,{state:m,billingData:c,data:t,spaceStore:n,spaceViewStore:r})}):null})}function Re(e){const{state:t,billingData:n,data:i,spaceStore:l,spaceViewStore:d}=e,{subscriptionTier:u,onlyShowAddOn:p,calculatingTax:f,temporaryBillingInterval:v,taxAmount:h,addOnFeature:b,coupon:x}=t,S=(0,o().K8)((()=>(0,s().Ry)(n)??y().A.selectedCurrencyCode),[n]),j=(0,c().V)()??1,{payAmount:I}=g().TQ({subscriptionTier:u,memberCount:j,currencyCode:S,promo:t.appliedPromo,data:i,onlyShowAddOn:p,calculatingTax:f,billingInterval:v??"year",taxAmount:h,addOnFeature:b,coupon:x}),C=(0,m().useElementsOptions)({type:"subscription",amount:I.amount,currency:I.currencyCode}),A=(0,a.useMemo)((()=>(0,m().getStripe)()),[]);return(0,te.jsx)(r().Elements,{stripe:A,options:C,children:(0,te.jsx)(Be,{spaceViewStore:d,state:t,data:i,spaceStore:l})})}},905467:(e,t,n)=>{n.d(t,{q:()=>v});var r=()=>n(353420),a=(r(),n(242343),()=>n(237385)),i=()=>n(269280),o=()=>n(803290),s=()=>n(653998),l=()=>n(421650),d=()=>n(421338),c=()=>n(517198),u=()=>n(485966),p=()=>n(172553),m=()=>n(847184),g=()=>n(76513),f=()=>n(506806),y=n(163643);function v(e){const{modalId:t,style:n}=e,d=(0,o().O$)(f().D),c=(0,a().v3)();(0,i().w)((()=>{f().D.setState(!0)}));const v={defaultValues:{billingDetails:(0,o().K8)((()=>{const e=u().default.state.currentUserStore;return{email:null==e?void 0:e.getEmail(),name:null==e?void 0:e.getName()}}),[])},terms:{card:"never"}};return(0,y.jsxs)(m().iy,{title:d?(0,y.jsx)(g().y,{labelOnly:!0}):(0,y.jsx)(s().sA,{id:"subscriptions.checkout.paymentMethod.title",defaultMessage:"Payment method"}),style:n,children:[d?(0,y.jsx)(h,{}):null,(0,y.jsx)(r().PaymentElement,{options:v,onChange:e=>{l().C3(c,{event:e,modal_id:t}),p().A.update((e=>{if(!e.open)return e;const{paymentData:t,...n}=e;return n}))},onReady:()=>f().D.setState(!1)})]})}function h(){return(0,y.jsxs)(d().Y1,{gap:12,children:[(0,y.jsxs)(d().Y1,{direction:"horizontal",gap:12,children:[(0,y.jsx)(c().A,{style:{width:"50%",height:60,borderRadius:6}}),(0,y.jsx)(c().A,{style:{width:"50%",height:60,borderRadius:6}})]}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{})]})}},980759:(e,t,n)=>{n.d(t,{w:()=>x});n(725707),n(113085);var r=n(242343),a=()=>n(237385),i=()=>n(803290),o=()=>n(174114),s=()=>n(395665),l=()=>n(653998),d=()=>n(818369),c=()=>n(701270),u=()=>n(611824),p=()=>n(392608),m=()=>n(863969),g=()=>n(172553),f=()=>n(33368),y=()=>n(879205),v=()=>n(31448),h=n(163643);const b=function(){const e=(0,o().IS)((e=>({discountDescription:{alignItems:"center",color:e.text.secondary,fontSize:12,lineHeight:v().K_.UISmall.desktop}})),[]);return(0,h.jsx)("div",{style:e.discountDescription,children:(0,h.jsx)(l().sA,{id:"spaceSubscriptionSettings.orderOptions.estimatedPriceWarning",defaultMessage:"The final amount due may be impacted by prorations and member changes since your last invoice."})})};function x(e){const{products:t,showTrialEndDisclaimer:n,showProductTerms:r=!0}=e,a=(0,o().IS)((()=>({termsOfService:{display:"flex",flexDirection:"column",gap:12}})),[]),l=(0,i().K8)((()=>y().A.state.selectedCurrencyCode),[]),d=t.includes("ai"),u=t.some((e=>"ai"!==e)),p=void 0!==l&&"USD"!==l,m=(0,i().K8)((()=>{var e;return g().A.state.open?null===(e=g().A.state)||void 0===e?void 0:e.coupon:void 0}),[]),v=(0,f().D)()&&t.includes("plus")&&(0,s().u6)(m);return(0,h.jsx)(c().D,{styleName:"Body-12px/Regular",colorName:"secondary",children:(0,h.jsxs)("div",{style:a.termsOfService,children:[n?(0,h.jsx)(j,{}):null,r?(0,h.jsx)(S,{hasAi:d,hasPlan:u}):null,u&&v&&(0,h.jsx)(w,{}),p?(0,h.jsx)(_,{currencyCode:l}):null]})})}function S(e){let{hasAi:t,hasPlan:n}=e;return(0,h.jsxs)(h.Fragment,{children:[t&&!n?(0,h.jsx)(I,{}):null,t&&n?(0,h.jsx)(C,{}):null,!t&&n?(0,h.jsx)(A,{}):null]})}function j(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"spaceSubscriptionUpgradeModal.trialWillEndToday.message",defaultMessage:"Upgrading will end your trial and your workspace will be billed immediately."})})}function I(){const e=function(){const e=(0,a().v3)(),t=(0,m().O)(),[n,i]=(0,r.useState)();return(0,r.useEffect)((()=>{async function n(){var n;if(!t)return!1;const r=await d().callApi({eventName:"getSpaceMembershipUpdates",environment:e,data:{spaceId:t}});if("failed"===r.type)return!1;const a=!1===(null===(n=r.data[0])||void 0===n?void 0:n.isProcessed);i(!!a)}n()}),[e,t]),n}();return(0,h.jsxs)("div",{children:[(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.aiOnly",defaultMessage:"By continuing, you agree to the <aiTerms>Notion AI Product Specific Terms</aiTerms>.",values:{br:(0,h.jsx)("br",{}),aiTerms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("ai.terms"),external:!0,children:e})}}),e?(0,h.jsx)(b,{}):null]})}function C(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.planWithAi",defaultMessage:"By continuing, you agree to the <terms>Notion Terms and Conditions</terms> and <aiTerms>Notion AI Product Specific Terms</aiTerms>.",values:{br:(0,h.jsx)("br",{}),terms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("terms"),external:!0,children:e}),aiTerms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("ai.terms"),external:!0,children:e})}})})}function A(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.planOnly",defaultMessage:"By continuing, you agree to the <terms>Notion Terms and Conditions</terms>.",values:{terms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("terms"),external:!0,children:e})}})})}function w(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.planOnlyResurrection",defaultMessage:"Enjoy 50% off your first 3 months of billing, then standard rates apply. <learnMore>Learn more</learnMore>",values:{learnMore:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("resurrectionLearnMore"),external:!0,children:e})}})})}function _(e){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.currencyRateWarning",defaultMessage:"<terms>Learn about FX rates</terms>. Rates will refresh throughout the billing period.",values:{terms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("terms.currency.fxRates"),external:!0,children:e})}})})}}}]);