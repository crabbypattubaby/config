"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[45620],{50902:(e,t,n)=>{function a(e){return"string"==typeof e?e:"calendarId"in e?`${e.accountId}:${e.calendarId}`:`${e.accountId}:${e.id}`}function r(e){let{id:t,accountId:n,calendarId:a}=e;return`${n}:${a}:${t}`}n.d(t,{N:()=>a,z:()=>r})},174977:(e,t,n)=>{n.d(t,{MP:()=>d,oM:()=>l,tQ:()=>s,zn:()=>c});n(333225),n(494367),n(516262),n(573119),n(240480),n(950443),n(619601),n(725707),n(107652),n(491955),n(403517);var a=()=>n(975392),r=()=>n(76394),o=()=>n(707715),i=()=>n(50902);function c(e){return e.every((e=>{let{calendarId:t,accountId:n}=e;return o().A.getCalendarFetchedTime({calendarId:t,accountId:n})}))}function d(e){let{specificCalendarsFetched:t,calendarVisibilityOverrides:n,calendarApiResponse:o}=e;const c=new Set((t??[]).map(i().N)),d="calendarOverrides"===n.type?n.calendarOverrides:[],s=(0,a().pY)(d,i().N);return o.filter((e=>{const n=(0,i().N)(e);if(void 0!==t)return c.has(n);const a=s[n];return(0,r().O9)(a)?a.visible:e.selected})).map((e=>{let{id:t,accountId:n}=e;return{calendarId:t,accountId:n}}))}function s(e){let{calendarsThatWereUpdated:t,oldCalendarFetchedTimes:n,fetchTime:a}=e;const r={...n};for(const o of t)(!r[o]||r[o]<a)&&(r[o]=a);return r}function l(e){switch(e){case"events":return"connected_with_events";case"noEvents":return"connected_no_events";case"signedOut":return"disconnected";case"disconnectedAccount":case"missingScopes":return"connected_permissions_error";case"loadError":return"load_error";case"loading":return;default:return void(0,r().ub)(e)}}},427871:(e,t,n)=>{n.d(t,{rq:()=>x,w1:()=>M,k2:()=>k,F8:()=>U,qq:()=>H,tD:()=>D,m5:()=>R,X6:()=>O,Kq:()=>F,X8:()=>N,vA:()=>W,NC:()=>q});n(725707),n(491955),n(500234);var a=()=>n(486826),r=()=>n(642145),o=()=>n(975392),i=()=>n(76394),c=()=>n(818369),d=()=>n(759625),s=()=>n(84543),l=()=>n(199726),u=()=>n(181301),v=()=>n(196387),m=()=>n(485966),f=()=>n(836331),g=()=>n(540059),p=()=>n(965170),h=()=>n(174977),S=()=>n(50902);n(403517);function y(e){let{oldMap:t,newMap:n,keyGetter:a}=e;const o=new(r().A)(t.getOrderedValues(),a);for(const r of(null==n?void 0:n.getOrderedValues())??[]){const e=a(r);o.append(e,r,{keepOrdering:!0})}return o}var I=()=>n(542683),b=()=>n(627618);const _=b().object({required:{botId:b().uuid(),timeMin:b().number(),timeMax:b().number(),accounts:b().array(b().tuple([b().string(),b().object({required:{},optional:{}})])),calendars:b().array(b().tuple([b().string(),b().object({required:{},optional:{}})])),events:b().array(b().tuple([b().string(),b().object({required:{},optional:{}})])),calendarsToLastFetchedTime:b().record(b().string(),b().number())},optional:{}});const C=new class{constructor(){this.localStorageStore=new(n(146325).Ay)({namespace:"homeCalendarCache",important:!1,trackingType:"preference",maxValueLength:512e3})}waitUntilReady(){return this.localStorageStore.waitUntilReady()}get(e){let t;try{if(t=this.localStorageStore.get(e),void 0===t)return}catch{}if(t&&null===_.validator(t))return function(e){return{...e,accounts:r().A.fromJSON(e.accounts),calendars:r().A.fromJSON(e.calendars),events:r().A.fromJSON(e.events),calendarsToLastFetchedTime:Object.fromEntries(Object.entries(e.calendarsToLastFetchedTime).map((e=>{let[t,n]=e;return[t,a().c9.fromMillis(n)]})))}}(t);this.localStorageStore.remove(e)}set(e,t){try{this.localStorageStore.set(e,(n=t,{...n,accounts:n.accounts.toJSON(),calendars:n.calendars.toJSON(),events:n.events.toJSON(),calendarsToLastFetchedTime:Object.fromEntries(Object.entries(n.calendarsToLastFetchedTime).map((e=>{let[t,n]=e;return[t,n.toMillis()]})))}))}catch{}var n}remove(e){this.localStorageStore.remove(e)}};var w=()=>n(898253),V=()=>n(659952);class A{constructor(e,t,n,a){this.pendingInvocations=new Map,this.fn=e,this.coalesce=t,this.waitMs=n,this.options=a}enqueue(e){for(const[n,a]of this.pendingInvocations){const t=this.coalesce(n,e);if(t)return this.pendingInvocations.delete(n),this.pendingInvocations.set(t,a),void a.dequeueDebounced(t)}const t=(0,o().sg)(this.dequeue.bind(this),this.waitMs,this.options);this.pendingInvocations.set(e,{dequeueDebounced:t}),t(e)}dequeue(e){this.pendingInvocations.delete(e),this.fn.apply(null,e)}}var T=()=>n(707715);function M(e){let{environment:t,timeRange:n,analyticsContext:a}=e;const{currentSpaceViewStore:r}=m().default.state;if(!r)return;const o=r.getHomeCalendarConfigStore().getKeyStore("time_range");s().createAndCommit({userAction:"homeCalendarActions.changeUpcomingEventsTimeRange",environment:t,canUndo:!0,perform:e=>{d().KY({transaction:e,store:o,value:n})}}),(0,w().rP)({environment:t,calendarPanelContext:(0,w().sp)(a),newValue:n})}function O(e){var t;let{environment:n,filter:a,analyticsContext:r}=e;const{currentSpaceViewStore:o}=m().default.state;if(!o)return;const i=null===(t=o.getHomeCalendarConfigStore())||void 0===t||null===(t=t.getKeyStore("event_filters"))||void 0===t?void 0:t.getKeyStore(a),c=!(0,g().E)(a);s().createAndCommit({userAction:"homeCalendarActions.toggleCalendarEventFilter",environment:n,canUndo:!0,perform:e=>{d().KY({transaction:e,store:i,value:c})}});const l=(0,w().sp)(r);(0,w().jr)({environment:n,calendarPanelContext:l,filter:a,newValue:c})}function x(e){let{environment:t,botId:n,shouldLog:a,analyticsContext:r}=e;const{currentSpaceViewStore:o}=m().default.state;if(!o)return;const i=o.getHomeCalendarConfigStore().getKeyStore("selected_calendar_bot_id");if(i.getValue()!==n&&(0,u().pH)().find((e=>e.id===n))&&(s().createAndCommit({userAction:"homeCalendarActions.changeSelectedCalendarBot",environment:t,canUndo:!0,perform:e=>{d().KY({transaction:e,store:i,value:n})}}),a)){const e=(0,w().sp)(r);(0,w()._w)({environment:t,botId:n,calendarPanelContext:e})}}function k(e){let{environment:t}=e;const{currentSpaceViewStore:n}=m().default.state;if(!n)return;const a=n.getHomeCalendarConfigStore().getKeyStore("selected_calendar_bot_id");a.getValue()&&s().createAndCommit({userAction:"homeCalendarActions.clearSelectedCalendarBot",environment:t,canUndo:!0,perform:e=>{d().KY({transaction:e,store:a,value:void 0})}})}async function H(e){let{environment:t,currentSpaceViewStore:n,botId:r,timeRange:u,calendarAndAccountIds:g,forceRefetch:I,updateMethod:b,reason:_}=e;if(!n||!n.isReady()||!n.canRead())return"failure";const w=f().default.checkGate({gateName:"calendar_home_tile_caching"});if(!I){var A;let e=T().A.getStateForCurrentSpaceView();if(!e&&w&&(await C.waitUntilReady(),e=function(e){let{timeMin:t,botId:n}=e;const{currentSpaceViewStore:r}=m().default.state;if(!r)return;let o=C.get(r.id);if(o){const e=o.botId===n,i=t>=o.timeMin&&a().c9.fromMillis(t).plus({days:K}).toMillis()<=o.timeMax;e&&i?(o=P({state:o}).newState,T().A.updateStateForCurrentSpaceView((()=>o))):(C.remove(r.id),o=void 0)}return o}({timeMin:u.timeMin,botId:r})),(null===(A=e)||void 0===A?void 0:A.botId)===r)if(g){if((0,h().zn)(g))return"skipped"}else if((0,h().zn)((0,V().GF)({botId:r,currentSpaceViewStore:n})))return"skipped"}const M=(0,V().AU)({spaceViewStore:n,botId:r,specificCalendars:g}),O=v().default.DO_NOT_USE_markLegacy("home.calendar.get_calendar_events_all"),x=await c().callApi({eventName:"getCalendarEvents",environment:t,data:{botId:r,timeMin:u.timeMin,timeMax:u.timeMax,orderBy:"startTime",calendars:g,calendarVisibilityOverrides:"mirrorWithCron"===M.type?void 0:M.calendarOverrides,userTimeZone:(0,l().s1)().timeZone,reason:Array.isArray(_)?(0,o().sb)(_).sort().join(","):_}});if("success"!==x.type)return"failure";g||v().default.DO_NOT_USE_measureLegacy(O,{environment:t});const{accounts:k,calendars:H,events:E}=x.data,D=(0,h().MP)({calendarApiResponse:H,specificCalendarsFetched:g,calendarVisibilityOverrides:M});return T().A.updateStateForCurrentSpaceView((e=>{let t;switch(b){case void 0:case"merge":t=e;break;case"replace":t=void 0;break;default:(0,i().ub)(b)}const o=function(e){let{oldState:t,newState:n,updatedCalendars:a,fetchTime:r}=e;const o=!t||n.botId!==t.botId,c=(0,h().tQ)({calendarsThatWereUpdated:a.map(S().N),oldCalendarFetchedTimes:o||null==t?void 0:t.calendarsToLastFetchedTime,fetchTime:r});if(!t||o)return{...n,calendarsToLastFetchedTime:c};const d={...t,calendarsToLastFetchedTime:c};for(const s of(0,i().WP)(n))switch(s[0]){case"accounts":d.accounts=y({oldMap:t.accounts,newMap:n.accounts,keyGetter:e=>{let{id:t}=e;return t}});break;case"events":d.events=(0,p().$z)({events:t.events,calendars:t.calendars,updatedCalendarAndAccountIds:a,newEvents:n.events.getOrderedValues()});break;case"botId":d.botId=n.botId;break;case"timeMin":d.timeMin=Math.max(t.timeMin,n.timeMin);break;case"timeMax":d.timeMax=Math.min(t.timeMax,n.timeMax);break;case"calendars":d.calendars=y({oldMap:t.calendars,newMap:n.calendars,keyGetter:S().N});break;default:(0,i().ub)(s[0])}return d}({oldState:t,newState:(0,p().IC)({botId:r,accounts:k,calendars:H,events:E,timeMin:u.timeMin,timeMax:u.timeMax}),updatedCalendars:D,fetchTime:a().c9.now()});return w&&C.set(n.id,o),o})),function(e){let{environment:t,spaceViewStore:n,botId:a,calendarResponse:r}=e;const o=n.getHomeCalendarVisibilityConfig(a);if((0,V().Xg)({spaceViewStore:n,botId:a}))return;const i=(0,V().NU)({currentConfig:null==o?void 0:o.calendarVisibility,calendars:r});if("noChanges"===i.result)return;s().createAndCommit({userAction:"homeCalendarActions.populateCalendarConfigWithCalendarResponse",environment:t,canUndo:!0,perform:e=>{d().KY({transaction:e,store:n.getHomeCalendarConfigStore().getKeyStore("shownCalendars").getKeyStore(a).getKeyStore("calendarVisibility"),value:i.newConfig})}})}({environment:t,spaceViewStore:n,botId:r,calendarResponse:H}),"success"}const E=(0,o().sg)(H,1e3,{leading:!1,trailing:!0});const D=function(e,t,n,a){const r=new A(e,t,n,a);return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.enqueue(t)}}(H,(function(e,t){let n,[a]=e,[r]=t;if(a.environment!==r.environment||a.currentSpaceViewStore!==r.currentSpaceViewStore||a.botId!==r.botId||a.timeRange.key!==r.timeRange.key)return!1;const i={environment:a.environment,currentSpaceViewStore:a.currentSpaceViewStore,botId:a.botId,timeRange:{key:a.timeRange.key,timeMin:Math.max(a.timeRange.timeMin,r.timeRange.timeMin),timeMax:Math.max(a.timeRange.timeMax,r.timeRange.timeMax)},reason:(0,o().Bq)([a.reason,r.reason]),forceRefetch:a.forceRefetch||r.forceRefetch};return n=a.calendarAndAccountIds&&r.calendarAndAccountIds?{...i,calendarAndAccountIds:(0,o().hS)([...a.calendarAndAccountIds,...r.calendarAndAccountIds],S().N)}:{...i,updateMethod:"replace"===a.updateMethod||"replace"===r.updateMethod?"replace":"merge"},[n]}),2e3+2e3*Math.random(),{maxWait:5e3});function F(e){let{environment:t,botId:n,mirrorWithNotionCalendar:a,analyticsContext:r}=e;const{currentSpaceViewStore:o}=m().default.state;if(!o)return;const i=o.getHomeCalendarConfigStore().getKeyStore("shownCalendars").getKeyStore(n);s().createAndCommit({userAction:"homeCalendarActions.toggleCalendarMirroring",environment:t,canUndo:!0,perform:e=>{const t=a?void 0:(0,V().cL)(T().A.getCurrentCalendars()??[]);d().KY({transaction:e,store:i,value:{mirrorWithNotionCalendar:a,calendarVisibility:t}})}});const c=(0,w().sp)(r),l=a;(0,w().m3)({environment:t,calendarPanelContext:c,newValue:l}),E({environment:t,currentSpaceViewStore:o,botId:n,timeRange:(0,I().M)(),forceRefetch:!1,reason:"toggle_mirroring"})}function W(e){let{environment:t,botId:n,calendarId:a,accountId:r,newIsVisible:o,analyticsContext:i}=e;const{currentSpaceViewStore:c}=m().default.state;if(!c)return;const l=c.getCalendarVisibilityStore({botId:n,calendarId:a,accountId:r});s().createAndCommit({userAction:"homeCalendarActions.toggleCalendarVisibility",environment:t,canUndo:!0,perform:e=>{d().KY({transaction:e,store:l,value:o})}}),(0,w().J3)({environment:t,calendarPanelContext:(0,w().sp)(i),calendarId:a,accountId:r,newValue:o}),E({environment:t,currentSpaceViewStore:c,botId:n,timeRange:(0,I().M)(),calendarAndAccountIds:[{calendarId:a,accountId:r}],forceRefetch:!1,reason:"toggle_calendar_visibility"})}function N(e){var t;let{environment:n,botId:a,calendarId:r,accountId:i,newIsVisible:c}=e;const{currentSpaceViewStore:d}=m().default.state;if(!d)return;const s=T().A.getCalendar({calendarId:r,accountId:i});if(!s||s.selected===c)return;T().A.updateStateForCurrentSpaceView((e=>{if(!e)return;const t=(0,o().mg)(e),n=t.calendars.get((0,S().N)({accountId:i,calendarId:r}));if(!n||n.selected===c)return e;n.selected=c;return f().default.checkGate({gateName:"calendar_home_tile_caching"})&&C.set(d.id,t),t}));((null===(t=d.getHomeCalendarVisibilityConfig(a))||void 0===t?void 0:t.mirrorWithNotionCalendar)??!1)&&c&&D({currentSpaceViewStore:d,environment:n,botId:a,timeRange:(0,I().M)(),calendarAndAccountIds:[{calendarId:r,accountId:i}],forceRefetch:!1,reason:"calendar_visibility_change"})}function P(e){let{now:t=a().c9.now(),state:n}=e;const{events:o}=n,{timeZone:i}=(0,l().s1)(),c=new(r().A)(o.getOrderedValues().filter((e=>!(0,p().FC)(e,t,i))),S().z);return c.length===o.length?{didChange:!1,newState:n}:{didChange:!0,newState:{...n,timeMin:t.toMillis(),events:c}}}function R(e){let{now:t=a().c9.now(),currentSpaceViewStore:n}=e;if(!n)return;const r=T().A.getStateForCurrentSpaceView();if(!r)return;const{didChange:o,newState:i}=P({now:t,state:r});if(o){T().A.updateStateForCurrentSpaceView((()=>i));f().default.checkGate({gateName:"calendar_home_tile_caching"})&&C.set(n.id,i)}}const K=1;function U(){const{currentSpaceViewStore:e}=m().default.state;e&&(T().A.clearStateForCurrentSpaceView(),C.remove(e.id))}async function q(e){const{environment:t,botId:n,data:a}=e;return await c().callApi({eventName:"upsertCalendarMeetingNote",environment:t,data:{botId:n,...a}})}},540059:(e,t,n)=>{n.d(t,{E:()=>o,J:()=>i});var a=()=>n(485966);const r={all_day_events:!0,events_without_participants:!0,events_without_location:!0};function o(e){const{currentSpaceViewStore:t}=a().default.state;return(null==t?void 0:t.getHomeCalendarFilter(e))??r[e]}function i(e){let{event:t,eventFilters:n}=e;return(!1!==n.all_day_events||!t.isAllDay)&&(!(!1===n.events_without_participants&&!t.hasParticipants)&&!(!1===n.events_without_location&&!t.hasConferencingOrLocation))}},542683:(e,t,n)=>{n.d(t,{B7:()=>l,C0:()=>c,M:()=>s,P8:()=>u,_I:()=>v,iI:()=>d});var a=()=>n(942485),r=()=>n(850265),o=()=>n(76394),i=()=>n(485966);const c="three_days";function d(){const e=v();return{key:e,...l(e)}}function s(){const e="one_week";return{key:e,...l(e)}}function l(e){const t=Date.now();return{timeMin:t,timeMax:(0,a().A)((0,r().A)(t,{hours:23,minutes:59,seconds:59,milliseconds:999}),u(e)-1).getTime()}}function u(e){switch(e){case"one_day":return 1;case"two_days":return 2;case"three_days":return 3;case"one_week":return 7;default:(0,o().HB)(e)}}function v(){var e;const t=null===(e=i().default.state.currentSpaceViewStore)||void 0===e||null===(e=e.getHomeCalendarConfigStore())||void 0===e||null===(e=e.getKeyStore("time_range"))||void 0===e?void 0:e.getValue();switch(t){case"one_day":case"two_days":case"three_days":case"one_week":return t;case void 0:return c;default:return(0,o().ub)(t),c}}},642145:(e,t,n)=>{n.d(t,{A:()=>a});n(610931),n(362833),n(725707),n(491955),n(403517);class a{get length(){return this.orderedKeys.length}constructor(e,t){if(this.orderedKeys=void 0,this.keysToValues=void 0,!e&&!t)return this.orderedKeys=[],void(this.keysToValues={});if(!e||!t)throw new Error("Missing values or keyGetter in OrderedMap constructor");this.orderedKeys=e.map(t),this.keysToValues={};for(const n of e)this.keysToValues[t(n)]=n}append(e,t){let{keepOrdering:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{keepOrdering:!1};if(e in this.keysToValues){if(this.keysToValues[e]=t,n)return;this.orderedKeys=[...this.orderedKeys.filter((t=>t!==e)),e]}else this.orderedKeys.push(e),this.keysToValues[e]=t}delete(e){this.orderedKeys=this.orderedKeys.filter((t=>t!==e)),delete this.keysToValues[e]}get(e){return this.keysToValues[e]}getOrderedValues(){return this.orderedKeys.map((e=>this.keysToValues[e]))}hasKey(e){return e in this.keysToValues}toJSON(){return this.orderedKeys.map((e=>[e,this.keysToValues[e]]))}static fromJSON(e){const t=new a;return t.orderedKeys=e.map((e=>{let[t]=e;return t})),t.keysToValues=Object.fromEntries(e),t}}},659952:(e,t,n)=>{n.d(t,{AU:()=>s,GF:()=>c,NU:()=>u,Pj:()=>d,Xg:()=>m,cL:()=>l});n(362833),n(725707),n(324989),n(113085);var a=()=>n(975392),r=()=>n(76394),o=()=>n(707715),i=()=>n(50902);function c(e){const t=function(e){let{botId:t,currentSpaceViewStore:n}=e;const a=o().A.getCurrentCalendars()??[],r={};for(const o of a)r[(0,i().N)(o)]={calendarId:o.id,accountId:o.accountId,visible:d({spaceViewStore:n,botId:t,calendar:o})};return r}(e);return Object.values(t).flatMap((e=>{let{calendarId:t,accountId:n,visible:a}=e;return a?[{calendarId:t,accountId:n}]:[]}))}function d(e){let{spaceViewStore:t,botId:n,calendar:a}=e;return function(e){var t;let{spaceViewStore:n,botId:a,calendarId:r,accountId:o}=e;const i=null==n?void 0:n.getHomeCalendarVisibilityConfig(a);if(!i||m({spaceViewStore:n,botId:a}))return;return null===(t=i.calendarVisibility)||void 0===t||null===(t=t[o])||void 0===t?void 0:t[r]}({spaceViewStore:t,botId:n,calendarId:a.id,accountId:a.accountId})??a.selected}function s(e){let{spaceViewStore:t,botId:n,specificCalendars:a}=e;const o=t.getHomeCalendarVisibilityConfig(n);if(!o||!(0,r().O9)(null==o?void 0:o.calendarVisibility)||m({spaceViewStore:t,botId:n}))return{type:"mirrorWithCron"};const i=[];for(const[c,d]of(0,r().WP)(o.calendarVisibility??{}))for(const[e,t]of(0,r().WP)(d??{}))!(0,r().O9)(t)||a&&!a.some((t=>t.accountId===c&&t.calendarId===e))||i.push({accountId:c,calendarId:e,visible:t});return{type:"calendarOverrides",calendarOverrides:i}}function l(e){const t={};for(const{id:n,accountId:a,selected:r}of e)t[a]={...t[a],[n]:r};return t}function u(e){let{currentConfig:t,calendars:n}=e;const r=(0,a().mg)(t)??{};let o=!1;for(const{id:a,accountId:c,selected:d}of n){var i;void 0===(null===(i=r[c])||void 0===i?void 0:i[a])&&(r[c]={...r[c],[a]:d},o=!0)}return o?{result:"updated",newConfig:r}:{result:"noChanges"}}const v=!0;function m(e){let{spaceViewStore:t,botId:n}=e;if(!t||!n)return v;const a=t.getHomeCalendarVisibilityConfig(n);return(null==a?void 0:a.mirrorWithNotionCalendar)??v}},707715:(e,t,n)=>{n.d(t,{A:()=>i});n(725707),n(491955),n(403517);var a=()=>n(485966);class r extends(()=>n(129044))().default{getInitialState(){return{}}getCalendarMap(){var e;return null===(e=this.getStateForCurrentSpaceView())||void 0===e?void 0:e.calendars}getEvents(){var e;const t=null===(e=this.getStateForCurrentSpaceView())||void 0===e?void 0:e.events;return t?t.getOrderedValues():[]}getCalendarAndAccountIds(){const e=this.getCalendarMap();return e?e.getOrderedValues().map((e=>{let{id:t,accountId:n}=e;return{calendarId:t,accountId:n}})):[]}getStateForCurrentSpaceView(){const{currentSpaceViewStore:e}=a().default.state;if(e)return this.state[e.id]}update(e){super.update(e)}updateStateForCurrentSpaceView(e){const{currentSpaceViewStore:t}=a().default.state;t&&this.update((n=>({...n,[t.id]:e(n[t.id])})))}clearStateForCurrentSpaceView(){const{currentSpaceViewStore:e}=a().default.state;e&&this.update((t=>Object.fromEntries(Object.entries(t).filter((t=>{let[n]=t;return n!==e.id})))))}getCurrentCalendars(){var e;return null===(e=this.getStateForCurrentSpaceView())||void 0===e||null===(e=e.calendars)||void 0===e?void 0:e.getOrderedValues()}getAccount(e){var t;return null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.accounts)||void 0===t?void 0:t.get(e)}getCalendar(e){var t;return null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.calendars)||void 0===t?void 0:t.get("string"==typeof e?e:`${e.accountId}:${e.calendarId}`)}getCalendarsForAccount(e){var t;return(null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.calendars)||void 0===t?void 0:t.getOrderedValues().filter((t=>t.accountId===e)))??[]}getCurrentAccountIds(){var e;return(null===(e=this.getStateForCurrentSpaceView())||void 0===e||null===(e=e.accounts)||void 0===e?void 0:e.getOrderedValues().map((e=>e.id)))??[]}getCalendarFetchedTime(e){var t;const n="string"==typeof e?e:`${e.accountId}:${e.calendarId}`;return null===(t=this.getStateForCurrentSpaceView())||void 0===t?void 0:t.calendarsToLastFetchedTime[n]}}const o=new r;(0,n(996094).exposeDebugValue)("HomeCalendarStore",o);const i=o},739536:(e,t,n)=>{n.d(t,{$D:()=>o,J_:()=>c,RY:()=>r,V$:()=>i,cK:()=>d,qi:()=>s});n(610931),n(362833),n(403517);var a=()=>n(486826);function r(e){let{eventStartDate:t,eventEndDateInclusive:n,minDate:a,maxDateInclusive:r,timeZone:i}=e;const d=function(e){let{startAndEndDaysRange:t,minAndMaxDaysRange:n}=e;if(t.end<n.min)return;if(t.start>n.max)return;const{start:a,end:r}=t,{min:o,max:i}=n,c=a<o?o:a,d=r>i?i:r;return{start:c,end:d}}({startAndEndDaysRange:{start:c(t,i),end:c(n,i)},minAndMaxDaysRange:{min:c(a,i),max:c(r,i)}});if(!d)return[];const{start:s,end:l}=d;return o(s,l,i)}function o(e,t,n){const a=c(t,n);let r=c(e,n);const o=[];for(;r<=a;)o.push(r),r=i(r,n).plus({days:1}).toISODate();return o}function i(e,t){const[n,r,o]=c(e,t).split("-").map(Number);return a().c9.fromObject({year:n,month:r,day:o},{zone:t})}function c(e,t){const n=a().c9.fromISO(e,{zone:t});if(!n.isValid)throw new Error(`Invalid date string: ${e}`);return e.includes("T")?n.toISODate():e}function d(e,t){const n="en-US";return a().c9.fromISO(e,{zone:"UTC"}).setLocale(n).toLocaleString(a().c9.DATE_SHORT)===t.setLocale(n).toLocaleString(a().c9.DATE_SHORT)}function s(e,t,n){const a=i(e,n);return i(t,n).diff(a,"days").days}},896864:(e,t,n)=>{n.d(t,{Pf:()=>s,QL:()=>c,Sk:()=>d});var a=()=>n(76394);const r={1:e=>e.calendarHomeWidget.base.orange,2:e=>e.calendarHomeWidget.base.red,3:e=>e.calendarHomeWidget.base.red,4:e=>e.calendarHomeWidget.base.orange,5:e=>e.calendarHomeWidget.base.orange,6:e=>e.calendarHomeWidget.base.orange,7:e=>e.calendarHomeWidget.base.green,8:e=>e.calendarHomeWidget.base.green,9:e=>e.calendarHomeWidget.base.green,10:e=>e.calendarHomeWidget.base.green,11:e=>e.calendarHomeWidget.base.yellow,12:e=>e.calendarHomeWidget.base.yellow,13:e=>e.calendarHomeWidget.base.green,14:e=>e.calendarHomeWidget.base.blue,15:e=>e.calendarHomeWidget.base.blue,16:e=>e.calendarHomeWidget.base.blue,17:e=>e.calendarHomeWidget.base.purple,18:e=>e.calendarHomeWidget.base.purple,19:e=>e.calendarHomeWidget.base.gray,20:e=>e.calendarHomeWidget.base.gray,21:e=>e.calendarHomeWidget.base.pink,22:e=>e.calendarHomeWidget.base.pink,23:e=>e.calendarHomeWidget.base.purple,24:e=>e.calendarHomeWidget.base.purple},o={1:e=>e.calendarHomeWidget.base.purple,2:e=>e.calendarHomeWidget.base.green,3:e=>e.calendarHomeWidget.base.pink,4:e=>e.calendarHomeWidget.base.red,5:e=>e.calendarHomeWidget.base.yellow,6:e=>e.calendarHomeWidget.base.orange,7:e=>e.calendarHomeWidget.base.blue,8:e=>e.calendarHomeWidget.base.gray,9:e=>e.calendarHomeWidget.base.blue,10:e=>e.calendarHomeWidget.base.green,11:e=>e.calendarHomeWidget.base.red};function i(e){let{theme:t,color:n}=e;if("preset"===n.type){var i,c;if("calendar"===n.colorType)return null===(i=r[n.colorId])||void 0===i?void 0:i.call(r,t);if("event"===n.colorType)return null===(c=o[n.colorId])||void 0===c?void 0:c.call(o,t);(0,a().ub)(n)}var d;if("custom"===n.type)return null===(d=n.colorHexes)||void 0===d?void 0:d[t.mode].backgroundPrimary;(0,a().ub)(n)}function c(e){let{theme:t,calendarColor:n}=e;const a=n&&i({theme:t,color:n});return a||t.calendarHomeWidget.base.blue}function d(e){let{theme:t,eventColor:n,calendarColor:a}=e;const r=n&&i({theme:t,color:n});return r||c({theme:t,calendarColor:a})}function s(e){const{colorType:t,color:n,colorId:a}=e;return a?{type:"preset",colorId:a,colorType:t}:n?{type:"custom",colorHexes:n}:void 0}},898253:(e,t,n)=>{n.d(t,{IU:()=>f,sp:()=>m,qL:()=>V,_w:()=>I,rP:()=>_,V0:()=>h,G7:()=>p,np:()=>g,lv:()=>S,J3:()=>C,jr:()=>y,m3:()=>b});n(725707),n(491955),n(403517);var a=()=>n(137476),r=()=>n(818369);function o(e,t){r().callApi({eventName:"calendarTrack",environment:e,data:t})}var i=()=>n(485966),c=()=>n(707715),d=()=>n(540059),s=()=>n(542683),l=()=>n(659952);function u(e){let{state:t,calendars:n,event_filters:a,mirror_calendars:r,time_range:o,bot_id:i,view:c}=e;return{state:t,calendars:n,event_filters:a&&{all_day_events:a.all_day_events,events_without_participants:a.events_without_participants,events_without_location:a.events_without_location},mirror_calendars:r,time_range:o,bot_id:i,view:c}}function v(e){let{event_id:t,calendar_id:n,account_id:a,is_all_day:r,has_participants:o,conferencing_type:i,index:c,num_days_in_future:d}=e;return{event_id:t,calendar_id:n,account_id:a,is_all_day:r,has_participants:o,conferencing_type:i,index:c,num_days_in_future:d}}function m(e){var t,n,a;const r=i().default.state.currentSpaceViewStore,o=null===(t=c().A.getStateForCurrentSpaceView())||void 0===t?void 0:t.botId;return{state:e.panelState,calendars:r&&o&&(null===(n=c().A.getCurrentCalendars())||void 0===n?void 0:n.map((e=>({type:e.provider,calendarId:e.id,accountId:e.accountId,isShown:(0,l().Pj)({spaceViewStore:r,botId:o,calendar:e})})))),mirror_calendars:(0,l().Xg)({botId:o,spaceViewStore:r}),event_filters:{all_day_events:(0,d().E)("all_day_events"),events_without_participants:(0,d().E)("events_without_participants"),events_without_location:(0,d().E)("events_without_location")},time_range:(null==r||null===(a=r.getHomeCalendarConfigStore())||void 0===a?void 0:a.getKeyStore("time_range").getValue())??s().C0,bot_id:o,view:e.view}}function f(e){var t;let{event:n,eventIndex:a,numDaysInFuture:r}=e;return{event_id:n.id,calendar_id:n.calendarId,account_id:n.accountId,is_all_day:n.isAllDay,has_participants:n.hasParticipants,conferencing_type:null===(t=n.conferencing)||void 0===t?void 0:t.providerName,index:a,num_days_in_future:r}}function g(e){let{environment:t,target:n,eventContext:r,calendarPanelContext:i}=e;(0,a().vd)(t,"cal_event_click",{target:n,...u(i),...v(r)}),"conferencing"===n&&i.bot_id&&o(t,{botId:i.bot_id,payload:{type:"track",payload:{event:"joinMeeting",eventId:r.event_id,calendarId:r.calendar_id,conferencingProvider:r.conferencing_type,method:i.view}}})}function p(e){let{environment:t,eventContext:n,calendarPanelContext:r,attachmentType:i,notionBlockId:c,attachmentIndex:d}=e;(0,a().vd)(t,"cal_event_click",{target:"attachment",attachment_type:i,attachment_index:d,notion_block_id:c,...u(r),...v(n)}),r.bot_id&&o(t,{botId:r.bot_id,payload:{type:"track",payload:{event:"eventAttachmentOpened",provider:i,location:r.view}}})}function h(e){const{environment:t,calendarPanelContext:n,notionAnalyticsSessionId:r}=e;(0,a().vd)(t,"cal_create_event",{...u(n)}),n.bot_id&&o(t,{botId:n.bot_id,payload:{type:"track",payload:{event:"createEventButtonClicked",notionAnalyticsSessionId:r,method:n.view}}})}function S(e){(0,a().vd)(e.environment,"cal_settings_menu",{action:e.action,...u(e.calendarPanelContext)})}function y(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:`toggle_${e.filter}`,value:e.newValue})}function I(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"change_calendar_bot",value:e.botId})}function b(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"toggle_mirroring",value:e.newValue})}function _(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"change_time_range",value:e.newValue})}function C(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"toggle_calendar_visibility",calendarId:e.calendarId,accountId:e.accountId,value:e.newValue})}function w(e){(0,a().vd)(e.environment,"cal_configure_view",{...u(e.calendarPanelContext),action:e.action,value:e.value,..."calendarId"in e?{calendar_id:e.calendarId}:{},..."accountId"in e?{account_id:e.accountId}:{}})}function V(e){const{environment:t,calendarPanelContext:n}=e;(0,a().vd)(t,"cal_loaded",{...u(n)}),n.bot_id&&o(t,{botId:n.bot_id,payload:{type:"page",payload:{page:n.view}}})}},965170:(e,t,n)=>{n.d(t,{Om:()=>C,g2:()=>b,FC:()=>w,$z:()=>S,IC:()=>f});n(362833),n(333225),n(494367),n(516262),n(573119),n(240480),n(950443),n(619601),n(725707),n(491955),n(403517);var a=()=>n(486826),r=()=>n(642145),o=()=>n(502140),i=()=>n(975392),c=()=>n(76394),d=()=>n(896864),s=()=>n(540059),l=()=>n(50902),u=()=>n(705653),v=()=>n(739536);function m(e){if(e.isAllDay){const{date:t}=e.start;return(0,v().V$)(t,"UTC")}{const{dateTime:t}=e.start;return a().c9.fromISO(t,{zone:"UTC"})}}function f(e){let{botId:t,accounts:n,calendars:a,events:o,timeMin:i,timeMax:c}=e;const d=new(r().A)(a.map(g),l().N);return{botId:t,accounts:new(r().A)(n,(e=>e.id)),calendars:d,events:new(r().A)(p(o).sort(y(d)),l().z),timeMin:i,timeMax:c}}function g(e){return{...e,color:(0,d().Pf)({color:e.color,colorId:e.colorId,colorType:"calendar"}),colorId:void 0,primary:e.primary}}function p(e){return e.map((e=>function(e){var t,n,r,i,c,s;let l;const u=h(null===(t=e.start)||void 0===t?void 0:t.timeZone),m=h(null===(n=e.end)||void 0===n?void 0:n.timeZone),f=(null===(r=e.start)||void 0===r?void 0:r.date)??(null===(i=e.start)||void 0===i?void 0:i.dateTime)??void 0,g=(null===(c=e.end)||void 0===c?void 0:c.date)??(null===(s=e.end)||void 0===s?void 0:s.dateTime)??void 0;if(!f||!g)return;const p=()=>{o().log({level:"error",from:"toHydratedEvent",type:"invalidDate",data:{miscDataToConvertToString:{accountId:e.accountId,calendarId:e.calendarId,eventId:e.id,start:f,end:g}}})};if(e.isAllDay){let e,t;try{e=(0,v().J_)(f,u||"UTC"),t=(0,v().J_)(g,u||"UTC")}catch(S){return void p()}l={isAllDay:!0,start:{date:e},end:{date:t}}}else{const e=a().c9.fromISO(f,{zone:u}),t=a().c9.fromISO(g,{zone:m});if(!e.isValid||!t.isValid)return void p();l={isAllDay:!1,start:{dateTime:f,timeZone:u},end:{dateTime:g,timeZone:m}}}return{...e,...l,color:(0,d().Pf)({colorId:e.colorId,colorType:"event"})}}(e))).filter(c().O9)}function h(e){if(e)return a().R2.normalizeZone(e).isValid?e:void 0}function S(e){let{events:t,updatedCalendarAndAccountIds:n,newEvents:a,calendars:o}=e;const i=new Set(n.map(l().N)),c=function(e,t,n){const a=[];let r=0,o=0;for(;r<e.length&&o<t.length;){n(e[r],t[o])<=0?(a.push(e[r]),r++):(a.push(t[o]),o++)}r<e.length?a.push(...e.slice(r)):o<t.length&&a.push(...t.slice(o));return a}(t.getOrderedValues().filter((e=>!i.has((0,l().N)(e)))),[...a].sort(y(o)),y(o));return new(r().A)(c,l().z)}function y(e){const t=t=>e.get((0,l().N)(t));return(e,n)=>function(e){let{aCalendar:t,aEvent:n,aStartTimeOverride:a,bCalendar:r,bEvent:o,bStartTimeOverride:i}=e,c=a,d=i;if(!c&&n.start&&(c=m(n)),!d&&o.start&&(d=m(o)),!c)return 1;if(!d)return-1;let s=(0,u().A)(c.toMillis(),d.toMillis());if(0===s){var l,v;const e=Boolean(null==t?void 0:t.primary),a=Boolean(null==r?void 0:r.primary),i=Boolean(null===(l=n.conferencing)||void 0===l?void 0:l.providerName),c=Boolean(n.hasParticipants),d=i&&c,u=Boolean(null===(v=o.conferencing)||void 0===v?void 0:v.providerName),m=Boolean(o.hasParticipants),f=u&&m,g="accepted"===n.responseStatus,p="accepted"===o.responseStatus,h="needsAction"===n.responseStatus,S="needsAction"===o.responseStatus,y="tentative"===n.responseStatus,I="tentative"===o.responseStatus;e&&!a?s=-1:a&&!e?s=1:d&&!f?s=-1:f&&!d?s=1:i&&!u?s=-1:u&&!i?s=1:c&&!m?s=-1:m&&!c?s=1:g&&!p?s=-1:p&&!g?s=1:!h||p||S?!S||g||h?y&&!(p||S||I)?s=-1:I&&!(g||h||y)&&(s=1):s=1:s=-1}return s}({aEvent:e,bEvent:n,aCalendar:t(e),bCalendar:t(n)})}function I(e,t){return(0,v().V$)(e,t).minus({days:1}).toISODate()}function b(e){let{events:t,getCalendarVisibility:n,calendars:a,startDate:o,endDateInclusive:c,eventFilters:d,timeZone:s}=e;const u=o.toISODate(),m=c.toISODate(),f=new(r().A)([],(e=>{let{baseEvent:t}=e;return t.id}));for(const r of t){const e=null==a?void 0:a.get((0,l().N)(r));if(!e||!n(e)||!_({event:r,minDate:u,maxDateInclusive:m,eventFilters:d,timeZone:s}))continue;const t=f.get(r.id);if(t)t.allSquashedEvents=(0,i().hS)([...t.allSquashedEvents,r],(e=>(0,l().z)(e)));else if(r.cronSyncOriginalEventData){const e=r.cronSyncOriginalEventData.eventId,t=f.get(e);t&&(t.allSquashedEvents=(0,i().hS)([...t.allSquashedEvents,r],l().z))}else f.append(r.id,{baseEvent:r,allSquashedEvents:[r]})}const g=new(r().A)((0,v().$D)(u,m,s).map((e=>({date:e,allDayEvents:[],timedEvents:[]}))),(e=>{let{date:t}=e;return t}));for(const{baseEvent:r,allSquashedEvents:i}of f.getOrderedValues())if(r.isAllDay){const e=(0,v().RY)({eventStartDate:r.start.date,eventEndDateInclusive:I(r.end.date,s),minDate:u,maxDateInclusive:m,timeZone:s});for(const t of e){const e=g.get(t);e&&e.allDayEvents.push({baseEvent:r,allSquashedEvents:i})}}else{const e=(0,v().J_)(r.start.dateTime,s),t=g.get(e);if(!t)continue;t.timedEvents.push({baseEvent:r,allSquashedEvents:i})}return g.getOrderedValues()}function _(e){let{event:t,minDate:n,maxDateInclusive:a,eventFilters:r,timeZone:o}=e;if(function(e){switch(e.responseStatus){case"declined":return!0;case"needsAction":case"tentative":case"accepted":case void 0:return!1;default:(0,c().HB)(e.responseStatus)}}(t))return!1;if(!(0,s().J)({event:t,eventFilters:r}))return!1;const{start:i,end:d}=function(e,t){return e.isAllDay?{start:e.start.date,end:I(e.end.date,t)}:{start:(0,v().J_)(e.start.dateTime,t),end:(0,v().J_)(e.end.dateTime,t)}}(t,o);return!(i>a||d<n)&&(0,s().J)({event:t,eventFilters:r})}function C(e){return[...e.allDayEvents,...e.timedEvents]}function w(e,t,n){return function(e,t){const n=e.isAllDay?e.end.date:e.end.dateTime;return a().c9.fromISO(n,{zone:t})}(e,n)<t}}}]);