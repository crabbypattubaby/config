"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[82850],{264022:(e,t,n)=>{n.d(t,{HJ:()=>_,WA:()=>R,be:()=>T,bx:()=>E,kU:()=>j,lT:()=>D,lg:()=>C,nO:()=>w,vH:()=>O});n(610931),n(362833);var r=()=>n(779698),o=()=>n(836693),a=()=>n(680369),i=()=>n(214144),s=()=>n(711659),c=()=>n(409211),d=()=>n(204132),u=()=>n(76394),l=()=>n(145046),m=()=>n(759625),y=()=>n(84543),g=()=>n(56432),p=()=>n(271142),f=()=>n(459845),h=()=>n(137476),b=()=>n(213517),x=()=>n(137696),k=()=>n(754697),A=()=>n(477784),v=()=>n(836331),M=()=>n(413871);const S=(0,n(653998).YK)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"},confirmDiscardChangesMessage:{id:"automations.confirmDiscardChanges.message",defaultMessage:"Discard unsaved changes to this automation?"},confirmDiscardChangesAccept:{defaultMessage:"Discard",id:"automations.confirmDiscardChanges.acceptLabel"},confirmDiscardOptionalFieldChangesMessage:{id:"automations.confirmDiscardToggleFieldChangesMessage.message",defaultMessage:"{hasName, select, true {Discard {fieldName} field?} other {Discard field?}}"}});function w(e){const{automationStore:t,collectionStore:n,environment:o,intl:a,from:c,builderType:l}=e;y().createAndCommit({environment:o,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",canUndo:!0,perform:e=>{y().applyOperation({store:n,operation:{pointer:n.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const r=M().dn.createChildStore(n,t.pointer),c=t.getActionStores();for(const t of c){const n=t.getType();n&&g().addAutomationAction({actionId:t.id,actionType:n,automationStore:r,config:t.getConfig(),environment:o,intl:a,transaction:e})}let d;const l=t.getTrigger();(0,u().O9)(l)&&"event"!==l.type?"recurrence"===l.type?d={id:i().JW(),type:"recurrence",recurrence:l.recurrence}:(0,u().HB)(l):d={id:i().JW(),type:"event",event:(null==l?void 0:l.event)??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:"collection"}}},m().eC({environment:o,inMemoryRecordCache:n.inMemoryRecordCache,table:s().yB,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:n.id,parent_table:n.table,properties:{name:t.getName()},space_id:n.getSpaceId(),status:"active",trigger:d}})}});const x=t.getModel();if((0,u().O9)(x)){const e=(0,p().To)(t);let n=[];e&&d().Q.isSuccess(e)&&(n=e.value.valueTypes),(0,f().CM)(((e,a,i)=>{const s=(0,h().ik)(o),d=r().sp({automationModel:x,builderType:l,formulaAnalyticsModule:a,formulasModule:e,formulaTypecheckContextValues:n,getRecordModel:t.getRecordModel,featureGates:(0,b().i)(),simpleFormulasModule:i}),u=c?{feature:{id:d.automation_id,from:c,type:"automation"}}:{};r().Dk(s,{...d,...u}),v().default.logEvent("automation_create")}))}}function j(e){const{automationStore:t,collectionStore:n,environment:o,builderType:a,source:i}=e;y().createAndCommit({environment:o,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",canUndo:!0,perform:e=>{const r=M().dn.createChildStore(n,t.pointer),o=t.getName(),a=r.getKeyStore("properties");m().zv({store:a,data:{name:o},transaction:e}),t.getStatus()!==r.getStatus()&&m().zv({store:r,data:{status:t.getStatus()},transaction:e});const i=t.getActionStores();if((0,x().$X)(r)&&(0,x().$X)(t))if(t.isTriggerType("event"))r.isTriggerType("event")||m().zv({store:r.getTriggerStore(),data:{type:"event"},transaction:e}),r.verifyTriggerType("event"),m().zv({store:r.getTriggerStore().getKeyStore("event"),data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e});else{if(!t.isTriggerType("recurrence"))throw new Error("Unexpected trigger type for automationStore");r.isTriggerType("recurrence")||m().zv({store:r.getTriggerStore(),data:{type:"recurrence"},transaction:e}),r.verifyTriggerType("recurrence"),m().zv({store:r.getTriggerStore().getKeyStore("recurrence"),data:t.getTriggerStore().getKeyStore("recurrence").getValue(),transaction:e})}const s=[];for(const t of i){const n=t.getModel();if(!n)continue;const o=M().bx.createChildStore(r,t.pointer);m().KY({store:o,value:{alive:!0,config:n.getConfig(),id:n.id,parent_id:r.id,parent_table:r.table,space_id:r.getSpaceId(),type:n.type},transaction:e}),s.push(t.id)}m().zv({store:r,data:{action_ids:s},transaction:e})}});const s=t.getModel();(0,u().O9)(s)&&(0,f().CM)(((e,n,c)=>{const u=(0,p().To)(t);let l=[];u&&d().Q.isSuccess(u)&&(l=u.value.valueTypes);const m=(0,h().ik)(o),y=r().sp({automationModel:s,builderType:a,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,b().i)(),simpleFormulasModule:c,source:i});r().SF(m,y),v().default.logEvent("automation_update")}))}async function C(e){const{intl:t,environment:n,collectionStore:r,existingAutomationStore:o,onDelete:a}=e,i=o.getNameWithDefault(t);(await l().Gh({message:t.formatMessage(S.automationDeleteConfirmationMessage,{automationName:i}),acceptLabel:t.formatMessage(S.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,collectionStore:n,existingAutomationStore:r}=e;y().createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",canUndo:!0,perform:e=>{const o=n.getFormatStore().getKeyStore("automation_ids"),a=M().dn.createChildStore(n,r.pointer);y().applyOperation({store:o,operation:{pointer:o.pointer,path:o.path,command:"listRemove",args:{id:a.id}},transaction:e}),g().deleteAutomation({automationStore:a,environment:t,transaction:e})}})}({environment:n,collectionStore:r,existingAutomationStore:o}),null==a||a())}function R(e){const{automationStore:t,environment:n}=e;y().createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.disableAutomation",canUndo:!0,perform:e=>{g().disableAutomation({automationStore:t,environment:n,transaction:e})}})}function T(e){const{automationStore:t,collectionStore:n,environment:r}=e;y().createAndCommit({canUndo:!0,environment:r,userAction:"collectionSettingsAutomationsActions.restartAutomation",perform:e=>{const r=M().dn.createChildStore(n,t.pointer);g().restartAutomation({automationStore:r,transaction:e})}})}function _(e){const{automationStore:t,environment:n}=e;y().createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.enableAutomation",canUndo:!0,perform:e=>{g().enableAutomation({automationStore:t,environment:n,transaction:e})}})}function O(e){const{automationStore:t,collectionStore:n,environment:r}=e,o=n.getFormatStore().getKeyStore("automation_ids"),a=(0,k().Z1)({environment:r,table:s().yB,spaceId:t.getSpaceId()}),i=r.currentUser.id?{id:r.currentUser.id,table:c().oo}:void 0;y().createAndCommit({environment:r,userAction:"",canUndo:!0,perform:e=>{g().duplicateAutomation({environment:r,sourceAutomationStore:t,targetAutomationId:a,transaction:e,actorPointer:i}),y().applyOperation({store:o,operation:{pointer:o.pointer,path:o.path,command:"listAfter",args:{id:a}},transaction:e})}})}async function D(e){const{hasPendingChanges:t}=e;if(!t)return!0;return(await l().Gh({acceptLabel:A().A.formatMessage(S.confirmDiscardChangesAccept),message:A().A.formatMessage(S.confirmDiscardChangesMessage),icon:(0,o().trashIcon)({height:a().Ev.xl,width:a().Ev.xl})})).accept}async function E(e){const{fieldName:t}=e;return(await l().Gh({acceptLabel:A().A.formatMessage(S.confirmDiscardChangesAccept),message:A().A.formatMessage(S.confirmDiscardOptionalFieldChangesMessage,{fieldName:t,hasName:Boolean(t)}),icon:(0,o().trashIcon)({height:a().Ev.xl,width:a().Ev.xl})})).accept}},266263:(e,t,n)=>{n.d(t,{$:()=>Te});var r=n(242343),o=()=>n(269280),a=()=>n(803290),i=()=>n(114103),s=()=>n(962373),c=()=>n(748039),d=(n(362833),()=>n(486826)),u=()=>n(237385),l=()=>n(174114),m=()=>n(198654),y=()=>n(707781),g=()=>n(653998),p=()=>n(975392),f=()=>n(76394),h=()=>n(31448),b=()=>n(421338),x=()=>n(535906),k=()=>n(273520),A=()=>n(918625),v=()=>n(441292),M=()=>n(935091),S=()=>n(932322),w=()=>n(858023),j=()=>n(286404),C=()=>n(88271),R=()=>n(297340),T=()=>n(782422),_=()=>n(441911),O=()=>n(551078),D=n(163643);const E=(0,g().YK)({never:{id:"automations.RecurrenceEditor.endConditionMenu.never",defaultMessage:"Never"},numberOfRuns:{id:"automations.RecurrenceEditor.endConditionMenu.numberOfRuns",defaultMessage:"Number of runs"},specificDate:{id:"automations.RecurrenceEditor.endConditionMenu.specificDate",defaultMessage:"Specific date"}});function I(e){const{currentValue:t,onChange:n}=e,o=(0,_().e)({minWidth:230}),a="number"===(null==t?void 0:t.type)?t.number_of_occurrences:void 0,[i,s]=(0,r.useState)(a??1),c=[{key:"never",items:[{key:"never",action:()=>{n(void 0)},render:e=>(0,D.jsx)(x().A,{...e,title:(0,D.jsx)(g().sA,{...E.never}),isChecked:void 0===t})}],render:e=>(0,D.jsx)(C().A,{...e})},{key:"number_of_occurrences",items:[{key:"number_of_occurrences",action:()=>{n({type:"number",number_of_occurrences:i})},render:e=>(0,D.jsx)(z,{...e,currentNumber:a??i,onNumberChange:e=>{(0,f().O9)(e)&&(s(e),n({type:"number",number_of_occurrences:e}))},selected:"number"===(null==t?void 0:t.type)})}],render:e=>(0,D.jsx)(C().A,{topBorder:!0,...e})},{key:"date",items:[{key:"date",action:()=>{},render:t=>(0,D.jsx)(N,{...t,...e})}],render:e=>(0,D.jsx)(C().A,{topBorder:!0,...e})}];return(0,D.jsx)(M().A,{...o,children:(0,D.jsx)(w().Ay,{type:w().Oh.Vertical,sections:c,initialFocus:0})})}const z=(0,r.forwardRef)((function(e,t){const{currentNumber:n,onNumberChange:r,selected:o,...a}=e,s=(0,l().IS)((e=>({input:{maxWidth:60},menuItemTitle:{overflow:"visible"}})),[]);return(0,D.jsx)(x().A,{...a,itemMarginRight:4,ref:t,titleStyle:s.menuItemTitle,title:(0,D.jsxs)(b().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,D.jsx)("div",{children:(0,D.jsx)(g().sA,{...E.numberOfRuns})}),o&&(0,D.jsx)(O().b,{disabled:!o,currentValue:n,onChange:r,extraValidation:i().isValidRecurrenceNumberOfRuns,style:s.input,maxlength:3})]}),isChecked:o})})),N=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:o,...s}=e,c=(0,r.useMemo)((()=>d().c9.now().plus({weeks:1}).toMillis()),[]),u=(0,g().tz)(),m=(0,a().K8)((()=>T().XX.state),[]),y="date"===(null==n?void 0:n.type),p=y?n.end_at:c,[f,h]=(0,r.useState)(y);(0,r.useEffect)((()=>{!y&&f&&h(!1)}),[y,f]);const b=(0,r.useMemo)((()=>"date"===(null==n?void 0:n.type)?(0,i().getFormattedEndCondition)(n,u):void 0),[n,u]),x=(0,r.useCallback)((e=>{o({type:"date",end_at:e})}),[o]),k=(0,r.useMemo)((()=>({before:new Date})),[]),v=(0,r.useCallback)((()=>{o({type:"date",end_at:c})}),[o,c]),M=(0,l().IS)((()=>({minWidth:{minWidth:"247px"},calendarContainer:{padding:"8px 0"}})),[]),S=f||y;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(A()._,{...s,title:(0,D.jsx)(g().sA,{...E.specificDate}),chevronType:S?"down":"right",right:b,onClick:v,style:M.minWidth}),S&&(0,D.jsx)("div",{style:M.calendarContainer,children:(0,D.jsx)(R().A,{firstDayOfWeek:m,value:p,onChange:x,disabledDays:k})})]})}));n(403517);const U=(0,g().YK)({day:{id:"automations.FrequencyMenu.day",defaultMessage:"{number, plural, one {Day} other {Days}}"},week:{id:"automations.FrequencyMenu.week",defaultMessage:"{number, plural, one {Week} other {Weeks}}"},month:{id:"automations.FrequencyMenu.month",defaultMessage:"{number, plural, one {Month} other {Months}}"},year:{id:"automations.FrequencyMenu.year",defaultMessage:"{number, plural, one {Year} other {Years}}"}}),B={day:e=>({...U.day,values:{number:e?2:1}}),week:e=>({...U.week,values:{number:e?2:1}}),month:e=>({...U.month,values:{number:e?2:1}}),year:e=>({...U.year,values:{number:e?2:1}})};function W(e){const{onSelect:t,currentFrequency:n,pluralLabels:r}=e,o=(0,_().e)(),a=[{key:"default",items:(0,f().WP)(B).map((e=>{let[o,a]=e;return{key:o,action:()=>{t(o)},render:e=>(0,D.jsx)(x().A,{...e,title:(0,D.jsx)(g().sA,{...a(r)}),isChecked:n===o})}})),render:e=>(0,D.jsx)(C().A,{...e})}];return(0,D.jsx)(M().A,{...o,children:(0,D.jsx)(w().Ay,{type:w().Oh.Vertical,sections:a,initialFocus:0})})}var F=()=>n(689848);const L=(0,g().YK)({monthRestrictionLabel:{id:"automations.MonthRestrictionMenuItem.monthRestrictionLabel",defaultMessage:"On the"},last:{id:"automations.MonthRestrictionMenuItem.last",defaultMessage:"Last"},day:{id:"automations.MonthRestrictionMenuItem.day",defaultMessage:"Day"}}),V=31,Y=4,P=(0,r.forwardRef)((function(e,t){const{initialValue:n,onChange:o,startDateForFallback:a,...i}=e,s=(0,u().Y0)(),c=(0,l().IS)((e=>({menuItem:{...!s.isMobile&&{paddingTop:6,paddingBottom:8}}})),[s]),[m,y]=(p=function(e,t){const n=()=>t?{type:"day",dayNumber:d().c9.fromMillis(t).day}:J;return e?"monthdays"===e.type?1!==e.monthdays.length?n():{type:"day",dayNumber:e.monthdays[0]}:"weekdays_in_month"===e.type?1!==e.week_numbers.length||1!==e.weekdays.length?n():{type:"weekday",weekday:e.weekdays[0],weekNumber:-1===e.week_numbers[0]?"last":e.week_numbers[0]}:void(0,f().HB)(e):n()}(n,a),(0,r.useReducer)(((e,t)=>{if("change_day"===t.type)if("day"===t.newDay){if("day"===e.type)return e;if("weekday"===e.type)return{type:"day",dayNumber:"last"===e.weekNumber?1:Math.min(e.weekNumber,Y)};(0,f().HB)(e)}else{if("weekday"===e.type)return{...e,weekday:t.newDay};if("day"===e.type)return{type:"weekday",weekday:t.newDay,weekNumber:e.dayNumber>Y?"last":e.dayNumber};(0,f().HB)(e)}else if("change_number"===t.type){if("day"===e.type)return{...e,dayNumber:"last"===t.newNumber?1:t.newNumber};if("weekday"===e.type)return{...e,weekNumber:t.newNumber};(0,f().HB)(e)}else(0,f().HB)(t)}),p));var p;return function(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]);const o=(0,r.useRef)(!0);(0,r.useEffect)((()=>{o.current?o.current=!1:n.current(function(e){if("day"===e.type)return{type:"monthdays",monthdays:[e.dayNumber]};if("weekday"===e.type)return{type:"weekdays_in_month",weekdays:[e.weekday],week_numbers:["last"===e.weekNumber?-1:e.weekNumber]};(0,f().HB)(e)}(e))}),[e])}(m,o),(0,D.jsx)(S().Ay,{...i,ref:t,style:c.menuItem,title:(0,D.jsxs)(b().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,D.jsx)("div",{children:(0,D.jsx)(g().sA,{...L.monthRestrictionLabel})}),(0,D.jsx)(q,{state:m,dispatch:y})]})})}));function q(e){const{state:t,dispatch:n}=e,r=(0,u().Y0)(),o=(0,g().tz)(),a=G(),i=(0,l().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.icon.secondary},button:{height:28,padding:"4px 8px"}})),[]),s=X(t),c=$(t),d=r.isMobile?k().z7.SlideUp:k().z7.Popup;return(0,D.jsxs)(b().Y1,{width:"hug",direction:"horizontal",gap:6,children:[(0,D.jsx)(k().Ay,{popupType:d,render:e=>(0,D.jsx)(H,{state:t,onSelect:t=>{n({type:"change_number",newNumber:t}),e.close()}}),renderOrigin:e=>(0,D.jsxs)(j().A,{size:"lg",...e,style:i.button,children:["last"===s?(0,D.jsx)(g().sA,{...L.last}):a(s),(0,m().b)(i.icon)]})}),(0,D.jsx)(k().Ay,{popupType:d,render:e=>(0,D.jsx)(K,{state:t,onSelect:t=>{n({type:"change_day",newDay:t}),e.close()}}),renderOrigin:e=>(0,D.jsxs)(j().A,{size:"lg",...e,style:i.button,children:[Q(o,c),(0,m().b)(i.icon)]})})]})}function H(e){const{state:t,onSelect:n}=e,r=(0,_().e)({maxHeight:255}),o=G(),a=X(t),i="weekday"===t.type,s=p().oE([{key:"days",items:p().y1(1,("day"===t.type?V:"weekday"===t.type?Y:(0,f().HB)(t))+1).map((e=>({key:`day_${e}`,action:()=>n(e),render:t=>(0,D.jsx)(x().A,{...t,title:o(e),isChecked:a===e})}))),render:e=>(0,D.jsx)(C().A,{...e})},i?{key:"last",items:[{key:"last",action:()=>n("last"),render:e=>(0,D.jsx)(x().A,{...e,title:(0,D.jsx)(g().sA,{...L.last}),isChecked:"last"===a})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})}:void 0]);return(0,D.jsx)(M().A,{...r,children:(0,D.jsx)(w().Ay,{type:w().Oh.Vertical,sections:s,initialFocus:0})})}function K(e){const{state:t,onSelect:n}=e,r=(0,g().tz)(),o=(0,_().e)(),i=$(t),s=[{key:"day",items:[{key:"day",action:()=>n("day"),render:e=>(0,D.jsx)(x().A,{...e,title:Q(r,"day"),isChecked:"day"===i})}],render:e=>(0,D.jsx)(C().A,{...e})},{key:"weekdays",items:(0,a().K8)((()=>1===T().XX.state?["MO","TU","WE","TH","FR","SA","SU"]:["SU","MO","TU","WE","TH","FR","SA"]),[]).map((e=>({key:`weekday_${e}`,action:()=>n(e),render:t=>(0,D.jsx)(x().A,{...t,title:Q(r,e),isChecked:e===i})}))),render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})}];return(0,D.jsx)(M().A,{...o,children:(0,D.jsx)(w().Ay,{type:w().Oh.Vertical,sections:s,initialFocus:0})})}const J={type:"day",dayNumber:1};function X(e){return"day"===e.type?e.dayNumber:"weekday"===e.type?e.weekNumber:void(0,f().HB)(e)}function $(e){return"day"===e.type?"day":"weekday"===e.type?e.weekday:void(0,f().HB)(e)}function G(){const e=(0,g().tz)().locale.substring(0,2);return t=>(0,F().o4)(e,t,"d")}function Q(e,t){if("day"===t)return e.formatMessage(L.day);{const n=(0,f().uv)(i().RRULE_WEEKDAYS_MAP).indexOf(t)+1;return d().c9.fromObject({weekday:n}).setLocale(e.locale).toLocaleString({weekday:"long"})}}n(725707),n(491955),n(324989);const Z=(0,g().YK)({aroundMidnight:{id:"automations.RecurTimeMenu.aroundMidnight",defaultMessage:"Around midnight"},aroundMidnightCaption:{id:"automations.RecurTimeMenu.aroundMidnightCaption",defaultMessage:"12â€“3AM"}});function ee(e){const{currentRecurTime:t,onRecurTimeSelected:r}=e,o=(0,g().tz)(),a=(0,_().e)(),{isMobile:s}=(0,u().Y0)(),c=[{key:"default",items:[...(0,n(622286).X)("automations_dev_tools")?[te({onRecurTimeSelected:r})]:[],...[{type:"around_midnight"},...p().y1(0,24).flatMap((e=>p().y1(0,60,15).map((t=>({type:"hour_minute",hour:e,minute:t}))))).filter((e=>{let{hour:t,minute:n}=e;return 0!==t&&1!==t&&2!==t&&!(3===t&&0===n)}))].map((e=>{if("hour_minute"===e.type){const{hour:n,minute:a}=e,i=d().c9.utc().set({hour:n,minute:a,second:0,millisecond:0}).setLocale((0,y().H)(o)).toFormat("h:mm a"),s=(null==t?void 0:t.minute)===a&&(null==t?void 0:t.hour)===n;return{key:`hour_minute-${n}-${a}`,action:()=>{r({hour:n,minute:a})},render:e=>(0,D.jsx)(x().A,{...e,title:i,isChecked:s})}}if("around_midnight"===e.type){const e=(0,i().isRunningBetweenMidnightAnd3AM)(t);return{key:"around_midnight",action:()=>{r({hour:0,minute:0})},render:t=>(0,D.jsx)(x().A,{...t,title:(0,D.jsx)(g().sA,{...Z.aroundMidnight}),caption:(0,D.jsx)(g().sA,{...Z.aroundMidnightCaption}),isChecked:e})}}(0,f().HB)(e)}))],render:e=>(0,D.jsx)(C().A,{...e,desktopStyle:{maxHeight:s?"unset":250,overflow:"scroll"}})}];return(0,D.jsx)(M().A,{...a,children:(0,D.jsx)(w().Ay,{type:w().Oh.Vertical,sections:c,initialFocus:0})})}function te(e){const{onRecurTimeSelected:t}=e;return{key:"developer",action:()=>{const e=ne();t({hour:e.hour,minute:e.minute})},render:e=>(0,D.jsx)(re,{...e})}}function ne(){const e=d().c9.local();let t=e.set({second:0,millisecond:0}).plus({minute:1});return t.diff(e,"seconds").seconds<20&&(t=t.plus({minute:1})),t}const re=(0,r.forwardRef)((function(e,t){const[o,a]=(0,r.useState)((()=>ne()));return(0,n(332440).n)((()=>{a(ne())}),1e3,!0),(0,D.jsx)(x().A,{...e,ref:t,title:`[Dev] Run at ${o.toLocaleString(d().c9.TIME_SIMPLE)}`})}));function oe(e){return(0,f().O9)(e.interval)}var ae=()=>n(220413),ie=()=>n(126451);const se=(0,g().YK)({sunday:{id:"automations.WeekdaySelector.weekdayAbbreviations.sunday",defaultMessage:"Su"},monday:{id:"automations.WeekdaySelector.weekdayAbbreviations.monday",defaultMessage:"Mo"},tuesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.tuesday",defaultMessage:"Tu"},wednesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.wednesday",defaultMessage:"We"},thursday:{id:"automations.WeekdaySelector.weekdayAbbreviations.thursday",defaultMessage:"Th"},friday:{id:"automations.WeekdaySelector.weekdayAbbreviations.friday",defaultMessage:"Fr"},saturday:{id:"automations.WeekdaySelector.weekdayAbbreviations.saturday",defaultMessage:"Sa"}}),ce={SU:se.sunday,MO:se.monday,TU:se.tuesday,WE:se.wednesday,TH:se.thursday,FR:se.friday,SA:se.saturday};function de(e){const{weekdays:t,onChange:r,style:o,disabled:a}=e,i=(0,g().tz)();return(0,D.jsx)(b().Y1,{direction:"horizontal",gap:"auto",width:"fill",style:o,children:n(541381).U.map((e=>(0,D.jsx)(ue,{isSelected:t.includes(e),onClick:()=>{const n=t.includes(e)?t.length>1?t.filter((t=>t!==e)):t:[...t,e];r(n)},disabled:a,children:i.formatMessage(ce[e])},e)))})}function ue(e){const{isSelected:t,children:n,onClick:r,disabled:o}=e,{isMobile:a}=(0,u().Y0)(),i=(0,l().IS)((e=>({button:{...a?{width:44,height:44,fontSize:32}:{width:28,height:28},color:t?ae().Ay.white:e.darkTextColor,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:100,flexShrink:0,fontSize:a?h().J.UISmall.mobile:h().J.UISmall.desktop,background:t?ae().Ay.blue:e.accentColors.gray[75]},pressed:{background:t?e.blueButtonPressedBackground:e.accentColors.gray[200]},hovered:{background:t?e.blueButtonHoveredBackground:e.accentColors.gray[100]}})),[a,t]);return(0,D.jsx)(ie().A,{disabled:o,onClick:r,style:i.button,hoveredStyle:i.hovered,pressedStyle:i.pressed,children:n})}const le=(0,g().YK)({frequencyLabel:{id:"automations.RecurrenceEditor.frequencyLabel",defaultMessage:"Every"},recurTimeLabel:{id:"automations.RecurrenceEditor.recurTimeLabel",defaultMessage:"At"},startTimeLabel:{id:"automations.RecurrenceEditor.startTimeLabel",defaultMessage:"Starting"},endConditionLabel:{id:"automations.RecurrenceEditor.endConditionLabel",defaultMessage:"Ending"},deleteRecurrenceLabel:{id:"automations.RecurrenceEditor.deleteRecurrenceLabel",defaultMessage:"Stop repeating"},timezone:{id:"automations.RecurrenceEditor.timezone",defaultMessage:"Timezone"}});function me(e){const{currentValue:t,onDelete:n,disabled:r,allowExpiredRecurrence:o,onSave:a,disallowEnd:s=!1}=e,c=(0,g().tz)(),d=(0,_().e)({minWidth:260}),m=[],{isMobile:y}=(0,u().Y0)(),b=(0,l().IS)((e=>({disabledMessage:{color:e.text.secondary,fontSize:y?h().J.UISmall.mobile:h().J.UISmall.desktop}})),[y]);r&&m.push({key:"disabled_message",items:[{key:"disabled_message",action:()=>{},render:e=>(0,D.jsx)(S().Ay,{...e,title:(0,D.jsx)("div",{style:b.disabledMessage,children:(0,D.jsx)(g().sA,{id:"automations.RecurrenceEditor.noPermissionMessage",defaultMessage:"You do not have permission to edit this automation"})})})}],render:e=>(0,D.jsx)(C().A,{...e})}),!r&&(0,f().O9)(a)&&m.push({key:"save_section",items:[{key:"save_item",action:()=>{},render:e=>(0,D.jsx)(ye,{...e,onSave:a,canSave:(0,f().O9)(t.interval)})}],render:e=>(0,D.jsx)(C().A,{...e})}),m.push({key:"main",items:(0,p().oE)([{key:"frequency",action:()=>{},render:t=>(0,D.jsx)(ge,{...t,...e,hasSaveSection:(0,f().O9)(a)})},ke(e),Se(e),{key:"recur_time",action:()=>{},render:t=>(0,D.jsx)(pe,{...t,...e})}]),render:e=>(0,D.jsx)(C().A,{...e,topBorder:r})}),m.push({key:"times",items:[{key:"start_time",action:()=>{},render:t=>(0,D.jsx)(fe,{...t,...e})},...s?[]:[{key:"end_condition",action:()=>{},render:t=>(0,D.jsx)(ve,{...t,...e})}],{key:"timezone",action:()=>{},render:t=>(0,D.jsx)(Me,{...t,...e})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})}),n&&!r&&m.push({key:"delete",items:[{key:"delete",action:()=>{},render:t=>(0,D.jsx)(he,{...t,...e,onClick:n})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})});const x=function(e){const{recurrence:t,intl:n,allowExpiredRecurrence:r}=e;if(!oe(t))return{key:"next_recurrence",items:[{key:"invalid_recurrence_config",action:()=>{},render:e=>(0,D.jsx)(be,{...e,children:(0,D.jsx)(g().sA,{id:"automations.RecurrenceEditor.invalidRecurrenceConfig",defaultMessage:"Missing required fields"})})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})};const o=(0,i().getFormattedNextRecurrenceTime)({recurrence:t,intl:n});if(!o)return r?{key:"expired_recurrence",items:[{key:"expired_recurrence",action:()=>{},render:e=>(0,D.jsx)(be,{mode:"info",...e,children:(0,D.jsx)(g().sA,{id:"automations.RecurrenceEditor.automationComplete",defaultMessage:"This is complete and will not run again"})})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})}:{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,D.jsx)(be,{...e,children:(0,D.jsx)(g().sA,{id:"automations.RecurrenceEditor.automationWillNeverRun",defaultMessage:"This automation will never run"})})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})};return{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,D.jsx)(xe,{...e,nextRecurrenceTime:o})}],render:e=>(0,D.jsx)(C().A,{...e,topBorder:!0})}}({recurrence:e.currentValue,intl:c,allowExpiredRecurrence:o});return x&&m.push(x),(0,D.jsx)(v().A,{debugName:"RecurrenceEditor",capture:!0,allowEsc:!0,children:(0,D.jsx)(M().A,{...d,children:(0,D.jsx)(w().Ay,{disallowBackspace:!0,type:w().Oh.Vertical,sections:m,initialFocus:0})})})}const ye=(0,r.forwardRef)((function(e,t){const{onSave:r,canSave:o,...a}=e,{isMobile:i}=(0,u().Y0)(),s=(0,l().IS)((e=>({menuItem:{paddingTop:2},message:{color:e.text.secondary,fontSize:i?h().J.UISmall.mobile:h().J.UISmall.desktop},button:{fontSize:i?h().J.UISmall.mobile:h().J.UISmall.desktop}})),[i]),c=!o||"disabled"===r;return(0,D.jsx)(S().Ay,{...a,ref:t,style:s.menuItem,title:(0,D.jsxs)(b().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,D.jsx)("div",{style:s.message,children:(0,D.jsx)(g().sA,{id:"automations.RecurrenceEditor.editCadenceTitle",defaultMessage:"Edit cadence"})}),(0,D.jsx)(n(209684).p,{isBlue:!0,size:"sm",style:s.button,disabled:c,disabledFeedback:!0,onClick:"disabled"===r?p().lQ:r,children:(0,D.jsx)(g().sA,{id:"automations.RecurrenceEditor.saveButtonLabel",defaultMessage:"Save"})})]})})})),ge=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:o,disabled:a,hasSaveSection:s,...c}=e,d=(0,u().Y0)(),y=(0,l().IS)((e=>({input:{maxWidth:34,padding:"4px 8px",opacity:a?.5:1},icon:{width:10,marginLeft:4,fill:e.icon.secondary},button:{justifyContent:"flex-end",height:28,opacity:a?.5:1,padding:"4px 8px"},menuItem:{...!d.isMobile&&{paddingTop:s?0:8,paddingBottom:2}}})),[d.isMobile,a,s]),p=(0,f().O9)(n.interval)&&1!==n.interval,h=(0,r.useCallback)((e=>{n.frequency!==e&&o({...n,frequency:e,..."week"===e&&0===(n.weekdays??[]).length?{weekdays:["MO"]}:{},..."month"===e?{monthly_restriction:{type:"monthdays",monthdays:[1]}}:{}})}),[n,o]);return(0,D.jsx)(S().Ay,{...c,ref:t,title:(0,D.jsx)(g().sA,{...le.frequencyLabel}),style:y.menuItem,disabled:a,right:(0,D.jsxs)(b().Y1,{direction:"horizontal",gap:6,width:"hug",align:"center",children:[(0,D.jsx)(O().b,{style:y.input,currentValue:n.interval,onChange:e=>{o({...n,interval:e})},extraValidation:i().isValidRecurrenceInterval,disabled:a,maxlength:2}),(0,D.jsx)(k().Ay,{popupType:d.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,D.jsx)(W,{currentFrequency:n.frequency,onSelect:t=>{h(t),e.close()},pluralLabels:p}),renderOrigin:e=>(0,D.jsxs)(j().A,{...e,size:"lg",style:y.button,disabled:a,children:[(0,D.jsx)(g().sA,{...B[n.frequency](p)}),!a&&(0,m().b)(y.icon)]}),disabled:a})]})})})),pe=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:o,...a}=e,s=(0,g().tz)(),c=(0,u().Y0)();let l;return(0,f().O9)(n.hour)&&(l=(0,i().isRunningBetweenMidnightAnd3AM)(n)?s.formatMessage(Z.aroundMidnight):d().c9.utc().set({hour:n.hour,minute:n.minute??0,second:0,millisecond:0}).setLocale((0,y().H)(s)).toFormat((0,f().O9)(n.minute)&&0!==n.minute?"h:mm a":"h a")),(0,D.jsx)(k().Ay,{disabled:o,popupType:c.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,D.jsx)(ee,{onRecurTimeSelected:t=>{r({...n,hour:t.hour,minute:t.minute}),e.close()},currentRecurTime:{hour:n.hour,minute:n.minute}}),placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,D.jsx)(A()._,{...a,...e,right:l,title:(0,D.jsx)(g().sA,{...le.recurTimeLabel}),chevronType:"right",disabled:o})})})),fe=(0,r.forwardRef)((function(e,t){const{currentValue:r,onChange:o,disabled:a,disallowStart:i=!1,...s}=e,c=(0,g().tz)(),l=(0,u().Y0)(),m=(0,n(846581).Yq)({date:d().c9.fromMillis(r.start_date),dateFormat:"relative",allowRelativeDates:!0,intl:c,shortenDate:!0});return(0,D.jsx)(k().Ay,{disabled:a||i,popupType:l.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,D.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,D.jsx)(R().A,{firstDayOfWeek:T().XX.state,value:Math.max(r.start_date,Date.now()),onChange:t=>{o({...r,start_date:t}),e.close()},disabledDays:{before:new Date}})}),placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,D.jsx)(A()._,{...s,...e,right:m,title:(0,D.jsx)(g().sA,{...le.startTimeLabel}),chevronType:"right",disabled:a||i})})})),he=(0,r.forwardRef)((function(e,t){const{currentValue:n,...r}=e,o=(0,l().IS)((e=>({menuItem:{paddingBlock:2}})),[]);return(0,D.jsx)(x().A,{...r,ref:t,title:(0,D.jsx)(g().sA,{...le.deleteRecurrenceLabel}),style:o.menuItem,isRedOnHover:!0})}));const be=(0,r.forwardRef)((function(e,t){const{children:n,mode:r="error",...o}=e,{isMobile:a}=(0,u().Y0)(),i=(0,l().IS)((e=>({disabledMessage:{color:"error"===r?e.errorText:e.text.secondary,fontSize:a?h().J.UISmall.mobile:h().J.UISmall.desktop}})),[r,a]);return(0,D.jsx)(S().Ay,{...o,ref:t,title:(0,D.jsx)("div",{style:i.disabledMessage,children:n})})})),xe=(0,r.forwardRef)((function(e,t){const{nextRecurrenceTime:n,...r}=e,{isMobile:o}=(0,u().Y0)(),a=(0,l().IS)((e=>({menuItem:{paddingBlock:2},titleWrap:{display:"flex",...o?{flexDirection:"row",flexWrap:"wrap",gap:4}:{flexDirection:"column"},color:e.text.secondary,fontSize:o?h().J.UISmall.mobile:h().J.UISmall.desktop}})),[o]);return(0,D.jsx)(S().Ay,{...r,style:a.menuItem,title:(0,D.jsxs)("div",{style:a.titleWrap,children:[(0,D.jsx)("div",{children:(0,D.jsx)(g().sA,{defaultMessage:"Next occurrence:",id:"automations.RecurrenceEditor.NextRecurrenceMenuItem.nextOccurrence"})}),(0,D.jsx)("div",{children:n})]})})}));function ke(e){const{currentValue:t}=e;if("week"===t.frequency)return{key:"weekday_selector",action:()=>{},render:t=>(0,D.jsx)(Ae,{...t,...e})}}const Ae=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:o,...a}=e,i=(0,l().IS)((e=>({menuItem:{paddingTop:8,paddingBottom:8}})),[]);return(0,D.jsx)(S().Ay,{...a,disabled:o,style:i.menuItem,title:(0,D.jsx)(de,{weekdays:n.weekdays??[],onChange:e=>{r({...n,weekdays:e})},disabled:o})})})),ve=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:o,disabled:a,...s}=e,c=(0,u().Y0)(),d=(0,g().tz)(),l=(0,r.useMemo)((()=>n.end_condition),[n]),m=(0,r.useCallback)((e=>{o({...n,end_condition:e})}),[n,o]),y=(0,r.useMemo)((()=>(0,i().getFormattedEndCondition)(l,d)),[l,d]);return(0,D.jsx)(k().Ay,{disabled:a,popupType:c.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,D.jsx)(I,{currentValue:l,onChange:m}),placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,D.jsx)(A()._,{...s,...e,right:y,title:(0,D.jsx)(g().sA,{...le.endConditionLabel}),chevronType:"right",disabled:a})})})),Me=(0,r.forwardRef)((function(e,t){const{currentValue:o,onChange:a,disabled:i,...s}=e,c=(0,r.useCallback)((e=>{a({...o,timezone:e})}),[o,a]);return(0,D.jsx)(n(207573).G,{enableRecents:!0,placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,onSelect:c,currentValue:o.timezone,renderOrigin:e=>(0,D.jsx)(A()._,{...s,...e,title:(0,D.jsx)(g().sA,{...le.timezone}),chevronType:"right",right:(0,n(16456).GF)(o.timezone)})})}));function Se(e){const{currentValue:t,onChange:n}=e;if("month"===t.frequency)return{key:"month_restriction",action:()=>{},render:e=>(0,D.jsx)(P,{...e,initialValue:t.monthly_restriction,startDateForFallback:t.start_date,onChange:e=>{n({...t,monthly_restriction:e})}})}}const we=(0,g().YK)({day:{id:"automations.RecurrencePresetMenu.day",defaultMessage:"Day"},weekday:{id:"automations.RecurrencePresetMenu.weekday",defaultMessage:"Weekday"},week:{id:"automations.RecurrencePresetMenu.week",defaultMessage:"Week"},twoWeeks:{id:"automations.RecurrencePresetMenu.twoWeeks",defaultMessage:"2 Weeks"},month:{id:"automations.RecurrencePresetMenu.month",defaultMessage:"Month"},threeMonths:{id:"automations.RecurrencePresetMenu.threeMonths",defaultMessage:"3 Months"},sixMonths:{id:"automations.RecurrencePresetMenu.sixMonths",defaultMessage:"6 Months"},year:{id:"automations.RecurrencePresetMenu.year",defaultMessage:"Year"}}),je={day:we.day,weekday:we.weekday,week:we.week,twoWeeks:we.twoWeeks,month:we.month,threeMonths:we.threeMonths,sixMonths:we.sixMonths,year:we.year};function Ce(e){const{onSelect:t}=e,n=(0,_().e)(),r=[{key:"default",items:(0,f().WP)(je).map((e=>{let[n]=e;return{key:n,action:()=>{t(function(e){const t=(0,c().QA)();switch(e){case"day":return{...t,frequency:"day"};case"weekday":return{...t,frequency:"week",weekdays:["MO","TU","WE","TH","FR"]};case"week":return{...t,frequency:"week",weekdays:["MO"]};case"twoWeeks":return{...t,frequency:"week",interval:2,weekdays:["MO"]};case"month":return{...t,frequency:"month"};case"threeMonths":return{...t,frequency:"month",interval:3};case"sixMonths":return{...t,frequency:"month",interval:6};case"year":return{...t,frequency:"year"};default:(0,f().HB)(e)}}(n))},render:e=>(0,D.jsx)(x().A,{...e,title:(0,D.jsx)(g().sA,{...je[n]})})}})),render:e=>(0,D.jsx)(C().A,{...e})}];return(0,D.jsx)(M().A,{...n,children:(0,D.jsx)(w().Ay,{type:w().Oh.Vertical,sections:r,initialFocus:0})})}const Re=150;function Te(e){const{recurrence:t,onChange:n,disabled:d,autoFocusIfNew:u,requireExplicitSaveAndAllowDelete:l,buttonPopupStore:m,disallowStart:y=!1,disallowEnd:g=!1}=e,p=(0,a().uB)(m,s().A);(0,o().l)((()=>{u&&!t&&setTimeout((()=>{p.setState({open:!0})}),Re)}));const[f,h]=(0,r.useState)(),b=(0,r.useMemo)((()=>f||(t?{...(0,i().convertToUnpersistedRecurrenceConfig)(t),hour:t.hour??0,minute:t.minute??0}:(0,c().QA)())),[f,t]),[x,k]=(0,r.useState)(!1);(0,r.useEffect)((()=>{k((e=>e||Boolean(t)))}),[t]);const A=(0,r.useCallback)((e=>{if(h(e),!l){const t=_e(e);n(t?e:void 0)}}),[n,l]),v=(0,r.useCallback)((()=>{n(void 0),k(!1),p.setState({open:!1})}),[n,p]),M=(0,r.useCallback)((e=>{h(e),l||n(e),p.setState({open:!1}),setTimeout((()=>{k(!0),p.setState({open:!0})}),Re)}),[l,p,n]),S=(0,r.useCallback)((()=>{h(void 0),k(Boolean(t))}),[t]),w=(0,r.useCallback)((()=>!_e(b)||!t||!(0,i().areRecurrenceSchedulesEqual)(b,(0,i().convertToUnpersistedRecurrenceConfig)(t))),[b,t]),j=(0,r.useMemo)((()=>{if(l)return w()&&_e(b)?()=>{n(b),p.setState({open:!1})}:"disabled"}),[p,b,w,n,l]);return{render:(0,r.useCallback)((()=>x||t?(0,D.jsx)(me,{currentValue:b,onChange:A,onDelete:l?v:void 0,onSave:j,disabled:d,disallowStart:y,disallowEnd:g}):(0,D.jsx)(Ce,{onSelect:M})),[x,t,b,A,l,v,j,d,y,g,M]),onClose:S,buttonPopupStore:p,hasUnpersistedChanges:w}}function _e(e){return oe(e)&&void 0!==(0,i().getNextDateUtc)((0,i().convertFromUnpersistedRecurrenceConfig)(e))}},332440:(e,t,n)=>{n.d(t,{n:()=>o});var r=n(242343);function o(e,t,n){const o=(0,r.useRef)(e),a=(0,r.useRef)(null);(0,r.useEffect)((()=>{o.current=e}),[e]),(0,r.useEffect)((()=>{const e=async()=>{a.current&&(clearTimeout(a.current),a.current=null),n&&(await o.current(),a.current=setTimeout(e,t))};return n&&e(),()=>{a.current&&(clearTimeout(a.current),a.current=null)}}),[n,t])}},551078:(e,t,n)=>{n.d(t,{b:()=>s});var r=n(242343),o=()=>n(76394),a=()=>n(59175),i=n(163643);function s(e){const{onChange:t,currentValue:n,extraValidation:s,...c}=e,[d,u]=(0,r.useState)(!1),[l,m]=(0,r.useState)((null==n?void 0:n.toString())??""),y=e=>!(0,o().O9)(s)||s(e);return(0,i.jsx)(a().A,{errorOutline:d,onKeyDown:e=>{if(("ArrowUp"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),e.stopPropagation(),(0,o().O9)(n))){const r="ArrowUp"===e.key?1:-1,o=n+r;y(o)&&(t(o),m(o.toString()))}},value:l,onChange:e=>{const n=e.currentTarget.value;if(m(n),""===n)t(void 0),u(!1);else{const n=Number(e.currentTarget.value);y(n)?(t(n),u(!1)):(t(void 0),u(!0))}},...c})}}}]);